<!DOCTYPE html><html lang="zh" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://0richalcos.github.io/Note/Java/Java.html"><link rel="prev" href="../index.html"><link rel="next" href="Java8.html"><link rel="icon" href="../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>â™¨ï¸ Java - éšä¾¿è®°è®°</title><link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css"><link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel="stylesheet" href="../_stylesheets/extra.css"><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal"> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a href="#8å¼‚å¸¸exception" class="md-skip"> è·³è½¬è‡³ </a> </div> <div data-md-component="announce"> </div> <header class="md-header md-header--shadow" data-md-component="header"> <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰"> <a href="../index.html" title="éšä¾¿è®°è®°" class="md-header__button md-logo" aria-label="éšä¾¿è®°è®°" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> <label class="md-header__button md-icon" for="__drawer"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> éšä¾¿è®°è®° </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> â™¨ï¸ Java </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input class="md-option" data-md-color-media data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal" aria-label="åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼" type="radio" name="__palette" id="__palette_0"> <label class="md-header__button md-icon" title="åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼" for="__palette_1" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> <input class="md-option" data-md-color-media data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal" aria-label="åˆ‡æ¢åˆ°äº®è‰²æ¨¡å¼" type="radio" name="__palette" id="__palette_1"> <label class="md-header__button md-icon" title="åˆ‡æ¢åˆ°äº®è‰²æ¨¡å¼" for="__palette_0" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class="md-header__source"> <a href="https://github.com/0richalcos/Note" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class="md-source__repository"> GitHub </div> </a> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav class="md-nav md-nav--primary" aria-label="å¯¼èˆªæ " data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a href="../index.html" title="éšä¾¿è®°è®°" class="md-nav__button md-logo" aria-label="éšä¾¿è®°è®°" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> éšä¾¿è®°è®° </label> <div class="md-nav__source"> <a href="https://github.com/0richalcos/Note" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class="md-source__repository"> GitHub </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../index.html" class="md-nav__link"> <span class="md-ellipsis"> ğŸ  é¦–é¡µ </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked> <div class="md-nav__link md-nav__container"> <a href="Java.html" class="md-nav__link md-nav__link--active"> <span class="md-ellipsis"> â™¨ï¸ Java </span> </a> <label class="md-nav__link md-nav__link--active" for="__nav_2" id="__nav_2_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> â™¨ï¸ Java </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="Java8.html" class="md-nav__link"> <span class="md-ellipsis"> Java 8 </span> </a> </li> <li class="md-nav__item"> <a href="JavaBasics.html" class="md-nav__link"> <span class="md-ellipsis"> Java åŸºç¡€ </span> </a> </li> <li class="md-nav__item"> <a href="JavaCollection.html" class="md-nav__link"> <span class="md-ellipsis"> Java é›†åˆ </span> </a> </li> <li class="md-nav__item"> <a href="JavaObject.html" class="md-nav__link"> <span class="md-ellipsis"> Java ç±»å’Œå¯¹è±¡ </span> </a> </li> <li class="md-nav__item"> <a href="JavaWeb.html" class="md-nav__link"> <span class="md-ellipsis"> JavaWeb </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3"> <div class="md-nav__link md-nav__container"> <a href="../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E7%AE%97%E6%B3%95/Algorithm.html" class="md-nav__link "> <span class="md-ellipsis"> ğŸ§® æ•°æ®ç»“æ„åŠç®—æ³• </span> </a> <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_3"> <span class="md-nav__icon md-icon"></span> ğŸ§® æ•°æ®ç»“æ„åŠç®—æ³• </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E7%AE%97%E6%B3%95/DesignPattern.html" class="md-nav__link"> <span class="md-ellipsis"> DesignPattern </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4"> <div class="md-nav__link md-nav__container"> <a href="../Spring/Spring.html" class="md-nav__link "> <span class="md-ellipsis"> ğŸƒ Spring </span> </a> <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> ğŸƒ Spring </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../Spring/SpringBoot.html" class="md-nav__link"> <span class="md-ellipsis"> SpringBoot </span> </a> </li> <li class="md-nav__item"> <a href="../Spring/SpringCloud.html" class="md-nav__link"> <span class="md-ellipsis"> SpringCloud </span> </a> </li> <li class="md-nav__item"> <a href="../Spring/SpringMVC.html" class="md-nav__link"> <span class="md-ellipsis"> SpringMVC </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5"> <div class="md-nav__link md-nav__container"> <a href="../%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/MyBatis-Plus.html" class="md-nav__link "> <span class="md-ellipsis"> ğŸ’¾ æŒä¹…å±‚æ¡†æ¶ </span> </a> <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_5"> <span class="md-nav__icon md-icon"></span> ğŸ’¾ æŒä¹…å±‚æ¡†æ¶ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/Mybatis.html" class="md-nav__link"> <span class="md-ellipsis"> Mybatis </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6"> <div class="md-nav__link md-nav__container"> <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/SSO.html" class="md-nav__link "> <span class="md-ellipsis"> ğŸ” è®¤è¯ä¸æˆæƒ </span> </a> <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_6"> <span class="md-nav__icon md-icon"></span> ğŸ” è®¤è¯ä¸æˆæƒ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/Sa-Token.html" class="md-nav__link"> <span class="md-ellipsis"> Sa-Token </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/Shiro.html" class="md-nav__link"> <span class="md-ellipsis"> Shiro </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7"> <div class="md-nav__link md-nav__container"> <a href="../%E5%89%8D%E7%AB%AF/CSS.html" class="md-nav__link "> <span class="md-ellipsis"> ğŸŒ å‰ç«¯ </span> </a> <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7"> <span class="md-nav__icon md-icon"></span> ğŸŒ å‰ç«¯ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/JavaScript.html" class="md-nav__link"> <span class="md-ellipsis"> JavaScript </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/Vue.html" class="md-nav__link"> <span class="md-ellipsis"> Vue </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/jQuery.html" class="md-nav__link"> <span class="md-ellipsis"> jQuery </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/Thymeleaf.html" class="md-nav__link"> <span class="md-ellipsis"> Thymeleaf </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5"> <div class="md-nav__link md-nav__container"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/AntV-X6.html" class="md-nav__link "> <span class="md-ellipsis"> ç»„ä»¶åº“ </span> </a> <label class="md-nav__link " for="__nav_7_5" id="__nav_7_5_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_5"> <span class="md-nav__icon md-icon"></span> ç»„ä»¶åº“ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/ApacheECharts.html" class="md-nav__link"> <span class="md-ellipsis"> ApacheECharts </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/Axios.html" class="md-nav__link"> <span class="md-ellipsis"> Axios </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/BootstrapTable.html" class="md-nav__link"> <span class="md-ellipsis"> BootstrapTable </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/DHTMLXGantt.html" class="md-nav__link"> <span class="md-ellipsis"> DHTMLXGantt </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/Element.html" class="md-nav__link"> <span class="md-ellipsis"> Element </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/FullCalendar.html" class="md-nav__link"> <span class="md-ellipsis"> FullCalendar </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/X-editable.html" class="md-nav__link"> <span class="md-ellipsis"> X-editable </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8"> <div class="md-nav__link md-nav__container"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Dameng.html" class="md-nav__link "> <span class="md-ellipsis"> ğŸ“Š æ•°æ®åº“ </span> </a> <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_8"> <span class="md-nav__icon md-icon"></span> ğŸ“Š æ•°æ®åº“ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html" class="md-nav__link"> <span class="md-ellipsis"> MySQL </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/MySQLQuery.html" class="md-nav__link"> <span class="md-ellipsis"> MySQLQuery </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/OceanBase.html" class="md-nav__link"> <span class="md-ellipsis"> OceanBase </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle.html" class="md-nav__link"> <span class="md-ellipsis"> Oracle </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html" class="md-nav__link"> <span class="md-ellipsis"> Redis </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Vastbase.html" class="md-nav__link"> <span class="md-ellipsis"> Vastbase </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="../%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/Elasticsearch.html" class="md-nav__link"> <span class="md-ellipsis"> Elasticsearch </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10"> <div class="md-nav__link md-nav__container"> <a href="../%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/FastDFS.html" class="md-nav__link "> <span class="md-ellipsis"> ğŸ“‡ åˆ†å¸ƒå¼å­˜å‚¨ </span> </a> <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_10"> <span class="md-nav__icon md-icon"></span> ğŸ“‡ åˆ†å¸ƒå¼å­˜å‚¨ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/MinIO.html" class="md-nav__link"> <span class="md-ellipsis"> MinIO </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11"> <div class="md-nav__link md-nav__container"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/Encryption.html" class="md-nav__link "> <span class="md-ellipsis"> ğŸ›°ï¸ ç½‘ç»œé€šä¿¡ </span> </a> <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_11"> <span class="md-nav__icon md-icon"></span> ğŸ›°ï¸ ç½‘ç»œé€šä¿¡ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/HTTP.html" class="md-nav__link"> <span class="md-ellipsis"> HTTP </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/OpenVPN.html" class="md-nav__link"> <span class="md-ellipsis"> OpenVPN </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/VNC.html" class="md-nav__link"> <span class="md-ellipsis"> VNC </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/WebSocket.html" class="md-nav__link"> <span class="md-ellipsis"> WebSocket </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/frp.html" class="md-nav__link"> <span class="md-ellipsis"> frp </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12"> <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0"> <span class="md-ellipsis"> ğŸ—ƒï¸ æ–‡ä»¶å¤„ç† </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12"> <span class="md-nav__icon md-icon"></span> ğŸ—ƒï¸ æ–‡ä»¶å¤„ç† </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_1"> <div class="md-nav__link md-nav__container"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/ApachePOI.html" class="md-nav__link "> <span class="md-ellipsis"> Office </span> </a> <label class="md-nav__link " for="__nav_12_1" id="__nav_12_1_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_1_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12_1"> <span class="md-nav__icon md-icon"></span> Office </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/EasyExcel.html" class="md-nav__link"> <span class="md-ellipsis"> EasyExcel </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/OnlyOffice.html" class="md-nav__link"> <span class="md-ellipsis"> OnlyOffice </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/Poi-tl.html" class="md-nav__link"> <span class="md-ellipsis"> Poi-tl </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/Spire.OfficeForJava.html" class="md-nav__link"> <span class="md-ellipsis"> Spire.OfficeForJava </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/PDF/ApachePDFBox.html" class="md-nav__link"> <span class="md-ellipsis"> ApachePDFBox </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/XML/XMLParse.html" class="md-nav__link"> <span class="md-ellipsis"> XMLParse </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/ZIP/Zip4j.html" class="md-nav__link"> <span class="md-ellipsis"> Zip4j </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="../%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/XXL-JOB.html" class="md-nav__link"> <span class="md-ellipsis"> XXL-JOB </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14"> <div class="md-nav__link md-nav__container"> <a href="../%E8%BF%90%E7%BB%B4/Docker.html" class="md-nav__link "> <span class="md-ellipsis"> ğŸ§‘â€ğŸ”§ è¿ç»´ </span> </a> <label class="md-nav__link " for="__nav_14" id="__nav_14_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_14"> <span class="md-nav__icon md-icon"></span> ğŸ§‘â€ğŸ”§ è¿ç»´ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/Linux.html" class="md-nav__link"> <span class="md-ellipsis"> Linux </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/NSSM.html" class="md-nav__link"> <span class="md-ellipsis"> NSSM </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/Nginx.html" class="md-nav__link"> <span class="md-ellipsis"> Nginx </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/Tomcat.html" class="md-nav__link"> <span class="md-ellipsis"> Tomcat </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/TongWeb.html" class="md-nav__link"> <span class="md-ellipsis"> TongWeb </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/WSL.html" class="md-nav__link"> <span class="md-ellipsis"> WSL </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/WebLogic.html" class="md-nav__link"> <span class="md-ellipsis"> WebLogic </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15"> <div class="md-nav__link md-nav__container"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Git.html" class="md-nav__link "> <span class="md-ellipsis"> ğŸ› ï¸ å¼€å‘å·¥å…· </span> </a> <label class="md-nav__link " for="__nav_15" id="__nav_15_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_15"> <span class="md-nav__icon md-icon"></span> ğŸ› ï¸ å¼€å‘å·¥å…· </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Maven.html" class="md-nav__link"> <span class="md-ellipsis"> Maven </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Node.js.html" class="md-nav__link"> <span class="md-ellipsis"> Node.js </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Swagger.html" class="md-nav__link"> <span class="md-ellipsis"> Swagger </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16"> <div class="md-nav__link md-nav__container"> <a href="../%E5%85%B6%E4%BB%96/Settings.html" class="md-nav__link "> <span class="md-ellipsis"> ğŸ‘» å…¶ä»– </span> </a> <label class="md-nav__link " for="__nav_16" id="__nav_16_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_16"> <span class="md-nav__icon md-icon"></span> ğŸ‘» å…¶ä»– </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%85%B6%E4%BB%96/Solutions.html" class="md-nav__link"> <span class="md-ellipsis"> Solutions </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%85%B6%E4%BB%96/Weasel.html" class="md-nav__link"> <span class="md-ellipsis"> Weasel </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav class="md-nav md-nav--secondary" aria-label="ç›®å½•"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> ç›®å½• </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix> <li class="md-nav__item"> <a href="#8å¼‚å¸¸exception" class="md-nav__link"> <span class="md-ellipsis"> 8ã€å¼‚å¸¸ï¼ˆExceptionï¼‰ </span> </a> <nav class="md-nav" aria-label="8ã€å¼‚å¸¸ï¼ˆExceptionï¼‰"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#81å¼‚å¸¸å¤„ç†åŠå¸¸è§å¼‚å¸¸" class="md-nav__link"> <span class="md-ellipsis"> 8.1ã€å¼‚å¸¸å¤„ç†åŠå¸¸è§å¼‚å¸¸ </span> </a> <nav class="md-nav" aria-label="8.1ã€å¼‚å¸¸å¤„ç†åŠå¸¸è§å¼‚å¸¸"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#811å¼‚å¸¸ç®€ä»‹" class="md-nav__link"> <span class="md-ellipsis"> 8.1.1ã€å¼‚å¸¸ç®€ä»‹ </span> </a> </li> <li class="md-nav__item"> <a href="#812å¼‚å¸¸ç±»å‹" class="md-nav__link"> <span class="md-ellipsis"> 8.1.2ã€å¼‚å¸¸ç±»å‹ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#82errorexception" class="md-nav__link"> <span class="md-ellipsis"> 8.2ã€Errorã€Exception </span> </a> </li> <li class="md-nav__item"> <a href="#83å¼‚å¸¸å¤„ç†æœºåˆ¶" class="md-nav__link"> <span class="md-ellipsis"> 8.3ã€å¼‚å¸¸å¤„ç†æœºåˆ¶ </span> </a> </li> <li class="md-nav__item"> <a href="#84try-catchè¯­å¥" class="md-nav__link"> <span class="md-ellipsis"> 8.4ã€try catchè¯­å¥ </span> </a> </li> <li class="md-nav__item"> <a href="#85try-catch-finallyè¯­å¥" class="md-nav__link"> <span class="md-ellipsis"> 8.5ã€try catch finallyè¯­å¥ </span> </a> </li> <li class="md-nav__item"> <a href="#86finallyå’Œreturnæ‰§è¡Œé¡ºåº" class="md-nav__link"> <span class="md-ellipsis"> 8.6ã€finallyå’Œreturnæ‰§è¡Œé¡ºåº </span> </a> </li> <li class="md-nav__item"> <a href="#87å¢å¼ºçš„è‡ªåŠ¨èµ„æºç®¡ç†" class="md-nav__link"> <span class="md-ellipsis"> 8.7ã€å¢å¼ºçš„è‡ªåŠ¨èµ„æºç®¡ç† </span> </a> </li> <li class="md-nav__item"> <a href="#88å£°æ˜å’ŒæŠ›å‡ºå¼‚å¸¸" class="md-nav__link"> <span class="md-ellipsis"> 8.8ã€å£°æ˜å’ŒæŠ›å‡ºå¼‚å¸¸ </span> </a> <nav class="md-nav" aria-label="8.8ã€å£°æ˜å’ŒæŠ›å‡ºå¼‚å¸¸"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#881throws-å£°æ˜å¼‚å¸¸" class="md-nav__link"> <span class="md-ellipsis"> 8.8.1ã€throws å£°æ˜å¼‚å¸¸ </span> </a> </li> <li class="md-nav__item"> <a href="#882throw-æ‹‹å‡ºå¼‚å¸¸" class="md-nav__link"> <span class="md-ellipsis"> 8.8.2ã€throw æ‹‹å‡ºå¼‚å¸¸ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#89å¤šå¼‚å¸¸æ•è·" class="md-nav__link"> <span class="md-ellipsis"> 8.9ã€å¤šå¼‚å¸¸æ•è· </span> </a> </li> <li class="md-nav__item"> <a href="#810è‡ªå®šä¹‰å¼‚å¸¸" class="md-nav__link"> <span class="md-ellipsis"> 8.10ã€è‡ªå®šä¹‰å¼‚å¸¸ </span> </a> </li> <li class="md-nav__item"> <a href="#811å¼‚å¸¸å¤„ç†è§„åˆ™" class="md-nav__link"> <span class="md-ellipsis"> 8.11ã€å¼‚å¸¸å¤„ç†è§„åˆ™ </span> </a> </li> <li class="md-nav__item"> <a href="#812å¼‚å¸¸è·Ÿè¸ªæ ˆ" class="md-nav__link"> <span class="md-ellipsis"> 8.12ã€å¼‚å¸¸è·Ÿè¸ªæ ˆ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#10å¤šçº¿ç¨‹" class="md-nav__link"> <span class="md-ellipsis"> 10ã€å¤šçº¿ç¨‹ </span> </a> <nav class="md-nav" aria-label="10ã€å¤šçº¿ç¨‹"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#101çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ" class="md-nav__link"> <span class="md-ellipsis"> 10.1ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ </span> </a> </li> <li class="md-nav__item"> <a href="#102çº¿ç¨‹çš„ä¼˜å…ˆçº§" class="md-nav__link"> <span class="md-ellipsis"> 10.2ã€çº¿ç¨‹çš„ä¼˜å…ˆçº§ </span> </a> </li> <li class="md-nav__item"> <a href="#103åˆ›å»ºä¸€ä¸ªçº¿ç¨‹" class="md-nav__link"> <span class="md-ellipsis"> 10.3ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ </span> </a> <nav class="md-nav" aria-label="10.3ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1031å®ç°runnable" class="md-nav__link"> <span class="md-ellipsis"> 10.3.1ã€å®ç°Runnable </span> </a> </li> <li class="md-nav__item"> <a href="#1032ç»§æ‰¿thread" class="md-nav__link"> <span class="md-ellipsis"> 10.3.2ã€ç»§æ‰¿Thread </span> </a> </li> <li class="md-nav__item"> <a href="#1033é€šè¿‡-callablefuture" class="md-nav__link"> <span class="md-ellipsis"> 10.3.3ã€é€šè¿‡ Callableã€Future </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#104thread-æ–¹æ³•" class="md-nav__link"> <span class="md-ellipsis"> 10.4ã€Thread æ–¹æ³• </span> </a> </li> <li class="md-nav__item"> <a href="#105çƒ§æ°´æ³¡èŒ¶" class="md-nav__link"> <span class="md-ellipsis"> 10.5ã€çƒ§æ°´æ³¡èŒ¶ </span> </a> </li> <li class="md-nav__item"> <a href="#106joinyieldinterrupt" class="md-nav__link"> <span class="md-ellipsis"> 10.6ã€join()ã€yield()ã€interrupt() </span> </a> <nav class="md-nav" aria-label="10.6ã€join()ã€yield()ã€interrupt()"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1061join" class="md-nav__link"> <span class="md-ellipsis"> 10.6.1ã€join() </span> </a> </li> <li class="md-nav__item"> <a href="#1062yield" class="md-nav__link"> <span class="md-ellipsis"> 10.6.2ã€yield() </span> </a> </li> <li class="md-nav__item"> <a href="#1063interrupt" class="md-nav__link"> <span class="md-ellipsis"> 10.6.3ã€interrupt() </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#107synchronized" class="md-nav__link"> <span class="md-ellipsis"> 10.7ã€synchronized </span> </a> <nav class="md-nav" aria-label="10.7ã€synchronized"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1171ä¿®é¥°å®ä¾‹æ–¹æ³•" class="md-nav__link"> <span class="md-ellipsis"> 11.7.1ã€ä¿®é¥°å®ä¾‹æ–¹æ³• </span> </a> </li> <li class="md-nav__item"> <a href="#1172ä¿®é¥°é™æ€æ–¹æ³•" class="md-nav__link"> <span class="md-ellipsis"> 11.7.2ã€ä¿®é¥°é™æ€æ–¹æ³• </span> </a> </li> <li class="md-nav__item"> <a href="#1173ä¿®é¥°ä»£ç å—" class="md-nav__link"> <span class="md-ellipsis"> 11.7.3ã€ä¿®é¥°ä»£ç å— </span> </a> </li> <li class="md-nav__item"> <a href="#1174åº•å±‚åŸç†" class="md-nav__link"> <span class="md-ellipsis"> 11.7.4ã€åº•å±‚åŸç† </span> </a> </li> <li class="md-nav__item"> <a href="#1175é”å‡çº§" class="md-nav__link"> <span class="md-ellipsis"> 11.7.5ã€é”å‡çº§ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#108sleepwaitnotifynotifyall" class="md-nav__link"> <span class="md-ellipsis"> 10.8ã€sleepã€waitã€notifyã€notifyAll </span> </a> </li> <li class="md-nav__item"> <a href="#109bionioaio" class="md-nav__link"> <span class="md-ellipsis"> 10.9ã€BIOã€NIOã€AIO </span> </a> <nav class="md-nav" aria-label="10.9ã€BIOã€NIOã€AIO"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1091bio-blocking-io" class="md-nav__link"> <span class="md-ellipsis"> 10.9.1ã€BIO (Blocking I/O) </span> </a> </li> <li class="md-nav__item"> <a href="#1092nio-new-io" class="md-nav__link"> <span class="md-ellipsis"> 10.9.2ã€NIO (New I/O) </span> </a> </li> <li class="md-nav__item"> <a href="#1093aio-asynchronous-io" class="md-nav__link"> <span class="md-ellipsis"> 10.9.3ã€AIO (Asynchronous I/O) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#1010executorservice" class="md-nav__link"> <span class="md-ellipsis"> 10.10ã€ExecutorService </span> </a> <nav class="md-nav" aria-label="10.10ã€ExecutorService"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#10101å†…ç½®çº¿ç¨‹æ± " class="md-nav__link"> <span class="md-ellipsis"> 10.10.1ã€å†…ç½®çº¿ç¨‹æ±  </span> </a> </li> <li class="md-nav__item"> <a href="#10102threadpoolexecutor" class="md-nav__link"> <span class="md-ellipsis"> 10.10.2ã€ThreadPoolExecutor </span> </a> </li> <li class="md-nav__item"> <a href="#10103executorservice" class="md-nav__link"> <span class="md-ellipsis"> 10.10.3ã€ExecutorService </span> </a> </li> <li class="md-nav__item"> <a href="#10104çº¿ç¨‹æ± çš„çŠ¶æ€" class="md-nav__link"> <span class="md-ellipsis"> 10.10.4ã€çº¿ç¨‹æ± çš„çŠ¶æ€ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#1011çº¿ç¨‹å®‰å…¨" class="md-nav__link"> <span class="md-ellipsis"> 10.11ã€çº¿ç¨‹å®‰å…¨ </span> </a> <nav class="md-nav" aria-label="10.11ã€çº¿ç¨‹å®‰å…¨"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#10111å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ" class="md-nav__link"> <span class="md-ellipsis"> 10.11.1ã€å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ </span> </a> </li> <li class="md-nav__item"> <a href="#10112å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ" class="md-nav__link"> <span class="md-ellipsis"> 10.11.2ã€å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ </span> </a> </li> <li class="md-nav__item"> <a href="#10113javaå†…å­˜æ¨¡å‹" class="md-nav__link"> <span class="md-ellipsis"> 10.11.3ã€Javaå†…å­˜æ¨¡å‹ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#1012æ­»é”" class="md-nav__link"> <span class="md-ellipsis"> 10.12ã€æ­»é” </span> </a> </li> <li class="md-nav__item"> <a href="#1013threadlocal" class="md-nav__link"> <span class="md-ellipsis"> 10.13ã€ThreadLocal </span> </a> </li> <li class="md-nav__item"> <a href="#1014volatile" class="md-nav__link"> <span class="md-ellipsis"> 10.14ã€volatile </span> </a> </li> <li class="md-nav__item"> <a href="#1015lock" class="md-nav__link"> <span class="md-ellipsis"> 10.15ã€Lock </span> </a> <nav class="md-nav" aria-label="10.15ã€Lock"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#10151ä¸ºä»€ä¹ˆä½¿ç”¨-lock" class="md-nav__link"> <span class="md-ellipsis"> 10.15.1ã€ä¸ºä»€ä¹ˆä½¿ç”¨ Lockï¼Ÿ </span> </a> </li> <li class="md-nav__item"> <a href="#10152lock-æ¥å£å®ç°ç±»" class="md-nav__link"> <span class="md-ellipsis"> 10.15.2ã€Lock æ¥å£å®ç°ç±» </span> </a> </li> <li class="md-nav__item"> <a href="#10153reentrantlock" class="md-nav__link"> <span class="md-ellipsis"> 10.15.3ã€ReentrantLock </span> </a> </li> <li class="md-nav__item"> <a href="#10154readwritelock" class="md-nav__link"> <span class="md-ellipsis"> 10.15.4ã€ReadWriteLock </span> </a> </li> <li class="md-nav__item"> <a href="#10155é”çš„ç›¸å…³æ¦‚å¿µä»‹ç»" class="md-nav__link"> <span class="md-ellipsis"> 10.15.5ã€é”çš„ç›¸å…³æ¦‚å¿µä»‹ç» </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#1016atomic" class="md-nav__link"> <span class="md-ellipsis"> 10.16ã€Atomic </span> </a> <nav class="md-nav" aria-label="10.16ã€Atomic"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#10161ä¼ ç»Ÿé”çš„é—®é¢˜" class="md-nav__link"> <span class="md-ellipsis"> 10.16.1ã€ä¼ ç»Ÿé”çš„é—®é¢˜ </span> </a> </li> <li class="md-nav__item"> <a href="#10162cas" class="md-nav__link"> <span class="md-ellipsis"> 10.16.2ã€CAS </span> </a> </li> <li class="md-nav__item"> <a href="#10163atomic-ç±»" class="md-nav__link"> <span class="md-ellipsis"> 10.16.3ã€Atomic ç±» </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#11åå°„æœºåˆ¶" class="md-nav__link"> <span class="md-ellipsis"> 11ã€åå°„æœºåˆ¶ </span> </a> <nav class="md-nav" aria-label="11ã€åå°„æœºåˆ¶"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#111åå°„æœºåˆ¶çš„åŸºæœ¬æ¦‚å¿µ" class="md-nav__link"> <span class="md-ellipsis"> 11.1ã€åå°„æœºåˆ¶çš„åŸºæœ¬æ¦‚å¿µ </span> </a> </li> <li class="md-nav__item"> <a href="#112åå°„æœºåˆ¶api" class="md-nav__link"> <span class="md-ellipsis"> 11.2ã€åå°„æœºåˆ¶API </span> </a> <nav class="md-nav" aria-label="11.2ã€åå°„æœºåˆ¶API"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1121javalangclass-ç±»" class="md-nav__link"> <span class="md-ellipsis"> 11.2.1ã€java.lang.Class ç±» </span> </a> </li> <li class="md-nav__item"> <a href="#1122javalangreflect-åŒ…" class="md-nav__link"> <span class="md-ellipsis"> 11.2.2ã€java.lang.reflect åŒ… </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#113é€šè¿‡åå°„è®¿é—®æ„é€ æ–¹æ³•" class="md-nav__link"> <span class="md-ellipsis"> 11.3ã€é€šè¿‡åå°„è®¿é—®æ„é€ æ–¹æ³• </span> </a> </li> <li class="md-nav__item"> <a href="#114é€šè¿‡åå°„æ‰§è¡Œæ–¹æ³•" class="md-nav__link"> <span class="md-ellipsis"> 11.4ã€é€šè¿‡åå°„æ‰§è¡Œæ–¹æ³• </span> </a> </li> <li class="md-nav__item"> <a href="#115é€šè¿‡åå°„è®¿é—®æˆå‘˜å˜é‡" class="md-nav__link"> <span class="md-ellipsis"> 11.5ã€é€šè¿‡åå°„è®¿é—®æˆå‘˜å˜é‡ </span> </a> </li> <li class="md-nav__item"> <a href="#116é€šè¿‡åå°„æ“ä½œæ³›å‹" class="md-nav__link"> <span class="md-ellipsis"> 11.6ã€é€šè¿‡åå°„æ“ä½œæ³›å‹ </span> </a> <nav class="md-nav" aria-label="11.6ã€é€šè¿‡åå°„æ“ä½œæ³›å‹"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1161æ³›å‹å’Œ-class-ç±»" class="md-nav__link"> <span class="md-ellipsis"> 11.6.1ã€æ³›å‹å’Œ Class ç±» </span> </a> </li> <li class="md-nav__item"> <a href="#1162ä½¿ç”¨åå°„æ¥è·å–æ³›å‹ä¿¡æ¯" class="md-nav__link"> <span class="md-ellipsis"> 11.6.2ã€ä½¿ç”¨åå°„æ¥è·å–æ³›å‹ä¿¡æ¯ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#12è¾“å…¥è¾“å‡ºioæµ" class="md-nav__link"> <span class="md-ellipsis"> 12ã€è¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰æµ </span> </a> <nav class="md-nav" aria-label="12ã€è¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰æµ"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#121æµçš„æ¦‚å¿µ" class="md-nav__link"> <span class="md-ellipsis"> 12.1ã€æµçš„æ¦‚å¿µ </span> </a> <nav class="md-nav" aria-label="12.1ã€æµçš„æ¦‚å¿µ"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1211ä»€ä¹ˆæ˜¯è¾“å…¥è¾“å‡ºæµ" class="md-nav__link"> <span class="md-ellipsis"> 12.1.1ã€ä»€ä¹ˆæ˜¯è¾“å…¥/è¾“å‡ºæµ </span> </a> </li> <li class="md-nav__item"> <a href="#1212è¾“å…¥æµ" class="md-nav__link"> <span class="md-ellipsis"> 12.1.2ã€è¾“å…¥æµ </span> </a> </li> <li class="md-nav__item"> <a href="#1213è¾“å‡ºæµ" class="md-nav__link"> <span class="md-ellipsis"> 12.1.3ã€è¾“å‡ºæµ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#122ç³»ç»Ÿæµ" class="md-nav__link"> <span class="md-ellipsis"> 12.2ã€ç³»ç»Ÿæµ </span> </a> </li> <li class="md-nav__item"> <a href="#123å­—ç¬¦ç¼–ç ä»‹ç»" class="md-nav__link"> <span class="md-ellipsis"> 12.3ã€å­—ç¬¦ç¼–ç ä»‹ç» </span> </a> </li> <li class="md-nav__item"> <a href="#124fileç±»" class="md-nav__link"> <span class="md-ellipsis"> 12.4ã€Fileç±» </span> </a> </li> <li class="md-nav__item"> <a href="#125éå†ç›®å½•" class="md-nav__link"> <span class="md-ellipsis"> 12.5ã€éå†ç›®å½• </span> </a> </li> <li class="md-nav__item"> <a href="#126å­—èŠ‚æµçš„ä½¿ç”¨" class="md-nav__link"> <span class="md-ellipsis"> 12.6ã€å­—èŠ‚æµçš„ä½¿ç”¨ </span> </a> <nav class="md-nav" aria-label="12.6ã€å­—èŠ‚æµçš„ä½¿ç”¨"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1261å­—èŠ‚è¾“å…¥æµ" class="md-nav__link"> <span class="md-ellipsis"> 12.6.1ã€å­—èŠ‚è¾“å…¥æµ </span> </a> </li> <li class="md-nav__item"> <a href="#1262å­—èŠ‚è¾“å‡ºæµ" class="md-nav__link"> <span class="md-ellipsis"> 12.6.2ã€å­—èŠ‚è¾“å‡ºæµ </span> </a> </li> <li class="md-nav__item"> <a href="#1263æ–‡ä»¶è¾“å…¥æµ" class="md-nav__link"> <span class="md-ellipsis"> 12.6.3ã€æ–‡ä»¶è¾“å…¥æµ </span> </a> </li> <li class="md-nav__item"> <a href="#1264æ–‡ä»¶è¾“å‡ºæµ" class="md-nav__link"> <span class="md-ellipsis"> 12.6.4ã€æ–‡ä»¶è¾“å‡ºæµ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#127å­—ç¬¦æµçš„ä½¿ç”¨" class="md-nav__link"> <span class="md-ellipsis"> 12.7ã€å­—ç¬¦æµçš„ä½¿ç”¨ </span> </a> <nav class="md-nav" aria-label="12.7ã€å­—ç¬¦æµçš„ä½¿ç”¨"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1271å­—ç¬¦è¾“å…¥æµ" class="md-nav__link"> <span class="md-ellipsis"> 12.7.1ã€å­—ç¬¦è¾“å…¥æµ </span> </a> </li> <li class="md-nav__item"> <a href="#1272å­—ç¬¦è¾“å‡ºæµ" class="md-nav__link"> <span class="md-ellipsis"> 12.7.2ã€å­—ç¬¦è¾“å‡ºæµ </span> </a> </li> <li class="md-nav__item"> <a href="#1273å­—ç¬¦æ–‡ä»¶è¾“å…¥æµ" class="md-nav__link"> <span class="md-ellipsis"> 12.7.3ã€å­—ç¬¦æ–‡ä»¶è¾“å…¥æµ </span> </a> </li> <li class="md-nav__item"> <a href="#1274å­—ç¬¦æ–‡ä»¶è¾“å‡ºæµ" class="md-nav__link"> <span class="md-ellipsis"> 12.7.4ã€å­—ç¬¦æ–‡ä»¶è¾“å‡ºæµ </span> </a> </li> <li class="md-nav__item"> <a href="#1275å­—ç¬¦ç¼“å†²åŒºè¾“å…¥æµ" class="md-nav__link"> <span class="md-ellipsis"> 12.7.5ã€å­—ç¬¦ç¼“å†²åŒºè¾“å…¥æµ </span> </a> </li> <li class="md-nav__item"> <a href="#1276å­—ç¬¦ç¼“å†²åŒºè¾“å‡ºæµ" class="md-nav__link"> <span class="md-ellipsis"> 12.7.6ã€å­—ç¬¦ç¼“å†²åŒºè¾“å‡ºæµ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#128è½¬æ¢æµ" class="md-nav__link"> <span class="md-ellipsis"> 12.8ã€è½¬æ¢æµ </span> </a> </li> <li class="md-nav__item"> <a href="#129å¯¹è±¡åºåˆ—åŒ–è¾“å…¥è¾“å‡º" class="md-nav__link"> <span class="md-ellipsis"> 12.9ã€å¯¹è±¡åºåˆ—åŒ–è¾“å…¥è¾“å‡º </span> </a> <nav class="md-nav" aria-label="12.9ã€å¯¹è±¡åºåˆ—åŒ–è¾“å…¥è¾“å‡º"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1291åºåˆ—åŒ–" class="md-nav__link"> <span class="md-ellipsis"> 12.9.1ã€åºåˆ—åŒ– </span> </a> </li> <li class="md-nav__item"> <a href="#1292ååºåˆ—åŒ–" class="md-nav__link"> <span class="md-ellipsis"> 12.9.2ã€ååºåˆ—åŒ– </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#1210propertiesæ–‡ä»¶è§£æ" class="md-nav__link"> <span class="md-ellipsis"> 12.10ã€Propertiesæ–‡ä»¶è§£æ </span> </a> <nav class="md-nav" aria-label="12.10ã€Propertiesæ–‡ä»¶è§£æ"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#12101ä½¿ç”¨classgetresourceasstreamfileè·å–propertiesæ–‡ä»¶" class="md-nav__link"> <span class="md-ellipsis"> 12.10.1ã€ä½¿ç”¨class.getResourceAsStream(file)è·å–propertiesæ–‡ä»¶ </span> </a> </li> <li class="md-nav__item"> <a href="#12102classgetclassloadergetresourceasstreamfileå’ŒclassgetresourceasstreamfileåŒºåˆ«" class="md-nav__link"> <span class="md-ellipsis"> 12.10.2ã€class.getClassLoader().getResourceAsStream(file)å’Œclass.getResourceAsStream(file)åŒºåˆ« </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#1211ä½¿ç”¨printf-æ ¼å¼åŒ–è¾“å‡º" class="md-nav__link"> <span class="md-ellipsis"> 12.11ã€ä½¿ç”¨printf æ ¼å¼åŒ–è¾“å‡º </span> </a> </li> <li class="md-nav__item"> <a href="#1212å†…å­˜æµ" class="md-nav__link"> <span class="md-ellipsis"> 12.12ã€å†…å­˜æµ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#13ç½‘ç»œç¼–ç¨‹" class="md-nav__link"> <span class="md-ellipsis"> 13ã€ç½‘ç»œç¼–ç¨‹ </span> </a> <nav class="md-nav" aria-label="13ã€ç½‘ç»œç¼–ç¨‹"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#131ç½‘ç»œä½“ç³»ç»“æ„" class="md-nav__link"> <span class="md-ellipsis"> 13.1ã€ç½‘ç»œä½“ç³»ç»“æ„ </span> </a> <nav class="md-nav" aria-label="13.1ã€ç½‘ç»œä½“ç³»ç»“æ„"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1311osi-å‚è€ƒæ¨¡å‹" class="md-nav__link"> <span class="md-ellipsis"> 13.1.1ã€OSI å‚è€ƒæ¨¡å‹ </span> </a> </li> <li class="md-nav__item"> <a href="#1312tcpipå‚è€ƒæ¨¡å‹" class="md-nav__link"> <span class="md-ellipsis"> 13.1.2ã€TCP/IPå‚è€ƒæ¨¡å‹ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#132ç½‘ç»œåè®®" class="md-nav__link"> <span class="md-ellipsis"> 13.2ã€ç½‘ç»œåè®® </span> </a> <nav class="md-nav" aria-label="13.2ã€ç½‘ç»œåè®®"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1321ipåè®®" class="md-nav__link"> <span class="md-ellipsis"> 13.2.1ã€IPåè®® </span> </a> </li> <li class="md-nav__item"> <a href="#1322tcpåè®®" class="md-nav__link"> <span class="md-ellipsis"> 13.2.2ã€TCPåè®® </span> </a> <nav class="md-nav" aria-label="13.2.2ã€TCPåè®®"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#tcpçš„æŠ¥æ–‡æ ¼å¼" class="md-nav__link"> <span class="md-ellipsis"> TCPçš„æŠ¥æ–‡æ ¼å¼ </span> </a> </li> <li class="md-nav__item"> <a href="#ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹" class="md-nav__link"> <span class="md-ellipsis"> ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹ </span> </a> </li> <li class="md-nav__item"> <a href="#tcpç²˜åŒ…" class="md-nav__link"> <span class="md-ellipsis"> TCPç²˜åŒ… </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#1323udpåè®®" class="md-nav__link"> <span class="md-ellipsis"> 13.2.3ã€UDPåè®® </span> </a> </li> <li class="md-nav__item"> <a href="#1324httpåè®®" class="md-nav__link"> <span class="md-ellipsis"> 13.2.4ã€HTTPåè®® </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#133socket" class="md-nav__link"> <span class="md-ellipsis"> 13.3ã€Socket </span> </a> <nav class="md-nav" aria-label="13.3ã€Socket"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1331socketæ¦‚è¿°" class="md-nav__link"> <span class="md-ellipsis"> 13.3.1ã€Socketæ¦‚è¿° </span> </a> </li> <li class="md-nav__item"> <a href="#1332å¥—æ¥å­—æœ‰å“ªäº›ç±»å‹" class="md-nav__link"> <span class="md-ellipsis"> 13.3.2ã€å¥—æ¥å­—æœ‰å“ªäº›ç±»å‹ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#134tcpip-é€šè®¯çš„å®ç°" class="md-nav__link"> <span class="md-ellipsis"> 13.4ã€TCP/IP é€šè®¯çš„å®ç° </span> </a> <nav class="md-nav" aria-label="13.4ã€TCP/IP é€šè®¯çš„å®ç°"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1341serversocketç±»" class="md-nav__link"> <span class="md-ellipsis"> 13.4.1ã€ServerSocketç±» </span> </a> </li> <li class="md-nav__item"> <a href="#1342socketç±»" class="md-nav__link"> <span class="md-ellipsis"> 13.4.2ã€Socketç±» </span> </a> </li> <li class="md-nav__item"> <a href="#1343inetaddressç±»" class="md-nav__link"> <span class="md-ellipsis"> 13.4.3ã€InetAddressç±» </span> </a> </li> <li class="md-nav__item"> <a href="#1344å®ç°èŠå¤©å®¤èŠå¤©" class="md-nav__link"> <span class="md-ellipsis"> 13.4.4ã€å®ç°èŠå¤©å®¤èŠå¤© </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#135udp-é€šè®¯çš„å®ç°" class="md-nav__link"> <span class="md-ellipsis"> 13.5ã€UDP é€šè®¯çš„å®ç° </span> </a> <nav class="md-nav" aria-label="13.5ã€UDP é€šè®¯çš„å®ç°"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1351datagramsocke" class="md-nav__link"> <span class="md-ellipsis"> 13.5.1ã€DatagramSocke </span> </a> </li> <li class="md-nav__item"> <a href="#1352datagrampacket" class="md-nav__link"> <span class="md-ellipsis"> 13.5.2ã€DatagramPacket </span> </a> </li> <li class="md-nav__item"> <a href="#1353å®ç°èŠå¤©å®¤èŠå¤©" class="md-nav__link"> <span class="md-ellipsis"> 13.5.3ã€å®ç°èŠå¤©å®¤èŠå¤© </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#136åŸºäº-http-åè®®ç¼–ç¨‹" class="md-nav__link"> <span class="md-ellipsis"> 13.6ã€åŸºäº HTTP åè®®ç¼–ç¨‹ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#15æ³¨è§£annotation" class="md-nav__link"> <span class="md-ellipsis"> 15ã€æ³¨è§£ï¼ˆAnnotationï¼‰ </span> </a> <nav class="md-nav" aria-label="15ã€æ³¨è§£ï¼ˆAnnotationï¼‰"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#151æ³¨è§£ç®€ä»‹" class="md-nav__link"> <span class="md-ellipsis"> 15.1ã€æ³¨è§£ç®€ä»‹ </span> </a> </li> <li class="md-nav__item"> <a href="#152å…ƒæ³¨è§£" class="md-nav__link"> <span class="md-ellipsis"> 15.2ã€å…ƒæ³¨è§£ </span> </a> </li> <li class="md-nav__item"> <a href="#153æ³¨è§£çš„å±æ€§" class="md-nav__link"> <span class="md-ellipsis"> 15.3ã€æ³¨è§£çš„å±æ€§ </span> </a> </li> <li class="md-nav__item"> <a href="#154java-é¢„ç½®çš„æ³¨è§£" class="md-nav__link"> <span class="md-ellipsis"> 15.4ã€Java é¢„ç½®çš„æ³¨è§£ </span> </a> </li> <li class="md-nav__item"> <a href="#155æ³¨è§£çš„æå–" class="md-nav__link"> <span class="md-ellipsis"> 15.5ã€æ³¨è§£çš„æå– </span> </a> </li> <li class="md-nav__item"> <a href="#156è‡ªå®šä¹‰æ³¨è§£" class="md-nav__link"> <span class="md-ellipsis"> 15.6ã€è‡ªå®šä¹‰æ³¨è§£ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1 id="java">Java<a class="headerlink" href="#java" title="é”šç‚¹é“¾æ¥">Â¶</a></h1> <h2 id="8å¼‚å¸¸exception">8ã€å¼‚å¸¸ï¼ˆExceptionï¼‰<a class="headerlink" href="#8å¼‚å¸¸exception" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>åœ¨ç¨‹åºè®¾è®¡å’Œè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç”Ÿé”™è¯¯æ˜¯ä¸å¯é¿å…çš„ã€‚å°½ç®¡ Java è¯­è¨€çš„è®¾è®¡ä»æ ¹æœ¬ä¸Šæä¾›äº†ä¾¿äºå†™å‡ºæ•´æ´ã€å®‰å…¨ä»£ç çš„æ–¹æ³•ï¼Œå¹¶ä¸”ç¨‹åºå‘˜ä¹Ÿå°½é‡åœ°å‡å°‘é”™è¯¯çš„äº§ç”Ÿï¼Œä½†æ˜¯ä½¿ç¨‹åºè¢«è¿«åœæ­¢çš„é”™è¯¯çš„å­˜åœ¨ä»ç„¶ä¸å¯é¿å…ã€‚ä¸ºæ­¤ï¼ŒJava æä¾›äº†å¼‚å¸¸å¤„ç†æœºåˆ¶æ¥å¸®åŠ©ç¨‹åºå‘˜æ£€æŸ¥å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œä»¥ä¿è¯ç¨‹åºçš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p> <p>Java å°†å¼‚å¸¸å°è£…åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå‡ºç°é”™è¯¯æ—¶å°±ä¼šæ‹‹å‡ºå¼‚å¸¸ã€‚</p> <h3 id="81å¼‚å¸¸å¤„ç†åŠå¸¸è§å¼‚å¸¸">8.1ã€å¼‚å¸¸å¤„ç†åŠå¸¸è§å¼‚å¸¸<a class="headerlink" href="#81å¼‚å¸¸å¤„ç†åŠå¸¸è§å¼‚å¸¸" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å¾ˆå¤šäº‹ä»¶å¹¶éæ€»æ˜¯æŒ‰ç…§äººä»¬è‡ªå·±è®¾è®¡æ„æ„¿é¡ºåˆ©å‘å±•çš„ï¼Œç»å¸¸å‡ºç°è¿™æ ·é‚£æ ·çš„å¼‚å¸¸æƒ…å†µã€‚ä¾‹å¦‚ï¼š ä½ è®¡åˆ’å‘¨æœ«éƒŠæ¸¸ï¼Œè®¡åˆ’ä»å®¶é‡Œå‡ºå‘â†’åˆ°è¾¾ç›®çš„â†’æ¸¸æ³³â†’çƒ§çƒ¤â†’å›å®¶ã€‚ä½†å¤©æœ‰ä¸æµ‹é£äº‘ï¼Œå½“ä½ å‡†å¤‡çƒ§çƒ¤æ—¶å€™çªç„¶å¤©é™å¤§é›¨ï¼Œåªèƒ½ç»ˆæ­¢éƒŠæ¸¸æå‰å›å®¶ã€‚â€œå¤©é™å¤§é›¨â€æ˜¯ä¸€ç§å¼‚å¸¸æƒ…å†µï¼Œä½ çš„è®¡åˆ’åº”è¯¥è€ƒè™‘åˆ°è¿™æ ·çš„æƒ…å†µï¼Œå¹¶ä¸”åº”è¯¥æœ‰å¤„ç†è¿™ç§å¼‚å¸¸çš„é¢„æ¡ˆã€‚</p> <p>è®¡ç®—æœºç¨‹åºçš„ç¼–å†™ä¹Ÿéœ€è¦è€ƒè™‘å¤„ç†è¿™äº›å¼‚å¸¸æƒ…å†µã€‚==å¼‚å¸¸ï¼ˆexceptionï¼‰æ˜¯åœ¨è¿è¡Œç¨‹åºæ—¶äº§ç”Ÿçš„ä¸€ç§å¼‚å¸¸æƒ…å†µï¼Œ==å·²ç»æˆä¸ºäº†è¡¡é‡ä¸€é—¨è¯­è¨€æ˜¯å¦æˆç†Ÿçš„æ ‡å‡†ä¹‹ä¸€ã€‚ç›®å‰çš„ä¸»æµç¼–ç¨‹è¯­è¨€ï¼Œå¦‚ C++ã€c#ã€Ruby å’Œ Python ç­‰å¤§éƒ½æä¾›äº†å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚</p> <h4 id="811å¼‚å¸¸ç®€ä»‹">8.1.1ã€å¼‚å¸¸ç®€ä»‹<a class="headerlink" href="#811å¼‚å¸¸ç®€ä»‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>==Java ä¸­çš„å¼‚å¸¸åˆç§°ä¸ºä¾‹å¤–ï¼Œæ˜¯ä¸€ä¸ªåœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´å‘ç”Ÿçš„äº‹ä»¶ï¼Œå®ƒä¸­æ–­æ­£åœ¨æ‰§è¡Œç¨‹åºçš„æ­£å¸¸æŒ‡ä»¤æµã€‚==ä¸ºäº†èƒ½å¤ŸåŠæ—¶æœ‰æ•ˆåœ°å¤„ç†ç¨‹åºä¸­çš„è¿è¡Œé”™è¯¯ï¼Œå¿…é¡»ä½¿ç”¨å¼‚å¸¸ç±»ï¼Œè¿™å¯ä»¥è®©ç¨‹åºå…·æœ‰æå¥½çš„å®¹é”™æ€§ä¸”æ›´åŠ å¥å£®ã€‚ </p> <p>åœ¨ Java ä¸­ä¸€ä¸ªå¼‚å¸¸çš„äº§ç”Ÿï¼Œä¸»è¦æœ‰å¦‚ä¸‹ä¸‰ç§åŸå› ï¼š</p> <ol> <li>Java å†…éƒ¨é”™è¯¯å‘ç”Ÿå¼‚å¸¸ï¼ŒJava è™šæ‹Ÿæœºäº§ç”Ÿçš„å¼‚å¸¸ã€‚</li> <li>ç¼–å†™çš„ç¨‹åºä»£ç ä¸­çš„é”™è¯¯æ‰€äº§ç”Ÿçš„å¼‚å¸¸ï¼Œä¾‹å¦‚ç©ºæŒ‡é’ˆå¼‚å¸¸ã€æ•°ç»„è¶Šç•Œå¼‚å¸¸ç­‰ã€‚</li> <li>é€šè¿‡ throw è¯­å¥æ‰‹åŠ¨ç”Ÿæˆçš„å¼‚å¸¸ï¼Œä¸€èˆ¬ç”¨æ¥å‘ŠçŸ¥è¯¥æ–¹æ³•çš„è°ƒç”¨è€…ä¸€äº›å¿…è¦ä¿¡æ¯ã€‚</li> </ol> <p>Java é€šè¿‡é¢å‘å¯¹è±¡çš„æ–¹æ³•æ¥å¤„ç†å¼‚å¸¸ã€‚åœ¨ä¸€ä¸ªæ–¹æ³•çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç”Ÿäº†å¼‚å¸¸ï¼Œåˆ™è¿™ä¸ªæ–¹æ³•ä¼šäº§ç”Ÿä»£è¡¨è¯¥å¼‚å¸¸çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶æŠŠå®ƒäº¤ç»™è¿è¡Œæ—¶çš„ç³»ç»Ÿï¼Œè¿è¡Œæ—¶ç³»ç»Ÿå¯»æ‰¾ç›¸åº”çš„ä»£ç æ¥å¤„ç†è¿™ä¸€å¼‚å¸¸ã€‚</p> <p>æˆ‘ä»¬æŠŠç”Ÿæˆå¼‚å¸¸å¯¹è±¡ï¼Œå¹¶æŠŠå®ƒæäº¤ç»™è¿è¡Œæ—¶ç³»ç»Ÿçš„è¿‡ç¨‹ç§°ä¸º==æ‹‹å‡ºï¼ˆthrowï¼‰å¼‚å¸¸ã€‚<mark>è¿è¡Œæ—¶ç³»ç»Ÿåœ¨æ–¹æ³•çš„è°ƒç”¨æ ˆä¸­æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°èƒ½å¤Ÿå¤„ç†è¯¥ç±»å‹å¼‚å¸¸çš„å¯¹è±¡ï¼Œè¿™ä¸€ä¸ªè¿‡ç¨‹ç§°ä¸º==æ•è·ï¼ˆcatchï¼‰å¼‚å¸¸ã€‚</mark></p> <h4 id="812å¼‚å¸¸ç±»å‹">8.1.2ã€å¼‚å¸¸ç±»å‹<a class="headerlink" href="#812å¼‚å¸¸ç±»å‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>ä¸ºäº†èƒ½å¤ŸåŠæ—¶æœ‰æ•ˆåœ°å¤„ç†ç¨‹åºä¸­çš„è¿è¡Œé”™è¯¯ï¼ŒJava ä¸“é—¨å¼•å…¥äº†å¼‚å¸¸ç±»ã€‚==åœ¨ Java ä¸­æ‰€æœ‰å¼‚å¸¸ç±»å‹éƒ½æ˜¯å†…ç½®ç±» java.lang.Throwable ç±»çš„å­ç±»ï¼Œå³ Throwable ä½äºå¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„çš„é¡¶å±‚ã€‚==Throwable ç±»ä¸‹æœ‰ä¸¤ä¸ªå¼‚å¸¸åˆ†æ”¯ Exception å’Œ Errorï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/3-1Q0231H424V1.jpg" data-desc-position="bottom"><img src="!assets/Java/3-1Q0231H424V1.jpg" alt="img" style="zoom:80%;"></a></p> <p><mark>Throwable ç±»æ˜¯æ‰€æœ‰å¼‚å¸¸å’Œé”™è¯¯çš„è¶…ç±»ï¼Œä¸‹é¢æœ‰ Error å’Œ Exception ä¸¤ä¸ªå­ç±»åˆ†åˆ«è¡¨ç¤ºé”™è¯¯å’Œå¼‚å¸¸ã€‚==å…¶ä¸­å¼‚å¸¸ç±» Exception åˆåˆ†ä¸º==è¿è¡Œæ—¶å¼‚å¸¸==å’Œ==éè¿è¡Œæ—¶å¼‚å¸¸ï¼Œ==è¿™ä¸¤ç§å¼‚å¸¸æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œä¹Ÿç§°ä¸º==ä¸æ£€æŸ¥å¼‚å¸¸ï¼ˆUnchecked Exceptionï¼‰==å’Œ==æ£€æŸ¥å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰ã€‚</mark></p> <ul> <li>Exception ç±»ç”¨äºç”¨æˆ·ç¨‹åºå¯èƒ½å‡ºç°çš„å¼‚å¸¸æƒ…å†µï¼Œå®ƒä¹Ÿæ˜¯ç”¨æ¥åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»å‹ç±»çš„ç±»ã€‚</li> <li>Error å®šä¹‰äº†åœ¨é€šå¸¸ç¯å¢ƒä¸‹ä¸å¸Œæœ›è¢«ç¨‹åºæ•è·çš„å¼‚å¸¸ã€‚ä¸€èˆ¬æŒ‡çš„æ˜¯ JVM é”™è¯¯ï¼Œå¦‚å †æ ˆæº¢å‡ºã€‚</li> </ul> <p>è¿è¡Œæ—¶å¼‚å¸¸éƒ½æ˜¯ RuntimeException ç±»åŠå…¶å­ç±»å¼‚å¸¸ï¼Œå¦‚ NullPointerExceptionã€IndexOutOfBoundsException ç­‰ï¼Œè¿™äº›å¼‚å¸¸æ˜¯ä¸æ£€æŸ¥å¼‚å¸¸ï¼Œç¨‹åºä¸­å¯ä»¥é€‰æ‹©æ•è·å¤„ç†ï¼Œä¹Ÿå¯ä»¥ä¸å¤„ç†ã€‚è¿™äº›å¼‚å¸¸ä¸€èˆ¬ç”±ç¨‹åºé€»è¾‘é”™è¯¯å¼•èµ·ï¼Œç¨‹åºåº”è¯¥ä»é€»è¾‘è§’åº¦å°½å¯èƒ½é¿å…è¿™ç±»å¼‚å¸¸çš„å‘ç”Ÿã€‚</p> <p>éè¿è¡Œæ—¶å¼‚å¸¸æ˜¯æŒ‡ RuntimeException ä»¥å¤–çš„å¼‚å¸¸ï¼Œç±»å‹ä¸Šéƒ½å±äº Exception ç±»åŠå…¶å­ç±»ã€‚ä»ç¨‹åºè¯­æ³•è§’åº¦è®²æ˜¯å¿…é¡»è¿›è¡Œå¤„ç†çš„å¼‚å¸¸ï¼Œå¦‚æœä¸å¤„ç†ï¼Œç¨‹åºå°±ä¸èƒ½ç¼–è¯‘é€šè¿‡ã€‚å¦‚ IOExceptionã€ClassNotFoundException ç­‰ä»¥åŠç”¨æˆ·è‡ªå®šä¹‰çš„ Exception å¼‚å¸¸ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¸è‡ªå®šä¹‰æ£€æŸ¥å¼‚å¸¸ï¼‰ã€‚</p> <p>Javaä¸­å¸¸è§è¿è¡Œæ—¶å¼‚å¸¸</p> <table> <thead> <tr> <th>å¼‚å¸¸ç±»å‹</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>ArithmeticException</td> <td>ç®—æœ¯é”™è¯¯å¼‚å¸¸ï¼Œå¦‚ä»¥é›¶åšé™¤æ•°</td> </tr> <tr> <td>ArraylndexOutOfBoundException</td> <td>æ•°ç»„ç´¢å¼•è¶Šç•Œ</td> </tr> <tr> <td>ArrayStoreException</td> <td>å‘ç±»å‹ä¸å…¼å®¹çš„æ•°ç»„å…ƒç´ èµ‹å€¼</td> </tr> <tr> <td>ClassCastException</td> <td>ç±»å‹è½¬æ¢å¼‚å¸¸</td> </tr> <tr> <td>IllegalArgumentException</td> <td>ä½¿ç”¨éæ³•å®å‚è°ƒç”¨æ–¹æ³•</td> </tr> <tr> <td>lIIegalStateException</td> <td>ç¯å¢ƒæˆ–åº”ç”¨ç¨‹åºå¤„äºä¸æ­£ç¡®çš„çŠ¶æ€</td> </tr> <tr> <td>lIIegalThreadStateException</td> <td>è¢«è¯·æ±‚çš„æ“ä½œä¸å½“å‰çº¿ç¨‹çŠ¶æ€ä¸å…¼å®¹</td> </tr> <tr> <td>IndexOutOfBoundsException</td> <td>æŸç§ç±»å‹çš„ç´¢å¼•è¶Šç•Œ</td> </tr> <tr> <td>NullPointerException</td> <td>å°è¯•è®¿é—® null å¯¹è±¡æˆå‘˜ï¼Œç©ºæŒ‡é’ˆå¼‚å¸¸</td> </tr> <tr> <td>NegativeArraySizeException</td> <td>å†è´Ÿæ•°èŒƒå›´å†…åˆ›å»ºçš„æ•°ç»„</td> </tr> <tr> <td>NumberFormatException</td> <td>æ•°å­—è½¬åŒ–æ ¼å¼å¼‚å¸¸ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²åˆ° float å‹æ•°å­—çš„è½¬æ¢æ— æ•ˆ</td> </tr> <tr> <td>TypeNotPresentException</td> <td>ç±»å‹æœªæ‰¾åˆ°</td> </tr> </tbody> </table> <p>Javaå¸¸è§éè¿è¡Œæ—¶å¼‚å¸¸</p> <table> <thead> <tr> <th>å¼‚å¸¸ç±»å‹</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>ClassNotFoundException</td> <td>æ²¡æœ‰æ‰¾åˆ°ç±»</td> </tr> <tr> <td>IllegalAccessException</td> <td>è®¿é—®ç±»è¢«æ‹’ç»</td> </tr> <tr> <td>InstantiationException</td> <td>è¯•å›¾åˆ›å»ºæŠ½è±¡ç±»æˆ–æ¥å£çš„å¯¹è±¡</td> </tr> <tr> <td>InterruptedException</td> <td>çº¿ç¨‹è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ–­</td> </tr> <tr> <td>NoSuchFieldException</td> <td>è¯·æ±‚çš„åŸŸä¸å­˜åœ¨</td> </tr> <tr> <td>NoSuchMethodException</td> <td>è¯·æ±‚çš„æ–¹æ³•ä¸å­˜åœ¨</td> </tr> <tr> <td>ReflectiveOperationException</td> <td>ä¸åå°„æœ‰å…³çš„å¼‚å¸¸çš„è¶…ç±»</td> </tr> </tbody> </table> <h3 id="82errorexception">8.2ã€Errorã€Exception<a class="headerlink" href="#82errorexception" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Errorï¼ˆé”™è¯¯ï¼‰å’Œ Exceptionï¼ˆå¼‚å¸¸ï¼‰éƒ½æ˜¯ java.lang.Throwable ç±»çš„å­ç±»ï¼Œåœ¨ Java ä»£ç ä¸­åªæœ‰ç»§æ‰¿äº† Throwable ç±»çš„å®ä¾‹æ‰èƒ½è¢« throw æˆ–è€… catchã€‚</p> <p>Exception å’Œ Error ä½“ç°äº† Java å¹³å°è®¾è®¡è€…å¯¹ä¸åŒå¼‚å¸¸æƒ…å†µçš„åˆ†ç±»ï¼ŒException æ˜¯ç¨‹åºæ­£å¸¸è¿è¡Œè¿‡ç¨‹ä¸­å¯ä»¥é¢„æ–™åˆ°çš„æ„å¤–æƒ…å†µï¼Œå¹¶ä¸”åº”è¯¥è¢«å¼€å‘è€…æ•è·ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚Error æ˜¯æŒ‡æ­£å¸¸æƒ…å†µä¸‹ä¸å¤§å¯èƒ½å‡ºç°çš„æƒ…å†µï¼Œç»å¤§éƒ¨åˆ†çš„ Error éƒ½ä¼šå¯¼è‡´ç¨‹åºå¤„äºéæ­£å¸¸ã€ä¸å¯æ¢å¤çŠ¶æ€ã€‚æ‰€ä»¥ä¸éœ€è¦è¢«å¼€å‘è€…æ•è·ã€‚</p> <p>Error é”™è¯¯æ˜¯ä»»ä½•å¤„ç†æŠ€æœ¯éƒ½æ— æ³•æ¢å¤çš„æƒ…å†µï¼Œè‚¯å®šä¼šå¯¼è‡´ç¨‹åºéæ­£å¸¸ç»ˆæ­¢ã€‚å¹¶ä¸” Error é”™è¯¯å±äºæœªæ£€æŸ¥ç±»å‹ï¼Œå¤§å¤šæ•°å‘ç”Ÿåœ¨è¿è¡Œæ—¶ã€‚Exception åˆåˆ†ä¸ºå¯æ£€æŸ¥ï¼ˆcheckedï¼‰å¼‚å¸¸å’Œä¸æ£€æŸ¥ï¼ˆuncheckedï¼‰å¼‚å¸¸ï¼Œå¯æ£€æŸ¥å¼‚å¸¸åœ¨æºç é‡Œå¿…é¡»æ˜¾ç¤ºçš„è¿›è¡Œæ•è·å¤„ç†ï¼Œè¿™é‡Œæ˜¯ç¼–è¯‘æœŸæ£€æŸ¥çš„ä¸€éƒ¨åˆ†ã€‚ä¸æ£€æŸ¥å¼‚å¸¸å°±æ˜¯æ‰€è°“çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼Œé€šå¸¸æ˜¯å¯ä»¥ç¼–ç é¿å…çš„é€»è¾‘é”™è¯¯ï¼Œå…·ä½“æ ¹æ®éœ€è¦æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ•è·ï¼Œå¹¶ä¸ä¼šåœ¨ç¼–è¯‘å™¨å¼ºåˆ¶è¦æ±‚ã€‚</p> <p>å¦‚ä¸‹æ˜¯å¸¸è§çš„ Error å’Œ Exceptionï¼š</p> <p>1ï¼‰è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰ï¼š</p> <ul> <li>NullPropagationï¼šç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›</li> <li>ClassCastExceptionï¼šç±»å‹å¼ºåˆ¶è½¬æ¢å¼‚å¸¸</li> <li>IllegalArgumentExceptionï¼šä¼ é€’éæ³•å‚æ•°å¼‚å¸¸</li> <li>IndexOutOfBoundsExceptionï¼šä¸‹æ ‡è¶Šç•Œå¼‚å¸¸</li> <li>NumberFormatExceptionï¼šæ•°å­—æ ¼å¼å¼‚å¸¸</li> </ul> <p>2ï¼‰éè¿è¡Œæ—¶å¼‚å¸¸ï¼š</p> <ul> <li>ClassNotFoundExceptionï¼šæ‰¾ä¸åˆ°æŒ‡å®š class çš„å¼‚å¸¸</li> <li>IOExceptionï¼šIO æ“ä½œå¼‚å¸¸</li> </ul> <p>3ï¼‰é”™è¯¯ï¼ˆErrorï¼‰ï¼š</p> <ul> <li>NoClassDefFoundErrorï¼šæ‰¾ä¸åˆ° class å®šä¹‰å¼‚å¸¸</li> <li>StackOverflowErrorï¼šæ·±é€’å½’å¯¼è‡´æ ˆè¢«è€—å°½è€ŒæŠ›å‡ºçš„å¼‚å¸¸</li> <li>OutOfMemoryErrorï¼šå†…å­˜æº¢å‡ºå¼‚å¸¸</li> </ul> <p>ä¸‹é¢ä»£ç ä¼šå¯¼è‡´ Java å †æ ˆæº¢å‡ºé”™è¯¯ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1">// é€šè¿‡æ— é™é€’å½’æ¼”ç¤ºå †æ ˆæº¢å‡ºé”™è¯¯</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kd">class</span> <span class="nc">StackOverflow</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">            </span><span class="n">test</span><span class="p">(</span><span class="n">i</span><span class="o">++</span><span class="p">);</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="p">}</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ErrorEg</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">        </span><span class="c1">// æ‰§è¡ŒStackOverflowæ–¹æ³•</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">        </span><span class="n">StackOverflow</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œè¾“å‡ºä¸ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Exception in thread "main" java.lang.StackOverflowError
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    at ch11.StackOverflow.test(ErrorEg.java:9)
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    at ch11.StackOverflow.test(ErrorEg.java:9)
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    at ch11.StackOverflow.test(ErrorEg.java:9)
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    at ch11.StackOverflow.test(ErrorEg.java:9)
</span></code></pre></div> <p>ä¸Šé¢ä»£ç é€šè¿‡æ— é™é€’å½’è°ƒç”¨æœ€ç»ˆå¼•å‘äº† java.lang.StackOverflowError é”™è¯¯ã€‚</p> <h3 id="83å¼‚å¸¸å¤„ç†æœºåˆ¶">8.3ã€å¼‚å¸¸å¤„ç†æœºåˆ¶<a class="headerlink" href="#83å¼‚å¸¸å¤„ç†æœºåˆ¶" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Java çš„å¼‚å¸¸å¤„ç†é€šè¿‡ 5 ä¸ªå…³é”®å­—æ¥å®ç°ï¼štryã€catchã€throwã€throws å’Œ finallyã€‚<mark>try catch è¯­å¥ç”¨äºæ•è·å¹¶å¤„ç†å¼‚å¸¸ï¼Œfinally è¯­å¥ç”¨äºåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ˆé™¤ç‰¹æ®Šæƒ…å†µå¤–ï¼‰éƒ½å¿…é¡»æ‰§è¡Œçš„ä»£ç ï¼Œthrow è¯­å¥ç”¨äºæ‹‹å‡ºå¼‚å¸¸ï¼Œthrows è¯­å¥ç”¨äºå£°æ˜å¯èƒ½ä¼šå‡ºç°çš„å¼‚å¸¸ã€‚</mark> </p> <p>Java çš„å¼‚å¸¸å¤„ç†æœºåˆ¶æä¾›äº†ä¸€ç§ç»“æ„æ€§å’Œæ§åˆ¶æ€§çš„æ–¹å¼æ¥å¤„ç†ç¨‹åºæ‰§è¡ŒæœŸé—´å‘ç”Ÿçš„äº‹ä»¶ã€‚å¼‚å¸¸å¤„ç†çš„æœºåˆ¶å¦‚ä¸‹ï¼š</p> <ul> <li>åœ¨æ–¹æ³•ä¸­ç”¨ try catch è¯­å¥æ•è·å¹¶å¤„ç†å¼‚å¸¸ï¼Œcatch è¯­å¥å¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨æ¥åŒ¹é…å¤šä¸ªå¼‚å¸¸ã€‚</li> <li>å¯¹äºå¤„ç†ä¸äº†çš„å¼‚å¸¸æˆ–è€…è¦è½¬å‹çš„å¼‚å¸¸ï¼Œåœ¨æ–¹æ³•çš„å£°æ˜å¤„é€šè¿‡ throws è¯­å¥æ‹‹å‡ºå¼‚å¸¸ï¼Œå³ç”±ä¸Šå±‚çš„è°ƒç”¨æ–¹æ³•æ¥å¤„ç†ã€‚</li> </ul> <p>ä»¥ä¸‹ä»£ç æ˜¯å¼‚å¸¸å¤„ç†ç¨‹åºçš„åŸºæœ¬ç»“æ„ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="n">é€»è¾‘ç¨‹åºå—</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">ExceptionType1</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="n">å¤„ç†ä»£ç å—1</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ExceptionType2</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="n">å¤„ç†ä»£ç å—2</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="nf">throw</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">    </span><span class="c1">// å†æŠ›å‡ºè¿™ä¸ª"å¼‚å¸¸"</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="n">é‡Šæ”¾èµ„æºä»£ç å—</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="p">}</span>
</span></code></pre></div> <p><strong>throw</strong></p> <ul> <li>è¡¨ç¤ºæ–¹æ³•å†…æŠ›å‡ºæŸç§å¼‚å¸¸å¯¹è±¡ã€‚</li> <li>å¦‚æœå¼‚å¸¸å¯¹è±¡æ˜¯é RuntimeException åˆ™éœ€è¦åœ¨æ–¹æ³•ç”³æ˜æ—¶åŠ ä¸Šè¯¥å¼‚å¸¸çš„æŠ›å‡ºï¼Œå³éœ€è¦åŠ ä¸Š throws è¯­å¥ æˆ–è€… åœ¨æ–¹æ³•ä½“å†… try catch å¤„ç†è¯¥å¼‚å¸¸ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ã€‚</li> <li>æ‰§è¡Œåˆ° throw è¯­å¥åˆ™åé¢çš„è¯­å¥å—ä¸å†æ‰§è¡Œ</li> </ul> <p><strong>throws</strong></p> <ul> <li>æ–¹æ³•çš„å®šä¹‰ä¸Šä½¿ç”¨ throws è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•å¯èƒ½æŠ›å‡ºæŸç§å¼‚å¸¸</li> <li>éœ€è¦ç”±æ–¹æ³•çš„è°ƒç”¨è€…è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚</li> </ul> <h3 id="84try-catchè¯­å¥">8.4ã€try catchè¯­å¥<a class="headerlink" href="#84try-catchè¯­å¥" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯¹äºé”™è¯¯çš„å¤„ç†æ˜¯æå…¶é‡è¦çš„ï¼Œä»»ä½•ç¨‹åºéƒ½å¾ˆéš¾åšåˆ°ç™¾åˆ†ç™¾å®Œç¾ï¼Œç¨‹åºä¸­å¯èƒ½å­˜åœ¨å¤§é‡æœªçŸ¥é—®é¢˜ï¼Œæ‰€ä»¥ç¨‹åºå¼€å‘æ—¶ä¸€å®šè¦å¯¹å„ç§é—®é¢˜è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œè€Œ Java æä¾›çš„å¼‚å¸¸å¤„ç†æœºåˆ¶å¯ä»¥å¸®ç”¨æˆ·æ›´å¥½åœ°è§£å†³è¿™æ–¹é¢çš„é—®é¢˜ã€‚Java çš„å¼‚å¸¸å¤„ç†æœºåˆ¶å¯ä»¥è®©ç¨‹åºå…·æœ‰æå¥½çš„å®¹é”™æ€§ï¼Œè®©ç¨‹åºæ›´åŠ å¥å£®ã€‚</p> <p>==åœ¨ Java ä¸­é€šå¸¸é‡‡ç”¨ try catch è¯­å¥æ¥æ•è·å¼‚å¸¸å¹¶å¤„ç†ã€‚==è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="c1">// å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„è¯­å¥</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">ExceptionType</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="c1">// å¤„ç†å¼‚å¸¸è¯­å¥</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="p">}</span>
</span></code></pre></div> <p>åœ¨ä»¥ä¸Šè¯­æ³•ä¸­ï¼ŒæŠŠå¯èƒ½å¼•å‘å¼‚å¸¸çš„è¯­å¥å°è£…åœ¨ try è¯­å¥å—ä¸­ï¼Œç”¨ä»¥æ•è·å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸ã€‚catch åçš„<code>( )</code>é‡Œæ”¾åŒ¹é…çš„å¼‚å¸¸ç±»ï¼ŒæŒ‡æ˜ catch è¯­å¥å¯ä»¥å¤„ç†çš„å¼‚å¸¸ç±»å‹ï¼Œå‘ç”Ÿå¼‚å¸¸æ—¶äº§ç”Ÿå¼‚å¸¸ç±»çš„å®ä¾‹åŒ–å¯¹è±¡ã€‚</p> <p>å¦‚æœ try è¯­å¥å—ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆä¸€ä¸ªç›¸åº”çš„å¼‚å¸¸å¯¹è±¡å°±ä¼šè¢«æ‹‹å‡ºï¼Œç„¶å catch è¯­å¥å°±ä¼šä¾æ®æ‰€æ‹‹å‡ºå¼‚å¸¸å¯¹è±¡çš„ç±»å‹è¿›è¡Œæ•è·ï¼Œå¹¶å¤„ç†ã€‚å¤„ç†ä¹‹åï¼Œç¨‹åºä¼šè·³è¿‡ try è¯­å¥å—ä¸­å‰©ä½™çš„è¯­å¥ï¼Œè½¬åˆ° catch è¯­å¥å—åé¢çš„ç¬¬ä¸€æ¡è¯­å¥å¼€å§‹æ‰§è¡Œã€‚</p> <p>å¦‚æœ try è¯­å¥å—ä¸­æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œé‚£ä¹ˆ try å—æ­£å¸¸ç»“æŸï¼Œåé¢çš„ catch è¯­å¥å—è¢«è·³è¿‡ï¼Œç¨‹åºå°†ä» catch è¯­å¥å—åçš„ç¬¬ä¸€æ¡è¯­å¥å¼€å§‹æ‰§è¡Œã€‚</p> <p>æ³¨æ„ï¼štry...catch ä¸ if...else ä¸ä¸€æ ·ï¼Œtry åé¢çš„èŠ±æ‹¬å·<code>{ }</code>ä¸å¯ä»¥çœç•¥ï¼Œå³ä½¿ try å—é‡Œåªæœ‰ä¸€è¡Œä»£ç ï¼Œä¹Ÿä¸å¯çœç•¥è¿™ä¸ªèŠ±æ‹¬å·ã€‚ä¸ä¹‹ç±»ä¼¼çš„æ˜¯ï¼Œcatch å—åçš„èŠ±æ‹¬å·<code>{ }</code>ä¹Ÿä¸å¯ä»¥çœç•¥ã€‚å¦å¤–ï¼Œtry å—é‡Œå£°æ˜çš„å˜é‡åªæ˜¯ä»£ç å—å†…çš„å±€éƒ¨å˜é‡ï¼Œå®ƒåªåœ¨ try å—å†…æœ‰æ•ˆï¼Œå…¶å®ƒåœ°æ–¹ä¸èƒ½è®¿é—®è¯¥å˜é‡ã€‚</p> <p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ 3 ä¸ªæ–¹æ³•è¾“å‡ºç›¸åº”çš„å¼‚å¸¸ä¿¡æ¯ã€‚</p> <ul> <li>printStackTrace() æ–¹æ³•ï¼šæŒ‡å‡ºå¼‚å¸¸çš„ç±»å‹ã€æ€§è´¨ã€æ ˆå±‚æ¬¡åŠå‡ºç°åœ¨ç¨‹åºä¸­çš„ä½ç½®ã€‚</li> <li>getMessage() æ–¹æ³•ï¼šè¾“å‡ºé”™è¯¯çš„æ€§è´¨ã€‚</li> <li>toString() æ–¹æ³•ï¼šç»™å‡ºå¼‚å¸¸çš„ç±»å‹ä¸æ€§è´¨ã€‚</li> </ul> <p>ç¼–å†™ä¸€ä¸ªå½•å…¥å­¦ç”Ÿå§“åã€å¹´é¾„å’Œæ€§åˆ«çš„ç¨‹åºï¼Œè¦æ±‚èƒ½æ•æ‰å¹´é¾„ä¸ä¸ºæ•°å­—æ—¶çš„å¼‚å¸¸ã€‚åœ¨è¿™é‡Œä½¿ç”¨ try catch è¯­å¥æ¥å®ç°ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Scanner</span><span class="p">;</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test02</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">        </span><span class="n">Scanner</span><span class="w"> </span><span class="n">scanner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Scanner</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">);</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"---------å­¦ç”Ÿä¿¡æ¯å½•å…¥---------------"</span><span class="p">);</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">;</span><span class="w"> </span><span class="c1">// è·å–å­¦ç”Ÿå§“å</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// è·å–å­¦ç”Ÿå¹´é¾„</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">;</span><span class="w"> </span><span class="c1">// è·å–å­¦ç”Ÿæ€§åˆ«</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¯·è¾“å…¥å­¦ç”Ÿå§“åï¼š"</span><span class="p">);</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">            </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scanner</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¯·è¾“å…¥å­¦ç”Ÿå¹´é¾„ï¼š"</span><span class="p">);</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">            </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scanner</span><span class="p">.</span><span class="na">nextInt</span><span class="p">();</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¯·è¾“å…¥å­¦ç”Ÿæ€§åˆ«ï¼š"</span><span class="p">);</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">            </span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scanner</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¾“å…¥æœ‰è¯¯ï¼"</span><span class="p">);</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å§“åï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å¹´é¾„ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">);</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿°ä»£ç åœ¨ main() æ–¹æ³•ä¸­ä½¿ç”¨ try catch è¯­å¥æ¥æ•è·å¼‚å¸¸ï¼Œå°†å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„<code>age = scanner.nextlnt();</code>ä»£ç æ”¾åœ¨äº† try å—ä¸­ï¼Œåœ¨ catch è¯­å¥ä¸­æŒ‡å®šæ•è·çš„å¼‚å¸¸ç±»å‹ä¸º Exceptionï¼Œå¹¶è°ƒç”¨å¼‚å¸¸å¯¹è±¡çš„ printStackTrace() æ–¹æ³•è¾“å‡ºå¼‚å¸¸ä¿¡æ¯ã€‚è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>---------å­¦ç”Ÿä¿¡æ¯å½•å…¥---------------
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>è¯·è¾“å…¥å­¦ç”Ÿå§“åï¼š
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>å¾ç™½
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>è¯·è¾“å…¥å­¦ç”Ÿå¹´é¾„ï¼š
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>110a
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>java.util.InputMismatchException
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    at java.util.Scanner.throwFor(Unknown Source)
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    at java.util.Scanner.next(Unknown Source)
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    at java.util.Scanner.nextInt(Unknown Source)
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    at java.util.Scanner.nextInt(Unknown Source)
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>è¾“å…¥æœ‰è¯¯ï¼
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>å§“åï¼šå¾ç™½
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>å¹´é¾„ï¼š0
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>    at text.text.main(text.java:19)
</span></code></pre></div> <hr> <p><strong>å¤šé‡catchè¯­å¥</strong></p> <p>å¦‚æœ try ä»£ç å—ä¸­æœ‰å¾ˆå¤šè¯­å¥ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œè€Œä¸”å‘ç”Ÿçš„å¼‚å¸¸ç§ç±»åˆå¾ˆå¤šã€‚é‚£ä¹ˆå¯ä»¥åœ¨ try åé¢è·Ÿæœ‰å¤šä¸ª catch ä»£ç å—ã€‚å¤š catch ä»£ç å—è¯­æ³•å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="c1">// å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸çš„è¯­å¥</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">ExceptionType</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="c1">// å¤„ç†å¼‚å¸¸è¯­å¥</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">ExceptionType</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="c1">// å¤„ç†å¼‚å¸¸è¯­å¥</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">ExceptionType</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="c1">// å¤„ç†å¼‚å¸¸è¯­å¥</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="p">...</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="p">}</span>
</span></code></pre></div> <p>åœ¨å¤šä¸ª catch ä»£ç å—çš„æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ª catch ä»£ç å—æ•è·åˆ°ä¸€ä¸ªå¼‚å¸¸æ—¶ï¼Œå…¶å®ƒçš„ catch ä»£ç å—å°±ä¸å†è¿›è¡ŒåŒ¹é…ã€‚</p> <p>æ³¨æ„ï¼šå½“æ•è·çš„å¤šä¸ªå¼‚å¸¸ç±»ä¹‹é—´å­˜åœ¨çˆ¶å­å…³ç³»æ—¶ï¼Œæ•è·å¼‚å¸¸æ—¶ä¸€èˆ¬å…ˆæ•è·å­ç±»ï¼Œå†æ•è·çˆ¶ç±»ã€‚æ‰€ä»¥å­ç±»å¼‚å¸¸å¿…é¡»åœ¨çˆ¶ç±»å¼‚å¸¸çš„å‰é¢ï¼Œå¦åˆ™å­ç±»æ•è·ä¸åˆ°ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test03</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="n">Date</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">readDate</span><span class="p">();</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¯»å–çš„æ—¥æœŸ = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">date</span><span class="p">);</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="nf">readDate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">readfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">        </span><span class="n">InputStreamReader</span><span class="w"> </span><span class="n">ir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">        </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">            </span><span class="n">readfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">"readme.txt"</span><span class="p">);</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">            </span><span class="n">ir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">readfile</span><span class="p">);</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">            </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">ir</span><span class="p">);</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">            </span><span class="c1">// è¯»å–æ–‡ä»¶ä¸­çš„ä¸€è¡Œæ•°æ®</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">.</span><span class="na">readLine</span><span class="p">();</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">str</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="w">            </span><span class="n">DateFormat</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">"yyyy-MM-dd"</span><span class="p">);</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="w">            </span><span class="n">Date</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">date</span><span class="p">;</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å¤„ç†FileNotFoundException..."</span><span class="p">);</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å¤„ç†IOException..."</span><span class="p">);</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ParseException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å¤„ç†ParseException..."</span><span class="p">);</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šè¿°ä»£ç é€šè¿‡ Java I/Oï¼ˆè¾“å…¥è¾“å‡ºï¼‰æµæŠ€æœ¯ä»æ–‡ä»¶ readme.txt ä¸­è¯»å–å­—ç¬¦ä¸²ï¼Œç„¶åè§£ææˆä¸ºæ—¥æœŸã€‚</p> <p>åœ¨ try ä»£ç å—ä¸­ç¬¬ 12 è¡Œä»£ç è°ƒç”¨ FileInputStream æ„é€ æ–¹æ³•å¯èƒ½ä¼šå‘ç”Ÿ FileNotFoundException å¼‚å¸¸ã€‚ç¬¬ 16 è¡Œä»£ç è°ƒç”¨ BufferedReader è¾“å…¥æµçš„ readLine() æ–¹æ³•å¯èƒ½ä¼šå‘ç”Ÿ IOException å¼‚å¸¸ã€‚FileNotFoundException å¼‚å¸¸æ˜¯ IOException å¼‚å¸¸çš„å­ç±»ï¼Œåº”è¯¥å…ˆæ•è· FileNotFoundException å¼‚å¸¸ï¼Œè§ä»£ç ç¬¬ 23 è¡Œï¼›åæ•è· IOException å¼‚å¸¸ï¼Œè§ä»£ç ç¬¬ 26 è¡Œã€‚</p> <p>å¦‚æœå°† FileNotFoundException å’Œ IOException æ•è·é¡ºåºè°ƒæ¢ï¼Œé‚£ä¹ˆæ•è· FileNotFoundException å¼‚å¸¸ä»£ç å—å°†æ°¸è¿œä¸ä¼šè¿›å…¥ï¼ŒFileNotFoundException å¼‚å¸¸å¤„ç†æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚ ä¸Šè¿°ä»£ç ç¬¬ 29 è¡Œ ParseException å¼‚å¸¸ä¸ IOException å’Œ FileNotFoundException å¼‚å¸¸æ²¡æœ‰çˆ¶å­å…³ç³»ï¼Œæ‰€ä»¥æ•è· ParseException å¼‚å¸¸ä½ç½®å¯ä»¥éšæ„æ”¾ç½®ã€‚</p> <h3 id="85try-catch-finallyè¯­å¥">8.5ã€try catch finallyè¯­å¥<a class="headerlink" href="#85try-catch-finallyè¯­å¥" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ ¹æ® try catch è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œtry è¯­å¥å—å’Œ catch è¯­å¥å—æœ‰å¯èƒ½ä¸è¢«å®Œå…¨æ‰§è¡Œï¼Œè€Œæœ‰äº›å¤„ç†ä»£ç åˆ™è¦æ±‚å¿…é¡»æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œç¨‹åºåœ¨ try å—é‡Œæ‰“å¼€äº†ä¸€äº›ç‰©ç†èµ„æºï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥å’Œç£ç›˜æ–‡ä»¶ç­‰ï¼‰ï¼Œè¿™äº›ç‰©ç†èµ„æºéƒ½å¿…é¡»æ˜¾å¼å›æ”¶ã€‚</p> <p>Javaçš„åƒåœ¾å›æ”¶æœºåˆ¶ä¸ä¼šå›æ”¶ä»»ä½•ç‰©ç†èµ„æºï¼Œåƒåœ¾å›æ”¶æœºåˆ¶åªå›æ”¶å †å†…å­˜ä¸­å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ã€‚</p> <p>æ‰€ä»¥ä¸ºäº†ç¡®ä¿ä¸€å®šèƒ½å›æ”¶ try å—ä¸­æ‰“å¼€çš„ç‰©ç†èµ„æºï¼Œå¼‚å¸¸å¤„ç†æœºåˆ¶æä¾›äº† finally ä»£ç å—ï¼Œå¹¶ä¸” Java 7 ä¹‹åæä¾›äº†==è‡ªåŠ¨èµ„æºç®¡ç†ï¼ˆAutomatic Resource Managementï¼‰==æŠ€æœ¯ã€‚</p> <p>finally è¯­å¥å¯ä»¥ä¸å‰é¢ä»‹ç»çš„ try catch è¯­å¥å—åŒ¹é…ä½¿ç”¨ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="c1">// å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸çš„è¯­å¥</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">ExceptionType</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="c1">// å¤„ç†å¼‚å¸¸è¯­å¥</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="c1">// æ¸…ç†ä»£ç å—</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="p">}</span>
</span></code></pre></div> <p>å¯¹äºä»¥ä¸Šæ ¼å¼ï¼Œæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼ˆé™¤ç‰¹æ®Šæƒ…å†µå¤–ï¼‰ï¼Œfinally è¯­å¥å—ä¸­çš„ä»£ç éƒ½ä¼šè¢«æ‰§è¡Œã€‚æ­¤å¤–ï¼Œfinally è¯­å¥ä¹Ÿå¯ä»¥å’Œ try è¯­å¥åŒ¹é…ä½¿ç”¨ï¼Œå…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="c1">// é€»è¾‘ä»£ç å—</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="c1">// æ¸…ç†ä»£ç å—</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">}</span>
</span></code></pre></div> <p>ä½¿ç”¨ try-catch-finally è¯­å¥æ—¶éœ€æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p> <ol> <li>å¼‚å¸¸å¤„ç†è¯­æ³•ç»“æ„ä¸­åªæœ‰ try å—æ˜¯å¿…éœ€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ²¡æœ‰ try å—ï¼Œåˆ™ä¸èƒ½æœ‰åé¢çš„ catch å—å’Œ finally å—ï¼›</li> <li>catch å—å’Œ finally å—éƒ½æ˜¯å¯é€‰çš„ï¼Œä½† catch å—å’Œ finally å—è‡³å°‘å‡ºç°å…¶ä¸­ä¹‹ä¸€ï¼Œä¹Ÿå¯ä»¥åŒæ—¶å‡ºç°ï¼›</li> <li>å¯ä»¥æœ‰å¤šä¸ª catch å—ï¼Œæ•è·çˆ¶ç±»å¼‚å¸¸çš„ catch å—å¿…é¡»ä½äºæ•è·å­ç±»å¼‚å¸¸çš„åé¢ï¼›</li> <li>ä¸èƒ½åªæœ‰ try å—ï¼Œæ—¢æ²¡æœ‰ catch å—ï¼Œä¹Ÿæ²¡æœ‰ finally å—ï¼›</li> <li>å¤šä¸ª catch å—å¿…é¡»ä½äº try å—ä¹‹åï¼Œfinally å—å¿…é¡»ä½äºæ‰€æœ‰çš„ catch å—ä¹‹åã€‚</li> <li>finally ä¸ try è¯­å¥å—åŒ¹é…çš„è¯­æ³•æ ¼å¼ï¼Œæ­¤ç§æƒ…å†µä¼šå¯¼è‡´å¼‚å¸¸ä¸¢å¤±ï¼Œæ‰€ä»¥ä¸å¸¸è§ã€‚</li> </ol> <p>==ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ— è®ºæ˜¯å¦æœ‰å¼‚å¸¸æ‹‹å‡ºï¼Œéƒ½ä¼šæ‰§è¡Œ finally è¯­å¥å—ä¸­çš„è¯­å¥ï¼Œ==æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/3-1Q024110159364.jpg" data-desc-position="bottom"><img src="!assets/Java/3-1Q024110159364.jpg" alt="img" style="zoom:80%;"></a></p> <p>try catch finally è¯­å¥å—çš„æ‰§è¡Œæƒ…å†µå¯ä»¥ç»†åˆ†ä¸ºä»¥ä¸‹ 3 ç§æƒ…å†µï¼š</p> <ol> <li>å¦‚æœ try ä»£ç å—ä¸­æ²¡æœ‰æ‹‹å‡ºå¼‚å¸¸ï¼Œåˆ™æ‰§è¡Œå®Œ try ä»£ç å—ä¹‹åç›´æ¥æ‰§è¡Œ finally ä»£ç å—ï¼Œç„¶åæ‰§è¡Œ try catch finally è¯­å¥å—ä¹‹åçš„è¯­å¥ã€‚</li> <li>å¦‚æœ try ä»£ç å—ä¸­æ‹‹å‡ºå¼‚å¸¸ï¼Œå¹¶è¢« catch å­å¥æ•æ‰ï¼Œé‚£ä¹ˆåœ¨æ‹‹å‡ºå¼‚å¸¸çš„åœ°æ–¹ç»ˆæ­¢ try ä»£ç å—çš„æ‰§è¡Œï¼Œè½¬è€Œæ‰§è¡Œç›¸åŒ¹é…çš„ catch ä»£ç å—ï¼Œä¹‹åæ‰§è¡Œ finally ä»£ç å—ã€‚å¦‚æœ finally ä»£ç å—ä¸­æ²¡æœ‰æ‹‹å‡ºå¼‚å¸¸ï¼Œåˆ™ç»§ç»­æ‰§è¡Œ try catch finally è¯­å¥å—ä¹‹åçš„è¯­å¥ï¼›å¦‚æœ finally ä»£ç å—ä¸­æ‹‹å‡ºå¼‚å¸¸ï¼Œåˆ™æŠŠè¯¥å¼‚å¸¸ä¼ é€’ç»™è¯¥æ–¹æ³•çš„è°ƒç”¨è€…ã€‚</li> <li>å¦‚æœ try ä»£ç å—ä¸­æ‹‹å‡ºçš„å¼‚å¸¸æ²¡æœ‰è¢«ä»»ä½• catch å­å¥æ•æ‰åˆ°ï¼Œé‚£ä¹ˆå°†ç›´æ¥æ‰§è¡Œ finally ä»£ç å—ä¸­çš„è¯­å¥ï¼Œå¹¶æŠŠè¯¥å¼‚å¸¸ä¼ é€’ç»™è¯¥æ–¹æ³•çš„è°ƒç”¨è€…ã€‚</li> </ol> <p>é™¤éåœ¨ try å—ã€catch å—ä¸­è°ƒç”¨äº†é€€å‡ºè™šæ‹Ÿæœºçš„æ–¹æ³•<code>System.exit(int status)</code>ï¼Œå¦åˆ™ä¸ç®¡åœ¨ try å—æˆ–è€… catch å—ä¸­æ‰§è¡Œæ€æ ·çš„ä»£ç ï¼Œå‡ºç°æ€æ ·çš„æƒ…å†µï¼Œå¼‚å¸¸å¤„ç†çš„ finally å—æ€»ä¼šæ‰§è¡Œã€‚</p> <p>é€šå¸¸æƒ…å†µä¸‹==ä¸åœ¨ finally ä»£ç å—ä¸­ä½¿ç”¨ return æˆ– throw ç­‰å¯¼è‡´æ–¹æ³•ç»ˆæ­¢çš„è¯­å¥ï¼Œ==å¦åˆ™å°†ä¼šå¯¼è‡´ try å’Œ catch ä»£ç å—ä¸­çš„ return å’Œ throw è¯­å¥å¤±æ•ˆã€‚</p> <h3 id="86finallyå’Œreturnæ‰§è¡Œé¡ºåº">8.6ã€finallyå’Œreturnæ‰§è¡Œé¡ºåº<a class="headerlink" href="#86finallyå’Œreturnæ‰§è¡Œé¡ºåº" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>æƒ…å†µ1ï¼š</strong> try{} catch(){}finally{} return; æ˜¾ç„¶ç¨‹åºæŒ‰é¡ºåºæ‰§è¡Œã€‚</p> <hr> <p><strong>æƒ…å†µ2:</strong> try{ return; }catch(){} finally{} return;</p> <ol> <li>å…ˆæ‰§è¡Œtryå—ä¸­return è¯­å¥ï¼ˆåŒ…æ‹¬returnè¯­å¥ä¸­çš„è¡¨è¾¾å¼è¿ç®—ï¼‰ï¼Œä½†ä¸è¿”å›ï¼›</li> <li>æ‰§è¡Œfinallyè¯­å¥ä¸­å…¨éƒ¨ä»£ç </li> <li>æœ€åæ‰§è¡Œtryä¸­return è¿”å›</li> <li>finallyå—ä¹‹åçš„è¯­å¥returnä¸æ‰§è¡Œï¼Œå› ä¸ºç¨‹åºåœ¨tryä¸­å·²ç»returnã€‚</li> </ol> <hr> <p><strong>æƒ…å†µ3:</strong> try{ } catch(){return;} finally{} return; ç¨‹åºå…ˆæ‰§è¡Œtryï¼Œå¦‚æœé‡åˆ°å¼‚å¸¸æ‰§è¡Œcatchå—ï¼Œ</p> <ul> <li> <p>æœ‰å¼‚å¸¸ï¼š</p> <ol> <li> <p>æ‰§è¡Œcatchä¸­returnè¯­å¥ï¼Œä½†ä¸è¿”å›</p> </li> <li> <p>æ‰§è¡Œfinallyè¯­å¥ä¸­å…¨éƒ¨ä»£ç ï¼Œ</p> </li> <li> <p>æœ€åæ‰§è¡Œcatchå—ä¸­returnè¿”å›ã€‚ finallyå—åçš„returnè¯­å¥ä¸å†æ‰§è¡Œã€‚</p> </li> <li>æ— å¼‚å¸¸ï¼šæ‰§è¡Œå®Œtryå†finallyå†returnâ€¦</li> </ol> </li> </ul> <hr> <p><strong>æƒ…å†µ4:</strong> try{ return; }catch(){} finally{return;}</p> <ol> <li>æ‰§è¡Œtryå—returnè¯­å¥ï¼ˆåŒ…æ‹¬returnè¯­å¥ä¸­çš„è¡¨è¾¾å¼è¿ç®—ï¼‰ï¼Œä½†ä¸è¿”å›ï¼›</li> <li>å†æ‰§è¡Œfinallyå—ï¼Œ</li> <li>æ‰§è¡Œfinallyå—ï¼Œæœ‰returnï¼Œä»è¿™é‡Œè¿”å›ã€‚</li> </ol> <hr> <p><strong>æƒ…å†µ5:</strong> try{} catch(){return;}finally{return;}</p> <ol> <li>ç¨‹åºæ‰§è¡Œcatchå—ä¸­returnè¯­å¥ï¼ˆåŒ…æ‹¬returnè¯­å¥ä¸­çš„è¡¨è¾¾å¼è¿ç®—ï¼‰ï¼Œä½†ä¸è¿”å›ï¼›</li> <li>å†æ‰§è¡Œfinallyå—ï¼Œ</li> <li>æ‰§è¡Œfinallyå—ï¼Œæœ‰returnï¼Œä»è¿™é‡Œè¿”å›ã€‚</li> </ol> <hr> <p><strong>æƒ…å†µ6:</strong> try{ return;}catch(){return;} finally{return;} ç¨‹åºæ‰§è¡Œtryå—ä¸­returnè¯­å¥ï¼ˆåŒ…æ‹¬returnè¯­å¥ä¸­çš„è¡¨è¾¾å¼è¿ç®—ï¼‰ï¼Œä½†ä¸è¿”å›ï¼›</p> <ul> <li> <p>æœ‰å¼‚å¸¸ï¼š</p> <ol> <li> <p>æ‰§è¡Œcatchå—ä¸­returnè¯­å¥ï¼ˆåŒ…æ‹¬returnè¯­å¥ä¸­çš„è¡¨è¾¾å¼è¿ç®—ï¼‰ï¼Œä½†ä¸è¿”å›ï¼›</p> </li> <li> <p>å†æ‰§è¡Œfinallyå—</p> </li> <li> <p>æ‰§è¡Œfinallyå—ï¼Œæœ‰returnï¼Œä»è¿™é‡Œè¿”å›ã€‚</p> </li> </ol> </li> <li> <p>æ— å¼‚å¸¸ï¼š</p> <ol> <li>å†æ‰§è¡Œfinallyå—</li> <li>æ‰§è¡Œfinallyå—ï¼Œæœ‰returnï¼Œä»è¿™é‡Œè¿”å›ã€‚</li> </ol> </li> </ul> <hr> <p><strong>ç»“è®ºï¼š</strong></p> <ul> <li>ä¸ç®¡æœ‰æœ¨æœ‰å‡ºç°å¼‚å¸¸ï¼Œfinallyå—ä¸­ä»£ç éƒ½ä¼šæ‰§è¡Œï¼›</li> <li>å½“tryå’Œcatchä¸­æœ‰returnæ—¶ï¼Œfinallyä»ç„¶ä¼šæ‰§è¡Œï¼›</li> <li>finallyæ˜¯åœ¨returnè¯­å¥æ‰§è¡Œä¹‹åï¼Œè¿”å›ä¹‹å‰æ‰§è¡Œçš„ï¼ˆæ­¤æ—¶å¹¶æ²¡æœ‰è¿”å›è¿ç®—åçš„å€¼ï¼Œè€Œæ˜¯å…ˆæŠŠè¦è¿”å›çš„å€¼ä¿å­˜èµ·æ¥ï¼Œä¸ç®¡finallyä¸­çš„ä»£ç æ€ä¹ˆæ ·ï¼Œè¿”å›çš„å€¼éƒ½ä¸ä¼šæ”¹å˜ï¼Œä»ç„¶æ˜¯ä¹‹å‰ä¿å­˜çš„å€¼ï¼‰ï¼Œæ‰€ä»¥å‡½æ•°è¿”å›å€¼æ˜¯åœ¨finallyæ‰§è¡Œå‰å°±å·²ç»ç¡®å®šäº†ï¼›</li> <li>finallyä¸­å¦‚æœåŒ…å«returnï¼Œé‚£ä¹ˆç¨‹åºå°†åœ¨è¿™é‡Œè¿”å›ï¼Œè€Œä¸æ˜¯tryæˆ–catchä¸­çš„returnè¿”å›ï¼Œè¿”å›å€¼å°±ä¸æ˜¯tryæˆ–catchä¸­ä¿å­˜çš„è¿”å›å€¼äº†ã€‚</li> </ul> <hr> <p><strong>å…³äºfinallyä¸­ä¿®æ”¹è¿”å›å€¼çš„é—®é¢˜ï¼š</strong></p> <ul> <li> <p>å¦‚æœreturnçš„æ•°æ®æ˜¯åŸºæœ¬æ•°æ®ç±»å‹æˆ–æ–‡æœ¬å­—ç¬¦ä¸²ï¼ˆ<mark>å­—ç¬¦ä¸²è™½ç„¶ä¸ºå¼•ç”¨ç±»å‹ï¼Œä½†æ˜¯åœ¨finallyæ”¹å˜çš„æ—¶å€™ï¼Œå…¶å®å½“äºç”³è¯·äº†ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²</mark>ï¼‰ï¼Œåˆ™åœ¨finallyä¸­å¯¹è¯¥åŸºæœ¬æ•°æ®çš„æ”¹å˜ä¸èµ·ä½œç”¨ï¼Œtryä¸­çš„returnè¯­å¥ä¾ç„¶ä¼šè¿”å›è¿›å…¥finallyå—ä¹‹å‰ä¿ç•™çš„å€¼ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">tryDemo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">show</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="p">}</span><span class="k">finally</span><span class="p">{</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"finallyæ¨¡å—è¢«æ‰§è¡Œ"</span><span class="p">);</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">args</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">show</span><span class="p">());</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œç»“æœä¸ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>finallyæ¨¡å—è¢«æ‰§è¡Œ
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>0
</span></code></pre></div> </li> <li> <p>å¦‚æœreturnçš„æ•°æ®æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œè€Œåœ¨finallyä¸­å¯¹è¯¥å¼•ç”¨æ•°æ®ç±»å‹çš„å±æ€§å€¼çš„æ”¹å˜èµ·ä½œç”¨ï¼Œtryä¸­çš„returnè¯­å¥è¿”å›çš„å°±æ˜¯åœ¨finallyä¸­æ”¹å˜åçš„è¯¥å±æ€§çš„å€¼ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TTT</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">RetDto</span><span class="w"> </span><span class="nf">show</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">        </span><span class="n">RetDto</span><span class="w"> </span><span class="n">dto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RetDto</span><span class="p">();</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">            </span><span class="n">dto</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"try"</span><span class="p">;</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">            </span><span class="n">dto</span><span class="p">.</span><span class="na">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"try:"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dto</span><span class="p">);</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">dto</span><span class="p">;</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"catch:"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dto</span><span class="p">);</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">dto</span><span class="p">;</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">            </span><span class="n">dto</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"finally"</span><span class="p">;</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">            </span><span class="n">dto</span><span class="p">.</span><span class="na">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">19</span><span class="p">;</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"finally:"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dto</span><span class="p">);</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">show</span><span class="p">());</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="p">}</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="kd">class</span> <span class="nc">RetDto</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">"RetDto{"</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="w">                </span><span class="s">"name='"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">'\''</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="w">                </span><span class="s">", age="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a><span class="w">                </span><span class="sc">'}'</span><span class="p">;</span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œç»“æœä¸ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>try:RetDto{name='try', age=1}
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>finally:RetDto{name='finally', age=19}
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>RetDto{name='finally', age=19}
</span></code></pre></div> </li> </ul> <h3 id="87å¢å¼ºçš„è‡ªåŠ¨èµ„æºç®¡ç†">8.7ã€å¢å¼ºçš„è‡ªåŠ¨èµ„æºç®¡ç†<a class="headerlink" href="#87å¢å¼ºçš„è‡ªåŠ¨èµ„æºç®¡ç†" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å½“ç¨‹åºä½¿ç”¨ finally å—å…³é—­èµ„æºæ—¶ï¼Œç¨‹åºä¼šæ˜¾å¾—å¼‚å¸¸è‡ƒè‚¿ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">        </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">"a.txt"</span><span class="p">);</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">        </span><span class="c1">// å…³é—­ç£ç›˜æ–‡ä»¶ï¼Œå›æ”¶èµ„æº</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fis</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">                </span><span class="n">fis</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="p">}</span>
</span></code></pre></div> <p>Java 7 ä»¥å‰ï¼Œä¸Šé¢ç¨‹åºä¸­çš„ finally ä»£ç å—æ˜¯ä¸å¾—ä¸å†™çš„â€œè‡ƒè‚¿ä»£ç â€ï¼Œä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼ŒJava 7 å¢åŠ äº†ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œè¯¥ç‰¹æ€§æä¾›äº†å¦å¤–ä¸€ç§ç®¡ç†èµ„æºçš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼èƒ½è‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼Œè¢«ç§°ä¸ºè‡ªåŠ¨èµ„æºç®¡ç†ï¼ˆAutomatic Resource Managementï¼‰ã€‚è¯¥ç‰¹æ€§æ˜¯åœ¨ try è¯­å¥ä¸Šçš„æ‰©å±•ï¼Œä¸»è¦é‡Šæ”¾ä¸å†éœ€è¦çš„æ–‡ä»¶æˆ–å…¶ä»–èµ„æºã€‚</p> <p>è‡ªåŠ¨èµ„æºç®¡ç†æ›¿ä»£äº† finally ä»£ç å—ï¼Œå¹¶ä¼˜åŒ–äº†ä»£ç ç»“æ„å’Œæé«˜ç¨‹åºå¯è¯»æ€§ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">å£°æ˜æˆ–åˆå§‹åŒ–èµ„æºè¯­å¥</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">    </span><span class="c1">// å¯èƒ½ä¼šç”Ÿæˆå¼‚å¸¸è¯­å¥</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">e1</span><span class="p">){</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="c1">// å¤„ç†å¼‚å¸¸e1</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">e2</span><span class="p">){</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">    </span><span class="c1">// å¤„ç†å¼‚å¸¸e1</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">eN</span><span class="p">){</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">    </span><span class="c1">// å¤„ç†å¼‚å¸¸eN</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="p">}</span>
</span></code></pre></div> <p>å½“ try ä»£ç å—ç»“æŸæ—¶ï¼Œè‡ªåŠ¨é‡Šæ”¾èµ„æºã€‚ä¸å†éœ€è¦æ˜¾å¼çš„è°ƒç”¨ close() æ–¹æ³•ï¼Œè¯¥å½¢å¼ä¹Ÿç§°ä¸ºâ€œå¸¦èµ„æºçš„ try è¯­å¥â€ã€‚</p> <p>æ³¨æ„ï¼š</p> <ol> <li>try è¯­å¥ä¸­å£°æ˜çš„èµ„æºè¢«éšå¼å£°æ˜ä¸º finalï¼Œèµ„æºçš„ä½œç”¨å±€é™äºå¸¦èµ„æºçš„ try è¯­å¥ã€‚</li> <li>å¯ä»¥åœ¨ä¸€æ¡ try è¯­å¥ä¸­å£°æ˜æˆ–åˆå§‹åŒ–å¤šä¸ªèµ„æºï¼Œæ¯ä¸ªèµ„æºä»¥<code>;</code>éš”å¼€å³å¯ã€‚</li> <li>éœ€è¦å…³é—­çš„èµ„æºå¿…é¡»å®ç°äº† AutoCloseable æˆ– Closeable æ¥å£ã€‚</li> </ol> <p>Closeable æ˜¯ AutoCloseable çš„å­æ¥å£ï¼ŒCloseable æ¥å£é‡Œçš„ close() æ–¹æ³•å£°æ˜æŠ›å‡ºäº† IOExceptionï¼Œå› æ­¤å®ƒçš„å®ç°ç±»åœ¨å®ç° close() æ–¹æ³•æ—¶åªèƒ½å£°æ˜æŠ›å‡º IOException æˆ–å…¶å­ç±»ï¼›AutoCloseable æ¥å£é‡Œçš„ close() æ–¹æ³•å£°æ˜æŠ›å‡ºäº† Exceptionï¼Œå› æ­¤å®ƒçš„å®ç°ç±»åœ¨å®ç° close() æ–¹æ³•æ—¶å¯ä»¥å£°æ˜æŠ›å‡ºä»»ä½•å¼‚å¸¸ã€‚</p> <p>ä¸‹é¢ç¤ºèŒƒå¦‚ä½•ä½¿ç”¨è‡ªåŠ¨å…³é—­èµ„æºçš„ try è¯­å¥ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AutoCloseTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">                </span><span class="c1">// å£°æ˜ã€åˆå§‹åŒ–ä¸¤ä¸ªå¯å…³é—­çš„èµ„æº</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">                </span><span class="c1">// tryè¯­å¥ä¼šè‡ªåŠ¨å…³é—­è¿™ä¸¤ä¸ªèµ„æº</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">                </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">br</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FileReader</span><span class="p">(</span><span class="s">"AutoCloseTest.java"</span><span class="p">));</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">                </span><span class="n">PrintStream</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PrintStream</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">"a.txt"</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">            </span><span class="c1">// ä½¿ç”¨ä¸¤ä¸ªèµ„æº</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">br</span><span class="p">.</span><span class="na">readLine</span><span class="p">());</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Orichalcos"</span><span class="p">);</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ç¨‹åºä¸­ç²—ä½“å­—ä»£ç åˆ†åˆ«å£°æ˜ã€åˆå§‹åŒ–äº†ä¸¤ä¸ª IO æµï¼ŒBufferedReader å’Œ PrintStream éƒ½å®ç°äº† Closeable æ¥å£ï¼Œå¹¶åœ¨ try è¯­å¥ä¸­è¿›è¡Œäº†å£°æ˜å’Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥ try è¯­å¥ä¼šè‡ªåŠ¨å…³é—­å®ƒä»¬ã€‚</p> <p>è‡ªåŠ¨å…³é—­èµ„æºçš„ try è¯­å¥ç›¸å½“äºåŒ…å«äº†éšå¼çš„ finally å—ï¼ˆè¿™ä¸ª finally å—ç”¨äºå…³é—­èµ„æºï¼‰ï¼Œå› æ­¤è¿™ä¸ª try è¯­å¥å¯ä»¥æ—¢æ²¡æœ‰ catch å—ï¼Œä¹Ÿæ²¡æœ‰ finally å—ã€‚</p> <p>Java 7 å‡ ä¹æŠŠæ‰€æœ‰çš„â€œèµ„æºç±»â€ï¼ˆåŒ…æ‹¬æ–‡ä»¶ IO çš„å„ç§ç±»ã€JDBC ç¼–ç¨‹çš„ Connection å’Œ Statement ç­‰æ¥å£ï¼‰è¿›è¡Œäº†æ”¹å†™ï¼Œæ”¹å†™åçš„èµ„æºç±»éƒ½å®ç°äº† AutoCloseable æˆ– Closeable æ¥å£ã€‚</p> <p>å¦‚æœç¨‹åºéœ€è¦ï¼Œè‡ªåŠ¨å…³é—­èµ„æºçš„ try è¯­å¥åä¹Ÿå¯ä»¥å¸¦å¤šä¸ª catch å—å’Œä¸€ä¸ª finally å—ã€‚</p> <p>Java 9 å†æ¬¡å¢å¼ºäº†è¿™ç§ try è¯­å¥ã€‚Java 9 ä¸è¦æ±‚åœ¨ try åçš„åœ†æ‹¬å·å†…å£°æ˜å¹¶åˆ›å»ºèµ„æºï¼Œåªéœ€è¦è‡ªåŠ¨å…³é—­çš„èµ„æºæœ‰ final ä¿®é¥°æˆ–è€…æ˜¯æœ‰æ•ˆçš„ final (effectively final)ï¼ŒJava 9 å…è®¸å°†èµ„æºå˜é‡æ”¾åœ¨ try åçš„åœ†æ‹¬å·å†…ã€‚ä¸Šé¢ç¨‹åºåœ¨ Java 9 ä¸­å¯æ”¹å†™ä¸ºå¦‚ä¸‹å½¢å¼ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AutoCloseTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">        </span><span class="c1">// æœ‰finalä¿®é¥°çš„èµ„æº</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">br</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FileReader</span><span class="p">(</span><span class="s">"AutoCloseTest.java"</span><span class="p">));</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">        </span><span class="c1">// æ²¡æœ‰æ˜¾å¼ä½¿ç”¨finalä¿®é¥°ï¼Œä½†åªè¦ä¸å¯¹è¯¥å˜é‡é‡æ–°èµ‹å€¼ï¼Œè¯¥å˜é‡å°±æ˜¯æœ‰æ•ˆçš„</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">PrintStream</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PrintStream</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">"a. txt"</span><span class="p">));</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">        </span><span class="c1">// åªè¦å°†ä¸¤ä¸ªèµ„æºæ”¾åœ¨tryåçš„åœ†æ‹¬å·å†…å³å¯</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">br</span><span class="p">;</span><span class="w"> </span><span class="n">ps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">            </span><span class="c1">// ä½¿ç”¨ä¸¤ä¸ªèµ„æº</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">br</span><span class="p">.</span><span class="na">readLine</span><span class="p">());</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Orichalcos"</span><span class="p">);</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="p">}</span>
</span></code></pre></div> <h3 id="88å£°æ˜å’ŒæŠ›å‡ºå¼‚å¸¸">8.8ã€å£°æ˜å’ŒæŠ›å‡ºå¼‚å¸¸<a class="headerlink" href="#88å£°æ˜å’ŒæŠ›å‡ºå¼‚å¸¸" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Java ä¸­çš„å¼‚å¸¸å¤„ç†é™¤äº†æ•è·å¼‚å¸¸å’Œå¤„ç†å¼‚å¸¸ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬å£°æ˜å¼‚å¸¸å’Œæ‹‹å‡ºå¼‚å¸¸ã€‚å®ç°å£°æ˜å’ŒæŠ›å‡ºå¼‚å¸¸çš„å…³é”®å­—éå¸¸ç›¸ä¼¼ï¼Œå®ƒä»¬æ˜¯ throws å’Œ throwã€‚<mark>å¯ä»¥é€šè¿‡ throws å…³é”®å­—åœ¨æ–¹æ³•ä¸Šå£°æ˜è¯¥æ–¹æ³•è¦æ‹‹å‡ºçš„å¼‚å¸¸ï¼Œ==ç„¶å==åœ¨æ–¹æ³•å†…éƒ¨é€šè¿‡ throw æ‹‹å‡ºå¼‚å¸¸å¯¹è±¡ã€‚</mark></p> <h4 id="881throws-å£°æ˜å¼‚å¸¸">8.8.1ã€throws å£°æ˜å¼‚å¸¸<a class="headerlink" href="#881throws-å£°æ˜å¼‚å¸¸" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>å½“ä¸€ä¸ªæ–¹æ³•äº§ç”Ÿä¸€ä¸ªå®ƒä¸å¤„ç†çš„å¼‚å¸¸æ—¶ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨è¯¥æ–¹æ³•çš„å¤´éƒ¨å£°æ˜è¿™ä¸ªå¼‚å¸¸ï¼Œä»¥ä¾¿å°†è¯¥å¼‚å¸¸ä¼ é€’åˆ°æ–¹æ³•çš„å¤–éƒ¨è¿›è¡Œå¤„ç†ã€‚ä½¿ç”¨ throws å£°æ˜çš„æ–¹æ³•è¡¨ç¤ºæ­¤æ–¹æ³•ä¸å¤„ç†å¼‚å¸¸ã€‚throws å…·ä½“æ ¼å¼å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">returnType</span><span class="w"> </span><span class="nf">method_name</span><span class="p">(</span><span class="n">paramList</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">Exception2</span><span class="p">,</span><span class="err">â€¦</span><span class="p">{</span><span class="err">â€¦</span><span class="p">}</span>
</span></code></pre></div> <p>å…¶ä¸­ï¼ŒreturnType è¡¨ç¤ºè¿”å›å€¼ç±»å‹ï¼›method_name è¡¨ç¤ºæ–¹æ³•åï¼›paramList è¡¨ç¤ºå‚æ•°åˆ—è¡¨ï¼›Exception 1ï¼ŒException2ï¼Œâ€¦ è¡¨ç¤ºå¼‚å¸¸ç±»ã€‚</p> <p>==å¦‚æœæœ‰å¤šä¸ªå¼‚å¸¸ç±»ï¼Œå®ƒä»¬ä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚==è¿™äº›å¼‚å¸¸ç±»å¯ä»¥æ˜¯æ–¹æ³•ä¸­è°ƒç”¨äº†å¯èƒ½æ‹‹å‡ºå¼‚å¸¸çš„æ–¹æ³•è€Œäº§ç”Ÿçš„å¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥æ˜¯æ–¹æ³•ä½“ä¸­ç”Ÿæˆå¹¶æ‹‹å‡ºçš„å¼‚å¸¸ã€‚</p> <p>ä½¿ç”¨ throws å£°æ˜æŠ›å‡ºå¼‚å¸¸çš„æ€è·¯æ˜¯ï¼Œå½“å‰æ–¹æ³•ä¸çŸ¥é“å¦‚ä½•å¤„ç†è¿™ç§ç±»å‹çš„å¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸åº”è¯¥ç”±å‘ä¸Šä¸€çº§çš„è°ƒç”¨è€…å¤„ç†ï¼›å¦‚æœ main æ–¹æ³•ä¹Ÿä¸çŸ¥é“å¦‚ä½•å¤„ç†è¿™ç§ç±»å‹çš„å¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ throws å£°æ˜æŠ›å‡ºå¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸å°†äº¤ç»™ JVM å¤„ç†ã€‚JVM å¯¹å¼‚å¸¸çš„å¤„ç†æ–¹æ³•æ˜¯ï¼Œæ‰“å°å¼‚å¸¸çš„è·Ÿè¸ªæ ˆä¿¡æ¯ï¼Œå¹¶ä¸­æ­¢ç¨‹åºè¿è¡Œï¼Œè¿™å°±æ˜¯å‰é¢ç¨‹åºåœ¨é‡åˆ°å¼‚å¸¸åè‡ªåŠ¨ç»“æŸçš„åŸå› ã€‚</p> <p>åˆ›å»ºä¸€ä¸ª readFile() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºè¯»å–æ–‡ä»¶å†…å®¹ï¼Œåœ¨è¯»å–çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿ IOException å¼‚å¸¸ï¼Œä½†æ˜¯åœ¨è¯¥æ–¹æ³•ä¸­ä¸åšä»»ä½•çš„å¤„ç†ï¼Œè€Œå°†å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸äº¤ç»™è°ƒç”¨è€…å¤„ç†ã€‚åœ¨ main() æ–¹æ³•ä¸­ä½¿ç”¨ try catch æ•è·å¼‚å¸¸ï¼Œå¹¶è¾“å‡ºå¼‚å¸¸ä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test04</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">readFile</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">        </span><span class="c1">// å®šä¹‰æ–¹æ³•æ—¶å£°æ˜å¼‚å¸¸</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">"read.txt"</span><span class="p">);</span><span class="w"> </span><span class="c1">// åˆ›å»º FileInputStream å®ä¾‹å¯¹è±¡</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="na">read</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="n">f</span><span class="p">);</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">            </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="na">read</span><span class="p">();</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">        </span><span class="n">file</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">        </span><span class="n">Throws</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Test04</span><span class="p">();</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">            </span><span class="n">t</span><span class="p">.</span><span class="na">readFile</span><span class="p">();</span><span class="w"> </span><span class="c1">// è°ƒç”¨ readFHe()æ–¹æ³•</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">            </span><span class="c1">// æ•è·å¼‚å¸¸</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="p">}</span>
</span></code></pre></div> <p>ä»¥ä¸Šä»£ç ï¼Œé¦–å…ˆåœ¨å®šä¹‰ readFile() æ–¹æ³•æ—¶ç”¨ throws å…³é”®å­—å£°æ˜åœ¨è¯¥æ–¹æ³•ä¸­å¯èƒ½äº§ç”Ÿçš„å¼‚å¸¸ï¼Œç„¶ååœ¨ main() æ–¹æ³•ä¸­è°ƒç”¨ readFile() æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ catch è¯­å¥æ•è·äº§ç”Ÿçš„å¼‚å¸¸ã€‚</p> <hr> <p><strong>æ–¹æ³•é‡å†™æ—¶å£°æ˜æŠ›å‡ºå¼‚å¸¸çš„é™åˆ¶</strong></p> <p>ä½¿ç”¨ throws å£°æ˜æŠ›å‡ºå¼‚å¸¸æ—¶æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œæ˜¯æ–¹æ³•é‡å†™ä¸­çš„ä¸€æ¡è§„åˆ™ï¼š==å­ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹åº”è¯¥æ˜¯çˆ¶ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹çš„å­ç±»æˆ–ç›¸åŒï¼Œå­ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ä¸å…è®¸æ¯”çˆ¶ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸å¤šã€‚==çœ‹å¦‚ä¸‹ç¨‹åºã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OverrideThrows</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">"a.txt"</span><span class="p">);</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="p">}</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="kd">class</span> <span class="nc">Sub</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">OverrideThrows</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">    </span><span class="c1">// å­ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºäº†æ¯”çˆ¶ç±»æ–¹æ³•æ›´å¤§çš„å¼‚å¸¸</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">    </span><span class="c1">// æ‰€ä»¥ä¸‹é¢æ–¹æ³•å‡ºé”™</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ç¨‹åºä¸­ Sub å­ç±»ä¸­çš„ test() æ–¹æ³•å£°æ˜æŠ›å‡º Exceptionï¼Œè¯¥ Exception æ˜¯å…¶çˆ¶ç±»å£°æ˜æŠ›å‡ºå¼‚å¸¸ IOException ç±»çš„çˆ¶ç±»ï¼Œè¿™å°†å¯¼è‡´ç¨‹åºæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</p> <p>æ‰€ä»¥åœ¨ç¼–å†™ç±»ç»§æ‰¿ä»£ç æ—¶è¦æ³¨æ„ï¼Œå­ç±»åœ¨é‡å†™çˆ¶ç±»å¸¦ throws å­å¥çš„æ–¹æ³•æ—¶ï¼Œå­ç±»æ–¹æ³•å£°æ˜ä¸­çš„ throws å­å¥ä¸èƒ½å‡ºç°çˆ¶ç±»å¯¹åº”æ–¹æ³•çš„ throws å­å¥ä¸­æ²¡æœ‰çš„å¼‚å¸¸ç±»å‹ï¼Œå› æ­¤ throws å­å¥å¯ä»¥é™åˆ¶å­ç±»çš„è¡Œä¸ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç±»æ–¹æ³•æ‹‹å‡ºçš„å¼‚å¸¸ä¸èƒ½è¶…è¿‡çˆ¶ç±»å®šä¹‰çš„èŒƒå›´ã€‚</p> <h4 id="882throw-æ‹‹å‡ºå¼‚å¸¸">8.8.2ã€throw æ‹‹å‡ºå¼‚å¸¸<a class="headerlink" href="#882throw-æ‹‹å‡ºå¼‚å¸¸" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>ä¸ throws ä¸åŒçš„æ˜¯ï¼Œ==throw è¯­å¥ç”¨æ¥ç›´æ¥æ‹‹å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œ==åæ¥ä¸€ä¸ªå¯æ‹‹å‡ºçš„å¼‚å¸¸ç±»å¯¹è±¡ï¼Œå…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">throw</span><span class="w"> </span><span class="n">ExceptionObject</span><span class="p">;</span>
</span></code></pre></div> <p>å…¶ä¸­ï¼ŒExceptionObject å¿…é¡»æ˜¯ Throwable ç±»æˆ–å…¶å­ç±»çš„å¯¹è±¡ã€‚å¦‚æœæ˜¯è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œä¹Ÿå¿…é¡»æ˜¯ Throwable çš„ç›´æ¥æˆ–é—´æ¥å­ç±»ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹è¯­å¥åœ¨ç¼–è¯‘æ—¶å°†ä¼šäº§ç”Ÿè¯­æ³•é”™è¯¯ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="s">"æ‹‹å‡ºå¼‚å¸¸"</span><span class="p">);</span><span class="w">    </span><span class="c1">// Stringç±»ä¸æ˜¯Throwableç±»çš„å­ç±»</span>
</span></code></pre></div> <p>å½“ throw è¯­å¥æ‰§è¡Œæ—¶ï¼Œå®ƒåé¢çš„è¯­å¥å°†ä¸æ‰§è¡Œï¼Œæ­¤æ—¶ç¨‹åºè½¬å‘è°ƒç”¨è€…ç¨‹åºï¼Œå¯»æ‰¾ä¸ä¹‹ç›¸åŒ¹é…çš„ catch è¯­å¥ï¼Œæ‰§è¡Œç›¸åº”çš„å¼‚å¸¸å¤„ç†ç¨‹åºã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸åŒ¹é…çš„ catch è¯­å¥ï¼Œåˆ™å†è½¬å‘ä¸Šä¸€å±‚çš„è°ƒç”¨ç¨‹åºã€‚è¿™æ ·é€å±‚å‘ä¸Šï¼Œç›´åˆ°æœ€å¤–å±‚çš„å¼‚å¸¸å¤„ç†ç¨‹åºç»ˆæ­¢ç¨‹åºå¹¶æ‰“å°å‡ºè°ƒç”¨æ ˆæƒ…å†µã€‚</p> <p>throw å…³é”®å­—ä¸ä¼šå•ç‹¬ä½¿ç”¨ï¼Œå®ƒçš„ä½¿ç”¨å®Œå…¨ç¬¦åˆå¼‚å¸¸çš„å¤„ç†æœºåˆ¶ï¼Œä½†æ˜¯ï¼Œä¸€èˆ¬æ¥è®²ç”¨æˆ·éƒ½åœ¨é¿å…å¼‚å¸¸çš„äº§ç”Ÿï¼Œæ‰€ä»¥ä¸ä¼šæ‰‹å·¥æŠ›å‡ºä¸€ä¸ªæ–°çš„å¼‚å¸¸ç±»çš„å®ä¾‹ï¼Œè€Œå¾€å¾€ä¼šæŠ›å‡ºç¨‹åºä¸­å·²ç»äº§ç”Ÿçš„å¼‚å¸¸ç±»çš„å®ä¾‹ã€‚</p> <p>åœ¨æŸä»“åº“ç®¡ç†ç³»ç»Ÿä¸­ï¼Œè¦æ±‚ç®¡ç†å‘˜çš„ç”¨æˆ·åéœ€è¦ç”± 8 ä½ä»¥ä¸Šçš„å­—æ¯æˆ–è€…æ•°å­—ç»„æˆï¼Œä¸èƒ½å«æœ‰å…¶ä»–çš„å­—ç¬¦ã€‚å½“é•¿åº¦åœ¨ 8 ä½ä»¥ä¸‹æ—¶æ‹‹å‡ºå¼‚å¸¸ï¼Œå¹¶æ˜¾ç¤ºå¼‚å¸¸ä¿¡æ¯ï¼›å½“å­—ç¬¦å«æœ‰éå­—æ¯æˆ–è€…æ•°å­—æ—¶ï¼ŒåŒæ ·æ‹‹å‡ºå¼‚å¸¸ï¼Œæ˜¾ç¤ºå¼‚å¸¸ä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test05</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">validateUserName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">username</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">            </span><span class="c1">// åˆ¤æ–­ç”¨æˆ·åé•¿åº¦æ˜¯å¦å¤§äº8ä½</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">username</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">                </span><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">username</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="c1">// è·å–æ¯ä¸€ä½å­—ç¬¦</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">'0'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">'9'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">'a'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">'z'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">'A'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">'Z'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">                    </span><span class="n">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">                    </span><span class="n">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">"ç”¨æˆ·ååªèƒ½ç”±å­—æ¯å’Œæ•°å­—ç»„æˆï¼"</span><span class="p">);</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">"ç”¨æˆ·åé•¿åº¦å¿…é¡»å¤§äº 8 ä½ï¼"</span><span class="p">);</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">con</span><span class="p">;</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">        </span><span class="n">Test05</span><span class="w"> </span><span class="n">te</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Test05</span><span class="p">();</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="w">        </span><span class="n">Scanner</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Scanner</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">);</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¯·è¾“å…¥ç”¨æˆ·åï¼š"</span><span class="p">);</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">te</span><span class="p">.</span><span class="na">validateUserName</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">con</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"ç”¨æˆ·åè¾“å…¥æ­£ç¡®ï¼"</span><span class="p">);</span>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="p">}</span>
</span></code></pre></div> <p>å¦‚ä¸Šè¿°ä»£ç ï¼Œåœ¨ validateUserName() æ–¹æ³•ä¸­ä¸¤å¤„æ‹‹å‡ºäº† IllegalArgumentException å¼‚å¸¸ï¼Œå³å½“ç”¨æˆ·åå­—ç¬¦å«æœ‰éå­—æ¯æˆ–è€…æ•°å­—ä»¥åŠé•¿åº¦ä¸å¤Ÿ 8 ä½æ—¶ã€‚åœ¨ main() æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº† validateUserName() æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ catch è¯­å¥æ•è·è¯¥æ–¹æ³•å¯èƒ½æ‹‹å‡ºçš„å¼‚å¸¸ã€‚</p> <p>è¿è¡Œç¨‹åºï¼Œå½“ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·ååŒ…å«éå­—æ¯æˆ–è€…æ•°å­—çš„å­—ç¬¦æ—¶ï¼Œç¨‹åºè¾“å‡ºå¼‚å¸¸ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>è¯·è¾“å…¥ç”¨æˆ·åï¼š
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>administrator@#
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>java.lang.IllegalArgumentException: ç”¨æˆ·ååªèƒ½ç”±å­—æ¯å’Œæ•°å­—ç»„æˆï¼
</span></code></pre></div> <p>å½“ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åé•¿åº¦ä¸å¤Ÿ 8 ä½æ—¶ï¼Œç¨‹åºåŒæ ·ä¼šè¾“å‡ºå¼‚å¸¸ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>è¯·è¾“å…¥ç”¨æˆ·åï¼š
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>admin
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>java.lang.IllegalArgumentException: ç”¨æˆ·åé•¿åº¦å¿…é¡»å¤§äº 8 ä½ï¼
</span></code></pre></div> <hr> <p><strong>throws å…³é”®å­—å’Œ throw å…³é”®å­—åœ¨ä½¿ç”¨ä¸Šçš„å‡ ç‚¹åŒºåˆ«å¦‚ä¸‹</strong>ï¼š</p> <ul> <li>throws ç”¨æ¥å£°æ˜ä¸€ä¸ªæ–¹æ³•å¯èƒ½æŠ›å‡ºçš„æ‰€æœ‰å¼‚å¸¸ä¿¡æ¯ï¼Œè¡¨ç¤ºå‡ºç°å¼‚å¸¸çš„ä¸€ç§å¯èƒ½æ€§ï¼Œä½†å¹¶ä¸ä¸€å®šä¼šå‘ç”Ÿè¿™äº›å¼‚å¸¸ï¼›throw åˆ™æ˜¯æŒ‡æ‹‹å‡ºçš„ä¸€ä¸ªå…·ä½“çš„å¼‚å¸¸ç±»å‹ï¼Œæ‰§è¡Œ throw åˆ™ä¸€å®šæŠ›å‡ºäº†æŸç§å¼‚å¸¸å¯¹è±¡ã€‚</li> <li>é€šå¸¸åœ¨ä¸€ä¸ªæ–¹æ³•ï¼ˆç±»ï¼‰çš„å£°æ˜å¤„é€šè¿‡ throws å£°æ˜æ–¹æ³•ï¼ˆç±»ï¼‰å¯èƒ½æ‹‹å‡ºçš„å¼‚å¸¸ä¿¡æ¯ï¼Œè€Œåœ¨æ–¹æ³•ï¼ˆç±»ï¼‰å†…éƒ¨é€šè¿‡ throw å£°æ˜ä¸€ä¸ªå…·ä½“çš„å¼‚å¸¸ä¿¡æ¯ã€‚</li> <li>throws é€šå¸¸ä¸ç”¨æ˜¾ç¤ºåœ°æ•è·å¼‚å¸¸ï¼Œå¯ç”±ç³»ç»Ÿè‡ªåŠ¨å°†æ‰€æœ‰æ•è·çš„å¼‚å¸¸ä¿¡æ¯æŠ›ç»™ä¸Šçº§æ–¹æ³•ï¼› throw åˆ™éœ€è¦ç”¨æˆ·è‡ªå·±æ•è·ç›¸å…³çš„å¼‚å¸¸ï¼Œè€Œåå†å¯¹å…¶è¿›è¡Œç›¸å…³åŒ…è£…ï¼Œæœ€åå°†åŒ…è£…åçš„å¼‚å¸¸ä¿¡æ¯æŠ›å‡ºã€‚</li> </ul> <h3 id="89å¤šå¼‚å¸¸æ•è·">8.9ã€å¤šå¼‚å¸¸æ•è·<a class="headerlink" href="#89å¤šå¼‚å¸¸æ•è·" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å¤š catch ä»£ç å—è™½ç„¶å®¢è§‚ä¸Šæé«˜äº†ç¨‹åºçš„å¥å£®æ€§ï¼Œä½†æ˜¯ä¹Ÿå¯¼è‡´äº†ç¨‹åºä»£ç é‡å¤§å¤§å¢åŠ ã€‚å¦‚æœæœ‰äº›å¼‚å¸¸ç§ç±»ä¸åŒï¼Œä½†æ•è·ä¹‹åçš„å¤„ç†æ˜¯ç›¸åŒçš„ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">try</span><span class="p">{</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">    </span><span class="c1">// å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸çš„è¯­å¥</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="c1">// è°ƒç”¨æ–¹æ³•methodAå¤„ç†</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">    </span><span class="c1">// è°ƒç”¨æ–¹æ³•methodAå¤„ç†</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ParseException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">    </span><span class="c1">// è°ƒç”¨æ–¹æ³•methodAå¤„ç†</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="p">}</span>
</span></code></pre></div> <p>3 ä¸ªä¸åŒç±»å‹çš„å¼‚å¸¸ï¼Œè¦æ±‚æ•è·ä¹‹åçš„å¤„ç†éƒ½æ˜¯è°ƒç”¨ methodA æ–¹æ³•ã€‚ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼ŒJava 7 æ¨å‡ºäº†å¤šå¼‚å¸¸æ•è·æŠ€æœ¯ï¼Œå¯ä»¥æŠŠè¿™äº›å¼‚å¸¸åˆå¹¶å¤„ç†ã€‚ä¸Šè¿°ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">try</span><span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="c1">// å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸çš„è¯­å¥</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ParseException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="c1">// è°ƒç”¨æ–¹æ³•methodAå¤„ç†</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="p">}</span>
</span></code></pre></div> <p>æ³¨æ„ï¼šç”±äº FileNotFoundException å±äº IOException å¼‚å¸¸ï¼ŒIOException å¼‚å¸¸å¯ä»¥æ•è·å®ƒçš„æ‰€æœ‰å­ç±»å¼‚å¸¸ã€‚æ‰€ä»¥ä¸èƒ½å†™æˆ <code>FileNotFoundException | IOException | ParseException</code> ã€‚</p> <p>ä½¿ç”¨ä¸€ä¸ª catch å—æ•è·å¤šç§ç±»å‹çš„å¼‚å¸¸æ—¶éœ€è¦æ³¨æ„å¦‚ä¸‹ä¸¤ä¸ªåœ°æ–¹ã€‚</p> <ul> <li>æ•è·å¤šç§ç±»å‹çš„å¼‚å¸¸æ—¶ï¼Œå¤šç§å¼‚å¸¸ç±»å‹ä¹‹é—´ç”¨ç«–çº¿<code>|</code>éš”å¼€ã€‚</li> <li>æ•è·å¤šç§ç±»å‹çš„å¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸å˜é‡æœ‰éšå¼çš„ final ä¿®é¥°ï¼Œå› æ­¤ç¨‹åºä¸èƒ½å¯¹å¼‚å¸¸å˜é‡é‡æ–°èµ‹å€¼ã€‚</li> </ul> <p>ä¸‹é¢ç¨‹åºç¤ºèŒƒäº† Java 7 æä¾›çš„å¤šå¼‚å¸¸æ•è·ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ExceptionTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ‚¨è¾“å…¥çš„ä¸¤ä¸ªæ•°ç›¸é™¤çš„ç»“æœæ˜¯ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">);</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IndexOutOfBoundsException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NumberFormatException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ArithmeticException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"ç¨‹åºå‘ç”Ÿäº†æ•°ç»„è¶Šç•Œã€æ•°å­—æ ¼å¼å¼‚å¸¸ã€ç®—æœ¯å¼‚å¸¸ä¹‹ä¸€"</span><span class="p">);</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">            </span><span class="c1">// æ•è·å¤šå¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸å˜é‡é»˜è®¤æœ‰finalä¿®é¥°</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">            </span><span class="c1">// æ‰€ä»¥ä¸‹é¢ä»£ç æœ‰é”™</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">            </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArithmeticException</span><span class="p">(</span><span class="s">"test"</span><span class="p">);</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æœªçŸ¥å¼‚å¸¸"</span><span class="p">);</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">            </span><span class="c1">// æ•è·ä¸€ç§ç±»å‹çš„å¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸å˜é‡æ²¡æœ‰finalä¿®é¥°</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w">            </span><span class="c1">// æ‰€ä»¥ä¸‹é¢ä»£ç å®Œå…¨æ­£ç¡®</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="w">            </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">"test"</span><span class="p">);</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ç¨‹åºä¸­ç¬¬ä¸€è¡Œç²—ä½“å­—ä»£ç ä½¿ç”¨äº†<code>IndexOutOfBoundsException|NumberFormatException|ArithmeticException</code>æ¥å®šä¹‰å¼‚å¸¸ç±»å‹ï¼Œè¿™å°±è¡¨æ˜è¯¥ catch å—å¯ä»¥åŒæ—¶æ•è·è¿™ 3 ç§ç±»å‹çš„å¼‚å¸¸ã€‚æ•è·å¤šç§ç±»å‹çš„å¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸å˜é‡ä½¿ç”¨éšå¼çš„ final ä¿®é¥°ï¼Œå› æ­¤ä¸Šé¢ç¨‹åºçš„ç¬¬ 12 è¡Œä»£ç å°†äº§ç”Ÿç¼–è¯‘é”™è¯¯ï¼›æ•è·ä¸€ç§ç±»å‹çš„å¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸å˜é‡æ²¡æœ‰ final ä¿®é¥°ï¼Œå› æ­¤ä¸Šé¢ç¨‹åºçš„ç¬¬ 17 è¡Œä»£ç å®Œå…¨æ­£ç¡®ã€‚</p> <h3 id="810è‡ªå®šä¹‰å¼‚å¸¸">8.10ã€è‡ªå®šä¹‰å¼‚å¸¸<a class="headerlink" href="#810è‡ªå®šä¹‰å¼‚å¸¸" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å¦‚æœ Java æä¾›çš„å†…ç½®å¼‚å¸¸ç±»å‹ä¸èƒ½æ»¡è¶³ç¨‹åºè®¾è®¡çš„éœ€æ±‚ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾è®¡ Java ç±»åº“æˆ–æ¡†æ¶ï¼Œå…¶ä¸­åŒ…æ‹¬å¼‚å¸¸ç±»å‹ã€‚å®ç°è‡ªå®šä¹‰å¼‚å¸¸ç±»éœ€è¦ç»§æ‰¿ Exception ç±»æˆ–å…¶å­ç±»ï¼Œå¦‚æœè‡ªå®šä¹‰è¿è¡Œæ—¶å¼‚å¸¸ç±»éœ€ç»§æ‰¿ RuntimeException ç±»æˆ–å…¶å­ç±»ã€‚</p> <p>è‡ªå®šä¹‰å¼‚å¸¸çš„è¯­æ³•å½¢å¼ä¸ºï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="o">&lt;</span><span class="kd">class</span><span class="err">&gt;&lt;</span><span class="nc">è‡ªå®šä¹‰å¼‚å¸¸å</span><span class="o">&gt;&lt;</span><span class="kd">extends</span><span class="o">&gt;&lt;</span><span class="n">Exception</span><span class="o">&gt;</span>
</span></code></pre></div> <p>åœ¨ç¼–ç è§„èŒƒä¸Šï¼Œä¸€èˆ¬å°†è‡ªå®šä¹‰å¼‚å¸¸ç±»çš„ç±»åå‘½åä¸º XXXExceptionï¼Œå…¶ä¸­ XXX ç”¨æ¥ä»£è¡¨è¯¥å¼‚å¸¸çš„ä½œç”¨ã€‚</p> <p><mark>è‡ªå®šä¹‰å¼‚å¸¸ç±»ä¸€èˆ¬åŒ…å«ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼šä¸€ä¸ªæ˜¯æ— å‚çš„é»˜è®¤æ„é€ æ–¹æ³•ï¼Œå¦ä¸€ä¸ªæ„é€ æ–¹æ³•ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æ¥æ”¶ä¸€ä¸ªå®šåˆ¶çš„å¼‚å¸¸æ¶ˆæ¯ï¼Œå¹¶å°†è¯¥æ¶ˆæ¯ä¼ é€’ç»™è¶…ç±»çš„æ„é€ æ–¹æ³•ã€‚</mark></p> <p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªåç§°ä¸º IntegerRangeException çš„è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kd">class</span> <span class="nc">IntegerRangeException</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">IntegerRangeException</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">        </span><span class="kd">super</span><span class="p">();</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">IntegerRangeException</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="p">}</span>
</span></code></pre></div> <p>ä»¥ä¸Šä»£ç åˆ›å»ºçš„è‡ªå®šä¹‰å¼‚å¸¸ç±» IntegerRangeException ç±»ç»§æ‰¿è‡ª Exception ç±»ï¼Œåœ¨è¯¥ç±»ä¸­åŒ…å«ä¸¤ä¸ªæ„é€ æ–¹æ³•ã€‚</p> <p><mark>æç¤ºï¼šå› ä¸ºè‡ªå®šä¹‰å¼‚å¸¸ç»§æ‰¿è‡ª Exception ç±»ï¼Œå› æ­¤è‡ªå®šä¹‰å¼‚å¸¸ç±»ä¸­åŒ…å«çˆ¶ç±»æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ã€‚</mark></p> <h3 id="811å¼‚å¸¸å¤„ç†è§„åˆ™">8.11ã€å¼‚å¸¸å¤„ç†è§„åˆ™<a class="headerlink" href="#811å¼‚å¸¸å¤„ç†è§„åˆ™" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æˆåŠŸçš„å¼‚å¸¸å¤„ç†åº”è¯¥å®ç°å¦‚ä¸‹ 4 ä¸ªç›®æ ‡ã€‚</p> <ol> <li>ä½¿ç¨‹åºä»£ç æ··ä¹±æœ€å°åŒ–ã€‚</li> <li>æ•è·å¹¶ä¿ç•™è¯Šæ–­ä¿¡æ¯ã€‚</li> <li>é€šçŸ¥åˆé€‚çš„äººå‘˜ã€‚</li> <li>é‡‡ç”¨åˆé€‚çš„æ–¹å¼ç»“æŸå¼‚å¸¸æ´»åŠ¨ã€‚</li> </ol> <hr> <p><strong>ä¸è¦è¿‡åº¦ä½¿ç”¨å¼‚å¸¸</strong></p> <p>ä¸å¯å¦è®¤ï¼ŒJava çš„å¼‚å¸¸æœºåˆ¶ç¡®å®æ–¹ä¾¿ï¼Œä½†æ»¥ç”¨å¼‚å¸¸æœºåˆ¶ä¹Ÿä¼šå¸¦æ¥ä¸€äº›è´Ÿé¢å½±å“ã€‚è¿‡åº¦ä½¿ç”¨å¼‚å¸¸ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š</p> <ol> <li>æŠŠå¼‚å¸¸å’Œæ™®é€šé”™è¯¯æ··æ·†åœ¨ä¸€èµ·ï¼Œä¸å†ç¼–å†™ä»»ä½•é”™è¯¯å¤„ç†ä»£ç ï¼Œè€Œæ˜¯ä»¥ç®€å•åœ°æŠ›å‡ºå¼‚å¸¸æ¥ä»£æ›¿æ‰€æœ‰çš„é”™è¯¯å¤„ç†ã€‚</li> <li>ä½¿ç”¨å¼‚å¸¸å¤„ç†æ¥ä»£æ›¿æµç¨‹æ§åˆ¶ã€‚</li> </ol> <p>ç†Ÿæ‚‰äº†å¼‚å¸¸ä½¿ç”¨æ–¹æ³•åï¼Œç¨‹åºå‘˜å¯èƒ½ä¸å†æ„¿æ„ç¼–å†™çƒ¦ççš„é”™è¯¯å¤„ç†ä»£ç ï¼Œè€Œæ˜¯ç®€å•åœ°æŠ›å‡ºå¼‚å¸¸ã€‚å®é™…ä¸Šè¿™æ ·åšæ˜¯ä¸å¯¹çš„ï¼Œå¯¹äºå®Œå…¨å·²çŸ¥å’Œæ™®é€šçš„é”™è¯¯ï¼Œåº”è¯¥ç¼–å†™å¤„ç†è¿™ç§é”™è¯¯å¤„ç†ä»£ç ï¼Œå¢åŠ ç¨‹åºçš„å¥å£®æ€§ï¼›åªæœ‰å¯¹å¤–éƒ¨çš„ã€ä¸èƒ½ç¡®å®šå’Œé¢„çŸ¥çš„è¿è¡Œæ—¶é”™è¯¯æ‰ä½¿ç”¨å¼‚å¸¸ã€‚</p> <p>å¼‚å¸¸å¤„ç†æœºåˆ¶çš„æ•ˆç‡æ¯”æ­£å¸¸çš„æµç¨‹æ§åˆ¶æ•ˆç‡å·®ï¼Œæ‰€ä»¥ä¸è¦ä½¿ç”¨å¼‚å¸¸å¤„ç†æ¥ä»£æ›¿æ­£å¸¸çš„ç¨‹åºæµç¨‹æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹ä»£ç ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1">// å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"Hello"</span><span class="p">,</span><span class="w"> </span><span class="s">"Java"</span><span class="p">,</span><span class="w"> </span><span class="s">"Spring"</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="c1">// ä½¿ç”¨å¼‚å¸¸å¤„ç†æ¥éå†arræ•°ç»„çš„æ¯ä¸ªå…ƒç´ </span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">++]</span><span class="p">);</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ArrayIndexOutOfBoundsException</span><span class="w"> </span><span class="n">ae</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œä¸Šé¢ç¨‹åºç¡®å®å¯ä»¥å®ç°éå† arr æ•°ç»„å…ƒç´ çš„åŠŸèƒ½ï¼Œä½†è¿™ç§å†™æ³•å¯è¯»æ€§è¾ƒå·®ï¼Œè€Œä¸”è¿è¡Œæ•ˆç‡ä¹Ÿä¸é«˜ã€‚ç¨‹åºå®Œå…¨æœ‰èƒ½åŠ›é¿å…äº§ç”Ÿ ArrayIndexOutOfBoundsException å¼‚å¸¸ï¼Œç¨‹åºâ€œæ•…æ„â€åˆ¶é€ è¿™ç§å¼‚å¸¸ï¼Œç„¶åä½¿ç”¨ catch å—å»æ•è·è¯¥å¼‚å¸¸ï¼Œè¿™æ˜¯ä¸åº”è¯¥çš„ã€‚å°†ç¨‹åºæ”¹ä¸ºå¦‚ä¸‹å½¢å¼è‚¯å®šè¦å¥½å¾—å¤šã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">String</span><span class="w"> </span><span class="n">arr</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">"Hello"</span><span class="p">,</span><span class="s">"Java"</span><span class="p">,</span><span class="s">"Spring"</span><span class="p">};</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">arr</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="p">}</span>
</span></code></pre></div> <p>å¼‚å¸¸åªåº”è¯¥ç”¨äºå¤„ç†éæ­£å¸¸çš„æƒ…å†µï¼Œä¸è¦ä½¿ç”¨å¼‚å¸¸å¤„ç†æ¥ä»£æ›¿æ­£å¸¸çš„æµç¨‹æ§åˆ¶ã€‚å¯¹äºä¸€äº›å®Œå…¨å¯é¢„çŸ¥ï¼Œè€Œä¸”å¤„ç†æ–¹å¼æ¸…æ¥šçš„é”™è¯¯ï¼Œç¨‹åºåº”è¯¥æä¾›ç›¸åº”çš„é”™è¯¯å¤„ç†ä»£ç ï¼Œè€Œä¸æ˜¯å°†å…¶ç¬¼ç»Ÿåœ°ç§°ä¸ºå¼‚å¸¸ã€‚</p> <hr> <p><strong>ä¸è¦ä½¿ç”¨è¿‡äºåºå¤§çš„tryå—</strong></p> <p>åœ¨ try å—é‡Œæ”¾ç½®å¤§é‡çš„ä»£ç ï¼Œè¿™æ ·çœ‹ä¸Šå»â€œå¾ˆç®€å•â€œï¼Œä½†è¿™ç§â€ç®€å•â€œåªæ˜¯ä¸€ç§å‡è±¡ï¼Œå› ä¸º try å—é‡Œçš„ä»£ç è¿‡äºåºå¤§ï¼Œä¸šåŠ¡è¿‡äºå¤æ‚ï¼Œå°±ä¼šé€ æˆ try å—ä¸­å‡ºç°å¼‚å¸¸çš„å¯èƒ½æ€§å¤§å¤§å¢åŠ ï¼Œä»è€Œå¯¼è‡´åˆ†æå¼‚å¸¸åŸå› çš„éš¾åº¦ä¹Ÿå¤§å¤§å¢åŠ ã€‚è€Œä¸”å½“ try å—è¿‡äºåºå¤§æ—¶ï¼Œå°±éš¾å…åœ¨ try å—åç´§è·Ÿå¤§é‡çš„ catch å—æ‰å¯ä»¥é’ˆå¯¹ä¸åŒçš„å¼‚å¸¸æä¾›ä¸åŒçš„å¤„ç†é€»è¾‘ã€‚åŒä¸€ä¸ª try å—åç´§è·Ÿå¤§é‡çš„ catch å—åˆ™éœ€è¦åˆ†æå®ƒä»¬ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼Œåè€Œå¢åŠ äº†å˜æˆå¤æ‚åº¦ã€‚</p> <p>æ­£ç¡®çš„åšæ³•æ˜¯ï¼ŒæŠŠå¤§å—çš„ try å—åˆ†å‰²æˆå¤šä¸ªå¯èƒ½å‡ºç°å¼‚å¸¸çš„ç¨‹åºæ®µè½ï¼Œå¹¶æŠŠå®ƒä»¬æ”¾åœ¨å•ç‹¬çš„ try å—ä¸­ï¼Œä»è€Œåˆ†åˆ«æ•è·å¹¶å¤„ç†å¼‚å¸¸ã€‚</p> <hr> <p><strong>é¿å…ä½¿ç”¨ Catch All è¯­å¥</strong></p> <p>æ‰€è°“ Catch All è¯­å¥æŒ‡çš„æ˜¯ä¸€ç§å¼‚å¸¸æ•è·æ¨¡å—ï¼Œå®ƒå¯ä»¥å¤„ç†ç¨‹åºå‘ç”Ÿçš„æ‰€æœ‰å¯èƒ½å¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹ä»£ç ç‰‡æ®µï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">    </span><span class="c1">// å¯èƒ½å¼•å‘Checkedå¼‚å¸¸çš„ä»£ç </span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwsble</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="c1">// è¿›è¡Œå¼‚å¸¸å¤„ç†</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸å¯å¦è®¤ï¼Œæ¯ä¸ªç¨‹åºå‘˜éƒ½æ›¾ç»ç”¨è¿‡è¿™ç§å¼‚å¸¸å¤„ç†æ–¹å¼ï¼Œä½†åœ¨ç¼–å†™å…³é”®ç¨‹åºæ—¶å°±åº”é¿å…ä½¿ç”¨è¿™ç§å¼‚å¸¸å¤„ç†æ–¹å¼ã€‚è¿™ç§å¤„ç†æ–¹å¼æœ‰å¦‚ä¸‹ä¸¤ç‚¹ä¸è¶³ä¹‹å¤„ã€‚</p> <ol> <li>æ‰€æœ‰çš„å¼‚å¸¸éƒ½é‡‡ç”¨ç›¸åŒçš„å¤„ç†æ–¹å¼ï¼Œè¿™å°†å¯¼è‡´æ— æ³•å¯¹ä¸åŒçš„å¼‚å¸¸åˆ†æƒ…å†µå¤„ç†ï¼Œå¦‚æœè¦åˆ†æƒ…å†µå¤„ç†ï¼Œåˆ™éœ€è¦åœ¨ catch å—ä¸­ä½¿ç”¨åˆ†æ”¯è¯­å¥è¿›è¡Œæ§åˆ¶ï¼Œè¿™æ˜¯å¾—ä¸å¿å¤±çš„åšæ³•ã€‚</li> <li>è¿™ç§æ•è·æ–¹å¼å¯èƒ½å°†ç¨‹åºä¸­çš„é”™è¯¯ã€Runtime å¼‚å¸¸ç­‰å¯èƒ½å¯¼è‡´ç¨‹åºç»ˆæ­¢çš„æƒ…å†µå…¨éƒ¨æ•è·åˆ°ï¼Œä»è€Œâ€œå‹åˆ¶â€äº†å¼‚å¸¸ã€‚å¦‚æœå‡ºç°äº†ä¸€äº›â€œå…³é”®â€å¼‚å¸¸ï¼Œé‚£ä¹ˆæ­¤å¼‚å¸¸ä¹Ÿä¼šè¢«â€œé™æ‚„æ‚„â€åœ°å¿½ç•¥ã€‚</li> </ol> <p>å®é™…ä¸Šï¼ŒCatch All è¯­å¥ä¸è¿‡æ˜¯ä¸€ç§é€šè¿‡é¿å…é”™è¯¯å¤„ç†è€ŒåŠ å¿«ç¼–ç¨‹è¿›åº¦çš„æœºåˆ¶ï¼Œåº”å°½é‡é¿å…åœ¨å®é™…åº”ç”¨ä¸­ä½¿ç”¨è¿™ç§è¯­å¥ã€‚</p> <hr> <p><strong>ä¸è¦å¿½ç•¥æ•è·åˆ°çš„å¼‚å¸¸</strong></p> <p>ä¸è¦å¿½ç•¥å¼‚å¸¸ï¼Œæ—¢ç„¶å·²æ•è·åˆ°å¼‚å¸¸ï¼Œé‚£ catch å—ç†åº”å¤„ç†å¹¶ä¿®å¤è¿™ä¸ªé”™è¯¯ã€‚catch å—æ•´ä¸ªä¸ºç©ºï¼Œæˆ–è€…ä»…ä»…æ‰“å°å‡ºé”™ä¿¡æ¯éƒ½æ˜¯ä¸å¦¥çš„ã€‚ç¨‹åºå‡ºäº†é”™è¯¯ï¼Œæ‰€æœ‰çš„äººéƒ½çœ‹ä¸åˆ°ä»»ä½•å¼‚å¸¸ï¼Œä½†æ•´ä¸ªåº”ç”¨å¯èƒ½å·²ç»å½»åº•åäº†ï¼Œè¿™æ˜¯æœ€å¯æ€•çš„äº‹æƒ…ã€‚</p> <p>å¯¹å¼‚å¸¸è¿›è¡Œåˆé€‚çš„ä¿®å¤ï¼Œç„¶åç»•è¿‡å¼‚å¸¸å‘ç”Ÿçš„åœ°æ–¹ç»§ç»­æ‰§è¡Œï¼›æˆ–è€…ç”¨åˆ«çš„æ•°æ®è¿›è¡Œè®¡ç®—ï¼Œä»¥ä»£æ›¿æœŸæœ›çš„æ–¹æ³•è¿”å›å€¼ï¼›æˆ–è€…æç¤ºç”¨æˆ·é‡æ–°æ“ä½œç­‰ã€‚æ€»ä¹‹ï¼Œå¯¹äº Checked å¼‚å¸¸ï¼Œç¨‹åºåº”è¯¥å°½é‡ä¿®å¤ã€‚</p> <h3 id="812å¼‚å¸¸è·Ÿè¸ªæ ˆ">8.12ã€å¼‚å¸¸è·Ÿè¸ªæ ˆ<a class="headerlink" href="#812å¼‚å¸¸è·Ÿè¸ªæ ˆ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å¼‚å¸¸å¯¹è±¡çš„ printStackTrace() æ–¹æ³•ç”¨äºæ‰“å°å¼‚å¸¸çš„è·Ÿè¸ªæ ˆä¿¡æ¯ï¼Œæ ¹æ® printStackTrace() æ–¹æ³•çš„è¾“å‡ºç»“æœï¼Œå¼€å‘è€…å¯ä»¥æ‰¾åˆ°å¼‚å¸¸çš„æºå¤´ï¼Œå¹¶è·Ÿè¸ªåˆ°å¼‚å¸¸ä¸€è·¯è§¦å‘çš„è¿‡ç¨‹ã€‚</p> <p>çœ‹ä¸‹é¢ç”¨äºæµ‹è¯• printStackTrace çš„ä¾‹å­ç¨‹åºã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kd">class</span> <span class="nc">SelfException</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">RuntimeException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">    </span><span class="n">SelfException</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">    </span><span class="n">SelfException</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="p">}</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PrintStackTraceTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">        </span><span class="n">firstMethod</span><span class="p">();</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">firstMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w">        </span><span class="n">secondMethod</span><span class="p">();</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">secondMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="w">        </span><span class="n">thirdMethod</span><span class="p">();</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">thirdMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SelfException</span><span class="p">(</span><span class="s">"è‡ªå®šä¹‰å¼‚å¸¸ä¿¡æ¯"</span><span class="p">);</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ç¨‹åºä¸­ main æ–¹æ³•è°ƒç”¨ firstMethodï¼ŒfirstMethod è°ƒç”¨ secondMethodï¼ŒsecondMethod è°ƒç”¨ thirdMethodï¼ŒthirdMethod ç›´æ¥æŠ›å‡ºä¸€ä¸ª SelfException å¼‚å¸¸ã€‚è¿è¡Œä¸Šé¢ç¨‹åºï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ç»“æœã€‚</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>Exception in thread "main" Test.SelfException: è‡ªå®šä¹‰å¼‚å¸¸ä¿¡æ¯
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>        at Test.PrintStackTraceTest.thirdMethod(PrintStackTraceTest.java:26)
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>        at Test.PrintStackTraceTest.secondMethod(PrintStackTraceTest.java:22)
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>        at Test.PrintStackTraceTest.firstMethod(PrintStackTraceTest.java:18)
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>        at Test.PrintStackTraceTest.main(PrintStackTraceTest.java:14)
</span></code></pre></div> <p>ä¸Šé¢è¿è¡Œç»“æœçš„ç¬¬ 2 è¡Œåˆ°ç¬¬ 5 è¡Œä¹‹é—´çš„å†…å®¹æ˜¯å¼‚å¸¸è·Ÿè¸ªæ ˆä¿¡æ¯ï¼Œä»æ‰“å°çš„å¼‚å¸¸ä¿¡æ¯æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¼‚å¸¸ä» thirdMethod æ–¹æ³•å¼€å§‹è§¦å‘ï¼Œä¼ åˆ° secondMethod æ–¹æ³•ï¼Œå†ä¼ åˆ° firstMethod æ–¹æ³•ï¼Œæœ€åä¼ åˆ° main æ–¹æ³•ï¼Œåœ¨ main æ–¹æ³•ç»ˆæ­¢ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ Java çš„å¼‚å¸¸è·Ÿè¸ªæ ˆã€‚</p> <p>åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ä¸­ï¼Œå¤§å¤šæ•°å¤æ‚æ“ä½œéƒ½ä¼šè¢«åˆ†è§£æˆä¸€ç³»åˆ—æ–¹æ³•è°ƒç”¨ã€‚è¿™æ˜¯å› ä¸ºå®ç°æ›´å¥½çš„å¯é‡ç”¨æ€§ï¼Œå°†æ¯ä¸ªå¯é‡ç”¨çš„ä»£ç å•å…ƒå®šä¹‰æˆæ–¹æ³•ï¼Œå°†å¤æ‚ä»»åŠ¡é€æ¸åˆ†è§£ä¸ºæ›´æ˜“ç®¡ç†çš„å°å‹å­ä»»åŠ¡ã€‚ç”±äºä¸€ä¸ªå¤§çš„ä¸šåŠ¡åŠŸèƒ½éœ€è¦ç”±å¤šä¸ªå¯¹è±¡æ¥å…±åŒå®ç°ï¼Œåœ¨æœ€ç»ˆç¼–ç¨‹æ¨¡å‹ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡å°†é€šè¿‡ä¸€ç³»åˆ—æ–¹æ³•è°ƒç”¨æ¥å®ç°é€šä¿¡ï¼Œæ‰§è¡Œä»»åŠ¡ã€‚</p> <p>æ‰€ä»¥ï¼Œé¢å‘å¯¹è±¡çš„åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œç»å¸¸ä¼šå‘ç”Ÿä¸€ç³»åˆ—æ–¹æ³•è°ƒç”¨ï¼Œä»è€Œå½¢æˆâ€œæ–¹æ³•è°ƒç”¨æ ˆâ€ï¼Œå¼‚å¸¸çš„ä¼ æ’­åˆ™ç›¸åï¼šåªè¦å¼‚å¸¸æ²¡æœ‰è¢«å®Œå…¨æ•è·ï¼ˆåŒ…æ‹¬å¼‚å¸¸æ²¡æœ‰è¢«æ•è·ï¼Œæˆ–å¼‚å¸¸è¢«å¤„ç†åé‡æ–°æŠ›å‡ºäº†æ–°å¼‚å¸¸ï¼‰ï¼Œå¼‚å¸¸ä»å‘ç”Ÿå¼‚å¸¸çš„æ–¹æ³•é€æ¸å‘å¤–ä¼ æ’­ï¼Œé¦–å…ˆä¼ ç»™è¯¥æ–¹æ³•çš„è°ƒç”¨è€…ï¼Œè¯¥æ–¹æ³•è°ƒç”¨è€…å†æ¬¡ä¼ ç»™å…¶è°ƒç”¨è€…â€¦â€¦ï¼Œç›´è‡³æœ€åä¼ åˆ° main æ–¹æ³•ï¼Œå¦‚æœ main æ–¹æ³•ä¾ç„¶æ²¡æœ‰å¤„ç†è¯¥å¼‚å¸¸ï¼Œåˆ™ JVM ä¼šä¸­æ­¢è¯¥ç¨‹åºï¼Œå¹¶æ‰“å°å¼‚å¸¸çš„è·Ÿè¸ªæ ˆä¿¡æ¯ã€‚</p> <p>å¾ˆå¤šåˆå­¦è€…ä¸€çœ‹åˆ°ä¸Šé¢è¿è¡Œç»“æœçš„å¼‚å¸¸æç¤ºä¿¡æ¯ï¼Œå°±ä¼šæƒŠæ…Œå¤±æªï¼Œå…¶å®ç»“æœä¸­çš„å¼‚å¸¸è·Ÿè¸ªæ ˆä¿¡æ¯éå¸¸æ¸…æ™°ï¼Œå®ƒè®°å½•äº†åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œåœæ­¢çš„å„ä¸ªç‚¹ã€‚</p> <p>å¼‚å¸¸è·Ÿè¸ªæ ˆä¿¡æ¯çš„ç¬¬ä¸€è¡Œä¸€èˆ¬è¯¦ç»†æ˜¾ç¤ºå¼‚å¸¸çš„ç±»å‹å’Œå¼‚å¸¸çš„è¯¦ç»†æ¶ˆæ¯ï¼Œæ¥ä¸‹æ¥æ˜¯æ‰€æœ‰å¼‚å¸¸çš„å‘ç”Ÿç‚¹ï¼Œå„è¡Œæ˜¾ç¤ºè¢«è°ƒç”¨æ–¹æ³•ä¸­æ‰§è¡Œçš„åœæ­¢ä½ç½®ï¼Œå¹¶æ ‡æ˜ç±»ã€ç±»ä¸­çš„æ–¹æ³•åã€ä¸æ•…éšœç‚¹å¯¹åº”çš„æ–‡ä»¶çš„è¡Œã€‚ä¸€è¡Œè¡Œåœ°å¾€ä¸‹çœ‹ï¼Œè·Ÿè¸ªæ ˆæ€»æ˜¯æœ€å†…éƒ¨çš„è¢«è°ƒç”¨æ–¹æ³•é€æ¸ä¸Šä¼ ï¼Œç›´åˆ°æœ€å¤–éƒ¨ä¸šåŠ¡æ“ä½œçš„èµ·ç‚¹ï¼Œé€šå¸¸å°±æ˜¯ç¨‹åºçš„å…¥å£ main æ–¹æ³•æˆ– Thread ç±»çš„ run æ–¹æ³•ï¼ˆå¤šçº¿ç¨‹çš„æƒ…å½¢ï¼‰ã€‚</p> <p>ä¸‹é¢ä¾‹å­ç¨‹åºç¤ºèŒƒäº†å¤šçº¿ç¨‹ç¨‹åºä¸­å‘ç”Ÿå¼‚å¸¸çš„æƒ…å½¢ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ThreadExceptionTest</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">        </span><span class="n">firstMethod</span><span class="p">();</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">firstMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">        </span><span class="n">secondMethod</span><span class="p">();</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">secondMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ThreadExceptionTest</span><span class="p">()).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œä¸Šé¢ç¨‹åºï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹è¿è¡Œç»“æœã€‚</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>Exception in thread "Thread-0" java.lang.ArithmeticException: / by zero
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>            at Test.ThreadExceptionTest.secondMethod(ThreadExceptionTest.java:14)
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>            at Test.ThreadExceptionTest.firstMethod(ThreadExceptionTest.java:8)
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>            at Test.ThreadExceptionTest.run(ThreadExceptionTest.java:4)
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>            at java.lang.Thread.run(Unknown Source)
</span></code></pre></div> <p>å¤šçº¿ç¨‹å¼‚å¸¸çš„è·Ÿè¸ªæ ˆï¼Œä»å‘ç”Ÿå¼‚å¸¸çš„æ–¹æ³•å¼€å§‹ï¼Œåˆ°çº¿ç¨‹çš„ run æ–¹æ³•ç»“æŸã€‚ä»ä¸Šé¢çš„è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œç¨‹åºåœ¨ Thread çš„ run æ–¹æ³•ä¸­å‡ºç°äº† ArithmeticException å¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸çš„æºå¤´æ˜¯ ThreadExcetpionTest çš„ secondMethod æ–¹æ³•ï¼Œä½äº ThreadExcetpionTest.java æ–‡ä»¶çš„ 14 è¡Œã€‚è¿™ä¸ªå¼‚å¸¸ä¼ æ’­åˆ° Thread ç±»çš„ run æ–¹æ³•å°±ä¼šç»“æŸï¼ˆå¦‚æœè¯¥å¼‚å¸¸æ²¡æœ‰å¾—åˆ°å¤„ç†ï¼Œå°†ä¼šå¯¼è‡´è¯¥çº¿ç¨‹ä¸­æ­¢è¿è¡Œï¼‰ã€‚</p> <p>å‰é¢å·²ç»è®²è¿‡ï¼Œè°ƒç”¨ Exception çš„ printStackTrace() æ–¹æ³•å°±æ˜¯æ‰“å°è¯¥å¼‚å¸¸çš„è·Ÿè¸ªæ ˆä¿¡æ¯ï¼Œä¹Ÿå°±ä¼šçœ‹åˆ°ä¸Šé¢ä¸¤ä¸ªç¤ºä¾‹è¿è¡Œç»“æœä¸­çš„ä¿¡æ¯ã€‚å½“ç„¶ï¼Œå¦‚æœæ–¹æ³•è°ƒç”¨çš„å±‚æ¬¡å¾ˆæ·±ï¼Œå°†ä¼šçœ‹åˆ°æ›´åŠ å¤æ‚çš„å¼‚å¸¸è·Ÿè¸ªæ ˆã€‚</p> <p>æç¤ºï¼šè™½ç„¶ printStackTrace() æ–¹æ³•å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç”¨äºè¿½è¸ªå¼‚å¸¸çš„å‘ç”Ÿæƒ…å†µï¼Œå¯ä»¥ç”¨å®ƒæ¥è°ƒè¯•ç¨‹åºï¼Œä½†åœ¨æœ€åå‘å¸ƒçš„ç¨‹åºä¸­ï¼Œåº”è¯¥é¿å…ä½¿ç”¨å®ƒã€‚åº”è¯¥å¯¹æ•è·çš„å¼‚å¸¸è¿›è¡Œé€‚å½“çš„å¤„ç†ï¼Œè€Œä¸æ˜¯ç®€å•åœ°å°†å¼‚å¸¸çš„è·Ÿè¸ªæ ˆä¿¡æ¯æ‰“å°å‡ºæ¥ã€‚</p> <h2 id="10å¤šçº¿ç¨‹">10ã€å¤šçº¿ç¨‹<a class="headerlink" href="#10å¤šçº¿ç¨‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>Java ç»™å¤šçº¿ç¨‹ç¼–ç¨‹æä¾›äº†å†…ç½®çš„æ”¯æŒã€‚ ä¸€æ¡çº¿ç¨‹æŒ‡çš„æ˜¯è¿›ç¨‹ä¸­ä¸€ä¸ªå•ä¸€é¡ºåºçš„æ§åˆ¶æµï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚</p> <p>å¤šçº¿ç¨‹æ˜¯å¤šä»»åŠ¡çš„ä¸€ç§ç‰¹åˆ«çš„å½¢å¼ï¼Œä½†å¤šçº¿ç¨‹ä½¿ç”¨äº†æ›´å°çš„èµ„æºå¼€é”€ï¼›å¤šçº¿ç¨‹èƒ½æ»¡è¶³ç¨‹åºå‘˜ç¼–å†™é«˜æ•ˆç‡çš„ç¨‹åºæ¥è¾¾åˆ°å……åˆ†åˆ©ç”¨ CPU çš„ç›®çš„ã€‚</p> <hr> <p>è¿™é‡Œå®šä¹‰å’Œçº¿ç¨‹ç›¸å…³çš„å¦ä¸€ä¸ªæœ¯è¯­ - è¿›ç¨‹ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p> <p>CPU+RAM+å„ç§èµ„æºï¼ˆæ¯”å¦‚æ˜¾å¡ï¼Œå…‰é©±ï¼Œé”®ç›˜ï¼ŒGPS, ç­‰ç­‰å¤–è®¾ï¼‰æ„æˆæˆ‘ä»¬çš„ç”µè„‘ï¼Œä½†æ˜¯ç”µè„‘çš„è¿è¡Œï¼Œå®é™…å°±æ˜¯CPUå’Œç›¸å…³å¯„å­˜å™¨ä»¥åŠRAMä¹‹é—´çš„äº‹æƒ…ã€‚</p> <p>ä¸€ä¸ªæœ€æœ€åŸºç¡€çš„äº‹å®ï¼šCPUå¤ªå¿«ï¼Œå¤ªå¿«ï¼Œå¤ªå¿«äº†ï¼Œå¯„å­˜å™¨ä»…ä»…èƒ½å¤Ÿè¿½çš„ä¸Šä»–çš„è„šæ­¥ï¼ŒRAMå’Œåˆ«çš„æŒ‚åœ¨å„æ€»çº¿ä¸Šçš„è®¾å¤‡å®Œå…¨æ˜¯æœ›å°˜è«åŠã€‚é‚£å½“å¤šä¸ªä»»åŠ¡è¦æ‰§è¡Œçš„æ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿè½®æµç€æ¥?æˆ–è€…è°ä¼˜å…ˆçº§é«˜è°æ¥ï¼Ÿä¸ç®¡æ€ä¹ˆæ ·çš„ç­–ç•¥ï¼Œä¸€å¥è¯å°±æ˜¯åœ¨CPUçœ‹æ¥å°±æ˜¯è½®æµç€æ¥ã€‚</p> <p>ä¸€ä¸ªå¿…é¡»çŸ¥é“çš„äº‹å®ï¼šæ‰§è¡Œä¸€æ®µç¨‹åºä»£ç ï¼Œå®ç°ä¸€ä¸ªåŠŸèƒ½çš„è¿‡ç¨‹ä»‹ç» ï¼Œå½“å¾—åˆ°CPUçš„æ—¶å€™ï¼Œç›¸å…³çš„èµ„æºå¿…é¡»ä¹Ÿå·²ç»å°±ä½ï¼Œå°±æ˜¯æ˜¾å¡å•Šï¼ŒGPSå•Šä»€ä¹ˆçš„å¿…é¡»å°±ä½ï¼Œç„¶åCPUå¼€å§‹æ‰§è¡Œã€‚è¿™é‡Œé™¤äº†CPUä»¥å¤–æ‰€æœ‰çš„å°±æ„æˆäº†è¿™ä¸ªç¨‹åºçš„æ‰§è¡Œç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€å®šä¹‰çš„ç¨‹åºä¸Šä¸‹æ–‡ã€‚å½“è¿™ä¸ªç¨‹åºæ‰§è¡Œå®Œäº†ï¼Œæˆ–è€…åˆ†é…ç»™ä»–çš„CPUæ‰§è¡Œæ—¶é—´ç”¨å®Œäº†ï¼Œé‚£å®ƒå°±è¦è¢«åˆ‡æ¢å‡ºå»ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡CPUçš„ä¸´å¹¸ã€‚åœ¨è¢«åˆ‡æ¢å‡ºå»çš„æœ€åä¸€æ­¥å·¥ä½œå°±æ˜¯ä¿å­˜ç¨‹åºä¸Šä¸‹æ–‡ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯ä¸‹æ¬¡ä»–è¢«CPUä¸´å¹¸çš„è¿è¡Œç¯å¢ƒï¼Œå¿…é¡»ä¿å­˜ã€‚</p> <p>ä¸²è”èµ·æ¥çš„äº‹å®ï¼šå‰é¢è®²è¿‡åœ¨CPUçœ‹æ¥æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„è½®æµæ‰§è¡Œçš„ï¼Œå…·ä½“çš„è½®æµæ–¹æ³•å°±æ˜¯ï¼šå…ˆåŠ è½½ç¨‹åºAçš„ä¸Šä¸‹æ–‡ï¼Œç„¶åå¼€å§‹æ‰§è¡ŒAï¼Œä¿å­˜ç¨‹åºAçš„ä¸Šä¸‹æ–‡ï¼Œè°ƒå…¥ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„ç¨‹åºBçš„ç¨‹åºä¸Šä¸‹æ–‡ï¼Œç„¶åå¼€å§‹æ‰§è¡ŒB,ä¿å­˜ç¨‹åºBçš„ä¸Šä¸‹æ–‡...</p> <p>è¿›ç¨‹å’Œçº¿ç¨‹å°±æ˜¯è¿™æ ·çš„èƒŒæ™¯å‡ºæ¥çš„ï¼Œä¸¤ä¸ªåè¯ä¸è¿‡æ˜¯å¯¹åº”çš„CPUæ—¶é—´æ®µçš„æè¿°ï¼Œåè¯å°±æ˜¯è¿™æ ·çš„åŠŸèƒ½ã€‚</p> <p><strong>è¿›ç¨‹å°±æ˜¯åŒ…æ¢ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç¨‹åºæ‰§è¡Œæ—¶é—´æ€»å’Œ</strong> = <strong>CPUåŠ è½½ä¸Šä¸‹æ–‡+CPUæ‰§è¡Œ+CPUä¿å­˜ä¸Šä¸‹æ–‡</strong></p> <p>è¿›ç¨‹çš„é¢—ç²’åº¦å¤ªå¤§ï¼Œæ¯æ¬¡éƒ½è¦æœ‰ä¸Šä¸‹æ–‡çš„è°ƒå…¥ï¼Œä¿å­˜ï¼Œè°ƒå‡ºã€‚å¦‚æœæˆ‘ä»¬æŠŠè¿›ç¨‹æ¯”å–»ä¸ºä¸€ä¸ªè¿è¡Œåœ¨ç”µè„‘ä¸Šçš„è½¯ä»¶ï¼Œé‚£ä¹ˆä¸€ä¸ªè½¯ä»¶çš„æ‰§è¡Œä¸å¯èƒ½æ˜¯ä¸€æ¡é€»è¾‘æ‰§è¡Œçš„ï¼Œå¿…å®šæœ‰å¤šä¸ªåˆ†æ”¯å’Œå¤šä¸ªç¨‹åºæ®µï¼Œå°±å¥½æ¯”è¦å®ç°ç¨‹åºAï¼Œå®é™…åˆ†æˆ aï¼Œbï¼Œcç­‰å¤šä¸ªå—ç»„åˆè€Œæˆã€‚é‚£ä¹ˆè¿™é‡Œå…·ä½“çš„æ‰§è¡Œå°±å¯èƒ½å˜æˆï¼š</p> <p>ç¨‹åºAå¾—åˆ°CPU =&gt; CPUåŠ è½½ä¸Šä¸‹æ–‡ï¼Œå¼€å§‹æ‰§è¡Œç¨‹åºAçš„aå°æ®µï¼Œç„¶åæ‰§è¡ŒAçš„bå°æ®µï¼Œç„¶åå†æ‰§è¡ŒAçš„cå°æ®µï¼Œæœ€åCPUä¿å­˜Açš„ä¸Šä¸‹æ–‡ã€‚</p> <p>è¿™é‡Œaï¼Œbï¼Œcçš„æ‰§è¡Œæ˜¯å…±äº«äº†Açš„ä¸Šä¸‹æ–‡ï¼ŒCPUåœ¨æ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„ã€‚è¿™é‡Œçš„aï¼Œbï¼Œcå°±æ˜¯çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹æ˜¯å…±äº«äº†è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ç¯å¢ƒçš„æ›´ä¸ºç»†å°çš„CPUæ—¶é—´æ®µã€‚</p> <p>åšä¸ªç®€å•çš„æ¯”å–»ï¼šè¿›ç¨‹=ç«è½¦ï¼Œçº¿ç¨‹=è½¦å¢</p> <ul> <li>çº¿ç¨‹åœ¨è¿›ç¨‹ä¸‹è¡Œè¿›ï¼ˆå•çº¯çš„è½¦å¢æ— æ³•è¿è¡Œï¼‰</li> <li>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼ˆä¸€è¾†ç«è½¦å¯ä»¥æœ‰å¤šä¸ªè½¦å¢ï¼‰</li> <li>ä¸åŒè¿›ç¨‹é—´æ•°æ®å¾ˆéš¾å…±äº«ï¼ˆä¸€è¾†ç«è½¦ä¸Šçš„ä¹˜å®¢å¾ˆéš¾æ¢åˆ°å¦å¤–ä¸€è¾†ç«è½¦ï¼Œæ¯”å¦‚ç«™ç‚¹æ¢ä¹˜ï¼‰</li> <li>åŒä¸€è¿›ç¨‹ä¸‹ä¸åŒçº¿ç¨‹é—´æ•°æ®å¾ˆæ˜“å…±äº«ï¼ˆAè½¦å¢æ¢åˆ°Bè½¦å¢å¾ˆå®¹æ˜“ï¼‰</li> <li>è¿›ç¨‹è¦æ¯”çº¿ç¨‹æ¶ˆè€—æ›´å¤šçš„è®¡ç®—æœºèµ„æºï¼ˆé‡‡ç”¨å¤šåˆ—ç«è½¦ç›¸æ¯”å¤šä¸ªè½¦å¢æ›´è€—èµ„æºï¼‰</li> <li>è¿›ç¨‹é—´ä¸ä¼šç›¸äº’å½±å“ï¼Œä¸€ä¸ªçº¿ç¨‹æŒ‚æ‰å°†å¯¼è‡´æ•´ä¸ªè¿›ç¨‹æŒ‚æ‰ï¼ˆä¸€åˆ—ç«è½¦ä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€åˆ—ç«è½¦ï¼Œä½†æ˜¯å¦‚æœä¸€åˆ—ç«è½¦ä¸Šä¸­é—´çš„ä¸€èŠ‚è½¦å¢ç€ç«äº†ï¼Œå°†å½±å“åˆ°æ‰€æœ‰è½¦å¢ï¼‰</li> <li>è¿›ç¨‹å¯ä»¥æ‹“å±•åˆ°å¤šæœºï¼Œè¿›ç¨‹æœ€å¤šé€‚åˆå¤šæ ¸ï¼ˆä¸åŒç«è½¦å¯ä»¥å¼€åœ¨å¤šä¸ªè½¨é“ä¸Šï¼ŒåŒä¸€ç«è½¦çš„è½¦å¢ä¸èƒ½åœ¨è¡Œè¿›çš„ä¸åŒçš„è½¨é“ä¸Šï¼‰</li> <li>è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åœ°å€å¯ä»¥ä¸Šé”ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨æŸäº›å…±äº«å†…å­˜æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å®ƒç»“æŸï¼Œæ‰èƒ½ä½¿ç”¨è¿™ä¸€å—å†…å­˜ã€‚ï¼ˆæ¯”å¦‚ç«è½¦ä¸Šçš„æ´—æ‰‹é—´ï¼‰ï¼"äº’æ–¥é”"</li> <li>è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åœ°å€å¯ä»¥é™å®šä½¿ç”¨é‡ï¼ˆæ¯”å¦‚ç«è½¦ä¸Šçš„é¤å…ï¼Œæœ€å¤šåªå…è®¸å¤šå°‘äººè¿›å…¥ï¼Œå¦‚æœæ»¡äº†éœ€è¦åœ¨é—¨å£ç­‰ï¼Œç­‰æœ‰äººå‡ºæ¥äº†æ‰èƒ½è¿›å»ï¼‰ï¼â€œä¿¡å·é‡â€</li> </ul> <hr> <p>å¹¶è¡Œå’Œå¹¶å‘ï¼š</p> <ul> <li>å¹¶è¡Œæ˜¯å€¼ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿï¼Œå¹¶å‘æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒæ—¶æ—¶é—´é—´éš”å‘ç”Ÿã€‚</li> <li>å¹¶è¡Œæ˜¯ä¸åŒå®ä½“ä¸Šçš„å¤šä¸ªäº‹ä»¶ï¼Œå¹¶å‘æ˜¯åŒä¸€å®ä½“ä¸Šçš„å¤šä¸ªäº‹ä»¶ã€‚</li> </ul> <p>åœ¨åŒä¸€å°æœºå™¨ä¸Š â€œåŒæ—¶â€ å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œåœ¨å¤šå°å¤„ç†å™¨ä¸Š â€œåŒæ—¶â€ å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚å¦‚ Hadoop åˆ†å¸ƒå¼é›†ç¾¤ï¼›æ‰€ä»¥å¹¶å‘ç¼–ç¨‹çš„ç›®æ ‡æ˜¯å……åˆ†åˆ©ç”¨å¤„ç†å™¨çš„æ¯ä¸€ä¸ªæ ¸ï¼Œä»¥è¾¾åˆ°æœ€é«˜çš„å¤„ç†æ€§èƒ½ã€‚</p> <h3 id="101çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ">10.1ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ<a class="headerlink" href="#101çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>çº¿ç¨‹æ˜¯ä¸€ä¸ªåŠ¨æ€æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œå®ƒä¹Ÿæœ‰ä¸€ä¸ªä»äº§ç”Ÿåˆ°æ­»äº¡çš„è¿‡ç¨‹ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªçº¿ç¨‹å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/java-thread.jpg" data-desc-position="bottom"><img src="!assets/Java/java-thread.jpg" alt="img" style="zoom: 50%;"></a></p> <ul> <li> <p>æ–°å»ºçŠ¶æ€:</p> <p>ä½¿ç”¨ <strong>new</strong> å…³é”®å­—å’Œ <strong>Thread</strong> ç±»æˆ–å…¶å­ç±»å»ºç«‹ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡åï¼Œè¯¥çº¿ç¨‹å¯¹è±¡å°±å¤„äºæ–°å»ºçŠ¶æ€ã€‚å®ƒä¿æŒè¿™ä¸ªçŠ¶æ€ç›´åˆ°ç¨‹åº <strong>start()</strong> è¿™ä¸ªçº¿ç¨‹ã€‚</p> </li> <li> <p>å°±ç»ªçŠ¶æ€:</p> <p>å½“çº¿ç¨‹å¯¹è±¡è°ƒç”¨äº†start()æ–¹æ³•ä¹‹åï¼Œè¯¥çº¿ç¨‹å°±è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚å°±ç»ªçŠ¶æ€çš„çº¿ç¨‹å¤„äºå°±ç»ªé˜Ÿåˆ—ä¸­ï¼Œè¦ç­‰å¾…JVMé‡Œçº¿ç¨‹è°ƒåº¦å™¨çš„è°ƒåº¦ã€‚</p> </li> <li> <p>è¿è¡ŒçŠ¶æ€:</p> <p>å¦‚æœå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹è·å– CPU èµ„æºï¼Œå°±å¯ä»¥æ‰§è¡Œ <strong>run()</strong>ï¼Œæ­¤æ—¶çº¿ç¨‹ä¾¿å¤„äºè¿è¡ŒçŠ¶æ€ã€‚å¤„äºè¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹æœ€ä¸ºå¤æ‚ï¼Œå®ƒå¯ä»¥å˜ä¸ºé˜»å¡çŠ¶æ€ã€å°±ç»ªçŠ¶æ€å’Œæ­»äº¡çŠ¶æ€ã€‚</p> </li> <li> <p>é˜»å¡çŠ¶æ€:</p> <p>å¦‚æœä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº†sleepï¼ˆç¡çœ ï¼‰ã€suspendï¼ˆæŒ‚èµ·ï¼‰ç­‰æ–¹æ³•ï¼Œå¤±å»æ‰€å ç”¨èµ„æºä¹‹åï¼Œè¯¥çº¿ç¨‹å°±ä»è¿è¡ŒçŠ¶æ€è¿›å…¥é˜»å¡çŠ¶æ€ã€‚åœ¨ç¡çœ æ—¶é—´å·²åˆ°æˆ–è·å¾—è®¾å¤‡èµ„æºåå¯ä»¥é‡æ–°è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼š</p> <ul> <li>ç­‰å¾…é˜»å¡ï¼šè¿è¡ŒçŠ¶æ€ä¸­çš„çº¿ç¨‹æ‰§è¡Œ wait() æ–¹æ³•ï¼Œä½¿çº¿ç¨‹è¿›å…¥åˆ°ç­‰å¾…é˜»å¡çŠ¶æ€ã€‚</li> <li>åŒæ­¥é˜»å¡ï¼šçº¿ç¨‹åœ¨è·å– synchronized åŒæ­¥é”å¤±è´¥(å› ä¸ºåŒæ­¥é”è¢«å…¶ä»–çº¿ç¨‹å ç”¨)ã€‚</li> <li>å…¶ä»–é˜»å¡ï¼šé€šè¿‡è°ƒç”¨çº¿ç¨‹çš„ sleep() æˆ– join() å‘å‡ºäº† I/O è¯·æ±‚æ—¶ï¼Œçº¿ç¨‹å°±ä¼šè¿›å…¥åˆ°é˜»å¡çŠ¶æ€ã€‚å½“sleep() çŠ¶æ€è¶…æ—¶ï¼Œjoin() ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è¶…æ—¶ï¼Œæˆ–è€… I/O å¤„ç†å®Œæ¯•ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚</li> </ul> </li> <li> <p>æ­»äº¡çŠ¶æ€:</p> <p>ä¸€ä¸ªè¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹å®Œæˆä»»åŠ¡æˆ–è€…å…¶ä»–ç»ˆæ­¢æ¡ä»¶å‘ç”Ÿæ—¶ï¼Œè¯¥çº¿ç¨‹å°±åˆ‡æ¢åˆ°ç»ˆæ­¢çŠ¶æ€ã€‚</p> </li> </ul> <hr> <p><strong>run() å’Œ start() çš„åŒºåˆ«</strong></p> <p>æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯é€šè¿‡æŸä¸ªç‰¹å®š Thread å¯¹è±¡æ‰€å¯¹åº”çš„ run() æ–¹æ³•æ¥å®Œæˆå…¶æ“ä½œçš„ï¼Œæ–¹æ³• run() ç§°ä¸ºçº¿ç¨‹ä½“ï¼Œé€šè¿‡è°ƒç”¨ Thread ç±»çš„ start() æ–¹æ³•æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ã€‚</p> <p>start() æ–¹æ³•æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼ŒçœŸæ­£å®ç°äº†å¤šçº¿ç¨‹è¿è¡Œã€‚è¿™æ—¶æ— éœ€ç­‰å¾… run() æ–¹æ³•ä½“ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼›è¿™æ—¶çº¿ç¨‹å¤„äºå°±ç»ªçŠ¶æ€ï¼Œå¹¶æ²¡æœ‰è¿è¡Œã€‚å½“æ­¤ Thread ç±»è·å¾— CPU èµ„æºåè°ƒç”¨æ–¹æ³• run() æ¥å®Œæˆå…¶è¿è¡ŒçŠ¶æ€ï¼Œrun() æ–¹æ³•åŒ…å«äº†è¦æ‰§è¡Œçš„è¿™ä¸ªçº¿ç¨‹çš„å†…å®¹ï¼Œrun() æ–¹æ³•æ‰§è¡Œç»“æŸï¼Œæ­¤çº¿ç¨‹ç»ˆæ­¢ã€‚</p> <p>run() æ–¹æ³•æ˜¯åœ¨æœ¬çº¿ç¨‹é‡Œçš„ï¼Œåªæ˜¯çº¿ç¨‹é‡Œçš„ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯å¤šçº¿ç¨‹çš„ã€‚å¦‚æœç›´æ¥è°ƒç”¨ run()ï¼Œå…¶å®å°±ç›¸å½“äºæ˜¯è°ƒç”¨äº†ä¸€ä¸ªæ™®é€šçš„å‡½æ•°è€Œå·²ï¼Œç›´æ¥è°ƒç”¨ run() æ–¹æ³•å¿…é¡»ç­‰å¾… run() æ–¹æ³•æ‰§è¡Œå®Œæ¯•æ‰èƒ½æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œæ‰€ä»¥æ‰§è¡Œçº¿è·¯åªæœ‰ä¸€æ¡ï¼Œæ ¹æœ¬å°±æ²¡æœ‰çº¿ç¨‹çš„ç‰¹å¾ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹æ‰§è¡Œæ—¶è¦ä½¿ç”¨ start() æ–¹æ³•è€Œä¸æ˜¯ run() æ–¹æ³•ã€‚</p> <p>ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡çš„ start() æ–¹æ³•åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œå¤šæ¬¡è°ƒç”¨ä¼šæŠ›å‡º java.lang.IllegalThreadStateException å¼‚å¸¸ï¼›run() æ–¹æ³•æ²¡æœ‰é™åˆ¶ã€‚</p> <hr> <p><mark>å®ˆæŠ¤çº¿ç¨‹ï¼ˆå³daemon threadï¼‰ï¼Œæ˜¯ä¸ªæœåŠ¡çº¿ç¨‹ï¼Œå‡†ç¡®åœ°æ¥è¯´å°±æ˜¯æœåŠ¡å…¶ä»–çš„çº¿ç¨‹ã€‚</mark></p> <h3 id="102çº¿ç¨‹çš„ä¼˜å…ˆçº§">10.2ã€çº¿ç¨‹çš„ä¼˜å…ˆçº§<a class="headerlink" href="#102çº¿ç¨‹çš„ä¼˜å…ˆçº§" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æ¯ä¸€ä¸ª Java çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œè¿™æ ·æœ‰åŠ©äºæ“ä½œç³»ç»Ÿç¡®å®šçº¿ç¨‹çš„è°ƒåº¦é¡ºåºã€‚</p> <p>Java çº¿ç¨‹çš„ä¼˜å…ˆçº§æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå…¶å–å€¼èŒƒå›´æ˜¯ 1 ï¼ˆThread.MIN_PRIORITY ï¼‰ - 10 ï¼ˆThread.MAX_PRIORITY ï¼‰ã€‚</p> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šåˆ†é…ä¸€ä¸ªä¼˜å…ˆçº§ NORM_PRIORITYï¼ˆ5ï¼‰ã€‚</p> <p>å…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹å¯¹ç¨‹åºæ›´é‡è¦ï¼Œå¹¶ä¸”åº”è¯¥åœ¨ä½ä¼˜å…ˆçº§çš„çº¿ç¨‹ä¹‹å‰åˆ†é…å¤„ç†å™¨èµ„æºã€‚ä½†æ˜¯ï¼Œçº¿ç¨‹ä¼˜å…ˆçº§ä¸èƒ½ä¿è¯çº¿ç¨‹æ‰§è¡Œçš„é¡ºåºï¼Œè€Œä¸”éå¸¸ä¾èµ–äºå¹³å°ã€‚</p> <h3 id="103åˆ›å»ºä¸€ä¸ªçº¿ç¨‹">10.3ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹<a class="headerlink" href="#103åˆ›å»ºä¸€ä¸ªçº¿ç¨‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Java æä¾›äº†ä¸‰ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•ï¼š</p> <ul> <li>é€šè¿‡å®ç° Runnable æ¥å£ï¼›</li> <li>é€šè¿‡ç»§æ‰¿ Thread ç±»æœ¬èº«ï¼›</li> <li>é€šè¿‡ Callable å’Œ Future åˆ›å»ºçº¿ç¨‹ã€‚</li> </ul> <h4 id="1031å®ç°runnable">10.3.1ã€å®ç°Runnable<a class="headerlink" href="#1031å®ç°runnable" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªå®ç° Runnable æ¥å£çš„ç±»ã€‚</p> <p>ä¸ºäº†å®ç° Runnableï¼Œä¸€ä¸ªç±»éœ€è¦é‡å†™run()æ–¹æ³•ã€‚</p> <p>åœ¨åˆ›å»ºä¸€ä¸ªå®ç° Runnable æ¥å£çš„ç±»ä¹‹åï¼Œå¯ä»¥åœ¨ç±»ä¸­å®ä¾‹åŒ–ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚</p> <p>Thread å®šä¹‰äº†å‡ ä¸ªæ„é€ æ–¹æ³•ï¼Œä¸‹é¢çš„è¿™ä¸ªæ˜¯ç»å¸¸ä½¿ç”¨çš„ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">Thread</span><span class="p">(</span><span class="n">Runnable</span><span class="w"> </span><span class="n">threadOb</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">threadName</span><span class="p">);</span>
</span></code></pre></div> <p>è¿™é‡Œï¼ŒthreadOb æ˜¯ä¸€ä¸ªå®ç° Runnable æ¥å£çš„ç±»çš„å®ä¾‹ï¼Œå¹¶ä¸” threadName æŒ‡å®šæ–°çº¿ç¨‹çš„åå­—ã€‚</p> <p>æ–°çº¿ç¨‹åˆ›å»ºä¹‹åï¼Œè°ƒç”¨å®ƒçš„ start() æ–¹æ³•å®ƒæ‰ä¼šè¿è¡Œã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ›å»ºçº¿ç¨‹å¹¶å¼€å§‹è®©å®ƒæ‰§è¡Œçš„å®ä¾‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kd">class</span> <span class="nc">RunnableDemo</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">threadName</span><span class="p">;</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">   </span><span class="n">RunnableDemo</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">      </span><span class="n">threadName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Creating "</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">threadName</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">   </span><span class="p">}</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Running "</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">threadName</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="w">         </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Thread: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">threadName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="w">            </span><span class="c1">// è®©çº¿ç¨‹ç¡çœ ä¸€ä¼š</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">         </span><span class="p">}</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="w">      </span><span class="p">}</span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="w">         </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Thread "</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">threadName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" interrupted."</span><span class="p">);</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Thread "</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">threadName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" exiting."</span><span class="p">);</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a><span class="w">   </span><span class="p">}</span>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">start</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Starting "</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">threadName</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a><span class="w">         </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">threadName</span><span class="p">);</span>
</span><span id="__span-39-28"><a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a><span class="w">         </span><span class="n">t</span><span class="p">.</span><span class="na">start</span><span class="w"> </span><span class="p">();</span>
</span><span id="__span-39-29"><a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-39-30"><a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a><span class="w">   </span><span class="p">}</span>
</span><span id="__span-39-31"><a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a><span class="p">}</span>
</span><span id="__span-39-32"><a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a>
</span><span id="__span-39-33"><a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestThread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-34"><a id="__codelineno-39-34" name="__codelineno-39-34" href="#__codelineno-39-34"></a>
</span><span id="__span-39-35"><a id="__codelineno-39-35" name="__codelineno-39-35" href="#__codelineno-39-35"></a><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">args</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-36"><a id="__codelineno-39-36" name="__codelineno-39-36" href="#__codelineno-39-36"></a><span class="w">      </span><span class="n">RunnableDemo</span><span class="w"> </span><span class="n">R1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RunnableDemo</span><span class="p">(</span><span class="w"> </span><span class="s">"Thread-1"</span><span class="p">);</span>
</span><span id="__span-39-37"><a id="__codelineno-39-37" name="__codelineno-39-37" href="#__codelineno-39-37"></a><span class="w">      </span><span class="n">R1</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-39-38"><a id="__codelineno-39-38" name="__codelineno-39-38" href="#__codelineno-39-38"></a>
</span><span id="__span-39-39"><a id="__codelineno-39-39" name="__codelineno-39-39" href="#__codelineno-39-39"></a><span class="w">      </span><span class="n">RunnableDemo</span><span class="w"> </span><span class="n">R2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RunnableDemo</span><span class="p">(</span><span class="w"> </span><span class="s">"Thread-2"</span><span class="p">);</span>
</span><span id="__span-39-40"><a id="__codelineno-39-40" name="__codelineno-39-40" href="#__codelineno-39-40"></a><span class="w">      </span><span class="n">R2</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-39-41"><a id="__codelineno-39-41" name="__codelineno-39-41" href="#__codelineno-39-41"></a><span class="w">   </span><span class="p">}</span><span class="w">   </span>
</span><span id="__span-39-42"><a id="__codelineno-39-42" name="__codelineno-39-42" href="#__codelineno-39-42"></a><span class="p">}</span>
</span></code></pre></div> <p>ç¼–è¯‘ä»¥ä¸Šç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>Creating Thread-1
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>Starting Thread-1
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>Creating Thread-2
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>Starting Thread-2
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>Running Thread-1
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>Thread: Thread-1, 4
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>Running Thread-2
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>Thread: Thread-2, 4
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>Thread: Thread-1, 3
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>Thread: Thread-2, 3
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>Thread: Thread-1, 2
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>Thread: Thread-2, 2
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>Thread: Thread-1, 1
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a>Thread: Thread-2, 1
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a>Thread Thread-1 exiting.
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a>Thread Thread-2 exiting.
</span></code></pre></div> <h4 id="1032ç»§æ‰¿thread">10.3.2ã€ç»§æ‰¿Thread<a class="headerlink" href="#1032ç»§æ‰¿thread" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„ç¬¬äºŒç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œè¯¥ç±»ç»§æ‰¿ Thread ç±»ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹ã€‚</p> <p>ç»§æ‰¿ç±»å¿…é¡»é‡å†™ run() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯æ–°çº¿ç¨‹çš„å…¥å£ç‚¹ã€‚å®ƒä¹Ÿå¿…é¡»è°ƒç”¨ start() æ–¹æ³•æ‰èƒ½æ‰§è¡Œã€‚</p> <p>è¯¥æ–¹æ³•å°½ç®¡è¢«åˆ—ä¸ºä¸€ç§å¤šçº¿ç¨‹å®ç°æ–¹å¼ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šä¹Ÿæ˜¯å®ç°äº† Runnable æ¥å£çš„ä¸€ä¸ªå®ä¾‹ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="kd">class</span> <span class="nc">ThreadDemo</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">threadName</span><span class="p">;</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">   </span><span class="n">ThreadDemo</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">      </span><span class="n">threadName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Creating "</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">threadName</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">   </span><span class="p">}</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Running "</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">threadName</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">         </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Thread: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">threadName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">            </span><span class="c1">// è®©çº¿ç¨‹ç¡çœ ä¸€ä¼š</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w">         </span><span class="p">}</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w">      </span><span class="p">}</span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w">         </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Thread "</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">threadName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" interrupted."</span><span class="p">);</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Thread "</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">threadName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" exiting."</span><span class="p">);</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w">   </span><span class="p">}</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">start</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Starting "</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">threadName</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-27"><a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="w">         </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">threadName</span><span class="p">);</span>
</span><span id="__span-41-28"><a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="w">         </span><span class="n">t</span><span class="p">.</span><span class="na">start</span><span class="w"> </span><span class="p">();</span>
</span><span id="__span-41-29"><a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-41-30"><a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a><span class="w">   </span><span class="p">}</span>
</span><span id="__span-41-31"><a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a><span class="p">}</span>
</span><span id="__span-41-32"><a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a>
</span><span id="__span-41-33"><a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestThread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-34"><a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a>
</span><span id="__span-41-35"><a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">args</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-36"><a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a><span class="w">      </span><span class="n">ThreadDemo</span><span class="w"> </span><span class="n">T1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadDemo</span><span class="p">(</span><span class="w"> </span><span class="s">"Thread-1"</span><span class="p">);</span>
</span><span id="__span-41-37"><a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a><span class="w">      </span><span class="n">T1</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-41-38"><a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a>
</span><span id="__span-41-39"><a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a><span class="w">      </span><span class="n">ThreadDemo</span><span class="w"> </span><span class="n">T2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadDemo</span><span class="p">(</span><span class="w"> </span><span class="s">"Thread-2"</span><span class="p">);</span>
</span><span id="__span-41-40"><a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a><span class="w">      </span><span class="n">T2</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-41-41"><a id="__codelineno-41-41" name="__codelineno-41-41" href="#__codelineno-41-41"></a><span class="w">   </span><span class="p">}</span><span class="w">   </span>
</span><span id="__span-41-42"><a id="__codelineno-41-42" name="__codelineno-41-42" href="#__codelineno-41-42"></a><span class="p">}</span>
</span></code></pre></div> <p>ç¼–è¯‘ä»¥ä¸Šç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>Creating Thread-1
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>Starting Thread-1
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>Creating Thread-2
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>Starting Thread-2
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>Running Thread-1
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>Thread: Thread-1, 4
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>Running Thread-2
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>Thread: Thread-2, 4
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>Thread: Thread-1, 3
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>Thread: Thread-2, 3
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>Thread: Thread-1, 2
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>Thread: Thread-2, 2
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>Thread: Thread-1, 1
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>Thread: Thread-2, 1
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>Thread Thread-1 exiting.
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>Thread Thread-2 exiting.
</span></code></pre></div> <h4 id="1033é€šè¿‡-callablefuture">10.3.3ã€é€šè¿‡ Callableã€Future<a class="headerlink" href="#1033é€šè¿‡-callablefuture" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>åœ¨javaçš„å¤šçº¿ç¨‹å¼€å‘ä¸­Runnableä¸€ç›´ä»¥æ¥éƒ½æ˜¯å¤šçº¿ç¨‹çš„æ ¸å¿ƒï¼Œè€ŒCallableæ˜¯java1.5æ·»åŠ è¿›æ¥çš„ä¸€ä¸ªå¢å¼ºç‰ˆæœ¬ã€‚</p> <ul> <li>Runnableæ¥å£ä¸­çš„run()æ–¹æ³•çš„è¿”å›å€¼æ˜¯voidï¼Œå®ƒåšçš„äº‹æƒ…åªæ˜¯çº¯ç²¹åœ°å»æ‰§è¡Œrun()æ–¹æ³•ä¸­çš„ä»£ç è€Œå·²ï¼›</li> <li>Callableæ¥å£ä¸­çš„call()æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œæ˜¯ä¸€ä¸ªæ³›å‹ï¼Œå’ŒFutureã€FutureTaské…åˆå¯ä»¥ç”¨æ¥è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœã€‚</li> </ul> <hr> <p>ä½¿ç”¨ Callable å’Œ Future åˆ›å»ºçº¿ç¨‹ï¼š</p> <ol> <li>åˆ›å»º Callable æ¥å£çš„å®ç°ç±»ï¼Œå¹¶å®ç° call() æ–¹æ³•ï¼Œè¯¥ call() æ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ï¼Œå¹¶ä¸”æœ‰è¿”å›å€¼ã€‚</li> <li>åˆ›å»º Callable å®ç°ç±»çš„å®ä¾‹ï¼Œä½¿ç”¨ FutureTask ç±»æ¥åŒ…è£… Callable å¯¹è±¡ï¼Œè¯¥ FutureTask å¯¹è±¡å°è£…äº†è¯¥ Callable å¯¹è±¡çš„ call() æ–¹æ³•çš„è¿”å›å€¼ã€‚</li> <li>ä½¿ç”¨ FutureTask å¯¹è±¡ä½œä¸º Thread å¯¹è±¡çš„ target åˆ›å»ºå¹¶å¯åŠ¨æ–°çº¿ç¨‹ã€‚</li> <li>è°ƒç”¨ FutureTask å¯¹è±¡çš„ get() æ–¹æ³•æ¥è·å¾—å­çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„è¿”å›å€¼ã€‚</li> </ol> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CallableThreadTest</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">    </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">        </span><span class="n">CallableThreadTest</span><span class="w"> </span><span class="n">ctt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CallableThreadTest</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">        </span><span class="n">FutureTask</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FutureTask</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">ctt</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">        </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="s">" çš„å¾ªç¯å˜é‡içš„å€¼"</span><span class="o">+</span><span class="n">i</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">20</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="w">            </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">ft</span><span class="p">,</span><span class="s">"æœ‰è¿”å›å€¼çš„çº¿ç¨‹"</span><span class="p">).</span><span class="na">start</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="w">            </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="w">        </span><span class="k">try</span><span class="w">  </span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="w">        </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å­çº¿ç¨‹çš„è¿”å›å€¼ï¼š"</span><span class="o">+</span><span class="n">ft</span><span class="p">.</span><span class="na">get</span><span class="p">());</span><span class="w">  </span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="w">        </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ExecutionException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-43-21"><a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a><span class="w">        </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-43-22"><a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-43-23"><a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-43-24"><a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a>
</span><span id="__span-43-25"><a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-43-26"><a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a><span class="w">    </span><span class="nd">@Override</span><span class="w">  </span>
</span><span id="__span-43-27"><a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">call</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w">  </span>
</span><span id="__span-43-28"><a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a><span class="w">    </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-43-29"><a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-43-30"><a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a><span class="w">        </span><span class="k">for</span><span class="p">(;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-43-31"><a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a><span class="w">        </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-43-32"><a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="s">" "</span><span class="o">+</span><span class="n">i</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-43-33"><a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-43-34"><a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-43-35"><a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-43-36"><a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a><span class="p">}</span>
</span></code></pre></div> <h3 id="104thread-æ–¹æ³•">10.4ã€Thread æ–¹æ³•<a class="headerlink" href="#104thread-æ–¹æ³•" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <table> <thead> <tr> <th>æ–¹æ³•</th> <th>æè¿°</th> </tr> </thead> <tbody> <tr> <td>void start()</td> <td>ä½¿è¯¥çº¿ç¨‹å¼€å§‹æ‰§è¡Œï¼›<strong>Java</strong> è™šæ‹Ÿæœºè°ƒç”¨è¯¥çº¿ç¨‹çš„ run æ–¹æ³•ã€‚</td> </tr> <tr> <td>void run()</td> <td>å¦‚æœè¯¥çº¿ç¨‹æ˜¯ä½¿ç”¨ç‹¬ç«‹çš„ Runnable è¿è¡Œå¯¹è±¡æ„é€ çš„ï¼Œåˆ™è°ƒç”¨è¯¥ Runnable å¯¹è±¡çš„ run æ–¹æ³•ï¼›å¦åˆ™ï¼Œè¯¥æ–¹æ³•ä¸æ‰§è¡Œä»»ä½•æ“ä½œå¹¶è¿”å›ã€‚</td> </tr> <tr> <td>final void setName(String name)</td> <td>æ”¹å˜çº¿ç¨‹åç§°ï¼Œä½¿ä¹‹ä¸å‚æ•° name ç›¸åŒã€‚</td> </tr> <tr> <td>final void setPriority(int priority)</td> <td>æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚</td> </tr> <tr> <td>final void setDaemon(boolean on)</td> <td>å°†è¯¥çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹æˆ–ç”¨æˆ·çº¿ç¨‹ã€‚</td> </tr> <tr> <td>final void join(long millisec)</td> <td>ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢çš„æ—¶é—´æœ€é•¿ä¸º millis æ¯«ç§’ã€‚</td> </tr> <tr> <td>void interrupt()</td> <td>ä¸­æ–­çº¿ç¨‹ã€‚</td> </tr> <tr> <td>final boolean isAlive()</td> <td>æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚</td> </tr> <tr> <td>static void yield()</td> <td>æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚</td> </tr> <tr> <td>static void sleep(long millisec)</td> <td>åœ¨æŒ‡å®šçš„æ¯«ç§’æ•°å†…è®©å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ ï¼ˆæš‚åœæ‰§è¡Œï¼‰ï¼Œæ­¤æ“ä½œå—åˆ°ç³»ç»Ÿè®¡æ—¶å™¨å’Œè°ƒåº¦ç¨‹åºç²¾åº¦å’Œå‡†ç¡®æ€§çš„å½±å“ã€‚</td> </tr> <tr> <td>static boolean holdsLock(Object x)</td> <td>å½“ä¸”ä»…å½“å½“å‰çº¿ç¨‹åœ¨æŒ‡å®šçš„å¯¹è±¡ä¸Šä¿æŒç›‘è§†å™¨é”æ—¶ï¼Œæ‰è¿”å› trueã€‚</td> </tr> <tr> <td>static Thread currentThread()</td> <td>è¿”å›å¯¹å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚</td> </tr> <tr> <td>static void dumpStack()</td> <td>å°†å½“å‰çº¿ç¨‹çš„å †æ ˆè·Ÿè¸ªæ‰“å°è‡³æ ‡å‡†é”™è¯¯æµã€‚</td> </tr> </tbody> </table> <h3 id="105çƒ§æ°´æ³¡èŒ¶">10.5ã€çƒ§æ°´æ³¡èŒ¶<a class="headerlink" href="#105çƒ§æ°´æ³¡èŒ¶" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å–èŒ¶ä¹‹å‰ï¼Œå¿…é¡»å®Œæˆå®Œæˆçƒ§å¼€æ°´ï¼Œæ¸…æ´—èŒ¶æ¯ï¼Œä»¥åŠæ³¡èŒ¶è¿‡ç¨‹æ‰èƒ½å–åˆ°æ¸…é¦™çš„èŒ¶æ°´ã€‚å¦‚æœä¸€é¡¹é¡¹çš„å»å®Œæˆçš„è¯ï¼Œå°±ä¼šæµªè´¹å¾ˆå¤šæ—¶é—´ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨çƒ§æ°´çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä¸€è¾¹æ¸…æ´—èŒ¶æ¯ï¼Œè¿™æ ·å°±èƒ½èŠ‚çº¦æ›´å¤šçš„æ—¶é—´äº†ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">        </span><span class="n">HeatUpWaterRunnable</span><span class="w"> </span><span class="n">heatUpWaterRunnable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HeatUpWaterRunnable</span><span class="p">();</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">        </span><span class="n">WashTheCupRunnable</span><span class="w"> </span><span class="n">washTheCupRunnable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WashTheCupRunnable</span><span class="p">();</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">heatWaterThread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">heatUpWaterRunnable</span><span class="p">);</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">washTheCupThread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">washTheCupRunnable</span><span class="p">);</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">        </span><span class="n">heatWaterThread</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">        </span><span class="n">washTheCupThread</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="w">            </span><span class="n">heatWaterThread</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="w">            </span><span class="n">washTheCupThread</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ³¡èŒ¶"</span><span class="p">);</span>
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="p">}</span>
</span><span id="__span-44-22"><a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a>
</span><span id="__span-44-23"><a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a><span class="kd">class</span> <span class="nc">HeatUpWaterRunnable</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-24"><a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-44-25"><a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-26"><a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å¼€å§‹çƒ§æ°´"</span><span class="p">);</span>
</span><span id="__span-44-27"><a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-28"><a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-29"><a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a><span class="w">                </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span><span id="__span-44-30"><a id="__codelineno-44-30" name="__codelineno-44-30" href="#__codelineno-44-30"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-31"><a id="__codelineno-44-31" name="__codelineno-44-31" href="#__codelineno-44-31"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-44-32"><a id="__codelineno-44-32" name="__codelineno-44-32" href="#__codelineno-44-32"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-44-33"><a id="__codelineno-44-33" name="__codelineno-44-33" href="#__codelineno-44-33"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-44-34"><a id="__codelineno-44-34" name="__codelineno-44-34" href="#__codelineno-44-34"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ°´çƒ§å¼€äº†"</span><span class="p">);</span>
</span><span id="__span-44-35"><a id="__codelineno-44-35" name="__codelineno-44-35" href="#__codelineno-44-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-44-36"><a id="__codelineno-44-36" name="__codelineno-44-36" href="#__codelineno-44-36"></a><span class="p">}</span>
</span><span id="__span-44-37"><a id="__codelineno-44-37" name="__codelineno-44-37" href="#__codelineno-44-37"></a>
</span><span id="__span-44-38"><a id="__codelineno-44-38" name="__codelineno-44-38" href="#__codelineno-44-38"></a><span class="kd">class</span> <span class="nc">WashTheCupRunnable</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-39"><a id="__codelineno-44-39" name="__codelineno-44-39" href="#__codelineno-44-39"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-44-40"><a id="__codelineno-44-40" name="__codelineno-44-40" href="#__codelineno-44-40"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-41"><a id="__codelineno-44-41" name="__codelineno-44-41" href="#__codelineno-44-41"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-42"><a id="__codelineno-44-42" name="__codelineno-44-42" href="#__codelineno-44-42"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å¼€å§‹æ´—ç¬¬"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"ä¸ªæ¯å­"</span><span class="p">);</span>
</span><span id="__span-44-43"><a id="__codelineno-44-43" name="__codelineno-44-43" href="#__codelineno-44-43"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-44"><a id="__codelineno-44-44" name="__codelineno-44-44" href="#__codelineno-44-44"></a><span class="w">                </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
</span><span id="__span-44-45"><a id="__codelineno-44-45" name="__codelineno-44-45" href="#__codelineno-44-45"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-46"><a id="__codelineno-44-46" name="__codelineno-44-46" href="#__codelineno-44-46"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-44-47"><a id="__codelineno-44-47" name="__codelineno-44-47" href="#__codelineno-44-47"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-44-48"><a id="__codelineno-44-48" name="__codelineno-44-48" href="#__codelineno-44-48"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"ç¬¬"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"ä¸ªæ¯å­æ´—å®Œäº†"</span><span class="p">);</span>
</span><span id="__span-44-49"><a id="__codelineno-44-49" name="__codelineno-44-49" href="#__codelineno-44-49"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-44-50"><a id="__codelineno-44-50" name="__codelineno-44-50" href="#__codelineno-44-50"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ¯å­æ´—å®Œäº†"</span><span class="p">);</span>
</span><span id="__span-44-51"><a id="__codelineno-44-51" name="__codelineno-44-51" href="#__codelineno-44-51"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-44-52"><a id="__codelineno-44-52" name="__codelineno-44-52" href="#__codelineno-44-52"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>å¼€å§‹çƒ§æ°´
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>å¼€å§‹æ´—ç¬¬1ä¸ªæ¯å­
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>ç¬¬1ä¸ªæ¯å­æ´—å®Œäº†
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>å¼€å§‹æ´—ç¬¬2ä¸ªæ¯å­
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>ç¬¬2ä¸ªæ¯å­æ´—å®Œäº†
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>å¼€å§‹æ´—ç¬¬3ä¸ªæ¯å­
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>ç¬¬3ä¸ªæ¯å­æ´—å®Œäº†
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>å¼€å§‹æ´—ç¬¬4ä¸ªæ¯å­
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>æ°´çƒ§å¼€äº†
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a>ç¬¬4ä¸ªæ¯å­æ´—å®Œäº†
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a>å¼€å§‹æ´—ç¬¬5ä¸ªæ¯å­
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a>ç¬¬5ä¸ªæ¯å­æ´—å®Œäº†
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a>æ¯å­æ´—å®Œäº†
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a>æ³¡èŒ¶
</span></code></pre></div> <h3 id="106joinyieldinterrupt">10.6ã€join()ã€yield()ã€interrupt()<a class="headerlink" href="#106joinyieldinterrupt" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <h4 id="1061join">10.6.1ã€join()<a class="headerlink" href="#1061join" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>çº¿ç¨‹çš„åˆå¹¶æŒ‡çš„æ˜¯ï¼šå°†æŒ‡å®šçš„çº¿ç¨‹åŠ å…¥åˆ°å½“å‰çš„çº¿ç¨‹ä¹‹ä¸­ï¼Œå¯ä»¥å°†ä¸¤ä¸ªäº¤æ›¿æ‰§è¡Œçš„çº¿ç¨‹åˆå¹¶ä¸ºé¡ºåºæ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¦‚æœåœ¨çº¿ç¨‹Bä¸­è°ƒç”¨äº†çº¿ç¨‹Açš„Join()æ–¹æ³•ï¼Œç›´åˆ°çº¿ç¨‹Aæ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œçº¿ç¨‹Bã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JoinTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w">            </span><span class="n">ThreadA</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadA</span><span class="p">(</span><span class="s">"t1"</span><span class="p">);</span><span class="w"> </span><span class="c1">// æ–°å»ºâ€œçº¿ç¨‹t1â€</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">            </span><span class="n">t1</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w">   </span><span class="c1">// å¯åŠ¨â€œçº¿ç¨‹t1â€</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w">            </span><span class="n">t1</span><span class="p">.</span><span class="na">join</span><span class="p">();</span><span class="w">   </span><span class="c1">// å°†â€œçº¿ç¨‹t1â€åŠ å…¥åˆ°â€œä¸»çº¿ç¨‹mainâ€ä¸­ï¼Œå¹¶ä¸”â€œä¸»çº¿ç¨‹main()ä¼šç­‰å¾…å®ƒçš„å®Œæˆâ€</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%s finish\n"</span><span class="p">,</span><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">());</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ThreadA</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">ThreadA</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="w">            </span><span class="kd">super</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a>
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-22"><a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%s start\n"</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
</span><span id="__span-46-23"><a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a>
</span><span id="__span-46-24"><a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a><span class="w">            </span><span class="c1">// å»¶æ—¶æ“ä½œ</span>
</span><span id="__span-46-25"><a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-26"><a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span><span id="__span-46-27"><a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-28"><a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-46-29"><a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-46-30"><a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a>
</span><span id="__span-46-31"><a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%s finish\n"</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
</span><span id="__span-46-32"><a id="__codelineno-46-32" name="__codelineno-46-32" href="#__codelineno-46-32"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-46-33"><a id="__codelineno-46-33" name="__codelineno-46-33" href="#__codelineno-46-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-46-34"><a id="__codelineno-46-34" name="__codelineno-46-34" href="#__codelineno-46-34"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œç»“æœï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>t1 start
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>t1 finish
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>main finish
</span></code></pre></div> <p>æµç¨‹å›¾</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/20190816110104907.png" data-desc-position="bottom"><img src="!assets/Java/20190816110104907.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:80%;"></a></p> <h4 id="1062yield">10.6.2ã€yield()<a class="headerlink" href="#1062yield" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>æš‚åœå½“å‰çº¿ç¨‹ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œï¼Œä¸è¿‡ä¸èƒ½æŒ‡å®šæš‚åœçš„æ—¶é—´ï¼Œå¹¶ä¸”ä¹Ÿä¸èƒ½ä¿è¯å½“å‰çº¿ç¨‹é©¬ä¸Šåœæ­¢ã€‚</p> <p>ä½œç”¨ï¼š</p> <ol> <li>ä½¿å½“å‰çº¿ç¨‹ä»æ‰§è¡ŒçŠ¶æ€ï¼ˆè¿è¡ŒçŠ¶æ€ï¼‰å˜ä¸ºå¯æ‰§è¡Œæ€ï¼ˆå°±ç»ªçŠ¶æ€ï¼‰ã€‚cpuä¼šä»ä¼—å¤šçš„å¯æ‰§è¡Œæ€é‡Œé€‰æ‹©ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰ä¹Ÿå°±æ˜¯åˆšåˆšçš„é‚£ä¸ªçº¿ç¨‹è¿˜æ˜¯æœ‰å¯èƒ½ä¼šè¢«å†æ¬¡æ‰§è¡Œåˆ°çš„ï¼Œå¹¶ä¸æ˜¯è¯´ä¸€å®šä¼šæ‰§è¡Œå…¶ä»–çº¿ç¨‹è€Œè¯¥çº¿ç¨‹åœ¨ä¸‹ä¸€æ¬¡ä¸­ä¸ä¼šæ‰§è¡Œåˆ°äº†ã€‚</li> <li>ç”¨äº†yieldæ–¹æ³•åï¼Œè¯¥çº¿ç¨‹å°±ä¼šæŠŠCPUæ—¶é—´è®©æ‰ï¼Œè®©å…¶ä»–æˆ–è€…è‡ªå·±çš„çº¿ç¨‹æ‰§è¡Œï¼ˆä¹Ÿå°±æ˜¯è°å…ˆæŠ¢åˆ°è°æ‰§è¡Œï¼‰</li> <li>é€šè¿‡yieldæ–¹æ³•æ¥å®ç°ä¸¤ä¸ªçº¿ç¨‹çš„äº¤æ›¿æ‰§è¡Œã€‚ä¸è¿‡è¯·æ³¨æ„ï¼šè¿™ç§äº¤æ›¿å¹¶ä¸ä¸€å®šèƒ½å¾—åˆ°ä¿è¯ã€‚</li> <li>yield()åªæ˜¯ä½¿å½“å‰çº¿ç¨‹é‡æ–°å›åˆ°å¯æ‰§è¡ŒçŠ¶æ€ï¼Œæ‰€æœ‰æ‰§è¡Œyield()çš„çº¿ç¨‹æœ‰å¯èƒ½åœ¨è¿›å…¥åˆ°å¯æ‰§è¡ŒçŠ¶æ€åé©¬ä¸Šåˆè¢«æ‰§è¡Œï¼Œæ‰€ä»¥yield()æ–¹æ³•åªèƒ½ä½¿åŒä¼˜å…ˆçº§çš„çº¿ç¨‹æœ‰æ‰§è¡Œçš„æœºä¼š</li> </ol> <h4 id="1063interrupt">10.6.3ã€interrupt()<a class="headerlink" href="#1063interrupt" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>é¦–å…ˆï¼Œä¸€ä¸ªçº¿ç¨‹ä¸åº”è¯¥ç”±å…¶ä»–çº¿ç¨‹æ¥å¼ºåˆ¶ä¸­æ–­æˆ–åœæ­¢ï¼Œè€Œæ˜¯åº”è¯¥ç”±çº¿ç¨‹è‡ªå·±è‡ªè¡Œåœæ­¢ã€‚æ‰€ä»¥ï¼ŒThread.stop, Thread.suspend, Thread.resume éƒ½å·²ç»è¢«åºŸå¼ƒäº†ã€‚è€Œ Thread.interrupt çš„ä½œç”¨å…¶å®ä¹Ÿä¸æ˜¯ä¸­æ–­çº¿ç¨‹ï¼Œè€Œæ˜¯ã€Œé€šçŸ¥çº¿ç¨‹åº”è¯¥ä¸­æ–­äº†ã€ï¼Œå…·ä½“åˆ°åº•ä¸­æ–­è¿˜æ˜¯ç»§ç»­è¿è¡Œï¼Œåº”è¯¥ç”±è¢«é€šçŸ¥çš„çº¿ç¨‹è‡ªå·±å¤„ç†ã€‚</p> <p>å…·ä½“æ¥è¯´ï¼Œå½“å¯¹ä¸€ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨ interrupt() æ—¶ï¼š</p> <ol> <li>å¦‚æœçº¿ç¨‹å¤„äºè¢«é˜»å¡çŠ¶æ€ï¼ˆä¾‹å¦‚å¤„äºsleep, wait, join ç­‰çŠ¶æ€ï¼‰ï¼Œé‚£ä¹ˆçº¿ç¨‹å°†ç«‹å³é€€å‡ºè¢«é˜»å¡çŠ¶æ€ï¼Œå¹¶æŠ›å‡ºä¸€ä¸ªInterruptedExceptionå¼‚å¸¸ã€‚ä»…æ­¤è€Œå·²ã€‚</li> <li>å¦‚æœçº¿ç¨‹å¤„äºæ­£å¸¸æ´»åŠ¨çŠ¶æ€ï¼Œé‚£ä¹ˆä¼šå°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—è®¾ç½®ä¸º trueï¼Œä»…æ­¤è€Œå·²ã€‚è¢«è®¾ç½®ä¸­æ–­æ ‡å¿—çš„çº¿ç¨‹å°†ç»§ç»­æ­£å¸¸è¿è¡Œï¼Œä¸å—å½±å“ã€‚</li> </ol> <p>interrupt() å¹¶ä¸èƒ½çœŸæ­£çš„ä¸­æ–­çº¿ç¨‹ï¼Œéœ€è¦è¢«è°ƒç”¨çš„çº¿ç¨‹è‡ªå·±è¿›è¡Œé…åˆæ‰è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹å¦‚æœæœ‰è¢«ä¸­æ–­çš„éœ€æ±‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿™æ ·åšã€‚</p> <ul> <li>åœ¨æ­£å¸¸è¿è¡Œä»»åŠ¡æ—¶ï¼Œç»å¸¸æ£€æŸ¥æœ¬çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ï¼Œå¦‚æœè¢«è®¾ç½®äº†ä¸­æ–­æ ‡å¿—å°±è‡ªè¡Œåœæ­¢çº¿ç¨‹ã€‚</li> <li>åœ¨è°ƒç”¨é˜»å¡æ–¹æ³•æ—¶æ­£ç¡®å¤„ç†InterruptedExceptionå¼‚å¸¸ã€‚ï¼ˆä¾‹å¦‚ï¼Œcatchå¼‚å¸¸åå°±ç»“æŸçº¿ç¨‹ã€‚ï¼‰</li> </ul> <hr> <p><strong>ä¸­æ–­çš„ç›¸å…³æ–¹æ³•ï¼š</strong></p> <ul> <li>public void interrupt() å°†è°ƒç”¨è€…çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è®¾ä¸ºtrueã€‚</li> <li>public boolean isInterrupted() åˆ¤æ–­è°ƒç”¨è€…çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚</li> <li>public static boolean interrupted åªèƒ½é€šè¿‡Thread.interrupted()è°ƒç”¨ã€‚ å®ƒä¼šåšä¸¤æ­¥æ“ä½œï¼šè¿”å›å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼›å°†å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è®¾ä¸ºfalseã€‚</li> </ul> <hr> <p><strong>å¦‚ä½•ä½¿ç”¨ä¸­æ–­ï¼Ÿ</strong></p> <p>è¦ä½¿ç”¨ä¸­æ–­ï¼Œé¦–å…ˆéœ€è¦åœ¨å¯èƒ½ä¼šå‘ç”Ÿä¸­æ–­çš„çº¿ç¨‹ä¸­ä¸æ–­ç›‘å¬ä¸­æ–­çŠ¶æ€ï¼Œä¸€æ—¦å‘ç”Ÿä¸­æ–­ï¼Œå°±æ‰§è¡Œç›¸åº”çš„ä¸­æ–­å¤„ç†ä»£ç ã€‚ å½“éœ€è¦ä¸­æ–­çº¿ç¨‹æ—¶ï¼Œè°ƒç”¨è¯¥çº¿ç¨‹å¯¹è±¡çš„interruptå‡½æ•°å³å¯ã€‚</p> <ol> <li> <p>è®¾ç½®ä¸­æ–­ç›‘å¬</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">Thread</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">(){</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">(){</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">        </span><span class="c1">// è‹¥æœªå‘ç”Ÿä¸­æ–­ï¼Œå°±æ­£å¸¸æ‰§è¡Œä»»åŠ¡</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">.</span><span class="na">isInterrupted</span><span class="p">()){</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">            </span><span class="c1">// æ­£å¸¸ä»»åŠ¡ä»£ç â€¦â€¦</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="w">        </span><span class="c1">// ä¸­æ–­çš„å¤„ç†ä»£ç â€¦â€¦</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">        </span><span class="n">doSomething</span><span class="p">();</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="p">}</span><span class="w"> </span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
</span></code></pre></div> <p>æ­£å¸¸çš„ä»»åŠ¡ä»£ç è¢«å°è£…åœ¨whileå¾ªç¯ä¸­ï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¸€éä»»åŠ¡ä»£ç å°±æ£€æŸ¥ä¸€ä¸‹ä¸­æ–­çŠ¶æ€ï¼›ä¸€æ—¦å‘ç”Ÿä¸­æ–­ï¼Œåˆ™è·³è¿‡whileå¾ªç¯ï¼Œç›´æ¥æ‰§è¡Œåé¢çš„ä¸­æ–­å¤„ç†ä»£ç ã€‚</p> </li> <li> <p>è§¦å‘ä¸­æ–­</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">t1</span><span class="p">.</span><span class="na">interrupt</span><span class="p">();</span>
</span></code></pre></div> <p>ä¸Šè¿°ä»£ç æ‰§è¡Œåä¼šå°†t1å¯¹è±¡çš„ä¸­æ–­çŠ¶æ€è®¾ä¸ºtrueï¼Œæ­¤æ—¶t1çº¿ç¨‹çš„æ­£å¸¸ä»»åŠ¡ä»£ç æ‰§è¡Œå®Œæˆåï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡whileå¾ªç¯å‰Thread.currentThread.isInterrupted()çš„ç»“æœä¸ºtrueï¼Œæ­¤æ—¶é€€å‡ºå¾ªç¯ï¼Œæ‰§è¡Œå¾ªç¯åé¢çš„ä¸­æ–­å¤„ç†ä»£ç ã€‚</p> </li> </ol> <p>stopå‡½æ•°åœæ­¢çº¿ç¨‹è¿‡äºæš´åŠ›ï¼Œå®ƒä¼šç«‹å³åœæ­¢çº¿ç¨‹ï¼Œä¸ç»™ä»»ä½•èµ„æºé‡Šæ”¾çš„ä½™åœ°ã€‚è€Œä¸Šè¿°æ–¹æ³•è¾ƒä¸ºå®‰å…¨ï¼Œå› ä¸ºä¸€æ¡çº¿ç¨‹å‘å‡ºç»ˆæ­¢ä¿¡å·åï¼Œæ¥æ”¶çº¿ç¨‹å¹¶ä¸ä¼šç«‹å³åœæ­¢ï¼Œè€Œæ˜¯å°†æœ¬æ¬¡å¾ªç¯çš„ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå†è·³å‡ºå¾ªç¯åœæ­¢çº¿ç¨‹ã€‚æ­¤å¤–ï¼Œç¨‹åºå‘˜åˆå¯ä»¥åœ¨è·³å‡ºå¾ªç¯åæ·»åŠ é¢å¤–çš„ä»£ç è¿›è¡Œæ”¶å°¾å·¥ä½œã€‚</p> <h3 id="107synchronized">10.7ã€synchronized<a class="headerlink" href="#107synchronized" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å½“ç¨‹åºä¸­å¯èƒ½å‡ºç°å¹¶å‘çš„æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦é€šè¿‡ä¸€å®šçš„æ‰‹æ®µæ¥ä¿è¯åœ¨å¹¶å‘æƒ…å†µä¸‹æ•°æ®çš„å‡†ç¡®æ€§ï¼Œé€šè¿‡è¿™ç§æ‰‹æ®µä¿è¯äº†å½“å‰ç”¨æˆ·å’Œå…¶ä»–ç”¨æˆ·ä¸€èµ·æ“ä½œæ—¶ï¼Œæ‰€å¾—åˆ°çš„ç»“æœå’Œä»–å•ç‹¬æ“ä½œæ—¶çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚è¿™ç§æ‰‹æ®µå°±å«åšå¹¶å‘æ§åˆ¶ã€‚å¹¶å‘æ§åˆ¶çš„ç›®çš„æ˜¯ä¿è¯ä¸€ä¸ªç”¨æˆ·çš„å·¥ä½œä¸ä¼šå¯¹å¦ä¸€ä¸ªç”¨æˆ·çš„å·¥ä½œäº§ç”Ÿä¸åˆç†çš„å½±å“ã€‚</p> <p>çº¿ç¨‹å®‰å…¨æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­çš„é‡è¦å…³æ³¨ç‚¹ï¼Œåº”è¯¥æ³¨æ„åˆ°çš„æ˜¯ï¼Œé€ æˆçº¿ç¨‹å®‰å…¨é—®é¢˜çš„ä¸»è¦è¯±å› æœ‰ä¸¤ç‚¹ï¼Œä¸€æ˜¯å­˜åœ¨å…±äº«æ•°æ®(ä¹Ÿç§°ä¸´ç•Œèµ„æº)ï¼ŒäºŒæ˜¯å­˜åœ¨å¤šæ¡çº¿ç¨‹å…±åŒæ“ä½œå…±äº«æ•°æ®ã€‚</p> <p>å› æ­¤ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è¿™æ ·ä¸€ä¸ªæ–¹æ¡ˆï¼Œå½“å­˜åœ¨å¤šä¸ªçº¿ç¨‹æ“ä½œå…±äº«æ•°æ®æ—¶ï¼Œéœ€è¦ä¿è¯åŒä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œå…±äº«æ•°æ®ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰åˆ°è¯¥çº¿ç¨‹å¤„ç†å®Œæ•°æ®åå†è¿›è¡Œï¼Œè¿™ç§æ–¹å¼æœ‰ä¸ªé«˜å°šçš„åç§°å«äº’æ–¥é”ï¼Œå³èƒ½è¾¾åˆ°äº’æ–¥è®¿é—®ç›®çš„çš„é”ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä¸€ä¸ªå…±äº«æ•°æ®è¢«å½“å‰æ­£åœ¨è®¿é—®çš„çº¿ç¨‹åŠ ä¸Šäº’æ–¥é”åï¼Œåœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œå…¶ä»–çº¿ç¨‹åªèƒ½å¤„äºç­‰å¾…çš„çŠ¶æ€ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹å¤„ç†å®Œæ¯•é‡Šæ”¾è¯¥é”ã€‚</p> <p>åœ¨ Java ä¸­ï¼Œå…³é”®å­— synchronizedå¯ä»¥ä¿è¯åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—(ä¸»è¦æ˜¯å¯¹æ–¹æ³•æˆ–è€…ä»£ç å—ä¸­å­˜åœ¨å…±äº«æ•°æ®çš„æ“ä½œ)ï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜åº”è¯¥æ³¨æ„åˆ°synchronizedå¦å¤–ä¸€ä¸ªé‡è¦çš„ä½œç”¨ï¼Œsynchronizedå¯ä¿è¯ä¸€ä¸ªçº¿ç¨‹çš„å˜åŒ–(ä¸»è¦æ˜¯å…±äº«æ•°æ®çš„å˜åŒ–)è¢«å…¶ä»–çº¿ç¨‹æ‰€çœ‹åˆ°ï¼ˆä¿è¯å¯è§æ€§ï¼Œå®Œå…¨å¯ä»¥æ›¿ä»£VolatileåŠŸèƒ½ï¼‰ï¼Œè¿™ç‚¹ç¡®å®ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚</p> <p>synchronizedå…³é”®å­—æœ€ä¸»è¦æœ‰ä»¥ä¸‹3ç§åº”ç”¨æ–¹å¼ï¼š</p> <ul> <li>ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œä½œç”¨äºå½“å‰å®ä¾‹åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰å®ä¾‹çš„é”</li> <li>ä¿®é¥°é™æ€æ–¹æ³•ï¼Œä½œç”¨äºå½“å‰ç±»å¯¹è±¡åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰ç±»å¯¹è±¡çš„é”</li> <li>ä¿®é¥°ä»£ç å—ï¼ŒæŒ‡å®šåŠ é”å¯¹è±¡ï¼Œå¯¹ç»™å®šå¯¹è±¡åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç åº“å‰è¦è·å¾—ç»™å®šå¯¹è±¡çš„é”ã€‚</li> </ul> <h4 id="1171ä¿®é¥°å®ä¾‹æ–¹æ³•">11.7.1ã€ä¿®é¥°å®ä¾‹æ–¹æ³•<a class="headerlink" href="#1171ä¿®é¥°å®ä¾‹æ–¹æ³•" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>æ‰€è°“çš„å®ä¾‹å¯¹è±¡é”å°±æ˜¯ç”¨synchronizedä¿®é¥°å®ä¾‹å¯¹è±¡ä¸­çš„å®ä¾‹æ–¹æ³•ï¼Œæ³¨æ„æ˜¯å®ä¾‹æ–¹æ³•ä¸åŒ…æ‹¬é™æ€æ–¹æ³•ï¼Œå¦‚ä¸‹</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountingSync</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="p">{</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">    </span><span class="c1">//å…±äº«èµ„æº(ä¸´ç•Œèµ„æº)</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="cm">     * synchronized ä¿®é¥°å®ä¾‹æ–¹æ³•</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="cm">     */</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">increase</span><span class="p">(){</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">        </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">1000000</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">            </span><span class="n">increase</span><span class="p">();</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="w">        </span><span class="n">AccountingSync</span><span class="w"> </span><span class="n">instance</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">AccountingSync</span><span class="p">();</span>
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">t1</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">instance</span><span class="p">);</span>
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">t2</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">instance</span><span class="p">);</span>
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a><span class="w">        </span><span class="n">t1</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="w">        </span><span class="n">t2</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a><span class="w">        </span><span class="n">t1</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="w">        </span><span class="n">t2</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a><span class="cm">     * è¾“å‡ºç»“æœ:</span>
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a><span class="cm">     * 2000000</span>
</span><span id="__span-50-30"><a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a><span class="cm">     */</span>
</span><span id="__span-50-31"><a id="__codelineno-50-31" name="__codelineno-50-31" href="#__codelineno-50-31"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¼€å¯ä¸¤ä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå…±äº«èµ„æºå³å˜é‡iï¼Œç”±äºi++;æ“ä½œå¹¶ä¸å…·å¤‡åŸå­æ€§ï¼Œè¯¥æ“ä½œæ˜¯å…ˆè¯»å–å€¼ï¼Œç„¶åå†™å›ä¸€ä¸ªæ–°å€¼ï¼Œç›¸å½“äºåŸæ¥çš„å€¼åŠ ä¸Š1ï¼Œåˆ†ä¸¤æ­¥å®Œæˆï¼Œå¦‚æœç¬¬äºŒä¸ªçº¿ç¨‹åœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹è¯»å–æ—§å€¼å’Œå†™å›æ–°å€¼æœŸé—´è¯»å–içš„åŸŸå€¼ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªçº¿ç¨‹å°±ä¼šä¸ç¬¬ä¸€ä¸ªçº¿ç¨‹ä¸€èµ·çœ‹åˆ°åŒä¸€ä¸ªå€¼ï¼Œå¹¶æ‰§è¡Œç›¸åŒå€¼çš„åŠ 1æ“ä½œï¼Œè¿™ä¹Ÿå°±é€ æˆäº†çº¿ç¨‹å®‰å…¨å¤±è´¥ï¼Œå› æ­¤å¯¹äºincreaseæ–¹æ³•å¿…é¡»ä½¿ç”¨synchronizedä¿®é¥°ï¼Œä»¥ä¾¿ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p> <p>æ­¤æ—¶æˆ‘ä»¬åº”è¯¥æ³¨æ„åˆ°synchronizedä¿®é¥°çš„æ˜¯å®ä¾‹æ–¹æ³•increaseï¼Œåœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œå½“å‰çº¿ç¨‹çš„é”ä¾¿æ˜¯å®ä¾‹å¯¹è±¡instanceï¼Œæ³¨æ„Javaä¸­çš„çº¿ç¨‹åŒæ­¥é”å¯ä»¥æ˜¯ä»»æ„å¯¹è±¡ã€‚ä»ä»£ç æ‰§è¡Œç»“æœæ¥çœ‹ç¡®å®æ˜¯æ­£ç¡®çš„ï¼Œå€˜è‹¥æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨synchronizedå…³é”®å­—ï¼Œå…¶æœ€ç»ˆè¾“å‡ºç»“æœå°±å¾ˆå¯èƒ½å°äº2000000ï¼Œè¿™ä¾¿æ˜¯synchronizedå…³é”®å­—çš„ä½œç”¨ã€‚</p> <p>è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦æ„è¯†åˆ°ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„ synchronized å®ä¾‹æ–¹æ³•ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹ä¸èƒ½è®¿é—®è¯¥å¯¹è±¡çš„å…¶ä»– synchronized æ–¹æ³•ï¼Œæ¯•ç«Ÿä¸€ä¸ªå¯¹è±¡åªæœ‰ä¸€æŠŠé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†è¯¥å¯¹è±¡çš„é”ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å–è¯¥å¯¹è±¡çš„é”ï¼Œæ‰€ä»¥æ— æ³•è®¿é—®è¯¥å¯¹è±¡çš„å…¶ä»–synchronizedå®ä¾‹æ–¹æ³•ï¼Œä½†æ˜¯å…¶ä»–çº¿ç¨‹è¿˜æ˜¯å¯ä»¥è®¿é—®è¯¥å®ä¾‹å¯¹è±¡çš„å…¶ä»–ésynchronizedæ–¹æ³•ï¼Œå½“ç„¶å¦‚æœæ˜¯ä¸€ä¸ªçº¿ç¨‹ A éœ€è¦è®¿é—®å®ä¾‹å¯¹è±¡ obj1 çš„ synchronized æ–¹æ³• f1(å½“å‰å¯¹è±¡é”æ˜¯obj1)ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ B éœ€è¦è®¿é—®å®ä¾‹å¯¹è±¡ obj2 çš„ synchronized æ–¹æ³• f2(å½“å‰å¯¹è±¡é”æ˜¯obj2)ï¼Œè¿™æ ·æ˜¯å…è®¸çš„ï¼Œå› ä¸ºä¸¤ä¸ªå®ä¾‹å¯¹è±¡é”å¹¶ä¸åŒç›¸åŒï¼Œæ­¤æ—¶å¦‚æœä¸¤ä¸ªçº¿ç¨‹æ“ä½œæ•°æ®å¹¶éå…±äº«çš„ï¼Œçº¿ç¨‹å®‰å…¨æ˜¯æœ‰ä¿éšœçš„ï¼Œé—æ†¾çš„æ˜¯å¦‚æœä¸¤ä¸ªçº¿ç¨‹æ“ä½œçš„æ˜¯å…±äº«æ•°æ®ï¼Œé‚£ä¹ˆçº¿ç¨‹å®‰å…¨å°±æœ‰å¯èƒ½æ— æ³•ä¿è¯äº†ï¼Œå¦‚ä¸‹ä»£ç å°†æ¼”ç¤ºå‡ºè¯¥ç°è±¡ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountingSyncBad</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="p">{</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">increase</span><span class="p">(){</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">        </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">1000000</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">            </span><span class="n">increase</span><span class="p">();</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="w">        </span><span class="c1">//newæ–°å®ä¾‹</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">t1</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">AccountingSyncBad</span><span class="p">());</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">        </span><span class="c1">//newæ–°å®ä¾‹</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">t2</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">AccountingSyncBad</span><span class="p">());</span>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="w">        </span><span class="n">t1</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="w">        </span><span class="n">t2</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="w">        </span><span class="c1">//joinå«ä¹‰:å½“å‰çº¿ç¨‹Aç­‰å¾…threadçº¿ç¨‹ç»ˆæ­¢ä¹‹åæ‰èƒ½ä»thread.join()è¿”å›</span>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="w">        </span><span class="n">t1</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a><span class="w">        </span><span class="n">t2</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šè¿°ä»£ç ä¸å‰é¢ä¸åŒçš„æ˜¯æˆ‘ä»¬åŒæ—¶åˆ›å»ºäº†ä¸¤ä¸ªæ–°å®ä¾‹AccountingSyncBadï¼Œç„¶åå¯åŠ¨ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹å¯¹å…±äº«å˜é‡iè¿›è¡Œæ“ä½œï¼Œä½†å¾ˆé—æ†¾æ“ä½œç»“æœæ˜¯1452317è€Œä¸æ˜¯æœŸæœ›ç»“æœ2000000ï¼Œå› ä¸ºä¸Šè¿°ä»£ç çŠ¯äº†ä¸¥é‡çš„é”™è¯¯ï¼Œè™½ç„¶æˆ‘ä»¬ä½¿ç”¨synchronizedä¿®é¥°äº†increaseæ–¹æ³•ï¼Œä½†å´newäº†ä¸¤ä¸ªä¸åŒçš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€å­˜åœ¨ç€ä¸¤ä¸ªä¸åŒçš„å®ä¾‹å¯¹è±¡é”ï¼Œå› æ­¤t1å’Œt2éƒ½ä¼šè¿›å…¥å„è‡ªçš„å¯¹è±¡é”ï¼Œä¹Ÿå°±æ˜¯è¯´t1å’Œt2çº¿ç¨‹ä½¿ç”¨çš„æ˜¯ä¸åŒçš„é”ï¼Œå› æ­¤çº¿ç¨‹å®‰å…¨æ˜¯æ— æ³•ä¿è¯çš„ã€‚è§£å†³è¿™ç§å›°å¢ƒçš„çš„æ–¹å¼æ˜¯å°†synchronizedä½œç”¨äºé™æ€çš„increaseæ–¹æ³•ï¼Œè¿™æ ·çš„è¯ï¼Œå¯¹è±¡é”å°±å½“å‰ç±»å¯¹è±¡ï¼Œç”±äºæ— è®ºåˆ›å»ºå¤šå°‘ä¸ªå®ä¾‹å¯¹è±¡ï¼Œä½†å¯¹äºçš„ç±»å¯¹è±¡æ‹¥æœ‰åªæœ‰ä¸€ä¸ªï¼Œæ‰€æœ‰åœ¨è¿™æ ·çš„æƒ…å†µä¸‹å¯¹è±¡é”å°±æ˜¯å”¯ä¸€çš„ã€‚</p> <p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å°†synchronizedä½œç”¨äºé™æ€çš„increaseæ–¹æ³•ã€‚</p> <h4 id="1172ä¿®é¥°é™æ€æ–¹æ³•">11.7.2ã€ä¿®é¥°é™æ€æ–¹æ³•<a class="headerlink" href="#1172ä¿®é¥°é™æ€æ–¹æ³•" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>å½“synchronizedä½œç”¨äºé™æ€æ–¹æ³•æ—¶ï¼Œå…¶é”å°±æ˜¯å½“å‰ç±»çš„classå¯¹è±¡é”ã€‚ç”±äºé™æ€æˆå‘˜ä¸ä¸“å±äºä»»ä½•ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ˜¯ç±»æˆå‘˜ï¼Œå› æ­¤é€šè¿‡classå¯¹è±¡é”å¯ä»¥æ§åˆ¶é™æ€ æˆå‘˜çš„å¹¶å‘æ“ä½œã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä¸€ä¸ªçº¿ç¨‹Aè°ƒç”¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„éstatic synchronizedæ–¹æ³•ï¼Œè€Œçº¿ç¨‹Béœ€è¦è°ƒç”¨è¿™ä¸ªå®ä¾‹å¯¹è±¡æ‰€å±ç±»çš„é™æ€ synchronizedæ–¹æ³•ï¼Œæ˜¯å…è®¸çš„ï¼Œä¸ä¼šå‘ç”Ÿäº’æ–¥ç°è±¡ï¼Œå› ä¸ºè®¿é—®é™æ€ synchronized æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰ç±»çš„classå¯¹è±¡ï¼Œè€Œè®¿é—®éé™æ€ synchronized æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡é”ï¼Œçœ‹å¦‚ä¸‹ä»£ç ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountingSyncClass</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="p">{</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="cm">     * ä½œç”¨äºé™æ€æ–¹æ³•,é”æ˜¯å½“å‰classå¯¹è±¡,ä¹Ÿå°±æ˜¯</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="cm">     * AccountingSyncClassç±»å¯¹åº”çš„classå¯¹è±¡</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="cm">     */</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">increase</span><span class="p">(){</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="w">        </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="cm">     * éé™æ€,è®¿é—®æ—¶é”ä¸ä¸€æ ·ä¸ä¼šå‘ç”Ÿäº’æ–¥</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="cm">     */</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">increase4Obj</span><span class="p">(){</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="w">        </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a>
</span><span id="__span-52-19"><a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-52-20"><a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-21"><a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">1000000</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-52-22"><a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="w">            </span><span class="n">increase</span><span class="p">();</span>
</span><span id="__span-52-23"><a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-52-24"><a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-25"><a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-26"><a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a><span class="w">        </span><span class="c1">//newæ–°å®ä¾‹</span>
</span><span id="__span-52-27"><a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">t1</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">AccountingSyncClass</span><span class="p">());</span>
</span><span id="__span-52-28"><a id="__codelineno-52-28" name="__codelineno-52-28" href="#__codelineno-52-28"></a><span class="w">        </span><span class="c1">//newå¿ƒäº‹äº†</span>
</span><span id="__span-52-29"><a id="__codelineno-52-29" name="__codelineno-52-29" href="#__codelineno-52-29"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">t2</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">AccountingSyncClass</span><span class="p">());</span>
</span><span id="__span-52-30"><a id="__codelineno-52-30" name="__codelineno-52-30" href="#__codelineno-52-30"></a><span class="w">        </span><span class="c1">//å¯åŠ¨çº¿ç¨‹</span>
</span><span id="__span-52-31"><a id="__codelineno-52-31" name="__codelineno-52-31" href="#__codelineno-52-31"></a><span class="w">        </span><span class="n">t1</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="n">t2</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-52-32"><a id="__codelineno-52-32" name="__codelineno-52-32" href="#__codelineno-52-32"></a>
</span><span id="__span-52-33"><a id="__codelineno-52-33" name="__codelineno-52-33" href="#__codelineno-52-33"></a><span class="w">        </span><span class="n">t1</span><span class="p">.</span><span class="na">join</span><span class="p">();</span><span class="n">t2</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
</span><span id="__span-52-34"><a id="__codelineno-52-34" name="__codelineno-52-34" href="#__codelineno-52-34"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-52-35"><a id="__codelineno-52-35" name="__codelineno-52-35" href="#__codelineno-52-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-36"><a id="__codelineno-52-36" name="__codelineno-52-36" href="#__codelineno-52-36"></a><span class="p">}</span>
</span></code></pre></div> <p>ç”±äºsynchronizedå…³é”®å­—ä¿®é¥°çš„æ˜¯é™æ€increaseæ–¹æ³•ï¼Œä¸ä¿®é¥°å®ä¾‹æ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œå…¶é”å¯¹è±¡æ˜¯å½“å‰ç±»çš„classå¯¹è±¡ã€‚æ³¨æ„ä»£ç ä¸­çš„increase4Objæ–¹æ³•æ˜¯å®ä¾‹æ–¹æ³•ï¼Œå…¶å¯¹è±¡é”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ï¼Œå¦‚æœåˆ«çš„çº¿ç¨‹è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå°†ä¸ä¼šäº§ç”Ÿäº’æ–¥ç°è±¡ï¼Œæ¯•ç«Ÿé”å¯¹è±¡ä¸åŒï¼Œä½†æˆ‘ä»¬åº”è¯¥æ„è¯†åˆ°è¿™ç§æƒ…å†µä¸‹å¯èƒ½ä¼šå‘ç°çº¿ç¨‹å®‰å…¨é—®é¢˜(æ“ä½œäº†å…±äº«é™æ€å˜é‡i)ã€‚</p> <h4 id="1173ä¿®é¥°ä»£ç å—">11.7.3ã€ä¿®é¥°ä»£ç å—<a class="headerlink" href="#1173ä¿®é¥°ä»£ç å—" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>é™¤äº†ä½¿ç”¨å…³é”®å­—ä¿®é¥°å®ä¾‹æ–¹æ³•å’Œé™æ€æ–¹æ³•å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åŒæ­¥ä»£ç å—ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç¼–å†™çš„æ–¹æ³•ä½“å¯èƒ½æ¯”è¾ƒå¤§ï¼ŒåŒæ—¶å­˜åœ¨ä¸€äº›æ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œè€Œéœ€è¦åŒæ­¥çš„ä»£ç åˆåªæœ‰ä¸€å°éƒ¨åˆ†ï¼Œå¦‚æœç›´æ¥å¯¹æ•´ä¸ªæ–¹æ³•è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œå¯èƒ½ä¼šå¾—ä¸å¿å¤±ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒæ­¥ä»£ç å—çš„æ–¹å¼å¯¹éœ€è¦åŒæ­¥çš„ä»£ç è¿›è¡ŒåŒ…è£¹ï¼Œè¿™æ ·å°±æ— éœ€å¯¹æ•´ä¸ªæ–¹æ³•è¿›è¡ŒåŒæ­¥æ“ä½œäº†ï¼ŒåŒæ­¥ä»£ç å—çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountingSync</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="p">{</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">AccountingSync</span><span class="w"> </span><span class="n">instance</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">AccountingSync</span><span class="p">();</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="w">        </span><span class="c1">//çœç•¥å…¶ä»–è€—æ—¶æ“ä½œ....</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="w">        </span><span class="c1">//ä½¿ç”¨åŒæ­¥ä»£ç å—å¯¹å˜é‡iè¿›è¡ŒåŒæ­¥æ“ä½œ,é”å¯¹è±¡ä¸ºinstance</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="w">        </span><span class="kd">synchronized</span><span class="p">(</span><span class="n">instance</span><span class="p">){</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">1000000</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="w">                    </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">t1</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">instance</span><span class="p">);</span>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">t2</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">instance</span><span class="p">);</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="w">        </span><span class="n">t1</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="n">t2</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="w">        </span><span class="n">t1</span><span class="p">.</span><span class="na">join</span><span class="p">();</span><span class="n">t2</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a><span class="p">}</span>
</span></code></pre></div> <p>ä»ä»£ç çœ‹å‡ºï¼Œå°†synchronizedä½œç”¨äºä¸€ä¸ªç»™å®šçš„å®ä¾‹å¯¹è±¡instanceï¼Œå³å½“å‰å®ä¾‹å¯¹è±¡å°±æ˜¯é”å¯¹è±¡ï¼Œæ¯æ¬¡å½“çº¿ç¨‹è¿›å…¥synchronizedåŒ…è£¹çš„ä»£ç å—æ—¶å°±ä¼šè¦æ±‚å½“å‰çº¿ç¨‹æŒæœ‰instanceå®ä¾‹å¯¹è±¡é”ï¼Œå¦‚æœå½“å‰æœ‰å…¶ä»–çº¿ç¨‹æ­£æŒæœ‰è¯¥å¯¹è±¡é”ï¼Œé‚£ä¹ˆæ–°åˆ°çš„çº¿ç¨‹å°±å¿…é¡»ç­‰å¾…ï¼Œè¿™æ ·ä¹Ÿå°±ä¿è¯äº†æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œi++;æ“ä½œã€‚å½“ç„¶é™¤äº†instanceä½œä¸ºå¯¹è±¡å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨thiså¯¹è±¡(ä»£è¡¨å½“å‰å®ä¾‹)æˆ–è€…å½“å‰ç±»çš„classå¯¹è±¡ä½œä¸ºé”ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1">//this,å½“å‰å®ä¾‹å¯¹è±¡é”</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="kd">synchronized</span><span class="p">(</span><span class="k">this</span><span class="p">){</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">1000000</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">        </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="p">}</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="c1">//classå¯¹è±¡é”</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="kd">synchronized</span><span class="p">(</span><span class="n">AccountingSync</span><span class="p">.</span><span class="na">class</span><span class="p">){</span>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">1000000</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="w">        </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="p">}</span>
</span></code></pre></div> <h4 id="1174åº•å±‚åŸç†">11.7.4ã€åº•å±‚åŸç†<a class="headerlink" href="#1174åº•å±‚åŸç†" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Java è™šæ‹Ÿæœºä¸­çš„åŒæ­¥(Synchronization)åŸºäºè¿›å…¥å’Œé€€å‡ºç®¡ç¨‹(Monitor)å¯¹è±¡å®ç°ï¼Œ æ— è®ºæ˜¯æ˜¾å¼åŒæ­¥(æœ‰æ˜ç¡®çš„ monitorenter å’Œ monitorexit æŒ‡ä»¤,å³åŒæ­¥ä»£ç å—)è¿˜æ˜¯éšå¼åŒæ­¥éƒ½æ˜¯å¦‚æ­¤ã€‚åœ¨ Java è¯­è¨€ä¸­ï¼ŒåŒæ­¥ç”¨çš„æœ€å¤šçš„åœ°æ–¹å¯èƒ½æ˜¯è¢« synchronized ä¿®é¥°çš„åŒæ­¥æ–¹æ³•ã€‚</p> <p>åŒæ­¥æ–¹æ³• å¹¶ä¸æ˜¯ç”± monitorenter å’Œ monitorexit æŒ‡ä»¤æ¥å®ç°åŒæ­¥çš„ï¼Œè€Œæ˜¯ç”±æ–¹æ³•è°ƒç”¨æŒ‡ä»¤è¯»å–è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æ–¹æ³•çš„ ACC_SYNCHRONIZED æ ‡å¿—æ¥éšå¼å®ç°çš„ï¼Œå…³äºè¿™ç‚¹ï¼Œç¨åè¯¦ç»†åˆ†æã€‚ä¸‹é¢å…ˆæ¥äº†è§£ä¸€ä¸ªæ¦‚å¿µJavaå¯¹è±¡å¤´ï¼Œè¿™å¯¹æ·±å…¥ç†è§£synchronizedå®ç°åŸç†éå¸¸å…³é”®ã€‚</p> <hr> <p><strong>ç†è§£Javaå¯¹è±¡å¤´ä¸Monitor</strong></p> <p>åœ¨JVMä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€åˆ†ä¸ºä¸‰å—åŒºåŸŸï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……ã€‚å¦‚ä¸‹ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/20170603163237166.png" data-desc-position="bottom"><img src="!assets/Java/20170603163237166.png" alt="img" style="zoom:80%;"></a></p> <ul> <li>å®ä¾‹å˜é‡ï¼šå­˜æ”¾ç±»çš„å±æ€§æ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„å±æ€§ä¿¡æ¯ï¼Œå¦‚æœæ˜¯æ•°ç»„çš„å®ä¾‹éƒ¨åˆ†è¿˜åŒ…æ‹¬æ•°ç»„çš„é•¿åº¦ï¼Œè¿™éƒ¨åˆ†å†…å­˜æŒ‰4å­—èŠ‚å¯¹é½ã€‚</li> <li>å¡«å……æ•°æ®ï¼šç”±äºè™šæ‹Ÿæœºè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ã€‚å¡«å……æ•°æ®ä¸æ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œä»…ä»…æ˜¯ä¸ºäº†å­—èŠ‚å¯¹é½ã€‚ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰è¢«é—®è¿‡ä¸€ä¸ªç©ºå¯¹è±¡å å¤šå°‘ä¸ªå­—èŠ‚ï¼Ÿå°±æ˜¯8ä¸ªå­—èŠ‚ï¼Œæ˜¯å› ä¸ºå¯¹é½å¡«å……çš„å…³ç³»å“ˆï¼Œä¸åˆ°8ä¸ªå­—èŠ‚å¯¹å…¶å¡«å……ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨è¡¥é½ã€‚å¦‚æœæ˜¯<code>Object o=new Object();</code>ï¼Œé‚£ä¹ˆç©ºå¯¹è±¡å 8å­—èŠ‚ï¼Œå¯¹è±¡çš„å¼•ç”¨å 4å­—èŠ‚ï¼ŒåŠ ä¸Šå¡«å……æ•°æ®å³æ€»å…±å ç”¨16å­—èŠ‚ï¼Œè¿™ç‚¹äº†è§£å³å¯ã€‚</li> </ul> <p>è€Œå¯¹äºé¡¶éƒ¨ï¼Œåˆ™æ˜¯Javaå¤´å¯¹è±¡ï¼Œå®ƒå®ç°synchronizedçš„é”å¯¹è±¡çš„åŸºç¡€ï¼Œè¿™ç‚¹æˆ‘ä»¬é‡ç‚¹åˆ†æå®ƒï¼Œä¸€èˆ¬è€Œè¨€ï¼Œsynchronizedä½¿ç”¨çš„é”å¯¹è±¡æ˜¯å­˜å‚¨åœ¨Javaå¯¹è±¡å¤´é‡Œçš„ï¼Œjvmä¸­é‡‡ç”¨2ä¸ªå­—èŠ‚æ¥å­˜å‚¨å¯¹è±¡å¤´(å¦‚æœå¯¹è±¡æ˜¯æ•°ç»„åˆ™ä¼šåˆ†é…3ä¸ªå­—èŠ‚ï¼Œå¤šå‡ºæ¥çš„1ä¸ªå­—èŠ‚è®°å½•çš„æ˜¯æ•°ç»„é•¿åº¦)ï¼Œå…¶ä¸»è¦ç»“æ„æ˜¯ç”±Mark Word å’Œ Class Metadata Address ç»„æˆï¼Œå…¶ç»“æ„è¯´æ˜å¦‚ä¸‹è¡¨ï¼š</p> <table> <thead> <tr> <th>è™šæ‹Ÿæœºä½æ•°</th> <th>å¤´å¯¹è±¡ç»“æ„</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>32/64bit</td> <td>Mark Word</td> <td>å­˜å‚¨å¯¹è±¡çš„hashCodeã€é”ä¿¡æ¯æˆ–åˆ†ä»£å¹´é¾„æˆ–GCæ ‡å¿—ç­‰ä¿¡æ¯</td> </tr> <tr> <td>32/64bit</td> <td>Class Metadata Address</td> <td>ç±»å‹æŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„ç±»å…ƒæ•°æ®ï¼ŒJVMé€šè¿‡è¿™ä¸ªæŒ‡é’ˆç¡®å®šè¯¥å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚</td> </tr> </tbody> </table> <p>å…¶ä¸­Mark Wordåœ¨é»˜è®¤æƒ…å†µä¸‹å­˜å‚¨ç€å¯¹è±¡çš„HashCodeã€åˆ†ä»£å¹´é¾„ã€é”æ ‡è®°ä½ç­‰ä»¥ä¸‹æ˜¯32ä½JVMçš„Mark Wordé»˜è®¤å­˜å‚¨ç»“æ„</p> <table> <thead> <tr> <th>é”çŠ¶æ€</th> <th>25bit</th> <th>4bit</th> <th>1bitæ˜¯å¦æ˜¯åå‘é”</th> <th>2bit é”æ ‡å¿—ä½</th> </tr> </thead> <tbody> <tr> <td>æ— é”çŠ¶æ€</td> <td>å¯¹è±¡HashCode</td> <td>å¯¹è±¡åˆ†ä»£å¹´é¾„</td> <td>0</td> <td>01</td> </tr> </tbody> </table> <p>ç”±äºå¯¹è±¡å¤´çš„ä¿¡æ¯æ˜¯ä¸å¯¹è±¡è‡ªèº«å®šä¹‰çš„æ•°æ®æ²¡æœ‰å…³ç³»çš„é¢å¤–å­˜å‚¨æˆæœ¬ï¼Œå› æ­¤è€ƒè™‘åˆ°JVMçš„ç©ºé—´æ•ˆç‡ï¼ŒMark Word è¢«è®¾è®¡æˆä¸ºä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ï¼Œä»¥ä¾¿å­˜å‚¨æ›´å¤šæœ‰æ•ˆçš„æ•°æ®ï¼Œå®ƒä¼šæ ¹æ®å¯¹è±¡æœ¬èº«çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œå¦‚32ä½JVMä¸‹ï¼Œé™¤äº†ä¸Šè¿°åˆ—å‡ºçš„Mark Wordé»˜è®¤å­˜å‚¨ç»“æ„å¤–ï¼Œè¿˜æœ‰å¦‚ä¸‹å¯èƒ½å˜åŒ–çš„ç»“æ„ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/20170603172215966.png" data-desc-position="bottom"><img src="!assets/Java/20170603172215966.png" alt="img" style="zoom:80%;"></a></p> <p>å…¶ä¸­è½»é‡çº§é”å’Œåå‘é”æ˜¯Java 6 å¯¹ synchronized é”è¿›è¡Œä¼˜åŒ–åæ–°å¢åŠ çš„ï¼Œè¿™é‡Œä¸»è¦åˆ†æä¸€ä¸‹é‡é‡çº§é”ä¹Ÿå°±æ˜¯é€šå¸¸è¯´synchronizedçš„å¯¹è±¡é”ï¼Œé”æ ‡è¯†ä½ä¸º10ï¼Œå…¶ä¸­æŒ‡é’ˆæŒ‡å‘çš„æ˜¯monitorå¯¹è±¡ï¼ˆä¹Ÿç§°ä¸ºç®¡ç¨‹æˆ–ç›‘è§†å™¨é”ï¼‰çš„èµ·å§‹åœ°å€ã€‚</p> <p>æ¯ä¸ªå¯¹è±¡éƒ½å­˜åœ¨ç€ä¸€ä¸ª monitor ä¸ä¹‹å…³è”ï¼Œå¯¹è±¡ä¸å…¶ monitor ä¹‹é—´çš„å…³ç³»æœ‰å­˜åœ¨å¤šç§å®ç°æ–¹å¼ï¼Œå¦‚monitorå¯ä»¥ä¸å¯¹è±¡ä¸€èµ·åˆ›å»ºé”€æ¯æˆ–å½“çº¿ç¨‹è¯•å›¾è·å–å¯¹è±¡é”æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œä½†å½“ä¸€ä¸ª monitor è¢«æŸä¸ªçº¿ç¨‹æŒæœ‰åï¼Œå®ƒä¾¿å¤„äºé”å®šçŠ¶æ€ã€‚</p> <p>åœ¨Javaè™šæ‹Ÿæœº(HotSpot)ä¸­ï¼Œmonitoræ˜¯ç”±ObjectMonitorå®ç°çš„ï¼Œå…¶ä¸»è¦æ•°æ®ç»“æ„å¦‚ä¸‹ï¼ˆä½äºHotSpotè™šæ‹Ÿæœºæºç ObjectMonitor.hppæ–‡ä»¶ï¼ŒC++å®ç°çš„ï¼‰</p> <div class="language-C++ highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">ObjectMonitor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">    </span><span class="n">_header</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">    </span><span class="n">_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">//è®°å½•ä¸ªæ•°</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">    </span><span class="n">_waiters</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">    </span><span class="n">_recursions</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">    </span><span class="n">_object</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">    </span><span class="n">_owner</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="w">    </span><span class="n">_WaitSet</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"> </span><span class="c1">//å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°_WaitSet</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="w">    </span><span class="n">_WaitSetLock</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">    </span><span class="n">_Responsible</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="w">    </span><span class="n">_succ</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="w">    </span><span class="n">_cxq</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="w">    </span><span class="n">FreeNext</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a><span class="w">    </span><span class="n">_EntryList</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">//å¤„äºç­‰å¾…é”blockçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°è¯¥åˆ—è¡¨</span>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="w">    </span><span class="n">_SpinFreq</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="w">    </span><span class="n">_SpinClock</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-55-17"><a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a><span class="w">    </span><span class="n">OwnerIsThread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-55-18"><a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div> <p>ObjectMonitorä¸­æœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œ_ WaitSet å’Œ _ EntryListï¼Œç”¨æ¥ä¿å­˜ObjectWaiterå¯¹è±¡åˆ—è¡¨( æ¯ä¸ªç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¢«å°è£…æˆObjectWaiterå¯¹è±¡)ï¼Œ_owneræŒ‡å‘æŒæœ‰ObjectMonitorå¯¹è±¡çš„çº¿ç¨‹ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€æ®µåŒæ­¥ä»£ç æ—¶ï¼Œé¦–å…ˆä¼šè¿›å…¥ _EntryList é›†åˆï¼Œå½“çº¿ç¨‹è·å–åˆ°å¯¹è±¡çš„monitor åè¿›å…¥ _Owner åŒºåŸŸå¹¶æŠŠmonitorä¸­çš„ownerå˜é‡è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹åŒæ—¶monitorä¸­çš„è®¡æ•°å™¨countåŠ 1ï¼Œè‹¥çº¿ç¨‹è°ƒç”¨ wait() æ–¹æ³•ï¼Œå°†é‡Šæ”¾å½“å‰æŒæœ‰çš„monitorï¼Œownerå˜é‡æ¢å¤ä¸ºnullï¼Œcountè‡ªå‡1ï¼ŒåŒæ—¶è¯¥çº¿ç¨‹è¿›å…¥ WaitSe té›†åˆä¸­ç­‰å¾…è¢«å”¤é†’ã€‚è‹¥å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹Ÿå°†é‡Šæ”¾monitor(é”)å¹¶å¤ä½å˜é‡çš„å€¼ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹è¿›å…¥è·å–monitor(é”)ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/20170604114223462.png" data-desc-position="bottom"><img src="!assets/Java/20170604114223462.png" alt="img" style></a></p> <p>ç”±æ­¤çœ‹æ¥ï¼Œmonitorå¯¹è±¡å­˜åœ¨äºæ¯ä¸ªJavaå¯¹è±¡çš„å¯¹è±¡å¤´ä¸­(å­˜å‚¨çš„æŒ‡é’ˆçš„æŒ‡å‘)ï¼Œsynchronizedé”ä¾¿æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è·å–é”çš„ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆJavaä¸­ä»»æ„å¯¹è±¡å¯ä»¥ä½œä¸ºé”çš„åŸå› ï¼ŒåŒæ—¶ä¹Ÿæ˜¯notify/notifyAll/waitç­‰æ–¹æ³•å­˜åœ¨äºé¡¶çº§å¯¹è±¡Objectä¸­çš„åŸå› ã€‚</p> <hr> <p><strong>synchronizedä»£ç å—åº•å±‚åŸç†</strong></p> <p>ç°åœ¨é‡æ–°å®šä¹‰ä¸€ä¸ªsynchronizedä¿®é¥°çš„åŒæ­¥ä»£ç å—ï¼Œåœ¨ä»£ç å—ä¸­æ“ä½œå…±äº«å˜é‡iï¼Œå¦‚ä¸‹</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SyncCodeBlock</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">syncTask</span><span class="p">(){</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="w">       </span><span class="c1">//åŒæ­¥ä»£ç å—</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="w">       </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">){</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="w">           </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="w">       </span><span class="p">}</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="w">   </span><span class="p">}</span>
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="p">}</span>
</span></code></pre></div> <p>ç¼–è¯‘ä¸Šè¿°ä»£ç å¹¶ä½¿ç”¨javapåç¼–è¯‘åå¾—åˆ°å­—èŠ‚ç å¦‚ä¸‹(è¿™é‡Œæˆ‘ä»¬ä¸€éƒ¨åˆ†æ²¡æœ‰å¿…è¦çš„ä¿¡æ¯)ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="n">Classfile</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">zejian</span><span class="o">/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">Java8_Action</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">zejian</span><span class="o">/</span><span class="n">concurrencys</span><span class="o">/</span><span class="n">SyncCodeBlock</span><span class="p">.</span><span class="na">class</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="w">  </span><span class="n">Last</span><span class="w"> </span><span class="n">modified</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="mi">426</span><span class="w"> </span><span class="n">bytes</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w">  </span><span class="n">MD5</span><span class="w"> </span><span class="n">checksum</span><span class="w"> </span><span class="n">c80bc322c87b312de760942820b4fed5</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">  </span><span class="n">Compiled</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s">"SyncCodeBlock.java"</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">com</span><span class="p">.</span><span class="na">zejian</span><span class="p">.</span><span class="na">concurrencys</span><span class="p">.</span><span class="na">SyncCodeBlock</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="w">  </span><span class="n">minor</span><span class="w"> </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="w">  </span><span class="n">major</span><span class="w"> </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="mi">52</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="w">  </span><span class="n">flags</span><span class="p">:</span><span class="w"> </span><span class="n">ACC_PUBLIC</span><span class="p">,</span><span class="w"> </span><span class="n">ACC_SUPER</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="n">Constant</span><span class="w"> </span><span class="n">pool</span><span class="p">:</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="w">  </span><span class="c1">//........çœç•¥å¸¸é‡æ± ä¸­æ•°æ®</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="w">  </span><span class="c1">//æ„é€ å‡½æ•°</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">zejian</span><span class="p">.</span><span class="na">concurrencys</span><span class="p">.</span><span class="na">SyncCodeBlock</span><span class="p">();</span>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a><span class="w">    </span><span class="n">descriptor</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="n">V</span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a><span class="w">    </span><span class="n">flags</span><span class="p">:</span><span class="w"> </span><span class="n">ACC_PUBLIC</span>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a><span class="w">    </span><span class="n">Code</span><span class="p">:</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a><span class="w">      </span><span class="n">stack</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">locals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">args_size</span><span class="o">=</span><span class="mi">1</span>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a><span class="w">         </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="n">aload_0</span>
</span><span id="__span-57-18"><a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a><span class="w">         </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">invokespecial</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="w">                  </span><span class="c1">// Method java/lang/Object."&lt;init&gt;":()V</span>
</span><span id="__span-57-19"><a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a><span class="w">         </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="k">return</span>
</span><span id="__span-57-20"><a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a><span class="w">      </span><span class="n">LineNumberTable</span><span class="p">:</span>
</span><span id="__span-57-21"><a id="__codelineno-57-21" name="__codelineno-57-21" href="#__codelineno-57-21"></a><span class="w">        </span><span class="n">line</span><span class="w"> </span><span class="mi">7</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-57-22"><a id="__codelineno-57-22" name="__codelineno-57-22" href="#__codelineno-57-22"></a><span class="w">  </span><span class="c1">//===========ä¸»è¦çœ‹çœ‹syncTaskæ–¹æ³•å®ç°================</span>
</span><span id="__span-57-23"><a id="__codelineno-57-23" name="__codelineno-57-23" href="#__codelineno-57-23"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">syncTask</span><span class="p">();</span>
</span><span id="__span-57-24"><a id="__codelineno-57-24" name="__codelineno-57-24" href="#__codelineno-57-24"></a><span class="w">    </span><span class="n">descriptor</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="n">V</span>
</span><span id="__span-57-25"><a id="__codelineno-57-25" name="__codelineno-57-25" href="#__codelineno-57-25"></a><span class="w">    </span><span class="n">flags</span><span class="p">:</span><span class="w"> </span><span class="n">ACC_PUBLIC</span>
</span><span id="__span-57-26"><a id="__codelineno-57-26" name="__codelineno-57-26" href="#__codelineno-57-26"></a><span class="w">    </span><span class="n">Code</span><span class="p">:</span>
</span><span id="__span-57-27"><a id="__codelineno-57-27" name="__codelineno-57-27" href="#__codelineno-57-27"></a><span class="w">      </span><span class="n">stack</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">locals</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">args_size</span><span class="o">=</span><span class="mi">1</span>
</span><span id="__span-57-28"><a id="__codelineno-57-28" name="__codelineno-57-28" href="#__codelineno-57-28"></a><span class="w">         </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="n">aload_0</span>
</span><span id="__span-57-29"><a id="__codelineno-57-29" name="__codelineno-57-29" href="#__codelineno-57-29"></a><span class="w">         </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">dup</span>
</span><span id="__span-57-30"><a id="__codelineno-57-30" name="__codelineno-57-30" href="#__codelineno-57-30"></a><span class="w">         </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="n">astore_1</span>
</span><span id="__span-57-31"><a id="__codelineno-57-31" name="__codelineno-57-31" href="#__codelineno-57-31"></a><span class="w">         </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="n">monitorenter</span><span class="w">  </span><span class="c1">//æ³¨æ„æ­¤å¤„ï¼Œè¿›å…¥åŒæ­¥æ–¹æ³•</span>
</span><span id="__span-57-32"><a id="__codelineno-57-32" name="__codelineno-57-32" href="#__codelineno-57-32"></a><span class="w">         </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="n">aload_0</span>
</span><span id="__span-57-33"><a id="__codelineno-57-33" name="__codelineno-57-33" href="#__codelineno-57-33"></a><span class="w">         </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">dup</span>
</span><span id="__span-57-34"><a id="__codelineno-57-34" name="__codelineno-57-34" href="#__codelineno-57-34"></a><span class="w">         </span><span class="mi">6</span><span class="p">:</span><span class="w"> </span><span class="n">getfield</span><span class="w">      </span><span class="err">#</span><span class="mi">2</span><span class="w">             </span><span class="c1">// Field i:I</span>
</span><span id="__span-57-35"><a id="__codelineno-57-35" name="__codelineno-57-35" href="#__codelineno-57-35"></a><span class="w">         </span><span class="mi">9</span><span class="p">:</span><span class="w"> </span><span class="n">iconst_1</span>
</span><span id="__span-57-36"><a id="__codelineno-57-36" name="__codelineno-57-36" href="#__codelineno-57-36"></a><span class="w">        </span><span class="mi">10</span><span class="p">:</span><span class="w"> </span><span class="n">iadd</span>
</span><span id="__span-57-37"><a id="__codelineno-57-37" name="__codelineno-57-37" href="#__codelineno-57-37"></a><span class="w">        </span><span class="mi">11</span><span class="p">:</span><span class="w"> </span><span class="n">putfield</span><span class="w">      </span><span class="err">#</span><span class="mi">2</span><span class="w">            </span><span class="c1">// Field i:I</span>
</span><span id="__span-57-38"><a id="__codelineno-57-38" name="__codelineno-57-38" href="#__codelineno-57-38"></a><span class="w">        </span><span class="mi">14</span><span class="p">:</span><span class="w"> </span><span class="n">aload_1</span>
</span><span id="__span-57-39"><a id="__codelineno-57-39" name="__codelineno-57-39" href="#__codelineno-57-39"></a><span class="w">        </span><span class="mi">15</span><span class="p">:</span><span class="w"> </span><span class="n">monitorexit</span><span class="w">   </span><span class="c1">//æ³¨æ„æ­¤å¤„ï¼Œé€€å‡ºåŒæ­¥æ–¹æ³•</span>
</span><span id="__span-57-40"><a id="__codelineno-57-40" name="__codelineno-57-40" href="#__codelineno-57-40"></a><span class="w">        </span><span class="mi">16</span><span class="p">:</span><span class="w"> </span><span class="k">goto</span><span class="w">          </span><span class="mi">24</span>
</span><span id="__span-57-41"><a id="__codelineno-57-41" name="__codelineno-57-41" href="#__codelineno-57-41"></a><span class="w">        </span><span class="mi">19</span><span class="p">:</span><span class="w"> </span><span class="n">astore_2</span>
</span><span id="__span-57-42"><a id="__codelineno-57-42" name="__codelineno-57-42" href="#__codelineno-57-42"></a><span class="w">        </span><span class="mi">20</span><span class="p">:</span><span class="w"> </span><span class="n">aload_1</span>
</span><span id="__span-57-43"><a id="__codelineno-57-43" name="__codelineno-57-43" href="#__codelineno-57-43"></a><span class="w">        </span><span class="mi">21</span><span class="p">:</span><span class="w"> </span><span class="n">monitorexit</span><span class="w"> </span><span class="c1">//æ³¨æ„æ­¤å¤„ï¼Œé€€å‡ºåŒæ­¥æ–¹æ³•</span>
</span><span id="__span-57-44"><a id="__codelineno-57-44" name="__codelineno-57-44" href="#__codelineno-57-44"></a><span class="w">        </span><span class="mi">22</span><span class="p">:</span><span class="w"> </span><span class="n">aload_2</span>
</span><span id="__span-57-45"><a id="__codelineno-57-45" name="__codelineno-57-45" href="#__codelineno-57-45"></a><span class="w">        </span><span class="mi">23</span><span class="p">:</span><span class="w"> </span><span class="n">athrow</span>
</span><span id="__span-57-46"><a id="__codelineno-57-46" name="__codelineno-57-46" href="#__codelineno-57-46"></a><span class="w">        </span><span class="mi">24</span><span class="p">:</span><span class="w"> </span><span class="k">return</span>
</span><span id="__span-57-47"><a id="__codelineno-57-47" name="__codelineno-57-47" href="#__codelineno-57-47"></a><span class="w">      </span><span class="n">Exception</span><span class="w"> </span><span class="n">table</span><span class="p">:</span>
</span><span id="__span-57-48"><a id="__codelineno-57-48" name="__codelineno-57-48" href="#__codelineno-57-48"></a><span class="w">      </span><span class="c1">//çœç•¥å…¶ä»–å­—èŠ‚ç .......</span>
</span><span id="__span-57-49"><a id="__codelineno-57-49" name="__codelineno-57-49" href="#__codelineno-57-49"></a><span class="p">}</span>
</span><span id="__span-57-50"><a id="__codelineno-57-50" name="__codelineno-57-50" href="#__codelineno-57-50"></a><span class="nl">SourceFile</span><span class="p">:</span><span class="w"> </span><span class="s">"SyncCodeBlock.java"</span>
</span></code></pre></div> <p>ä¸»è¦å…³æ³¨å­—èŠ‚ç ä¸­çš„å¦‚ä¸‹ä»£ç </p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="n">monitorenter</span><span class="w">  </span><span class="c1">//è¿›å…¥åŒæ­¥æ–¹æ³•</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="c1">//..........çœç•¥å…¶ä»–  </span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="mi">15</span><span class="p">:</span><span class="w"> </span><span class="n">monitorexit</span><span class="w">   </span><span class="c1">//é€€å‡ºåŒæ­¥æ–¹æ³•</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="mi">16</span><span class="p">:</span><span class="w"> </span><span class="k">goto</span><span class="w">          </span><span class="mi">24</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="c1">//çœç•¥å…¶ä»–.......</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="mi">21</span><span class="p">:</span><span class="w"> </span><span class="n">monitorexit</span><span class="w"> </span><span class="c1">//é€€å‡ºåŒæ­¥æ–¹æ³•</span>
</span></code></pre></div> <p>ä»å­—èŠ‚ç ä¸­å¯çŸ¥åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯monitorenter å’Œ monitorexit æŒ‡ä»¤ï¼Œå…¶ä¸­monitorenteræŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼ŒmonitorexitæŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ï¼Œå½“æ‰§è¡ŒmonitorenteræŒ‡ä»¤æ—¶ï¼Œå½“å‰çº¿ç¨‹å°†è¯•å›¾è·å– objectref(å³å¯¹è±¡é”) æ‰€å¯¹åº”çš„ monitor çš„æŒæœ‰æƒï¼Œå½“ objectref çš„ monitor çš„è¿›å…¥è®¡æ•°å™¨ä¸º 0ï¼Œé‚£çº¿ç¨‹å¯ä»¥æˆåŠŸå–å¾— monitorï¼Œå¹¶å°†è®¡æ•°å™¨å€¼è®¾ç½®ä¸º 1ï¼Œå–é”æˆåŠŸã€‚å¦‚æœå½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰ objectref çš„ monitor çš„æŒæœ‰æƒï¼Œé‚£å®ƒå¯ä»¥é‡å…¥è¿™ä¸ª monitor (å…³äºé‡å…¥æ€§ç¨åä¼šåˆ†æ)ï¼Œé‡å…¥æ—¶è®¡æ•°å™¨çš„å€¼ä¹Ÿä¼šåŠ  1ã€‚å€˜è‹¥å…¶ä»–çº¿ç¨‹å·²ç»æ‹¥æœ‰ objectref çš„ monitor çš„æ‰€æœ‰æƒï¼Œé‚£å½“å‰çº¿ç¨‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°æ­£åœ¨æ‰§è¡Œçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå³monitorexitæŒ‡ä»¤è¢«æ‰§è¡Œï¼Œæ‰§è¡Œçº¿ç¨‹å°†é‡Šæ”¾ monitor(é”)å¹¶è®¾ç½®è®¡æ•°å™¨å€¼ä¸º0 ï¼Œå…¶ä»–çº¿ç¨‹å°†æœ‰æœºä¼šæŒæœ‰ monitor ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ç¼–è¯‘å™¨å°†ä¼šç¡®ä¿æ— è®ºæ–¹æ³•é€šè¿‡ä½•ç§æ–¹å¼å®Œæˆï¼Œæ–¹æ³•ä¸­è°ƒç”¨è¿‡çš„æ¯æ¡ monitorenter æŒ‡ä»¤éƒ½æœ‰æ‰§è¡Œå…¶å¯¹åº” monitorexit æŒ‡ä»¤ï¼Œè€Œæ— è®ºè¿™ä¸ªæ–¹æ³•æ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯å¼‚å¸¸ç»“æŸã€‚ä¸ºäº†ä¿è¯åœ¨æ–¹æ³•å¼‚å¸¸å®Œæˆæ—¶ monitorenter å’Œ monitorexit æŒ‡ä»¤ä¾ç„¶å¯ä»¥æ­£ç¡®é…å¯¹æ‰§è¡Œï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨ï¼Œè¿™ä¸ªå¼‚å¸¸å¤„ç†å™¨å£°æ˜å¯å¤„ç†æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå®ƒçš„ç›®çš„å°±æ˜¯ç”¨æ¥æ‰§è¡Œ monitorexit æŒ‡ä»¤ã€‚ä»å­—èŠ‚ç ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºå¤šäº†ä¸€ä¸ªmonitorexitæŒ‡ä»¤ï¼Œå®ƒå°±æ˜¯å¼‚å¸¸ç»“æŸæ—¶è¢«æ‰§è¡Œçš„é‡Šæ”¾monitor çš„æŒ‡ä»¤ã€‚</p> <hr> <p><strong>synchronizedæ–¹æ³•åº•å±‚åŸç†</strong></p> <p>æ–¹æ³•çº§çš„åŒæ­¥æ˜¯éšå¼ï¼Œå³æ— éœ€é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶çš„ï¼Œå®ƒå®ç°åœ¨æ–¹æ³•è°ƒç”¨å’Œè¿”å›æ“ä½œä¹‹ä¸­ã€‚JVMå¯ä»¥ä»æ–¹æ³•å¸¸é‡æ± ä¸­çš„æ–¹æ³•è¡¨ç»“æ„(method_info Structure) ä¸­çš„ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—åŒºåˆ†ä¸€ä¸ªæ–¹æ³•æ˜¯å¦åŒæ­¥æ–¹æ³•ã€‚å½“æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤å°†ä¼š æ£€æŸ¥æ–¹æ³•çš„ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—æ˜¯å¦è¢«è®¾ç½®ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œæ‰§è¡Œçº¿ç¨‹å°†å…ˆæŒæœ‰monitorï¼ˆè™šæ‹Ÿæœºè§„èŒƒä¸­ç”¨çš„æ˜¯ç®¡ç¨‹ä¸€è¯ï¼‰ï¼Œ ç„¶åå†æ‰§è¡Œæ–¹æ³•ï¼Œæœ€ååœ¨æ–¹æ³•å®Œæˆ(æ— è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯éæ­£å¸¸å®Œæˆ)æ—¶é‡Šæ”¾monitorã€‚åœ¨æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œæ‰§è¡Œçº¿ç¨‹æŒæœ‰äº†monitorï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ— æ³•å†è·å¾—åŒä¸€ä¸ªmonitorã€‚å¦‚æœä¸€ä¸ªåŒæ­¥æ–¹æ³•æ‰§è¡ŒæœŸé—´æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å†…éƒ¨æ— æ³•å¤„ç†æ­¤å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªåŒæ­¥æ–¹æ³•æ‰€æŒæœ‰çš„monitorå°†åœ¨å¼‚å¸¸æŠ›åˆ°åŒæ­¥æ–¹æ³•ä¹‹å¤–æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹å­—èŠ‚ç å±‚é¢å¦‚ä½•å®ç°ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SyncMethod</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">syncTask</span><span class="p">(){</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="w">           </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="w">   </span><span class="p">}</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="p">}</span>
</span></code></pre></div> <p>ä½¿ç”¨javapåç¼–è¯‘åçš„å­—èŠ‚ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">Classfile</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">zejian</span><span class="o">/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">Java8_Action</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">zejian</span><span class="o">/</span><span class="n">concurrencys</span><span class="o">/</span><span class="n">SyncMethod</span><span class="p">.</span><span class="na">class</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="w">  </span><span class="n">Last</span><span class="w"> </span><span class="n">modified</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="mi">308</span><span class="w"> </span><span class="n">bytes</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">  </span><span class="n">MD5</span><span class="w"> </span><span class="n">checksum</span><span class="w"> </span><span class="n">f34075a8c059ea65e4cc2fa610e0cd94</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w">  </span><span class="n">Compiled</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s">"SyncMethod.java"</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">com</span><span class="p">.</span><span class="na">zejian</span><span class="p">.</span><span class="na">concurrencys</span><span class="p">.</span><span class="na">SyncMethod</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="w">  </span><span class="n">minor</span><span class="w"> </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="w">  </span><span class="n">major</span><span class="w"> </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="mi">52</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="w">  </span><span class="n">flags</span><span class="p">:</span><span class="w"> </span><span class="n">ACC_PUBLIC</span><span class="p">,</span><span class="w"> </span><span class="n">ACC_SUPER</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="n">Constant</span><span class="w"> </span><span class="n">pool</span><span class="p">;</span>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a>
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="w">   </span><span class="c1">//çœç•¥æ²¡å¿…è¦çš„å­—èŠ‚ç </span>
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a><span class="w">  </span><span class="c1">//==================syncTaskæ–¹æ³•======================</span>
</span><span id="__span-60-13"><a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">syncTask</span><span class="p">();</span>
</span><span id="__span-60-14"><a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a><span class="w">    </span><span class="n">descriptor</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="n">V</span>
</span><span id="__span-60-15"><a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a><span class="w">    </span><span class="c1">//æ–¹æ³•æ ‡è¯†ACC_PUBLICä»£è¡¨publicä¿®é¥°ï¼ŒACC_SYNCHRONIZEDæŒ‡æ˜è¯¥æ–¹æ³•ä¸ºåŒæ­¥æ–¹æ³•</span>
</span><span id="__span-60-16"><a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a><span class="w">    </span><span class="n">flags</span><span class="p">:</span><span class="w"> </span><span class="n">ACC_PUBLIC</span><span class="p">,</span><span class="w"> </span><span class="n">ACC_SYNCHRONIZED</span>
</span><span id="__span-60-17"><a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a><span class="w">    </span><span class="n">Code</span><span class="p">:</span>
</span><span id="__span-60-18"><a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a><span class="w">      </span><span class="n">stack</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">locals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">args_size</span><span class="o">=</span><span class="mi">1</span>
</span><span id="__span-60-19"><a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a><span class="w">         </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="n">aload_0</span>
</span><span id="__span-60-20"><a id="__codelineno-60-20" name="__codelineno-60-20" href="#__codelineno-60-20"></a><span class="w">         </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">dup</span>
</span><span id="__span-60-21"><a id="__codelineno-60-21" name="__codelineno-60-21" href="#__codelineno-60-21"></a><span class="w">         </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="n">getfield</span><span class="w">      </span><span class="err">#</span><span class="mi">2</span><span class="w">                  </span><span class="c1">// Field i:I</span>
</span><span id="__span-60-22"><a id="__codelineno-60-22" name="__codelineno-60-22" href="#__codelineno-60-22"></a><span class="w">         </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">iconst_1</span>
</span><span id="__span-60-23"><a id="__codelineno-60-23" name="__codelineno-60-23" href="#__codelineno-60-23"></a><span class="w">         </span><span class="mi">6</span><span class="p">:</span><span class="w"> </span><span class="n">iadd</span>
</span><span id="__span-60-24"><a id="__codelineno-60-24" name="__codelineno-60-24" href="#__codelineno-60-24"></a><span class="w">         </span><span class="mi">7</span><span class="p">:</span><span class="w"> </span><span class="n">putfield</span><span class="w">      </span><span class="err">#</span><span class="mi">2</span><span class="w">                  </span><span class="c1">// Field i:I</span>
</span><span id="__span-60-25"><a id="__codelineno-60-25" name="__codelineno-60-25" href="#__codelineno-60-25"></a><span class="w">        </span><span class="mi">10</span><span class="p">:</span><span class="w"> </span><span class="k">return</span>
</span><span id="__span-60-26"><a id="__codelineno-60-26" name="__codelineno-60-26" href="#__codelineno-60-26"></a><span class="w">      </span><span class="n">LineNumberTable</span><span class="p">:</span>
</span><span id="__span-60-27"><a id="__codelineno-60-27" name="__codelineno-60-27" href="#__codelineno-60-27"></a><span class="w">        </span><span class="n">line</span><span class="w"> </span><span class="mi">12</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-60-28"><a id="__codelineno-60-28" name="__codelineno-60-28" href="#__codelineno-60-28"></a><span class="w">        </span><span class="n">line</span><span class="w"> </span><span class="mi">13</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-60-29"><a id="__codelineno-60-29" name="__codelineno-60-29" href="#__codelineno-60-29"></a><span class="p">}</span>
</span><span id="__span-60-30"><a id="__codelineno-60-30" name="__codelineno-60-30" href="#__codelineno-60-30"></a><span class="nl">SourceFile</span><span class="p">:</span><span class="w"> </span><span class="s">"SyncMethod.java"</span>
</span></code></pre></div> <p>ä»å­—èŠ‚ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œsynchronizedä¿®é¥°çš„æ–¹æ³•å¹¶æ²¡æœ‰monitorenteræŒ‡ä»¤å’ŒmonitorexitæŒ‡ä»¤ï¼Œå–å¾—ä»£ä¹‹çš„ç¡®å®æ˜¯ACC_SYNCHRONIZEDæ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼ŒJVMé€šè¿‡è¯¥ACC_SYNCHRONIZEDè®¿é—®æ ‡å¿—æ¥è¾¨åˆ«ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œç›¸åº”çš„åŒæ­¥è°ƒç”¨ã€‚è¿™ä¾¿æ˜¯synchronizedé”åœ¨åŒæ­¥ä»£ç å—å’ŒåŒæ­¥æ–¹æ³•ä¸Šå®ç°çš„åŸºæœ¬åŸç†ã€‚åŒæ—¶æˆ‘ä»¬è¿˜å¿…é¡»æ³¨æ„åˆ°çš„æ˜¯åœ¨Javaæ—©æœŸç‰ˆæœ¬ä¸­ï¼Œsynchronizedå±äºé‡é‡çº§é”ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lockæ¥å®ç°çš„ï¼Œè€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ—©æœŸçš„synchronizedæ•ˆç‡ä½çš„åŸå› ã€‚åº†å¹¸çš„æ˜¯åœ¨Java 6ä¹‹åJavaå®˜æ–¹å¯¹ä»JVMå±‚é¢å¯¹synchronizedè¾ƒå¤§ä¼˜åŒ–ï¼Œæ‰€ä»¥ç°åœ¨çš„synchronizedé”æ•ˆç‡ä¹Ÿä¼˜åŒ–å¾—å¾ˆä¸é”™äº†ï¼ŒJava 6ä¹‹åï¼Œä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”æ‰€å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†è½»é‡çº§é”å’Œåå‘é”ã€‚</p> <h4 id="1175é”å‡çº§">11.7.5ã€é”å‡çº§<a class="headerlink" href="#1175é”å‡çº§" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Java è™šæ‹Ÿæœºå¯¹ synchronized çš„ä¼˜åŒ–</p> <p>é”çš„çŠ¶æ€æ€»å…±æœ‰å››ç§ï¼Œæ— é”çŠ¶æ€ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚éšç€é”çš„ç«äº‰ï¼Œé”å¯ä»¥ä»åå‘é”å‡çº§åˆ°è½»é‡çº§é”ï¼Œå†å‡çº§çš„é‡é‡çº§é”ï¼Œä½†æ˜¯é”çš„å‡çº§æ˜¯å•å‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½ä»ä½åˆ°é«˜å‡çº§ï¼Œä¸ä¼šå‡ºç°é”çš„é™çº§ï¼Œå…³äºé‡é‡çº§é”ï¼Œå‰é¢å·²è¯¦ç»†åˆ†æè¿‡ï¼Œä¸‹é¢å°†ä»‹ç»åå‘é”å’Œè½»é‡çº§é”ä»¥åŠJVMçš„å…¶ä»–ä¼˜åŒ–æ‰‹æ®µï¼Œè¿™é‡Œå¹¶ä¸æ‰“ç®—æ·±å…¥åˆ°æ¯ä¸ªé”çš„å®ç°å’Œè½¬æ¢è¿‡ç¨‹æ›´å¤šåœ°æ˜¯é˜è¿°Javaè™šæ‹Ÿæœºæ‰€æä¾›çš„æ¯ä¸ªé”çš„æ ¸å¿ƒä¼˜åŒ–æ€æƒ³ï¼Œæ¯•ç«Ÿæ¶‰åŠåˆ°å…·ä½“è¿‡ç¨‹æ¯”è¾ƒç¹çï¼Œå¦‚éœ€äº†è§£è¯¦ç»†è¿‡ç¨‹å¯ä»¥æŸ¥é˜…ã€Šæ·±å…¥ç†è§£Javaè™šæ‹ŸæœºåŸç†ã€‹ã€‚</p> <hr> <p><strong>åå‘é”</strong></p> <p>åå‘é”æ˜¯Java 6ä¹‹ååŠ å…¥çš„æ–°é”ï¼Œå®ƒæ˜¯ä¸€ç§é’ˆå¯¹åŠ é”æ“ä½œçš„ä¼˜åŒ–æ‰‹æ®µï¼Œç»è¿‡ç ”ç©¶å‘ç°ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œå› æ­¤ä¸ºäº†å‡å°‘åŒä¸€çº¿ç¨‹è·å–é”(ä¼šæ¶‰åŠåˆ°ä¸€äº›CASæ“ä½œ,è€—æ—¶)çš„ä»£ä»·è€Œå¼•å…¥åå‘é”ã€‚åå‘é”çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è·å¾—äº†é”ï¼Œé‚£ä¹ˆé”å°±è¿›å…¥åå‘æ¨¡å¼ï¼Œæ­¤æ—¶Mark Word çš„ç»“æ„ä¹Ÿå˜ä¸ºåå‘é”ç»“æ„ï¼Œå½“è¿™ä¸ªçº¿ç¨‹å†æ¬¡è¯·æ±‚é”æ—¶ï¼Œæ— éœ€å†åšä»»ä½•åŒæ­¥æ“ä½œï¼Œå³è·å–é”çš„è¿‡ç¨‹ï¼Œè¿™æ ·å°±çœå»äº†å¤§é‡æœ‰å…³é”ç”³è¯·çš„æ“ä½œï¼Œä»è€Œä¹Ÿå°±æä¾›ç¨‹åºçš„æ€§èƒ½ã€‚æ‰€ä»¥ï¼Œå¯¹äºæ²¡æœ‰é”ç«äº‰çš„åœºåˆï¼Œåå‘é”æœ‰å¾ˆå¥½çš„ä¼˜åŒ–æ•ˆæœï¼Œæ¯•ç«Ÿææœ‰å¯èƒ½è¿ç»­å¤šæ¬¡æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ç”³è¯·ç›¸åŒçš„é”ã€‚ä½†æ˜¯å¯¹äºé”ç«äº‰æ¯”è¾ƒæ¿€çƒˆçš„åœºåˆï¼Œåå‘é”å°±å¤±æ•ˆäº†ï¼Œå› ä¸ºè¿™æ ·åœºåˆææœ‰å¯èƒ½æ¯æ¬¡ç”³è¯·é”çš„çº¿ç¨‹éƒ½æ˜¯ä¸ç›¸åŒçš„ï¼Œå› æ­¤è¿™ç§åœºåˆä¸‹ä¸åº”è¯¥ä½¿ç”¨åå‘é”ï¼Œå¦åˆ™ä¼šå¾—ä¸å¿å¤±ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåå‘é”å¤±è´¥åï¼Œå¹¶ä¸ä¼šç«‹å³è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œè€Œæ˜¯å…ˆå‡çº§ä¸ºè½»é‡çº§é”ã€‚ä¸‹é¢æ¥ç€äº†è§£è½»é‡çº§é”ã€‚</p> <hr> <p><strong>è½»é‡çº§é”</strong></p> <p>å€˜è‹¥åå‘é”å¤±è´¥ï¼Œè™šæ‹Ÿæœºå¹¶ä¸ä¼šç«‹å³å‡çº§ä¸ºé‡é‡çº§é”ï¼Œå®ƒè¿˜ä¼šå°è¯•ä½¿ç”¨ä¸€ç§ç§°ä¸ºè½»é‡çº§é”çš„ä¼˜åŒ–æ‰‹æ®µ(1.6ä¹‹ååŠ å…¥çš„)ï¼Œæ­¤æ—¶Mark Word çš„ç»“æ„ä¹Ÿå˜ä¸ºè½»é‡çº§é”çš„ç»“æ„ã€‚è½»é‡çº§é”èƒ½å¤Ÿæå‡ç¨‹åºæ€§èƒ½çš„ä¾æ®æ˜¯â€œå¯¹ç»å¤§éƒ¨åˆ†çš„é”ï¼Œåœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸå†…éƒ½ä¸å­˜åœ¨ç«äº‰â€ï¼Œæ³¨æ„è¿™æ˜¯ç»éªŒæ•°æ®ã€‚éœ€è¦äº†è§£çš„æ˜¯ï¼Œè½»é‡çº§é”æ‰€é€‚åº”çš„åœºæ™¯æ˜¯çº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—çš„åœºåˆï¼Œå¦‚æœå­˜åœ¨åŒä¸€æ—¶é—´è®¿é—®åŒä¸€é”çš„åœºåˆï¼Œå°±ä¼šå¯¼è‡´è½»é‡çº§é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</p> <hr> <p><strong>è‡ªæ—‹é”</strong></p> <p>è½»é‡çº§é”å¤±è´¥åï¼Œè™šæ‹Ÿæœºä¸ºäº†é¿å…çº¿ç¨‹çœŸå®åœ°åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æŒ‚èµ·ï¼Œè¿˜ä¼šè¿›è¡Œä¸€é¡¹ç§°ä¸ºè‡ªæ—‹é”çš„ä¼˜åŒ–æ‰‹æ®µã€‚è¿™æ˜¯åŸºäºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æŒæœ‰é”çš„æ—¶é—´éƒ½ä¸ä¼šå¤ªé•¿ï¼Œå¦‚æœç›´æ¥æŒ‚èµ·æ“ä½œç³»ç»Ÿå±‚é¢çš„çº¿ç¨‹å¯èƒ½ä¼šå¾—ä¸å¿å¤±ï¼Œæ¯•ç«Ÿæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ï¼Œå› æ­¤è‡ªæ—‹é”ä¼šå‡è®¾åœ¨ä¸ä¹…å°†æ¥ï¼Œå½“å‰çš„çº¿ç¨‹å¯ä»¥è·å¾—é”ï¼Œå› æ­¤è™šæ‹Ÿæœºä¼šè®©å½“å‰æƒ³è¦è·å–é”çš„çº¿ç¨‹åšå‡ ä¸ªç©ºå¾ªç¯(è¿™ä¹Ÿæ˜¯ç§°ä¸ºè‡ªæ—‹çš„åŸå› )ï¼Œä¸€èˆ¬ä¸ä¼šå¤ªä¹…ï¼Œå¯èƒ½æ˜¯50ä¸ªå¾ªç¯æˆ–100å¾ªç¯ï¼Œåœ¨ç»è¿‡è‹¥å¹²æ¬¡å¾ªç¯åï¼Œå¦‚æœå¾—åˆ°é”ï¼Œå°±é¡ºåˆ©è¿›å…¥ä¸´ç•ŒåŒºã€‚å¦‚æœè¿˜ä¸èƒ½è·å¾—é”ï¼Œé‚£å°±ä¼šå°†çº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æŒ‚èµ·ï¼Œè¿™å°±æ˜¯è‡ªæ—‹é”çš„ä¼˜åŒ–æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ç¡®å®ä¹Ÿæ˜¯å¯ä»¥æå‡æ•ˆç‡çš„ã€‚æœ€åæ²¡åŠæ³•ä¹Ÿå°±åªèƒ½å‡çº§ä¸ºé‡é‡çº§é”äº†ã€‚</p> <h3 id="108sleepwaitnotifynotifyall">10.8ã€sleepã€waitã€notifyã€notifyAll<a class="headerlink" href="#108sleepwaitnotifynotifyall" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>sleep å’Œ wait</strong></p> <p>sleep() å’Œ wait() éƒ½æ˜¯çº¿ç¨‹æš‚åœæ‰§è¡Œçš„æ–¹æ³•ã€‚</p> <ul> <li>è¿™ä¸¤ä¸ªæ–¹æ³•æ¥è‡ªä¸åŒçš„ç±»ï¼Œåˆ†åˆ«æ˜¯ Thread å’Œ Objectï¼Œsleep() å±äº Thread ç±»ä¸­çš„é™æ€æ–¹æ³•ï¼Œwait() å±äºObject æˆå‘˜æ–¹æ³•ã€‚</li> <li>sleep() æ˜¯çº¿ç¨‹ç±»ï¼ˆThreadï¼‰çš„æ–¹æ³•ï¼Œä¸æ¶‰åŠçº¿ç¨‹é€šä¿¡ï¼Œè°ƒç”¨æ—¶ä¼šåœ¨æŒ‡å®šçš„æ—¶é—´å†…æš‚åœè¯¥çº¿ç¨‹ï¼Œä½†ç›‘æ§ä¾ç„¶ä¿æŒï¼Œ<strong>ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”</strong>ï¼Œåˆ°æ—¶é—´è‡ªåŠ¨æ¢å¤ï¼›wait() æ˜¯ Object çš„æ–¹æ³•ï¼Œç”¨äºçº¿ç¨‹é—´çš„é€šä¿¡ï¼Œè°ƒç”¨æ—¶ä¼šæ”¾å¼ƒå¯¹è±¡é”ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œè°ƒç”¨ notify()ã€notifyAll() å”¤é†’æŒ‡å®šçš„çº¿ç¨‹æˆ–è€…æ‰€æœ‰çš„çº¿ç¨‹ï¼Œæ‰è¿›å…¥å¯¹è±¡é”æ± å‡†å¤‡è·å¾—å¯¹è±¡æ‰€è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚</li> <li><mark>wait()ã€notify() å’Œ notifyAll() åªèƒ½åœ¨åŒæ­¥æ§åˆ¶æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—é‡Œé¢ä½¿ç”¨ï¼Œè€Œ sleep() å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼ˆä½¿ç”¨èŒƒå›´ï¼‰ã€‚</mark></li> <li>sleep() æ–¹æ³•å¿…é¡»æ•è·å¼‚å¸¸ InterruptedExceptionï¼Œè€Œ wait() notify() ä»¥åŠ notifyAll() ä¸éœ€è¦æ•è·å¼‚å¸¸ã€‚</li> </ul> <p>æ³¨æ„ï¼š</p> <ul> <li>sleep() æ–¹æ³•åªè®©å‡ºäº†CPUï¼Œå¹¶ä¸ä¼šé‡Šæ”¾åŒæ­¥èµ„æºé”ã€‚</li> <li>sleep() æ–¹æ³•æŒ‡å®šçš„æ—¶é—´ä¸ºçº¿ç¨‹ä¸ä¼šè¿è¡Œçš„æœ€çŸ­æ—¶é—´ã€‚å› æ­¤ï¼Œsleep() æ–¹æ³•ä¸èƒ½ä¿è¯è¯¥çº¿ç¨‹ç¡çœ åˆ°æœŸåå°±å¼€å§‹æ‰§è¡Œã€‚</li> <li>notify() çš„ä½œç”¨ç›¸å½“äºå«é†’ç¡ç€çš„äººï¼Œè€Œå¹¶ä¸ä¼šç»™ä»–åˆ†é…ä»»åŠ¡ï¼Œå°±æ˜¯è¯´ notify() åªæ˜¯è®©ä¹‹å‰è°ƒç”¨ wait() çš„çº¿ç¨‹æœ‰æƒåˆ©é‡æ–°å‚ä¸çº¿ç¨‹çš„è°ƒåº¦ã€‚</li> </ul> <p>wait() ä¼šé‡Šæ”¾é”ï¼Œnoitfy() å’Œ notify() å°†è¦é‡Šæ”¾é”ï¼Œä»–ä»¬éƒ½éœ€è¦çº¿ç¨‹æŒæœ‰å¯¹è±¡çš„é”ï¼Œè¿™æ ·å°±åªèƒ½é€šè¿‡åŒæ­¥æ¥å®ç°ï¼Œæ‰€ä»¥ä»–ä»¬åªèƒ½åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥å—ä¸­è¢«è°ƒç”¨ã€‚</p> <hr> <p>**waitã€notify / notifyAll **</p> <p>ç”±äº wait()ã€notify/notifyAll() æ–¹æ³•æ˜¯ Object çš„æœ¬åœ° final æ–¹æ³•ï¼Œæ— æ³•è¢«é‡å†™ã€‚</p> <p>==å½“çº¿ç¨‹æ‰§è¡Œwait()æ–¹æ³•æ—¶å€™ï¼Œä¼šé‡Šæ”¾å½“å‰çš„é”ï¼Œç„¶åè®©å‡ºCPUï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚åªæœ‰å½“ notify/notifyAll() è¢«æ‰§è¡Œæ—¶å€™ï¼Œæ‰ä¼šå”¤é†’ä¸€ä¸ªæˆ–å¤šä¸ªæ­£å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œç„¶åç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°æ‰§è¡Œå®Œsynchronized ä»£ç å—çš„ä»£ç æˆ–æ˜¯ä¸­é€”é‡åˆ°wait() ï¼Œå†æ¬¡é‡Šæ”¾é”ã€‚==ä¹Ÿå°±æ˜¯è¯´ï¼Œnotify / notifyAll() çš„æ‰§è¡Œåªæ˜¯å”¤é†’æ²‰ç¡çš„çº¿ç¨‹ï¼Œè€Œä¸ä¼šç«‹å³é‡Šæ”¾é”ï¼Œé”çš„é‡Šæ”¾è¦çœ‹ä»£ç å—çš„å…·ä½“æ‰§è¡Œæƒ…å†µã€‚æ‰€ä»¥åœ¨ç¼–ç¨‹ä¸­ï¼Œå°½é‡åœ¨ä½¿ç”¨äº† notify / notifyAll() åç«‹å³é€€å‡ºä¸´ç•ŒåŒºï¼Œä»¥å”¤é†’å…¶ä»–çº¿ç¨‹è®©å…¶è·å¾—é”ã€‚</p> <p>notify å’Œ wait çš„é¡ºåºä¸èƒ½é”™ï¼Œå¦‚æœ A çº¿ç¨‹å…ˆæ‰§è¡Œ notify æ–¹æ³•ï¼ŒB çº¿ç¨‹å†æ‰§è¡Œ wait æ–¹æ³•ï¼Œé‚£ä¹ˆ B çº¿ç¨‹æ˜¯æ— æ³•è¢«å”¤é†’çš„ã€‚</p> <p>notify å’Œ notifyAll çš„åŒºåˆ«ï¼šnotify æ–¹æ³•åªå”¤é†’ä¸€ä¸ªç­‰å¾…ï¼ˆå¯¹è±¡çš„ï¼‰çº¿ç¨‹å¹¶ä½¿è¯¥çº¿ç¨‹å¼€å§‹æ‰§è¡Œã€‚æ‰€ä»¥å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ç­‰å¾…ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•åªä¼šå”¤é†’å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ï¼Œé€‰æ‹©å“ªä¸ªçº¿ç¨‹å–å†³äºæ“ä½œç³»ç»Ÿå¯¹å¤šçº¿ç¨‹ç®¡ç†çš„å®ç°ã€‚notifyAll ä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…(å¯¹è±¡çš„)çº¿ç¨‹ï¼Œå°½ç®¡å“ªä¸€ä¸ªçº¿ç¨‹å°†ä¼šç¬¬ä¸€ä¸ªå¤„ç†å–å†³äºæ“ä½œç³»ç»Ÿçš„å®ç°ã€‚å¦‚æœå½“å‰æƒ…å†µä¸‹æœ‰å¤šä¸ªçº¿ç¨‹éœ€è¦è¢«å”¤é†’ï¼Œæ¨èä½¿ç”¨ notifyAll æ–¹æ³•ã€‚æ¯”å¦‚åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…é‡Œé¢çš„ä½¿ç”¨ï¼Œæ¯æ¬¡éƒ½éœ€è¦å”¤é†’æ‰€æœ‰çš„æ¶ˆè´¹è€…æˆ–æ˜¯ç”Ÿäº§è€…ï¼Œä»¥åˆ¤æ–­ç¨‹åºæ˜¯å¦å¯ä»¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p> <hr> <p><strong>ç”Ÿäº§è€…æ¶ˆè´¹è€…</strong></p> <p>è¿™ä¸ªé—®é¢˜æ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹åŒæ­¥é—®é¢˜çš„ç»å…¸æ¡ˆä¾‹ï¼Œç”Ÿäº§è€…è´Ÿè´£ç”Ÿäº§å¯¹è±¡ï¼Œæ¶ˆè´¹è€…è´Ÿè´£å°†ç”Ÿæˆè€…äº§ç”Ÿçš„å¯¹è±¡å–å‡ºï¼Œä¸¤è€…ä¸æ–­é‡å¤æ­¤è¿‡ç¨‹ã€‚è¿™è¿‡ç¨‹éœ€è¦æ³¨æ„å‡ ä¸ªé—®é¢˜ï¼š</p> <p>ä¸è®ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æœ‰å‡ ä¸ªï¼Œå¿…é¡»ä¿è¯ï¼š</p> <ol> <li> <p>ç”Ÿäº§è€…æ¯æ¬¡äº§å‡ºçš„å¯¹è±¡å¿…é¡»ä¸ä¸€æ ·ï¼Œäº§ç”Ÿçš„å¯¹è±¡æœ‰ä¸”ä»…æœ‰å‡ºç°ä¸€æ¬¡ï¼›</p> </li> <li> <p>æ¶ˆè´¹è€…æ¯æ¬¡å–å‡ºçš„å¯¹è±¡å¿…é¡»ä¸ä¸€æ ·ï¼Œå–å‡ºçš„å¯¹è±¡æœ‰ä¸”ä»…æœ‰å‡ºç°ä¸€æ¬¡ï¼›</p> </li> <li> <p>ä¸€å®šæ˜¯å…ˆäº§ç”Ÿè¯¥å¯¹è±¡ï¼Œç„¶åå¯¹è±¡æ‰èƒ½è¢«å–å‡ºï¼Œé¡ºåºä¸èƒ½ä¹±ï¼›</p> </li> </ol> <p>å®šä¹‰ä¸€ä¸ªæ±½è½¦ç±»ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Car</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="w">    </span><span class="c1">// å®šä¹‰ä¸€ä¸ªå±æ€§å­˜å‚¨å½“å‰æ±½è½¦çš„æ•°é‡</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="w">    </span><span class="c1">// å®šä¹‰ç”Ÿäº§æ±½è½¦çš„æ–¹æ³•</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createCar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="w">        </span><span class="c1">// åˆ¤æ–­å½“å‰æ±½è½¦çš„æ•°é‡æ˜¯å¦å¤§äº0</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="w">            </span><span class="c1">// å°†å½“å‰çš„çº¿ç¨‹è¿›è¡Œç­‰å¾…</span>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">wait</span><span class="p">();</span>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a><span class="w">        </span><span class="c1">// æ±½è½¦æ•°é‡ä¸º0çš„æ—¶å€™å°±å¼€å§‹æ‰§è¡Œç”Ÿäº§æ“ä½œ</span>
</span><span id="__span-61-17"><a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ±½è½¦å¼€å§‹è¿›è¡Œç”Ÿäº§"</span><span class="p">);</span>
</span><span id="__span-61-18"><a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a><span class="w">        </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-61-19"><a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a><span class="w">        </span><span class="c1">// å”¤é†’æ¶ˆè´¹è€…çº¿ç¨‹å¼€å§‹è¿›è¡Œé”€å”®</span>
</span><span id="__span-61-20"><a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">notify</span><span class="p">();</span>
</span><span id="__span-61-21"><a id="__codelineno-61-21" name="__codelineno-61-21" href="#__codelineno-61-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-61-22"><a id="__codelineno-61-22" name="__codelineno-61-22" href="#__codelineno-61-22"></a>
</span><span id="__span-61-23"><a id="__codelineno-61-23" name="__codelineno-61-23" href="#__codelineno-61-23"></a><span class="w">    </span><span class="c1">// å®šä¹‰æ¶ˆè´¹è€…çš„æ–¹æ³•</span>
</span><span id="__span-61-24"><a id="__codelineno-61-24" name="__codelineno-61-24" href="#__codelineno-61-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sell</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-25"><a id="__codelineno-61-25" name="__codelineno-61-25" href="#__codelineno-61-25"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-26"><a id="__codelineno-61-26" name="__codelineno-61-26" href="#__codelineno-61-26"></a><span class="w">            </span><span class="c1">// æ‰§è¡Œç­‰å¾…æ“ä½œ</span>
</span><span id="__span-61-27"><a id="__codelineno-61-27" name="__codelineno-61-27" href="#__codelineno-61-27"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-28"><a id="__codelineno-61-28" name="__codelineno-61-28" href="#__codelineno-61-28"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">wait</span><span class="p">();</span>
</span><span id="__span-61-29"><a id="__codelineno-61-29" name="__codelineno-61-29" href="#__codelineno-61-29"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-30"><a id="__codelineno-61-30" name="__codelineno-61-30" href="#__codelineno-61-30"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-61-31"><a id="__codelineno-61-31" name="__codelineno-61-31" href="#__codelineno-61-31"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-61-32"><a id="__codelineno-61-32" name="__codelineno-61-32" href="#__codelineno-61-32"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-61-33"><a id="__codelineno-61-33" name="__codelineno-61-33" href="#__codelineno-61-33"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ­£åœ¨è¿›è¡Œæ±½è½¦é”€å”®"</span><span class="p">);</span>
</span><span id="__span-61-34"><a id="__codelineno-61-34" name="__codelineno-61-34" href="#__codelineno-61-34"></a><span class="w">        </span><span class="n">count</span><span class="o">--</span><span class="p">;</span>
</span><span id="__span-61-35"><a id="__codelineno-61-35" name="__codelineno-61-35" href="#__codelineno-61-35"></a><span class="w">        </span><span class="c1">// å”¤é†’ç”Ÿäº§è€…çº¿ç¨‹</span>
</span><span id="__span-61-36"><a id="__codelineno-61-36" name="__codelineno-61-36" href="#__codelineno-61-36"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">notify</span><span class="p">();</span>
</span><span id="__span-61-37"><a id="__codelineno-61-37" name="__codelineno-61-37" href="#__codelineno-61-37"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-61-38"><a id="__codelineno-61-38" name="__codelineno-61-38" href="#__codelineno-61-38"></a><span class="p">}</span>
</span></code></pre></div> <p>å®šä¹‰ç”Ÿäº§è€…ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Producter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="w">    </span><span class="c1">// å®šä¹‰ä¸€ä¸ªæ±½è½¦å±æ€§æ¥æ”¶ä¼ å…¥çš„æ±½è½¦å¯¹è±¡</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="w">    </span><span class="n">Car</span><span class="w"> </span><span class="n">car</span><span class="p">;</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Producter</span><span class="p">(</span><span class="n">Car</span><span class="w"> </span><span class="n">car</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">car</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">car</span><span class="p">;</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a><span class="w">            </span><span class="n">car</span><span class="p">.</span><span class="na">createCar</span><span class="p">();</span>
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a><span class="w">                </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
</span><span id="__span-62-15"><a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-16"><a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-62-17"><a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-62-18"><a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-62-19"><a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-62-20"><a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a><span class="p">}</span>
</span></code></pre></div> <p>å®šä¹‰æ¶ˆè´¹è€…ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Customer</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="w">    </span><span class="n">Car</span><span class="w"> </span><span class="n">car</span><span class="p">;</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Customer</span><span class="p">(</span><span class="n">Car</span><span class="w"> </span><span class="n">car</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">car</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">car</span><span class="p">;</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="w">            </span><span class="n">car</span><span class="p">.</span><span class="na">sell</span><span class="p">();</span>
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a><span class="w">                </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
</span><span id="__span-63-14"><a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-15"><a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-63-16"><a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-63-17"><a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-63-18"><a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-63-19"><a id="__codelineno-63-19" name="__codelineno-63-19" href="#__codelineno-63-19"></a><span class="p">}</span>
</span></code></pre></div> <p>æµ‹è¯•ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="w">        </span><span class="c1">// åˆ›å»ºæ±½è½¦æ ¸å¿ƒç±»å¯¹è±¡</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="w">        </span><span class="n">Car</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Car</span><span class="p">();</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w">        </span><span class="c1">// åˆ›å»ºæ¶ˆè´¹è€…åŠŸèƒ½</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="w">        </span><span class="n">Customer</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span><span class="n">car</span><span class="p">);</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="w">        </span><span class="c1">// åˆ›å»ºç”Ÿäº§è€…åŠŸèƒ½</span>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="w">        </span><span class="n">Producter</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Producter</span><span class="p">(</span><span class="n">car</span><span class="p">);</span>
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a><span class="w">        </span><span class="c1">// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹å®ŒæˆåŠŸèƒ½æ“ä½œ</span>
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">tc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span><span id="__span-64-15"><a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a>
</span><span id="__span-64-16"><a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a><span class="w">        </span><span class="n">tc</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-64-17"><a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a><span class="w">        </span><span class="n">tp</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-64-18"><a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-64-19"><a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a><span class="p">}</span>
</span></code></pre></div> <h3 id="109bionioaio">10.9ã€BIOã€NIOã€AIO<a class="headerlink" href="#109bionioaio" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>åŒæ­¥ä¸å¼‚æ­¥</strong></p> <ul> <li><strong>åŒæ­¥ï¼š</strong> åŒæ­¥å°±æ˜¯å‘èµ·ä¸€ä¸ªè°ƒç”¨åï¼Œè¢«è°ƒç”¨è€…æœªå¤„ç†å®Œè¯·æ±‚ä¹‹å‰ï¼Œè°ƒç”¨ä¸è¿”å›ã€‚</li> <li><strong>å¼‚æ­¥ï¼š</strong> å¼‚æ­¥å°±æ˜¯å‘èµ·ä¸€ä¸ªè°ƒç”¨åï¼Œç«‹åˆ»å¾—åˆ°è¢«è°ƒç”¨è€…çš„å›åº”è¡¨ç¤ºå·²æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯è¢«è°ƒç”¨è€…å¹¶æ²¡æœ‰è¿”å›ç»“æœï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å¤„ç†å…¶ä»–çš„è¯·æ±‚ï¼Œè¢«è°ƒç”¨è€…é€šå¸¸ä¾é äº‹ä»¶ï¼Œå›è°ƒç­‰æœºåˆ¶æ¥é€šçŸ¥è°ƒç”¨è€…å…¶è¿”å›ç»“æœã€‚</li> </ul> <p>åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«æœ€å¤§åœ¨äºå¼‚æ­¥çš„è¯è°ƒç”¨è€…ä¸éœ€è¦ç­‰å¾…å¤„ç†ç»“æœï¼Œè¢«è°ƒç”¨è€…ä¼šé€šè¿‡å›è°ƒç­‰æœºåˆ¶æ¥é€šçŸ¥è°ƒç”¨è€…å…¶è¿”å›ç»“æœã€‚</p> <hr> <p><strong>é˜»å¡å’Œéé˜»å¡</strong></p> <ul> <li><strong>é˜»å¡ï¼š</strong> é˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨è€…ä¸€ç›´ç­‰å¾…è¯·æ±‚ç»“æœè¿”å›ï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œæ— æ³•ä»äº‹å…¶ä»–ä»»åŠ¡ï¼Œåªæœ‰å½“æ¡ä»¶å°±ç»ªæ‰èƒ½ç»§ç»­ã€‚</li> <li><strong>éé˜»å¡ï¼š</strong> éé˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨è€…ä¸ç”¨ä¸€ç›´ç­‰ç€ç»“æœè¿”å›ï¼Œå¯ä»¥å…ˆå»å¹²å…¶ä»–äº‹æƒ…ã€‚</li> </ul> <p>ä¸¾ä¸ªç”Ÿæ´»ä¸­ç®€å•çš„ä¾‹å­ï¼Œä½ å¦ˆå¦ˆè®©ä½ çƒ§æ°´ï¼Œå°æ—¶å€™ä½ æ¯”è¾ƒç¬¨å•Šï¼Œåœ¨å“ªé‡Œå‚»ç­‰ç€æ°´å¼€ï¼ˆ<strong>åŒæ­¥é˜»å¡</strong>ï¼‰ã€‚ç­‰ä½ ç¨å¾®å†é•¿å¤§ä¸€ç‚¹ï¼Œä½ çŸ¥é“æ¯æ¬¡çƒ§æ°´çš„ç©ºéš™å¯ä»¥å»å¹²ç‚¹å…¶ä»–äº‹ï¼Œç„¶ååªéœ€è¦æ—¶ä¸æ—¶æ¥çœ‹çœ‹æ°´å¼€äº†æ²¡æœ‰ï¼ˆ<strong>åŒæ­¥éé˜»å¡</strong>ï¼‰ã€‚åæ¥ï¼Œä½ ä»¬å®¶ç”¨ä¸Šäº†æ°´å¼€äº†ä¼šå‘å‡ºå£°éŸ³çš„å£¶ï¼Œè¿™æ ·ä½ å°±åªéœ€è¦å¬åˆ°å“å£°åå°±çŸ¥é“æ°´å¼€äº†ï¼Œåœ¨è¿™æœŸé—´ä½ å¯ä»¥éšä¾¿å¹²è‡ªå·±çš„äº‹æƒ…ï¼Œä½ éœ€è¦å»å€’æ°´äº†ï¼ˆ<strong>å¼‚æ­¥éé˜»å¡</strong>ï¼‰ã€‚</p> <h4 id="1091bio-blocking-io">10.9.1ã€BIO (Blocking I/O)<a class="headerlink" href="#1091bio-blocking-io" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>åŒæ­¥é˜»å¡ I/O æ¨¡å¼ï¼Œæ•°æ®çš„è¯»å–å†™å…¥å¿…é¡»é˜»å¡åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ç­‰å¾…å…¶å®Œæˆã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/2163864-20201022174532077-2087464332-16282184549795.png" data-desc-position="bottom"><img src="!assets/Java/2163864-20201022174532077-2087464332-16282184549795.png" alt="img" style></a></p> <p>é‡‡ç”¨ <strong>BIO é€šä¿¡æ¨¡å‹</strong> çš„æœåŠ¡ç«¯ï¼Œé€šå¸¸ç”±ä¸€ä¸ªç‹¬ç«‹çš„ Acceptor çº¿ç¨‹è´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥ã€‚æˆ‘ä»¬ä¸€èˆ¬é€šè¿‡åœ¨ <code>while(true)</code> å¾ªç¯ä¸­æœåŠ¡ç«¯ä¼šè°ƒç”¨ <code>accept()</code> æ–¹æ³•ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥çš„æ–¹å¼ç›‘å¬è¯·æ±‚ï¼Œè¯·æ±‚ä¸€æ—¦æ¥æ”¶åˆ°ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œå°±å¯ä»¥å»ºç«‹é€šä¿¡å¥—æ¥å­—åœ¨è¿™ä¸ªé€šä¿¡å¥—æ¥å­—ä¸Šè¿›è¡Œè¯»å†™æ“ä½œï¼Œæ­¤æ—¶ä¸èƒ½å†æ¥æ”¶å…¶ä»–å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œåªèƒ½ç­‰å¾…åŒå½“å‰è¿æ¥çš„å®¢æˆ·ç«¯çš„æ“ä½œæ‰§è¡Œå®Œæˆï¼Œ ä¸è¿‡å¯ä»¥é€šè¿‡å¤šçº¿ç¨‹æ¥æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p> <p>å¦‚æœè¦è®© <strong>BIO é€šä¿¡æ¨¡å‹</strong> èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼Œå°±å¿…é¡»ä½¿ç”¨å¤šçº¿ç¨‹ï¼ˆä¸»è¦åŸå› æ˜¯ <code>socket.accept()</code>ã€ <code>socket.read()</code>ã€ <code>socket.write()</code> æ¶‰åŠçš„ä¸‰ä¸ªä¸»è¦å‡½æ•°éƒ½æ˜¯åŒæ­¥é˜»å¡çš„ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ä¹‹åä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹è¿›è¡Œé“¾è·¯å¤„ç†ï¼Œå¤„ç†å®Œæˆä¹‹åï¼Œé€šè¿‡è¾“å‡ºæµè¿”å›åº”ç­”ç»™å®¢æˆ·ç«¯ï¼Œçº¿ç¨‹é”€æ¯ã€‚è¿™å°±æ˜¯å…¸å‹çš„ <strong>ä¸€è¯·æ±‚ä¸€åº”ç­”é€šä¿¡æ¨¡å‹</strong> ã€‚</p> <p>åœ¨ Java è™šæ‹Ÿæœºä¸­ï¼Œçº¿ç¨‹æ˜¯å®è´µçš„èµ„æºï¼Œçº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯æˆæœ¬å¾ˆé«˜ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œçº¿ç¨‹çš„åˆ‡æ¢æˆæœ¬ä¹Ÿæ˜¯å¾ˆé«˜çš„ã€‚å°¤å…¶åœ¨ Linux è¿™æ ·çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œåˆ›å»ºå’Œé”€æ¯çº¿ç¨‹éƒ½æ˜¯é‡é‡çº§çš„ç³»ç»Ÿå‡½æ•°ã€‚å¦‚æœå¹¶å‘è®¿é—®é‡å¢åŠ ä¼šå¯¼è‡´çº¿ç¨‹æ•°æ€¥å‰§è†¨èƒ€å¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹å †æ ˆæº¢å‡ºã€åˆ›å»ºæ–°çº¿ç¨‹å¤±è´¥ç­‰é—®é¢˜ï¼Œæœ€ç»ˆå¯¼è‡´è¿›ç¨‹å®•æœºæˆ–è€…åƒµæ­»ï¼Œä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚åŒæ—¶å¦‚æœè¿™ä¸ªè¿æ¥ä¸åšä»»ä½•äº‹æƒ…çš„è¯ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡ <strong>çº¿ç¨‹æ± æœºåˆ¶</strong> æ”¹å–„ï¼Œçº¿ç¨‹æ± è¿˜å¯ä»¥è®©çº¿ç¨‹çš„åˆ›å»ºå’Œå›æ”¶æˆæœ¬ç›¸å¯¹è¾ƒä½ã€‚ä½¿ç”¨<code>FixedThreadPool</code> å¯ä»¥æœ‰æ•ˆçš„æ§åˆ¶äº†çº¿ç¨‹çš„æœ€å¤§æ•°é‡ï¼Œä¿è¯äº†ç³»ç»Ÿæœ‰é™çš„èµ„æºçš„æ§åˆ¶ï¼Œå®ç°äº†N(å®¢æˆ·ç«¯è¯·æ±‚æ•°é‡):M(å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„çº¿ç¨‹æ•°é‡)çš„ä¼ªå¼‚æ­¥I/Oæ¨¡å‹ï¼ˆN å¯ä»¥è¿œè¿œå¤§äº Mï¼‰ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/2163864-20201022175636286-539148404.png" data-desc-position="bottom"><img src="!assets/Java/2163864-20201022175636286-539148404.png" alt="img" style></a></p> <p>é‡‡ç”¨çº¿ç¨‹æ± å’Œä»»åŠ¡é˜Ÿåˆ—å¯ä»¥å®ç°ä¸€ç§å«åšä¼ªå¼‚æ­¥çš„ I/O é€šä¿¡æ¡†æ¶ï¼Œå®ƒçš„æ¨¡å‹å›¾å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚å½“æœ‰æ–°çš„å®¢æˆ·ç«¯æ¥å…¥æ—¶ï¼Œå°†å®¢æˆ·ç«¯çš„ Socket å°è£…æˆä¸€ä¸ªTaskï¼ˆè¯¥ä»»åŠ¡å®ç°java.lang.Runnableæ¥å£ï¼‰æŠ•é€’åˆ°åç«¯çš„çº¿ç¨‹æ± ä¸­è¿›è¡Œå¤„ç†ï¼ŒJDK çš„çº¿ç¨‹æ± ç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å’Œ N ä¸ªæ´»è·ƒçº¿ç¨‹ï¼Œå¯¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¿›è¡Œå¤„ç†ã€‚ç”±äºçº¿ç¨‹æ± å¯ä»¥è®¾ç½®æ¶ˆæ¯é˜Ÿåˆ—çš„å¤§å°å’Œæœ€å¤§çº¿ç¨‹æ•°ï¼Œå› æ­¤ï¼Œå®ƒçš„èµ„æºå ç”¨æ˜¯å¯æ§çš„ï¼Œæ— è®ºå¤šå°‘ä¸ªå®¢æˆ·ç«¯å¹¶å‘è®¿é—®ï¼Œéƒ½ä¸ä¼šå¯¼è‡´èµ„æºçš„è€—å°½å’Œå®•æœºã€‚</p> <p>ä¼ªå¼‚æ­¥I/Oé€šä¿¡æ¡†æ¶é‡‡ç”¨äº†çº¿ç¨‹æ± å®ç°ï¼Œå› æ­¤é¿å…äº†ä¸ºæ¯ä¸ªè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹é€ æˆçš„çº¿ç¨‹èµ„æºè€—å°½é—®é¢˜ã€‚ä¸è¿‡å› ä¸ºå®ƒçš„åº•å±‚ä»»ç„¶æ˜¯åŒæ­¥é˜»å¡çš„BIOæ¨¡å‹ï¼Œå› æ­¤æ— æ³•ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ã€‚</p> <h4 id="1092nio-new-io">10.9.2ã€NIO (New I/O)<a class="headerlink" href="#1092nio-new-io" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>NIO æ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„ I/O æ¨¡å‹ï¼Œåœ¨Java 1.4 ä¸­å¼•å…¥äº† NIO æ¡†æ¶ï¼Œå¯¹åº” java.nio åŒ…ï¼Œæä¾›äº† Channel , Selectorï¼ŒBufferç­‰æŠ½è±¡ã€‚</p> <p>NIOä¸­çš„ N å¯ä»¥ç†è§£ä¸º Non-blockingï¼Œä¸å•çº¯æ˜¯ Newã€‚å®ƒæ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„ I/O æ“ä½œæ–¹æ³•ã€‚ NIO æä¾›äº†ä¸ä¼ ç»Ÿ BIO æ¨¡å‹ä¸­çš„ <code>Socket</code> å’Œ <code>ServerSocket</code> ç›¸å¯¹åº”çš„ <code>SocketChannel</code> å’Œ <code>ServerSocketChannel</code> ä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°,ä¸¤ç§é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ã€‚é˜»å¡æ¨¡å¼ä½¿ç”¨å°±åƒä¼ ç»Ÿä¸­çš„æ”¯æŒä¸€æ ·ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯é æ€§éƒ½ä¸å¥½ï¼›éé˜»å¡æ¨¡å¼æ­£å¥½ä¸ä¹‹ç›¸åã€‚å¯¹äºä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥é˜»å¡ I/O æ¥æå‡å¼€å‘é€Ÿç‡å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ï¼›å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO çš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘ã€‚</p> <hr> <p><strong>NIO çš„ç‰¹æ€§ / NIO ä¸ IO åŒºåˆ«</strong></p> <ul> <li> <p>Non-blocking IOï¼ˆéé˜»å¡IOï¼‰</p> <blockquote> <p>IO æµæ˜¯é˜»å¡çš„ï¼ŒNIO æµæ˜¯ä¸é˜»å¡çš„ã€‚</p> <p>Java NIO ä½¿æˆ‘ä»¬å¯ä»¥è¿›è¡Œéé˜»å¡ IO æ“ä½œã€‚æ¯”å¦‚è¯´ï¼Œå•çº¿ç¨‹ä¸­ä»é€šé“è¯»å–æ•°æ®åˆ° bufferï¼ŒåŒæ—¶å¯ä»¥ç»§ç»­åšåˆ«çš„äº‹æƒ…ï¼Œå½“æ•°æ®è¯»å–åˆ° buffer ä¸­åï¼Œçº¿ç¨‹å†ç»§ç»­å¤„ç†æ•°æ®ã€‚å†™æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å¦å¤–ï¼Œéé˜»å¡å†™ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚</p> <p>Java IO çš„å„ç§æµæ˜¯é˜»å¡çš„ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>read()</code> æˆ– <code>write()</code> æ—¶ï¼Œè¯¥çº¿ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æœ‰ä¸€äº›æ•°æ®è¢«è¯»å–ï¼Œæˆ–æ•°æ®å®Œå…¨å†™å…¥ã€‚è¯¥çº¿ç¨‹åœ¨æ­¤æœŸé—´ä¸èƒ½å†å¹²ä»»ä½•äº‹æƒ…äº†ã€‚</p> </blockquote> </li> <li> <p>Bufferï¼ˆç¼“å†²åŒºï¼‰</p> <blockquote> <p>IO é¢å‘æµ(Stream oriented)ï¼Œè€Œ NIO é¢å‘ç¼“å†²åŒº(Buffer oriented)ã€‚</p> <p>Buffer æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€äº›è¦å†™å…¥æˆ–è€…è¦è¯»å‡ºçš„æ•°æ®ã€‚åœ¨ NIO ç±»åº“ä¸­åŠ å…¥ Buffer å¯¹è±¡ï¼Œä½“ç°äº†æ–°åº“ä¸åŸ I/O çš„ä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚åœ¨é¢å‘æµçš„ I/O ä¸­ï¼Œå¯ä»¥å°†æ•°æ®ç›´æ¥å†™å…¥æˆ–è€…å°†æ•°æ®ç›´æ¥è¯»åˆ° Stream å¯¹è±¡ä¸­ã€‚è™½ç„¶ Stream ä¸­ä¹Ÿæœ‰ Buffer å¼€å¤´çš„æ‰©å±•ç±»ï¼Œä½†åªæ˜¯æµçš„åŒ…è£…ç±»ï¼Œè¿˜æ˜¯ä»æµè¯»åˆ°ç¼“å†²åŒºï¼Œè€Œ NIO å´æ˜¯ç›´æ¥è¯»åˆ° Buffer ä¸­è¿›è¡Œæ“ä½œã€‚</p> <p>åœ¨ NIO åä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†çš„ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå®ƒæ˜¯ç›´æ¥è¯»åˆ°ç¼“å†²åŒºä¸­çš„ï¼›åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå†™å…¥åˆ°ç¼“å†²åŒºä¸­ã€‚ä»»ä½•æ—¶å€™è®¿é—®NIO ä¸­çš„æ•°æ®ï¼Œéƒ½æ˜¯é€šè¿‡ç¼“å†²åŒºè¿›è¡Œæ“ä½œã€‚</p> <p>æœ€å¸¸ç”¨çš„ç¼“å†²åŒºæ˜¯ ByteBufferï¼Œä¸€ä¸ª ByteBuffer æä¾›äº†ä¸€ç»„åŠŸèƒ½ç”¨äºæ“ä½œ byte æ•°ç»„ã€‚é™¤äº† ByteBufferï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›ç¼“å†²åŒºï¼Œäº‹å®ä¸Šï¼Œæ¯ä¸€ç§ Java åŸºæœ¬ç±»å‹ï¼ˆé™¤äº†Booleanç±»å‹ï¼‰éƒ½å¯¹åº”æœ‰ä¸€ç§ç¼“å†²åŒºã€‚</p> </blockquote> </li> <li> <p>Channelï¼ˆé€šé“ï¼‰</p> <blockquote> <p>NIO é€šè¿‡Channelï¼ˆé€šé“ï¼‰ è¿›è¡Œè¯»å†™ã€‚</p> <p>é€šé“æ˜¯åŒå‘çš„ï¼Œå¯è¯»ä¹Ÿå¯å†™ï¼Œè€Œæµçš„è¯»å†™æ˜¯å•å‘çš„ã€‚æ— è®ºè¯»å†™ï¼Œé€šé“åªèƒ½å’Œ Buffer äº¤äº’ã€‚å› ä¸º Bufferï¼Œé€šé“å¯ä»¥å¼‚æ­¥åœ°è¯»å†™ã€‚</p> </blockquote> </li> <li> <p>Selectors(é€‰æ‹©å™¨)</p> <blockquote> <p>NIO æœ‰é€‰æ‹©å™¨ï¼Œè€Œ IO æ²¡æœ‰ã€‚</p> <p>é€‰æ‹©å™¨ç”¨äºä½¿ç”¨å•ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªé€šé“ã€‚å› æ­¤ï¼Œå®ƒéœ€è¦è¾ƒå°‘çš„çº¿ç¨‹æ¥å¤„ç†è¿™äº›é€šé“ã€‚çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢å¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´æ˜¯æ˜‚è´µçš„ã€‚ å› æ­¤ï¼Œä¸ºäº†æé«˜ç³»ç»Ÿæ•ˆç‡é€‰æ‹©å™¨æ˜¯æœ‰ç”¨çš„ã€‚</p> </blockquote> </li> </ul> <h4 id="1093aio-asynchronous-io">10.9.3ã€AIO (Asynchronous I/O)<a class="headerlink" href="#1093aio-asynchronous-io" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>AIO ä¹Ÿå°±æ˜¯ NIO 2ã€‚åœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡çš„IOæ¨¡å‹ã€‚å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚</p> <h3 id="1010executorservice">10.10ã€ExecutorService<a class="headerlink" href="#1010executorservice" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çº¿ç¨‹çš„æ—¶å€™éƒ½æ˜¯ä½¿ç”¨ new Thread æ¥è¿›è¡Œçº¿ç¨‹çš„åˆ›å»ºï¼Œä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚å¦‚ï¼š</p> <ul> <li>æ¯æ¬¡ new Thread æ–°å»ºå¯¹è±¡æ€§èƒ½å·®ã€‚</li> <li>çº¿ç¨‹ç¼ºä¹ç»Ÿä¸€ç®¡ç†ï¼Œå¯èƒ½æ— é™åˆ¶æ–°å»ºçº¿ç¨‹ï¼Œç›¸äº’ä¹‹é—´ç«äº‰ï¼ŒåŠå¯èƒ½å ç”¨è¿‡å¤šç³»ç»Ÿèµ„æºå¯¼è‡´æ­»æœºã€‚</li> <li>ç¼ºä¹æ›´å¤šåŠŸèƒ½ï¼Œå¦‚å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€çº¿ç¨‹ä¸­æ–­ã€‚</li> </ul> <p>ç›¸æ¯” new Threadï¼ŒJava æä¾›çš„å››ç§çº¿ç¨‹æ± çš„å¥½å¤„åœ¨äºï¼š</p> <ul> <li>é‡ç”¨å­˜åœ¨çš„çº¿ç¨‹ï¼Œå‡å°‘å¯¹è±¡åˆ›å»ºã€æ¶ˆäº¡çš„å¼€é”€ï¼Œæ€§èƒ½ä½³ã€‚</li> <li>å¯æœ‰æ•ˆæ§åˆ¶æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼Œæé«˜ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ç‡ï¼ŒåŒæ—¶é¿å…è¿‡å¤šèµ„æºç«äº‰ï¼Œé¿å…å µå¡ã€‚</li> <li>æä¾›å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€å•çº¿ç¨‹ã€å¹¶å‘æ•°æ§åˆ¶ç­‰åŠŸèƒ½ã€‚</li> </ul> <h4 id="10101å†…ç½®çº¿ç¨‹æ± ">10.10.1ã€å†…ç½®çº¿ç¨‹æ± <a class="headerlink" href="#10101å†…ç½®çº¿ç¨‹æ± " title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Java é€šè¿‡ Executors æä¾›å››ç§çº¿ç¨‹æ± ï¼Œåˆ†åˆ«ä¸ºï¼š</p> <ul> <li>newCachedThreadPool åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹ã€‚</li> <li>newFixedThreadPool åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œå¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼Œè¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚</li> <li>newScheduledThreadPool åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚</li> <li>newSingleThreadExecutor åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚</li> </ul> <p><strong>newCachedThreadPoolï¼ˆï¼‰</strong></p> <p>å®ƒæ˜¯ç”¨æ¥å¤„ç†å¤§é‡çŸ­æ—¶é—´å·¥ä½œä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œå…·æœ‰å‡ ä¸ªé²œæ˜ç‰¹ç‚¹ï¼šå®ƒä¼šè¯•å›¾ç¼“å­˜çº¿ç¨‹å¹¶é‡ç”¨ï¼Œå½“æ— ç¼“å­˜çº¿ç¨‹å¯ç”¨æ—¶ï¼Œå°±ä¼šåˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼›å¦‚æœçº¿ç¨‹é—²ç½®æ—¶é—´è¶…è¿‡60ç§’ï¼Œåˆ™è¢«ç»ˆæ­¢å¹¶ç§»é™¤ç¼“å­˜ï¼›é•¿æ—¶é—´é—²ç½®æ—¶ï¼Œè¿™ç§çº¿ç¨‹æ± ï¼Œä¸ä¼šæ¶ˆè€—ä»€ä¹ˆèµ„æºã€‚å…¶å†…éƒ¨ä½¿ç”¨SynchronousQueueä½œä¸ºå·¥ä½œé˜Ÿåˆ—ã€‚</p> <p><strong>newFixedThreadPoolï¼ˆint nThreadsï¼‰</strong></p> <p>é‡ç”¨æŒ‡å®šæ•°ç›®ï¼ˆnThreadsï¼‰çš„çº¿ç¨‹ï¼Œå…¶èƒŒåä½¿ç”¨çš„æ˜¯æ— ç•Œçš„å·¥ä½œé˜Ÿåˆ—ï¼Œä»»ä½•æ—¶å€™æœ€å¤šæœ‰nThreadsä¸ªå·¥ä½œçº¿ç¨‹æ˜¯æ´»åŠ¨çš„ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä»»åŠ¡æ•°é‡è¶…è¿‡äº†æ´»åŠ¨çº¿ç¨‹æ•°ç›®ï¼Œå°†åœ¨å·¥ä½œé˜Ÿåˆ—ä¸­ç­‰å¾…ç©ºé—²çº¿ç¨‹å‡ºç°ï¼›å¦‚æœå·¥ä½œçº¿ç¨‹é€€å‡ºï¼Œå°†ä¼šæœ‰æ–°çš„å·¥ä½œçº¿ç¨‹è¢«åˆ›å»ºï¼Œä»¥è¡¥è¶³æŒ‡å®šæ•°ç›®nThreadsã€‚</p> <p><strong>newSingleThreadExecutor()</strong></p> <p>å®ƒçš„ç‰¹ç‚¹åœ¨äºå·¥ä½œçº¿ç¨‹æ•°ç›®é™åˆ¶ä¸º1ï¼Œæ“ä½œä¸€ä¸ªæ— ç•Œçš„å·¥ä½œé˜Ÿåˆ—ï¼Œæ‰€ä»¥å®ƒä¿è¯äº†æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯è¢«é¡ºåºæ‰§è¡Œï¼Œæœ€å¤šä¼šæœ‰ä¸€ä¸ªä»»åŠ¡å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”ä¸äºˆè®¸ä½¿ç”¨è€…æ”¹åŠ¨çº¿ç¨‹æ± å®ä¾‹ï¼Œå› æ­¤å¯ä»¥é¿å…æ”¹å˜çº¿ç¨‹æ•°ç›®ã€‚</p> <p><strong>newSingleThreadScheduledExecutor()</strong>å’Œ<strong>newScheduledThreadPool(int corePoolSize)</strong></p> <p>åˆ›å»ºçš„æ˜¯ä¸ªScheduledExecutorServiceï¼Œå¯ä»¥è¿›è¡Œå®šæ—¶æˆ–å‘¨æœŸæ€§çš„å·¥ä½œè°ƒåº¦ï¼ŒåŒºåˆ«åœ¨äºå•ä¸€å·¥ä½œçº¿ç¨‹è¿˜æ˜¯å¤šä¸ªå·¥ä½œçº¿ç¨‹ã€‚</p> <h4 id="10102threadpoolexecutor">10.10.2ã€ThreadPoolExecutor<a class="headerlink" href="#10102threadpoolexecutor" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>åœ¨é˜¿é‡Œå·´å·´ä»£ç è§„èŒƒä¸­ï¼Œå»ºè®®æˆ‘ä»¬è‡ªå·±æŒ‡å®šçº¿ç¨‹æ± çš„ç›¸å…³å‚æ•°ï¼Œä¸ºçš„æ˜¯è®©å¼€å‘äººå‘˜èƒ½å¤Ÿè‡ªè¡Œç†è§£çº¿ç¨‹æ± åˆ›å»ºä¸­çš„æ¯ä¸ªå‚æ•°ï¼Œæ ¹æ®å®é™…æƒ…å†µï¼Œåˆ›å»ºå‡ºåˆç†çš„çº¿ç¨‹æ± ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å‰–æä¸‹<code>java.util.concurrent.ThreadPoolExecutor</code>çš„æ„é€ æ–¹æ³•å‚æ•°ã€‚</p> <p><code>java.util.concurrent.ThreadPoolExecutor</code>æœ‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬æ‹¿å‚æ•°æœ€å¤šçš„æ„é€ æ–¹æ³•æ¥ä¸¾ä¾‹ï¼Œä»¥ä¸‹æ˜¯é˜¿é‡Œå·´å·´ä»£ç è§„èŒƒä¸­ç»™å‡ºçš„åˆ›å»ºçº¿ç¨‹æ± çš„èŒƒä¾‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="n">ThreadPoolExecutor</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="w">                </span><span class="mi">0</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MILLISECONDS</span><span class="p">,</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedBlockingQueue</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="mi">1024</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadFactoryBuilder</span><span class="p">().</span><span class="na">setNameFormat</span><span class="p">(</span><span class="s">"demo-pool-%d"</span><span class="p">).</span><span class="na">build</span><span class="p">(),</span><span class="w"> </span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">.</span><span class="na">AbortPolicy</span><span class="p">());</span>
</span></code></pre></div> <p>é¦–å…ˆæœ€é‡è¦çš„å‡ ä¸ªå‚æ•°ï¼Œå¯èƒ½å°±æ˜¯ï¼š<code>corePoolSize</code>ï¼Œ<code>maximumPoolSize</code>ï¼Œ<code>workQueue</code>äº†ï¼Œå…ˆçœ‹ä¸‹è¿™å‡ ä¸ªå‚æ•°çš„è§£é‡Šï¼š</p> <ul> <li>corePoolSize ç”¨äºè®¾å®š thread pool éœ€è¦æ—¶åˆ»ä¿æŒçš„æœ€å° core threads çš„æ•°é‡ï¼Œå³ä¾¿è¿™äº› core threads å¤„äºç©ºé—²çŠ¶æ€å•¥äº‹éƒ½ä¸åšä¹Ÿä¸ä¼šå°†å®ƒä»¬å›æ”¶æ‰ï¼Œå½“ç„¶å‰ææ˜¯ä½ æ²¡æœ‰è®¾ç½® allowCoreThreadTimeOut ä¸º trueã€‚è‡³äº pool æ˜¯å¦‚ä½•åšåˆ°ä¿æŒè¿™äº›ä¸ª threads ä¸æ­»çš„ï¼Œæˆ‘ä»¬ç¨åå†è¯´ã€‚</li> <li>maximumPoolSize ç”¨äºé™å®š pool ä¸­çº¿ç¨‹æ•°çš„æœ€å¤§å€¼ã€‚å¦‚æœä½ è‡ªå·±æ„é€ äº† pool ä¸”ä¼ å…¥äº†ä¸€ä¸ª Unbounded çš„ queue ä¸”æ²¡æœ‰è®¾ç½®å®ƒçš„ capacityï¼Œé‚£ä¹ˆä¸å¥½æ„æ€ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¼šæ°¸è¿œ &lt;= corePoolSizeï¼ŒmaximumPoolSize å˜æˆäº†æ— æ•ˆçš„ã€‚</li> <li>workQueue è¯¥çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ï¼šç»´æŠ¤ç€ç­‰å¾…æ‰§è¡Œçš„ Runnable å¯¹è±¡ã€‚å½“æ‰€æœ‰çš„æ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨å¹²æ´»æ—¶ï¼Œæ–°æ·»åŠ çš„ä»»åŠ¡ä¼šè¢«æ·»åŠ åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œåˆ™æ–°å»ºéæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</li> </ul> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1">// åˆ›å»ºçº¿ç¨‹æ± </span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="n">ThreadPoolExecutor</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="w">            </span><span class="mi">0</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MILLISECONDS</span><span class="p">,</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedBlockingQueue</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="mi">1024</span><span class="p">),</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadFactoryBuilder</span><span class="p">().</span><span class="na">setNameFormat</span><span class="p">(</span><span class="s">"demo-pool-%d"</span><span class="p">).</span><span class="na">build</span><span class="p">(),</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">.</span><span class="na">AbortPolicy</span><span class="p">());</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="c1">// ç­‰å¾…æ‰§è¡Œçš„runnable   </span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="n">Runnable</span><span class="w"> </span><span class="n">runnable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="w">        </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="p">};</span>
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a><span class="c1">// å¯åŠ¨çš„ä»»åŠ¡æ•°é‡</span>
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="kt">int</span><span class="w"> </span><span class="n">counts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1224</span><span class="p">;</span>
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">counts</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a><span class="w">    </span><span class="n">service</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">runnable</span><span class="p">);</span>
</span><span id="__span-66-20"><a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a><span class="p">}</span>
</span><span id="__span-66-21"><a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a>
</span><span id="__span-66-22"><a id="__codelineno-66-22" name="__codelineno-66-22" href="#__codelineno-66-22"></a><span class="c1">// ç›‘æ§çº¿ç¨‹æ± æ‰§è¡Œæƒ…å†µçš„ä»£ç  </span>
</span><span id="__span-66-23"><a id="__codelineno-66-23" name="__codelineno-66-23" href="#__codelineno-66-23"></a><span class="n">ThreadPoolExecutor</span><span class="w"> </span><span class="n">tpe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">ThreadPoolExecutor</span><span class="p">)</span><span class="w"> </span><span class="n">service</span><span class="p">);</span>
</span><span id="__span-66-24"><a id="__codelineno-66-24" name="__codelineno-66-24" href="#__codelineno-66-24"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-25"><a id="__codelineno-66-25" name="__codelineno-66-25" href="#__codelineno-66-25"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
</span><span id="__span-66-26"><a id="__codelineno-66-26" name="__codelineno-66-26" href="#__codelineno-66-26"></a>
</span><span id="__span-66-27"><a id="__codelineno-66-27" name="__codelineno-66-27" href="#__codelineno-66-27"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">queueSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tpe</span><span class="p">.</span><span class="na">getQueue</span><span class="p">().</span><span class="na">size</span><span class="p">();</span>
</span><span id="__span-66-28"><a id="__codelineno-66-28" name="__codelineno-66-28" href="#__codelineno-66-28"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å½“å‰æ’é˜Ÿçº¿ç¨‹æ•°ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">queueSize</span><span class="p">);</span>
</span><span id="__span-66-29"><a id="__codelineno-66-29" name="__codelineno-66-29" href="#__codelineno-66-29"></a>
</span><span id="__span-66-30"><a id="__codelineno-66-30" name="__codelineno-66-30" href="#__codelineno-66-30"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">activeCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tpe</span><span class="p">.</span><span class="na">getActiveCount</span><span class="p">();</span>
</span><span id="__span-66-31"><a id="__codelineno-66-31" name="__codelineno-66-31" href="#__codelineno-66-31"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">activeCount</span><span class="p">);</span>
</span><span id="__span-66-32"><a id="__codelineno-66-32" name="__codelineno-66-32" href="#__codelineno-66-32"></a>
</span><span id="__span-66-33"><a id="__codelineno-66-33" name="__codelineno-66-33" href="#__codelineno-66-33"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">completedTaskCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tpe</span><span class="p">.</span><span class="na">getCompletedTaskCount</span><span class="p">();</span>
</span><span id="__span-66-34"><a id="__codelineno-66-34" name="__codelineno-66-34" href="#__codelineno-66-34"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ‰§è¡Œå®Œæˆçº¿ç¨‹æ•°ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">completedTaskCount</span><span class="p">);</span>
</span><span id="__span-66-35"><a id="__codelineno-66-35" name="__codelineno-66-35" href="#__codelineno-66-35"></a>
</span><span id="__span-66-36"><a id="__codelineno-66-36" name="__codelineno-66-36" href="#__codelineno-66-36"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">taskCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tpe</span><span class="p">.</span><span class="na">getTaskCount</span><span class="p">();</span>
</span><span id="__span-66-37"><a id="__codelineno-66-37" name="__codelineno-66-37" href="#__codelineno-66-37"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ€»çº¿ç¨‹æ•°ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">taskCount</span><span class="p">);</span>
</span><span id="__span-66-38"><a id="__codelineno-66-38" name="__codelineno-66-38" href="#__codelineno-66-38"></a>
</span><span id="__span-66-39"><a id="__codelineno-66-39" name="__codelineno-66-39" href="#__codelineno-66-39"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-40"><a id="__codelineno-66-40" name="__codelineno-66-40" href="#__codelineno-66-40"></a><span class="w">        </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</span><span id="__span-66-41"><a id="__codelineno-66-41" name="__codelineno-66-41" href="#__codelineno-66-41"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-42"><a id="__codelineno-66-42" name="__codelineno-66-42" href="#__codelineno-66-42"></a><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-66-43"><a id="__codelineno-66-43" name="__codelineno-66-43" href="#__codelineno-66-43"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-66-44"><a id="__codelineno-66-44" name="__codelineno-66-44" href="#__codelineno-66-44"></a><span class="p">}</span><span class="w"> </span>
</span></code></pre></div> <p>çº¿ç¨‹æ± çš„å®¹é‡ä¸æˆ‘ä»¬å¯åŠ¨çš„ä»»åŠ¡æ•°é‡æ¯æ¯ç›¸å…³ã€‚</p> <p>å·²çŸ¥ï¼š</p> <ul> <li>corePoolSize = 5</li> <li>maximumPoolSize = 200</li> <li>workQueue.size() = 1024</li> </ul> <p>æˆ‘ä»¬ä¿®æ”¹åŒæ—¶ execute æ·»åŠ åˆ°çº¿ç¨‹æ± çš„ Runnable æ•°é‡ countsï¼š</p> <ul> <li> <p>counts &lt;= corePoolSizeï¼šæ‰€æœ‰çš„ä»»åŠ¡å‡ä¸ºæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œï¼Œæ²¡æœ‰ä»»ä½• Runnable è¢«æ·»åŠ åˆ° workQueueä¸­ã€‚</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>å½“å‰æ’é˜Ÿçº¿ç¨‹æ•°ï¼š0
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°ï¼š3
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>æ‰§è¡Œå®Œæˆçº¿ç¨‹æ•°ï¼š0
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>æ€»çº¿ç¨‹æ•°ï¼š3
</span></code></pre></div> </li> <li> <p>corePoolSize &lt; counts &lt;= corePoolSize + workQueue.size()ï¼šæ‰€æœ‰ä»»åŠ¡å‡ä¸ºæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œï¼Œå½“æ ¸å¿ƒçº¿ç¨‹å¤„äºç¹å¿™çŠ¶æ€ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ° workQueue ä¸­ç­‰å¾…ã€‚</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>å½“å‰æ’é˜Ÿçº¿ç¨‹æ•°ï¼š15
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°ï¼š5
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>æ‰§è¡Œå®Œæˆçº¿ç¨‹æ•°ï¼š0
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>æ€»çº¿ç¨‹æ•°ï¼š20
</span></code></pre></div> </li> <li> <p>corePoolSize + workQueue.size() &lt; counts &lt;= maximumPoolSize + workQueue.size()ï¼šcorePoolSize ä¸ªçº¿ç¨‹ç”±æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œï¼Œè¶…å‡ºé˜Ÿåˆ—é•¿åº¦ workQueue.size() çš„ä»»åŠ¡ï¼Œå°†å¦å¯åŠ¨éæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œã€‚</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>å½“å‰æ’é˜Ÿçº¿ç¨‹æ•°ï¼š1024
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°ï¼š105
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>æ‰§è¡Œå®Œæˆçº¿ç¨‹æ•°ï¼š0
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>æ€»çº¿ç¨‹æ•°ï¼š1129
</span></code></pre></div> </li> <li> <p>counts &gt; maximumPoolSize + workQueue.size()ï¼šå°†ä¼šæŠ¥å¼‚å¸¸<code>java.util.concurrent.RejectedExecutionException</code></p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">RejectedExecutionException</span><span class="p">:</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">bwjava</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">ExecutorServiceUtilTest$$Lambda$1</span><span class="o">/</span><span class="mi">314265080</span><span class="err">@</span><span class="mi">725</span><span class="n">bef66</span><span class="w"> </span><span class="n">rejected</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">ThreadPoolExecutor</span><span class="err">@</span><span class="mi">2</span><span class="n">aaf7cc2</span><span class="o">[</span><span class="n">Running</span><span class="p">,</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">queued</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="n">completed</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">]</span>
</span></code></pre></div> </li> </ul> <h4 id="10103executorservice">10.10.3ã€ExecutorService<a class="headerlink" href="#10103executorservice" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>é€šå¸¸æ¥è¯´æœ‰ä¸¤ç§æ–¹æ³•æ¥åˆ›å»º ExecutorServiceã€‚</p> <ul> <li> <p>ç¬¬ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ Executors ä¸­çš„å·¥å‚ç±»æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="n">ExecutorService</span><span class="w"> </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></code></pre></div> <p>é™¤äº† newFixedThreadPool æ–¹æ³•ä¹‹å¤–ï¼ŒExecutors è¿˜åŒ…å«äº†å¾ˆå¤šåˆ›å»º ExecutorService çš„æ–¹æ³•ã€‚</p> </li> <li> <p>ç¬¬äºŒç§æ–¹æ³•æ˜¯ç›´æ¥åˆ›å»ºä¸€ä¸ª ExecutorServiceï¼Œ å› ä¸º ExecutorService æ˜¯ä¸€ä¸ª interfaceï¼Œéœ€è¦å®ä¾‹åŒ– ExecutorService çš„ä¸€ä¸ªå®ç°ã€‚</p> <p>è¿™é‡Œä½¿ç”¨ ThreadPoolExecutor æ¥ä¸¾ä¾‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="n">ExecutorService</span><span class="w"> </span><span class="n">executorService</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MILLISECONDS</span><span class="p">,</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span><span class="p">());</span>
</span></code></pre></div> </li> </ul> <hr> <p><strong>ä¸º ExecutorService åˆ†é… Tasks</strong></p> <p>ExecutorService å¯ä»¥æ‰§è¡Œ Runnable å’Œ Callable çš„ taskã€‚å…¶ä¸­ Runnable æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œè€Œ Callable æ˜¯æœ‰è¿”å›å€¼çš„ã€‚ä»¥ä¸‹ä¸ºä¸¤ç§æƒ…å†µçš„ä½¿ç”¨ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="n">Runnable</span><span class="w"> </span><span class="n">runnableTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="w">        </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MILLISECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="p">};</span>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">callableTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a><span class="w">    </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MILLISECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">"Task's execution"</span><span class="p">;</span>
</span><span id="__span-73-12"><a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a><span class="p">};</span>
</span></code></pre></div> <p>å°† task åˆ†é…ç»™ ExecutorServiceï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <code>execute()</code>, <code>submit()</code>, <code>invokeAny()</code>, <code>invokeAll()</code> è¿™å‡ ä¸ªæ–¹æ³•æ¥å®ç°ã€‚</p> <p>execute() è¿”å›å€¼æ˜¯ voidï¼Œä»–ç”¨æ¥æäº¤ä¸€ä¸ªRunnable taskã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="n">executorService</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">runnableTask</span><span class="p">);</span>
</span></code></pre></div> <p>submit() è¿”å›å€¼æ˜¯ Futureï¼Œå®ƒå¯ä»¥æäº¤ Runnable task, ä¹Ÿå¯ä»¥æäº¤ Callable taskï¼ŒåŒæ—¶submit() å¯ä»¥å¤„ç†å¼‚å¸¸ï¼Œå¦‚æœåœ¨taské‡Œä¼šæŠ›å‡º checked æˆ–è€… unchecked exceptionï¼Œè€Œåˆå¸Œæœ›å¤–é¢çš„è°ƒç”¨è€…èƒ½å¤Ÿæ„ŸçŸ¥è¿™äº› exception å¹¶åšå‡ºåŠæ—¶çš„å¤„ç†ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨åˆ° submitï¼Œé€šè¿‡æ•è· Future.get æŠ›å‡ºçš„å¼‚å¸¸ã€‚</p> <p>æäº¤ Runnable çš„æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">submit</span><span class="p">(</span><span class="n">Runnable</span><span class="w"> </span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="n">Future</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="nf">submit</span><span class="p">(</span><span class="n">Runnable</span><span class="w"> </span><span class="n">task</span><span class="p">);</span>
</span></code></pre></div> <p>ç¬¬ä¸€ä¸ªæ–¹æ³•åœ¨è¿”å›ä¼ å…¥çš„ resultã€‚ç¬¬äºŒä¸ªæ–¹æ³•è¿”å› nullã€‚</p> <p>å†çœ‹ä¸€ä¸‹callableçš„ä½¿ç”¨ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">executorService</span><span class="p">.</span><span class="na">submit</span><span class="p">(</span><span class="n">callableTask</span><span class="p">);</span>
</span></code></pre></div> <p>invokeAny() å°†ä¸€ä¸ª task åˆ—è¡¨ä¼ é€’ç»™ executorServiceï¼Œå¹¶è¿”å›å…¶ä¸­çš„ä¸€ä¸ªæˆåŠŸè¿”å›çš„ç»“æœã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">executorService</span><span class="p">.</span><span class="na">invokeAny</span><span class="p">(</span><span class="n">callableTasks</span><span class="p">);</span>
</span></code></pre></div> <p>invokeAll() å°†ä¸€ä¸ªtaskåˆ—è¡¨ä¼ é€’ç»™executorServiceï¼Œå¹¶è¿”å›æ‰€æœ‰æˆåŠŸæ‰§è¡Œçš„ç»“æœï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">executorService</span><span class="p">.</span><span class="na">invokeAll</span><span class="p">(</span><span class="n">callableTasks</span><span class="p">);</span>
</span></code></pre></div> <hr> <p><strong>å…³é—­ ExecutorService</strong></p> <p>å¦‚æœ ExecutorService ä¸­çš„ä»»åŠ¡è¿è¡Œå®Œæ¯•ä¹‹åï¼ŒExecutorService ä¸ä¼šè‡ªåŠ¨å…³é—­ã€‚å®ƒä¼šç­‰å¾…æ¥æ”¶æ–°çš„ä»»åŠ¡ã€‚å¦‚æœéœ€è¦å…³é—­ ExecutorServiceï¼Œ éœ€è¦è°ƒç”¨ shutdown() æˆ–è€… shutdownNow() æ–¹æ³•ã€‚</p> <p>shutdown() ä¼šç«‹å³é”€æ¯ ExecutorServiceï¼Œå®ƒä¼šè®© ExecutorServic åœæ­¢æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œå¹¶ç­‰å¾…ç°æœ‰ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•å†é”€æ¯ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="n">executorService</span><span class="p">.</span><span class="na">shutdown</span><span class="p">();</span>
</span></code></pre></div> <p>shutdownNow() å¹¶ä¸ä¿è¯æ‰€æœ‰çš„ä»»åŠ¡éƒ½è¢«æ‰§è¡Œå®Œæ¯•ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæœªæ‰§è¡Œä»»åŠ¡çš„åˆ—è¡¨ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span><span class="w"> </span><span class="n">notExecutedTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">executorService</span><span class="p">.</span><span class="na">shutdownNow</span><span class="p">();</span>
</span></code></pre></div> <h4 id="10104çº¿ç¨‹æ± çš„çŠ¶æ€">10.10.4ã€çº¿ç¨‹æ± çš„çŠ¶æ€<a class="headerlink" href="#10104çº¿ç¨‹æ± çš„çŠ¶æ€" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>çº¿ç¨‹æ± æœ‰5ç§çŠ¶æ€ï¼šRunningã€ShutDownã€Stopã€Tidyingã€Terminatedã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/2024-12-25 004515.png" data-desc-position="bottom"><img src="!assets/Java/2024-12-25 004515.png" alt="2024-12-25 004515" style></a></p> <ul> <li> <p>RUNNINGï¼šçº¿ç¨‹æ± ä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±å¤„äº RUNNING çŠ¶æ€ï¼Œä»»åŠ¡æ•°ä¸º 0ï¼Œèƒ½å¤Ÿæ¥æ”¶æ–°ä»»åŠ¡ï¼Œå¯¹å·²æ’é˜Ÿçš„ä»»åŠ¡è¿›è¡Œå¤„ç†ã€‚</p> </li> <li> <p>SHUTDOWNï¼šä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†èƒ½å¤„ç†å·²æ’é˜Ÿçš„ä»»åŠ¡ã€‚</p> <p>è°ƒç”¨çº¿ç¨‹æ± çš„ shutdown() æ–¹æ³•ï¼Œçº¿ç¨‹æ± ç”± RUNNING è½¬å˜ä¸º SHUTDOWN çŠ¶æ€ã€‚ </p> </li> <li> <p>STOPï¼šä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä¸å¤„ç†å·²æ’é˜Ÿçš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šä¸­æ–­æ­£åœ¨å¤„ç†çš„ä»»åŠ¡ã€‚</p> <p>è°ƒç”¨çº¿ç¨‹æ± çš„ shutdownNow() æ–¹æ³•ï¼Œçº¿ç¨‹æ± ç”±(RUNNING æˆ– SHUTDOWN ) è½¬å˜ä¸º STOP çŠ¶æ€ã€‚</p> </li> <li> <p>TIDYINGï¼šä¼šæ‰§è¡Œ terminated() æ–¹æ³•ã€‚çº¿ç¨‹æ± ä¸­çš„ terminated() æ–¹æ³•æ—¶ç©ºå®ç°ï¼Œå¯ä»¥é‡å†™ç»™æ–¹æ³•è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p> <p>çº¿ç¨‹æ± åœ¨ SHUTDOWN çŠ¶æ€ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºä¸”æ‰§è¡Œä¸­ä»»åŠ¡ä¸ºç©ºï¼Œçº¿ç¨‹æ± å°±ä¼šç”± SHUTDOWN è½¬å˜ä¸º TIDYING çŠ¶æ€ã€‚ </p> <p>çº¿ç¨‹æ± åœ¨ STOP çŠ¶æ€ï¼Œçº¿ç¨‹æ± ä¸­æ‰§è¡Œä¸­ä»»åŠ¡ä¸ºç©ºæ—¶ï¼Œå°±ä¼šç”± STOP è½¬å˜ä¸º TIDYING çŠ¶æ€ã€‚ </p> </li> <li> <p>TERMINATEDï¼šçº¿ç¨‹æ± å½»åº•ç»ˆæ­¢ã€‚</p> <p>çº¿ç¨‹æ± åœ¨ TIDYING çŠ¶æ€æ‰§è¡Œå®Œ terminated() æ–¹æ³•å°±ä¼šç”± TIDYING è½¬å˜ä¸º TERMINATED çŠ¶æ€ã€‚ </p> </li> </ul> <h3 id="1011çº¿ç¨‹å®‰å…¨">10.11ã€çº¿ç¨‹å®‰å…¨<a class="headerlink" href="#1011çº¿ç¨‹å®‰å…¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <h4 id="10111å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ">10.11.1ã€å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ<a class="headerlink" href="#10111å†…å­˜æ¨¡å‹çš„ç›¸å…³æ¦‚å¿µ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>è®¡ç®—æœºåœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½æ˜¯åœ¨CPUä¸­æ‰§è¡Œçš„ï¼Œè€Œæ‰§è¡ŒæŒ‡ä»¤è¿‡ç¨‹ä¸­ï¼ŒåŠ¿å¿…æ¶‰åŠåˆ°æ•°æ®çš„è¯»å–å’Œå†™å…¥ã€‚ç”±äºç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ•°æ®æ˜¯å­˜æ”¾åœ¨ä¸»å­˜ï¼ˆç‰©ç†å†…å­˜ï¼‰å½“ä¸­çš„ï¼Œè¿™æ—¶å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼ŒCPUæ‰§è¡Œé€Ÿåº¦å¾ˆå¿«ï¼Œè€Œä»å†…å­˜è¯»å–æ•°æ®å’Œå‘å†…å­˜å†™å…¥æ•°æ®çš„è¿‡ç¨‹è·ŸCPUæ‰§è¡ŒæŒ‡ä»¤çš„é€Ÿåº¦æ¯”èµ·æ¥è¦æ…¢çš„å¤šï¼Œå› æ­¤å¦‚æœä»»ä½•æ—¶å€™å¯¹æ•°æ®çš„æ“ä½œéƒ½è¦é€šè¿‡å’Œå†…å­˜çš„äº¤äº’æ¥è¿›è¡Œï¼Œä¼šå¤§å¤§é™ä½æŒ‡ä»¤æ‰§è¡Œçš„é€Ÿåº¦ã€‚</p> <p>å› æ­¤åœ¨CPUé‡Œé¢å°±æœ‰äº†é«˜é€Ÿç¼“å­˜ï¼šå½“ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šå°†è¿ç®—éœ€è¦çš„æ•°æ®ä»ä¸»å­˜å¤åˆ¶ä¸€ä»½åˆ°CPUçš„é«˜é€Ÿç¼“å­˜å½“ä¸­ï¼Œé‚£ä¹ˆCPUè¿›è¡Œè®¡ç®—æ—¶å°±å¯ä»¥ç›´æ¥ä»å®ƒçš„é«˜é€Ÿç¼“å­˜è¯»å–æ•°æ®å’Œå‘å…¶ä¸­å†™å…¥æ•°æ®ï¼Œå½“è¿ç®—ç»“æŸä¹‹åï¼Œå†å°†é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å­˜å½“ä¸­ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¯”å¦‚ä¸‹é¢çš„è¿™æ®µä»£ç ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span></code></pre></div> <p>å½“çº¿ç¨‹æ‰§è¡Œè¿™ä¸ªè¯­å¥æ—¶ï¼Œä¼šå…ˆä»ä¸»å­˜å½“ä¸­è¯»å–içš„å€¼ï¼Œç„¶åå¤åˆ¶ä¸€ä»½åˆ°é«˜é€Ÿç¼“å­˜å½“ä¸­ï¼Œç„¶åCPUæ‰§è¡ŒæŒ‡ä»¤å¯¹iè¿›è¡ŒåŠ 1æ“ä½œï¼Œç„¶åå°†æ•°æ®å†™å…¥é«˜é€Ÿç¼“å­˜ï¼Œæœ€åå°†é«˜é€Ÿç¼“å­˜ä¸­iæœ€æ–°çš„å€¼åˆ·æ–°åˆ°ä¸»å­˜å½“ä¸­ã€‚</p> <p>è¿™ä¸ªä»£ç åœ¨å•çº¿ç¨‹ä¸­è¿è¡Œæ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ä¸­è¿è¡Œå°±ä¼šæœ‰é—®é¢˜äº†ã€‚åœ¨å¤šæ ¸CPUä¸­ï¼Œæ¯æ¡çº¿ç¨‹å¯èƒ½è¿è¡Œäºä¸åŒçš„CPUä¸­ï¼Œå› æ­¤æ¯ä¸ªçº¿ç¨‹è¿è¡Œæ—¶æœ‰è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ï¼ˆå¯¹å•æ ¸CPUæ¥è¯´ï¼Œå…¶å®ä¹Ÿä¼šå‡ºç°è¿™ç§é—®é¢˜ï¼Œåªä¸è¿‡æ˜¯ä»¥çº¿ç¨‹è°ƒåº¦çš„å½¢å¼æ¥åˆ†åˆ«æ‰§è¡Œçš„ï¼‰ã€‚</p> <p>å¯èƒ½å­˜åœ¨ä¸‹é¢ä¸€ç§æƒ…å†µï¼šåˆå§‹æ—¶ï¼Œä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è¯»å– i çš„å€¼å­˜å…¥å„è‡ªæ‰€åœ¨çš„CPUçš„é«˜é€Ÿç¼“å­˜å½“ä¸­ï¼Œç„¶åçº¿ç¨‹1è¿›è¡ŒåŠ 1æ“ä½œï¼Œç„¶åæŠŠiçš„æœ€æ–°å€¼1å†™å…¥åˆ°å†…å­˜ã€‚æ­¤æ—¶çº¿ç¨‹2çš„é«˜é€Ÿç¼“å­˜å½“ä¸­içš„å€¼è¿˜æ˜¯0ï¼Œè¿›è¡ŒåŠ 1æ“ä½œä¹‹åï¼Œiçš„å€¼ä¸º1ï¼Œç„¶åçº¿ç¨‹2æŠŠiçš„å€¼å†™å…¥å†…å­˜ã€‚æœ€ç»ˆç»“æœiçš„å€¼æ˜¯1ï¼Œè€Œä¸æ˜¯2ã€‚è¿™å°±æ˜¯è‘—åçš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚é€šå¸¸ç§°è¿™ç§è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®çš„å˜é‡ä¸ºå…±äº«å˜é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªå˜é‡åœ¨å¤šä¸ªCPUä¸­éƒ½å­˜åœ¨ç¼“å­˜ï¼ˆä¸€èˆ¬åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹æ—¶æ‰ä¼šå‡ºç°ï¼‰ï¼Œé‚£ä¹ˆå°±å¯èƒ½å­˜åœ¨ç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p> <p>ä¸ºäº†è§£å†³ç¼“å­˜ä¸ä¸€è‡´æ€§é—®é¢˜ï¼Œé€šå¸¸æ¥è¯´æœ‰ä»¥ä¸‹2ç§è§£å†³æ–¹æ³•ï¼š</p> <ul> <li>é€šè¿‡åœ¨æ€»çº¿åŠ LOCK#é”çš„æ–¹å¼</li> <li>é€šè¿‡ç¼“å­˜ä¸€è‡´æ€§åè®®</li> </ul> <p>è¿™2ç§æ–¹å¼éƒ½æ˜¯ç¡¬ä»¶å±‚é¢ä¸Šæä¾›çš„æ–¹å¼ã€‚</p> <p>åœ¨æ—©æœŸçš„ CPU å½“ä¸­ï¼Œæ˜¯é€šè¿‡åœ¨æ€»çº¿ä¸ŠåŠ  LOCK# é”çš„å½¢å¼æ¥è§£å†³ç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å› ä¸º CPU å’Œå…¶ä»–éƒ¨ä»¶è¿›è¡Œé€šä¿¡éƒ½æ˜¯é€šè¿‡æ€»çº¿æ¥è¿›è¡Œçš„ï¼Œå¦‚æœå¯¹æ€»çº¿åŠ  LOCK# é”çš„è¯ï¼Œä¹Ÿå°±æ˜¯è¯´é˜»å¡äº†å…¶ä»– CPU å¯¹å…¶ä»–éƒ¨ä»¶è®¿é—®ï¼ˆå¦‚å†…å­˜ï¼‰ï¼Œä»è€Œä½¿å¾—åªèƒ½æœ‰ä¸€ä¸ª CPU èƒ½ä½¿ç”¨è¿™ä¸ªå˜é‡çš„å†…å­˜ã€‚æ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­ å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ i = i +1ï¼Œå¦‚æœåœ¨æ‰§è¡Œè¿™æ®µä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œåœ¨æ€»çº¿ä¸Šå‘å‡ºäº† LCOK# é”çš„ä¿¡å·ï¼Œé‚£ä¹ˆåªæœ‰ç­‰å¾…è¿™æ®µä»£ç å®Œå…¨æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå…¶ä»–CPUæ‰èƒ½ä»å˜é‡iæ‰€åœ¨çš„å†…å­˜è¯»å–å˜é‡ï¼Œç„¶åè¿›è¡Œç›¸åº”çš„æ“ä½œã€‚è¿™æ ·å°±è§£å†³äº†ç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p> <p>ä½†æ˜¯ä¸Šé¢çš„æ–¹å¼ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºåœ¨é”ä½æ€»çº¿æœŸé—´ï¼Œå…¶ä»–CPUæ— æ³•è®¿é—®å†…å­˜ï¼Œå¯¼è‡´æ•ˆç‡ä½ä¸‹ã€‚</p> <p>æ‰€ä»¥å°±å‡ºç°äº†ç¼“å­˜ä¸€è‡´æ€§åè®®ã€‚æœ€å‡ºåçš„å°±æ˜¯Intel çš„MESIåè®®ï¼ŒMESIåè®®ä¿è¯äº†æ¯ä¸ªç¼“å­˜ä¸­ä½¿ç”¨çš„å…±äº«å˜é‡çš„å‰¯æœ¬æ˜¯ä¸€è‡´çš„ã€‚å®ƒæ ¸å¿ƒçš„æ€æƒ³æ˜¯ï¼šå½“CPUå†™æ•°æ®æ—¶ï¼Œå¦‚æœå‘ç°æ“ä½œçš„å˜é‡æ˜¯å…±äº«å˜é‡ï¼Œå³åœ¨å…¶ä»–CPUä¸­ä¹Ÿå­˜åœ¨è¯¥å˜é‡çš„å‰¯æœ¬ï¼Œä¼šå‘å‡ºä¿¡å·é€šçŸ¥å…¶ä»–CPUå°†è¯¥å˜é‡çš„ç¼“å­˜è¡Œç½®ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œå› æ­¤å½“å…¶ä»–CPUéœ€è¦è¯»å–è¿™ä¸ªå˜é‡æ—¶ï¼Œå‘ç°è‡ªå·±ç¼“å­˜ä¸­ç¼“å­˜è¯¥å˜é‡çš„ç¼“å­˜è¡Œæ˜¯æ— æ•ˆçš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šä»å†…å­˜é‡æ–°è¯»å–ã€‚</p> <h4 id="10112å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ">10.11.2ã€å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ<a class="headerlink" href="#10112å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šé‡åˆ°ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼šåŸå­æ€§é—®é¢˜ï¼Œå¯è§æ€§é—®é¢˜ï¼Œæœ‰åºæ€§é—®é¢˜ï¼š</p> <p><strong>åŸå­æ€§</strong>ï¼š å³ä¸€ä¸ªæ“ä½œæˆ–è€…å¤šä¸ªæ“ä½œ è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¹¶ä¸”æ‰§è¡Œçš„è¿‡ç¨‹ä¸ä¼šè¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼Œè¦ä¹ˆå°±éƒ½ä¸æ‰§è¡Œã€‚ è‹¥ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°è¿™ä¸ªè¯­å¥æ—¶ï¼Œæš‚ä¸”å‡è®¾ä¸ºä¸€ä¸ª32ä½çš„å˜é‡èµ‹å€¼åŒ…æ‹¬ä¸¤ä¸ªè¿‡ç¨‹ï¼šä¸ºä½16ä½èµ‹å€¼ï¼Œä¸ºé«˜16ä½èµ‹å€¼ã€‚ é‚£ä¹ˆå°±å¯èƒ½å‘ç”Ÿä¸€ç§æƒ…å†µï¼šå½“å°†ä½16ä½æ•°å€¼å†™å…¥ä¹‹åï¼Œçªç„¶è¢«ä¸­æ–­ï¼Œè€Œæ­¤æ—¶åˆæœ‰ä¸€ä¸ªçº¿ç¨‹å»è¯»å–içš„å€¼ï¼Œé‚£ä¹ˆè¯»å–åˆ°çš„å°±æ˜¯é”™è¯¯çš„æ•°æ®ã€‚</p> <p><strong>å¯è§æ€§</strong>ï¼š å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="c1">//çº¿ç¨‹1æ‰§è¡Œçš„ä»£ç </span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="kt">int</span><span class="w">&nbsp;</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="mi">10</span><span class="p">;</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="c1">//çº¿ç¨‹2æ‰§è¡Œçš„ä»£ç </span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span></code></pre></div> <p>å‡è‹¥æ‰§è¡Œçº¿ç¨‹1çš„æ˜¯CPU1ï¼Œæ‰§è¡Œçº¿ç¨‹2çš„æ˜¯CPU2ã€‚ç”±ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼Œå½“çº¿ç¨‹1æ‰§è¡Œ i =10è¿™å¥æ—¶ï¼Œä¼šå…ˆæŠŠiçš„åˆå§‹å€¼åŠ è½½åˆ°CPU1çš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œç„¶åèµ‹å€¼ä¸º10ï¼Œé‚£ä¹ˆåœ¨CPU1çš„é«˜é€Ÿç¼“å­˜å½“ä¸­içš„å€¼å˜ä¸º10äº†ï¼Œå´æ²¡æœ‰ç«‹å³å†™å…¥åˆ°ä¸»å­˜å½“ä¸­ã€‚</p> <p>æ­¤æ—¶çº¿ç¨‹2æ‰§è¡Œ j = iï¼Œå®ƒä¼šå…ˆå»ä¸»å­˜è¯»å–içš„å€¼å¹¶åŠ è½½åˆ°CPU2çš„ç¼“å­˜å½“ä¸­ï¼Œæ³¨æ„æ­¤æ—¶å†…å­˜å½“ä¸­içš„å€¼è¿˜æ˜¯0ï¼Œé‚£ä¹ˆå°±ä¼šä½¿å¾—jçš„å€¼ä¸º0ï¼Œè€Œä¸æ˜¯10ã€‚è¿™å°±æ˜¯å¯è§æ€§é—®é¢˜ï¼Œçº¿ç¨‹1å¯¹å˜é‡iä¿®æ”¹äº†ä¹‹åï¼Œçº¿ç¨‹2æ²¡æœ‰ç«‹å³çœ‹åˆ°çº¿ç¨‹1ä¿®æ”¹çš„å€¼ã€‚</p> <p><strong>æœ‰åºæ€§</strong>ï¼š å³ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="kt">int</span><span class="w">&nbsp;</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="kt">boolean</span><span class="w">&nbsp;</span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="mi">1</span><span class="p">;</span><span class="w">          </span><span class="c1">//è¯­å¥1&nbsp;&nbsp;</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="kc">true</span><span class="p">;</span><span class="w"> &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥2</span>
</span></code></pre></div> <p>ä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ªintå‹å˜é‡ï¼Œå®šä¹‰äº†ä¸€ä¸ªbooleanç±»å‹å˜é‡ï¼Œç„¶ååˆ†åˆ«å¯¹ä¸¤ä¸ªå˜é‡è¿›è¡Œèµ‹å€¼æ“ä½œã€‚ä»ä»£ç é¡ºåºä¸Šçœ‹ï¼Œè¯­å¥1æ˜¯åœ¨è¯­å¥2å‰é¢çš„ï¼Œé‚£ä¹ˆJVMåœ¨çœŸæ­£æ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶å€™ä¼šä¿è¯è¯­å¥1ä¸€å®šä¼šåœ¨è¯­å¥2å‰é¢æ‰§è¡Œå—ï¼Ÿä¸ä¸€å®šï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œå¯èƒ½ä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’åºï¼ˆInstruction Reorderï¼‰ã€‚</p> <p>ä¸€èˆ¬æ¥è¯´ï¼Œå¤„ç†å™¨ä¸ºäº†æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œå¯èƒ½ä¼šå¯¹è¾“å…¥ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå®ƒä¸ä¿è¯ç¨‹åºä¸­å„ä¸ªè¯­å¥çš„æ‰§è¡Œå…ˆåé¡ºåºåŒä»£ç ä¸­çš„é¡ºåºä¸€è‡´ï¼Œä½†æ˜¯å®ƒä¼šä¿è¯ç¨‹åºæœ€ç»ˆæ‰§è¡Œç»“æœå’Œä»£ç é¡ºåºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚æ¯”å¦‚ä¸Šé¢çš„ä»£ç ä¸­ï¼Œè¯­å¥1å’Œè¯­å¥2è°å…ˆæ‰§è¡Œå¯¹æœ€ç»ˆçš„ç¨‹åºç»“æœå¹¶æ²¡æœ‰å½±å“ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯­å¥2å…ˆæ‰§è¡Œè€Œè¯­å¥1åæ‰§è¡Œã€‚</p> <p>ä½†æ˜¯è¦æ³¨æ„ï¼Œè™½ç„¶å¤„ç†å™¨ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œä½†æ˜¯å®ƒä¼šä¿è¯ç¨‹åºæœ€ç»ˆç»“æœä¼šå’Œä»£ç é¡ºåºæ‰§è¡Œç»“æœç›¸åŒï¼Œé‚£ä¹ˆå®ƒé ä»€ä¹ˆä¿è¯çš„å‘¢ï¼Ÿå†çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="kt">int</span><span class="w">&nbsp;</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="mi">10</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥1</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="kt">int</span><span class="w">&nbsp;</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="mi">2</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥2</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w">&nbsp;</span><span class="mi">3</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥3</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥4</span>
</span></code></pre></div> <p>è¿™æ®µä»£ç æœ‰4ä¸ªè¯­å¥ï¼Œé‚£ä¹ˆå¯èƒ½çš„ä¸€ä¸ªæ‰§è¡Œé¡ºåºæ˜¯ï¼š è¯­å¥2 è¯­å¥1 è¯­å¥3 è¯­å¥4ï¼›é‚£ä¹ˆå¯ä¸å¯èƒ½æ˜¯è¿™ä¸ªæ‰§è¡Œé¡ºåºå‘¢ï¼š è¯­å¥2 è¯­å¥1 è¯­å¥4 è¯­å¥3ã€‚</p> <p>ä¸å¯èƒ½ï¼Œå› ä¸ºå¤„ç†å™¨åœ¨è¿›è¡Œé‡æ’åºæ—¶æ˜¯ä¼šè€ƒè™‘æŒ‡ä»¤ä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ï¼Œå¦‚æœä¸€ä¸ªæŒ‡ä»¤Instruction 2 å¿…é¡»ç”¨åˆ°Instruction 1 çš„ç»“æœï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šä¿è¯Instruction 1ä¼šåœ¨Instruction 2ä¹‹å‰æ‰§è¡Œã€‚</p> <p>è™½ç„¶é‡æ’åºä¸ä¼šå½±å“å•ä¸ªçº¿ç¨‹å†…ç¨‹åºæ‰§è¡Œçš„ç»“æœï¼Œä½†æ˜¯å¤šçº¿ç¨‹å‘¢ï¼Ÿä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="c1">//çº¿ç¨‹1:</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadContext</span><span class="p">();</span><span class="w">&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥1</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="n">inited</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="kc">true</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥2</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="c1">//çº¿ç¨‹2:</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">inited</span><span class="w"> </span><span class="p">){</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="w">&nbsp;&nbsp;</span><span class="n">sleep</span><span class="p">()</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="p">}</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="n">doSomethingwithconfig</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span></code></pre></div> <p>ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºè¯­å¥1å’Œè¯­å¥2æ²¡æœ‰æ•°æ®ä¾èµ–æ€§ï¼Œå› æ­¤å¯èƒ½ä¼šè¢«é‡æ’åºã€‚å‡å¦‚å‘ç”Ÿäº†é‡æ’åºï¼Œåœ¨çº¿ç¨‹1æ‰§è¡Œè¿‡ç¨‹ä¸­å…ˆæ‰§è¡Œè¯­å¥2ï¼Œè€Œæ­¤æ˜¯çº¿ç¨‹2ä¼šä»¥ä¸ºåˆå§‹åŒ–å·¥ä½œå·²ç»å®Œæˆï¼Œé‚£ä¹ˆå°±ä¼šè·³å‡º while å¾ªç¯ï¼Œå»æ‰§è¡Œ doSomethingwithconfig(context) æ–¹æ³•ï¼Œè€Œæ­¤æ—¶contextå¹¶æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå°±ä¼šå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚</p> <p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼ŒæŒ‡ä»¤é‡æ’åºä¸ä¼šå½±å“å•ä¸ªçº¿ç¨‹çš„æ‰§è¡Œï¼Œä½†æ˜¯ä¼šå½±å“åˆ°çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æƒ³å¹¶å‘ç¨‹åºæ­£ç¡®åœ°æ‰§è¡Œï¼Œå¿…é¡»è¦ä¿è¯åŸå­æ€§ã€å¯è§æ€§ä»¥åŠæœ‰åºæ€§ã€‚åªè¦æœ‰ä¸€ä¸ªæ²¡æœ‰è¢«ä¿è¯ï¼Œå°±æœ‰å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºè¿è¡Œä¸æ­£ç¡®ã€‚</p> <h4 id="10113javaå†…å­˜æ¨¡å‹">10.11.3ã€Javaå†…å­˜æ¨¡å‹<a class="headerlink" href="#10113javaå†…å­˜æ¨¡å‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰æ¥å±è”½å„ä¸ªç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚é‚£ä¹ˆJavaå†…å­˜æ¨¡å‹è§„å®šäº†å“ªäº›ä¸œè¥¿å‘¢ï¼Œå®ƒå®šä¹‰äº†ç¨‹åºä¸­å˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå¾€å¤§ä¸€ç‚¹è¯´æ˜¯å®šä¹‰äº†ç¨‹åºæ‰§è¡Œçš„æ¬¡åºã€‚æ³¨æ„ï¼Œä¸ºäº†è·å¾—è¾ƒå¥½çš„æ‰§è¡Œæ€§èƒ½ï¼ŒJavaå†…å­˜æ¨¡å‹å¹¶æ²¡æœ‰é™åˆ¶æ‰§è¡Œå¼•æ“ä½¿ç”¨å¤„ç†å™¨çš„å¯„å­˜å™¨æˆ–è€…é«˜é€Ÿç¼“å­˜æ¥æå‡æŒ‡ä»¤æ‰§è¡Œé€Ÿåº¦ï¼Œä¹Ÿæ²¡æœ‰é™åˆ¶ç¼–è¯‘å™¨å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨javaå†…å­˜æ¨¡å‹ä¸­ï¼Œä¹Ÿä¼šå­˜åœ¨ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜å’ŒæŒ‡ä»¤é‡æ’åºçš„é—®é¢˜ã€‚</p> <p>Javaå†…å­˜æ¨¡å‹è§„å®šæ‰€æœ‰çš„å˜é‡éƒ½æ˜¯å­˜åœ¨ä¸»å­˜å½“ä¸­ï¼ˆç±»ä¼¼äºå‰é¢è¯´çš„ç‰©ç†å†…å­˜ï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼ˆç±»ä¼¼äºå‰é¢çš„é«˜é€Ÿç¼“å­˜ï¼‰ã€‚çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥å¯¹ä¸»å­˜è¿›è¡Œæ“ä½œã€‚å¹¶ä¸”æ¯ä¸ªçº¿ç¨‹ä¸èƒ½è®¿é—®å…¶ä»–çº¿ç¨‹çš„å·¥ä½œå†…å­˜ã€‚</p> <p>é‚£ä¹ˆJavaè¯­è¨€æœ¬èº«å¯¹åŸå­æ€§ã€å¯è§æ€§ä»¥åŠæœ‰åºæ€§æä¾›äº†å“ªäº›ä¿è¯å‘¢ï¼Ÿ</p> <p><strong>åŸå­æ€§</strong>ï¼š åœ¨Javaä¸­ï¼Œå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡çš„è¯»å–å’Œèµ‹å€¼æ“ä½œæ˜¯åŸå­æ€§æ“ä½œï¼Œå³è¿™äº›æ“ä½œæ˜¯ä¸å¯è¢«ä¸­æ–­çš„ï¼Œè¦ä¹ˆæ‰§è¡Œï¼Œè¦ä¹ˆä¸æ‰§è¡Œã€‚ ä¸Šé¢ä¸€å¥è¯è™½ç„¶çœ‹èµ·æ¥ç®€å•ï¼Œä½†æ˜¯ç†è§£èµ·æ¥å¹¶ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ã€‚çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="c1">// è¯·åˆ†æä»¥ä¸‹å“ªäº›æ“ä½œæ˜¯åŸå­æ€§æ“ä½œ</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="mi">10</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥1</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥2</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="n">x</span><span class="o">++</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥3</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w">&nbsp;</span><span class="mi">1</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥4</span>
</span></code></pre></div> <p>è¯­å¥1æ˜¯ç›´æ¥å°†æ•°å€¼10èµ‹å€¼ç»™xï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹æ‰§è¡Œè¿™ä¸ªè¯­å¥çš„ä¼šç›´æ¥å°†æ•°å€¼10å†™å…¥åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚è¯­å¥2å®é™…ä¸ŠåŒ…å«2ä¸ªæ“ä½œï¼Œå®ƒå…ˆè¦å»è¯»å–xçš„å€¼ï¼Œå†å°†xçš„å€¼å†™å…¥å·¥ä½œå†…å­˜ï¼Œè™½ç„¶è¯»å–xçš„å€¼ä»¥åŠ å°†xçš„å€¼å†™å…¥å·¥ä½œå†…å­˜ è¿™2ä¸ªæ“ä½œéƒ½æ˜¯åŸå­æ€§æ“ä½œï¼Œä½†æ˜¯åˆèµ·æ¥å°±ä¸æ˜¯åŸå­æ€§æ“ä½œäº†ã€‚åŒæ ·çš„ï¼Œx++å’Œ x = x+1åŒ…æ‹¬3ä¸ªæ“ä½œï¼šè¯»å–xçš„å€¼ï¼Œè¿›è¡ŒåŠ 1æ“ä½œï¼Œå†™å…¥æ–°çš„å€¼ã€‚</p> <p>æ‰€ä»¥ä¸Šé¢4ä¸ªè¯­å¥åªæœ‰è¯­å¥1çš„æ“ä½œå…·å¤‡åŸå­æ€§ã€‚</p> <p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰ç®€å•çš„è¯»å–ã€èµ‹å€¼ï¼ˆè€Œä¸”å¿…é¡»æ˜¯å°†æ•°å­—èµ‹å€¼ç»™æŸä¸ªå˜é‡ï¼Œå˜é‡ä¹‹é—´çš„ç›¸äº’èµ‹å€¼ä¸æ˜¯åŸå­æ“ä½œï¼‰æ‰æ˜¯åŸå­æ“ä½œã€‚ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼ŒJavaå†…å­˜æ¨¡å‹åªä¿è¯äº†åŸºæœ¬è¯»å–å’Œèµ‹å€¼æ˜¯åŸå­æ€§æ“ä½œï¼Œå¦‚æœè¦å®ç°æ›´å¤§èŒƒå›´æ“ä½œçš„åŸå­æ€§ï¼Œå¯ä»¥é€šè¿‡ synchronized å’ŒLockæ¥å®ç°ã€‚ç”±äº synchronized å’Œ Lock èƒ½å¤Ÿä¿è¯ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥ä»£ç å—ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¸å­˜åœ¨åŸå­æ€§é—®é¢˜äº†ï¼Œä»è€Œä¿è¯äº†åŸå­æ€§ã€‚</p> <p><strong>å¯è§æ€§</strong>ï¼š å¯¹äºå¯è§æ€§ï¼ŒJavaæä¾›äº†volatileå…³é”®å­—æ¥ä¿è¯å¯è§æ€§ã€‚</p> <p>å½“ä¸€ä¸ªå…±äº«å˜é‡è¢«volatileä¿®é¥°æ—¶ï¼Œå®ƒä¼šä¿è¯ä¿®æ”¹çš„å€¼ä¼šç«‹å³è¢«æ›´æ–°åˆ°ä¸»å­˜ï¼Œå½“æœ‰å…¶ä»–çº¿ç¨‹éœ€è¦è¯»å–æ—¶ï¼Œå®ƒä¼šå»å†…å­˜ä¸­è¯»å–æ–°å€¼ã€‚</p> <p>è€Œæ™®é€šçš„å…±äº«å˜é‡ä¸èƒ½ä¿è¯å¯è§æ€§ï¼Œå› ä¸ºæ™®é€šå…±äº«å˜é‡è¢«ä¿®æ”¹ä¹‹åï¼Œä»€ä¹ˆæ—¶å€™è¢«å†™å…¥ä¸»å­˜æ˜¯ä¸ç¡®å®šçš„ï¼Œå½“å…¶ä»–çº¿ç¨‹å»è¯»å–æ—¶ï¼Œæ­¤æ—¶å†…å­˜ä¸­å¯èƒ½è¿˜æ˜¯åŸæ¥çš„æ—§å€¼ï¼Œå› æ­¤æ— æ³•ä¿è¯å¯è§æ€§ã€‚</p> <p>å¦å¤–ï¼Œé€šè¿‡synchronizedå’ŒLockä¹Ÿèƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼Œsynchronizedå’ŒLockèƒ½ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å–é”ç„¶åæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå¹¶ä¸”åœ¨é‡Šæ”¾é”ä¹‹å‰ä¼šå°†å¯¹å˜é‡çš„ä¿®æ”¹åˆ·æ–°åˆ°ä¸»å­˜å½“ä¸­ã€‚å› æ­¤å¯ä»¥ä¿è¯å¯è§æ€§ã€‚</p> <p><strong>æœ‰åºæ€§</strong>ï¼š åœ¨Javaå†…å­˜æ¨¡å‹ä¸­ï¼Œå…è®¸ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œä½†æ˜¯é‡æ’åºè¿‡ç¨‹ä¸ä¼šå½±å“åˆ°å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œï¼Œå´ä¼šå½±å“åˆ°å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚</p> <p>åœ¨Javaé‡Œé¢ï¼Œå¯ä»¥é€šè¿‡volatileå…³é”®å­—æ¥ä¿è¯ä¸€å®šçš„â€œæœ‰åºæ€§â€ï¼ˆå…·ä½“åŸç†åœ¨ä¸‹ä¸€èŠ‚è®²è¿°ï¼‰ã€‚å¦å¤–å¯ä»¥é€šè¿‡synchronizedå’ŒLockæ¥ä¿è¯æœ‰åºæ€§ï¼Œå¾ˆæ˜¾ç„¶ï¼Œsynchronizedå’ŒLockä¿è¯æ¯ä¸ªæ—¶åˆ»æ˜¯æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œç›¸å½“äºæ˜¯è®©çº¿ç¨‹é¡ºåºæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œè‡ªç„¶å°±ä¿è¯äº†æœ‰åºæ€§ã€‚</p> <p>å¦å¤–ï¼ŒJavaå†…å­˜æ¨¡å‹å…·å¤‡ä¸€äº›å…ˆå¤©çš„â€œæœ‰åºæ€§â€ï¼Œå³ä¸éœ€è¦é€šè¿‡ä»»ä½•æ‰‹æ®µå°±èƒ½å¤Ÿå¾—åˆ°ä¿è¯çš„æœ‰åºæ€§ï¼Œè¿™ä¸ªé€šå¸¸ä¹Ÿç§°ä¸º happens-before åŸåˆ™ã€‚å¦‚æœä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œæ¬¡åºæ— æ³•ä»happens-beforeåŸåˆ™æ¨å¯¼å‡ºæ¥ï¼Œé‚£ä¹ˆå®ƒä»¬å°±ä¸èƒ½ä¿è¯å®ƒä»¬çš„æœ‰åºæ€§ï¼Œè™šæ‹Ÿæœºå¯ä»¥éšæ„åœ°å¯¹å®ƒä»¬è¿›è¡Œé‡æ’åºã€‚</p> <p>Happens-Before è§„åˆ™å¦‚ä¸‹ï¼š</p> <ul> <li>ç¨‹åºæ¬¡åºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åé¢çš„æ“ä½œ</li> <li>é”å®šè§„åˆ™ï¼šä¸€ä¸ªunLockæ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”é¢lockæ“ä½œ</li> <li>volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªå˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œ</li> <li>ä¼ é€’è§„åˆ™ï¼šå¦‚æœæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œBï¼Œè€Œæ“ä½œBåˆå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCï¼Œåˆ™å¯ä»¥å¾—å‡ºæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œC</li> <li>çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼šThreadå¯¹è±¡çš„start()æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸ªä¸€ä¸ªåŠ¨ä½œ</li> <li>çº¿ç¨‹ä¸­æ–­è§„åˆ™ï¼šå¯¹çº¿ç¨‹interrupt()æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿ</li> <li>çº¿ç¨‹ç»ˆç»“è§„åˆ™ï¼šçº¿ç¨‹ä¸­æ‰€æœ‰çš„æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºçº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Thread.join()æ–¹æ³•ç»“æŸã€Thread.isAlive()çš„è¿”å›å€¼æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œ</li> <li>å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆå…ˆè¡Œå‘ç”Ÿäºä»–çš„finalize()æ–¹æ³•çš„å¼€å§‹</li> </ul> <p>è¿™8æ¡è§„åˆ™ä¸­ï¼Œå‰4æ¡è§„åˆ™æ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œå4æ¡è§„åˆ™éƒ½æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚</p> <h3 id="1012æ­»é”">10.12ã€æ­»é”<a class="headerlink" href="#1012æ­»é”" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºç«äº‰èµ„æºæˆ–è€…ç”±äºå½¼æ­¤é€šä¿¡è€Œé€ æˆçš„ä¸€ç§é˜»å¡çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”ï¼Œè¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰å¾…çš„è¿›ç¨‹ç§°ä¸ºæ­»é”è¿›ç¨‹ã€‚æ˜¯æ“ä½œç³»ç»Ÿå±‚é¢çš„ä¸€ä¸ªé”™è¯¯ï¼Œæ˜¯è¿›ç¨‹æ­»é”çš„ç®€ç§°ï¼Œæœ€æ—©åœ¨ 1965 å¹´ç”± Dijkstra åœ¨ç ”ç©¶é“¶è¡Œå®¶ç®—æ³•æ—¶æå‡ºçš„ï¼Œå®ƒæ˜¯è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¹ƒè‡³æ•´ä¸ªå¹¶å‘ç¨‹åºè®¾è®¡é¢†åŸŸæœ€éš¾å¤„ç†çš„é—®é¢˜ä¹‹ä¸€ã€‚</p> <p>æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š</p> <ul> <li>äº’æ–¥æ¡ä»¶ï¼šè¿›ç¨‹å¯¹æ‰€åˆ†é…åˆ°çš„èµ„æºä¸å…è®¸å…¶ä»–è¿›ç¨‹è¿›è¡Œè®¿é—®ï¼Œè‹¥å…¶ä»–è¿›ç¨‹è®¿é—®è¯¥èµ„æºï¼Œåªèƒ½ç­‰å¾…ï¼Œç›´è‡³å æœ‰è¯¥èµ„æºçš„è¿›ç¨‹ä½¿ç”¨å®Œæˆåé‡Šæ”¾è¯¥èµ„æºã€‚</li> <li>è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šè¿›ç¨‹è·å¾—ä¸€å®šçš„èµ„æºä¹‹åï¼Œåˆå¯¹å…¶ä»–èµ„æºå‘å‡ºè¯·æ±‚ï¼Œä½†æ˜¯è¯¥èµ„æºå¯èƒ½è¢«å…¶ä»–è¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚é˜»å¡ï¼Œä½†åˆå¯¹è‡ªå·±è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</li> <li>ä¸å¯å‰¥å¤ºæ¡ä»¶ï¼šæ˜¯æŒ‡è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœªå®Œæˆä½¿ç”¨ä¹‹å‰ï¼Œä¸å¯è¢«å‰¥å¤ºï¼Œåªèƒ½åœ¨ä½¿ç”¨å®Œåè‡ªå·±é‡Šæ”¾ã€‚</li> <li>ç¯è·¯ç­‰å¾…æ¡ä»¶ï¼šæ˜¯æŒ‡è¿›ç¨‹å‘ç”Ÿæ­»é”åï¼Œè‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚</li> </ul> <p>åªè¦æ‰“ç ´å››ä¸ªå¿…è¦æ¡ä»¶ä¹‹ä¸€å°±èƒ½æœ‰æ•ˆé¢„é˜²æ­»é”çš„å‘ç”Ÿï¼š</p> <ul> <li>æ‰“ç ´äº’æ–¥æ¡ä»¶ï¼šæ”¹é€ ç‹¬å æ€§èµ„æºä¸ºè™šæ‹Ÿèµ„æºï¼Œå¤§éƒ¨åˆ†èµ„æºå·²æ— æ³•æ”¹é€ ã€‚</li> <li>æ‰“ç ´ä¸å¯æŠ¢å æ¡ä»¶ï¼šå½“ä¸€è¿›ç¨‹å æœ‰ä¸€ç‹¬å æ€§èµ„æºååˆç”³è¯·ä¸€ç‹¬å æ€§èµ„æºè€Œæ— æ³•æ»¡è¶³ï¼Œåˆ™é€€å‡ºåŸå æœ‰çš„èµ„æºã€‚</li> <li>æ‰“ç ´å æœ‰ä¸”ç”³è¯·æ¡ä»¶ï¼šé‡‡ç”¨èµ„æºé¢„å…ˆåˆ†é…ç­–ç•¥ï¼Œå³è¿›ç¨‹è¿è¡Œå‰ç”³è¯·å…¨éƒ¨èµ„æºï¼Œæ»¡è¶³åˆ™è¿è¡Œï¼Œä¸ç„¶å°±ç­‰å¾…ï¼Œè¿™æ ·å°±ä¸ä¼šå æœ‰ä¸”ç”³è¯·ã€‚</li> <li>æ‰“ç ´å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šå®ç°èµ„æºæœ‰åºåˆ†é…ç­–ç•¥ï¼Œå¯¹æ‰€æœ‰è®¾å¤‡å®ç°åˆ†ç±»ç¼–å·ï¼Œæ‰€æœ‰è¿›ç¨‹åªèƒ½é‡‡ç”¨æŒ‰åºå·é€’å¢çš„å½¢å¼ç”³è¯·èµ„æºã€‚</li> </ul> <p>æ‰€ä»¥ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡ã€è¿›ç¨‹è°ƒåº¦ç­‰æ–¹é¢æ³¨æ„å¦‚ä½•ä¸è®©è¿™å››ä¸ªå¿…è¦æ¡ä»¶æˆç«‹ï¼Œå¦‚ä½•ç¡®å®šèµ„æºçš„åˆç†åˆ†é…ç®—æ³•ï¼Œé¿å…è¿›ç¨‹æ°¸ä¹…å æ®ç³»ç»Ÿèµ„æºã€‚æ­¤å¤–ï¼Œä¹Ÿè¦é˜²æ­¢è¿›ç¨‹åœ¨å¤„äºç­‰å¾…çŠ¶æ€çš„æƒ…å†µä¸‹å ç”¨èµ„æº,åœ¨ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¹è¿›ç¨‹å‘å‡ºçš„æ¯ä¸€ä¸ªç³»ç»Ÿèƒ½å¤Ÿæ»¡è¶³çš„èµ„æºç”³è¯·è¿›è¡ŒåŠ¨æ€æ£€æŸ¥ï¼Œå¹¶æ ¹æ®æ£€æŸ¥ç»“æœå†³å®šæ˜¯å¦åˆ†é…èµ„æºï¼Œè‹¥åˆ†é…åç³»ç»Ÿå¯èƒ½å‘ç”Ÿæ­»é”ï¼Œåˆ™ä¸äºˆåˆ†é…ï¼Œå¦åˆ™äºˆä»¥åˆ†é…ã€‚å› æ­¤ï¼Œå¯¹èµ„æºçš„åˆ†é…è¦ç»™äºˆåˆç†çš„è§„åˆ’ã€‚</p> <h3 id="1013threadlocal">10.13ã€ThreadLocal<a class="headerlink" href="#1013threadlocal" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ThreadLocal æ˜¯çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼Œåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½åˆ›å»ºäº†ä¸€ä¸ª ThreadLocalMap å¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è‡ªå·±å†…éƒ¨ ThreadLocalMap å¯¹è±¡å†…çš„ valueã€‚</p> <p>ç»å…¸çš„ä½¿ç”¨åœºæ™¯æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ª JDBC è¿æ¥ Connectionã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯æ¯ä¸ªçº¿ç¨‹çš„éƒ½åœ¨å„è‡ªçš„ Connection ä¸Šè¿›è¡Œæ•°æ®åº“çš„æ“ä½œï¼Œä¸ä¼šå‡ºç° A çº¿ç¨‹å…³äº† Bçº¿ç¨‹æ­£åœ¨ä½¿ç”¨çš„ Connectionï¼› è¿˜æœ‰ Session ç®¡ç†ç­‰é—®é¢˜ã€‚</p> <p>ThreadLocal ä½¿ç”¨ä¾‹å­ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestThreadLocal</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="w">    </span><span class="c1">//çº¿ç¨‹æœ¬åœ°å­˜å‚¨å˜é‡</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">THREAD_LOCAL_NUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="w">        </span><span class="nd">@Override</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="w">        </span><span class="kd">protected</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">initialValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="c1">//å¯åŠ¨ä¸‰ä¸ªçº¿ç¨‹</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="w">            </span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="w">                </span><span class="nd">@Override</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a><span class="w">                    </span><span class="n">add10ByThreadLocal</span><span class="p">();</span>
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a><span class="w">            </span><span class="n">t</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-87-20"><a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-87-21"><a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a>
</span><span id="__span-87-22"><a id="__codelineno-87-22" name="__codelineno-87-22" href="#__codelineno-87-22"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-87-23"><a id="__codelineno-87-23" name="__codelineno-87-23" href="#__codelineno-87-23"></a><span class="cm">     * çº¿ç¨‹æœ¬åœ°å­˜å‚¨å˜é‡åŠ  5</span>
</span><span id="__span-87-24"><a id="__codelineno-87-24" name="__codelineno-87-24" href="#__codelineno-87-24"></a><span class="cm">     */</span>
</span><span id="__span-87-25"><a id="__codelineno-87-25" name="__codelineno-87-25" href="#__codelineno-87-25"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">add10ByThreadLocal</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-26"><a id="__codelineno-87-26" name="__codelineno-87-26" href="#__codelineno-87-26"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-27"><a id="__codelineno-87-27" name="__codelineno-87-27" href="#__codelineno-87-27"></a><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">THREAD_LOCAL_NUM</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
</span><span id="__span-87-28"><a id="__codelineno-87-28" name="__codelineno-87-28" href="#__codelineno-87-28"></a><span class="w">            </span><span class="n">n</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-87-29"><a id="__codelineno-87-29" name="__codelineno-87-29" href="#__codelineno-87-29"></a><span class="w">            </span><span class="n">THREAD_LOCAL_NUM</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
</span><span id="__span-87-30"><a id="__codelineno-87-30" name="__codelineno-87-30" href="#__codelineno-87-30"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" : ThreadLocal num="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
</span><span id="__span-87-31"><a id="__codelineno-87-31" name="__codelineno-87-31" href="#__codelineno-87-31"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-87-32"><a id="__codelineno-87-32" name="__codelineno-87-32" href="#__codelineno-87-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-87-33"><a id="__codelineno-87-33" name="__codelineno-87-33" href="#__codelineno-87-33"></a><span class="p">}</span>
</span></code></pre></div> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>Thread-0 : ThreadLocal num=1
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>Thread-1 : ThreadLocal num=1
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>Thread-0 : ThreadLocal num=2
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>Thread-0 : ThreadLocal num=3
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>Thread-1 : ThreadLocal num=2
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>Thread-2 : ThreadLocal num=1
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a>Thread-0 : ThreadLocal num=4
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a>Thread-2 : ThreadLocal num=2
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>Thread-1 : ThreadLocal num=3
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a>Thread-1 : ThreadLocal num=4
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a>Thread-2 : ThreadLocal num=3
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a>Thread-0 : ThreadLocal num=5
</span><span id="__span-88-13"><a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a>Thread-2 : ThreadLocal num=4
</span><span id="__span-88-14"><a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a>Thread-2 : ThreadLocal num=5
</span><span id="__span-88-15"><a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a>Thread-1 : ThreadLocal num=5
</span></code></pre></div> <p>å¯åŠ¨äº† 3 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æœ€åéƒ½æ‰“å°åˆ° "ThreadLocal num=5"ï¼Œè€Œä¸æ˜¯ num ä¸€ç›´åœ¨ç´¯åŠ ç›´åˆ°å€¼ç­‰äº 15ã€‚</p> <hr> <p><strong>å®ç°åŸç†ï¼š</strong></p> <p>æŒ‰ç…§æˆ‘ä»¬ç¬¬ä¸€ç›´è§‰ï¼Œæ„Ÿè§‰ ThreadLocal å†…éƒ¨è‚¯å®šæ˜¯æœ‰ä¸ª Map ç»“æ„ï¼Œkey å­˜äº† Threadï¼Œvalue å­˜äº† æœ¬åœ°å˜é‡ V çš„å€¼ã€‚æ¯æ¬¡é€šè¿‡ ThreadLocal å¯¹è±¡çš„ get() å’Œ set(T value) æ–¹æ³•è·å–å½“å‰çº¿ç¨‹é‡Œå­˜çš„æœ¬åœ°å˜é‡ã€è®¾ç½®å½“å‰çº¿ç¨‹é‡Œçš„æœ¬åœ°å˜é‡ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/20190523105529871-162821864050610.png" data-desc-position="bottom"><img src="!assets/Java/20190523105529871-162821864050610.png" alt="img" style></a></p> <p>è€Œ JDK çš„å®ç°é‡Œé¢è¿™ä¸ª Map æ˜¯å±äº Threadï¼Œè€Œéå±äº ThreadLocalã€‚ThreadLocal ä»…æ˜¯ä¸€ä¸ªä»£ç†å·¥å…·ç±»ï¼Œå†…éƒ¨å¹¶ä¸æŒæœ‰ä»»ä½•ä¸çº¿ç¨‹ç›¸å…³çš„æ•°æ®ï¼Œæ‰€æœ‰å’Œçº¿ç¨‹ç›¸å…³çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ Thread é‡Œé¢ã€‚ThreadLocalMap å±äº Thread ä¹Ÿæ›´åŠ åˆç†ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21laXNtNQ==,size_16,color_FFFFFF,t_70" data-desc-position="bottom"><img src="!assets/Java/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21laXNtNQ==,size_16,color_FFFFFF,t_70" alt="img" style></a></p> <p>è¿˜æœ‰ä¸€ä¸ªæ›´åŠ æ·±å±‚æ¬¡çš„åŸå› ï¼Œè¿™æ ·è®¾è®¡ä¸å®¹æ˜“äº§ç”Ÿå†…å­˜æ³„éœ²ã€‚</p> <p>ThreadLocal æŒæœ‰çš„ Map ä¼šæŒæœ‰ Thread å¯¹è±¡çš„å¼•ç”¨ï¼Œåªè¦ ThreadLocal å¯¹è±¡å­˜åœ¨ï¼Œé‚£ä¹ˆ Map ä¸­çš„ Thread å¯¹è±¡å°±æ°¸è¿œä¸ä¼šè¢«å›æ”¶ã€‚ThreadLocal çš„ç”Ÿå‘½å‘¨æœŸå¾€å¾€æ¯”çº¿ç¨‹è¦é•¿ï¼Œæ‰€ä»¥è¿™ç§è®¾è®¡æ–¹æ¡ˆå¾ˆå®¹æ˜“å¯¼è‡´å†…å­˜æ³„éœ²ã€‚</p> <p>JDK çš„å®ç°ä¸­ Thread æŒæœ‰ ThreadLocalMapï¼Œè€Œä¸” ThreadLocalMap é‡Œå¯¹ ThreadLocal çš„å¼•ç”¨è¿˜æ˜¯å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ï¼Œæ‰€ä»¥åªè¦ Thread å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼Œé‚£ä¹ˆ ThreadLocalMap å°±èƒ½è¢«å›æ”¶ã€‚JDK çš„è¿™ç§å®ç°æ–¹æ¡ˆå¤æ‚ä½†æ›´å®‰å…¨ã€‚</p> <hr> <p><strong>åœ¨çº¿ç¨‹æ± ä¸­ä½¿ç”¨ ThreadLocal ä¸ºä»€ä¹ˆå¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²å‘¢ï¼Ÿ</strong></p> <p>åœ¨çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„å­˜æ´»æ—¶é—´å¤ªé•¿ï¼Œå¾€å¾€éƒ½æ˜¯å’Œç¨‹åºåŒç”Ÿå…±æ­»çš„ï¼Œè¿™æ · Thread æŒæœ‰çš„ ThreadLocalMap ä¸€ç›´éƒ½ä¸ä¼šè¢«å›æ”¶ï¼Œå†åŠ ä¸Š ThreadLocalMap ä¸­çš„ Entry å¯¹ ThreadLocal æ˜¯å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ï¼Œæ‰€ä»¥åªè¦ ThreadLocal ç»“æŸäº†è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å¯ä»¥è¢«å›æ”¶æ‰çš„ã€‚</p> <p>Entry ä¸­çš„ Value æ˜¯è¢« Entry å¼ºå¼•ç”¨çš„ï¼Œå³ä¾¿ value çš„ç”Ÿå‘½å‘¨æœŸç»“æŸäº†ï¼Œvalue ä¹Ÿæ˜¯æ— æ³•è¢«å›æ”¶çš„ï¼Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚</p> <hr> <p><strong>çº¿ç¨‹æ± ä¸­ï¼Œå¦‚ä½•æ­£ç¡®ä½¿ç”¨ ThreadLocalï¼Ÿ</strong></p> <p>åœ¨ finally ä»£ç å—ä¸­æ‰‹åŠ¨æ¸…ç† ThreadLocal ä¸­çš„ valueï¼Œè°ƒç”¨ ThreadLocal çš„ remove()æ–¹æ³•ã€‚</p> <hr> <p><strong>ThreadLocal æ ¸å¿ƒæ–¹æ³•</strong></p> <ul> <li> <p>è®¾ç½® Thread å¯¹åº”çš„ Value å€¼ï¼Œé¦–æ¬¡ä¼šåˆ›å»ºä¸€ä¸ª ThreadLocalMap ï¼Œæ·»åŠ  ThreadLocal - Value åˆ° ThreadLocalMap ä¸­ï¼Œå¹¶ä¸”ç»‘å®š ThreadLocalMap åˆ°å½“å‰çº¿ç¨‹ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="w">    </span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">();</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="w">    </span><span class="n">ThreadLocalMap</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getMap</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">map</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="w">        </span><span class="n">createMap</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p>åˆ›å»º ThreadLocalMapï¼Œç»‘å®šåˆ°å½“å‰çº¿ç¨‹ã€‚ </p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">createMap</span><span class="p">(</span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">firstValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="na">threadLocals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadLocalMap</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">firstValue</span><span class="p">);</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p>é€šè¿‡ ThreadLocalMap è·å–å½“å‰çº¿ç¨‹çš„å­˜å‚¨çš„ Value å€¼ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">    </span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">();</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">    </span><span class="n">ThreadLocalMap</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getMap</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">map</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="w">        </span><span class="n">ThreadLocalMap</span><span class="p">.</span><span class="na">Entry</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">.</span><span class="na">getEntry</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="w">            </span><span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">"unchecked"</span><span class="p">)</span>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="w">            </span><span class="n">T</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">e</span><span class="p">.</span><span class="na">value</span><span class="p">;</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-91-12"><a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">setInitialValue</span><span class="p">();</span>
</span><span id="__span-91-13"><a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p>è®¾ç½® ThreadLocal çš„åˆå§‹åŒ–å€¼ï¼Œæœª set(T value) åˆæ¬¡è·å– Thread å¯¹åº”çš„ Value å€¼æ—¶ä¼šè°ƒç”¨ï¼Œå³è¢« setInitialValue æ–¹æ³•è°ƒç”¨ã€‚éœ€è¦é‡å†™è¯¥æ–¹æ³•ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="kd">protected</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">initialValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p>ç§»é™¤å½“å‰çº¿ç¨‹å­˜å‚¨çš„ Value å€¼ã€‚å½“ ThreadLocal ä¸åœ¨ä½¿ç”¨ï¼Œæœ€å¥½åœ¨ finally è¯­å¥å—ä¸­ï¼Œè°ƒç”¨ remove() æ–¹æ³•ï¼Œé‡Šæ”¾å» Value çš„å¼•ç”¨ï¼Œé¿å…å†…å­˜æ³„éœ²ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">remove</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="w">    </span><span class="n">ThreadLocalMap</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getMap</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">());</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">        </span><span class="n">m</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="p">}</span>
</span></code></pre></div> </li> </ul> <h3 id="1014volatile">10.14ã€volatile<a class="headerlink" href="#1014volatile" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>volatile å…³é”®å­—çš„ä¸¤å±‚è¯­ä¹‰</strong></p> <p>ä¸€æ—¦ä¸€ä¸ªå…±äº«å˜é‡ï¼ˆç±»çš„æˆå‘˜å˜é‡ã€ç±»çš„é™æ€æˆå‘˜å˜é‡ï¼‰è¢« volatile ä¿®é¥°ä¹‹åï¼Œé‚£ä¹ˆå°±å…·å¤‡äº†ä¸¤å±‚è¯­ä¹‰ï¼š</p> <ul> <li>ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„ã€‚</li> <li>ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åºã€‚</li> </ul> <p>å…ˆçœ‹ä¸€æ®µä»£ç ï¼Œå‡å¦‚çº¿ç¨‹1å…ˆæ‰§è¡Œï¼Œçº¿ç¨‹2åæ‰§è¡Œï¼š</p> <div class="language-JAVA highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="c1">//çº¿ç¨‹1</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="kt">boolean</span><span class="w">&nbsp;</span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">stop</span><span class="p">){</span>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="n">doSomething</span><span class="p">();</span>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="p">}</span>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="c1">//çº¿ç¨‹2</span>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="kc">true</span><span class="p">;</span>
</span></code></pre></div> <p>ä¹Ÿè®¸åœ¨å¤§å¤šæ•°æ—¶å€™ï¼Œè¿™æ®µä»£ç èƒ½å¤ŸæŠŠçº¿ç¨‹ä¸­æ–­ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½ä¼šå¯¼è‡´æ— æ³•ä¸­æ–­çº¿ç¨‹ï¼ˆè™½ç„¶è¿™ä¸ªå¯èƒ½æ€§å¾ˆå°ï¼Œä½†æ˜¯åªè¦ä¸€æ—¦å‘ç”Ÿè¿™ç§æƒ…å†µå°±ä¼šé€ æˆæ­»å¾ªç¯äº†ï¼‰ã€‚</p> <p>æ¯ä¸ªçº¿ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œé‚£ä¹ˆçº¿ç¨‹ 1 åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œä¼šå°† stop å˜é‡çš„å€¼æ‹·è´ä¸€ä»½æ”¾åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜å½“ä¸­ã€‚é‚£ä¹ˆå½“çº¿ç¨‹ 2 æ›´æ”¹äº†stop å˜é‡çš„å€¼ä¹‹åï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠå†™å…¥ä¸»å­˜å½“ä¸­ï¼Œçº¿ç¨‹ 2 è½¬å»åšå…¶ä»–äº‹æƒ…äº†ï¼Œé‚£ä¹ˆçº¿ç¨‹ 1 ç”±äºä¸çŸ¥é“çº¿ç¨‹ 2 å¯¹ stop å˜é‡çš„æ›´æ”¹ï¼Œå› æ­¤è¿˜ä¼šä¸€ç›´å¾ªç¯ä¸‹å»ã€‚</p> <p>ä½†æ˜¯ç”¨ volatile ä¿®é¥°ä¹‹åå°±å˜å¾—ä¸ä¸€æ ·äº†ï¼š</p> <ul> <li>ä½¿ç”¨ volatile å…³é”®å­—ä¼šå¼ºåˆ¶å°†ä¿®æ”¹çš„å€¼ç«‹å³å†™å…¥ä¸»å­˜ï¼›</li> <li>ä½¿ç”¨ volatile å…³é”®å­—çš„è¯ï¼Œå½“çº¿ç¨‹ 2 è¿›è¡Œä¿®æ”¹æ—¶ï¼ˆå½“ç„¶è¿™é‡ŒåŒ…æ‹¬ 2 ä¸ªæ“ä½œï¼Œä¿®æ”¹çº¿ç¨‹ 2 å·¥ä½œå†…å­˜ä¸­çš„å€¼ï¼Œç„¶åå°†ä¿®æ”¹åçš„å€¼å†™å…¥å†…å­˜ï¼‰ï¼Œä¼šå¯¼è‡´çº¿ç¨‹ 1 çš„å·¥ä½œå†…å­˜ä¸­ç¼“å­˜å˜é‡ stop çš„ç¼“å­˜è¡Œæ— æ•ˆï¼ˆåæ˜ åˆ°ç¡¬ä»¶å±‚çš„è¯ï¼Œå°±æ˜¯ CPU çš„ L1 æˆ–è€… L2 ç¼“å­˜ä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆï¼‰ï¼›</li> <li>ç”±äºçº¿ç¨‹ 1 çš„å·¥ä½œå†…å­˜ä¸­ç¼“å­˜å˜é‡ stop çš„ç¼“å­˜è¡Œæ— æ•ˆï¼Œæ‰€ä»¥çº¿ç¨‹ 1 å†æ¬¡è¯»å–å˜é‡ stop çš„å€¼æ—¶ä¼šå»ä¸»å­˜è¯»å–ã€‚</li> </ul> <p>é‚£ä¹ˆçº¿ç¨‹ 1 è¯»å–åˆ°çš„å°±æ˜¯æœ€æ–°çš„æ­£ç¡®çš„å€¼ã€‚</p> <hr> <p><strong>volatileä¿è¯åŸå­æ€§å—ï¼Ÿ</strong></p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="kd">public</span><span class="w">&nbsp;</span><span class="kd">class</span>&nbsp;<span class="nc">Test</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kd">public</span><span class="w">&nbsp;</span><span class="kd">volatile</span><span class="w">&nbsp;</span><span class="kt">int</span><span class="w">&nbsp;</span><span class="n">inc</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kd">public</span><span class="w">&nbsp;</span><span class="kt">void</span><span class="w">&nbsp;</span><span class="nf">increase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="n">inc</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p">}</span>
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a>
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kd">public</span><span class="w">&nbsp;</span><span class="kd">static</span><span class="w">&nbsp;</span><span class="kt">void</span><span class="w">&nbsp;</span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kd">final</span><span class="w">&nbsp;</span><span class="n">Test</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="k">new</span><span class="w">&nbsp;</span><span class="n">Test</span><span class="p">();</span><span class="w"> </span>
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w">&nbsp;</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-95-11"><a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="k">new</span><span class="w">&nbsp;</span><span class="n">Thread</span><span class="p">(){</span>
</span><span id="__span-95-12"><a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kd">public</span><span class="w">&nbsp;</span><span class="kt">void</span><span class="w">&nbsp;</span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-13"><a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w">&nbsp;</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">1000</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-95-14"><a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="n">test</span><span class="p">.</span><span class="na">increase</span><span class="p">();</span>
</span><span id="__span-95-15"><a id="__codelineno-95-15" name="__codelineno-95-15" href="#__codelineno-95-15"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p">};</span><span class="w"> </span>
</span><span id="__span-95-16"><a id="__codelineno-95-16" name="__codelineno-95-16" href="#__codelineno-95-16"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p">}.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-95-17"><a id="__codelineno-95-17" name="__codelineno-95-17" href="#__codelineno-95-17"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p">}</span>
</span><span id="__span-95-18"><a id="__codelineno-95-18" name="__codelineno-95-18" href="#__codelineno-95-18"></a>
</span><span id="__span-95-19"><a id="__codelineno-95-19" name="__codelineno-95-19" href="#__codelineno-95-19"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="k">while</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">activeCount</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span><span class="w">&nbsp;&nbsp;</span><span class="c1">//ä¿è¯å‰é¢çš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œ</span>
</span><span id="__span-95-20"><a id="__codelineno-95-20" name="__codelineno-95-20" href="#__codelineno-95-20"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="n">Thread</span><span class="p">.</span><span class="na">yield</span><span class="p">();</span>
</span><span id="__span-95-21"><a id="__codelineno-95-21" name="__codelineno-95-21" href="#__codelineno-95-21"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">test</span><span class="p">.</span><span class="na">inc</span><span class="p">);</span>
</span><span id="__span-95-22"><a id="__codelineno-95-22" name="__codelineno-95-22" href="#__codelineno-95-22"></a><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p">}</span>
</span><span id="__span-95-23"><a id="__codelineno-95-23" name="__codelineno-95-23" href="#__codelineno-95-23"></a><span class="p">}</span>
</span></code></pre></div> <p>å¤§å®¶æƒ³ä¸€ä¸‹è¿™æ®µç¨‹åºçš„è¾“å‡ºç»“æœæ˜¯å¤šå°‘ï¼Ÿä¹Ÿè®¸æœ‰äº›æœ‹å‹è®¤ä¸ºæ˜¯ 10000ã€‚ä½†æ˜¯äº‹å®ä¸Šè¿è¡Œå®ƒä¼šå‘ç°æ¯æ¬¡è¿è¡Œç»“æœéƒ½ä¸ä¸€è‡´ï¼Œéƒ½æ˜¯ä¸€ä¸ªå°äº 10000 çš„æ•°ã€‚</p> <p>å¯èƒ½æœ‰çš„æœ‹å‹å°±ä¼šæœ‰ç–‘é—®ï¼Œä¸å¯¹å•Šï¼Œä¸Šé¢æ˜¯å¯¹å˜é‡ inc è¿›è¡Œè‡ªå¢æ“ä½œï¼Œç”±äº volatile ä¿è¯äº†å¯è§æ€§ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹ inc è‡ªå¢å®Œä¹‹åï¼Œåœ¨å…¶ä»–çº¿ç¨‹ä¸­éƒ½èƒ½çœ‹åˆ°ä¿®æ”¹åçš„å€¼å•Šï¼Œæ‰€ä»¥æœ‰ 10 ä¸ªçº¿ç¨‹åˆ†åˆ«è¿›è¡Œäº† 1000 æ¬¡æ“ä½œï¼Œé‚£ä¹ˆæœ€ç»ˆ inc çš„å€¼åº”è¯¥æ˜¯ 1000 * 10 = 10000ã€‚</p> <p>è¿™é‡Œé¢å°±æœ‰ä¸€ä¸ªè¯¯åŒºäº†ï¼Œvolatile å…³é”®å­—èƒ½ä¿è¯å¯è§æ€§æ²¡æœ‰é”™ï¼Œä½†æ˜¯ä¸Šé¢çš„ç¨‹åºé”™åœ¨æ²¡èƒ½ä¿è¯åŸå­æ€§ã€‚å¯è§æ€§åªèƒ½ä¿è¯æ¯æ¬¡è¯»å–çš„æ˜¯æœ€æ–°çš„å€¼ï¼Œä½†æ˜¯volatile æ²¡åŠæ³•ä¿è¯å¯¹å˜é‡çš„æ“ä½œçš„åŸå­æ€§ã€‚</p> <p>åœ¨å‰é¢å·²ç»æåˆ°è¿‡ï¼Œè‡ªå¢æ“ä½œæ˜¯ä¸å…·å¤‡åŸå­æ€§çš„ï¼Œå®ƒåŒ…æ‹¬è¯»å–å˜é‡çš„åŸå§‹å€¼ã€è¿›è¡ŒåŠ  1 æ“ä½œã€å†™å…¥å·¥ä½œå†…å­˜ã€‚é‚£ä¹ˆå°±æ˜¯è¯´è‡ªå¢æ“ä½œçš„ä¸‰ä¸ªå­æ“ä½œå¯èƒ½ä¼šåˆ†å‰²å¼€æ‰§è¡Œï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´ä¸‹é¢è¿™ç§æƒ…å†µå‡ºç°ï¼šå‡å¦‚æŸä¸ªæ—¶åˆ»å˜é‡ inc çš„å€¼ä¸º 10ï¼Œçº¿ç¨‹ 1 å¯¹å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œï¼Œçº¿ç¨‹ 1 å…ˆè¯»å–äº†å˜é‡ inc çš„åŸå§‹å€¼ï¼Œç„¶åçº¿ç¨‹ 1 è¢«é˜»å¡äº†ï¼›ç„¶åçº¿ç¨‹ 2 å¯¹å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œï¼Œçº¿ç¨‹ 2 ä¹Ÿå»è¯»å–å˜é‡ inc çš„åŸå§‹å€¼ï¼Œç”±äºçº¿ç¨‹ 1 åªæ˜¯å¯¹å˜é‡ inc è¿›è¡Œè¯»å–æ“ä½œï¼Œè€Œæ²¡æœ‰å¯¹å˜é‡è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥ä¸ä¼šå¯¼è‡´çº¿ç¨‹ 2 çš„å·¥ä½œå†…å­˜ä¸­ç¼“å­˜å˜é‡ inc çš„ç¼“å­˜è¡Œæ— æ•ˆï¼Œæ‰€ä»¥çº¿ç¨‹ 2 ä¼šç›´æ¥å»ä¸»å­˜è¯»å– inc çš„å€¼ï¼Œå‘ç° inc çš„å€¼æ—¶ 10ï¼Œç„¶åè¿›è¡ŒåŠ  1 æ“ä½œï¼Œå¹¶æŠŠ 11 å†™å…¥å·¥ä½œå†…å­˜ï¼Œæœ€åå†™å…¥ä¸»å­˜ã€‚ç„¶åçº¿ç¨‹ 1 æ¥ç€è¿›è¡ŒåŠ  1 æ“ä½œï¼Œç”±äºå·²ç»è¯»å–äº† inc çš„å€¼ï¼Œæ³¨æ„æ­¤æ—¶åœ¨çº¿ç¨‹ 1 çš„å·¥ä½œå†…å­˜ä¸­ inc çš„å€¼ä»ç„¶ä¸º 10ï¼Œæ‰€ä»¥çº¿ç¨‹ 1 å¯¹ inc è¿›è¡ŒåŠ  1 æ“ä½œå inc çš„å€¼ä¸º 11ï¼Œç„¶åå°† 11 å†™å…¥å·¥ä½œå†…å­˜ï¼Œæœ€åå†™å…¥ä¸»å­˜ã€‚é‚£ä¹ˆä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è¿›è¡Œäº†ä¸€æ¬¡è‡ªå¢æ“ä½œåï¼Œinc åªå¢åŠ äº† 1ã€‚</p> <p>è§£é‡Šåˆ°è¿™é‡Œï¼Œå¯èƒ½æœ‰æœ‹å‹ä¼šæœ‰ç–‘é—®ï¼Œä¸å¯¹å•Šï¼Œå‰é¢ä¸æ˜¯ä¿è¯ä¸€ä¸ªå˜é‡åœ¨ä¿®æ”¹volatileå˜é‡æ—¶ï¼Œä¼šè®©ç¼“å­˜è¡Œæ— æ•ˆå—ï¼Ÿç„¶åå…¶ä»–çº¿ç¨‹å»è¯»å°±ä¼šè¯»åˆ°æ–°çš„å€¼ï¼Œå¯¹ï¼Œè¿™ä¸ªæ²¡é”™ã€‚è¿™ä¸ªå°±æ˜¯ä¸Šé¢çš„happens-beforeè§„åˆ™ä¸­çš„volatileå˜é‡è§„åˆ™ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œçº¿ç¨‹1å¯¹å˜é‡è¿›è¡Œè¯»å–æ“ä½œä¹‹åï¼Œè¢«é˜»å¡äº†çš„è¯ï¼Œå¹¶æ²¡æœ‰å¯¹incå€¼è¿›è¡Œä¿®æ”¹ã€‚ç„¶åè™½ç„¶volatileèƒ½ä¿è¯çº¿ç¨‹2å¯¹å˜é‡incçš„å€¼è¯»å–æ˜¯ä»å†…å­˜ä¸­è¯»å–çš„ï¼Œä½†æ˜¯çº¿ç¨‹1æ²¡æœ‰è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥çº¿ç¨‹2æ ¹æœ¬å°±ä¸ä¼šçœ‹åˆ°ä¿®æ”¹çš„å€¼ã€‚æ ¹æºå°±åœ¨è¿™é‡Œï¼Œè‡ªå¢æ“ä½œä¸æ˜¯åŸå­æ€§æ“ä½œï¼Œè€Œä¸”volatileä¹Ÿæ— æ³•ä¿è¯å¯¹å˜é‡çš„ä»»ä½•æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚</p> <p>åœ¨java 1.5çš„java.util.concurrent.atomicåŒ…ä¸‹æä¾›äº†ä¸€äº›åŸå­æ“ä½œç±»ï¼Œå³å¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„è‡ªå¢ï¼ˆåŠ 1æ“ä½œï¼‰ï¼Œè‡ªå‡ï¼ˆå‡1æ“ä½œï¼‰ã€ä»¥åŠåŠ æ³•æ“ä½œï¼ˆåŠ ä¸€ä¸ªæ•°ï¼‰ï¼Œå‡æ³•æ“ä½œï¼ˆå‡ä¸€ä¸ªæ•°ï¼‰è¿›è¡Œäº†å°è£…ï¼Œä¿è¯è¿™äº›æ“ä½œæ˜¯åŸå­æ€§æ“ä½œã€‚atomicæ˜¯åˆ©ç”¨CASæ¥å®ç°åŸå­æ€§æ“ä½œçš„ï¼ˆCompare And Swapï¼‰ï¼ŒCASå®é™…ä¸Šæ˜¯åˆ©ç”¨å¤„ç†å™¨æä¾›çš„CMPXCHGæŒ‡ä»¤å®ç°çš„ï¼Œè€Œå¤„ç†å™¨æ‰§è¡ŒCMPXCHGæŒ‡ä»¤æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œã€‚</p> <hr> <p><strong>volatileèƒ½ä¿è¯æœ‰åºæ€§å—ï¼Ÿ</strong></p> <p>åœ¨å‰é¢æåˆ°volatileå…³é”®å­—èƒ½ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œæ‰€ä»¥volatileèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿è¯æœ‰åºæ€§ã€‚</p> <p>volatileå…³é”®å­—ç¦æ­¢æŒ‡ä»¤é‡æ’åºæœ‰ä¸¤å±‚æ„æ€ï¼š</p> <ul> <li>å½“ç¨‹åºæ‰§è¡Œåˆ°volatileå˜é‡çš„è¯»æ“ä½œæˆ–è€…å†™æ“ä½œæ—¶ï¼Œåœ¨å…¶å‰é¢çš„æ“ä½œçš„æ›´æ”¹è‚¯å®šå…¨éƒ¨å·²ç»è¿›è¡Œï¼Œä¸”ç»“æœå·²ç»å¯¹åé¢çš„æ“ä½œå¯è§ï¼›åœ¨å…¶åé¢çš„æ“ä½œè‚¯å®šè¿˜æ²¡æœ‰è¿›è¡Œï¼›</li> <li>åœ¨è¿›è¡ŒæŒ‡ä»¤ä¼˜åŒ–æ—¶ï¼Œä¸èƒ½å°†åœ¨å¯¹volatileå˜é‡è®¿é—®çš„è¯­å¥æ”¾åœ¨å…¶åé¢æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½æŠŠvolatileå˜é‡åé¢çš„è¯­å¥æ”¾åˆ°å…¶å‰é¢æ‰§è¡Œã€‚</li> </ul> <p>å¯èƒ½ä¸Šé¢è¯´çš„æ¯”è¾ƒç»•ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="c1">//xã€yä¸ºévolatileå˜é‡</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="c1">//flagä¸ºvolatileå˜é‡</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="mi">2</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥1</span>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="mi">0</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥2</span>
</span><span id="__span-96-5"><a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="kc">true</span><span class="p">;</span><span class="w">&nbsp;&nbsp;</span><span class="c1">//è¯­å¥3</span>
</span><span id="__span-96-6"><a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="mi">4</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥4</span>
</span><span id="__span-96-7"><a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥5</span>
</span></code></pre></div> <p>ç”±äº flag å˜é‡ä¸º volatile å˜é‡ï¼Œé‚£ä¹ˆåœ¨è¿›è¡ŒæŒ‡ä»¤é‡æ’åºçš„è¿‡ç¨‹çš„æ—¶å€™ï¼Œä¸ä¼šå°†è¯­å¥3æ”¾åˆ°è¯­å¥1ã€è¯­å¥2å‰é¢ï¼Œä¹Ÿä¸ä¼šè®²è¯­å¥3æ”¾åˆ°è¯­å¥4ã€è¯­å¥5åé¢ã€‚ä½†æ˜¯è¦æ³¨æ„è¯­å¥1å’Œè¯­å¥2çš„é¡ºåºã€è¯­å¥4å’Œè¯­å¥5çš„é¡ºåºæ˜¯ä¸ä½œä»»ä½•ä¿è¯çš„ã€‚å¹¶ä¸”volatileå…³é”®å­—èƒ½ä¿è¯ï¼Œæ‰§è¡Œåˆ°è¯­å¥3æ—¶ï¼Œè¯­å¥1å’Œè¯­å¥2å¿…å®šæ˜¯æ‰§è¡Œå®Œæ¯•äº†çš„ï¼Œä¸”è¯­å¥1å’Œè¯­å¥2çš„æ‰§è¡Œç»“æœå¯¹è¯­å¥3ã€è¯­å¥4ã€è¯­å¥5æ˜¯å¯è§çš„ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="c1">//çº¿ç¨‹1:</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadContext</span><span class="p">();</span><span class="w">&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥1</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="n">inited</span><span class="w"> </span><span class="o">=</span><span class="w">&nbsp;</span><span class="kc">true</span><span class="p">;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">//è¯­å¥2</span>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="c1">//çº¿ç¨‹2:</span>
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">inited</span><span class="w"> </span><span class="p">){</span>
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="w">&nbsp;&nbsp;</span><span class="n">sleep</span><span class="p">()</span>
</span><span id="__span-97-8"><a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="p">}</span>
</span><span id="__span-97-9"><a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="n">doSomethingwithconfig</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span></code></pre></div> <p>å‰é¢ä¸¾è¿™ä¸ªä¾‹å­çš„æ—¶å€™ï¼Œæåˆ°æœ‰å¯èƒ½è¯­å¥2ä¼šåœ¨è¯­å¥1ä¹‹å‰æ‰§è¡Œï¼Œé‚£ä¹ˆä¹…å¯èƒ½å¯¼è‡´contextè¿˜æ²¡è¢«åˆå§‹åŒ–ï¼Œè€Œçº¿ç¨‹2ä¸­å°±ä½¿ç”¨æœªåˆå§‹åŒ–çš„contextå»è¿›è¡Œæ“ä½œï¼Œå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚è¿™é‡Œå¦‚æœç”¨volatileå…³é”®å­—å¯¹initedå˜é‡è¿›è¡Œä¿®é¥°ï¼Œå°±ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜äº†ï¼Œå› ä¸ºå½“æ‰§è¡Œåˆ°è¯­å¥2æ—¶ï¼Œå¿…å®šèƒ½ä¿è¯contextå·²ç»åˆå§‹åŒ–å®Œæ¯•ã€‚</p> <hr> <p><strong>volatile çš„åŸç†å’Œå®ç°æœºåˆ¶</strong></p> <p>å‰é¢è®²è¿°äº†æºäº volatile å…³é”®å­—çš„ä¸€äº›ä½¿ç”¨ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æ¢è®¨ä¸€ä¸‹ volatile åˆ°åº•å¦‚ä½•ä¿è¯å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åºçš„ã€‚</p> <p>ä¸‹é¢è¿™æ®µè¯æ‘˜è‡ªã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ï¼š</p> <p>â€œè§‚å¯ŸåŠ å…¥ volatile å…³é”®å­—å’Œæ²¡æœ‰åŠ å…¥ volatile å…³é”®å­—æ—¶æ‰€ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å‘ç°ï¼ŒåŠ å…¥ volatile å…³é”®å­—æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ª lock å‰ç¼€æŒ‡ä»¤â€</p> <p>lock å‰ç¼€æŒ‡ä»¤å®é™…ä¸Šç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœï¼ˆä¹Ÿæˆå†…å­˜æ …æ ï¼‰ï¼Œå†…å­˜å±éšœä¼šæä¾› 3 ä¸ªåŠŸèƒ½ï¼š</p> <ul> <li>å®ƒç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ä¸ä¼šæŠŠå…¶åé¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼Œä¹Ÿä¸ä¼šæŠŠå‰é¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœçš„åé¢ï¼›å³åœ¨æ‰§è¡Œåˆ°å†…å­˜å±éšœè¿™å¥æŒ‡ä»¤æ—¶ï¼Œåœ¨å®ƒå‰é¢çš„æ“ä½œå·²ç»å…¨éƒ¨å®Œæˆï¼›</li> <li>å®ƒä¼šå¼ºåˆ¶å°†å¯¹ç¼“å­˜çš„ä¿®æ”¹æ“ä½œç«‹å³å†™å…¥ä¸»å­˜ï¼›</li> <li>å¦‚æœæ˜¯å†™æ“ä½œï¼Œå®ƒä¼šå¯¼è‡´å…¶ä»– CPU ä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆã€‚</li> </ul> <hr> <p><strong>ä½¿ç”¨ volatile å…³é”®å­—çš„åœºæ™¯</strong></p> <p>synchronized å…³é”®å­—æ˜¯é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œä¸€æ®µä»£ç ï¼Œé‚£ä¹ˆå°±ä¼šå¾ˆå½±å“ç¨‹åºæ‰§è¡Œæ•ˆç‡ï¼Œè€Œ volatile å…³é”®å­—åœ¨æŸäº›æƒ…å†µä¸‹æ€§èƒ½è¦ä¼˜äº synchronizedï¼Œä½†æ˜¯è¦æ³¨æ„ volatile å…³é”®å­—æ˜¯æ— æ³•æ›¿ä»£ synchronized å…³é”®å­—çš„ï¼Œå› ä¸º volatile å…³é”®å­—æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚é€šå¸¸æ¥è¯´ï¼Œä½¿ç”¨ volatile å¿…é¡»å…·å¤‡ä»¥ä¸‹ 2ä¸ªæ¡ä»¶ï¼š</p> <ul> <li>å¯¹å˜é‡çš„å†™æ“ä½œä¸ä¾èµ–äºå½“å‰å€¼</li> <li>è¯¥å˜é‡æ²¡æœ‰åŒ…å«åœ¨å…·æœ‰å…¶ä»–å˜é‡çš„ä¸å˜å¼ä¸­</li> </ul> <p>å®é™…ä¸Šï¼Œè¿™äº›æ¡ä»¶è¡¨æ˜ï¼Œå¯ä»¥è¢«å†™å…¥ volatile å˜é‡çš„è¿™äº›æœ‰æ•ˆå€¼ç‹¬ç«‹äºä»»ä½•ç¨‹åºçš„çŠ¶æ€ï¼ŒåŒ…æ‹¬å˜é‡çš„å½“å‰çŠ¶æ€ã€‚</p> <p>äº‹å®ä¸Šï¼Œæˆ‘çš„ç†è§£å°±æ˜¯ä¸Šé¢çš„ 2 ä¸ªæ¡ä»¶éœ€è¦ä¿è¯æ“ä½œæ˜¯åŸå­æ€§æ“ä½œï¼Œæ‰èƒ½ä¿è¯ä½¿ç”¨ volatile å…³é”®å­—çš„ç¨‹åºåœ¨å¹¶å‘æ—¶èƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œã€‚</p> <hr> <p><strong>synchronized å’Œ volatile çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p> <ul> <li>volatile æœ¬è´¨æ˜¯åœ¨å‘Šè¯‰ jvm å½“å‰å˜é‡åœ¨å¯„å­˜å™¨ï¼ˆå·¥ä½œå†…å­˜ï¼‰ä¸­çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€è¦ä»ä¸»å­˜ä¸­è¯»å–ï¼› synchronized åˆ™æ˜¯é”å®šå½“å‰å˜é‡ï¼Œåªæœ‰å½“å‰çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹è¢«é˜»å¡ä½ã€‚</li> <li>volatile ä»…èƒ½ä½¿ç”¨åœ¨å˜é‡çº§åˆ«ï¼›synchronized åˆ™å¯ä»¥ä½¿ç”¨åœ¨å˜é‡ã€æ–¹æ³•ã€å’Œç±»çº§åˆ«çš„ã€‚</li> <li>volatile ä»…èƒ½å®ç°å˜é‡çš„ä¿®æ”¹å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼›è€Œ synchronized åˆ™å¯ä»¥ä¿è¯å˜é‡çš„ä¿®æ”¹å¯è§æ€§å’ŒåŸå­æ€§ã€‚</li> <li>volatile ä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼›synchronized å¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ã€‚</li> <li>volatile æ ‡è®°çš„å˜é‡ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼›synchronized æ ‡è®°çš„å˜é‡å¯ä»¥è¢«ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</li> </ul> <h3 id="1015lock">10.15ã€Lock<a class="headerlink" href="#1015lock" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Lock æ˜¯ JKD 1.5åæ–°å¢çš„ã€‚</p> <p>Lockå’ŒReadWriteLockæ˜¯ä¸¤å¤§é”çš„æ ¹æ¥å£ï¼ŒLockä»£è¡¨å®ç°ç±»æ˜¯ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰ï¼ŒReadWriteLockï¼ˆè¯»å†™é”ï¼‰çš„ä»£è¡¨å®ç°ç±»æ˜¯ReentrantReadWriteLockã€‚</p> <p>Lock æ¥å£æ”¯æŒé‚£äº›è¯­ä¹‰ä¸åŒï¼ˆé‡å…¥ã€å…¬å¹³ç­‰ï¼‰çš„é”è§„åˆ™ï¼Œå¯ä»¥åœ¨éé˜»å¡å¼ç»“æ„çš„ä¸Šä¸‹æ–‡ï¼ˆåŒ…æ‹¬ hand-over-hand å’Œé”é‡æ’ç®—æ³•ï¼‰ä¸­ä½¿ç”¨è¿™äº›è§„åˆ™ã€‚ä¸»è¦çš„å®ç°æ˜¯ ReentrantLockã€‚</p> <p>ReadWriteLock æ¥å£ä»¥ç±»ä¼¼æ–¹å¼å®šä¹‰äº†ä¸€äº›è¯»å–è€…å¯ä»¥å…±äº«è€Œå†™å…¥è€…ç‹¬å çš„é”ã€‚æ­¤åŒ…åªæä¾›äº†ä¸€ä¸ªå®ç°ï¼Œå³ ReentrantReadWriteLockï¼Œå› ä¸ºå®ƒé€‚ç”¨äºå¤§éƒ¨åˆ†çš„æ ‡å‡†ç”¨æ³•ä¸Šä¸‹æ–‡ã€‚ä½†ç¨‹åºå‘˜å¯ä»¥åˆ›å»ºè‡ªå·±çš„ã€é€‚ç”¨äºéæ ‡å‡†è¦æ±‚çš„å®ç°ã€‚</p> <h4 id="10151ä¸ºä»€ä¹ˆä½¿ç”¨-lock">10.15.1ã€ä¸ºä»€ä¹ˆä½¿ç”¨ Lockï¼Ÿ<a class="headerlink" href="#10151ä¸ºä»€ä¹ˆä½¿ç”¨-lock" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p><strong>synchronized çš„å±€é™æ€§ ä¸ Lock çš„ä¼˜ç‚¹</strong>ã€€</p> <ul> <li>Lock ä¸æ˜¯ Java è¯­è¨€å†…ç½®çš„ï¼Œsynchronized æ˜¯ Java è¯­è¨€çš„å…³é”®å­—ï¼Œå› æ­¤æ˜¯å†…ç½®ç‰¹æ€§ã€‚Lock æ˜¯ä¸€ä¸ªç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å¯ä»¥å®ç°åŒæ­¥è®¿é—®ï¼›</li> <li>Lock å’Œ synchronized æœ‰ä¸€ç‚¹éå¸¸å¤§çš„ä¸åŒï¼Œå½“ synchronized æ–¹æ³•æˆ–è€… synchronized ä»£ç å—æ‰§è¡Œå®Œä¹‹åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®©çº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å ç”¨ï¼›è€Œ Lock åˆ™å¿…é¡»è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°æ­»é”ç°è±¡ã€‚</li> </ul> <p>å¦‚æœä¸€ä¸ªä»£ç å—è¢« synchronized å…³é”®å­—ä¿®é¥°ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†å¯¹åº”çš„é”ï¼Œå¹¶æ‰§è¡Œè¯¥ä»£ç å—æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¾¿åªèƒ½ä¸€ç›´ç­‰å¾…ç›´è‡³å æœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ã€‚äº‹å®ä¸Šï¼Œå æœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ä¸€èˆ¬ä¼šæ˜¯ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¹‹ä¸€ï¼š</p> <ul> <li>å æœ‰é”çš„çº¿ç¨‹æ‰§è¡Œå®Œäº†è¯¥ä»£ç å—ï¼Œç„¶åé‡Šæ”¾å¯¹é”çš„å æœ‰ï¼›</li> <li>å æœ‰é”çº¿ç¨‹æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸ï¼Œæ­¤æ—¶JVMä¼šè®©çº¿ç¨‹è‡ªåŠ¨é‡Šæ”¾é”ï¼›</li> <li>å æœ‰é”çº¿ç¨‹è¿›å…¥ WAITING çŠ¶æ€ä»è€Œé‡Šæ”¾é”ï¼Œä¾‹å¦‚åœ¨è¯¥çº¿ç¨‹ä¸­è°ƒç”¨ wait() æ–¹æ³•ç­‰ã€‚</li> </ul> <p>è¯•è€ƒè™‘ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼šã€€</p> <ul> <li>åœ¨ä½¿ç”¨ synchronized å…³é”®å­—çš„æƒ…å½¢ä¸‹ï¼Œå‡å¦‚å æœ‰é”çš„çº¿ç¨‹ç”±äºè¦ç­‰å¾… IO æˆ–è€…å…¶ä»–åŸå› ï¼ˆæ¯”å¦‚è°ƒç”¨ sleep æ–¹æ³•ï¼‰è¢«é˜»å¡äº†ï¼Œä½†æ˜¯åˆæ²¡æœ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹å°±åªèƒ½ä¸€ç›´ç­‰å¾…ï¼Œåˆ«æ— ä»–æ³•ã€‚è¿™ä¼šæå¤§å½±å“ç¨‹åºæ‰§è¡Œæ•ˆç‡ã€‚å› æ­¤ï¼Œå°±éœ€è¦æœ‰ä¸€ç§æœºåˆ¶å¯ä»¥ä¸è®©ç­‰å¾…çš„çº¿ç¨‹ä¸€ç›´æ— æœŸé™åœ°ç­‰å¾…ä¸‹å»ï¼ˆæ¯”å¦‚åªç­‰å¾…ä¸€å®šçš„æ—¶é—´ (è§£å†³æ–¹æ¡ˆï¼štryLock(long time, TimeUnit unit)) æˆ–è€… èƒ½å¤Ÿå“åº”ä¸­æ–­ (è§£å†³æ–¹æ¡ˆï¼šlockInterruptibly())ï¼‰ï¼Œè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡ Lock è§£å†³ã€‚</li> <li>å½“å¤šä¸ªçº¿ç¨‹è¯»å†™æ–‡ä»¶æ—¶ï¼Œè¯»æ“ä½œå’Œå†™æ“ä½œä¼šå‘ç”Ÿå†²çªç°è±¡ï¼Œå†™æ“ä½œå’Œå†™æ“ä½œä¹Ÿä¼šå‘ç”Ÿå†²çªç°è±¡ï¼Œä½†æ˜¯è¯»æ“ä½œå’Œè¯»æ“ä½œä¸ä¼šå‘ç”Ÿå†²çªç°è±¡ã€‚ä½†æ˜¯å¦‚æœé‡‡ç”¨ synchronized å…³é”®å­—å®ç°åŒæ­¥çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå³å½“å¤šä¸ªçº¿ç¨‹éƒ½åªæ˜¯è¿›è¡Œè¯»æ“ä½œæ—¶ï¼Œä¹Ÿåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å¯ä»¥è¿›è¡Œè¯»æ“ä½œï¼Œå…¶ä»–çº¿ç¨‹åªèƒ½ç­‰å¾…é”çš„é‡Šæ”¾è€Œæ— æ³•è¿›è¡Œè¯»æ“ä½œã€‚å› æ­¤ï¼Œéœ€è¦ä¸€ç§æœºåˆ¶æ¥ä½¿å¾—å½“å¤šä¸ªçº¿ç¨‹éƒ½åªæ˜¯è¿›è¡Œè¯»æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¹‹é—´ä¸ä¼šå‘ç”Ÿå†²çªã€‚åŒæ ·åœ°ï¼ŒLock ä¹Ÿå¯ä»¥è§£å†³è¿™ç§æƒ…å†µ (è§£å†³æ–¹æ¡ˆï¼šReentrantReadWriteLock) ã€‚</li> <li>å¯ä»¥é€šè¿‡ Lock å¾—çŸ¥çº¿ç¨‹æœ‰æ²¡æœ‰æˆåŠŸè·å–åˆ°é” (è§£å†³æ–¹æ¡ˆï¼šReentrantLock) ï¼Œä½†è¿™ä¸ªæ˜¯ synchronized æ— æ³•åŠåˆ°çš„ã€‚</li> </ul> <p>ä¸Šé¢æåˆ°çš„ä¸‰ç§æƒ…å½¢ï¼Œéƒ½å¯ä»¥é€šè¿‡ Lock æ¥è§£å†³ï¼Œä½† synchronized å…³é”®å­—å´æ— èƒ½ä¸ºåŠ›ã€‚Lock æ˜¯ java.util.concurrent.locks åŒ…ä¸‹çš„æ¥å£ï¼Œæä¾›äº†æ¯” synchronized å…³é”®å­—æ›´å¹¿æ³›çš„é”æ“ä½œï¼Œå®ƒèƒ½ä»¥æ›´ä¼˜é›…çš„æ–¹å¼å¤„ç†çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒLock æä¾›äº†æ¯” synchronized æ›´å¤šçš„åŠŸèƒ½ã€‚</p> <h4 id="10152lock-æ¥å£å®ç°ç±»">10.15.2ã€Lock æ¥å£å®ç°ç±»<a class="headerlink" href="#10152lock-æ¥å£å®ç°ç±»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Lock æ¥å£æœ‰6ä¸ªæ–¹æ³•ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="c1">// è·å–é”  </span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">lock</span><span class="p">()</span><span class="w">   </span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a>
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="c1">// å¦‚æœå½“å‰çº¿ç¨‹æœªè¢«ä¸­æ–­ï¼Œåˆ™è·å–é”ï¼Œå¯ä»¥å“åº”ä¸­æ–­  </span>
</span><span id="__span-98-5"><a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">lockInterruptibly</span><span class="p">()</span><span class="w">   </span>
</span><span id="__span-98-6"><a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a>
</span><span id="__span-98-7"><a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="c1">// è¿”å›ç»‘å®šåˆ°æ­¤ Lock å®ä¾‹çš„æ–° Condition å®ä¾‹  </span>
</span><span id="__span-98-8"><a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="n">Condition</span><span class="w"> </span><span class="nf">newCondition</span><span class="p">()</span><span class="w">   </span>
</span><span id="__span-98-9"><a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a>
</span><span id="__span-98-10"><a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a><span class="c1">// ä»…åœ¨è°ƒç”¨æ—¶é”ä¸ºç©ºé—²çŠ¶æ€æ‰è·å–è¯¥é”ï¼Œå¯ä»¥å“åº”ä¸­æ–­  </span>
</span><span id="__span-98-11"><a id="__codelineno-98-11" name="__codelineno-98-11" href="#__codelineno-98-11"></a><span class="kt">boolean</span><span class="w"> </span><span class="nf">tryLock</span><span class="p">()</span><span class="w">   </span>
</span><span id="__span-98-12"><a id="__codelineno-98-12" name="__codelineno-98-12" href="#__codelineno-98-12"></a>
</span><span id="__span-98-13"><a id="__codelineno-98-13" name="__codelineno-98-13" href="#__codelineno-98-13"></a><span class="c1">// å¦‚æœé”åœ¨ç»™å®šçš„ç­‰å¾…æ—¶é—´å†…ç©ºé—²ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹æœªè¢«ä¸­æ–­ï¼Œåˆ™è·å–é”  </span>
</span><span id="__span-98-14"><a id="__codelineno-98-14" name="__codelineno-98-14" href="#__codelineno-98-14"></a><span class="kt">boolean</span><span class="w"> </span><span class="nf">tryLock</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="w"> </span><span class="n">unit</span><span class="p">)</span><span class="w">   </span>
</span><span id="__span-98-15"><a id="__codelineno-98-15" name="__codelineno-98-15" href="#__codelineno-98-15"></a>
</span><span id="__span-98-16"><a id="__codelineno-98-16" name="__codelineno-98-16" href="#__codelineno-98-16"></a><span class="c1">// é‡Šæ”¾é”  </span>
</span><span id="__span-98-17"><a id="__codelineno-98-17" name="__codelineno-98-17" href="#__codelineno-98-17"></a><span class="kt">void</span><span class="w"> </span><span class="nf">unlock</span><span class="p">()</span><span class="w"> </span>
</span></code></pre></div> <p>lock()ã€tryLock()ã€tryLock(long time, TimeUnit unit) å’Œ lockInterruptibly() éƒ½æ˜¯ç”¨æ¥è·å–é”çš„ã€‚unLock() æ–¹æ³•æ˜¯ç”¨æ¥é‡Šæ”¾é”çš„ã€‚newCondition() è¿”å›ç»‘å®šåˆ°æ­¤ Lock çš„æ–°çš„ Condition å®ä¾‹ ï¼Œç”¨äºçº¿ç¨‹é—´çš„åä½œï¼Œè¯¦ç»†å†…å®¹è¯·æŸ¥æ‰¾å…³é”®è¯ï¼šçº¿ç¨‹é—´é€šä¿¡ä¸åä½œã€‚</p> <hr> <p><strong>lock()</strong></p> <p>lock() æ–¹æ³•æ˜¯å¹³å¸¸ä½¿ç”¨å¾—æœ€å¤šçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ç”¨æ¥è·å–é”ã€‚å¦‚æœé”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼Œåˆ™è¿›è¡Œç­‰å¾…ã€‚ç”±äºä½¿ç”¨ Lock å¿…é¡»ä¸»åŠ¨å»é‡Šæ”¾é”ï¼Œå› æ­¤ï¼Œä½¿ç”¨ Lock æœ€å¥½åœ¨ tryâ€¦catchâ€¦ å—ä¸­è¿›è¡Œï¼Œå¹¶ä¸”å°†é‡Šæ”¾é”çš„æ“ä½œæ”¾åœ¨ finally å—ä¸­ï¼Œä»¥ä¿è¯é”ä¸€å®šè¢«è¢«é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”çš„å‘ç”Ÿã€‚é€šå¸¸ä½¿ç”¨ Lock æ¥è¿›è¡ŒåŒæ­¥çš„è¯ï¼Œæ˜¯ä»¥ä¸‹é¢è¿™ç§å½¢å¼å»ä½¿ç”¨çš„ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="n">Lock</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="k">try</span><span class="p">{</span>
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="w">    </span><span class="c1">//å¤„ç†ä»»åŠ¡</span>
</span><span id="__span-99-5"><a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">){</span>
</span><span id="__span-99-6"><a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a>
</span><span id="__span-99-7"><a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a><span class="p">}</span><span class="k">finally</span><span class="p">{</span>
</span><span id="__span-99-8"><a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a><span class="w">    </span><span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span><span class="w">   </span><span class="c1">//é‡Šæ”¾é”</span>
</span><span id="__span-99-9"><a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a><span class="p">}</span>
</span></code></pre></div> <hr> <p><strong>tryLock() &amp; tryLock(long time, TimeUnit unit)</strong></p> <p>tryLock() æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå®ƒè¡¨ç¤ºç”¨æ¥å°è¯•è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¿”å› trueï¼›å¦‚æœè·å–å¤±è´¥ï¼ˆå³é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰ï¼Œåˆ™è¿”å› falseï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•æ— è®ºå¦‚ä½•éƒ½ä¼šç«‹å³è¿”å›ï¼ˆåœ¨æ‹¿ä¸åˆ°é”æ—¶ä¸ä¼šä¸€ç›´åœ¨é‚£ç­‰å¾…ï¼‰ã€‚</p> <p>tryLock(long time, TimeUnit unit) æ–¹æ³•å’Œ tryLock() æ–¹æ³•æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡åŒºåˆ«åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œåœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜æ‹¿ä¸åˆ°é”ï¼Œå°±è¿”å› falseï¼ŒåŒæ—¶å¯ä»¥å“åº”ä¸­æ–­ã€‚å¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å› trueã€‚</p> <p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé€šè¿‡ tryLock æ¥è·å–é”æ—¶æ˜¯è¿™æ ·ä½¿ç”¨çš„ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="n">Lock</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="k">if</span><span class="p">(</span><span class="n">lock</span><span class="p">.</span><span class="na">tryLock</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="w">     </span><span class="k">try</span><span class="p">{</span>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="w">         </span><span class="c1">//å¤„ç†ä»»åŠ¡</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="w">     </span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">){</span>
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a>
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="w">     </span><span class="p">}</span><span class="k">finally</span><span class="p">{</span>
</span><span id="__span-100-8"><a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a><span class="w">         </span><span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span><span class="w">   </span><span class="c1">//é‡Šæ”¾é”</span>
</span><span id="__span-100-9"><a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a><span class="w">     </span><span class="p">}</span><span class="w"> </span>
</span><span id="__span-100-10"><a id="__codelineno-100-10" name="__codelineno-100-10" href="#__codelineno-100-10"></a><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-100-11"><a id="__codelineno-100-11" name="__codelineno-100-11" href="#__codelineno-100-11"></a><span class="w">    </span><span class="c1">//å¦‚æœä¸èƒ½è·å–é”ï¼Œåˆ™ç›´æ¥åšå…¶ä»–äº‹æƒ…</span>
</span><span id="__span-100-12"><a id="__codelineno-100-12" name="__codelineno-100-12" href="#__codelineno-100-12"></a><span class="p">}</span>
</span></code></pre></div> <hr> <p>**lockInterruptibly()ã€€**</p> <p>lockInterruptibly() æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œå½“é€šè¿‡è¿™ä¸ªæ–¹æ³•å»è·å–é”æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–é”ï¼Œåˆ™è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼Œå³ä¸­æ–­çº¿ç¨‹çš„ç­‰å¾…çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡ lock.lockInterruptibly() æƒ³è·å–æŸä¸ªé”æ—¶ï¼Œå‡è‹¥æ­¤æ—¶çº¿ç¨‹ A è·å–åˆ°äº†é”ï¼Œè€Œçº¿ç¨‹ B åªæœ‰åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆå¯¹çº¿ç¨‹ B è°ƒç”¨threadB.interrupt() æ–¹æ³•èƒ½å¤Ÿä¸­æ–­çº¿ç¨‹ B çš„ç­‰å¾…è¿‡ç¨‹ã€‚</p> <p>ç”±äº lockInterruptibly() çš„å£°æ˜ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰€ä»¥lock.lockInterruptibly() å¿…é¡»æ”¾åœ¨tryå—ä¸­æˆ–è€…åœ¨è°ƒç”¨ lockInterruptibly() çš„æ–¹æ³•å¤–å£°æ˜æŠ›å‡º InterruptedExceptionï¼Œä½†æ¨èä½¿ç”¨åè€…ï¼ŒåŸå› ç¨åé˜è¿°ã€‚å› æ­¤ï¼ŒlockInterruptibly()ä¸€èˆ¬çš„ä½¿ç”¨å½¢å¼å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">method</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="w">    </span><span class="n">lock</span><span class="p">.</span><span class="na">lockInterruptibly</span><span class="p">();</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="w">     </span><span class="c1">//.....</span>
</span><span id="__span-101-5"><a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-101-6"><a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="w">    </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-101-7"><a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a><span class="w">        </span><span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
</span><span id="__span-101-8"><a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-101-9"><a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a><span class="p">}</span>
</span></code></pre></div> <p>æ³¨æ„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†é”ä¹‹åï¼Œæ˜¯ä¸ä¼šè¢« interrupt() æ–¹æ³•ä¸­æ–­çš„ã€‚å› ä¸º interrupt() æ–¹æ³•åªèƒ½ä¸­æ–­é˜»å¡è¿‡ç¨‹ä¸­çš„çº¿ç¨‹è€Œä¸èƒ½ä¸­æ–­æ­£åœ¨è¿è¡Œè¿‡ç¨‹ä¸­çš„çº¿ç¨‹ã€‚ä¸ synchronized ç›¸æ¯”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å¤„äºç­‰å¾…æŸä¸ªé”çš„çŠ¶æ€ï¼Œæ˜¯æ— æ³•è¢«ä¸­æ–­çš„ï¼Œåªæœ‰ä¸€ç›´ç­‰å¾…ä¸‹å»ã€‚</p> <h4 id="10153reentrantlock">10.15.3ã€ReentrantLock<a class="headerlink" href="#10153reentrantlock" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>ReentrantLockï¼Œå³å¯é‡å…¥é”ã€‚ReentrantLock æ˜¯å”¯ä¸€å®ç°äº† Lock æ¥å£çš„ç±»ï¼Œå¹¶ä¸” ReentrantLock æä¾›äº†æ›´å¤šçš„æ–¹æ³•ã€‚</p> <p>æ„é€ æ–¹æ³•ï¼ˆä¸å¸¦å‚æ•°å’Œå¸¦å‚æ•° trueï¼š å…¬å¹³é”ï¼› false: éå…¬å¹³é”ï¼‰ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="cm">/**</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="cm">  * Creates an instance of {@code ReentrantLock}.</span>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="cm">  * This is equivalent to using {@code ReentrantLock(false)}.</span>
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="cm">  */</span>
</span><span id="__span-102-5"><a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a><span class="kd">public</span><span class="w"> </span><span class="nf">ReentrantLock</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-102-6"><a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="w">    </span><span class="n">sync</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NonfairSync</span><span class="p">();</span>
</span><span id="__span-102-7"><a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a><span class="p">}</span>
</span><span id="__span-102-8"><a id="__codelineno-102-8" name="__codelineno-102-8" href="#__codelineno-102-8"></a>
</span><span id="__span-102-9"><a id="__codelineno-102-9" name="__codelineno-102-9" href="#__codelineno-102-9"></a><span class="cm">/**</span>
</span><span id="__span-102-10"><a id="__codelineno-102-10" name="__codelineno-102-10" href="#__codelineno-102-10"></a><span class="cm">  * Creates an instance of {@code ReentrantLock} with the</span>
</span><span id="__span-102-11"><a id="__codelineno-102-11" name="__codelineno-102-11" href="#__codelineno-102-11"></a><span class="cm">  * given fairness policy.</span>
</span><span id="__span-102-12"><a id="__codelineno-102-12" name="__codelineno-102-12" href="#__codelineno-102-12"></a><span class="cm">  *</span>
</span><span id="__span-102-13"><a id="__codelineno-102-13" name="__codelineno-102-13" href="#__codelineno-102-13"></a><span class="cm">  * @param fair {@code true} if this lock should use a fair ordering policy</span>
</span><span id="__span-102-14"><a id="__codelineno-102-14" name="__codelineno-102-14" href="#__codelineno-102-14"></a><span class="cm">  */</span>
</span><span id="__span-102-15"><a id="__codelineno-102-15" name="__codelineno-102-15" href="#__codelineno-102-15"></a><span class="kd">public</span><span class="w"> </span><span class="nf">ReentrantLock</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">fair</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-102-16"><a id="__codelineno-102-16" name="__codelineno-102-16" href="#__codelineno-102-16"></a><span class="w">    </span><span class="n">sync</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fair</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FairSync</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NonfairSync</span><span class="p">();</span>
</span><span id="__span-102-17"><a id="__codelineno-102-17" name="__codelineno-102-17" href="#__codelineno-102-17"></a><span class="p">}</span>
</span></code></pre></div> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.locks.Lock</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.locks.ReentrantLock</span><span class="p">;</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LockThread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="w">    </span><span class="n">Lock</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReentrantLock</span><span class="p">();</span><span class="w"> </span>
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">lock</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="w">        </span><span class="c1">// è·å–é”  </span>
</span><span id="__span-103-7"><a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="w">        </span><span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-103-8"><a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-103-9"><a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" get the lock"</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-103-10"><a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a><span class="w">            </span><span class="c1">// è®¿é—®æ­¤é”ä¿æŠ¤çš„èµ„æº  </span>
</span><span id="__span-103-11"><a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-103-12"><a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a><span class="w">            </span><span class="c1">// é‡Šæ”¾é”  </span>
</span><span id="__span-103-13"><a id="__codelineno-103-13" name="__codelineno-103-13" href="#__codelineno-103-13"></a><span class="w">            </span><span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-103-14"><a id="__codelineno-103-14" name="__codelineno-103-14" href="#__codelineno-103-14"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" release the lock"</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-103-15"><a id="__codelineno-103-15" name="__codelineno-103-15" href="#__codelineno-103-15"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-103-16"><a id="__codelineno-103-16" name="__codelineno-103-16" href="#__codelineno-103-16"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-103-17"><a id="__codelineno-103-17" name="__codelineno-103-17" href="#__codelineno-103-17"></a>
</span><span id="__span-103-18"><a id="__codelineno-103-18" name="__codelineno-103-18" href="#__codelineno-103-18"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-103-19"><a id="__codelineno-103-19" name="__codelineno-103-19" href="#__codelineno-103-19"></a><span class="w">        </span><span class="n">LockThread</span><span class="w"> </span><span class="n">lt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LockThread</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-103-20"><a id="__codelineno-103-20" name="__codelineno-103-20" href="#__codelineno-103-20"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">lt</span><span class="p">.</span><span class="na">lock</span><span class="p">(</span><span class="s">"A"</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-103-21"><a id="__codelineno-103-21" name="__codelineno-103-21" href="#__codelineno-103-21"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">lt</span><span class="p">.</span><span class="na">lock</span><span class="p">(</span><span class="s">"B"</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-103-22"><a id="__codelineno-103-22" name="__codelineno-103-22" href="#__codelineno-103-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-103-23"><a id="__codelineno-103-23" name="__codelineno-103-23" href="#__codelineno-103-23"></a><span class="p">}</span>
</span></code></pre></div> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/2024-12-25 004648.png" data-desc-position="bottom"><img src="!assets/Java/2024-12-25 004648.png" alt="2024-12-25 004648" style></a></p> <p>ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼ŒA çº¿ç¨‹å’Œ B çº¿ç¨‹åŒæ—¶å¯¹èµ„æºåŠ é”ï¼ŒA çº¿ç¨‹è·å–é”ä¹‹åï¼ŒB çº¿ç¨‹åªå¥½ç­‰å¾…ï¼Œç›´åˆ° A çº¿ç¨‹é‡Šæ”¾é” B çº¿ç¨‹æ‰è·å¾—é”ã€‚</p> <p>æ€»ç»“ä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯è¯´ <strong>Lock</strong> æä¾›äº†æ¯” <strong>synchronized</strong> æ›´å¤šçš„åŠŸèƒ½ã€‚ä½†æ˜¯è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p> <ul> <li>Synchronized æ˜¯ Java è¯­è¨€çš„å…³é”®å­—ï¼Œå› æ­¤æ˜¯å†…ç½®ç‰¹æ€§ï¼Œè€Œ Lock ä¸æ˜¯ Java è¯­è¨€å†…ç½®çš„ï¼Œåœ¨ JVM å±‚é¢ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡å®ç°ç±»å¯ä»¥å®ç°åŒæ­¥è®¿é—®ã€‚</li> <li>Synchronized æ˜¯åœ¨ JVM å±‚é¢ä¸Šå®ç°çš„ï¼Œä¸ä½†å¯ä»¥é€šè¿‡ä¸€äº›ç›‘æ§å·¥å…·ç›‘æ§ Synchronized çš„é”å®šï¼Œè€Œä¸”åœ¨ä»£ç æ‰§è¡Œæ—¶å‡ºç°å¼‚å¸¸ï¼ŒJVM ä¼šè‡ªåŠ¨é‡Šæ”¾é”å®šï¼Œä½†æ˜¯ä½¿ç”¨ Lock åˆ™ä¸è¡Œï¼Œlockæ˜¯é€šè¿‡ä»£ç å®ç°çš„ï¼Œè¦ä¿è¯é”å®šä¸€å®šä¼šè¢«é‡Šæ”¾ï¼Œå°±å¿…é¡»å°† unLock() æ”¾åˆ° finally{} ä¸­ï¼Œå¦‚æœä¸ºåŠæ—¶é‡Šæ”¾ï¼Œå¯èƒ½ä¼šé€ æˆæ­»é”ã€‚</li> <li>åœ¨èµ„æºç«äº‰ä¸æ˜¯å¾ˆæ¿€çƒˆçš„æƒ…å†µä¸‹ï¼ŒSynchronized çš„æ€§èƒ½è¦ä¼˜äº ReetrantLockï¼Œä½†æ˜¯åœ¨èµ„æºç«äº‰å¾ˆæ¿€çƒˆçš„æƒ…å†µä¸‹ï¼ŒSynchronized çš„æ€§èƒ½ä¼šä¸‹é™å‡ åå€ï¼Œä½†æ˜¯ ReetrantLock çš„æ€§èƒ½èƒ½ç»´æŒå¸¸æ€ï¼Œæ‰€ä»¥ Lock é”é€‚åˆå¤§é‡åŒæ­¥çš„ä»£ç çš„åŒæ­¥é—®é¢˜ï¼Œsynchronized é”é€‚åˆä»£ç å°‘é‡çš„åŒæ­¥é—®é¢˜ã€‚</li> </ul> <h4 id="10154readwritelock">10.15.4ã€ReadWriteLock<a class="headerlink" href="#10154readwritelock" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>è¯»å†™é”ï¼Œå¯ä»¥åˆ†åˆ«è·å–è¯»é”æˆ–å†™é”ã€‚ä¹Ÿå°±æ˜¯è¯´å°†æ•°æ®çš„è¯»å†™æ“ä½œåˆ†å¼€ï¼Œåˆ†æˆ 2 ä¸ªé”æ¥åˆ†é…ç»™çº¿ç¨‹ï¼Œä»è€Œä½¿å¾—å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¿›è¡Œè¯»æ“ä½œã€‚è¯»é”ä½¿ç”¨å…±äº«æ¨¡å¼ï¼›å†™é”ä½¿ç”¨ç‹¬å æ¨¡å¼ï¼›è¯»é”å¯ä»¥åœ¨æ²¡æœ‰å†™é”çš„æ—¶å€™è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰ï¼Œå†™é”æ˜¯ç‹¬å çš„ã€‚å½“æœ‰è¯»é”æ—¶ï¼Œå†™é”å°±ä¸èƒ½è·å¾—ï¼›è€Œå½“æœ‰å†™é”æ—¶ï¼Œé™¤äº†è·å¾—å†™é”çš„è¿™ä¸ªçº¿ç¨‹å¯ä»¥è·å¾—è¯»é”å¤–ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½è·å¾—è¯»é”ã€‚</p> <p>ReadWriteLock æ¥å£åªæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="c1">//è¿”å›ç”¨äºè¯»å–æ“ä½œçš„é”  </span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="n">Lock</span><span class="w"> </span><span class="nf">readLock</span><span class="p">()</span><span class="w">   </span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="c1">//è¿”å›ç”¨äºå†™å…¥æ“ä½œçš„é”  </span>
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="n">Lock</span><span class="w"> </span><span class="nf">writeLock</span><span class="p">()</span><span class="w"> </span>
</span></code></pre></div> <p>ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªå…±äº«æ•°æ®è¿›è¡Œè¯»å†™:</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="kd">class</span> <span class="nc">Queue</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="w">    </span><span class="c1">//å…±äº«æ•°æ®ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™è¯¥æ•°æ®ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»è¯¥æ•°æ®ã€‚</span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a>
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="w">    </span><span class="n">ReadWriteLock</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReentrantReadWriteLock</span><span class="p">();</span>
</span><span id="__span-105-6"><a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a>
</span><span id="__span-105-7"><a id="__codelineno-105-7" name="__codelineno-105-7" href="#__codelineno-105-7"></a><span class="w">    </span><span class="c1">// è¯»æ•°æ®</span>
</span><span id="__span-105-8"><a id="__codelineno-105-8" name="__codelineno-105-8" href="#__codelineno-105-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-9"><a id="__codelineno-105-9" name="__codelineno-105-9" href="#__codelineno-105-9"></a><span class="w">        </span><span class="c1">// åŠ è¯»é”</span>
</span><span id="__span-105-10"><a id="__codelineno-105-10" name="__codelineno-105-10" href="#__codelineno-105-10"></a><span class="w">        </span><span class="n">lock</span><span class="p">.</span><span class="na">readLock</span><span class="p">().</span><span class="na">lock</span><span class="p">();</span>
</span><span id="__span-105-11"><a id="__codelineno-105-11" name="__codelineno-105-11" href="#__codelineno-105-11"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-12"><a id="__codelineno-105-12" name="__codelineno-105-12" href="#__codelineno-105-12"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" be ready to read data!"</span><span class="p">);</span>
</span><span id="__span-105-13"><a id="__codelineno-105-13" name="__codelineno-105-13" href="#__codelineno-105-13"></a><span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="na">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">));</span>
</span><span id="__span-105-14"><a id="__codelineno-105-14" name="__codelineno-105-14" href="#__codelineno-105-14"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" have read data :"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
</span><span id="__span-105-15"><a id="__codelineno-105-15" name="__codelineno-105-15" href="#__codelineno-105-15"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-16"><a id="__codelineno-105-16" name="__codelineno-105-16" href="#__codelineno-105-16"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-105-17"><a id="__codelineno-105-17" name="__codelineno-105-17" href="#__codelineno-105-17"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-18"><a id="__codelineno-105-18" name="__codelineno-105-18" href="#__codelineno-105-18"></a><span class="w">            </span><span class="c1">// é‡Šæ”¾è¯»é”</span>
</span><span id="__span-105-19"><a id="__codelineno-105-19" name="__codelineno-105-19" href="#__codelineno-105-19"></a><span class="w">            </span><span class="n">lock</span><span class="p">.</span><span class="na">readLock</span><span class="p">().</span><span class="na">unlock</span><span class="p">();</span>
</span><span id="__span-105-20"><a id="__codelineno-105-20" name="__codelineno-105-20" href="#__codelineno-105-20"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-105-21"><a id="__codelineno-105-21" name="__codelineno-105-21" href="#__codelineno-105-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-105-22"><a id="__codelineno-105-22" name="__codelineno-105-22" href="#__codelineno-105-22"></a>
</span><span id="__span-105-23"><a id="__codelineno-105-23" name="__codelineno-105-23" href="#__codelineno-105-23"></a><span class="w">    </span><span class="c1">// å†™æ•°æ®</span>
</span><span id="__span-105-24"><a id="__codelineno-105-24" name="__codelineno-105-24" href="#__codelineno-105-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-25"><a id="__codelineno-105-25" name="__codelineno-105-25" href="#__codelineno-105-25"></a><span class="w">        </span><span class="c1">// åŠ å†™é”</span>
</span><span id="__span-105-26"><a id="__codelineno-105-26" name="__codelineno-105-26" href="#__codelineno-105-26"></a><span class="w">        </span><span class="n">lock</span><span class="p">.</span><span class="na">writeLock</span><span class="p">().</span><span class="na">lock</span><span class="p">();</span>
</span><span id="__span-105-27"><a id="__codelineno-105-27" name="__codelineno-105-27" href="#__codelineno-105-27"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-28"><a id="__codelineno-105-28" name="__codelineno-105-28" href="#__codelineno-105-28"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" be ready to write data!"</span><span class="p">);</span>
</span><span id="__span-105-29"><a id="__codelineno-105-29" name="__codelineno-105-29" href="#__codelineno-105-29"></a><span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="na">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">));</span>
</span><span id="__span-105-30"><a id="__codelineno-105-30" name="__codelineno-105-30" href="#__codelineno-105-30"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
</span><span id="__span-105-31"><a id="__codelineno-105-31" name="__codelineno-105-31" href="#__codelineno-105-31"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" have write data: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
</span><span id="__span-105-32"><a id="__codelineno-105-32" name="__codelineno-105-32" href="#__codelineno-105-32"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-33"><a id="__codelineno-105-33" name="__codelineno-105-33" href="#__codelineno-105-33"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-105-34"><a id="__codelineno-105-34" name="__codelineno-105-34" href="#__codelineno-105-34"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-35"><a id="__codelineno-105-35" name="__codelineno-105-35" href="#__codelineno-105-35"></a><span class="w">            </span><span class="c1">// é‡Šæ”¾å†™é”</span>
</span><span id="__span-105-36"><a id="__codelineno-105-36" name="__codelineno-105-36" href="#__codelineno-105-36"></a><span class="w">            </span><span class="n">lock</span><span class="p">.</span><span class="na">writeLock</span><span class="p">().</span><span class="na">unlock</span><span class="p">();</span>
</span><span id="__span-105-37"><a id="__codelineno-105-37" name="__codelineno-105-37" href="#__codelineno-105-37"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-105-38"><a id="__codelineno-105-38" name="__codelineno-105-38" href="#__codelineno-105-38"></a>
</span><span id="__span-105-39"><a id="__codelineno-105-39" name="__codelineno-105-39" href="#__codelineno-105-39"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-105-40"><a id="__codelineno-105-40" name="__codelineno-105-40" href="#__codelineno-105-40"></a><span class="p">}</span>
</span><span id="__span-105-41"><a id="__codelineno-105-41" name="__codelineno-105-41" href="#__codelineno-105-41"></a>
</span><span id="__span-105-42"><a id="__codelineno-105-42" name="__codelineno-105-42" href="#__codelineno-105-42"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ReadWriteLockDemo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-43"><a id="__codelineno-105-43" name="__codelineno-105-43" href="#__codelineno-105-43"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-44"><a id="__codelineno-105-44" name="__codelineno-105-44" href="#__codelineno-105-44"></a><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Queue</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Queue</span><span class="p">();</span>
</span><span id="__span-105-45"><a id="__codelineno-105-45" name="__codelineno-105-45" href="#__codelineno-105-45"></a><span class="w">        </span><span class="c1">//ä¸€å…±å¯åŠ¨6ä¸ªçº¿ç¨‹ï¼Œ3ä¸ªè¯»çº¿ç¨‹ï¼Œ3ä¸ªå†™çº¿ç¨‹</span>
</span><span id="__span-105-46"><a id="__codelineno-105-46" name="__codelineno-105-46" href="#__codelineno-105-46"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-47"><a id="__codelineno-105-47" name="__codelineno-105-47" href="#__codelineno-105-47"></a><span class="w">            </span><span class="c1">//å¯åŠ¨1ä¸ªè¯»çº¿ç¨‹</span>
</span><span id="__span-105-48"><a id="__codelineno-105-48" name="__codelineno-105-48" href="#__codelineno-105-48"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-49"><a id="__codelineno-105-49" name="__codelineno-105-49" href="#__codelineno-105-49"></a><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-50"><a id="__codelineno-105-50" name="__codelineno-105-50" href="#__codelineno-105-50"></a><span class="w">                    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-51"><a id="__codelineno-105-51" name="__codelineno-105-51" href="#__codelineno-105-51"></a><span class="w">                        </span><span class="n">queue</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
</span><span id="__span-105-52"><a id="__codelineno-105-52" name="__codelineno-105-52" href="#__codelineno-105-52"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-105-53"><a id="__codelineno-105-53" name="__codelineno-105-53" href="#__codelineno-105-53"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-105-54"><a id="__codelineno-105-54" name="__codelineno-105-54" href="#__codelineno-105-54"></a>
</span><span id="__span-105-55"><a id="__codelineno-105-55" name="__codelineno-105-55" href="#__codelineno-105-55"></a><span class="w">            </span><span class="p">}.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-105-56"><a id="__codelineno-105-56" name="__codelineno-105-56" href="#__codelineno-105-56"></a><span class="w">            </span><span class="c1">//å¯åŠ¨1ä¸ªå†™çº¿ç¨‹</span>
</span><span id="__span-105-57"><a id="__codelineno-105-57" name="__codelineno-105-57" href="#__codelineno-105-57"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-58"><a id="__codelineno-105-58" name="__codelineno-105-58" href="#__codelineno-105-58"></a><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-59"><a id="__codelineno-105-59" name="__codelineno-105-59" href="#__codelineno-105-59"></a><span class="w">                    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-60"><a id="__codelineno-105-60" name="__codelineno-105-60" href="#__codelineno-105-60"></a><span class="w">                        </span><span class="n">queue</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Random</span><span class="p">().</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">10000</span><span class="p">));</span>
</span><span id="__span-105-61"><a id="__codelineno-105-61" name="__codelineno-105-61" href="#__codelineno-105-61"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-105-62"><a id="__codelineno-105-62" name="__codelineno-105-62" href="#__codelineno-105-62"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-105-63"><a id="__codelineno-105-63" name="__codelineno-105-63" href="#__codelineno-105-63"></a><span class="w">            </span><span class="p">}.</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-105-64"><a id="__codelineno-105-64" name="__codelineno-105-64" href="#__codelineno-105-64"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-105-65"><a id="__codelineno-105-65" name="__codelineno-105-65" href="#__codelineno-105-65"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-105-66"><a id="__codelineno-105-66" name="__codelineno-105-66" href="#__codelineno-105-66"></a><span class="p">}</span>
</span></code></pre></div> <p>æ‰§è¡Œç»“æœ</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/QQ_1735059649635.png" data-desc-position="bottom"><img src="!assets/Java/QQ_1735059649635.png" alt="QQ_1735059649635" style></a></p> <h4 id="10155é”çš„ç›¸å…³æ¦‚å¿µä»‹ç»">10.15.5ã€é”çš„ç›¸å…³æ¦‚å¿µä»‹ç»<a class="headerlink" href="#10155é”çš„ç›¸å…³æ¦‚å¿µä»‹ç»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p><strong>å¯é‡å…¥é”</strong></p> <p>å¦‚æœé”å…·å¤‡å¯é‡å…¥æ€§ï¼Œåˆ™ç§°ä½œä¸ºå¯é‡å…¥é” ã€‚åƒ synchronized å’Œ ReentrantLock éƒ½æ˜¯å¯é‡å…¥é”ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°æŸä¸ªsynchronized æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚è¯´method1ï¼Œè€Œåœ¨method1 ä¸­ä¼šè°ƒç”¨å¦å¤–ä¸€ä¸ª synchronized æ–¹æ³• method2ï¼Œæ­¤æ—¶çº¿ç¨‹ä¸å¿…é‡æ–°å»ç”³è¯·é”ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥æ‰§è¡Œæ–¹æ³• method2ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="kd">class</span> <span class="nc">MyClass</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">method1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="w">        </span><span class="n">method2</span><span class="p">();</span>
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-106-5"><a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a>
</span><span id="__span-106-6"><a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">method2</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-106-7"><a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šè¿°ä»£ç ä¸­çš„ä¸¤ä¸ªæ–¹æ³• method1 å’Œ method2 éƒ½ç”¨ synchronized ä¿®é¥°äº†ã€‚å‡å¦‚æŸä¸€æ—¶åˆ»ï¼Œçº¿ç¨‹ A æ‰§è¡Œåˆ°äº† method1ï¼Œæ­¤æ—¶çº¿ç¨‹ A è·å–äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œè€Œç”±äº method2 ä¹Ÿæ˜¯ synchronized æ–¹æ³•ï¼Œå‡å¦‚ synchronized ä¸å…·å¤‡å¯é‡å…¥æ€§ï¼Œæ­¤æ—¶çº¿ç¨‹ A éœ€è¦é‡æ–°ç”³è¯·é”ã€‚ä½†æ˜¯ï¼Œè¿™å°±ä¼šé€ æˆæ­»é”ï¼Œå› ä¸ºçº¿ç¨‹ A å·²ç»æŒæœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œè€Œåˆåœ¨ç”³è¯·è·å–è¯¥å¯¹è±¡çš„é”ï¼Œè¿™æ ·å°±ä¼šçº¿ç¨‹ A ä¸€ç›´ç­‰å¾…æ°¸è¿œä¸ä¼šè·å–åˆ°çš„é”ã€‚è€Œç”±äº synchronized å’Œ Lock éƒ½å…·å¤‡å¯é‡å…¥æ€§ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿä¸Šè¿°ç°è±¡ã€‚</p> <hr> <p><strong>ä¸å¯é‡å…¥é”</strong></p> <p>ä¸å¯é‡å…¥é”ç›¸åï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NonLockDemo</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="w">    </span><span class="n">Lock</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NonReentrantLock</span><span class="p">();</span>
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-107-4"><a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-5"><a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a><span class="w">        </span><span class="n">set</span><span class="p">();</span>
</span><span id="__span-107-6"><a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-107-7"><a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a><span class="w">    </span><span class="kd">public</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">set</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-8"><a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-9"><a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a><span class="w">            </span><span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
</span><span id="__span-107-10"><a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"set æ–¹æ³•"</span><span class="p">);</span>
</span><span id="__span-107-11"><a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a><span class="w">            </span><span class="n">get</span><span class="p">();</span>
</span><span id="__span-107-12"><a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-13"><a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-107-14"><a id="__codelineno-107-14" name="__codelineno-107-14" href="#__codelineno-107-14"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-15"><a id="__codelineno-107-15" name="__codelineno-107-15" href="#__codelineno-107-15"></a><span class="w">            </span><span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span><span class="c1">// å¿…é¡»åœ¨finallyä¸­é‡Šæ”¾</span>
</span><span id="__span-107-16"><a id="__codelineno-107-16" name="__codelineno-107-16" href="#__codelineno-107-16"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-107-17"><a id="__codelineno-107-17" name="__codelineno-107-17" href="#__codelineno-107-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-107-18"><a id="__codelineno-107-18" name="__codelineno-107-18" href="#__codelineno-107-18"></a>
</span><span id="__span-107-19"><a id="__codelineno-107-19" name="__codelineno-107-19" href="#__codelineno-107-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-20"><a id="__codelineno-107-20" name="__codelineno-107-20" href="#__codelineno-107-20"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-21"><a id="__codelineno-107-21" name="__codelineno-107-21" href="#__codelineno-107-21"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lock</span><span class="p">.</span><span class="na">tryLock</span><span class="p">();</span>
</span><span id="__span-107-22"><a id="__codelineno-107-22" name="__codelineno-107-22" href="#__codelineno-107-22"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-23"><a id="__codelineno-107-23" name="__codelineno-107-23" href="#__codelineno-107-23"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"get æ–¹æ³•"</span><span class="p">);</span>
</span><span id="__span-107-24"><a id="__codelineno-107-24" name="__codelineno-107-24" href="#__codelineno-107-24"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-25"><a id="__codelineno-107-25" name="__codelineno-107-25" href="#__codelineno-107-25"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"get æ–¹æ³•è·å–é”å¤±è´¥"</span><span class="p">);</span>
</span><span id="__span-107-26"><a id="__codelineno-107-26" name="__codelineno-107-26" href="#__codelineno-107-26"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-107-27"><a id="__codelineno-107-27" name="__codelineno-107-27" href="#__codelineno-107-27"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-28"><a id="__codelineno-107-28" name="__codelineno-107-28" href="#__codelineno-107-28"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-107-29"><a id="__codelineno-107-29" name="__codelineno-107-29" href="#__codelineno-107-29"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-30"><a id="__codelineno-107-30" name="__codelineno-107-30" href="#__codelineno-107-30"></a><span class="w">            </span><span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
</span><span id="__span-107-31"><a id="__codelineno-107-31" name="__codelineno-107-31" href="#__codelineno-107-31"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-107-32"><a id="__codelineno-107-32" name="__codelineno-107-32" href="#__codelineno-107-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-107-33"><a id="__codelineno-107-33" name="__codelineno-107-33" href="#__codelineno-107-33"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-34"><a id="__codelineno-107-34" name="__codelineno-107-34" href="#__codelineno-107-34"></a><span class="w">        </span><span class="n">NonLockDemo</span><span class="w"> </span><span class="n">nonLockDemo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NonLockDemo</span><span class="p">();</span>
</span><span id="__span-107-35"><a id="__codelineno-107-35" name="__codelineno-107-35" href="#__codelineno-107-35"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">nonLockDemo</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-107-36"><a id="__codelineno-107-36" name="__codelineno-107-36" href="#__codelineno-107-36"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-107-37"><a id="__codelineno-107-37" name="__codelineno-107-37" href="#__codelineno-107-37"></a><span class="p">}</span>
</span></code></pre></div> <p>åŒä¸€ä¸ªçº¿ç¨‹å…ˆè°ƒç”¨setæ–¹æ³•å¹¶è·å–åˆ°é”åç»§ç»­è°ƒç”¨getæ–¹æ³•ï¼Œæ­¤æ—¶setæ–¹æ³•è¿˜æœªæ‰§è¡Œæ‰€å¾—é‡Šæ”¾ï¼Œåœ¨getæ–¹æ³•ä¸­å°è¯•è·å–é”æ—¶è¿”å›falseã€‚ <a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/20200708112550464-162821912389915.png" data-desc-position="bottom"><img src="!assets/Java/20200708112550464-162821912389915.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style></a></p> <hr> <p><strong>å¯ä¸­æ–­é”</strong></p> <p>é¡¾åæ€ä¹‰ï¼Œå¯ä¸­æ–­é”å°±æ˜¯å¯ä»¥å“åº”ä¸­æ–­çš„é”ã€‚åœ¨ Java ä¸­ï¼Œsynchronized å°±ä¸æ˜¯å¯ä¸­æ–­é”ï¼Œè€Œ Lock æ˜¯å¯ä¸­æ–­é”ã€‚</p> <p>å¦‚æœæŸä¸€çº¿ç¨‹ A æ­£åœ¨æ‰§è¡Œé”ä¸­çš„ä»£ç ï¼Œå¦ä¸€çº¿ç¨‹ B æ­£åœ¨ç­‰å¾…è·å–è¯¥é”ï¼Œå¯èƒ½ç”±äºç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œçº¿ç¨‹ B ä¸æƒ³ç­‰å¾…äº†ï¼Œæƒ³å…ˆå¤„ç†å…¶ä»–äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒä¸­æ–­è‡ªå·±æˆ–è€…åœ¨åˆ«çš„çº¿ç¨‹ä¸­ä¸­æ–­å®ƒï¼Œè¿™ç§å°±æ˜¯å¯ä¸­æ–­é”ã€‚åœ¨å‰é¢æ¼”ç¤º tryLock(long time, TimeUnit unit) å’Œ lockInterruptibly() çš„ç”¨æ³•æ—¶å·²ç»ä½“ç°äº†Lock çš„å¯ä¸­æ–­æ€§ã€‚</p> <hr> <p><strong>å…¬å¹³é”</strong></p> <p>å…¬å¹³é”å³å°½é‡ä»¥è¯·æ±‚é”çš„é¡ºåºæ¥è·å–é”ã€‚æ¯”å¦‚ï¼ŒåŒæ˜¯æœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªé”ï¼Œå½“è¿™ä¸ªé”è¢«é‡Šæ”¾æ—¶ï¼Œç­‰å¾…æ—¶é—´æœ€ä¹…çš„çº¿ç¨‹ï¼ˆæœ€å…ˆè¯·æ±‚çš„çº¿ç¨‹ï¼‰ä¼šè·å¾—è¯¥æ‰€ï¼Œè¿™ç§å°±æ˜¯å…¬å¹³é”ã€‚è€Œéå…¬å¹³é”åˆ™æ— æ³•ä¿è¯é”çš„è·å–æ˜¯æŒ‰ç…§è¯·æ±‚é”çš„é¡ºåºè¿›è¡Œçš„ï¼Œè¿™æ ·å°±å¯èƒ½å¯¼è‡´æŸä¸ªæˆ–è€…ä¸€äº›çº¿ç¨‹æ°¸è¿œè·å–ä¸åˆ°é”ã€‚</p> <p>éå…¬å¹³é”æ€§èƒ½é«˜äºå…¬å¹³é”æ€§èƒ½ã€‚é¦–å…ˆï¼Œåœ¨æ¢å¤ä¸€ä¸ªè¢«æŒ‚èµ·çš„çº¿ç¨‹ä¸è¯¥çº¿ç¨‹çœŸæ­£è¿è¡Œä¹‹é—´å­˜åœ¨ç€ä¸¥é‡çš„å»¶è¿Ÿã€‚è€Œä¸”ï¼Œéå…¬å¹³é”èƒ½æ›´å……åˆ†çš„åˆ©ç”¨cpuçš„æ—¶é—´ç‰‡ï¼Œå°½é‡çš„å‡å°‘ cpu ç©ºé—²çš„çŠ¶æ€æ—¶é—´ã€‚</p> <p>åœ¨Javaä¸­ï¼Œsynchronized å°±æ˜¯éå…¬å¹³é”ï¼Œå®ƒæ— æ³•ä¿è¯ç­‰å¾…çš„çº¿ç¨‹è·å–é”çš„é¡ºåºã€‚è€Œå¯¹äº ReentrantLock å’Œ ReentrantReadWriteLockï¼Œå®ƒé»˜è®¤æƒ…å†µä¸‹æ˜¯éå…¬å¹³é”ï¼Œä½†æ˜¯å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”ã€‚</p> <h3 id="1016atomic">10.16ã€Atomic<a class="headerlink" href="#1016atomic" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Atomic åŒ…æ˜¯ java.util.concurrent ä¸‹çš„å¦ä¸€ä¸ªä¸“é—¨ä¸ºçº¿ç¨‹å®‰å…¨è®¾è®¡çš„ Java åŒ…ï¼ŒåŒ…å«å¤šä¸ªåŸå­æ“ä½œç±»ã€‚è¿™ä¸ªåŒ…é‡Œé¢æä¾›äº†ä¸€ç»„åŸå­å˜é‡ç±»ã€‚å…¶åŸºæœ¬çš„ç‰¹æ€§å°±æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œè¿™äº›ç±»çš„å®ä¾‹åŒ…å«çš„æ–¹æ³•æ—¶ï¼Œå…·æœ‰æ’ä»–æ€§ï¼Œå³å½“æŸä¸ªçº¿ç¨‹è¿›å…¥æ–¹æ³•ï¼Œæ‰§è¡Œå…¶ä¸­çš„æŒ‡ä»¤æ—¶ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼Œè€Œåˆ«çš„çº¿ç¨‹å°±åƒè‡ªæ—‹é”ä¸€æ ·ï¼Œä¸€ç›´ç­‰åˆ°è¯¥æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œæ‰ç”± JVM ä»ç­‰å¾…é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªå¦ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œè¿™åªæ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„ç†è§£ã€‚å®é™…ä¸Šæ˜¯å€ŸåŠ©ç¡¬ä»¶çš„ç›¸å…³æŒ‡ä»¤æ¥å®ç°çš„ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹(æˆ–è€…è¯´åªæ˜¯åœ¨ç¡¬ä»¶çº§åˆ«ä¸Šé˜»å¡äº†)ã€‚å¯ä»¥å¯¹åŸºæœ¬æ•°æ®ã€æ•°ç»„ä¸­çš„åŸºæœ¬æ•°æ®ã€å¯¹ç±»ä¸­çš„åŸºæœ¬æ•°æ®è¿›è¡Œæ“ä½œã€‚åŸå­å˜é‡ç±»ç›¸å½“äºä¸€ç§æ³›åŒ–çš„ volatile å˜é‡ï¼Œèƒ½å¤Ÿæ”¯æŒåŸå­çš„å’Œæœ‰æ¡ä»¶çš„è¯»-æ”¹-å†™æ“ä½œã€‚</p> <h4 id="10161ä¼ ç»Ÿé”çš„é—®é¢˜">10.16.1ã€ä¼ ç»Ÿé”çš„é—®é¢˜<a class="headerlink" href="#10161ä¼ ç»Ÿé”çš„é—®é¢˜" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼šè®¡æ•°å™¨ï¼ˆCounterï¼‰ï¼Œé‡‡ç”¨Javaé‡Œæ¯”è¾ƒæ–¹ä¾¿çš„é”æœºåˆ¶synchronizedå…³é”®å­—ï¼Œåˆæ­¥çš„ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="kd">class</span> <span class="nc">Counter</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-5"><a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-108-6"><a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-108-7"><a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a>
</span><span id="__span-108-8"><a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">increment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-9"><a id="__codelineno-108-9" name="__codelineno-108-9" href="#__codelineno-108-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">++</span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-108-10"><a id="__codelineno-108-10" name="__codelineno-108-10" href="#__codelineno-108-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-108-11"><a id="__codelineno-108-11" name="__codelineno-108-11" href="#__codelineno-108-11"></a>
</span><span id="__span-108-12"><a id="__codelineno-108-12" name="__codelineno-108-12" href="#__codelineno-108-12"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">decrement</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-13"><a id="__codelineno-108-13" name="__codelineno-108-13" href="#__codelineno-108-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">--</span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-108-14"><a id="__codelineno-108-14" name="__codelineno-108-14" href="#__codelineno-108-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-108-15"><a id="__codelineno-108-15" name="__codelineno-108-15" href="#__codelineno-108-15"></a><span class="p">}</span><span class="w"> </span>
</span></code></pre></div> <p>synchronizedå…³é”®å­—æ˜¯åŸºäºé˜»å¡çš„é”æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰é”çš„æ—¶å€™ï¼Œè®¿é—®åŒä¸€èµ„æºçš„å…¶å®ƒçº¿ç¨‹éœ€è¦ç­‰å¾…ï¼Œç›´åˆ°è¯¥çº¿ç¨‹é‡Šæ”¾é”ï¼Œè¿™é‡Œä¼šæœ‰äº›é—®é¢˜ï¼šé¦–å…ˆï¼Œå¦‚æœè¢«é˜»å¡çš„çº¿ç¨‹ä¼˜å…ˆçº§å¾ˆé«˜å¾ˆé‡è¦æ€ä¹ˆåŠï¼Ÿå…¶æ¬¡ï¼Œå¦‚æœè·å¾—é”çš„çº¿ç¨‹ä¸€ç›´ä¸é‡Šæ”¾é”æ€ä¹ˆåŠï¼Ÿï¼ˆè¿™ç§æƒ…å†µæ˜¯éå¸¸ç³Ÿç³•çš„ï¼‰ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå¦‚æœæœ‰å¤§é‡çš„çº¿ç¨‹æ¥ç«äº‰èµ„æºï¼Œé‚£CPUå°†ä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´å’Œèµ„æºæ¥å¤„ç†è¿™äº›ç«äº‰ï¼ˆäº‹å®ä¸ŠCPUçš„ä¸»è¦å·¥ä½œå¹¶éè¿™äº›ï¼‰ï¼ŒåŒæ—¶ï¼Œè¿˜æœ‰å¯èƒ½å‡ºç°ä¸€äº›ä¾‹å¦‚æ­»é”ä¹‹ç±»çš„æƒ…å†µï¼Œæœ€åï¼Œå…¶å®é”æœºåˆ¶æ˜¯ä¸€ç§æ¯”è¾ƒç²—ç³™ï¼Œç²’åº¦æ¯”è¾ƒå¤§çš„æœºåˆ¶ï¼Œç›¸å¯¹äºåƒè®¡æ•°å™¨è¿™æ ·çš„éœ€æ±‚æœ‰ç‚¹å„¿è¿‡äºç¬¨é‡ï¼Œå› æ­¤ï¼Œå¯¹äºè¿™ç§éœ€æ±‚æˆ‘ä»¬æœŸå¾…ä¸€ç§æ›´åˆé€‚ã€æ›´é«˜æ•ˆçš„çº¿ç¨‹å®‰å…¨æœºåˆ¶ã€‚</p> <h4 id="10162cas">10.16.2ã€CAS<a class="headerlink" href="#10162cas" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>CASçš„è‹±æ–‡å•è¯æ˜¯ Compare and Swapï¼Œå³æ¯”è¾ƒå¹¶æ›¿æ¢ï¼Œæ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œæ˜¯ä¸€ç§è½»é‡çº§é”ï¼ŒJUC ä¸­å¾ˆå¤šå·¥å…·ç±»çš„å®ç°å°±æ˜¯åŸºäº CAS çš„ã€‚</p> <p>CAS æœ‰ä¸‰ä¸ªæ“ä½œæ•°ï¼Œå†…å­˜å€¼ Vï¼Œæ—§çš„é¢„æœŸå€¼ Eï¼Œè¦ä¿®æ”¹çš„æ–°å€¼ Uã€‚å½“ä¸”ä»…å½“é¢„æœŸå€¼ E å’Œå†…å­˜å€¼ V ç›¸ç­‰æ—¶ï¼Œå°†å†…å­˜å€¼Vä¿®æ”¹ä¸ºUï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšã€‚æ“ä½œçš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¿ç¨‹åœ¨è¯»å–æ•°æ®æ—¶ä¸è¿›è¡ŒåŠ é”ï¼Œåœ¨å‡†å¤‡å†™å›æ•°æ®æ—¶ï¼Œæ¯”è¾ƒåŸå€¼æ˜¯å¦ä¿®æ”¹ï¼Œè‹¥æœªè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹åˆ™å†™å›ï¼Œè‹¥å·²è¢«ä¿®æ”¹ï¼Œåˆ™é‡æ–°æ‰§è¡Œè¯»å–æµç¨‹ã€‚è¿™æ˜¯ä¸€ç§ä¹è§‚ç­–ç•¥ï¼Œè®¤ä¸ºå¹¶å‘æ“ä½œå¹¶ä¸æ€»ä¼šå‘ç”Ÿã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/640" data-desc-position="bottom"><img src="!assets/Java/640" alt="img" style="zoom: 67%;"></a></p> <p>çœ‹ä¸€ä¸ªä¾‹å­ï¼Œè§£é‡ŠCASçš„å®ç°è¿‡ç¨‹ï¼ˆå¹¶éçœŸå®çš„CASå®ç°ï¼‰ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="kd">class</span> <span class="nc">SimulatedCAS</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-109-7"><a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">compareAndSwap</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">expectedValue</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">newValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-109-8"><a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">oldValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-109-9"><a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">expectedValue</span><span class="p">)</span>
</span><span id="__span-109-10"><a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a><span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newValue</span><span class="p">;</span>
</span><span id="__span-109-11"><a id="__codelineno-109-11" name="__codelineno-109-11" href="#__codelineno-109-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">oldValue</span><span class="p">;</span>
</span><span id="__span-109-12"><a id="__codelineno-109-12" name="__codelineno-109-12" href="#__codelineno-109-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-109-13"><a id="__codelineno-109-13" name="__codelineno-109-13" href="#__codelineno-109-13"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨CASå®ç°çš„Counter</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CasCounter</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SimulatedCAS</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">getValue</span><span class="p">();</span>
</span><span id="__span-110-6"><a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-110-7"><a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a>
</span><span id="__span-110-8"><a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">increment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-9"><a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">oldValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">getValue</span><span class="p">();</span>
</span><span id="__span-110-10"><a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="na">compareAndSwap</span><span class="p">(</span><span class="n">oldValue</span><span class="p">,</span><span class="w"> </span><span class="n">oldValue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">oldValue</span><span class="p">)</span>
</span><span id="__span-110-11"><a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a><span class="w">            </span><span class="n">oldValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">getValue</span><span class="p">();</span>
</span><span id="__span-110-12"><a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">oldValue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-110-13"><a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-110-14"><a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a><span class="p">}</span>
</span></code></pre></div> <p>ä½†æ˜¯ CAS ä¸ä¸€å®šèƒ½ä¿è¯æ•°æ®æ²¡è¢«åˆ«çš„çº¿ç¨‹ä¿®æ”¹è¿‡ï¼Œæ¯”å¦‚å¾ˆç»å…¸çš„ ABA é—®é¢˜ã€‚</p> <p>æ‰€è°“çš„ ABA å°±æ˜¯è¯´æ¥äº†ä¸€ä¸ªçº¿ç¨‹æŠŠå€¼æ”¹å›äº† Bï¼Œåˆæ¥äº†ä¸€ä¸ªçº¿ç¨‹æŠŠå€¼åˆæ”¹å›äº† Aï¼Œå¯¹äºè¿™ä¸ªæ—¶å€™åˆ¤æ–­çš„çº¿ç¨‹ï¼Œå°±å‘ç°ä»–çš„å€¼è¿˜æ˜¯ Aï¼Œæ‰€ä»¥ä»–å°±ä¸çŸ¥é“è¿™ä¸ªå€¼åˆ°åº•æœ‰æ²¡æœ‰è¢«äººæ”¹è¿‡ï¼Œå…¶å®å¾ˆå¤šåœºæ™¯å¦‚æœåªè¿½æ±‚æœ€åç»“æœæ­£ç¡®ï¼Œè¿™æ˜¯æ²¡å…³ç³»çš„ã€‚</p> <p>ä½†æ˜¯å®é™…è¿‡ç¨‹ä¸­è¿˜æ˜¯éœ€è¦è®°å½•ä¿®æ”¹è¿‡ç¨‹çš„ï¼Œæ¯”å¦‚èµ„é‡‘ä¿®æ”¹ä»€ä¹ˆçš„ï¼Œä½ æ¯æ¬¡ä¿®æ”¹çš„éƒ½åº”è¯¥æœ‰è®°å½•ï¼Œæ–¹ä¾¿å›æº¯ã€‚</p> <p>è§£å†³æ–¹æ³•ï¼šç”¨ç‰ˆæœ¬å·å»ä¿è¯ï¼Œæ¯”å¦‚è¯´ï¼Œåœ¨ä¿®æ”¹å‰å»æŸ¥è¯¢ä»–åŸæ¥çš„å€¼çš„æ—¶å€™å†å¸¦ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡åˆ¤æ–­å°±è¿å€¼å’Œç‰ˆæœ¬å·ä¸€èµ·åˆ¤æ–­ï¼Œåˆ¤æ–­æˆåŠŸå°±ç»™ç‰ˆæœ¬å·åŠ 1ã€‚æ—¶é—´æˆ³ä¹Ÿå¯ä»¥ï¼ŒæŸ¥è¯¢çš„æ—¶å€™æŠŠæ—¶é—´æˆ³ä¸€èµ·æŸ¥å‡ºæ¥ï¼Œå¯¹çš„ä¸Šæ‰ä¿®æ”¹å¹¶ä¸”æ›´æ–°å€¼çš„æ—¶å€™ä¸€èµ·ä¿®æ”¹æ›´æ–°æ—¶é—´ï¼Œè¿™æ ·ä¹Ÿèƒ½ä¿è¯ã€‚</p> <h4 id="10163atomic-ç±»">10.16.3ã€Atomic ç±»<a class="headerlink" href="#10163atomic-ç±»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>åœ¨ JDK5.0 ä¹‹å‰ï¼Œæƒ³è¦å®ç°æ— é”æ— ç­‰å¾…çš„ç®—æ³•æ˜¯ä¸å¯èƒ½çš„ï¼Œé™¤éç”¨æœ¬åœ°åº“ï¼Œè‡ªä»æœ‰äº† Atomic å˜é‡ç±»åï¼Œè¿™æˆä¸ºå¯èƒ½ã€‚ä¸‹é¢è¿™å¼ å›¾æ˜¯java.util.concurrent.atomic åŒ…ä¸‹çš„ç±»ç»“æ„ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/Center-162821933664920" data-desc-position="bottom"><img src="!assets/Java/Center-162821933664920" alt="img" style></a></p> <ul> <li>æ ‡é‡ç±»ï¼šAtomicBooleanï¼ŒAtomicIntegerï¼ŒAtomicLongï¼ŒAtomicReference</li> <li>æ•°ç»„ç±»ï¼šAtomicIntegerArrayï¼ŒAtomicLongArrayï¼ŒAtomicReferenceArray</li> <li>æ›´æ–°å™¨ç±»ï¼šAtomicLongFieldUpdaterï¼ŒAtomicIntegerFieldUpdaterï¼ŒAtomicReferenceFieldUpdater</li> <li>å¤åˆå˜é‡ç±»ï¼šAtomicMarkableReferenceï¼ŒAtomicStampedReference</li> </ul> <p>ç¬¬ä¸€ç»„AtomicBooleanï¼ŒAtomicIntegerï¼ŒAtomicLongï¼ŒAtomicReferenceè¿™å››ç§åŸºæœ¬ç±»å‹ç”¨æ¥å¤„ç†å¸ƒå°”ï¼Œæ•´æ•°ï¼Œé•¿æ•´æ•°ï¼Œå¯¹è±¡å››ç§æ•°æ®ï¼Œå…¶å†…éƒ¨å®ç°ä¸æ˜¯ç®€å•çš„ä½¿ç”¨ synchronizedï¼Œè€Œæ˜¯ä¸€ä¸ªæ›´ä¸ºé«˜æ•ˆçš„æ–¹å¼ CAS (compare and swap) + volatile å’Œ nativeæ–¹æ³•ï¼Œä»è€Œé¿å…äº†synchronized çš„é«˜å¼€é”€ï¼Œæ‰§è¡Œæ•ˆç‡å¤§ä¸ºæå‡ã€‚æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼Œä¸æˆ‘ä»¬å¹³æ—¶ i++ æ‰€å¯¹åº”çš„åŸå­æ“ä½œä¸ºï¼šgetAndIncrement()</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="w">    </span><span class="n">AtomicInteger</span><span class="w"> </span><span class="n">ai</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AtomicInteger</span><span class="p">();</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">ai</span><span class="p">);</span>
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="w">    </span><span class="n">ai</span><span class="p">.</span><span class="na">getAndIncrement</span><span class="p">();</span>
</span><span id="__span-111-5"><a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">ai</span><span class="p">);</span>
</span><span id="__span-111-6"><a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a><span class="p">}</span>
</span></code></pre></div> <p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹AtomicIntegerçš„å®ç°ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="cm">/**</span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="cm">  * Atomically increments by one the current value.</span>
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="cm">  *</span>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="cm">  * @return the previous value</span>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="cm">  */</span>
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getAndIncrement</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-112-7"><a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">unsafe</span><span class="p">.</span><span class="na">getAndAddInt</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">valueOffset</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-112-8"><a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿™é‡Œç›´æ¥è°ƒç”¨ä¸€ä¸ªå« Unsafe çš„ç±»å»å¤„ç†ï¼Œè¿™ä¸ªç±»æ˜¯ç”¨äºæ‰§è¡Œä½çº§åˆ«ã€ä¸å®‰å…¨æ“ä½œçš„æ–¹æ³•é›†åˆã€‚å°½ç®¡è¿™ä¸ªç±»å’Œæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯å…¬å¼€çš„ï¼ˆpublicï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªç±»çš„ä½¿ç”¨ä»ç„¶å—é™ï¼Œä½ æ— æ³•åœ¨è‡ªå·±çš„ Java ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨è¯¥ç±»ï¼Œå› ä¸ºåªæœ‰æˆä¿¡çš„ä»£ç æ‰èƒ½è·å¾—è¯¥ç±»çš„å®ä¾‹ã€‚æ‰€ä»¥æˆ‘ä»¬å¹³æ—¶çš„ä»£ç æ˜¯æ— æ³•ä½¿ç”¨è¿™ä¸ªç±»çš„ï¼Œå› ä¸ºå…¶è®¾è®¡çš„æ“ä½œè¿‡äºååº•å±‚ï¼Œå¦‚è‹¥æ“ä½œä¸æ…å¯èƒ½ä¼šå¸¦æ¥å¾ˆå¤§çš„ç¾éš¾ï¼Œæ‰€ä»¥ç›´æ¥ç¦æ­¢æ™®é€šä»£ç çš„è®¿é—®ï¼Œå½“ç„¶JDKä½¿ç”¨æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p> <p><strong>Atomicä¸­çš„CAS</strong></p> <p>ä»å‰é¢çš„è§£é‡Šå¾—çŸ¥ï¼ŒCASçš„åŸç†æ˜¯æ‹¿æœŸæœ›çš„å€¼å’ŒåŸæœ¬çš„ä¸€ä¸ªå€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™æ›´æ–°æˆæ–°çš„å€¼ï¼Œæ­¤å¤„è¿™ä¸ªâ€œåŸæœ¬çš„ä¸€ä¸ªå€¼â€æ€ä¹ˆæ¥ï¼Œçœ‹çœ‹AtomicIntegeré‡Œçš„å®ç°ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="c1">// setup to use Unsafe.compareAndSwapInt for updates</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Unsafe</span><span class="w"> </span><span class="n">unsafe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Unsafe</span><span class="p">.</span><span class="na">getUnsafe</span><span class="p">();</span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">valueOffset</span><span class="p">;</span>
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a>
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="kd">static</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-7"><a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="w">        </span><span class="n">valueOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unsafe</span><span class="p">.</span><span class="na">objectFieldOffset</span>
</span><span id="__span-113-8"><a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a><span class="w">            </span><span class="p">(</span><span class="n">AtomicInteger</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">"value"</span><span class="p">));</span>
</span><span id="__span-113-9"><a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-113-10"><a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿™é‡Œç”¨åˆ°UnSafeçš„ä¸€ä¸ªæ–¹æ³•objectFieldOffset()ï¼ŒæŸ¥çœ‹æºç ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="cm">/**</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="cm">  * Report the location of a given static field, in conjunction with {@link</span>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a><span class="cm">  * #staticFieldBase}.</span>
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="cm">  * &lt;p&gt;Do not expect to perform any sort of arithmetic on this offset;</span>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="cm">  * it is just a cookie which is passed to the unsafe heap memory accessors.</span>
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="cm">  *</span>
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a><span class="cm">  * &lt;p&gt;Any given field will always have the same offset, and no two distinct</span>
</span><span id="__span-114-8"><a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a><span class="cm">  * fields of the same class will ever have the same offset.</span>
</span><span id="__span-114-9"><a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="cm">  *</span>
</span><span id="__span-114-10"><a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a><span class="cm">  * &lt;p&gt;As of 1.4.1, offsets for fields are represented as long values,</span>
</span><span id="__span-114-11"><a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a><span class="cm">  * although the Sun JVM does not use the most significant 32 bits.</span>
</span><span id="__span-114-12"><a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a><span class="cm">  * It is hard to imagine a JVM technology which needs more than</span>
</span><span id="__span-114-13"><a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a><span class="cm">  * a few bits to encode an offset within a non-array object,</span>
</span><span id="__span-114-14"><a id="__codelineno-114-14" name="__codelineno-114-14" href="#__codelineno-114-14"></a><span class="cm">  * However, for consistency with other methods in this class,</span>
</span><span id="__span-114-15"><a id="__codelineno-114-15" name="__codelineno-114-15" href="#__codelineno-114-15"></a><span class="cm">  * this method reports its result as a long value.</span>
</span><span id="__span-114-16"><a id="__codelineno-114-16" name="__codelineno-114-16" href="#__codelineno-114-16"></a><span class="cm">  * @see #getInt(Object, long)</span>
</span><span id="__span-114-17"><a id="__codelineno-114-17" name="__codelineno-114-17" href="#__codelineno-114-17"></a><span class="cm">  */</span>
</span><span id="__span-114-18"><a id="__codelineno-114-18" name="__codelineno-114-18" href="#__codelineno-114-18"></a><span class="kd">public</span><span class="w"> </span><span class="kd">native</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">objectFieldOffset</span><span class="p">(</span><span class="n">Field</span><span class="w"> </span><span class="n">f</span><span class="p">);</span>
</span></code></pre></div> <p>è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥æ‹¿åˆ°æˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„è¿™ä¸ªâ€œåŸæ¥çš„å€¼â€çš„å†…å­˜åœ°å€ã€‚æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œè¿”å›å€¼æ˜¯ valueOffsetã€‚å®ƒçš„å‚æ•° field å°±æ˜¯AtomicInteger é‡Œå®šä¹‰çš„ value å±æ€§ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="kd">private</span><span class="w"> </span><span class="kd">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a>
</span><span id="__span-115-3"><a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="cm">/**</span>
</span><span id="__span-115-4"><a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a><span class="cm">  * Creates a new AtomicInteger with the given initial value.</span>
</span><span id="__span-115-5"><a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="cm">  *</span>
</span><span id="__span-115-6"><a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a><span class="cm">  * @param initialValue the initial value</span>
</span><span id="__span-115-7"><a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a><span class="cm">  */</span>
</span><span id="__span-115-8"><a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a><span class="kd">public</span><span class="w"> </span><span class="nf">AtomicInteger</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">initialValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-115-9"><a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a><span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initialValue</span><span class="p">;</span>
</span><span id="__span-115-10"><a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a><span class="p">}</span>
</span><span id="__span-115-11"><a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a>
</span><span id="__span-115-12"><a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a><span class="cm">/**</span>
</span><span id="__span-115-13"><a id="__codelineno-115-13" name="__codelineno-115-13" href="#__codelineno-115-13"></a><span class="cm">  * Creates a new AtomicInteger with initial value {@code 0}.</span>
</span><span id="__span-115-14"><a id="__codelineno-115-14" name="__codelineno-115-14" href="#__codelineno-115-14"></a><span class="cm">  */</span>
</span><span id="__span-115-15"><a id="__codelineno-115-15" name="__codelineno-115-15" href="#__codelineno-115-15"></a><span class="kd">public</span><span class="w"> </span><span class="nf">AtomicInteger</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div> <p>value æ˜¯ä¸€ä¸ª volatile å˜é‡ï¼Œåœ¨å†…å­˜ä¸­å¯è§ï¼Œä»»ä½•çº¿ç¨‹éƒ½ä¸å…è®¸å¯¹å…¶è¿›è¡Œæ‹·è´ï¼Œå› æ­¤ JVM å¯ä»¥ä¿è¯ä»»ä½•æ—¶åˆ»ä»»ä½•çº¿ç¨‹æ€»èƒ½æ‹¿åˆ°è¯¥å˜é‡çš„æœ€æ–°å€¼ã€‚æ­¤å¤„ value çš„å€¼ï¼Œå¯ä»¥åœ¨ AtomicInteger ç±»åˆå§‹åŒ–çš„æ—¶å€™ä¼ å…¥ï¼Œä¹Ÿå¯ä»¥ç•™ç©ºï¼Œç•™ç©ºåˆ™è‡ªåŠ¨èµ‹å€¼ä¸º0ã€‚</p> <p>æˆ‘ä»¬å†å›åˆ°CASï¼Œçœ‹çœ‹getAndIncrement()æ–¹æ³•æ˜¯æ€ä¹ˆåˆ©ç”¨CASå®ç°çš„ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="cm">/**</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="cm">  * Atomically increments by one the current value.</span>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="cm">  *</span>
</span><span id="__span-116-4"><a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a><span class="cm">  * @return the previous value</span>
</span><span id="__span-116-5"><a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a><span class="cm">  */</span>
</span><span id="__span-116-6"><a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getAndIncrement</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-116-7"><a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">unsafe</span><span class="p">.</span><span class="na">getAndAddInt</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">valueOffset</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-116-8"><a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a><span class="p">}</span>
</span></code></pre></div> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getAndAddInt</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">delta</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a><span class="w">        </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getIntVolatile</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span><span class="c1">//------------0---------------</span>
</span><span id="__span-117-5"><a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">compareAndSwapInt</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">delta</span><span class="p">));</span><span class="c1">//-------------1-------------</span>
</span><span id="__span-117-6"><a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
</span><span id="__span-117-7"><a id="__codelineno-117-7" name="__codelineno-117-7" href="#__codelineno-117-7"></a><span class="p">}</span>
</span></code></pre></div> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="cm">/**</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="cm">  * Atomically update Java variable to &lt;tt&gt;x&lt;/tt&gt; if it is currently</span>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="cm">  * holding &lt;tt&gt;expected&lt;/tt&gt;.</span>
</span><span id="__span-118-4"><a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a><span class="cm">  * @return &lt;tt&gt;true&lt;/tt&gt; if successful</span>
</span><span id="__span-118-5"><a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a><span class="cm">  */</span>
</span><span id="__span-118-6"><a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">native</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">compareAndSwapInt</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="c1">//---------------2--------------</span>
</span><span id="__span-118-7"><a id="__codelineno-118-7" name="__codelineno-118-7" href="#__codelineno-118-7"></a><span class="w">                                              </span><span class="kt">int</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span>
</span><span id="__span-118-8"><a id="__codelineno-118-8" name="__codelineno-118-8" href="#__codelineno-118-8"></a><span class="w">                                              </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
</span></code></pre></div> <p>æˆ‘ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œå…¶å®compareAndSwapIntçš„æ³¨é‡Šè§£é‡Šçš„å¾ˆæ˜ç¡®ï¼ŒåŸå­çš„å°†å˜é‡çš„å€¼æ›´æ–°ä¸ºxï¼Œå¦‚æœæˆåŠŸäº†è¿”å›trueï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»ºAtomicIntegerå®ä¾‹æ—¶ä¸ä¼ å…¥å‚æ•°ï¼Œåˆ™åŸå§‹å˜é‡çš„å€¼å³ä¸º0ï¼Œæ‰€ä»¥ä¸Šé¢//----------0-----------å¤„å¾—åˆ°çš„vçš„å€¼å³ä¸º0,1å¤„çš„ä»£ç ä¸ºï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">compareAndSwapInt</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span></code></pre></div> <p>æˆ‘ä»¬çŸ¥é“offsetæŒ‡å‘çš„åœ°å€å¯¹åº”çš„å€¼å°±æ˜¯åŸå§‹å˜é‡çš„åˆå€¼0ï¼Œæ‰€ä»¥ä¸æœŸæœ›çš„å€¼0ç›¸åŒï¼Œæ‰€ä»¥å°†åˆå€¼èµ‹å€¼ä¸º1ï¼Œè¿”å›trueï¼Œå–ååä¸ºfalseï¼Œå¾ªç¯ç»“æŸï¼Œè¿”å›vå³æ›´æ–°ä¹‹å‰çš„å€¼0. è¿™å°±æ˜¯ç±»ä¼¼äºi++æ“ä½œçš„åŸå­æ“ä½œçš„å®ç°ï¼Œå½“ç„¶æœ€ç»ˆCASçš„å®ç°éƒ½æ˜¯nativeçš„ï¼Œç”¨Cè¯­è¨€å®ç°çš„ï¼Œæˆ‘ä»¬è¿™é‡Œçœ‹ä¸åˆ°æºç .</p> <p><strong>CASçº¿ç¨‹å®‰å…¨</strong></p> <p>è¯´äº†åŠå¤©ï¼Œæˆ‘ä»¬è¦å›å½’åˆ°æœ€åŸå§‹çš„é—®é¢˜äº†ï¼šè¿™æ ·æ€ä¹ˆå®ç°çº¿ç¨‹å®‰å…¨å‘¢ï¼Ÿè¯·å¤§å®¶è‡ªå·±å…ˆè€ƒè™‘ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®æˆ‘ä»¬åœ¨è¯­è¨€å±‚é¢æ˜¯æ²¡æœ‰åšä»»ä½•åŒæ­¥çš„æ“ä½œçš„ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥çœ‹åˆ°æºç æ²¡æœ‰ä»»ä½•é”åŠ åœ¨ä¸Šé¢ï¼Œå¯å®ƒä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨çš„å‘¢ï¼Ÿè¿™å°±æ˜¯AtomicåŒ…ä¸‹è¿™äº›ç±»çš„å¥¥ç§˜ï¼šè¯­è¨€å±‚é¢ä¸åšå¤„ç†ï¼Œæˆ‘ä»¬å°†å…¶äº¤ç»™ç¡¬ä»¶â€”CPUå’Œå†…å­˜ï¼Œåˆ©ç”¨CPUçš„å¤šå¤„ç†èƒ½åŠ›ï¼Œå®ç°ç¡¬ä»¶å±‚é¢çš„é˜»å¡ï¼Œå†åŠ ä¸Švolatileå˜é‡çš„ç‰¹æ€§å³å¯å®ç°åŸºäºåŸå­æ“ä½œçš„çº¿ç¨‹å®‰å…¨ã€‚æ‰€ä»¥è¯´ï¼ŒCASå¹¶ä¸æ˜¯æ— é˜»å¡ï¼Œåªæ˜¯é˜»å¡å¹¶éåœ¨è¯­è¨€ã€çº¿ç¨‹æ–¹é¢ï¼Œè€Œæ˜¯åœ¨ç¡¬ä»¶å±‚é¢ï¼Œæ‰€ä»¥æ— ç–‘è¿™æ ·çš„æ“ä½œä¼šæ›´å¿«æ›´é«˜æ•ˆï¼</p> <h2 id="11åå°„æœºåˆ¶">11ã€åå°„æœºåˆ¶<a class="headerlink" href="#11åå°„æœºåˆ¶" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <h3 id="111åå°„æœºåˆ¶çš„åŸºæœ¬æ¦‚å¿µ">11.1ã€åå°„æœºåˆ¶çš„åŸºæœ¬æ¦‚å¿µ<a class="headerlink" href="#111åå°„æœºåˆ¶çš„åŸºæœ¬æ¦‚å¿µ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å…ˆäº†è§£ä¸¤ä¸ªæ¦‚å¿µï¼Œç¼–è¯‘æœŸå’Œè¿è¡ŒæœŸã€‚</p> <p>==ç¼–è¯‘æœŸ==æ˜¯æŒ‡æŠŠæºç äº¤ç»™ç¼–è¯‘å™¨ç¼–è¯‘æˆè®¡ç®—æœºå¯ä»¥æ‰§è¡Œçš„æ–‡ä»¶çš„è¿‡ç¨‹ã€‚åœ¨ Java ä¸­ä¹Ÿå°±æ˜¯æŠŠ Java ä»£ç ç¼–æˆ class æ–‡ä»¶çš„è¿‡ç¨‹ã€‚ç¼–è¯‘æœŸåªæ˜¯åšäº†ä¸€äº›ç¿»è¯‘åŠŸèƒ½ï¼Œå¹¶æ²¡æœ‰æŠŠä»£ç æ”¾åœ¨å†…å­˜ä¸­è¿è¡Œèµ·æ¥ï¼Œè€Œåªæ˜¯æŠŠä»£ç å½“æˆæ–‡æœ¬è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚æ£€æŸ¥é”™è¯¯ã€‚</p> <p>==è¿è¡ŒæœŸ==æ˜¯æŠŠç¼–è¯‘åçš„æ–‡ä»¶äº¤ç»™è®¡ç®—æœºæ‰§è¡Œï¼Œç›´åˆ°ç¨‹åºè¿è¡Œç»“æŸã€‚æ‰€è°“è¿è¡ŒæœŸå°±æŠŠåœ¨ç£ç›˜ä¸­çš„ä»£ç æ”¾åˆ°å†…å­˜ä¸­æ‰§è¡Œèµ·æ¥ã€‚</p> <p>Java åå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º Java è¯­è¨€çš„åå°„æœºåˆ¶ã€‚ç®€å•æ¥è¯´ï¼Œåå°„æœºåˆ¶æŒ‡çš„æ˜¯ç¨‹åºåœ¨è¿è¡Œæ—¶èƒ½å¤Ÿè·å–è‡ªèº«çš„ä¿¡æ¯ã€‚åœ¨ Java ä¸­ï¼Œåªè¦ç»™å®šç±»çš„åå­—ï¼Œå°±å¯ä»¥é€šè¿‡åå°„æœºåˆ¶æ¥è·å¾—ç±»çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p> <p>Java åå°„æœºåˆ¶åœ¨æœåŠ¡å™¨ç¨‹åºå’Œä¸­é—´ä»¶ç¨‹åºä¸­å¾—åˆ°äº†å¹¿æ³›è¿ç”¨ã€‚åœ¨æœåŠ¡å™¨ç«¯ï¼Œå¾€å¾€éœ€è¦æ ¹æ®å®¢æˆ·çš„è¯·æ±‚ï¼ŒåŠ¨æ€è°ƒç”¨æŸä¸€ä¸ªå¯¹è±¡çš„ç‰¹å®šæ–¹æ³•ã€‚æ­¤å¤–ï¼Œ<mark>åœ¨ ORM ä¸­é—´ä»¶çš„å®ç°ä¸­ï¼Œè¿ç”¨ Java åå°„æœºåˆ¶å¯ä»¥è¯»å–ä»»æ„ä¸€ä¸ª JavaBean çš„æ‰€æœ‰å±æ€§ï¼Œæˆ–è€…ç»™è¿™äº›å±æ€§èµ‹å€¼ã€‚</mark></p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/5-19121314235A02.png" data-desc-position="bottom"><img src="!assets/Java/5-19121314235A02.png" alt="img" style="zoom:80%;"></a></p> <p>Java åå°„æœºåˆ¶ä¸»è¦æä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½éƒ½ä½äº<code>java.lang.reflect</code>åŒ…ã€‚</p> <ul> <li>åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªå¯¹è±¡æ‰€å±çš„ç±»ã€‚</li> <li>åœ¨è¿è¡Œæ—¶æ„é€ ä»»æ„ä¸€ä¸ªç±»çš„å¯¹è±¡ã€‚</li> <li>åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªç±»æ‰€å…·æœ‰çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚</li> <li>åœ¨è¿è¡Œæ—¶è°ƒç”¨ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚</li> <li>ç”ŸæˆåŠ¨æ€ä»£ç†ã€‚</li> </ul> <p>è¦æƒ³çŸ¥é“ä¸€ä¸ªç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œå¿…é¡»å…ˆè·å–åˆ°è¯¥ç±»çš„å­—èŠ‚ç æ–‡ä»¶å¯¹è±¡ã€‚è·å–ç±»çš„ä¿¡æ¯æ—¶ï¼Œä½¿ç”¨çš„å°±æ˜¯ Class ç±»ä¸­çš„æ–¹æ³•ã€‚æ‰€ä»¥å…ˆè¦è·å–åˆ°æ¯ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶ï¼ˆ.classï¼‰å¯¹åº”çš„ Class ç±»å‹çš„å¯¹è±¡ã€‚</p> <p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ‰€æœ‰ Java ç±»å‡ç»§æ‰¿äº† Object ç±»ï¼Œåœ¨ Object ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ª getClass() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›åŒä¸€ä¸ªç±»å‹ä¸º Class çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="n">Class</span><span class="w"> </span><span class="n">labelCls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">label1</span><span class="p">.</span><span class="na">getClass</span><span class="p">();</span><span class="w">    </span><span class="c1">// label1ä¸º JLabel ç±»çš„å¯¹è±¡</span>
</span></code></pre></div> <p>åˆ©ç”¨ Class ç±»çš„å¯¹è±¡ labelCls å¯ä»¥è®¿é—® labelCls å¯¹è±¡çš„æè¿°ä¿¡æ¯ã€JLabel ç±»çš„ä¿¡æ¯ä»¥åŠåŸºç±» Object çš„ä¿¡æ¯ã€‚ä¸‹è¡¨åˆ—å‡ºäº†é€šè¿‡åå°„å¯ä»¥è®¿é—®çš„ä¿¡æ¯ã€‚</p> <table> <thead> <tr> <th>ç±»å‹</th> <th>è®¿é—®æ–¹æ³•</th> <th>è¿”å›å€¼ç±»å‹</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>åŒ…è·¯å¾„</td> <td>getPackage()</td> <td>Package å¯¹è±¡</td> <td>è·å–è¯¥ç±»çš„å­˜æ”¾è·¯å¾„</td> </tr> <tr> <td>ç±»åç§°</td> <td>getName()</td> <td>String å¯¹è±¡</td> <td>è·å–è¯¥ç±»çš„åç§°</td> </tr> <tr> <td>ç»§æ‰¿ç±»</td> <td>getSuperclass()</td> <td>Class å¯¹è±¡</td> <td>è·å–è¯¥ç±»ç»§æ‰¿çš„ç±»</td> </tr> <tr> <td>å®ç°æ¥å£</td> <td>getlnterfaces()</td> <td>Class å‹æ•°ç»„</td> <td>è·å–è¯¥ç±»å®ç°çš„æ‰€æœ‰æ¥å£</td> </tr> <tr> <td>æ„é€ æ–¹æ³•</td> <td>getConstructors()</td> <td>Constructor å‹æ•°ç»„</td> <td>è·å–æ‰€æœ‰æƒé™ä¸º public çš„æ„é€ æ–¹æ³•</td> </tr> <tr> <td></td> <td>getDeclaredContruectors()</td> <td>Constructor å¯¹è±¡</td> <td>è·å–å½“å‰å¯¹è±¡çš„æ‰€æœ‰æ„é€ æ–¹æ³•</td> </tr> <tr> <td>æ–¹æ³•</td> <td>getMethods()</td> <td>Methods å‹æ•°ç»„</td> <td>è·å–æ‰€æœ‰æƒé™ä¸º public çš„æ–¹æ³•</td> </tr> <tr> <td></td> <td>getDeclaredMethods()</td> <td>Methods å¯¹è±¡</td> <td>è·å–å½“å‰å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•</td> </tr> <tr> <td>æˆå‘˜å˜é‡</td> <td>getFields()</td> <td>Field å‹æ•°ç»„</td> <td>è·å–æ‰€æœ‰æƒé™ä¸º public çš„æˆå‘˜å˜é‡</td> </tr> <tr> <td></td> <td>getDeclareFileds()</td> <td>Field å¯¹è±¡</td> <td>è·å–å½“å‰å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜å˜é‡</td> </tr> <tr> <td>å†…éƒ¨ç±»</td> <td>getClasses()</td> <td>Class å‹æ•°ç»„</td> <td>è·å–æ‰€æœ‰æƒé™ä¸º public çš„å†…éƒ¨ç±»</td> </tr> <tr> <td></td> <td>getDeclaredClasses()</td> <td>Class å‹æ•°ç»„</td> <td>è·å–æ‰€æœ‰å†…éƒ¨ç±»</td> </tr> <tr> <td>å†…éƒ¨ç±»çš„å£°æ˜ç±»</td> <td>getDeclaringClass()</td> <td>Class å¯¹è±¡</td> <td>å¦‚æœè¯¥ç±»ä¸ºå†…éƒ¨ç±»ï¼Œåˆ™è¿”å›å®ƒçš„æˆå‘˜ç±»ï¼Œå¦åˆ™è¿”å› null</td> </tr> </tbody> </table> <p>åœ¨è°ƒç”¨ getFields() å’Œ getMethods() æ–¹æ³•æ—¶å°†ä¼šä¾æ¬¡è·å–æƒé™ä¸º public çš„å­—æ®µå’Œå˜é‡ï¼Œç„¶åå°†åŒ…å«ä»è¶…ç±»ä¸­ç»§æ‰¿åˆ°çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚è€Œé€šè¿‡ getDeclareFields() å’Œ getDeclareMethod() åªæ˜¯è·å–åœ¨æœ¬ç±»ä¸­å®šä¹‰çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚</p> <hr> <p><strong>Java åå°„æœºåˆ¶çš„ä¼˜ç¼ºç‚¹</strong></p> <p>ä¼˜ç‚¹ï¼š</p> <ul> <li>èƒ½å¤Ÿè¿è¡Œæ—¶åŠ¨æ€è·å–ç±»çš„å®ä¾‹ï¼Œå¤§å¤§æé«˜ç³»ç»Ÿçš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚</li> <li>ä¸ Java åŠ¨æ€ç¼–è¯‘ç›¸ç»“åˆï¼Œå¯ä»¥å®ç°æ— æ¯”å¼ºå¤§çš„åŠŸèƒ½ã€‚</li> <li>å¯¹äº Java è¿™ç§å…ˆç¼–è¯‘å†è¿è¡Œçš„è¯­è¨€ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„åˆ›å»ºçµæ´»çš„ä»£ç ï¼Œè¿™äº›ä»£ç å¯ä»¥åœ¨è¿è¡Œæ—¶è£…é…ï¼Œæ— éœ€åœ¨ç»„ä»¶ä¹‹é—´è¿›è¡Œæºä»£ç çš„é“¾æ¥ï¼Œæ›´åŠ å®¹æ˜“å®ç°é¢å‘å¯¹è±¡ã€‚</li> </ul> <p>ç¼ºç‚¹ï¼š</p> <ul> <li>åå°„ä¼šæ¶ˆè€—ä¸€å®šçš„ç³»ç»Ÿèµ„æºï¼Œå› æ­¤ï¼Œå¦‚æœä¸éœ€è¦åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ç”¨åå°„ï¼›</li> <li>åå°„è°ƒç”¨æ–¹æ³•æ—¶å¯ä»¥å¿½ç•¥æƒé™æ£€æŸ¥ï¼Œè·å–è¿™ä¸ªç±»çš„ç§æœ‰æ–¹æ³•å’Œå±æ€§ï¼Œå› æ­¤å¯èƒ½ä¼šç ´åç±»çš„å°è£…æ€§è€Œå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚</li> </ul> <h3 id="112åå°„æœºåˆ¶api">11.2ã€åå°„æœºåˆ¶API<a class="headerlink" href="#112åå°„æœºåˆ¶api" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <h4 id="1121javalangclass-ç±»">11.2.1ã€java.lang.Class ç±»<a class="headerlink" href="#1121javalangclass-ç±»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>java.lang.Class ç±»æ˜¯å®ç°åå°„çš„å…³é”®æ‰€åœ¨ï¼ŒClass ç±»çš„ä¸€ä¸ªå®ä¾‹è¡¨ç¤º Java çš„ä¸€ç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬ç±»ã€æ¥å£ã€æšä¸¾ã€æ³¨è§£ï¼ˆAnnotationï¼‰ã€æ•°ç»„ã€åŸºæœ¬æ•°æ®ç±»å‹å’Œ voidã€‚Class æ²¡æœ‰å…¬æœ‰çš„æ„é€ æ–¹æ³•ï¼ŒClass å®ä¾‹æ˜¯ç”± JVM åœ¨ç±»åŠ è½½æ—¶è‡ªåŠ¨åˆ›å»ºçš„ã€‚</p> <p>åœ¨ç¨‹åºä»£ç ä¸­è·å¾— Class å®ä¾‹å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç å®ç°ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="c1">// 1. é€šè¿‡ç±»å‹classé™æ€å˜é‡</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="n">Class</span><span class="w"> </span><span class="n">clz1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">;</span>
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hello"</span><span class="p">;</span>
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="c1">// 2. é€šè¿‡å¯¹è±¡çš„getClass()æ–¹æ³•</span>
</span><span id="__span-121-5"><a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a><span class="n">Class</span><span class="w"> </span><span class="n">clz2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="p">.</span><span class="na">getClass</span><span class="p">();</span>
</span><span id="__span-121-6"><a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a><span class="c1">// 3. é€šè¿‡Classçš„forName()æ–¹æ³•</span>
</span><span id="__span-121-7"><a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="n">Class</span><span class="w"> </span><span class="n">clz3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">String</span><span class="p">);</span>
</span></code></pre></div> <p>æ¯ä¸€ç§ç±»å‹åŒ…æ‹¬ç±»å’Œæ¥å£ç­‰ï¼Œéƒ½æœ‰ä¸€ä¸ª class é™æ€å˜é‡å¯ä»¥è·å¾— Class å®ä¾‹ã€‚å¦å¤–ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ getClass() æ–¹æ³•å¯ä»¥è·å¾— Class å®ä¾‹ï¼Œè¯¥æ–¹æ³•æ˜¯ç”± Object ç±»æä¾›çš„å®ä¾‹æ–¹æ³•ã€‚</p> <p>Class ç±»æä¾›äº†å¾ˆå¤šæ–¹æ³•å¯ä»¥è·å¾—è¿è¡Œæ—¶å¯¹è±¡çš„ç›¸å…³ä¿¡æ¯ï¼Œä¸‹é¢çš„ç¨‹åºä»£ç å±•ç¤ºäº†å…¶ä¸­ä¸€äº›æ–¹æ³•ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ReflectionTest01</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="w">        </span><span class="c1">// è·å¾—Classå®ä¾‹</span>
</span><span id="__span-122-4"><a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="w">        </span><span class="c1">// 1.é€šè¿‡ç±»å‹classé™æ€å˜é‡</span>
</span><span id="__span-122-5"><a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="w">        </span><span class="n">Class</span><span class="w"> </span><span class="n">clz1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">;</span>
</span><span id="__span-122-6"><a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hello"</span><span class="p">;</span>
</span><span id="__span-122-7"><a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="w">        </span><span class="c1">// 2.é€šè¿‡å¯¹è±¡çš„getClass()æ–¹æ³•</span>
</span><span id="__span-122-8"><a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a><span class="w">        </span><span class="n">Class</span><span class="w"> </span><span class="n">clz2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="p">.</span><span class="na">getClass</span><span class="p">();</span>
</span><span id="__span-122-9"><a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="w">        </span><span class="c1">// è·å¾—intç±»å‹Classå®ä¾‹</span>
</span><span id="__span-122-10"><a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a><span class="w">        </span><span class="n">Class</span><span class="w"> </span><span class="n">clz3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">.</span><span class="na">class</span><span class="p">;</span>
</span><span id="__span-122-11"><a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="w">        </span><span class="c1">// è·å¾—Integerç±»å‹Classå®ä¾‹</span>
</span><span id="__span-122-12"><a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a><span class="w">        </span><span class="n">Class</span><span class="w"> </span><span class="n">clz4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">class</span><span class="p">;</span>
</span><span id="__span-122-13"><a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"clz2ç±»åç§°ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">clz2</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
</span><span id="__span-122-14"><a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"clz2æ˜¯å¦ä¸ºæ¥å£ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">clz2</span><span class="p">.</span><span class="na">isInterface</span><span class="p">());</span>
</span><span id="__span-122-15"><a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"clz2æ˜¯å¦ä¸ºæ•°ç»„å¯¹è±¡ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">clz2</span><span class="p">.</span><span class="na">isArray</span><span class="p">());</span>
</span><span id="__span-122-16"><a id="__codelineno-122-16" name="__codelineno-122-16" href="#__codelineno-122-16"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"clz2çˆ¶ç±»åç§°ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">clz2</span><span class="p">.</span><span class="na">getSuperclass</span><span class="p">().</span><span class="na">getName</span><span class="p">());</span>
</span><span id="__span-122-17"><a id="__codelineno-122-17" name="__codelineno-122-17" href="#__codelineno-122-17"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"clz2æ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">clz2</span><span class="p">.</span><span class="na">isPrimitive</span><span class="p">());</span>
</span><span id="__span-122-18"><a id="__codelineno-122-18" name="__codelineno-122-18" href="#__codelineno-122-18"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"clz3æ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">clz3</span><span class="p">.</span><span class="na">isPrimitive</span><span class="p">());</span>
</span><span id="__span-122-19"><a id="__codelineno-122-19" name="__codelineno-122-19" href="#__codelineno-122-19"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"clz4æ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">clz4</span><span class="p">.</span><span class="na">isPrimitive</span><span class="p">());</span>
</span><span id="__span-122-20"><a id="__codelineno-122-20" name="__codelineno-122-20" href="#__codelineno-122-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-122-21"><a id="__codelineno-122-21" name="__codelineno-122-21" href="#__codelineno-122-21"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="n">clz2ç±»åç§°</span><span class="err">ï¼š</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">String</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="n">clz2æ˜¯å¦ä¸ºæ¥å£</span><span class="err">ï¼š</span><span class="kc">false</span>
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="n">clz2æ˜¯å¦ä¸ºæ•°ç»„å¯¹è±¡</span><span class="err">ï¼š</span><span class="kc">false</span>
</span><span id="__span-123-4"><a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="n">clz2çˆ¶ç±»åç§°</span><span class="err">ï¼š</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span>
</span><span id="__span-123-5"><a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a><span class="n">clz2æ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹</span><span class="err">ï¼š</span><span class="kc">false</span>
</span><span id="__span-123-6"><a id="__codelineno-123-6" name="__codelineno-123-6" href="#__codelineno-123-6"></a><span class="n">clz3æ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹</span><span class="err">ï¼š</span><span class="kc">true</span>
</span><span id="__span-123-7"><a id="__codelineno-123-7" name="__codelineno-123-7" href="#__codelineno-123-7"></a><span class="n">clz4æ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹</span><span class="err">ï¼š</span><span class="kc">false</span>
</span></code></pre></div> <p>æ³¨æ„ä¸Šè¿°ä»£ç ç¬¬ 10 è¡Œå’Œç¬¬ 12 è¡Œçš„åŒºåˆ«ã€‚int æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥è¾“å‡ºç»“æœä¸º trueï¼›Integer æ˜¯ç±»ï¼Œæ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥è¾“å‡ºç»“æœä¸º falseã€‚</p> <h4 id="1122javalangreflect-åŒ…">11.2.2ã€java.lang.reflect åŒ…<a class="headerlink" href="#1122javalangreflect-åŒ…" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>java.lang.reflect åŒ…æä¾›äº†åå°„ä¸­ç”¨åˆ°ç±»ï¼Œä¸»è¦çš„ç±»è¯´æ˜å¦‚ä¸‹ï¼š</p> <ul> <li> <p>Constructor ç±»ï¼šæä¾›ç±»çš„æ„é€ æ–¹æ³•ä¿¡æ¯ã€‚</p> </li> <li> <p>Field ç±»ï¼šæä¾›ç±»æˆ–æ¥å£ä¸­æˆå‘˜å˜é‡ä¿¡æ¯ã€‚</p> </li> <li> <p>Method ç±»ï¼šæä¾›ç±»æˆ–æ¥å£æˆå‘˜æ–¹æ³•ä¿¡æ¯ã€‚</p> </li> <li> <p>Array ç±»ï¼šæä¾›äº†åŠ¨æ€åˆ›å»ºå’Œè®¿é—® Java æ•°ç»„çš„æ–¹æ³•ã€‚</p> <ul> <li>static Object newInstance(Class&lt;?&gt; componentType, intâ€¦length)ï¼šåˆ›å»ºä¸€ä¸ªå…·æœ‰æŒ‡å®šçš„å…ƒç´ ç±»å‹ã€æŒ‡å®šç»´åº¦çš„æ–°æ•°ç»„ã€‚</li> <li>static xxx getXxx(Object array, int index)ï¼šè¿”å› array æ•°ç»„ä¸­ç¬¬ index ä¸ªå…ƒç´ ã€‚å…¶ä¸­ xxx æ˜¯å„ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¦‚æœæ•°ç»„å…ƒç´ æ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ™è¯¥æ–¹æ³•å˜ä¸º get(Object array, int index)ã€‚</li> <li>static void setXxx(Object array, int index, xxx val)ï¼šå°† array æ•°ç»„ä¸­ç¬¬ index ä¸ªå…ƒç´ çš„å€¼è®¾ä¸º valã€‚</li> </ul> <p>å…¶ä¸­ xxx æ˜¯å„ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¦‚æœæ•°ç»„å…ƒç´ æ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ™è¯¥æ–¹æ³•å˜æˆ set(Object array, int index, Object val)ã€‚</p> </li> <li> <p>Modifier ç±»ï¼šæä¾›ç±»å’Œæˆå‘˜è®¿é—®ä¿®é¥°ç¬¦ä¿¡æ¯ã€‚</p> </li> </ul> <p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ReflectionTest02</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="w">            </span><span class="c1">// åŠ¨æ€åŠ è½½xxç±»çš„è¿è¡Œæ—¶å¯¹è±¡</span>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="w">            </span><span class="n">Class</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">"java.lang.String"</span><span class="p">);</span>
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a><span class="w">            </span><span class="c1">// è·å–æˆå‘˜æ–¹æ³•é›†åˆ</span>
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a><span class="w">            </span><span class="n">Method</span><span class="o">[]</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="na">getDeclaredMethods</span><span class="p">();</span>
</span><span id="__span-124-8"><a id="__codelineno-124-8" name="__codelineno-124-8" href="#__codelineno-124-8"></a><span class="w">            </span><span class="c1">// éå†æˆå‘˜æ–¹æ³•é›†åˆ</span>
</span><span id="__span-124-9"><a id="__codelineno-124-9" name="__codelineno-124-9" href="#__codelineno-124-9"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">methods</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-124-10"><a id="__codelineno-124-10" name="__codelineno-124-10" href="#__codelineno-124-10"></a><span class="w">                </span><span class="c1">// æ‰“å°æƒé™ä¿®é¥°ç¬¦ï¼Œå¦‚publicã€protectedã€private</span>
</span><span id="__span-124-11"><a id="__codelineno-124-11" name="__codelineno-124-11" href="#__codelineno-124-11"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="n">Modifier</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="na">getModifiers</span><span class="p">()));</span>
</span><span id="__span-124-12"><a id="__codelineno-124-12" name="__codelineno-124-12" href="#__codelineno-124-12"></a><span class="w">                </span><span class="c1">// æ‰“å°è¿”å›å€¼ç±»å‹åç§°</span>
</span><span id="__span-124-13"><a id="__codelineno-124-13" name="__codelineno-124-13" href="#__codelineno-124-13"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">" "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getReturnType</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" "</span><span class="p">);</span>
</span><span id="__span-124-14"><a id="__codelineno-124-14" name="__codelineno-124-14" href="#__codelineno-124-14"></a><span class="w">                </span><span class="c1">// æ‰“å°æ–¹æ³•åç§°</span>
</span><span id="__span-124-15"><a id="__codelineno-124-15" name="__codelineno-124-15" href="#__codelineno-124-15"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"();"</span><span class="p">);</span>
</span><span id="__span-124-16"><a id="__codelineno-124-16" name="__codelineno-124-16" href="#__codelineno-124-16"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-124-17"><a id="__codelineno-124-17" name="__codelineno-124-17" href="#__codelineno-124-17"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-124-18"><a id="__codelineno-124-18" name="__codelineno-124-18" href="#__codelineno-124-18"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ‰¾ä¸åˆ°æŒ‡å®šç±»"</span><span class="p">);</span>
</span><span id="__span-124-19"><a id="__codelineno-124-19" name="__codelineno-124-19" href="#__codelineno-124-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-124-20"><a id="__codelineno-124-20" name="__codelineno-124-20" href="#__codelineno-124-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-124-21"><a id="__codelineno-124-21" name="__codelineno-124-21" href="#__codelineno-124-21"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šè¿°ä»£ç ç¬¬ 5 è¡Œæ˜¯é€šè¿‡ Class çš„é™æ€æ–¹æ³•<code>forName(String)</code>åˆ›å»ºæŸä¸ªç±»çš„è¿è¡Œæ—¶å¯¹è±¡ï¼Œå…¶ä¸­çš„å‚æ•°æ˜¯ç±»å…¨åå­—ç¬¦ä¸²ï¼Œå¦‚æœåœ¨ç±»è·¯å¾„ä¸­æ‰¾ä¸åˆ°è¿™ä¸ªç±»åˆ™æŠ›å‡º ClassNotFoundException å¼‚å¸¸ï¼Œè§ä»£ç ç¬¬ 17 è¡Œã€‚</p> <p>ä»£ç ç¬¬ 7 è¡Œæ˜¯é€šè¿‡ Class çš„å®ä¾‹æ–¹æ³• getDeclaredMethods() è¿”å›æŸä¸ªç±»çš„æˆå‘˜æ–¹æ³•å¯¹è±¡æ•°ç»„ã€‚ä»£ç ç¬¬ 9 è¡Œæ˜¯éå†æˆå‘˜æ–¹æ³•é›†åˆï¼Œå…¶ä¸­çš„å…ƒç´ æ˜¯ Method ç±»å‹ã€‚</p> <p>ä»£ç ç¬¬ 11 è¡Œçš„<code>method.getModifiers()</code>æ–¹æ³•è¿”å›è®¿é—®æƒé™ä¿®é¥°ç¬¦å¸¸é‡ä»£ç ï¼Œæ˜¯ int ç±»å‹ï¼Œä¾‹å¦‚ 1 ä»£è¡¨ publicï¼Œè¿™äº›æ•°å­—ä»£è¡¨çš„å«ä¹‰å¯ä»¥é€šè¿‡<code>Modifier.toString(int)</code>æ–¹æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ä»£ç ç¬¬ 13 è¡Œé€šè¿‡ Method çš„ getReturnType() æ–¹æ³•è·å¾—æ–¹æ³•è¿”å›å€¼ç±»å‹ï¼Œç„¶åå†è°ƒç”¨ getName() æ–¹æ³•è¿”å›è¯¥ç±»å‹çš„åç§°ã€‚ä»£ç ç¬¬ 15 è¡Œ<code>method.getName()</code>è¿”å›æ–¹æ³•åç§°ã€‚</p> <h3 id="113é€šè¿‡åå°„è®¿é—®æ„é€ æ–¹æ³•">11.3ã€é€šè¿‡åå°„è®¿é—®æ„é€ æ–¹æ³•<a class="headerlink" href="#113é€šè¿‡åå°„è®¿é—®æ„é€ æ–¹æ³•" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ä¸ºäº†èƒ½å¤Ÿ<strong>åŠ¨æ€è·å–</strong>å¯¹è±¡æ„é€ æ–¹æ³•çš„ä¿¡æ¯ï¼Œé¦–å…ˆéœ€è¦é€šè¿‡ä¸‹åˆ—æ–¹æ³•ä¹‹ä¸€åˆ›å»ºä¸€ä¸ª <code>Constructor</code> ç±»å‹çš„å¯¹è±¡æˆ–è€…æ•°ç»„ã€‚</p> <ul> <li>getConstructors()</li> <li>getConstructor(Class&lt;?&gt;â€¦parameterTypes)</li> <li>getDeclaredConstructors()</li> <li>getDeclaredConstructor(Class&lt;?&gt;...parameterTypes)</li> </ul> <p>==å¦‚æœæ˜¯è®¿é—®æŒ‡å®šçš„æ„é€ æ–¹æ³•ï¼Œéœ€è¦æ ¹æ®è¯¥æ„é€ æ–¹æ³•çš„å…¥å£å‚æ•°çš„ç±»å‹æ¥è®¿é—®ã€‚==ä¾‹å¦‚ï¼Œè®¿é—®ä¸€ä¸ªå…¥å£å‚æ•°ç±»å‹ä¾æ¬¡ä¸º int å’Œ String ç±»å‹çš„æ„é€ æ–¹æ³•ï¼Œä¸‹é¢çš„ä¸¤ç§æ–¹å¼å‡å¯ä»¥å®ç°ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="n">objectClass</span><span class="p">.</span><span class="na">getDeclaredConstructor</span><span class="p">(</span><span class="kt">int</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="n">objectClass</span><span class="p">.</span><span class="na">getDeclaredConstructor</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Class</span><span class="o">[]</span><span class="p">{</span><span class="kt">int</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">});</span>
</span></code></pre></div> <p>åˆ›å»ºçš„æ¯ä¸ª Constructor å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œç„¶ååˆ©ç”¨ Constructor å¯¹è±¡çš„æ–¹æ³•æ“ä½œæ„é€ æ–¹æ³•ã€‚Constructor ç±»çš„å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p> <table> <thead> <tr> <th>æ–¹æ³•åç§°</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>isVarArgs()</td> <td>æŸ¥çœ‹è¯¥æ„é€ æ–¹æ³•æ˜¯å¦å…è®¸å¸¦å¯å˜æ•°é‡çš„å‚æ•°ï¼Œå¦‚æœå…è®¸ï¼Œè¿”å› trueï¼Œå¦åˆ™è¿”å› false</td> </tr> <tr> <td>getParameterTypes()</td> <td>æŒ‰ç…§å£°æ˜é¡ºåºä»¥ Class æ•°ç»„çš„å½¢å¼è·å–è¯¥æ„é€ æ–¹æ³•å„ä¸ªå‚æ•°çš„ç±»å‹</td> </tr> <tr> <td>getExceptionTypes()</td> <td>ä»¥ Class æ•°ç»„çš„å½¢å¼è·å–è¯¥æ„é€ æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹</td> </tr> <tr> <td>newInstance(Object â€¦ initargs)</td> <td>é€šè¿‡è¯¥æ„é€ æ–¹æ³•åˆ©ç”¨æŒ‡å®šå‚æ•°åˆ›å»ºä¸€ä¸ªè¯¥ç±»å‹çš„å¯¹è±¡ï¼Œå¦‚æœæœªè®¾ç½®å‚æ•°åˆ™è¡¨ç¤º é‡‡ç”¨é»˜è®¤æ— å‚çš„æ„é€ æ–¹æ³•</td> </tr> <tr> <td>setAccessiable(boolean flag)</td> <td>å¦‚æœè¯¥æ„é€ æ–¹æ³•çš„æƒé™ä¸º privateï¼Œé»˜è®¤ä¸ºä¸å…è®¸é€šè¿‡åå°„åˆ©ç”¨ netlnstance() æ–¹æ³•åˆ›å»ºå¯¹è±¡ã€‚å¦‚æœå…ˆæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¹¶å°†å…¥å£å‚æ•°è®¾ç½®ä¸º trueï¼Œåˆ™å…è®¸åˆ›å»ºå¯¹è±¡</td> </tr> <tr> <td>getModifiers()</td> <td>è·å¾—å¯ä»¥è§£æå‡ºè¯¥æ„é€ æ–¹æ³•æ‰€é‡‡ç”¨ä¿®é¥°ç¬¦çš„æ•´æ•°</td> </tr> </tbody> </table> <p>é€šè¿‡ java.lang.reflect.Modifier ç±»å¯ä»¥è§£æå‡ºæ–¹æ³•çš„è¿”å›å€¼æ‰€è¡¨ç¤ºçš„ä¿®é¥°ç¬¦ä¿¡æ¯ã€‚åœ¨è¯¥ç±»ä¸­æä¾›äº†ä¸€ç³»åˆ—ç”¨æ¥è§£æçš„é™æ€æ–¹æ³•ï¼Œæ—¢å¯ä»¥æŸ¥çœ‹æ˜¯å¦è¢«æŒ‡å®šçš„ä¿®é¥°ç¬¦ä¿®é¥°ï¼Œè¿˜å¯ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è·å¾—æ‰€æœ‰ä¿®é¥°ç¬¦ã€‚ä¸‹è¡¨åˆ—å‡ºäº† Modifier ç±»çš„å¸¸ç”¨é™æ€æ–¹æ³•ã€‚</p> <table> <thead> <tr> <th>é™æ€æ–¹æ³•åç§°</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>isStatic(int mod)</td> <td>å¦‚æœä½¿ç”¨ static ä¿®é¥°ç¬¦ä¿®é¥°åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false</td> </tr> <tr> <td>isPublic(int mod)</td> <td>å¦‚æœä½¿ç”¨ public ä¿®é¥°ç¬¦ä¿®é¥°åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false</td> </tr> <tr> <td>isProtected(int mod)</td> <td>å¦‚æœä½¿ç”¨ protected ä¿®é¥°ç¬¦ä¿®é¥°åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false</td> </tr> <tr> <td>isPrivate(int mod)</td> <td>å¦‚æœä½¿ç”¨ private ä¿®é¥°ç¬¦ä¿®é¥°åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false</td> </tr> <tr> <td>isFinal(int mod)</td> <td>å¦‚æœä½¿ç”¨ final ä¿®é¥°ç¬¦ä¿®é¥°åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false</td> </tr> <tr> <td>toString(int mod)</td> <td>ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›æ‰€æœ‰ä¿®é¥°ç¬¦</td> </tr> </tbody> </table> <p>ä¾‹å¦‚ï¼Œä¸‹åˆ—ä»£ç åˆ¤æ–­å¯¹è±¡ con æ‰€ä»£è¡¨çš„æ„é€ æ–¹æ³•æ˜¯å¦è¢« public ä¿®é¥°ï¼Œä»¥åŠä»¥å­—ç¬¦ä¸²å½¢å¼è·å–è¯¥æ„é€ æ–¹æ³•çš„æ‰€æœ‰ä¿®é¥°ç¬¦ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">modifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">con</span><span class="p">.</span><span class="na">getModifiers</span><span class="p">();</span><span class="w">    </span><span class="c1">// è·å–æ„é€ æ–¹æ³•çš„ä¿®é¥°ç¬¦æ•´æ•°</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="kt">boolean</span><span class="w"> </span><span class="n">isPublic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">isPublic</span><span class="p">(</span><span class="n">modifiers</span><span class="p">);</span><span class="w">    </span><span class="c1">// åˆ¤æ–­ä¿®é¥°ç¬¦æ•´æ•°æ˜¯å¦ä¸ºpublic </span>
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a><span class="n">string</span><span class="w"> </span><span class="n">allModifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">modifiers</span><span class="p">);</span>
</span></code></pre></div> <h3 id="114é€šè¿‡åå°„æ‰§è¡Œæ–¹æ³•">11.4ã€é€šè¿‡åå°„æ‰§è¡Œæ–¹æ³•<a class="headerlink" href="#114é€šè¿‡åå°„æ‰§è¡Œæ–¹æ³•" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>è¦<strong>åŠ¨æ€è·å–</strong>ä¸€ä¸ªå¯¹è±¡æ–¹æ³•çš„ä¿¡æ¯ï¼Œé¦–å…ˆéœ€è¦é€šè¿‡ä¸‹åˆ—æ–¹æ³•ä¹‹ä¸€åˆ›å»ºä¸€ä¸ª <code>Method</code> ç±»å‹çš„å¯¹è±¡æˆ–è€…æ•°ç»„ã€‚</p> <ul> <li>getMethods()</li> <li>getMethods(String name,Class&lt;?&gt; â€¦parameterTypes)</li> <li>getDeclaredMethods()</li> <li>getDeclaredMethods(String name,Class&lt;?&gt;...parameterTypes)</li> </ul> <p>==å¦‚æœæ˜¯è®¿é—®æŒ‡å®šçš„æ„é€ æ–¹æ³•ï¼Œéœ€è¦æ ¹æ®è¯¥æ–¹æ³•çš„å…¥å£å‚æ•°çš„ç±»å‹æ¥è®¿é—®ã€‚==ä¾‹å¦‚ï¼Œè®¿é—®ä¸€ä¸ªåç§°ä¸º maxï¼Œå…¥å£å‚æ•°ç±»å‹ä¾æ¬¡ä¸º int å’Œ String ç±»å‹çš„æ–¹æ³•ã€‚</p> <p>ä¸‹é¢çš„ä¸¤ç§æ–¹å¼å‡å¯ä»¥å®ç°ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="n">objectClass</span><span class="p">.</span><span class="na">getDeclaredConstructor</span><span class="p">(</span><span class="s">"max"</span><span class="p">,</span><span class="kt">int</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="n">objectClass</span><span class="p">.</span><span class="na">getDeclaredConstructor</span><span class="p">(</span><span class="s">"max"</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">Class</span><span class="o">[]</span><span class="p">{</span><span class="kt">int</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">});</span>
</span></code></pre></div> <p>Methodç±»çš„å¸¸ç”¨æ–¹æ³•</p> <table> <thead> <tr> <th>æ–¹æ³•åç§°</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>getName()</td> <td>è·å–è¯¥æ–¹æ³•çš„åç§°</td> </tr> <tr> <td>getParameterType()</td> <td>æŒ‰ç…§å£°æ˜é¡ºåºä»¥ Class æ•°ç»„çš„å½¢å¼è¿”å›è¯¥æ–¹æ³•å„ä¸ªå‚æ•°çš„ç±»å‹</td> </tr> <tr> <td>getReturnType()</td> <td>ä»¥ Class å¯¹è±¡çš„å½¢å¼è·å¾—è¯¥æ–¹æ³•çš„è¿”å›å€¼ç±»å‹</td> </tr> <tr> <td>getExceptionTypes()</td> <td>ä»¥ Class æ•°ç»„çš„å½¢å¼è·å¾—è¯¥æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹</td> </tr> <tr> <td>invoke(Object obj,Object...args)</td> <td>åˆ©ç”¨ args å‚æ•°æ‰§è¡ŒæŒ‡å®šå¯¹è±¡ obj ä¸­çš„è¯¥æ–¹æ³•ï¼Œè¿”å›å€¼ä¸º Object ç±»å‹</td> </tr> <tr> <td>isVarArgs()</td> <td>æŸ¥çœ‹è¯¥æ–¹æ³•æ˜¯å¦å…è®¸å¸¦æœ‰å¯å˜æ•°é‡çš„å‚æ•°ï¼Œå¦‚æœå…è®¸è¿”å› trueï¼Œå¦åˆ™è¿”å› false</td> </tr> <tr> <td>getModifiers()</td> <td>è·å¾—å¯ä»¥è§£æå‡ºè¯¥æ–¹æ³•æ‰€é‡‡ç”¨ä¿®é¥°ç¬¦çš„æ•´æ•°</td> </tr> <tr> <td>setAccessible(boolean flag)</td> <td>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®æ˜¯å¦å¿½ç•¥æƒé™ç›´æ¥è¿è¡Œ private ç­‰ç§æœ‰æƒé™çš„æ–¹æ³•</td> </tr> </tbody> </table> <h3 id="115é€šè¿‡åå°„è®¿é—®æˆå‘˜å˜é‡">11.5ã€é€šè¿‡åå°„è®¿é—®æˆå‘˜å˜é‡<a class="headerlink" href="#115é€šè¿‡åå°„è®¿é—®æˆå‘˜å˜é‡" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>é€šè¿‡ä¸‹åˆ—ä»»æ„ä¸€ä¸ªæ–¹æ³•è®¿é—®æˆå‘˜å˜é‡æ—¶å°†è¿”å› Field ç±»å‹çš„å¯¹è±¡æˆ–æ•°ç»„ã€‚</p> <ul> <li>getFields()</li> <li>getField(String name)</li> <li>getDeclaredFields()</li> <li>getDeclaredField(String name)</li> </ul> <p>ä¸Šè¿°æ–¹æ³•è¿”å›çš„ Field å¯¹è±¡ä»£è¡¨ä¸€ä¸ªæˆå‘˜å˜é‡ã€‚ä¾‹å¦‚ï¼Œè¦è®¿é—®ä¸€ä¸ªåç§°ä¸º price çš„æˆå‘˜å˜é‡ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="n">object</span><span class="p">.</span><span class="na">getDeciaredField</span><span class="p">(</span><span class="s">"price"</span><span class="p">);</span>
</span></code></pre></div> <p>Field ç±»çš„å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p> <table> <thead> <tr> <th>æ–¹æ³•åç§°</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>getName()</td> <td>è·å¾—è¯¥æˆå‘˜å˜é‡çš„åç§°</td> </tr> <tr> <td>getType()</td> <td>è·å–è¡¨ç¤ºè¯¥æˆå‘˜å˜é‡çš„ Class å¯¹è±¡</td> </tr> <tr> <td>get(Object obj)</td> <td>è·å¾—æŒ‡å®šå¯¹è±¡ obj ä¸­æˆå‘˜å˜é‡çš„å€¼ï¼Œè¿”å›å€¼ä¸º Object ç±»å‹</td> </tr> <tr> <td>set(Object obj, Object value)</td> <td>å°†æŒ‡å®šå¯¹è±¡ obj ä¸­æˆå‘˜å˜é‡çš„å€¼è®¾ç½®ä¸º value</td> </tr> <tr> <td>getlnt(0bject obj)</td> <td>è·å¾—æŒ‡å®šå¯¹è±¡ obj ä¸­æˆå‘˜ç±»å‹ä¸º int çš„æˆå‘˜å˜é‡çš„å€¼</td> </tr> <tr> <td>setlnt(0bject obj, int i)</td> <td>å°†æŒ‡å®šå¯¹è±¡ obj ä¸­æˆå‘˜å˜é‡çš„å€¼è®¾ç½®ä¸º i</td> </tr> <tr> <td>getFloat(Object obj)</td> <td>è·å¾—æŒ‡å®šå¯¹è±¡ obj ä¸­æˆå‘˜ç±»å‹ä¸º float çš„æˆå‘˜å˜é‡çš„å€¼</td> </tr> <tr> <td>setFloat(Object obj, float f)</td> <td>å°†æŒ‡å®šå¯¹è±¡ obj ä¸­æˆå‘˜å˜é‡çš„å€¼è®¾ç½®ä¸º f</td> </tr> <tr> <td>getBoolean(Object obj)</td> <td>è·å¾—æŒ‡å®šå¯¹è±¡ obj ä¸­æˆå‘˜ç±»å‹ä¸º boolean çš„æˆå‘˜å˜é‡çš„å€¼</td> </tr> <tr> <td>setBoolean(Object obj, boolean b)</td> <td>å°†æŒ‡å®šå¯¹è±¡ obj ä¸­æˆå‘˜å˜é‡çš„å€¼è®¾ç½®ä¸º b</td> </tr> <tr> <td>setAccessible(boolean flag)</td> <td>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®æ˜¯å¦å¿½ç•¥æƒé™ç›´æ¥è®¿é—® private ç­‰ç§æœ‰æƒé™çš„æˆå‘˜å˜é‡</td> </tr> <tr> <td>getModifiers()</td> <td>è·å¾—å¯ä»¥è§£æå‡ºè¯¥æ–¹æ³•æ‰€é‡‡ç”¨ä¿®é¥°ç¬¦çš„æ•´æ•°</td> </tr> </tbody> </table> <h3 id="116é€šè¿‡åå°„æ“ä½œæ³›å‹">11.6ã€é€šè¿‡åå°„æ“ä½œæ³›å‹<a class="headerlink" href="#116é€šè¿‡åå°„æ“ä½œæ³›å‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ä»Java 1.5 ç‰ˆæœ¬å¼€å§‹ï¼ŒJava çš„ Class ç±»å¢åŠ äº†æ³›å‹åŠŸèƒ½ï¼Œä»è€Œå…è®¸ä½¿ç”¨æ³›å‹æ¥é™åˆ¶ Class ç±»ã€‚ä¾‹å¦‚ï¼ŒString.class çš„ç±»å‹å®é™…ä¸Šæ˜¯ Class<string>ã€‚å¦‚æœ Class å¯¹åº”çš„ç±»æš‚æ—¶æœªçŸ¥ï¼Œåˆ™ä½¿ç”¨ Class&lt;?&gt;ã€‚é€šè¿‡åœ¨åå°„ä¸­ä½¿ç”¨æ³›å‹ï¼Œå¯ä»¥é¿å…ä½¿ç”¨åå°„ç”Ÿæˆçš„å¯¹è±¡éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</string></p> <h4 id="1161æ³›å‹å’Œ-class-ç±»">11.6.1ã€æ³›å‹å’Œ Class ç±»<a class="headerlink" href="#1161æ³›å‹å’Œ-class-ç±»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>ä½¿ç”¨ Class<t> æ³›å‹å¯ä»¥é¿å…å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æä¾›ä¸€ä¸ªç®€å•çš„å¯¹è±¡å·¥å‚ï¼Œè¯¥å¯¹è±¡å·¥å‚å¯ä»¥æ ¹æ®æŒ‡å®šç±»æ¥æä¾›è¯¥ç±»çš„å®ä¾‹ã€‚</t></p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ObjectFactory</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getInstance</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">clsName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="w">            </span><span class="c1">// åˆ›å»ºæŒ‡å®šç±»å¯¹åº”çš„Classå¯¹è±¡</span>
</span><span id="__span-129-5"><a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a><span class="w">            </span><span class="n">Class</span><span class="w"> </span><span class="n">cls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="n">clsName</span><span class="p">);</span>
</span><span id="__span-129-6"><a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a><span class="w">            </span><span class="c1">// è¿”å›ä½¿ç”¨è¯¥Classå¯¹è±¡åˆ›å»ºçš„å®ä¾‹</span>
</span><span id="__span-129-7"><a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">cls</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span>
</span><span id="__span-129-8"><a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-129-9"><a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-129-10"><a id="__codelineno-129-10" name="__codelineno-129-10" href="#__codelineno-129-10"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-129-11"><a id="__codelineno-129-11" name="__codelineno-129-11" href="#__codelineno-129-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-129-12"><a id="__codelineno-129-12" name="__codelineno-129-12" href="#__codelineno-129-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-129-13"><a id="__codelineno-129-13" name="__codelineno-129-13" href="#__codelineno-129-13"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ç¨‹åºä¸­ç¬¬ 5 ã€7 è¡Œä»£ç æ ¹æ®æŒ‡å®šçš„å­—ç¬¦ä¸²ç±»å‹åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½†è¿™ä¸ªå¯¹è±¡çš„ç±»å‹æ˜¯ Objectï¼Œå› æ­¤å½“éœ€è¦ä½¿ç”¨ ObjectFactory çš„ getInstance() æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="c1">// è·å–å®ä¾‹åéœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="n">Date</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Date</span><span class="p">)</span><span class="n">ObjectFactory</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="s">"java.util.Date"</span><span class="p">);</span>
</span></code></pre></div> <p>æˆ–</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="n">JFrame</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">JFrame</span><span class="p">)</span><span class="n">ObjectFactory</span><span class="w"> </span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="s">"java.util.Date"</span><span class="p">);</span>
</span></code></pre></div> <p>ä¸Šé¢ä»£ç åœ¨ç¼–è¯‘æ—¶ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼Œä½†è¿è¡Œæ—¶å°†æŠ›å‡º ClassCastExceptionï¼ˆå¼ºåˆ¶ç±»å‹è½¬æ¢å¼‚å¸¸ï¼‰ï¼Œå› ä¸ºç¨‹åºè¯•å›¾å°†ä¸€ä¸ª Date å¯¹è±¡è½¬æ¢æˆ JFrame å¯¹è±¡ã€‚</p> <p>å¦‚æœå°†ä¸Šé¢çš„ ObjectFactory å·¥å‚ç±»æ”¹å†™æˆä½¿ç”¨æ³›å‹åçš„ Classï¼Œå°±å¯ä»¥é¿å…è¿™ç§æƒ…å†µã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ObjectFactory2</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-132-2"><a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">getInstance</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cls</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-132-3"><a id="__codelineno-132-3" name="__codelineno-132-3" href="#__codelineno-132-3"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-132-4"><a id="__codelineno-132-4" name="__codelineno-132-4" href="#__codelineno-132-4"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">cls</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span>
</span><span id="__span-132-5"><a id="__codelineno-132-5" name="__codelineno-132-5" href="#__codelineno-132-5"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-132-6"><a id="__codelineno-132-6" name="__codelineno-132-6" href="#__codelineno-132-6"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-132-7"><a id="__codelineno-132-7" name="__codelineno-132-7" href="#__codelineno-132-7"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-132-8"><a id="__codelineno-132-8" name="__codelineno-132-8" href="#__codelineno-132-8"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-132-9"><a id="__codelineno-132-9" name="__codelineno-132-9" href="#__codelineno-132-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-132-10"><a id="__codelineno-132-10" name="__codelineno-132-10" href="#__codelineno-132-10"></a>
</span><span id="__span-132-11"><a id="__codelineno-132-11" name="__codelineno-132-11" href="#__codelineno-132-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-132-12"><a id="__codelineno-132-12" name="__codelineno-132-12" href="#__codelineno-132-12"></a><span class="w">        </span><span class="c1">// è·å–å®ä¾‹åæ— é¡»ç±»å‹è½¬æ¢</span>
</span><span id="__span-132-13"><a id="__codelineno-132-13" name="__codelineno-132-13" href="#__codelineno-132-13"></a><span class="w">        </span><span class="n">Date</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CrazyitObjectFactory2</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">Date</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-132-14"><a id="__codelineno-132-14" name="__codelineno-132-14" href="#__codelineno-132-14"></a><span class="w">        </span><span class="n">JFrame</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CrazyitObjectFactory2</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">JFrame</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-132-15"><a id="__codelineno-132-15" name="__codelineno-132-15" href="#__codelineno-132-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-132-16"><a id="__codelineno-132-16" name="__codelineno-132-16" href="#__codelineno-132-16"></a><span class="p">}</span>
</span></code></pre></div> <p>åœ¨ä¸Šé¢ç¨‹åºçš„ getInstance() æ–¹æ³•ä¸­ä¼ å…¥ä¸€ä¸ª Class<t> å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³›å‹åŒ–çš„ Class å¯¹è±¡ï¼Œè°ƒç”¨è¯¥ Class å¯¹è±¡çš„ newInstance() æ–¹æ³•å°†è¿”å›ä¸€ä¸ª T å¯¹è±¡ï¼Œå¦‚ç¨‹åºä¸­ç¬¬ 4 è¡Œä»£ç æ‰€ç¤ºã€‚æ¥ä¸‹æ¥å½“ä½¿ç”¨ ObjectFactory2 å·¥å‚ç±»çš„ getInstance() æ–¹æ³•æ¥äº§ç”Ÿå¯¹è±¡æ—¶ï¼Œæ— é¡»ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œæ›´ä¸¥æ ¼çš„æ£€æŸ¥ï¼Œä¸ä¼šå‡ºç° ClassCastException è¿è¡Œæ—¶å¼‚å¸¸ã€‚</t></p> <p>ä½¿ç”¨ Array ç±»æ¥åˆ›å»ºæ•°ç»„æ—¶ï¼Œæ›¾ç»çœ‹åˆ°å¦‚ä¸‹ä»£ç ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="c1">// ä½¿ç”¨Arrayçš„newInstanceæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ•°ç»„</span>
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a><span class="n">Object</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
</span></code></pre></div> <p>å¯¹äºä¸Šé¢çš„ä»£ç å…¶å®ä½¿ç”¨å¹¶ä¸æ˜¯éå¸¸æ–¹ä¾¿ï¼Œå› ä¸º newInstance() æ–¹æ³•è¿”å›çš„ç¡®å®æ˜¯ä¸€ä¸ª String[] æ•°ç»„ï¼Œè€Œä¸æ˜¯ç®€å•çš„ Object å¯¹è±¡ã€‚å¦‚æœéœ€è¦å°† arr å¯¹è±¡å½“æˆ String[] æ•°ç»„ä½¿ç”¨ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä½†æ˜¯è¿™æ˜¯ä¸å®‰å…¨çš„æ“ä½œã€‚</p> <p>å¥‡æ€ªçš„æ˜¯ï¼ŒArray çš„ newInstance() æ–¹æ³•ç­¾åï¼ˆæ–¹æ³•ç­¾åç”±æ–¹æ³•åç§°å’Œå‚æ•°åˆ—è¡¨ç»„æˆï¼‰ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">newInstance</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">componentType</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">...</span><span class="w"> </span><span class="n">dimensions</span><span class="p">)</span>
</span></code></pre></div> <p>åœ¨è¿™ä¸ªæ–¹æ³•ç­¾åä¸­ä½¿ç”¨äº† Class&lt;?&gt; æ³›å‹ï¼Œä½†å¹¶æ²¡æœ‰çœŸæ­£åˆ©ç”¨è¿™ä¸ªæ³›å‹ã€‚å¦‚æœå°†è¯¥æ–¹æ³•ç­¾åæ”¹ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="o">[]</span><span class="w"> </span><span class="nf">newInstance</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">componentType</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">)</span>
</span></code></pre></div> <p>è¿™æ ·å°±å¯ä»¥åœ¨è°ƒç”¨è¯¥æ–¹æ³•åæ— éœ€å¼ºåˆ¶ç±»å‹è½¬æ¢äº†ã€‚</p> <p>ä¸ºäº†ç¤ºèŒƒæ³›å‹çš„ä¼˜åŠ¿ï¼Œå¯ä»¥å¯¹ Array çš„ newInstance() æ–¹æ³•è¿›è¡ŒåŒ…è£…ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CrazyitArray</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a><span class="w">    </span><span class="c1">// å¯¹Arrayçš„newInstanceæ–¹æ³•è¿›è¡ŒåŒ…è£…</span>
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a><span class="w">    </span><span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">"unchecked"</span><span class="p">)</span>
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="o">[]</span><span class="w"> </span><span class="nf">newInstance</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">componentType</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-136-5"><a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(</span><span class="n">componentType</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-136-6"><a id="__codelineno-136-6" name="__codelineno-136-6" href="#__codelineno-136-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-136-7"><a id="__codelineno-136-7" name="__codelineno-136-7" href="#__codelineno-136-7"></a>
</span><span id="__span-136-8"><a id="__codelineno-136-8" name="__codelineno-136-8" href="#__codelineno-136-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-136-9"><a id="__codelineno-136-9" name="__codelineno-136-9" href="#__codelineno-136-9"></a><span class="w">        </span><span class="c1">// ä½¿ç”¨ CrazyitArray çš„ newInstance()åˆ›å»ºä¸€ç»´æ•°ç»„</span>
</span><span id="__span-136-10"><a id="__codelineno-136-10" name="__codelineno-136-10" href="#__codelineno-136-10"></a><span class="w">        </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CrazyitArray</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
</span><span id="__span-136-11"><a id="__codelineno-136-11" name="__codelineno-136-11" href="#__codelineno-136-11"></a><span class="w">        </span><span class="c1">// ä½¿ç”¨ CrazyitArray çš„ newInstance()åˆ›å»ºäºŒç»´æ•°ç»„</span>
</span><span id="__span-136-12"><a id="__codelineno-136-12" name="__codelineno-136-12" href="#__codelineno-136-12"></a><span class="w">        </span><span class="c1">// åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªè¦è®¾ç½®æ•°ç»„å…ƒç´ çš„ç±»å‹æ˜¯int[]å³å¯</span>
</span><span id="__span-136-13"><a id="__codelineno-136-13" name="__codelineno-136-13" href="#__codelineno-136-13"></a><span class="w">        </span><span class="kt">int</span><span class="o">[][]</span><span class="w"> </span><span class="n">intArr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CrazyitArray</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(</span><span class="kt">int</span><span class="o">[]</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
</span><span id="__span-136-14"><a id="__codelineno-136-14" name="__codelineno-136-14" href="#__codelineno-136-14"></a><span class="w">        </span><span class="n">arr</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Cè¯­è¨€ä¸­æ–‡ç½‘Javaæ•™ç¨‹"</span><span class="p">;</span>
</span><span id="__span-136-15"><a id="__codelineno-136-15" name="__codelineno-136-15" href="#__codelineno-136-15"></a><span class="w">        </span><span class="c1">// intArræ˜¯äºŒç»´æ•°ç»„ï¼Œåˆå§‹åŒ–è¯¥æ•°ç»„çš„ç¬¬äºŒä¸ªæ•°ç»„å…ƒç´ </span>
</span><span id="__span-136-16"><a id="__codelineno-136-16" name="__codelineno-136-16" href="#__codelineno-136-16"></a><span class="w">        </span><span class="c1">// äºŒç»´æ•°ç»„çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ç»´æ•°ç»„</span>
</span><span id="__span-136-17"><a id="__codelineno-136-17" name="__codelineno-136-17" href="#__codelineno-136-17"></a><span class="w">        </span><span class="n">intArr</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="p">{</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-136-18"><a id="__codelineno-136-18" name="__codelineno-136-18" href="#__codelineno-136-18"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">arr</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">);</span>
</span><span id="__span-136-19"><a id="__codelineno-136-19" name="__codelineno-136-19" href="#__codelineno-136-19"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">intArr</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span>
</span><span id="__span-136-20"><a id="__codelineno-136-20" name="__codelineno-136-20" href="#__codelineno-136-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-136-21"><a id="__codelineno-136-21" name="__codelineno-136-21" href="#__codelineno-136-21"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ç¨‹åºä¸­ç¬¬ 4ã€5ã€6ã€10 å’Œ 13 å®šä¹‰çš„ newInstance() æ–¹æ³•å¯¹ Array ç±»æä¾›çš„ newInstance() æ–¹æ³•è¿›è¡Œäº†åŒ…è£…ï¼Œå°†æ–¹æ³•ç­¾åæ”¹æˆäº† <code>public static T[] newInstance(Class componentType, int length)</code>ï¼Œè¿™å°±ä¿è¯ç¨‹åºé€šè¿‡è¯¥ newInstance() æ–¹æ³•åˆ›å»ºæ•°ç»„æ—¶çš„è¿”å›å€¼å°±æ˜¯æ•°ç»„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ Object å¯¹è±¡ï¼Œä»è€Œé¿å…äº†å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p> <p>æç¤ºï¼š@SuppressWarnings("unchecked") å‘Šè¯‰ç¼–è¯‘å™¨å¿½ç•¥ unchecked è­¦å‘Šä¿¡æ¯ï¼Œå¦‚ä½¿ç”¨ Listï¼ŒArrayList ç­‰æœªè¿›è¡Œå‚æ•°åŒ–äº§ç”Ÿçš„è­¦å‘Šä¿¡æ¯ã€‚ç¨‹åºåœ¨ç¬¬ 5 è¡Œä»£ç å¤„å°†ä¼šæœ‰ä¸€ä¸ª unchecked ç¼–è¯‘è­¦å‘Šï¼Œæ‰€ä»¥ç¨‹åºä½¿ç”¨äº† @SuppressWarnings æ¥æŠ‘åˆ¶è¿™ä¸ªè­¦å‘Šä¿¡æ¯ã€‚</p> <h4 id="1162ä½¿ç”¨åå°„æ¥è·å–æ³›å‹ä¿¡æ¯">11.6.2ã€ä½¿ç”¨åå°„æ¥è·å–æ³›å‹ä¿¡æ¯<a class="headerlink" href="#1162ä½¿ç”¨åå°„æ¥è·å–æ³›å‹ä¿¡æ¯" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>é€šè¿‡æŒ‡å®šç±»å¯¹åº”çš„ Class å¯¹è±¡ï¼Œå¯ä»¥è·å¾—è¯¥ç±»é‡ŒåŒ…å«çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œä¸ç®¡è¯¥æˆå‘˜å˜é‡æ˜¯ä½¿ç”¨ private ä¿®é¥°ï¼Œè¿˜æ˜¯ä½¿ç”¨ public ä¿®é¥°ã€‚è·å¾—äº†æˆå‘˜å˜é‡å¯¹åº”çš„ Field å¯¹è±¡åï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“åœ°è·å¾—è¯¥æˆå‘˜å˜é‡çš„æ•°æ®ç±»å‹ï¼Œå³ä½¿ç”¨å¦‚ä¸‹ä»£ç å³å¯è·å¾—æŒ‡å®šæˆå‘˜å˜é‡çš„ç±»å‹ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="c1">// è·å–æˆå‘˜å˜é‡ f çš„ç±»å‹</span>
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="na">getType</span><span class="p">();</span>
</span></code></pre></div> <p>ä½†è¿™ç§æ–¹å¼åªå¯¹æ™®é€šç±»å‹çš„æˆå‘˜å˜é‡æœ‰æ•ˆã€‚å¦‚æœè¯¥æˆå‘˜å˜é‡çš„ç±»å‹æ˜¯æœ‰æ³›å‹ç±»å‹çš„ç±»å‹ï¼Œå¦‚ Map<string, integer>ç±»å‹ï¼Œåˆ™ä¸èƒ½å‡†ç¡®åœ°å¾—åˆ°è¯¥æˆå‘˜å˜é‡çš„æ³›å‹å‚æ•°ã€‚</string,></p> <p>ä¸ºäº†è·å¾—æŒ‡å®šæˆå‘˜å˜é‡çš„æ³›å‹ç±»å‹ï¼Œåº”å…ˆä½¿ç”¨å¦‚ä¸‹æ–¹æ³•æ¥è·å–è¯¥æˆå‘˜å˜é‡çš„æ³›å‹ç±»å‹ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="c1">// è·å¾—æˆå‘˜å˜é‡fçš„æ³›å‹ç±»å‹</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="n">Type</span><span class="w"> </span><span class="n">gType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="na">getGenericType</span><span class="p">();</span>
</span></code></pre></div> <p>ç„¶åå°† Type å¯¹è±¡å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸º ParameterizedType å¯¹è±¡ï¼ŒParameterizedType ä»£è¡¨è¢«å‚æ•°åŒ–çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å¢åŠ äº†æ³›å‹é™åˆ¶çš„ç±»å‹ã€‚ParameterizedType ç±»æä¾›äº†å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•ã€‚</p> <ul> <li>getRawType()ï¼šè¿”å›æ²¡æœ‰æ³›å‹ä¿¡æ¯çš„åŸå§‹ç±»å‹ã€‚</li> <li>getActualTypeArguments()ï¼šè¿”å›æ³›å‹å‚æ•°çš„ç±»å‹ã€‚</li> </ul> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªè·å–æ³›å‹ç±»å‹çš„å®Œæ•´ç¨‹åºã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GenericTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">score</span><span class="p">;</span>
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a>
</span><span id="__span-139-4"><a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-5"><a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a><span class="w">        </span><span class="n">Class</span><span class="o">&lt;</span><span class="n">GenericTest</span><span class="o">&gt;</span><span class="w"> </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GenericTest</span><span class="p">.</span><span class="na">class</span><span class="p">;</span>
</span><span id="__span-139-6"><a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a><span class="w">        </span><span class="n">Field</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clazz</span><span class="p">.</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">"score"</span><span class="p">);</span>
</span><span id="__span-139-7"><a id="__codelineno-139-7" name="__codelineno-139-7" href="#__codelineno-139-7"></a><span class="w">        </span><span class="c1">// ç›´æ¥ä½¿ç”¨getType()å–å‡ºç±»å‹åªå¯¹æ™®é€šç±»å‹çš„æˆå‘˜å˜é‡æœ‰æ•ˆ</span>
</span><span id="__span-139-8"><a id="__codelineno-139-8" name="__codelineno-139-8" href="#__codelineno-139-8"></a><span class="w">        </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="na">getType</span><span class="p">();</span>
</span><span id="__span-139-9"><a id="__codelineno-139-9" name="__codelineno-139-9" href="#__codelineno-139-9"></a><span class="w">        </span><span class="c1">// ä¸‹é¢å°†çœ‹åˆ°ä»…è¾“å‡ºjava.util.Map</span>
</span><span id="__span-139-10"><a id="__codelineno-139-10" name="__codelineno-139-10" href="#__codelineno-139-10"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"score çš„ç±»å‹æ˜¯ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
</span><span id="__span-139-11"><a id="__codelineno-139-11" name="__codelineno-139-11" href="#__codelineno-139-11"></a><span class="w">        </span><span class="c1">// è·å¾—æˆå‘˜å˜é‡fçš„æ³›å‹ç±»å‹</span>
</span><span id="__span-139-12"><a id="__codelineno-139-12" name="__codelineno-139-12" href="#__codelineno-139-12"></a><span class="w">        </span><span class="n">Type</span><span class="w"> </span><span class="n">gType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="na">getGenericType</span><span class="p">();</span>
</span><span id="__span-139-13"><a id="__codelineno-139-13" name="__codelineno-139-13" href="#__codelineno-139-13"></a><span class="w">        </span><span class="c1">// å¦‚æœ gType ç±»å‹æ˜¯ ParameterizedTypeå¯¹è±¡</span>
</span><span id="__span-139-14"><a id="__codelineno-139-14" name="__codelineno-139-14" href="#__codelineno-139-14"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gType</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">ParameterizedType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-15"><a id="__codelineno-139-15" name="__codelineno-139-15" href="#__codelineno-139-15"></a><span class="w">            </span><span class="c1">// å¼ºåˆ¶ç±»å‹è½¬æ¢</span>
</span><span id="__span-139-16"><a id="__codelineno-139-16" name="__codelineno-139-16" href="#__codelineno-139-16"></a><span class="w">            </span><span class="n">ParameterizedType</span><span class="w"> </span><span class="n">pType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ParameterizedType</span><span class="p">)</span><span class="w"> </span><span class="n">gType</span><span class="p">;</span>
</span><span id="__span-139-17"><a id="__codelineno-139-17" name="__codelineno-139-17" href="#__codelineno-139-17"></a><span class="w">            </span><span class="c1">// è·å–åŸå§‹ç±»å‹</span>
</span><span id="__span-139-18"><a id="__codelineno-139-18" name="__codelineno-139-18" href="#__codelineno-139-18"></a><span class="w">            </span><span class="n">Type</span><span class="w"> </span><span class="n">rType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pType</span><span class="p">.</span><span class="na">getRawType</span><span class="p">();</span>
</span><span id="__span-139-19"><a id="__codelineno-139-19" name="__codelineno-139-19" href="#__codelineno-139-19"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"åŸå§‹ç±»å‹æ˜¯ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rType</span><span class="p">);</span>
</span><span id="__span-139-20"><a id="__codelineno-139-20" name="__codelineno-139-20" href="#__codelineno-139-20"></a><span class="w">            </span><span class="c1">// å–å¾—æ³›å‹ç±»å‹çš„æ³›å‹å‚æ•°</span>
</span><span id="__span-139-21"><a id="__codelineno-139-21" name="__codelineno-139-21" href="#__codelineno-139-21"></a><span class="w">            </span><span class="n">Type</span><span class="o">[]</span><span class="w"> </span><span class="n">tArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pType</span><span class="p">.</span><span class="na">getActualTypeArguments</span><span class="p">();</span>
</span><span id="__span-139-22"><a id="__codelineno-139-22" name="__codelineno-139-22" href="#__codelineno-139-22"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ³›å‹ä¿¡æ¯æ˜¯:"</span><span class="p">);</span>
</span><span id="__span-139-23"><a id="__codelineno-139-23" name="__codelineno-139-23" href="#__codelineno-139-23"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tArgs</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-24"><a id="__codelineno-139-24" name="__codelineno-139-24" href="#__codelineno-139-24"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"ç¬¬"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"ä¸ªæ³›å‹ç±»å‹æ˜¯ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tArgs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
</span><span id="__span-139-25"><a id="__codelineno-139-25" name="__codelineno-139-25" href="#__codelineno-139-25"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-139-26"><a id="__codelineno-139-26" name="__codelineno-139-26" href="#__codelineno-139-26"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-27"><a id="__codelineno-139-27" name="__codelineno-139-27" href="#__codelineno-139-27"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è·å–æ³›å‹ç±»å‹å‡ºé”™!"</span><span class="p">);</span>
</span><span id="__span-139-28"><a id="__codelineno-139-28" name="__codelineno-139-28" href="#__codelineno-139-28"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-139-29"><a id="__codelineno-139-29" name="__codelineno-139-29" href="#__codelineno-139-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-139-30"><a id="__codelineno-139-30" name="__codelineno-139-30" href="#__codelineno-139-30"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ç¨‹åºä¸­çš„ç¬¬ 12ã€16ã€18 å’Œ 21 è¡Œä»£ç å°±æ˜¯å–å¾—æ³›å‹ç±»å‹çš„å…³é”®ä»£ç ã€‚è¿è¡Œä¸Šé¢ç¨‹åºï¼Œå°†çœ‹åˆ°å¦‚ä¸‹è¿è¡Œç»“æœï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a>score çš„ç±»å‹æ˜¯ï¼šinterface java.util.Map
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a>åŸå§‹ç±»å‹æ˜¯ï¼šinterface java.util.Map
</span><span id="__span-140-3"><a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a>æ³›å‹ä¿¡æ¯æ˜¯:
</span><span id="__span-140-4"><a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a>ç¬¬0ä¸ªæ³›å‹ç±»å‹æ˜¯ï¼šclass java.lang.String
</span><span id="__span-140-5"><a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a>ç¬¬1ä¸ªæ³›å‹ç±»å‹æ˜¯ï¼šclass java.lang.Integer
</span></code></pre></div> <p>ä»ä¸Šé¢çš„è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨ getType() æ–¹æ³•åªèƒ½è·å–æ™®é€šç±»å‹çš„æˆå‘˜å˜é‡çš„æ•°æ®ç±»å‹ã€‚å¯¹äºå¢åŠ äº†æ³›å‹çš„æˆå‘˜å˜é‡ï¼Œåº”è¯¥ä½¿ç”¨ getGenericType() æ–¹æ³•æ¥å–å¾—å…¶ç±»å‹ã€‚</p> <p>æç¤ºï¼šType ä¹Ÿæ˜¯ java.lang.reflect åŒ…ä¸‹çš„ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£ä»£è¡¨æ‰€æœ‰ç±»å‹çš„å…¬å…±é«˜çº§æ¥å£ï¼ŒClass æ˜¯ Type æ¥å£çš„å®ç°ç±»ã€‚Type åŒ…æ‹¬åŸå§‹ç±»å‹ã€å‚æ•°åŒ–ç±»å‹ã€æ•°ç»„ç±»å‹ã€ç±»å‹å˜é‡å’ŒåŸºæœ¬ç±»å‹ç­‰ã€‚</p> <h2 id="12è¾“å…¥è¾“å‡ºioæµ">12ã€è¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰æµ<a class="headerlink" href="#12è¾“å…¥è¾“å‡ºioæµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>åœ¨å˜é‡ã€æ•°ç»„ã€å¯¹è±¡å’Œé›†åˆä¸­å­˜å‚¨çš„æ•°æ®æ˜¯æš‚æ—¶å­˜åœ¨çš„ï¼Œä¸€æ—¦ç¨‹åºç»“æŸå®ƒä»¬å°±ä¼šä¸¢å¤±ã€‚ä¸ºäº†èƒ½å¤Ÿæ°¸ä¹…åœ°ä¿å­˜ç¨‹åºåˆ›å»ºçš„æ•°æ®ï¼Œéœ€è¦å°†å…¶ä¿å­˜åˆ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å…¶ä»–ç¨‹åºä¸­ä½¿ç”¨å®ƒä»¬ã€‚Java çš„ I/Oï¼ˆè¾“å…¥/è¾“å‡ºï¼‰æŠ€æœ¯å¯ä»¥å°†æ•°æ®ä¿å­˜åˆ°æ–‡æœ¬æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œ ä»¥è¾¾åˆ°æ°¸ä¹…ä¿å­˜æ•°æ®çš„è¦æ±‚ã€‚</p> <h3 id="121æµçš„æ¦‚å¿µ">12.1ã€æµçš„æ¦‚å¿µ<a class="headerlink" href="#121æµçš„æ¦‚å¿µ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>åœ¨ Java ä¸­æ‰€æœ‰æ•°æ®éƒ½æ˜¯ä½¿ç”¨æµè¯»å†™çš„ã€‚æµæ˜¯ä¸€ç»„æœ‰åºçš„æ•°æ®åºåˆ—ï¼Œå°†æ•°æ®ä»ä¸€ä¸ªåœ°æ–¹å¸¦åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚<mark>æ ¹æ®æ•°æ®æµå‘çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºè¾“å…¥ï¼ˆInputï¼‰æµå’Œè¾“å‡ºï¼ˆOutputï¼‰æµä¸¤ç§ã€‚</mark></p> <p>åœ¨å­¦ä¹ è¾“å…¥å’Œè¾“å‡ºæµä¹‹å‰ï¼Œæˆ‘ä»¬è¦æ˜ç™½ä¸ºä»€ä¹ˆåº”ç”¨ç¨‹åºéœ€è¦è¾“å…¥å’Œè¾“å‡ºæµã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¹³æ—¶ç”¨çš„ Office è½¯ä»¶ï¼Œå¯¹äº Wordã€Excel å’Œ PPT æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–è¿™äº›æ–‡æœ¬ï¼Œå’Œç¼–è¾‘è¾“å…¥ä¸€äº›æ–‡æœ¬ï¼Œè¿™éƒ½éœ€è¦åˆ©ç”¨è¾“å…¥å’Œè¾“å‡ºçš„åŠŸèƒ½ã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„ä¾‹å­æ¯”æ¯”çš†æ˜¯ã€‚</p> <h4 id="1211ä»€ä¹ˆæ˜¯è¾“å…¥è¾“å‡ºæµ">12.1.1ã€ä»€ä¹ˆæ˜¯è¾“å…¥/è¾“å‡ºæµ<a class="headerlink" href="#1211ä»€ä¹ˆæ˜¯è¾“å…¥è¾“å‡ºæµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Java ç¨‹åºé€šè¿‡æµæ¥å®Œæˆè¾“å…¥/è¾“å‡ºï¼Œæ‰€æœ‰çš„è¾“å…¥/è¾“å‡ºä»¥æµçš„å½¢å¼å¤„ç†ã€‚å› æ­¤è¦äº†è§£ I/O ç³»ç»Ÿï¼Œé¦–å…ˆè¦ç†è§£è¾“å…¥/è¾“å‡ºæµçš„æ¦‚å¿µã€‚</p> <p>è¾“å…¥å°±æ˜¯å°†æ•°æ®ä»å„ç§è¾“å…¥è®¾å¤‡ï¼ˆåŒ…æ‹¬æ–‡ä»¶ã€é”®ç›˜ç­‰ï¼‰ä¸­è¯»å–åˆ°å†…å­˜ä¸­ï¼Œè¾“å‡ºåˆ™æ­£å¥½ç›¸åï¼Œæ˜¯å°†æ•°æ®å†™å…¥åˆ°å„ç§è¾“å‡ºè®¾å¤‡ï¼ˆæ¯”å¦‚æ–‡ä»¶ã€æ˜¾ç¤ºå™¨ã€ç£ç›˜ç­‰ï¼‰ã€‚ä¾‹å¦‚é”®ç›˜å°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„è¾“å…¥è®¾å¤‡ï¼Œè€Œæ˜¾ç¤ºå™¨å°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„è¾“å‡ºè®¾å¤‡ï¼Œä½†æ˜¯æ–‡ä»¶æ—¢å¯ä»¥ä½œä¸ºè¾“å…¥è®¾å¤‡ï¼Œåˆå¯ä»¥ä½œä¸ºè¾“å‡ºè®¾å¤‡ã€‚</p> <p>æ•°æ®æµæ˜¯ Java è¿›è¡Œ I/O æ“ä½œçš„å¯¹è±¡ï¼Œå®ƒæŒ‰ç…§ä¸åŒçš„æ ‡å‡†å¯ä»¥åˆ†ä¸ºä¸åŒçš„ç±»åˆ«ã€‚</p> <ul> <li>æŒ‰ç…§æµçš„æ–¹å‘ä¸»è¦åˆ†ä¸ºè¾“å…¥æµå’Œè¾“å‡ºæµä¸¤å¤§ç±»ã€‚</li> <li>æ•°æ®æµæŒ‰ç…§æ•°æ®å•ä½çš„ä¸åŒåˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚</li> <li>æŒ‰ç…§åŠŸèƒ½å¯ä»¥åˆ’åˆ†ä¸ºèŠ‚ç‚¹æµå’Œå¤„ç†æµã€‚</li> </ul> <p>æ•°æ®æµçš„å¤„ç†åªèƒ½æŒ‰ç…§æ•°æ®åºåˆ—çš„é¡ºåºæ¥è¿›è¡Œï¼Œå³å‰ä¸€ä¸ªæ•°æ®å¤„ç†å®Œä¹‹åæ‰èƒ½å¤„ç†åä¸€ä¸ªæ•°æ®ã€‚æ•°æ®æµä»¥è¾“å…¥æµçš„å½¢å¼è¢«ç¨‹åºè·å–ï¼Œå†ä»¥è¾“å‡ºæµçš„å½¢å¼å°†æ•°æ®è¾“å‡ºåˆ°å…¶å®ƒè®¾å¤‡ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/5-200115142HWK.png" data-desc-position="bottom"><img src="!assets/Java/5-200115142HWK.png" alt="è¾“å…¥æµæ¨¡å¼" style="zoom:80%;"></a></p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/5-200115142K1644.png" data-desc-position="bottom"><img src="!assets/Java/5-200115142K1644.png" alt="è¾“å‡ºæµæ¨¡å¼" style="zoom:80%;"></a></p> <h4 id="1212è¾“å…¥æµ">12.1.2ã€è¾“å…¥æµ<a class="headerlink" href="#1212è¾“å…¥æµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Java æµç›¸å…³çš„ç±»éƒ½å°è£…åœ¨ java.io åŒ…ä¸­ï¼Œè€Œä¸”æ¯ä¸ªæ•°æ®æµéƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚æ‰€æœ‰è¾“å…¥æµç±»éƒ½æ˜¯ InputStream æŠ½è±¡ç±»ï¼ˆå­—èŠ‚è¾“å…¥æµï¼‰å’Œ Reader æŠ½è±¡ç±»ï¼ˆå­—ç¬¦è¾“å…¥æµï¼‰çš„å­ç±»ã€‚å…¶ä¸­ InputStream ç±»æ˜¯å­—èŠ‚è¾“å…¥æµçš„æŠ½è±¡ç±»ï¼Œæ˜¯æ‰€æœ‰å­—èŠ‚è¾“å…¥æµçš„çˆ¶ç±»ï¼Œå…¶å±‚æ¬¡ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/5-200115145253550.png" data-desc-position="bottom"><img src="!assets/Java/5-200115145253550.png" alt="InputStreamç±»çš„å±‚æ¬¡ç»“æ„å›¾" style="zoom:80%;"></a></p> <p>InputStream ç±»ä¸­æ‰€æœ‰æ–¹æ³•é‡åˆ°é”™è¯¯æ—¶éƒ½ä¼šå¼•å‘ IOException å¼‚å¸¸ã€‚å¦‚ä¸‹æ˜¯è¯¥ç±»ä¸­åŒ…å«çš„å¸¸ç”¨æ–¹æ³•ã€‚</p> <table> <thead> <tr> <th>åç§°</th> <th>ä½œç”¨</th> </tr> </thead> <tbody> <tr> <td>int read()</td> <td>ä»è¾“å…¥æµè¯»å…¥ä¸€å­—èŠ‚çš„æ•°æ®ï¼Œå°†å®ƒè½¬æ¢æˆä¸€ä¸ª 0~ 255 çš„æ•´æ•°ï¼Œè¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œå¦‚æœé‡åˆ°è¾“å…¥æµçš„ç»“å°¾è¿”å› -1</td> </tr> <tr> <td>int read(byte[] b)</td> <td>ä»è¾“å…¥æµè¯»å–è‹¥å¹²å­—èŠ‚çš„æ•°æ®ä¿å­˜åˆ°å‚æ•° b æŒ‡å®šçš„å­—èŠ‚æ•°ç»„ä¸­ï¼Œè¿”å›çš„å­—èŠ‚æ•°è¡¨ç¤ºè¯»å–çš„å­—èŠ‚æ•°ï¼Œå¦‚æœé‡åˆ°è¾“å…¥æµçš„ç»“å°¾è¿”å› -1</td> </tr> <tr> <td>int read(byte[] b,int off,int len)</td> <td>ä»è¾“å…¥æµè¯»å–è‹¥å¹²å­—èŠ‚çš„æ•°æ®ä¿å­˜åˆ°å‚æ•° b æŒ‡å®šçš„å­—èŠ‚æ•°ç»„ä¸­ï¼Œå…¶ä¸­ off æ˜¯æŒ‡åœ¨æ•°ç»„ä¸­å¼€å§‹ä¿å­˜æ•°æ®ä½ç½®çš„èµ·å§‹ä¸‹æ ‡ï¼Œlen æ˜¯æŒ‡è¯»å–å­—èŠ‚çš„ä½æ•°ã€‚è¿”å›çš„æ˜¯å®é™…è¯»å–çš„å­—èŠ‚æ•°ï¼Œå¦‚æœé‡åˆ°è¾“å…¥æµçš„ç»“å°¾åˆ™è¿”å› -1</td> </tr> <tr> <td>void close()</td> <td>å…³é—­æ•°æ®æµï¼Œå½“å®Œæˆå¯¹æ•°æ®æµçš„æ“ä½œä¹‹åéœ€è¦å…³é—­æ•°æ®æµ</td> </tr> <tr> <td>int available()</td> <td>è¿”å›å¯ä»¥ä»æ•°æ®æºè¯»å–çš„æ•°æ®æµçš„ä½æ•°ã€‚</td> </tr> <tr> <td>skip(long n)</td> <td>ä»è¾“å…¥æµè·³è¿‡å‚æ•° n æŒ‡å®šçš„å­—èŠ‚æ•°ç›®</td> </tr> <tr> <td>boolean markSupported()</td> <td>åˆ¤æ–­è¾“å…¥æµæ˜¯å¦å¯ä»¥é‡å¤è¯»å–ï¼ˆæ˜¯å¦å¯ä»¥ä½¿ç”¨markå’Œresetï¼‰ï¼Œå¦‚æœå¯ä»¥å°±è¿”å› true</td> </tr> <tr> <td>void mark(int readLimit)</td> <td>å¦‚æœè¾“å…¥æµå¯ä»¥è¢«é‡å¤è¯»å–ï¼Œä»æµçš„å½“å‰ä½ç½®å¼€å§‹è®¾ç½®æ ‡è®°ï¼ŒreadLimit æŒ‡å®šå¯ä»¥è®¾ç½®æ ‡è®°çš„å­—èŠ‚æ•°</td> </tr> <tr> <td>void reset()</td> <td>ä½¿è¾“å…¥æµé‡æ–°å®šä½åˆ°åˆšæ‰è¢«æ ‡è®°çš„ä½ç½®ï¼Œè¿™æ ·å¯ä»¥é‡æ–°è¯»å–æ ‡è®°è¿‡çš„æ•°æ®</td> </tr> </tbody> </table> <p>ä¸Šè¿°æœ€å 3 ä¸ªæ–¹æ³•ä¸€èˆ¬ä¼šç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œé¦–å…ˆä½¿ç”¨ markSupported() åˆ¤æ–­ï¼Œå¦‚æœå¯ä»¥é‡å¤è¯»å–ï¼Œåˆ™ä½¿ç”¨ mark(int readLimit) æ–¹æ³•è¿›è¡Œæ ‡è®°ï¼Œæ ‡è®°å®Œæˆä¹‹åå¯ä»¥ä½¿ç”¨ read() æ–¹æ³•è¯»å–æ ‡è®°èŒƒå›´å†…çš„å­—èŠ‚æ•°ï¼Œæœ€åä½¿ç”¨ reset() æ–¹æ³•ä½¿è¾“å…¥æµé‡æ–°å®šä½åˆ°æ ‡è®°çš„ä½ç½®ï¼Œç»§è€Œå®Œæˆé‡å¤è¯»å–æ“ä½œã€‚</p> <p>Java ä¸­çš„å­—ç¬¦æ˜¯ Unicode ç¼–ç ï¼Œå³åŒå­—èŠ‚çš„ï¼Œè€Œ InputerStream æ˜¯ç”¨æ¥å¤„ç†å•å­—èŠ‚çš„ï¼Œåœ¨å¤„ç†å­—ç¬¦æ–‡æœ¬æ—¶ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨ Java çš„æ–‡æœ¬è¾“å…¥æµ Reader ç±»ï¼Œè¯¥ç±»æ˜¯å­—ç¬¦è¾“å…¥æµçš„æŠ½è±¡ç±»ï¼Œå³æ‰€æœ‰å­—ç¬¦è¾“å…¥æµçš„å®ç°éƒ½æ˜¯å®ƒçš„å­ç±»ï¼Œè¯¥ç±»çš„æ–¹æ³•ä¸ InputerSteam ç±»çš„æ–¹æ³•ç±»ä¼¼ã€‚</p> <h4 id="1213è¾“å‡ºæµ">12.1.3ã€è¾“å‡ºæµ<a class="headerlink" href="#1213è¾“å‡ºæµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>åœ¨ Java ä¸­æ‰€æœ‰è¾“å‡ºæµç±»éƒ½æ˜¯ OutputStream æŠ½è±¡ç±»ï¼ˆå­—èŠ‚è¾“å‡ºæµï¼‰å’Œ Writer æŠ½è±¡ç±»ï¼ˆå­—ç¬¦è¾“å‡ºæµï¼‰çš„å­ç±»ã€‚å…¶ä¸­ OutputStream ç±»æ˜¯å­—èŠ‚è¾“å‡ºæµçš„æŠ½è±¡ç±»ï¼Œæ˜¯æ‰€æœ‰å­—èŠ‚è¾“å‡ºæµçš„çˆ¶ç±»ï¼Œå…¶å±‚æ¬¡ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/5-200115151G3J0.png" data-desc-position="bottom"><img src="!assets/Java/5-200115151G3J0.png" alt="OutputStreamç±»çš„å±‚æ¬¡ç»“æ„å›¾" style="zoom:80%;"></a></p> <p>OutputStream ç±»æ˜¯æ‰€æœ‰å­—èŠ‚è¾“å‡ºæµçš„è¶…ç±»ï¼Œç”¨äºä»¥äºŒè¿›åˆ¶çš„å½¢å¼å°†æ•°æ®å†™å…¥ç›®æ ‡è®¾å¤‡ï¼Œè¯¥ç±»æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚OutputStream ç±»æä¾›äº†ä¸€ç³»åˆ—è·Ÿæ•°æ®è¾“å‡ºæœ‰å…³çš„æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p> <table> <thead> <tr> <th>åç§°</th> <th>ä½œç”¨</th> </tr> </thead> <tbody> <tr> <td>int write(b)</td> <td>å°†æŒ‡å®šå­—èŠ‚çš„æ•°æ®å†™å…¥åˆ°è¾“å‡ºæµ</td> </tr> <tr> <td>int write (byte[] b)</td> <td>å°†æŒ‡å®šå­—èŠ‚æ•°ç»„çš„å†…å®¹å†™å…¥è¾“å‡ºæµ</td> </tr> <tr> <td>int write (byte[] b,int off,int len)</td> <td>å°†æŒ‡å®šå­—èŠ‚æ•°ç»„ä» off ä½ç½®å¼€å§‹çš„ len å­—èŠ‚çš„å†…å®¹å†™å…¥è¾“å‡ºæµ</td> </tr> <tr> <td>close()</td> <td>å…³é—­æ•°æ®æµï¼Œå½“å®Œæˆå¯¹æ•°æ®æµçš„æ“ä½œä¹‹åéœ€è¦å…³é—­æ•°æ®æµ</td> </tr> <tr> <td>flush()</td> <td>åˆ·æ–°è¾“å‡ºæµï¼Œå¼ºè¡Œå°†ç¼“å†²åŒºçš„å†…å®¹å†™å…¥è¾“å‡ºæµ</td> </tr> </tbody> </table> <h3 id="122ç³»ç»Ÿæµ">12.2ã€ç³»ç»Ÿæµ<a class="headerlink" href="#122ç³»ç»Ÿæµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æ¯ä¸ª Java ç¨‹åºè¿è¡Œæ—¶éƒ½å¸¦æœ‰ä¸€ä¸ªç³»ç»Ÿæµï¼Œç³»ç»Ÿæµå¯¹åº”çš„ç±»ä¸º java.lang.Systemã€‚Sytem ç±»å°è£…äº† Java ç¨‹åºè¿è¡Œæ—¶çš„ 3 ä¸ªç³»ç»Ÿæµï¼Œåˆ†åˆ«é€šè¿‡ inã€out å’Œ err å˜é‡æ¥å¼•ç”¨ã€‚è¿™ 3 ä¸ªç³»ç»Ÿæµå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <ul> <li>System.inï¼šæ ‡å‡†è¾“å…¥æµï¼Œé»˜è®¤è®¾å¤‡æ˜¯é”®ç›˜ã€‚</li> <li>System.outï¼šæ ‡å‡†è¾“å‡ºæµï¼Œé»˜è®¤è®¾å¤‡æ˜¯æ§åˆ¶å°ã€‚</li> <li>System.errï¼šæ ‡å‡†é”™è¯¯æµï¼Œé»˜è®¤è®¾å¤‡æ˜¯æ§åˆ¶å°ã€‚</li> </ul> <p>ä»¥ä¸Šå˜é‡çš„ä½œç”¨åŸŸä¸º public å’Œ staticï¼Œå› æ­¤åœ¨ç¨‹åºçš„ä»»ä½•éƒ¨åˆ†éƒ½ä¸éœ€å¼•ç”¨ System å¯¹è±¡å°±å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚</p> <p>ä¸‹é¢çš„ç¨‹åºæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ System.in è¯»å–å­—èŠ‚æ•°ç»„ï¼Œä½¿ç”¨ System.out è¾“å‡ºå­—èŠ‚æ•°ç»„ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test01</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-141-3"><a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">byteData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="mi">100</span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="c1">// å£°æ˜ä¸€ä¸ªå­—èŠ‚æ•°ç»„</span>
</span><span id="__span-141-4"><a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¯·è¾“å…¥è‹±æ–‡ï¼š"</span><span class="p">);</span>
</span><span id="__span-141-5"><a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-141-6"><a id="__codelineno-141-6" name="__codelineno-141-6" href="#__codelineno-141-6"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">byteData</span><span class="p">);</span>
</span><span id="__span-141-7"><a id="__codelineno-141-7" name="__codelineno-141-7" href="#__codelineno-141-7"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-141-8"><a id="__codelineno-141-8" name="__codelineno-141-8" href="#__codelineno-141-8"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-141-9"><a id="__codelineno-141-9" name="__codelineno-141-9" href="#__codelineno-141-9"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-141-10"><a id="__codelineno-141-10" name="__codelineno-141-10" href="#__codelineno-141-10"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ‚¨è¾“å…¥çš„å†…å®¹å¦‚ä¸‹ï¼š"</span><span class="p">);</span>
</span><span id="__span-141-11"><a id="__codelineno-141-11" name="__codelineno-141-11" href="#__codelineno-141-11"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">byteData</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-141-12"><a id="__codelineno-141-12" name="__codelineno-141-12" href="#__codelineno-141-12"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="n">byteData</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
</span><span id="__span-141-13"><a id="__codelineno-141-13" name="__codelineno-141-13" href="#__codelineno-141-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-141-14"><a id="__codelineno-141-14" name="__codelineno-141-14" href="#__codelineno-141-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-141-15"><a id="__codelineno-141-15" name="__codelineno-141-15" href="#__codelineno-141-15"></a><span class="p">}</span>
</span></code></pre></div> <p>è¯¥ç¨‹åºçš„è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a>è¯·è¾“å…¥è‹±æ–‡ï¼š
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a>abcdefg hijklmn opqrst uvwxyz
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a>æ‚¨è¾“å…¥çš„å†…å®¹å¦‚ä¸‹ï¼š
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a>abcdefg hijklmn opqrst uvwxyz
</span></code></pre></div> <p><mark>System.in æ˜¯ InputStream ç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œ==å› æ­¤ä¸Šè¿°ä»£ç çš„ System.in.read() æ–¹æ³•å®é™…æ˜¯è®¿é—® InputStream ç±»å®šä¹‰çš„ read() æ–¹æ³•ã€‚è¯¥æ–¹æ³•å¯ä»¥ä»é”®ç›˜è¯»å–ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚==å¯¹äº System.out è¾“å‡ºæµä¸»è¦ç”¨äºå°†æŒ‡å®šå†…å®¹è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</mark></p> <p>==System.out å’Œ System.error æ˜¯ PrintStream ç±»çš„å¯¹è±¡ã€‚==å› ä¸º PrintStream æ˜¯ä¸€ä¸ªä» OutputStream æ´¾ç”Ÿçš„è¾“å‡ºæµï¼Œæ‰€ä»¥å®ƒè¿˜æ‰§è¡Œä½çº§åˆ«çš„ write() æ–¹æ³•ã€‚å› æ­¤ï¼Œé™¤äº† print() å’Œ println() æ–¹æ³•å¯ä»¥å®Œæˆæ§åˆ¶å°è¾“å‡ºä»¥å¤–ï¼ŒSystem.out è¿˜å¯ä»¥è°ƒç”¨ write() æ–¹æ³•å®ç°æ§åˆ¶å°è¾“å‡ºã€‚</p> <p>write() æ–¹æ³•çš„ç®€å•å½¢å¼å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">byteval</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span>
</span></code></pre></div> <p>è¯¥æ–¹æ³•é€šè¿‡ byteval å‚æ•°å‘æ–‡ä»¶å†™å…¥æŒ‡å®šçš„å­—èŠ‚ã€‚åœ¨å®é™…æ“ä½œä¸­ï¼Œprint() æ–¹æ³•å’Œ println() æ–¹æ³•æ¯” write() æ–¹æ³•æ›´å¸¸ç”¨ã€‚</p> <p>æ³¨æ„ï¼šå°½ç®¡å®ƒä»¬é€šå¸¸ç”¨äºå¯¹æ§åˆ¶å°è¿›è¡Œè¯»å–å’Œå†™å…¥å­—ç¬¦ï¼Œä½†æ˜¯è¿™äº›éƒ½æ˜¯å­—èŠ‚æµã€‚å› ä¸ºé¢„å®šä¹‰æµæ˜¯æ²¡æœ‰å¼•å…¥å­—ç¬¦æµçš„ Java åŸå§‹è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å®ƒä»¬ä¸æ˜¯å­—ç¬¦æµè€Œæ˜¯å­—èŠ‚æµï¼Œä½†æ˜¯åœ¨ Java ä¸­å¯ä»¥å°†å®ƒä»¬æ‰“åŒ…åˆ°åŸºäºå­—ç¬¦çš„æµä¸­ä½¿ç”¨ã€‚</p> <h3 id="123å­—ç¬¦ç¼–ç ä»‹ç»">12.3ã€å­—ç¬¦ç¼–ç ä»‹ç»<a class="headerlink" href="#123å­—ç¬¦ç¼–ç ä»‹ç»" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>è®¡ç®—æœºä¸­ï¼Œä»»ä½•çš„æ–‡å­—éƒ½æ˜¯ä»¥æŒ‡å®šçš„ç¼–ç æ–¹å¼å­˜åœ¨çš„ï¼Œåœ¨ <a href="http://c.biancheng.net/java/">Java</a> ç¨‹åºçš„å¼€å‘ä¸­æœ€å¸¸è§çš„æ˜¯ ISO8859-1ã€GBK/GB2312ã€Unicodeã€ UTF ç¼–ç ã€‚</p> <p>Java ä¸­å¸¸è§ç¼–ç è¯´æ˜å¦‚ä¸‹ï¼š</p> <ul> <li>ISO8859-1ï¼šå±äºå•å­—èŠ‚ç¼–ç ï¼Œæœ€å¤šåªèƒ½è¡¨ç¤º 0~255 çš„å­—ç¬¦èŒƒå›´ã€‚</li> <li>GBK/GB2312ï¼šä¸­æ–‡çš„å›½æ ‡ç¼–ç ï¼Œç”¨æ¥è¡¨ç¤ºæ±‰å­—ï¼Œå±äºåŒå­—èŠ‚ç¼–ç ã€‚GBK å¯ä»¥è¡¨ç¤ºç®€ä½“ä¸­æ–‡å’Œç¹ä½“ä¸­æ–‡ï¼Œè€Œ GB2312 åªèƒ½è¡¨ç¤ºç®€ä½“ä¸­æ–‡ã€‚GBK å…¼å®¹ GB2312ã€‚</li> <li>Unicodeï¼šæ˜¯ä¸€ç§ç¼–ç è§„èŒƒï¼Œæ˜¯ä¸ºè§£å†³å…¨çƒå­—ç¬¦é€šç”¨ç¼–ç è€Œè®¾è®¡çš„ã€‚UTF-8 å’Œ UTF-16 æ˜¯è¿™ç§è§„èŒƒçš„ä¸€ç§å®ç°ï¼Œæ­¤ç¼–ç ä¸å…¼å®¹ ISO8859-1 ç¼–ç ã€‚Java å†…éƒ¨é‡‡ç”¨æ­¤ç¼–ç ã€‚</li> <li>UTFï¼šUTF ç¼–ç å…¼å®¹äº† ISO8859-1 ç¼–ç ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºæ‰€æœ‰çš„è¯­è¨€å­—ç¬¦ï¼Œä¸è¿‡ UTF ç¼–ç æ˜¯ä¸å®šé•¿ç¼–ç ï¼Œæ¯ä¸€ä¸ªå­—ç¬¦çš„é•¿åº¦ä¸º 1~6 ä¸ªå­—èŠ‚ä¸ç­‰ã€‚ä¸€èˆ¬åœ¨ä¸­æ–‡ç½‘é¡µä¸­ä½¿ç”¨æ­¤ç¼–ç ï¼Œå¯ä»¥èŠ‚çœç©ºé—´ã€‚</li> </ul> <p>åœ¨ç¨‹åºä¸­å¦‚æœå¤„ç†ä¸å¥½å­—ç¬¦ç¼–ç ï¼Œå°±æœ‰å¯èƒ½å‡ºç°ä¹±ç é—®é¢˜ã€‚ä¾‹å¦‚ç°åœ¨æœ¬æœºçš„é»˜è®¤ç¼–ç æ˜¯ GBKï¼Œä½†åœ¨ç¨‹åºä¸­ä½¿ç”¨äº† ISO8859-1 ç¼–ç ï¼Œåˆ™å°±ä¼šå‡ºç°å­—ç¬¦çš„ä¹±ç é—®é¢˜ã€‚å°±åƒä¸¤ä¸ªäººäº¤è°ˆï¼Œä¸€ä¸ªäººè¯´ä¸­æ–‡ï¼Œå¦å¤–ä¸€ä¸ªäººè¯´è‹±è¯­ï¼Œè¯­è¨€ä¸åŒå°±æ— æ³•æ²Ÿé€šã€‚ä¸ºäº†é¿å…äº§ç”Ÿä¹±ç ï¼Œç¨‹åºç¼–ç åº”ä¸æœ¬åœ°çš„é»˜è®¤ç¼–ç ä¿æŒä¸€è‡´ã€‚</p> <p>æœ¬åœ°çš„é»˜è®¤ç¼–ç å¯ä»¥ä½¿ç”¨ System ç±»æŸ¥çœ‹ã€‚Java ä¸­ System ç±»å¯ä»¥å–å¾—ä¸ç³»ç»Ÿæœ‰å…³çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨æ­¤ç±»å¯ä»¥æ‰¾åˆ°ç³»ç»Ÿçš„é»˜è®¤ç¼–ç ã€‚æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Properties</span><span class="w"> </span><span class="nf">getProperty</span><span class="p">()</span>
</span></code></pre></div> <p>ä½¿ç”¨ä¸Šè¿°æ–¹æ³•å¯ä»¥æŸ¥çœ‹ JVM çš„é»˜è®¤ç¼–ç ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-2"><a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a><span class="w">    </span><span class="c1">// è·å–å½“å‰ç³»ç»Ÿç¼–ç </span>
</span><span id="__span-145-3"><a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"ç³»ç»Ÿé»˜è®¤ç¼–ç ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">"file.encoding"</span><span class="p">));</span>
</span><span id="__span-145-4"><a id="__codelineno-145-4" name="__codelineno-145-4" href="#__codelineno-145-4"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a>ç³»ç»Ÿé»˜è®¤ç¼–ç ï¼šGBK
</span></code></pre></div> <p>å¯ä»¥çœ‹å‡ºï¼Œç°åœ¨æ“ä½œç³»ç»Ÿçš„é»˜è®¤ç¼–ç æ˜¯ GBKã€‚</p> <p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç¤ºä¾‹è®²è§£ä¹±ç çš„äº§ç”Ÿã€‚ç°åœ¨æœ¬åœ°çš„é»˜è®¤ç¼–ç æ˜¯ GBKï¼Œä¸‹é¢é€šè¿‡ ISO8859-1 ç¼–ç å¯¹æ–‡å­—è¿›è¡Œç¼–ç è½¬æ¢ã€‚å¦‚æœè¦å®ç°ç¼–ç çš„è½¬æ¢å¯ä»¥ä½¿ç”¨ String ç±»ä¸­çš„ getBytes(String charset) æ–¹æ³•ï¼Œæ­¤æ–¹æ³•å¯ä»¥è®¾ç½®æŒ‡å®šçš„ç¼–ç ï¼Œè¯¥æ–¹æ³•çš„æ ¼å¼å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="nf">getBytes</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">charset</span><span class="p">);</span>
</span></code></pre></div> <p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-148-2"><a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-148-3"><a id="__codelineno-148-3" name="__codelineno-148-3" href="#__codelineno-148-3"></a><span class="w">        </span><span class="n">File</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">"D:"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="na">separator</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"test.txt"</span><span class="p">);</span>
</span><span id="__span-148-4"><a id="__codelineno-148-4" name="__codelineno-148-4" href="#__codelineno-148-4"></a><span class="w">        </span><span class="c1">// å®ä¾‹åŒ–è¾“å‡ºæµ</span>
</span><span id="__span-148-5"><a id="__codelineno-148-5" name="__codelineno-148-5" href="#__codelineno-148-5"></a><span class="w">        </span><span class="n">OutputStream</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span id="__span-148-6"><a id="__codelineno-148-6" name="__codelineno-148-6" href="#__codelineno-148-6"></a><span class="w">        </span><span class="c1">// æŒ‡å®šISO8859-1ç¼–ç </span>
</span><span id="__span-148-7"><a id="__codelineno-148-7" name="__codelineno-148-7" href="#__codelineno-148-7"></a><span class="w">        </span><span class="kt">byte</span><span class="w"> </span><span class="n">b</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Cè¯­è¨€æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ï¼"</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(</span><span class="s">"ISO8859-1"</span><span class="p">);</span>
</span><span id="__span-148-8"><a id="__codelineno-148-8" name="__codelineno-148-8" href="#__codelineno-148-8"></a><span class="w">        </span><span class="c1">// ä¿å­˜è½¬ç ä¹‹åçš„æ•°æ®</span>
</span><span id="__span-148-9"><a id="__codelineno-148-9" name="__codelineno-148-9" href="#__codelineno-148-9"></a><span class="w">        </span><span class="n">out</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span><span id="__span-148-10"><a id="__codelineno-148-10" name="__codelineno-148-10" href="#__codelineno-148-10"></a><span class="w">        </span><span class="c1">// å…³é—­è¾“å‡ºæµ</span>
</span><span id="__span-148-11"><a id="__codelineno-148-11" name="__codelineno-148-11" href="#__codelineno-148-11"></a><span class="w">        </span><span class="n">out</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</span><span id="__span-148-12"><a id="__codelineno-148-12" name="__codelineno-148-12" href="#__codelineno-148-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-148-13"><a id="__codelineno-148-13" name="__codelineno-148-13" href="#__codelineno-148-13"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/5-191223141433509.png" data-desc-position="bottom"><img src="!assets/Java/5-191223141433509.png" alt="img" style="zoom:80%;"></a></p> <p>å¯ä»¥å‘ç°ï¼Œå› ä¸ºç¼–ç ä¸ä¸€è‡´ï¼Œæ‰€ä»¥åœ¨ä¿å­˜æ—¶å‡ºç°äº†ä¹±ç ã€‚åœ¨ Java çš„å¼€å‘ä¸­ï¼Œä¹±ç æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„é—®é¢˜ï¼Œä¹±ç çš„äº§ç”Ÿå°±æœ‰ä¸€ä¸ªåŸå› ï¼Œå³è¾“å‡ºå†…å®¹çš„ç¼–ç ä¸æ¥æ”¶å†…å®¹çš„ç¼–ç ä¸ä¸€è‡´ã€‚</p> <h3 id="124fileç±»">12.4ã€Fileç±»<a class="headerlink" href="#124fileç±»" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>åœ¨ Java ä¸­ï¼Œ==File ç±»æ˜¯ java.io åŒ…ä¸­å”¯ä¸€ä»£è¡¨ç£ç›˜æ–‡ä»¶æœ¬èº«çš„å¯¹è±¡ï¼Œ==ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå¸Œæœ›åœ¨ç¨‹åºä¸­æ“ä½œæ–‡ä»¶å’Œç›®å½•ï¼Œåˆ™éƒ½å¯ä»¥é€šè¿‡ File ç±»æ¥å®Œæˆã€‚File ç±»å®šä¹‰äº†ä¸€äº›æ–¹æ³•æ¥æ“ä½œæ–‡ä»¶ï¼Œå¦‚æ–°å»ºã€åˆ é™¤ã€é‡å‘½åæ–‡ä»¶å’Œç›®å½•ç­‰ã€‚</p> <p>File ç±»ä¸èƒ½è®¿é—®æ–‡ä»¶å†…å®¹æœ¬èº«ï¼Œå¦‚æœéœ€è¦è®¿é—®æ–‡ä»¶å†…å®¹æœ¬èº«ï¼Œåˆ™éœ€è¦ä½¿ç”¨è¾“å…¥/è¾“å‡ºæµã€‚</p> <p>File ç±»æä¾›äº†å¦‚ä¸‹ä¸‰ç§å½¢å¼æ„é€ æ–¹æ³•ã€‚</p> <ol> <li>File(String path)ï¼šå¦‚æœ path æ˜¯å®é™…å­˜åœ¨çš„è·¯å¾„ï¼Œåˆ™è¯¥ File å¯¹è±¡è¡¨ç¤ºçš„æ˜¯ç›®å½•ï¼›å¦‚æœ path æ˜¯æ–‡ä»¶åï¼Œåˆ™è¯¥ File å¯¹è±¡è¡¨ç¤ºçš„æ˜¯æ–‡ä»¶ã€‚</li> <li>File(String path, String name)ï¼špath æ˜¯è·¯å¾„åï¼Œname æ˜¯æ–‡ä»¶åã€‚</li> <li>File(File dir, String name)ï¼šdir æ˜¯è·¯å¾„å¯¹è±¡ï¼Œname æ˜¯æ–‡ä»¶åã€‚</li> </ol> <p>ä½¿ç”¨ä»»æ„ä¸€ä¸ªæ„é€ æ–¹æ³•éƒ½å¯ä»¥åˆ›å»ºä¸€ä¸ª File å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶æä¾›çš„æ–¹æ³•å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚åœ¨ä¸‹è¡¨ä¸­åˆ—å‡ºäº† File ç±»çš„å¸¸ç”¨æ–¹æ³•åŠè¯´æ˜ã€‚</p> <table> <thead> <tr> <th>æ–¹æ³•åç§°</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>boolean canRead()</td> <td>æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦èƒ½ä»æŒ‡å®šçš„æ–‡ä»¶ä¸­è¿›è¡Œè¯»å–</td> </tr> <tr> <td>boolean canWrite()</td> <td>æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦èƒ½å†™å½“å‰æ–‡ä»¶</td> </tr> <tr> <td>boolean createNewFile()</td> <td>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</td> </tr> <tr> <td>boolean delete()</td> <td>åˆ é™¤å½“å‰å¯¹è±¡æŒ‡å®šçš„æ–‡ä»¶</td> </tr> <tr> <td>boolean exists()</td> <td>æµ‹è¯•å½“å‰ File æ˜¯å¦å­˜åœ¨</td> </tr> <tr> <td>String getAbsolutePath()</td> <td>è¿”å›ç”±è¯¥å¯¹è±¡è¡¨ç¤ºçš„æ–‡ä»¶çš„ç»å¯¹è·¯å¾„å</td> </tr> <tr> <td>String getName()</td> <td>è¿”å›è¡¨ç¤ºå½“å‰å¯¹è±¡çš„æ–‡ä»¶åæˆ–è·¯å¾„åï¼ˆå¦‚æœæ˜¯è·¯å¾„ï¼Œåˆ™è¿”å›æœ€åä¸€çº§å­è·¯å¾„åï¼‰</td> </tr> <tr> <td>String getParent()</td> <td>è¿”å›å½“å‰ File å¯¹è±¡æ‰€å¯¹åº”ç›®å½•ï¼ˆæœ€åä¸€çº§å­ç›®å½•ï¼‰çš„çˆ¶ç›®å½•å</td> </tr> <tr> <td>boolean isAbsolute()</td> <td>æµ‹è¯•å½“å‰ File å¯¹è±¡è¡¨ç¤ºçš„æ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªç»å¯¹è·¯å¾„åã€‚è¯¥æ–¹æ³•æ¶ˆé™¤äº†ä¸åŒå¹³å°çš„å·®å¼‚ï¼Œå¯ä»¥ç›´æ¥åˆ¤æ–­ file å¯¹è±¡æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ã€‚åœ¨ UNIX/Linux/BSD ç­‰ç³»ç»Ÿä¸Šï¼Œå¦‚æœè·¯å¾„åå¼€å¤´æ˜¯ä¸€æ¡æ–œçº¿<code>/</code>ï¼Œåˆ™è¡¨æ˜è¯¥ File å¯¹è±¡å¯¹åº”ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼›åœ¨ Windows ç­‰ç³»ç»Ÿä¸Šï¼Œå¦‚æœè·¯å¾„å¼€å¤´æ˜¯ç›˜ç¬¦ï¼Œåˆ™è¯´æ˜å®ƒæ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚</td> </tr> <tr> <td>boolean isDirectory()</td> <td>æµ‹è¯•å½“å‰ File å¯¹è±¡è¡¨ç¤ºçš„æ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªè·¯å¾„</td> </tr> <tr> <td>boolean isFile()</td> <td>æµ‹è¯•å½“å‰ File å¯¹è±¡è¡¨ç¤ºçš„æ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªâ€œæ™®é€šâ€æ–‡ä»¶</td> </tr> <tr> <td>long lastModified()</td> <td>è¿”å›å½“å‰ File å¯¹è±¡è¡¨ç¤ºçš„æ–‡ä»¶æœ€åä¿®æ”¹çš„æ—¶é—´</td> </tr> <tr> <td>long length()</td> <td>è¿”å›å½“å‰ File å¯¹è±¡è¡¨ç¤ºçš„æ–‡ä»¶é•¿åº¦</td> </tr> <tr> <td>String[] list()</td> <td>è¿”å›å½“å‰ File å¯¹è±¡çš„å­çº§ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶çš„æ–‡ä»¶å</td> </tr> <tr> <td>File[] listFiles()</td> <td>è¿”å›å½“å‰ File å¯¹è±¡çš„å­çº§ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</td> </tr> <tr> <td>String[] list(FilenameFilter)</td> <td>è¿”å›å½“å‰ File å¯¹è±¡çš„å­çº§ç›®å½•ä¸­æ»¡è¶³æŒ‡å®šè¿‡æ»¤å™¨çš„æ–‡ä»¶åˆ—è¡¨</td> </tr> <tr> <td>boolean mkdir()</td> <td>åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå®ƒçš„è·¯å¾„åç”±å½“å‰ File å¯¹è±¡æŒ‡å®š</td> </tr> <tr> <td>boolean mkdirs()</td> <td>åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå®ƒçš„è·¯å¾„åç”±å½“å‰ File å¯¹è±¡æŒ‡å®š</td> </tr> <tr> <td>boolean renameTo(File)</td> <td>å°†å½“å‰ File å¯¹è±¡æŒ‡å®šçš„æ–‡ä»¶æ›´åä¸ºç»™å®šå‚æ•° File æŒ‡å®šçš„è·¯å¾„å</td> </tr> </tbody> </table> <p>File ç±»ä¸­æœ‰ä»¥ä¸‹ä¸¤ä¸ªå¸¸ç”¨å¸¸é‡ï¼š</p> <ul> <li> <p>public static final String pathSeparatorï¼šæŒ‡çš„æ˜¯åˆ†éš”è¿ç»­å¤šä¸ªè·¯å¾„å­—ç¬¦ä¸²çš„åˆ†éš”ç¬¦ï¼ŒWindows ä¸‹æŒ‡<code>;</code>ã€‚ä¾‹å¦‚ <code>java -cp test.jar;abc.jar HelloWorld</code>ã€‚</p> </li> <li> <p>public static final String separatorï¼šç”¨æ¥åˆ†éš”åŒä¸€ä¸ªè·¯å¾„å­—ç¬¦ä¸²ä¸­çš„ç›®å½•çš„ï¼ŒWindows ä¸‹æŒ‡<code>/</code>ã€‚ä¾‹å¦‚ <code>C:/Program Files/Common Files</code>ã€‚ æ¯”å¦‚è¯´è¦åœ¨tempç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªtest.txtæ–‡ä»¶ï¼Œåœ¨Windowsä¸‹åº”è¯¥è¿™ä¹ˆå†™ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="n">File</span><span class="w"> </span><span class="n">file1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">(</span><span class="s">"C:\tmp\test.txt"</span><span class="p">);</span>
</span></code></pre></div> <p>åœ¨Linuxä¸‹åˆ™æ˜¯è¿™æ ·çš„ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="n">File</span><span class="w"> </span><span class="n">file2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">(</span><span class="s">"/tmp/test.txt"</span><span class="p">);</span>
</span></code></pre></div> <p>å¦‚æœè¦è€ƒè™‘è·¨å¹³å°ï¼Œåˆ™æœ€å¥½æ˜¯è¿™ä¹ˆå†™ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="n">File</span><span class="w"> </span><span class="n">myFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">"C:"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="na">separator</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"tmp"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="na">separator</span><span class="p">,</span><span class="w"> </span><span class="s">"test.txt"</span><span class="p">);</span>
</span></code></pre></div> </li> </ul> <p>æ³¨æ„ï¼šå¯ä»¥çœ‹åˆ° File ç±»çš„å¸¸é‡å®šä¹‰çš„å‘½åè§„åˆ™ä¸ç¬¦åˆæ ‡å‡†å‘½åè§„åˆ™ï¼Œå¸¸é‡åæ²¡æœ‰å…¨éƒ¨å¤§å†™ï¼Œè¿™æ˜¯å› ä¸º Java çš„å‘å±•ç»è¿‡äº†ä¸€æ®µç›¸å½“é•¿çš„æ—¶é—´ï¼Œè€Œå‘½åè§„èŒƒä¹Ÿæ˜¯é€æ­¥å½¢æˆçš„ï¼ŒFile ç±»å‡ºç°è¾ƒæ—©ï¼Œæ‰€ä»¥å½“æ—¶å¹¶æ²¡æœ‰å¯¹å‘½åè§„èŒƒæœ‰ä¸¥æ ¼çš„è¦æ±‚ï¼Œè¿™äº›éƒ½å±äº Java çš„å†å²é—ç•™é—®é¢˜ã€‚</p> <p>Windows çš„è·¯å¾„åˆ†éš”ç¬¦ä½¿ç”¨åæ–œçº¿â€œ\â€ï¼Œè€Œ Java ç¨‹åºä¸­çš„åæ–œçº¿è¡¨ç¤ºè½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦åœ¨ Windows çš„è·¯å¾„ä¸‹åŒ…æ‹¬åæ–œçº¿ï¼Œåˆ™åº”è¯¥ä½¿ç”¨ä¸¤æ¡åæ–œçº¿æˆ–ç›´æ¥ä½¿ç”¨æ–œçº¿â€œ/â€ï¼ˆä¸¤æ¡æ–œçº¿ä¹Ÿè¡Œï¼‰ä¹Ÿå¯ä»¥ã€‚Java ç¨‹åºæ”¯æŒå°†æ–œçº¿å½“æˆå¹³å°æ— å…³çš„è·¯å¾„åˆ†éš”ç¬¦ã€‚</p> <p>å‡è®¾åœ¨ Windows æ“ä½œç³»ç»Ÿä¸­æœ‰ä¸€æ–‡ä»¶ <code>D:\javaspace\hello.java</code>ï¼Œåœ¨ Java ä¸­ä½¿ç”¨çš„æ—¶å€™ï¼Œå…¶è·¯å¾„çš„å†™æ³•åº”è¯¥ä¸º <code>D:/javaspace/hello.java</code> æˆ–è€… <code>D:\\javaspace\\hello.java</code>ã€‚</p> <p>æ³¨æ„ï¼š==åœ¨æ“ä½œæ–‡ä»¶æ—¶ä¸€å®šè¦ä½¿ç”¨ File.separator è¡¨ç¤ºåˆ†éš”ç¬¦ã€‚==åœ¨ç¨‹åºçš„å¼€å‘ä¸­ï¼Œå¾€å¾€ä¼šä½¿ç”¨ Windows å¼€å‘ç¯å¢ƒï¼Œå› ä¸ºåœ¨ Windows æ“ä½œç³»ç»Ÿä¸­æ”¯æŒçš„å¼€å‘å·¥å…·è¾ƒå¤šï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œè€Œåœ¨ç¨‹åºå‘å¸ƒæ—¶å¾€å¾€æ˜¯ç›´æ¥åœ¨ Linux æˆ–å…¶å®ƒæ“ä½œç³»ç»Ÿä¸Šéƒ¨ç½²ï¼Œæ‰€ä»¥è¿™æ—¶å¦‚æœä¸ä½¿ç”¨ File.separatorï¼Œåˆ™ç¨‹åºè¿è¡Œå°±æœ‰å¯èƒ½å­˜åœ¨é—®é¢˜ã€‚å…³äºè¿™ä¸€ç‚¹æˆ‘ä»¬åœ¨ä»¥åçš„å¼€å‘ä¸­ä¸€å®šè¦æœ‰æ‰€è­¦æƒ•ã€‚</p> <h3 id="125éå†ç›®å½•">12.5ã€éå†ç›®å½•<a class="headerlink" href="#125éå†ç›®å½•" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>é€šè¿‡éå†ç›®å½•å¯ä»¥åœ¨æŒ‡å®šçš„ç›®å½•ä¸­æŸ¥æ‰¾æ–‡ä»¶ï¼Œæˆ–è€…æ˜¾ç¤ºæ‰€æœ‰çš„æ–‡ä»¶åˆ—è¡¨ã€‚==File ç±»çš„ list() æ–¹æ³•æä¾›äº†éå†ç›®å½•åŠŸèƒ½ï¼Œ==è¯¥æ–¹æ³•æœ‰å¦‚ä¸‹ä¸¤ç§é‡è½½å½¢å¼ã€‚</p> <ul> <li> <p>String[] list()è¯¥æ–¹æ³•è¡¨ç¤ºè¿”å›ç”± File å¯¹è±¡è¡¨ç¤ºç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•åç§°ç»„æˆçš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œå¦‚æœè°ƒç”¨çš„ File å¯¹è±¡ä¸æ˜¯ç›®å½•ï¼Œåˆ™è¿”å› nullã€‚</p> <p>æç¤ºï¼š==list() æ–¹æ³•è¿”å›çš„æ•°ç»„ä¸­ä»…åŒ…å«æ–‡ä»¶åç§°ï¼Œè€Œä¸åŒ…å«è·¯å¾„ã€‚==ä½†ä¸ä¿è¯æ‰€å¾—æ•°ç»„ä¸­çš„ç›¸åŒå­—ç¬¦ä¸²å°†ä»¥ç‰¹å®šé¡ºåºå‡ºç°ï¼Œç‰¹åˆ«æ˜¯ä¸ä¿è¯å®ƒä»¬æŒ‰å­—æ¯é¡ºåºå‡ºç°ã€‚</p> </li> <li> <p>String[] list(FilenameFilter filter) è¯¥æ–¹æ³•çš„ä½œç”¨ä¸ list() æ–¹æ³•ç›¸åŒï¼Œä¸åŒçš„æ˜¯è¿”å›æ•°ç»„ä¸­ä»…åŒ…å«ç¬¦åˆ filter è¿‡æ»¤å™¨çš„æ–‡ä»¶å’Œç›®å½•ï¼Œå¦‚æœ filter ä¸º nullï¼Œåˆ™æ¥å—æ‰€æœ‰åç§°ã€‚</p> </li> </ul> <p>å‡è®¾è¦éå† D:/Program Filesä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ã€‚ä½¿ç”¨ listFiles() æ–¹æ³•çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test05</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-3"><a id="__codelineno-152-3" name="__codelineno-152-3" href="#__codelineno-152-3"></a><span class="w">        </span><span class="n">File</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">"C:/"</span><span class="p">);</span><span class="w"> </span><span class="c1">// å»ºç«‹Fileå˜é‡,å¹¶è®¾å®šç”±få˜é‡å˜æ•°å¼•ç”¨</span>
</span><span id="__span-152-4"><a id="__codelineno-152-4" name="__codelineno-152-4" href="#__codelineno-152-4"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ–‡ä»¶åç§°\t\tæ–‡ä»¶ç±»å‹\t\tæ–‡ä»¶å¤§å°"</span><span class="p">);</span>
</span><span id="__span-152-5"><a id="__codelineno-152-5" name="__codelineno-152-5" href="#__codelineno-152-5"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"==================================================="</span><span class="p">);</span>
</span><span id="__span-152-6"><a id="__codelineno-152-6" name="__codelineno-152-6" href="#__codelineno-152-6"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">fileList</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="na">list</span><span class="p">();</span><span class="w"> </span><span class="c1">// è°ƒç”¨ä¸å¸¦å‚æ•°çš„list()æ–¹æ³•</span>
</span><span id="__span-152-7"><a id="__codelineno-152-7" name="__codelineno-152-7" href="#__codelineno-152-7"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">fileList</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// éå†è¿”å›çš„å­—ç¬¦æ•°ç»„</span>
</span><span id="__span-152-8"><a id="__codelineno-152-8" name="__codelineno-152-8" href="#__codelineno-152-8"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="n">fileList</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"\t\t"</span><span class="p">);</span>
</span><span id="__span-152-9"><a id="__codelineno-152-9" name="__codelineno-152-9" href="#__codelineno-152-9"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">((</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">"C:/"</span><span class="p">,</span><span class="w"> </span><span class="n">fileList</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)).</span><span class="na">isFile</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">"æ–‡ä»¶"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"\t\t"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">"æ–‡ä»¶å¤¹"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"\t\t"</span><span class="p">);</span>
</span><span id="__span-152-10"><a id="__codelineno-152-10" name="__codelineno-152-10" href="#__codelineno-152-10"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">((</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">"C:/"</span><span class="p">,</span><span class="w"> </span><span class="n">fileList</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)).</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"å­—èŠ‚"</span><span class="p">);</span>
</span><span id="__span-152-11"><a id="__codelineno-152-11" name="__codelineno-152-11" href="#__codelineno-152-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-152-12"><a id="__codelineno-152-12" name="__codelineno-152-12" href="#__codelineno-152-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-152-13"><a id="__codelineno-152-13" name="__codelineno-152-13" href="#__codelineno-152-13"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œç»“æœä¸ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a>æ–‡ä»¶åç§°        æ–‡ä»¶ç±»å‹        æ–‡ä»¶å¤§å°
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a>===================================================
</span><span id="__span-153-3"><a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a>$Recycle.Bin        æ–‡ä»¶å¤¹     0å­—èŠ‚
</span><span id="__span-153-4"><a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a>$WINDOWS.~BT        æ–‡ä»¶å¤¹     0å­—èŠ‚
</span><span id="__span-153-5"><a id="__codelineno-153-5" name="__codelineno-153-5" href="#__codelineno-153-5"></a>$Windows.~WS        æ–‡ä»¶å¤¹     0å­—èŠ‚
</span><span id="__span-153-6"><a id="__codelineno-153-6" name="__codelineno-153-6" href="#__codelineno-153-6"></a>$WINRE_BACKUP_PARTITION.MARKER      æ–‡ä»¶      0å­—èŠ‚
</span><span id="__span-153-7"><a id="__codelineno-153-7" name="__codelineno-153-7" href="#__codelineno-153-7"></a>47938B4DB7DF        æ–‡ä»¶      40å­—èŠ‚
</span><span id="__span-153-8"><a id="__codelineno-153-8" name="__codelineno-153-8" href="#__codelineno-153-8"></a>AMTAG.BIN       æ–‡ä»¶      1024å­—èŠ‚
</span><span id="__span-153-9"><a id="__codelineno-153-9" name="__codelineno-153-9" href="#__codelineno-153-9"></a>Config.Msi      æ–‡ä»¶å¤¹     57344å­—èŠ‚
</span><span id="__span-153-10"><a id="__codelineno-153-10" name="__codelineno-153-10" href="#__codelineno-153-10"></a>Documents and Settings      æ–‡ä»¶å¤¹     4096å­—èŠ‚
</span><span id="__span-153-11"><a id="__codelineno-153-11" name="__codelineno-153-11" href="#__codelineno-153-11"></a>Fraps       æ–‡ä»¶å¤¹     0å­—èŠ‚
</span><span id="__span-153-12"><a id="__codelineno-153-12" name="__codelineno-153-12" href="#__codelineno-153-12"></a>inetpub     æ–‡ä»¶å¤¹     4096å­—èŠ‚
</span><span id="__span-153-13"><a id="__codelineno-153-13" name="__codelineno-153-13" href="#__codelineno-153-13"></a>Intel       æ–‡ä»¶å¤¹     0å­—èŠ‚
</span><span id="__span-153-14"><a id="__codelineno-153-14" name="__codelineno-153-14" href="#__codelineno-153-14"></a>offline_FtnInfo.txt     æ–‡ä»¶      348å­—èŠ‚
</span><span id="__span-153-15"><a id="__codelineno-153-15" name="__codelineno-153-15" href="#__codelineno-153-15"></a>OldNewExplorer      æ–‡ä»¶å¤¹     4096å­—èŠ‚
</span><span id="__span-153-16"><a id="__codelineno-153-16" name="__codelineno-153-16" href="#__codelineno-153-16"></a>Program Files       æ–‡ä»¶å¤¹     12288å­—èŠ‚
</span><span id="__span-153-17"><a id="__codelineno-153-17" name="__codelineno-153-17" href="#__codelineno-153-17"></a>Program Files (x86)     æ–‡ä»¶å¤¹     8192å­—èŠ‚
</span><span id="__span-153-18"><a id="__codelineno-153-18" name="__codelineno-153-18" href="#__codelineno-153-18"></a>ProgramData     æ–‡ä»¶å¤¹     12288å­—èŠ‚
</span><span id="__span-153-19"><a id="__codelineno-153-19" name="__codelineno-153-19" href="#__codelineno-153-19"></a>Recovery        æ–‡ä»¶å¤¹     0å­—èŠ‚
</span><span id="__span-153-20"><a id="__codelineno-153-20" name="__codelineno-153-20" href="#__codelineno-153-20"></a>swapfile.sys        æ–‡ä»¶      268435456å­—èŠ‚
</span><span id="__span-153-21"><a id="__codelineno-153-21" name="__codelineno-153-21" href="#__codelineno-153-21"></a>System Volume Information       æ–‡ä»¶å¤¹     4096å­—èŠ‚
</span><span id="__span-153-22"><a id="__codelineno-153-22" name="__codelineno-153-22" href="#__codelineno-153-22"></a>Temp        æ–‡ä»¶å¤¹     0å­—èŠ‚
</span><span id="__span-153-23"><a id="__codelineno-153-23" name="__codelineno-153-23" href="#__codelineno-153-23"></a>Users       æ–‡ä»¶å¤¹     4096å­—èŠ‚
</span><span id="__span-153-24"><a id="__codelineno-153-24" name="__codelineno-153-24" href="#__codelineno-153-24"></a>Windows     æ–‡ä»¶å¤¹     65536å­—èŠ‚
</span></code></pre></div> <p>å‡è®¾å¸Œæœ›åªåˆ—å‡ºç›®å½•ä¸‹çš„æŸäº›æ–‡ä»¶ï¼Œè¿™å°±éœ€è¦è°ƒç”¨å¸¦è¿‡æ»¤å™¨å‚æ•°çš„ list() æ–¹æ³•ã€‚é¦–å…ˆéœ€è¦åˆ›å»ºæ–‡ä»¶è¿‡æ»¤å™¨ï¼Œè¯¥è¿‡æ»¤å™¨å¿…é¡»å®ç° <code>java.io.FilenameFilter</code> æ¥å£ï¼Œå¹¶åœ¨ accept() æ–¹æ³•ä¸­æŒ‡å®šå…è®¸çš„æ–‡ä»¶ç±»å‹ã€‚</p> <p>å¦‚ä¸‹æ‰€ç¤ºä¸ºå…è®¸ SYSã€TXT å’Œ BAK æ ¼å¼æ–‡ä»¶çš„è¿‡æ»¤å™¨å®ç°ä»£ç ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyFileFilter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">FilenameFilter</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a><span class="w">    </span><span class="c1">// å®ç° FilenameFilter æ¥å£</span>
</span><span id="__span-154-3"><a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-154-4"><a id="__codelineno-154-4" name="__codelineno-154-4" href="#__codelineno-154-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">accept</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-154-5"><a id="__codelineno-154-5" name="__codelineno-154-5" href="#__codelineno-154-5"></a><span class="w">        </span><span class="c1">// æŒ‡å®šå…è®¸çš„æ–‡ä»¶ç±»å‹</span>
</span><span id="__span-154-6"><a id="__codelineno-154-6" name="__codelineno-154-6" href="#__codelineno-154-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="na">endsWith</span><span class="p">(</span><span class="s">".sys"</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="na">endsWith</span><span class="p">(</span><span class="s">".txt"</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="na">endsWith</span><span class="p">(</span><span class="s">".bak"</span><span class="p">);</span>
</span><span id="__span-154-7"><a id="__codelineno-154-7" name="__codelineno-154-7" href="#__codelineno-154-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-154-8"><a id="__codelineno-154-8" name="__codelineno-154-8" href="#__codelineno-154-8"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šè¿°ä»£ç åˆ›å»ºçš„è¿‡æ»¤å™¨åç§°ä¸º MyFileFilterï¼Œæ¥ä¸‹æ¥åªéœ€è¦å°†è¯¥åç§°ä¼ é€’ç»™ list() æ–¹æ³•å³å¯å®ç°ç­›é€‰æ–‡ä»¶ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="n">String</span><span class="w"> </span><span class="n">fileList</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="na">list</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MyFileFilter</span><span class="p">());</span>
</span></code></pre></div> <p>å†æ¬¡è¿è¡Œç¨‹åºï¼Œéå†ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a>æ–‡ä»¶åç§°        æ–‡ä»¶ç±»å‹        æ–‡ä»¶å¤§å°
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a>===================================================
</span><span id="__span-156-3"><a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a>offline_FtnInfo.txt     æ–‡ä»¶      348å­—èŠ‚
</span><span id="__span-156-4"><a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a>swapfile.sys        æ–‡ä»¶      268435456å­—èŠ‚
</span></code></pre></div> <h3 id="126å­—èŠ‚æµçš„ä½¿ç”¨">12.6ã€å­—èŠ‚æµçš„ä½¿ç”¨<a class="headerlink" href="#126å­—èŠ‚æµçš„ä½¿ç”¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>==InputStream æ˜¯ Java æ‰€æœ‰å­—èŠ‚è¾“å…¥æµç±»çš„çˆ¶ç±»ï¼ŒOutputStream æ˜¯ Java æ‰€æœ‰å­—èŠ‚è¾“å‡ºæµç±»çš„çˆ¶ç±»ï¼Œ==å®ƒä»¬éƒ½æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå› æ­¤ç»§æ‰¿å®ƒä»¬çš„å­ç±»è¦é‡æ–°å®šä¹‰çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ã€‚</p> <h4 id="1261å­—èŠ‚è¾“å…¥æµ">12.6.1ã€å­—èŠ‚è¾“å…¥æµ<a class="headerlink" href="#1261å­—èŠ‚è¾“å…¥æµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>InputStream ç±»åŠå…¶å­ç±»çš„å¯¹è±¡è¡¨ç¤ºå­—èŠ‚è¾“å…¥æµï¼ŒInputStream ç±»çš„å¸¸ç”¨å­ç±»å¦‚ä¸‹ã€‚</p> <ul> <li>ByteArrayInputStream ç±»ï¼šå°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºå­—èŠ‚è¾“å…¥æµï¼Œä»ä¸­è¯»å–å­—èŠ‚ã€‚</li> <li>FileInputStream ç±»ï¼šä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚</li> <li>PipedInputStream ç±»ï¼šè¿æ¥åˆ°ä¸€ä¸ª PipedOutputStreamï¼ˆç®¡é“è¾“å‡ºæµï¼‰ã€‚</li> <li>SequenceInputStream ç±»ï¼šå°†å¤šä¸ªå­—èŠ‚è¾“å…¥æµä¸²è”æˆä¸€ä¸ªå­—èŠ‚è¾“å…¥æµã€‚</li> <li>ObjectInputStream ç±»ï¼šå°†å¯¹è±¡ååºåˆ—åŒ–ã€‚</li> </ul> <p>==ä½¿ç”¨ InputStream ç±»çš„æ–¹æ³•å¯ä»¥ä»æµä¸­è¯»å–ä¸€ä¸ªæˆ–ä¸€æ‰¹å­—èŠ‚ã€‚==ä¸‹è¡¨åˆ—å‡ºäº† InputStream ç±»çš„å¸¸ç”¨æ–¹æ³•ã€‚</p> <table> <thead> <tr> <th>æ–¹æ³•ååŠè¿”å›å€¼ç±»å‹</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>int read()</td> <td>ä»è¾“å…¥æµä¸­è¯»å–ä¸€ä¸ª 8 ä½çš„å­—èŠ‚ï¼Œå¹¶æŠŠå®ƒè½¬æ¢ä¸º 0~255 çš„æ•´æ•°ï¼Œæœ€åè¿”å›æ•´æ•°ã€‚ å¦‚æœè¿”å› -1ï¼Œåˆ™è¡¨ç¤ºå·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾ã€‚ä¸ºäº†æé«˜ I/O æ“ä½œçš„æ•ˆç‡ï¼Œå»ºè®®å°½é‡ ä½¿ç”¨ read() æ–¹æ³•çš„å¦å¤–ä¸¤ç§å½¢å¼</td> </tr> <tr> <td>int read(byte[] b)</td> <td>ä»è¾“å…¥æµä¸­è¯»å–è‹¥å¹²å­—èŠ‚ï¼Œå¹¶æŠŠå®ƒä»¬ä¿å­˜åˆ°å‚æ•° b æŒ‡å®šçš„å­—èŠ‚æ•°ç»„ä¸­ã€‚ è¯¥æ–¹æ³•è¿”å› è¯»å–çš„å­—èŠ‚æ•°ã€‚å¦‚æœè¿”å› -1ï¼Œåˆ™è¡¨ç¤ºå·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾</td> </tr> <tr> <td>int read(byte[] b, int off, int len)</td> <td>ä»è¾“å…¥æµä¸­è¯»å–è‹¥å¹²å­—èŠ‚ï¼Œå¹¶æŠŠå®ƒä»¬ä¿å­˜åˆ°å‚æ•° b æŒ‡å®šçš„å­—èŠ‚æ•°ç»„ä¸­ã€‚å…¶ä¸­ï¼Œoff æŒ‡ å®šåœ¨å­—èŠ‚æ•°ç»„ä¸­å¼€å§‹ä¿å­˜æ•°æ®çš„èµ·å§‹ä¸‹æ ‡ï¼›len æŒ‡å®šè¯»å–çš„å­—èŠ‚æ•°ã€‚è¯¥æ–¹æ³•è¿”å›å®é™… è¯»å–çš„å­—èŠ‚æ•°ã€‚å¦‚æœè¿”å› -1ï¼Œåˆ™è¡¨ç¤ºå·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾</td> </tr> <tr> <td>void close()</td> <td>å…³é—­è¾“å…¥æµã€‚åœ¨è¯»æ“ä½œå®Œæˆåï¼Œåº”è¯¥å…³é—­è¾“å…¥æµï¼Œç³»ç»Ÿå°†ä¼šé‡Šæ”¾ä¸è¿™ä¸ªè¾“å…¥æµç›¸å…³ çš„èµ„æºã€‚æ³¨æ„ï¼ŒInputStream ç±»æœ¬èº«çš„ close() æ–¹æ³•ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä½†æ˜¯å®ƒçš„è®¸å¤š å­ç±»é‡å†™äº† close() æ–¹æ³•</td> </tr> <tr> <td>int available()</td> <td>è¿”å›å¯ä»¥ä»è¾“å…¥æµä¸­è¯»å–çš„å­—èŠ‚æ•°</td> </tr> <tr> <td>long skip(long n)</td> <td>ä»è¾“å…¥æµä¸­è·³è¿‡å‚æ•° n æŒ‡å®šæ•°ç›®çš„å­—èŠ‚ã€‚è¯¥æ–¹æ³•è¿”å›è·³è¿‡çš„å­—èŠ‚æ•°</td> </tr> <tr> <td>void mark(int readLimit)</td> <td>åœ¨è¾“å…¥æµçš„å½“å‰ä½ç½®å¼€å§‹è®¾ç½®æ ‡è®°ï¼Œå‚æ•° readLimit åˆ™æŒ‡å®šäº†æœ€å¤šè¢«è®¾ç½®æ ‡è®°çš„å­— èŠ‚æ•°</td> </tr> <tr> <td>boolean markSupported()</td> <td>åˆ¤æ–­å½“å‰è¾“å…¥æµæ˜¯å¦å…è®¸è®¾ç½®æ ‡è®°ï¼Œæ˜¯åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false</td> </tr> <tr> <td>void reset()</td> <td>å°†è¾“å…¥æµçš„æŒ‡é’ˆè¿”å›åˆ°è®¾ç½®æ ‡è®°çš„èµ·å§‹å¤„</td> </tr> </tbody> </table> <p><mark>æ³¨æ„ï¼šåœ¨ä½¿ç”¨ mark() æ–¹æ³•å’Œ reset() æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦åˆ¤æ–­è¯¥æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦æ”¯æŒè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä»¥é¿å…å¯¹ç¨‹åºé€ æˆå½±å“ã€‚</mark></p> <h4 id="1262å­—èŠ‚è¾“å‡ºæµ">12.6.2ã€å­—èŠ‚è¾“å‡ºæµ<a class="headerlink" href="#1262å­—èŠ‚è¾“å‡ºæµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>==OutputStream ç±»åŠå…¶å­ç±»çš„å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµã€‚==OutputStream ç±»çš„å¸¸ç”¨å­ç±»å¦‚ä¸‹ã€‚</p> <ul> <li>ByteArrayOutputStream ç±»ï¼šå‘å†…å­˜ç¼“å†²åŒºçš„å­—èŠ‚æ•°ç»„ä¸­å†™æ•°æ®ã€‚</li> <li>FileOutputStream ç±»ï¼šå‘æ–‡ä»¶ä¸­å†™æ•°æ®ã€‚</li> <li>PipedOutputStream ç±»ï¼šè¿æ¥åˆ°ä¸€ä¸ª PipedlntputStreamï¼ˆç®¡é“è¾“å…¥æµï¼‰ã€‚</li> <li>ObjectOutputStream ç±»ï¼šå°†å¯¹è±¡åºåˆ—åŒ–ã€‚</li> </ul> <p>åˆ©ç”¨ OutputStream ç±»çš„æ–¹æ³•å¯ä»¥ä»æµä¸­å†™å…¥ä¸€ä¸ªæˆ–ä¸€æ‰¹å­—èŠ‚ã€‚ä¸‹è¡¨åˆ—å‡ºäº† OutputStream ç±»çš„å¸¸ç”¨æ–¹æ³•ã€‚</p> <table> <thead> <tr> <th>æ–¹æ³•ååŠè¿”å›å€¼ç±»å‹</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>void write(int b)</td> <td>å‘è¾“å‡ºæµå†™å…¥ä¸€ä¸ªå­—èŠ‚ã€‚è¿™é‡Œçš„å‚æ•°æ˜¯ int ç±»å‹ï¼Œä½†æ˜¯å®ƒå…è®¸ä½¿ç”¨è¡¨è¾¾å¼ï¼Œ è€Œä¸ç”¨å¼ºåˆ¶è½¬æ¢æˆ byte ç±»å‹ã€‚ä¸ºäº†æé«˜ I/O æ“ä½œçš„æ•ˆç‡ï¼Œå»ºè®®å°½é‡ä½¿ç”¨ write() æ–¹æ³•çš„å¦å¤–ä¸¤ç§å½¢å¼</td> </tr> <tr> <td>void write(byte[] b)</td> <td>æŠŠå‚æ•° b æŒ‡å®šçš„å­—èŠ‚æ•°ç»„ä¸­çš„æ‰€æœ‰å­—èŠ‚å†™åˆ°è¾“å‡ºæµä¸­</td> </tr> <tr> <td>void write(byte[] b,int off,int len)</td> <td>æŠŠå‚æ•° b æŒ‡å®šçš„å­—èŠ‚æ•°ç»„ä¸­çš„è‹¥å¹²å­—èŠ‚å†™åˆ°è¾“å‡ºæµä¸­ã€‚å…¶ä¸­ï¼Œoff æŒ‡å®šå­—èŠ‚ æ•°ç»„ä¸­çš„èµ·å§‹ä¸‹æ ‡ï¼Œlen è¡¨ç¤ºå…ƒç´ ä¸ªæ•°</td> </tr> <tr> <td>void close()</td> <td>å…³é—­è¾“å‡ºæµã€‚å†™æ“ä½œå®Œæˆåï¼Œåº”è¯¥å…³é—­è¾“å‡ºæµã€‚ç³»ç»Ÿå°†ä¼šé‡Šæ”¾ä¸è¿™ä¸ªè¾“å‡º æµç›¸å…³çš„èµ„æºã€‚æ³¨æ„ï¼ŒOutputStream ç±»æœ¬èº«çš„ close() æ–¹æ³•ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä½†æ˜¯å®ƒçš„è®¸å¤šå­ç±»é‡å†™äº† close() æ–¹æ³•</td> </tr> <tr> <td>void flush()</td> <td>ä¸ºäº†æé«˜æ•ˆç‡ï¼Œåœ¨å‘è¾“å‡ºæµä¸­å†™å…¥æ•°æ®æ—¶ï¼Œæ•°æ®ä¸€èˆ¬ä¼šå…ˆä¿å­˜åˆ°å†…å­˜ç¼“å†² åŒºä¸­ï¼Œåªæœ‰å½“ç¼“å†²åŒºä¸­çš„æ•°æ®è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œç¼“å†²åŒºä¸­çš„æ•°æ®æ‰ä¼šè¢«å†™ å…¥è¾“å‡ºæµä¸­ã€‚ä½¿ç”¨ flush() æ–¹æ³•åˆ™å¯ä»¥å¼ºåˆ¶å°†ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥è¾“å‡ºæµï¼Œ å¹¶æ¸…ç©ºç¼“å†²åŒº</td> </tr> </tbody> </table> <h4 id="1263æ–‡ä»¶è¾“å…¥æµ">12.6.3ã€æ–‡ä»¶è¾“å…¥æµ<a class="headerlink" href="#1263æ–‡ä»¶è¾“å…¥æµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>FileInputStream æ˜¯ Java æµä¸­æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§ï¼Œå®ƒè¡¨ç¤ºä»æ–‡ä»¶ç³»ç»Ÿçš„æŸä¸ªæ–‡ä»¶ä¸­è·å–è¾“å…¥å­—èŠ‚ã€‚é€šè¿‡ä½¿ç”¨ FileInputStream å¯ä»¥è®¿é—®æ–‡ä»¶ä¸­çš„ä¸€ä¸ªå­—èŠ‚ã€ä¸€æ‰¹å­—èŠ‚æˆ–æ•´ä¸ªæ–‡ä»¶ã€‚</p> <p><mark>åœ¨åˆ›å»º FileInputStream ç±»çš„å¯¹è±¡æ—¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶å°†æ‹‹å‡º FileNotFoundException å¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸å¿…é¡»æ•è·æˆ–å£°æ˜æ‹‹å‡ºã€‚</mark></p> <p>FileInputStream å¸¸ç”¨çš„æ„é€ æ–¹æ³•ä¸»è¦æœ‰å¦‚ä¸‹ä¸¤ç§é‡è½½å½¢å¼ã€‚</p> <ol> <li>FileInputStream(File file)ï¼šé€šè¿‡æ‰“å¼€ä¸€ä¸ªåˆ°å®é™…æ–‡ä»¶çš„è¿æ¥æ¥åˆ›å»ºä¸€ä¸ª FileInputStreamï¼Œè¯¥æ–‡ä»¶é€šè¿‡æ–‡ä»¶ç³»ç»Ÿä¸­çš„ File å¯¹è±¡ file æŒ‡å®šã€‚</li> <li>FileInputStream(String name)ï¼šé€šè¿‡æ‰“å¼€ä¸€ä¸ªåˆ°å®é™…æ–‡ä»¶çš„é“¾æ¥æ¥åˆ›å»ºä¸€ä¸ª FileInputStreamï¼Œè¯¥æ–‡ä»¶é€šè¿‡æ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„å name æŒ‡å®šã€‚</li> </ol> <p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº† FileInputStream() ä¸¤ä¸ªæ„é€ æ–¹æ³•çš„ä½¿ç”¨ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a><span class="w">    </span><span class="c1">// ä»¥Fileå¯¹è±¡ä½œä¸ºå‚æ•°åˆ›å»ºFileInputStreamå¯¹è±¡</span>
</span><span id="__span-157-3"><a id="__codelineno-157-3" name="__codelineno-157-3" href="#__codelineno-157-3"></a><span class="w">    </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fis1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">"F:/mxl.txt"</span><span class="p">));</span>
</span><span id="__span-157-4"><a id="__codelineno-157-4" name="__codelineno-157-4" href="#__codelineno-157-4"></a><span class="w">    </span><span class="c1">// ä»¥å­—ç¬¦ä¸²å€¼ä½œä¸ºå‚æ•°åˆ›å»ºFilelnputStreamå¯¹è±¡</span>
</span><span id="__span-157-5"><a id="__codelineno-157-5" name="__codelineno-157-5" href="#__codelineno-157-5"></a><span class="w">    </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fis2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">"F:/mxl.txt"</span><span class="p">);</span>
</span><span id="__span-157-6"><a id="__codelineno-157-6" name="__codelineno-157-6" href="#__codelineno-157-6"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-7"><a id="__codelineno-157-7" name="__codelineno-157-7" href="#__codelineno-157-7"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æŒ‡å®šçš„æ–‡ä»¶æ‰¾ä¸åˆ°!"</span><span class="p">);</span>
</span><span id="__span-157-8"><a id="__codelineno-157-8" name="__codelineno-157-8" href="#__codelineno-157-8"></a><span class="p">}</span>
</span></code></pre></div> <p>å‡è®¾æœ‰ä¸€ä¸ª <code>D:\myJava\HelloJava.java</code> æ–‡ä»¶ï¼Œä¸‹é¢ä½¿ç”¨ FileInputStream ç±»è¯»å–å¹¶è¾“å‡ºè¯¥æ–‡ä»¶çš„å†…å®¹ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test10</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-3"><a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="w">        </span><span class="n">File</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">"D:/myJava/HelloJava.java"</span><span class="p">);</span>
</span><span id="__span-158-4"><a id="__codelineno-158-4" name="__codelineno-158-4" href="#__codelineno-158-4"></a><span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-158-5"><a id="__codelineno-158-5" name="__codelineno-158-5" href="#__codelineno-158-5"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-6"><a id="__codelineno-158-6" name="__codelineno-158-6" href="#__codelineno-158-6"></a><span class="w">            </span><span class="c1">// å› ä¸ºFileæ²¡æœ‰è¯»å†™çš„èƒ½åŠ›,æ‰€ä»¥éœ€è¦æœ‰ä¸ªInputStream</span>
</span><span id="__span-158-7"><a id="__codelineno-158-7" name="__codelineno-158-7" href="#__codelineno-158-7"></a><span class="w">            </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span id="__span-158-8"><a id="__codelineno-158-8" name="__codelineno-158-8" href="#__codelineno-158-8"></a><span class="w">            </span><span class="c1">// å®šä¹‰ä¸€ä¸ªå­—èŠ‚æ•°ç»„</span>
</span><span id="__span-158-9"><a id="__codelineno-158-9" name="__codelineno-158-9" href="#__codelineno-158-9"></a><span class="w">            </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-158-10"><a id="__codelineno-158-10" name="__codelineno-158-10" href="#__codelineno-158-10"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// å¾—åˆ°å®é™…è¯»å–åˆ°çš„å­—èŠ‚æ•°</span>
</span><span id="__span-158-11"><a id="__codelineno-158-11" name="__codelineno-158-11" href="#__codelineno-158-11"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"D:\\myJava\\HelloJava.javaæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š"</span><span class="p">);</span>
</span><span id="__span-158-12"><a id="__codelineno-158-12" name="__codelineno-158-12" href="#__codelineno-158-12"></a><span class="w">            </span><span class="c1">// å¾ªç¯è¯»å–</span>
</span><span id="__span-158-13"><a id="__codelineno-158-13" name="__codelineno-158-13" href="#__codelineno-158-13"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fis</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">bytes</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-14"><a id="__codelineno-158-14" name="__codelineno-158-14" href="#__codelineno-158-14"></a><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">bytes</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w"> </span><span class="c1">// å°†æ•°ç»„ä¸­ä»ä¸‹æ ‡0åˆ°nçš„å†…å®¹ç»™s</span>
</span><span id="__span-158-15"><a id="__codelineno-158-15" name="__codelineno-158-15" href="#__codelineno-158-15"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-158-16"><a id="__codelineno-158-16" name="__codelineno-158-16" href="#__codelineno-158-16"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-158-17"><a id="__codelineno-158-17" name="__codelineno-158-17" href="#__codelineno-158-17"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-18"><a id="__codelineno-158-18" name="__codelineno-158-18" href="#__codelineno-158-18"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-158-19"><a id="__codelineno-158-19" name="__codelineno-158-19" href="#__codelineno-158-19"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-20"><a id="__codelineno-158-20" name="__codelineno-158-20" href="#__codelineno-158-20"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-21"><a id="__codelineno-158-21" name="__codelineno-158-21" href="#__codelineno-158-21"></a><span class="w">                </span><span class="n">fis</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</span><span id="__span-158-22"><a id="__codelineno-158-22" name="__codelineno-158-22" href="#__codelineno-158-22"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-23"><a id="__codelineno-158-23" name="__codelineno-158-23" href="#__codelineno-158-23"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-158-24"><a id="__codelineno-158-24" name="__codelineno-158-24" href="#__codelineno-158-24"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-158-25"><a id="__codelineno-158-25" name="__codelineno-158-25" href="#__codelineno-158-25"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-158-26"><a id="__codelineno-158-26" name="__codelineno-158-26" href="#__codelineno-158-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-158-27"><a id="__codelineno-158-27" name="__codelineno-158-27" href="#__codelineno-158-27"></a><span class="p">}</span>
</span></code></pre></div> <p>å¦‚ä¸Šè¿°ä»£ç ï¼Œåœ¨ FileInputDemo ç±»çš„ main() æ–¹æ³•ä¸­é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª File å¯¹è±¡ fï¼Œè¯¥å¯¹è±¡æŒ‡å‘ D:\myJava\HelloJava.java æ–‡ä»¶ã€‚æ¥ç€ä½¿ç”¨ FileInputStream ç±»çš„æ„é€ æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª FileInputStream å¯¹è±¡ fisï¼Œå¹¶å£°æ˜ä¸€ä¸ªé•¿åº¦ä¸º 1024 çš„ byte ç±»å‹çš„æ•°ç»„ï¼Œç„¶åä½¿ç”¨ FileInputStream ç±»ä¸­çš„ read() æ–¹æ³•å°† HelloJava.java æ–‡ä»¶ä¸­çš„æ•°æ®è¯»å–åˆ°å­—èŠ‚æ•°ç»„ bytes ä¸­ï¼Œå¹¶è¾“å‡ºè¯¥æ•°æ®ã€‚æœ€ååœ¨ finally è¯­å¥ä¸­å…³é—­ FileInputStream è¾“å…¥æµã€‚</p> <p>ä¸‹é¢æ‰€ç¤ºä¸º HelloJava.java æ–‡ä»¶çš„åŸå§‹å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„æ˜¯è¿è¡Œç¨‹åºåçš„è¾“å‡ºå†…å®¹ã€‚</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a>D:\myJava\HelloJava.javaæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š
</span><span id="__span-159-2"><a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a>/*
</span><span id="__span-159-3"><a id="__codelineno-159-3" name="__codelineno-159-3" href="#__codelineno-159-3"></a>*ç¬¬ä¸€ä¸ªjavaç¨‹åº
</span><span id="__span-159-4"><a id="__codelineno-159-4" name="__codelineno-159-4" href="#__codelineno-159-4"></a>*/
</span><span id="__span-159-5"><a id="__codelineno-159-5" name="__codelineno-159-5" href="#__codelineno-159-5"></a>public class HelloJava {
</span><span id="__span-159-6"><a id="__codelineno-159-6" name="__codelineno-159-6" href="#__codelineno-159-6"></a>    // è¿™é‡Œæ˜¯ç¨‹åºå…¥å£
</span><span id="__span-159-7"><a id="__codelineno-159-7" name="__codelineno-159-7" href="#__codelineno-159-7"></a>    public static void main(String[] args) {
</span><span id="__span-159-8"><a id="__codelineno-159-8" name="__codelineno-159-8" href="#__codelineno-159-8"></a>        // è¾“å‡ºå­—ç¬¦ä¸²
</span><span id="__span-159-9"><a id="__codelineno-159-9" name="__codelineno-159-9" href="#__codelineno-159-9"></a>        System.out.println("ä½ å¥½ Java");
</span><span id="__span-159-10"><a id="__codelineno-159-10" name="__codelineno-159-10" href="#__codelineno-159-10"></a>    }
</span><span id="__span-159-11"><a id="__codelineno-159-11" name="__codelineno-159-11" href="#__codelineno-159-11"></a>}
</span></code></pre></div> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/5-19121Q25Z21J.png" data-desc-position="bottom"><img src="!assets/Java/5-19121Q25Z21J.png" alt="HelloJava.javaæ–‡ä»¶å†…å®¹" style="zoom:80%;"></a></p> <p><mark>æ³¨æ„ï¼šFileInputStream ç±»é‡å†™äº†çˆ¶ç±» InputStream ä¸­çš„ read() æ–¹æ³•ã€skip() æ–¹æ³•ã€available() æ–¹æ³•å’Œ close() æ–¹æ³•ï¼Œä¸æ”¯æŒ mark() æ–¹æ³•å’Œ reset() æ–¹æ³•ã€‚</mark></p> <h4 id="1264æ–‡ä»¶è¾“å‡ºæµ">12.6.4ã€æ–‡ä»¶è¾“å‡ºæµ<a class="headerlink" href="#1264æ–‡ä»¶è¾“å‡ºæµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p><mark>FileOutputStream ç±»ç»§æ‰¿è‡ª OutputStream ç±»ï¼Œé‡å†™å’Œå®ç°äº†çˆ¶ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚==FileOutputStream ç±»çš„å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶å­—èŠ‚è¾“å‡ºæµï¼Œå¯ä»¥å‘æµä¸­å†™å…¥ä¸€ä¸ªå­—èŠ‚æˆ–ä¸€æ‰¹å­—èŠ‚ã€‚==åœ¨åˆ›å»º FileOutputStream ç±»çš„å¯¹è±¡æ—¶ï¼Œå¦‚æœæŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼›å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™æ¸…é™¤åŸæ–‡ä»¶çš„å†…å®¹é‡æ–°å†™å…¥ã€‚</mark></p> <p>FileOutputStream ç±»çš„æ„é€ æ–¹æ³•ä¸»è¦æœ‰å¦‚ä¸‹ 4 ç§é‡è½½å½¢å¼ã€‚</p> <ol> <li>FileOutputStream(File file)ï¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµï¼Œå‚æ•° file æŒ‡å®šç›®æ ‡æ–‡ä»¶ã€‚</li> <li>FileOutputStream(File file,boolean append)ï¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµï¼Œå‚æ•° file æŒ‡å®šç›®æ ‡æ–‡ä»¶ï¼Œappend æŒ‡å®šæ˜¯å¦å°†æ•°æ®æ·»åŠ åˆ°ç›®æ ‡æ–‡ä»¶çš„å†…å®¹æœ«å°¾ï¼Œå¦‚æœä¸º trueï¼Œåˆ™åœ¨æœ«å°¾æ·»åŠ ï¼›å¦‚æœä¸º falseï¼Œåˆ™è¦†ç›–åŸæœ‰å†…å®¹ï¼›å…¶é»˜è®¤å€¼ä¸º falseã€‚</li> <li>FileOutputStream(String name)ï¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµï¼Œå‚æ•° name æŒ‡å®šç›®æ ‡æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„ä¿¡æ¯ã€‚</li> <li>FileOutputStream(String name,boolean append)ï¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµï¼Œå‚æ•° name å’Œ append çš„å«ä¹‰åŒä¸Šã€‚</li> </ol> <p>æ³¨æ„ï¼šä½¿ç”¨æ„é€ æ–¹æ³• FileOutputStream(String name,boolean append) åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµå¯¹è±¡ï¼Œå®ƒå°†æ•°æ®é™„åŠ åœ¨ç°æœ‰æ–‡ä»¶çš„æœ«å°¾ã€‚è¯¥å­—ç¬¦ä¸² name æŒ‡æ˜äº†åŸæ–‡ä»¶ï¼Œå¦‚æœåªæ˜¯ä¸ºäº†é™„åŠ æ•°æ®è€Œä¸æ˜¯é‡å†™ä»»ä½•å·²æœ‰çš„æ•°æ®ï¼Œå¸ƒå°”ç±»å‹å‚æ•° append çš„å€¼åº”ä¸º trueã€‚</p> <p>å¯¹æ–‡ä»¶è¾“å‡ºæµæœ‰å¦‚ä¸‹å››ç‚¹è¯´æ˜ï¼š</p> <ol> <li>åœ¨ FileOutputStream ç±»çš„æ„é€ æ–¹æ³•ä¸­æŒ‡å®šç›®æ ‡æ–‡ä»¶æ—¶ï¼Œç›®æ ‡æ–‡ä»¶å¯ä»¥ä¸å­˜åœ¨ã€‚</li> <li>ç›®æ ‡æ–‡ä»¶çš„åç§°å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œä¾‹å¦‚ D:\abcã€D:\abc.de å’Œ D:\abc.de.fg ç­‰éƒ½å¯ä»¥ï¼Œå¯ä»¥ä½¿ç”¨è®°äº‹æœ¬ç­‰å·¥å…·æ‰“å¼€å¹¶æµè§ˆè¿™äº›æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚</li> <li>ç›®æ ‡æ–‡ä»¶æ‰€åœ¨ç›®å½•å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™ä¼šæ‹‹å‡º java.io.FileNotFoundException å¼‚å¸¸ã€‚</li> <li>ç›®æ ‡æ–‡ä»¶çš„åç§°ä¸èƒ½æ˜¯å·²å­˜åœ¨çš„ç›®å½•ã€‚ä¾‹å¦‚ D ç›˜ä¸‹å·²å­˜åœ¨ Java æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä½¿ç”¨ Java ä½œä¸ºæ–‡ä»¶åï¼Œå³ä¸èƒ½ä½¿ç”¨ D:\Javaï¼Œå¦åˆ™æŠ›å‡º java.io.FileNotFoundException å¼‚å¸¸ã€‚</li> </ol> <p>åŒæ ·æ˜¯è¯»å– D:\myJava\HelloJava.java æ–‡ä»¶çš„å†…å®¹ï¼Œåœ¨è¿™é‡Œä½¿ç”¨ FileInputStream ç±»å®ç°ï¼Œç„¶åå†å°†å†…å®¹å†™å…¥æ–°çš„æ–‡ä»¶ D:\myJava\HelloJava.txt ä¸­ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test11</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a><span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// å£°æ˜FileInputStreamå¯¹è±¡fis</span>
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a><span class="w">        </span><span class="n">FileOutputStream</span><span class="w"> </span><span class="n">fos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// å£°æ˜FileOutputStreamå¯¹è±¡fos</span>
</span><span id="__span-160-5"><a id="__codelineno-160-5" name="__codelineno-160-5" href="#__codelineno-160-5"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-160-6"><a id="__codelineno-160-6" name="__codelineno-160-6" href="#__codelineno-160-6"></a><span class="w">            </span><span class="n">File</span><span class="w"> </span><span class="n">srcFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">"D:/myJava/HelloJava.java"</span><span class="p">);</span>
</span><span id="__span-160-7"><a id="__codelineno-160-7" name="__codelineno-160-7" href="#__codelineno-160-7"></a><span class="w">            </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="n">srcFile</span><span class="p">);</span><span class="w"> </span><span class="c1">// å®ä¾‹åŒ–FileInputStreamå¯¹è±¡</span>
</span><span id="__span-160-8"><a id="__codelineno-160-8" name="__codelineno-160-8" href="#__codelineno-160-8"></a><span class="w">            </span><span class="n">File</span><span class="w"> </span><span class="n">targetFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">"D:/myJava/HelloJava.txt"</span><span class="p">);</span><span class="w"> </span><span class="c1">// åˆ›å»ºç›®æ ‡æ–‡ä»¶å¯¹è±¡ï¼Œè¯¥æ–‡ä»¶ä¸å­˜åœ¨</span>
</span><span id="__span-160-9"><a id="__codelineno-160-9" name="__codelineno-160-9" href="#__codelineno-160-9"></a><span class="w">            </span><span class="n">fos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="n">targetFile</span><span class="p">);</span><span class="w"> </span><span class="c1">// å®ä¾‹åŒ–FileOutputStreamå¯¹è±¡</span>
</span><span id="__span-160-10"><a id="__codelineno-160-10" name="__codelineno-160-10" href="#__codelineno-160-10"></a><span class="w">            </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="c1">// æ¯æ¬¡è¯»å–1024å­—èŠ‚</span>
</span><span id="__span-160-11"><a id="__codelineno-160-11" name="__codelineno-160-11" href="#__codelineno-160-11"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fis</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span>
</span><span id="__span-160-12"><a id="__codelineno-160-12" name="__codelineno-160-12" href="#__codelineno-160-12"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-160-13"><a id="__codelineno-160-13" name="__codelineno-160-13" href="#__codelineno-160-13"></a><span class="w">                </span><span class="n">fos</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">bytes</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="c1">// å‘D:\HelloJava.txtæ–‡ä»¶ä¸­å†™å…¥å†…å®¹</span>
</span><span id="__span-160-14"><a id="__codelineno-160-14" name="__codelineno-160-14" href="#__codelineno-160-14"></a><span class="w">                </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fis</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span>
</span><span id="__span-160-15"><a id="__codelineno-160-15" name="__codelineno-160-15" href="#__codelineno-160-15"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-160-16"><a id="__codelineno-160-16" name="__codelineno-160-16" href="#__codelineno-160-16"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å†™å…¥ç»“æŸï¼"</span><span class="p">);</span>
</span><span id="__span-160-17"><a id="__codelineno-160-17" name="__codelineno-160-17" href="#__codelineno-160-17"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-160-18"><a id="__codelineno-160-18" name="__codelineno-160-18" href="#__codelineno-160-18"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-160-19"><a id="__codelineno-160-19" name="__codelineno-160-19" href="#__codelineno-160-19"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-160-20"><a id="__codelineno-160-20" name="__codelineno-160-20" href="#__codelineno-160-20"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-160-21"><a id="__codelineno-160-21" name="__codelineno-160-21" href="#__codelineno-160-21"></a><span class="w">                </span><span class="n">fis</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"> </span><span class="c1">// å…³é—­FileInputStreamå¯¹è±¡</span>
</span><span id="__span-160-22"><a id="__codelineno-160-22" name="__codelineno-160-22" href="#__codelineno-160-22"></a><span class="w">                </span><span class="n">fos</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"> </span><span class="c1">// å…³é—­FileOutputStreamå¯¹è±¡</span>
</span><span id="__span-160-23"><a id="__codelineno-160-23" name="__codelineno-160-23" href="#__codelineno-160-23"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-160-24"><a id="__codelineno-160-24" name="__codelineno-160-24" href="#__codelineno-160-24"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-160-25"><a id="__codelineno-160-25" name="__codelineno-160-25" href="#__codelineno-160-25"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-160-26"><a id="__codelineno-160-26" name="__codelineno-160-26" href="#__codelineno-160-26"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-160-27"><a id="__codelineno-160-27" name="__codelineno-160-27" href="#__codelineno-160-27"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-160-28"><a id="__codelineno-160-28" name="__codelineno-160-28" href="#__codelineno-160-28"></a><span class="p">}</span>
</span></code></pre></div> <p>å¦‚ä¸Šè¿°ä»£ç ï¼Œå°† D:\myJava\HelloJava.java æ–‡ä»¶ä¸­çš„å†…å®¹é€šè¿‡æ–‡ä»¶è¾“å…¥/è¾“å‡ºæµå†™å…¥åˆ°äº† D:\myJava\HelloJava.txt æ–‡ä»¶ä¸­ã€‚ç”±äº HelloJava.txt æ–‡ä»¶å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œç¨‹åºæ—¶å°†æ–°å»ºæ­¤æ–‡ä»¶ï¼Œå¹¶å†™å…¥ç›¸åº”å†…å®¹ã€‚</p> <p>è¿è¡Œç¨‹åºï¼ŒæˆåŠŸåä¼šåœ¨æ§åˆ¶å°è¾“å‡ºâ€œå†™å…¥ç»“æŸï¼â€ã€‚æ­¤æ—¶ï¼Œæ‰“å¼€ D:\myJava\HelloJava.txt æ–‡ä»¶ä¼šå‘ç°ï¼Œå…¶å†…å®¹ä¸ HelloJava.java æ–‡ä»¶çš„å†…å®¹ç›¸åŒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/5-1912191A322507.png" data-desc-position="bottom"><img src="!assets/Java/5-1912191A322507.png" alt="img" style="zoom:80%;"></a></p> <p><mark>æŠ€å·§ï¼šåœ¨åˆ›å»º FileOutputStream å¯¹è±¡æ—¶ï¼Œå¦‚æœå°† append å‚æ•°è®¾ç½®ä¸º trueï¼Œåˆ™å¯ä»¥åœ¨ç›®æ ‡æ–‡ä»¶çš„å†…å®¹æœ«å°¾æ·»åŠ æ•°æ®ï¼Œæ­¤æ—¶ç›®æ ‡æ–‡ä»¶ä»ç„¶å¯ä»¥æš‚ä¸å­˜åœ¨ã€‚</mark></p> <h3 id="127å­—ç¬¦æµçš„ä½¿ç”¨">12.7ã€å­—ç¬¦æµçš„ä½¿ç”¨<a class="headerlink" href="#127å­—ç¬¦æµçš„ä½¿ç”¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å°½ç®¡ Java ä¸­å­—èŠ‚æµçš„åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œå‡ ä¹å¯ä»¥ç›´æ¥æˆ–é—´æ¥åœ°å¤„ç†ä»»ä½•ç±»å‹çš„è¾“å…¥/è¾“å‡ºæ“ä½œï¼Œä½†åˆ©ç”¨å®ƒå´ä¸èƒ½ç›´æ¥æ“ä½œ 16 ä½çš„ Unicode å­—ç¬¦ã€‚è¿™å°±è¦ç”¨åˆ°å­—ç¬¦æµã€‚</p> <h4 id="1271å­—ç¬¦è¾“å…¥æµ">12.7.1ã€å­—ç¬¦è¾“å…¥æµ<a class="headerlink" href="#1271å­—ç¬¦è¾“å…¥æµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Reader ç±»æ˜¯æ‰€æœ‰å­—ç¬¦æµè¾“å…¥ç±»çš„çˆ¶ç±»ï¼Œè¯¥ç±»å®šä¹‰äº†è®¸å¤šæ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯¹æ‰€æœ‰å­ç±»éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</p> <p>Reader ç±»çš„å¸¸ç”¨å­ç±»å¦‚ä¸‹ã€‚</p> <ul> <li>CharArrayReader ç±»ï¼šå°†å­—ç¬¦æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦è¾“å…¥æµï¼Œä»ä¸­è¯»å–å­—ç¬¦ã€‚</li> <li>StringReader ç±»ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦è¾“å…¥æµï¼Œä»ä¸­è¯»å–å­—ç¬¦ã€‚</li> <li>BufferedReader ç±»ï¼šä¸ºå…¶ä»–å­—ç¬¦è¾“å…¥æµæä¾›è¯»ç¼“å†²åŒºã€‚</li> <li>PipedReader ç±»ï¼šè¿æ¥åˆ°ä¸€ä¸ª PipedWriterã€‚</li> <li>InputStreamReader ç±»ï¼šå°†å­—èŠ‚è¾“å…¥æµè½¬æ¢ä¸ºå­—ç¬¦è¾“å…¥æµï¼Œå¯ä»¥æŒ‡å®šå­—ç¬¦ç¼–ç ã€‚</li> </ul> <p>ä¸ InputStream ç±»ç›¸åŒï¼Œåœ¨ Reader ç±»ä¸­ä¹ŸåŒ…å« close()ã€mark()ã€skip() å’Œ reset() ç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥å‚è€ƒ InputStream ç±»çš„æ–¹æ³•ã€‚ä¸‹é¢ä¸»è¦ä»‹ç» Reader ç±»ä¸­çš„ read() æ–¹æ³•ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p> <table> <thead> <tr> <th>æ–¹æ³•ååŠè¿”å›å€¼ç±»å‹</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>int read()</td> <td>ä»è¾“å…¥æµä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶æŠŠå®ƒè½¬æ¢ä¸º 0~65535 çš„æ•´æ•°ã€‚å¦‚æœè¿”å› -1ï¼Œ åˆ™è¡¨ç¤º å·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾ã€‚ä¸ºäº†æé«˜ I/O æ“ä½œçš„æ•ˆç‡ï¼Œå»ºè®®å°½é‡ä½¿ç”¨ä¸‹é¢ä¸¤ç§ read() æ–¹æ³•</td> </tr> <tr> <td>int read(char[] cbuf)</td> <td>ä»è¾“å…¥æµä¸­è¯»å–è‹¥å¹²ä¸ªå­—ç¬¦ï¼Œå¹¶æŠŠå®ƒä»¬ä¿å­˜åˆ°å‚æ•° cbuf æŒ‡å®šçš„å­—ç¬¦æ•°ç»„ä¸­ã€‚ è¯¥æ–¹ æ³•è¿”å›è¯»å–çš„å­—ç¬¦æ•°ï¼Œå¦‚æœè¿”å› -1ï¼Œåˆ™è¡¨ç¤ºå·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾</td> </tr> <tr> <td>int read(char[] cbuf,int off,int len)</td> <td>ä»è¾“å…¥æµä¸­è¯»å–è‹¥å¹²ä¸ªå­—ç¬¦ï¼Œå¹¶æŠŠå®ƒä»¬ä¿å­˜åˆ°å‚æ•° cbuf æŒ‡å®šçš„å­—ç¬¦æ•°ç»„ä¸­ã€‚å…¶ä¸­ï¼Œ off æŒ‡å®šåœ¨å­—ç¬¦æ•°ç»„ä¸­å¼€å§‹ä¿å­˜æ•°æ®çš„èµ·å§‹ä¸‹æ ‡ï¼Œlen æŒ‡å®šè¯»å–çš„å­—ç¬¦æ•°ã€‚è¯¥æ–¹æ³•è¿” å›å®é™…è¯»å–çš„å­—ç¬¦æ•°ï¼Œå¦‚æœè¿”å› -1ï¼Œåˆ™è¡¨ç¤ºå·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾</td> </tr> </tbody> </table> <h4 id="1272å­—ç¬¦è¾“å‡ºæµ">12.7.2ã€å­—ç¬¦è¾“å‡ºæµ<a class="headerlink" href="#1272å­—ç¬¦è¾“å‡ºæµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>ä¸ Reader ç±»ç›¸åï¼Œ==Writer ç±»æ˜¯æ‰€æœ‰å­—ç¬¦è¾“å‡ºæµçš„çˆ¶ç±»ï¼Œ==è¯¥ç±»ä¸­æœ‰è®¸å¤šæ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯¹ç»§æ‰¿è¯¥ç±»çš„æ‰€æœ‰å­ç±»éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</p> <p>Writer ç±»çš„å¸¸ç”¨å­ç±»å¦‚ä¸‹ã€‚</p> <ul> <li>CharArrayWriter ç±»ï¼šå‘å†…å­˜ç¼“å†²åŒºçš„å­—ç¬¦æ•°ç»„å†™æ•°æ®ã€‚</li> <li>StringWriter ç±»ï¼šå‘å†…å­˜ç¼“å†²åŒºçš„å­—ç¬¦ä¸²ï¼ˆStringBufferï¼‰å†™æ•°æ®ã€‚</li> <li>BufferedWriter ç±»ï¼šä¸ºå…¶ä»–å­—ç¬¦è¾“å‡ºæµæä¾›å†™ç¼“å†²åŒºã€‚</li> <li>PipedWriter ç±»ï¼šè¿æ¥åˆ°ä¸€ä¸ª PipedReaderã€‚</li> <li>OutputStreamReader ç±»ï¼šå°†å­—èŠ‚è¾“å‡ºæµè½¬æ¢ä¸ºå­—ç¬¦è¾“å‡ºæµï¼Œå¯ä»¥æŒ‡å®šå­—ç¬¦ç¼–ç ã€‚</li> </ul> <p>ä¸ OutputStream ç±»ç›¸åŒï¼ŒWriter ç±»ä¹ŸåŒ…å« close()ã€flush() ç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥å‚è€ƒ OutputStream ç±»çš„æ–¹æ³•ã€‚ä¸‹é¢ä¸»è¦ä»‹ç» Writer ç±»ä¸­çš„ write() æ–¹æ³•å’Œ append() æ–¹æ³•ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p> <table> <thead> <tr> <th>æ–¹æ³•ååŠè¿”å›å€¼ç±»å‹</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>void write(int c)</td> <td>å‘è¾“å‡ºæµä¸­å†™å…¥ä¸€ä¸ªå­—ç¬¦</td> </tr> <tr> <td>void write(char[] cbuf)</td> <td>æŠŠå‚æ•° cbuf æŒ‡å®šçš„å­—ç¬¦æ•°ç»„ä¸­çš„æ‰€æœ‰å­—ç¬¦å†™åˆ°è¾“å‡ºæµä¸­</td> </tr> <tr> <td>void write(char[] cbuf,int off,int len)</td> <td>æŠŠå‚æ•° cbuf æŒ‡å®šçš„å­—ç¬¦æ•°ç»„ä¸­çš„è‹¥å¹²å­—ç¬¦å†™åˆ°è¾“å‡ºæµä¸­ã€‚å…¶ä¸­ï¼Œoff æŒ‡å®š å­—ç¬¦æ•°ç»„ä¸­çš„èµ·å§‹ä¸‹æ ‡ï¼Œlen è¡¨ç¤ºå…ƒç´ ä¸ªæ•°</td> </tr> <tr> <td>void write(String str)</td> <td>å‘è¾“å‡ºæµä¸­å†™å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</td> </tr> <tr> <td>void write(String str, int off,int len)</td> <td>å‘è¾“å‡ºæµä¸­å†™å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„éƒ¨åˆ†å­—ç¬¦ã€‚å…¶ä¸­ï¼Œoff æŒ‡å®šå­—ç¬¦ä¸²ä¸­çš„èµ· å§‹åç§»é‡ï¼Œlen è¡¨ç¤ºå­—ç¬¦ä¸ªæ•°</td> </tr> <tr> <td>append(char c)</td> <td>å°†å‚æ•° c æŒ‡å®šçš„å­—ç¬¦æ·»åŠ åˆ°è¾“å‡ºæµä¸­</td> </tr> <tr> <td>append(charSequence esq)</td> <td>å°†å‚æ•° esq æŒ‡å®šçš„å­—ç¬¦åºåˆ—æ·»åŠ åˆ°è¾“å‡ºæµä¸­</td> </tr> <tr> <td>append(charSequence esq,int start,int end)</td> <td>å°†å‚æ•° esq æŒ‡å®šçš„å­—ç¬¦åºåˆ—çš„å­åºåˆ—æ·»åŠ åˆ°è¾“å‡ºæµä¸­ã€‚å…¶ä¸­ï¼Œstart æŒ‡å®š å­åºåˆ—çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•ï¼Œend æŒ‡å®šå­åºåˆ—ä¸­æœ€åä¸€ä¸ªå­—ç¬¦åé¢çš„å­—ç¬¦ çš„ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¯´å­åºåˆ—çš„å†…å®¹åŒ…å« start ç´¢å¼•å¤„çš„å­—ç¬¦ï¼Œä½†ä¸åŒ…æ‹¬ end ç´¢å¼•å¤„çš„å­—ç¬¦</td> </tr> </tbody> </table> <p><mark>æ³¨æ„ï¼šWriter ç±»æ‰€æœ‰çš„æ–¹æ³•åœ¨å‡ºé”™çš„æƒ…å†µä¸‹éƒ½ä¼šå¼•å‘ IOException å¼‚å¸¸ã€‚å…³é—­ä¸€ä¸ªæµåï¼Œå†å¯¹å…¶è¿›è¡Œä»»ä½•æ“ä½œéƒ½ä¼šäº§ç”Ÿé”™è¯¯ã€‚</mark></p> <h4 id="1273å­—ç¬¦æ–‡ä»¶è¾“å…¥æµ">12.7.3ã€å­—ç¬¦æ–‡ä»¶è¾“å…¥æµ<a class="headerlink" href="#1273å­—ç¬¦æ–‡ä»¶è¾“å…¥æµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>ä¸ºäº†è¯»å–æ–¹ä¾¿ï¼ŒJava æä¾›äº†ç”¨æ¥è¯»å–å­—ç¬¦æ–‡ä»¶çš„ä¾¿æ·ç±»â€”â€”FileReaderã€‚è¯¥ç±»çš„æ„é€ æ–¹æ³•æœ‰å¦‚ä¸‹ä¸¤ç§é‡è½½å½¢å¼ã€‚</p> <ol> <li>FileReader(File file)ï¼šåœ¨ç»™å®šè¦è¯»å–æ•°æ®çš„æ–‡ä»¶çš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ FileReader å¯¹è±¡ã€‚å…¶ä¸­ï¼Œfile è¡¨ç¤ºè¦ä»ä¸­è¯»å–æ•°æ®çš„æ–‡ä»¶ã€‚</li> <li>FileReader(String fileName)ï¼šåœ¨ç»™å®šä»ä¸­è¯»å–æ•°æ®çš„æ–‡ä»¶åçš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ªæ–° FileReader å¯¹è±¡ã€‚å…¶ä¸­ï¼ŒfileName è¡¨ç¤ºè¦ä»ä¸­è¯»å–æ•°æ®çš„æ–‡ä»¶çš„åç§°ï¼Œè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚</li> </ol> <p>åœ¨ç”¨è¯¥ç±»çš„æ„é€ æ–¹æ³•åˆ›å»º FileReader è¯»å–å¯¹è±¡æ—¶ï¼Œé»˜è®¤çš„å­—ç¬¦ç¼–ç åŠå­—èŠ‚ç¼“å†²åŒºå¤§å°éƒ½æ˜¯ç”±ç³»ç»Ÿè®¾å®šçš„ã€‚è¦è‡ªå·±æŒ‡å®šè¿™äº›å€¼ï¼Œå¯ä»¥åœ¨ FilelnputStream ä¸Šæ„é€ ä¸€ä¸ª InputStreamReaderã€‚</p> <p>æ³¨æ„ï¼šåœ¨åˆ›å»º FileReader å¯¹è±¡æ—¶å¯èƒ½ä¼šå¼•å‘ä¸€ä¸ª FileNotFoundException å¼‚å¸¸ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ try catch è¯­å¥æ•è·è¯¥å¼‚å¸¸ã€‚</p> <p>å­—ç¬¦æµå’Œå­—èŠ‚æµçš„æ“ä½œæ­¥éª¤ç›¸åŒï¼Œéƒ½æ˜¯é¦–å…ˆåˆ›å»ºè¾“å…¥æµæˆ–è¾“å‡ºæµå¯¹è±¡ï¼Œå³å»ºç«‹è¿æ¥ç®¡é“ï¼Œå»ºç«‹å®Œæˆåè¿›è¡Œè¯»æˆ–å†™æ“ä½œï¼Œæœ€åå…³é—­è¾“å…¥/è¾“å‡ºæµé€šé“ã€‚</p> <p>è¦å°† D:\myJava\HelloJava.java æ–‡ä»¶ä¸­çš„å†…å®¹è¯»å–å¹¶è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä½¿ç”¨ FileReader ç±»çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test12</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-161-2"><a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-161-3"><a id="__codelineno-161-3" name="__codelineno-161-3" href="#__codelineno-161-3"></a><span class="w">        </span><span class="n">FileReader</span><span class="w"> </span><span class="n">fr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-161-4"><a id="__codelineno-161-4" name="__codelineno-161-4" href="#__codelineno-161-4"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-161-5"><a id="__codelineno-161-5" name="__codelineno-161-5" href="#__codelineno-161-5"></a><span class="w">            </span><span class="n">fr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileReader</span><span class="p">(</span><span class="s">"D:/myJava/HelloJava.java"</span><span class="p">);</span><span class="w"> </span><span class="c1">// åˆ›å»ºFileReaderå¯¹è±¡</span>
</span><span id="__span-161-6"><a id="__codelineno-161-6" name="__codelineno-161-6" href="#__codelineno-161-6"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-161-7"><a id="__codelineno-161-7" name="__codelineno-161-7" href="#__codelineno-161-7"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"D:\\myJava\\HelloJava.javaæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š"</span><span class="p">);</span>
</span><span id="__span-161-8"><a id="__codelineno-161-8" name="__codelineno-161-8" href="#__codelineno-161-8"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fr</span><span class="p">.</span><span class="na">read</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// å¾ªç¯è¯»å–</span>
</span><span id="__span-161-9"><a id="__codelineno-161-9" name="__codelineno-161-9" href="#__codelineno-161-9"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="c1">// å°†è¯»å–çš„å†…å®¹å¼ºåˆ¶è½¬æ¢ä¸ºcharç±»å‹</span>
</span><span id="__span-161-10"><a id="__codelineno-161-10" name="__codelineno-161-10" href="#__codelineno-161-10"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-161-11"><a id="__codelineno-161-11" name="__codelineno-161-11" href="#__codelineno-161-11"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-161-12"><a id="__codelineno-161-12" name="__codelineno-161-12" href="#__codelineno-161-12"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span id="__span-161-13"><a id="__codelineno-161-13" name="__codelineno-161-13" href="#__codelineno-161-13"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-161-14"><a id="__codelineno-161-14" name="__codelineno-161-14" href="#__codelineno-161-14"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-161-15"><a id="__codelineno-161-15" name="__codelineno-161-15" href="#__codelineno-161-15"></a><span class="w">                </span><span class="n">fr</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"> </span><span class="c1">// å…³é—­å¯¹è±¡</span>
</span><span id="__span-161-16"><a id="__codelineno-161-16" name="__codelineno-161-16" href="#__codelineno-161-16"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-161-17"><a id="__codelineno-161-17" name="__codelineno-161-17" href="#__codelineno-161-17"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-161-18"><a id="__codelineno-161-18" name="__codelineno-161-18" href="#__codelineno-161-18"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-161-19"><a id="__codelineno-161-19" name="__codelineno-161-19" href="#__codelineno-161-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-161-20"><a id="__codelineno-161-20" name="__codelineno-161-20" href="#__codelineno-161-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-161-21"><a id="__codelineno-161-21" name="__codelineno-161-21" href="#__codelineno-161-21"></a><span class="p">}</span>
</span></code></pre></div> <p>å¦‚ä¸Šè¿°ä»£ç ï¼Œé¦–å…ˆåˆ›å»ºäº† FileReader å­—ç¬¦è¾“å…¥æµå¯¹è±¡ frï¼Œè¯¥å¯¹è±¡æŒ‡å‘ D:\myJava\HelloJava.java æ–‡ä»¶ï¼Œç„¶åå®šä¹‰å˜é‡ i æ¥æ¥æ”¶è°ƒç”¨ read() æ–¹æ³•çš„è¿”å›å€¼ï¼Œå³è¯»å–çš„å­—ç¬¦ã€‚åœ¨ while å¾ªç¯ä¸­ï¼Œæ¯æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦èµ‹ç»™æ•´å‹å˜é‡ iï¼Œç›´åˆ°è¯»å–åˆ°æ–‡ä»¶æœ«å°¾æ—¶é€€å‡ºå¾ªç¯ï¼ˆå½“è¾“å…¥æµè¯»å–åˆ°æ–‡ä»¶æœ«å°¾æ—¶ï¼Œä¼šè¿”å›å€¼ -1ï¼‰ã€‚</p> <h4 id="1274å­—ç¬¦æ–‡ä»¶è¾“å‡ºæµ">12.7.4ã€å­—ç¬¦æ–‡ä»¶è¾“å‡ºæµ<a class="headerlink" href="#1274å­—ç¬¦æ–‡ä»¶è¾“å‡ºæµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Java æä¾›äº†å†™å…¥å­—ç¬¦æ–‡ä»¶çš„ä¾¿æ·ç±»â€”â€”FileWriterï¼Œè¯¥ç±»çš„æ„é€ æ–¹æ³•æœ‰å¦‚ä¸‹ 4 ç§é‡è½½å½¢å¼ã€‚</p> <ol> <li>FileWriter(File file)ï¼šåœ¨æŒ‡å®š File å¯¹è±¡çš„æƒ…å†µä¸‹æ„é€ ä¸€ä¸ª FileWriter å¯¹è±¡ã€‚å…¶ä¸­ï¼Œfile è¡¨ç¤ºè¦å†™å…¥æ•°æ®çš„ File å¯¹è±¡ã€‚</li> <li>FileWriter(File file,boolean append)ï¼šåœ¨æŒ‡å®š File å¯¹è±¡çš„æƒ…å†µä¸‹æ„é€ ä¸€ä¸ª FileWriter å¯¹è±¡ï¼Œå¦‚æœ append çš„å€¼ä¸º trueï¼Œåˆ™å°†å­—èŠ‚å†™å…¥æ–‡ä»¶æœ«å°¾ï¼Œè€Œä¸æ˜¯å†™å…¥æ–‡ä»¶å¼€å§‹å¤„ã€‚</li> <li>FileWriter(String fileName)ï¼šåœ¨æŒ‡å®šæ–‡ä»¶åçš„æƒ…å†µä¸‹æ„é€ ä¸€ä¸ª FileWriter å¯¹è±¡ã€‚å…¶ä¸­ï¼ŒfileName è¡¨ç¤ºè¦å†™å…¥å­—ç¬¦çš„æ–‡ä»¶åï¼Œè¡¨ç¤ºçš„æ˜¯å®Œæ•´è·¯å¾„ã€‚</li> <li>FileWriter(String fileName,boolean append)ï¼šåœ¨æŒ‡å®šæ–‡ä»¶åä»¥åŠè¦å†™å…¥æ–‡ä»¶çš„ä½ç½®çš„æƒ…å†µä¸‹æ„é€  FileWriter å¯¹è±¡ã€‚å…¶ä¸­ï¼Œappend æ˜¯ä¸€ä¸ª boolean å€¼ï¼Œå¦‚æœä¸º trueï¼Œåˆ™å°†æ•°æ®å†™å…¥æ–‡ä»¶æœ«å°¾ï¼Œè€Œä¸æ˜¯æ–‡ä»¶å¼€å§‹å¤„ã€‚</li> </ol> <p>åœ¨åˆ›å»º FileWriter å¯¹è±¡æ—¶ï¼Œé»˜è®¤å­—ç¬¦ç¼–ç å’Œé»˜è®¤å­—èŠ‚ç¼“å†²åŒºå¤§å°éƒ½æ˜¯ç”±ç³»ç»Ÿè®¾å®šçš„ã€‚è¦è‡ªå·±æŒ‡å®šè¿™äº›å€¼ï¼Œå¯ä»¥åœ¨ FileOutputStream ä¸Šæ„é€ ä¸€ä¸ª OutputStreamWriter å¯¹è±¡ã€‚</p> <p><mark>FileWriter ç±»çš„åˆ›å»ºä¸ä¾èµ–äºæ–‡ä»¶å­˜åœ¨ä¸å¦ï¼Œå¦‚æœå…³è”æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚åœ¨åˆ›å»ºæ–‡ä»¶ä¹‹å‰ï¼ŒFileWriter å°†åœ¨åˆ›å»ºå¯¹è±¡æ—¶æ‰“å¼€å®ƒä½œä¸ºè¾“å‡ºã€‚å¦‚æœè¯•å›¾æ‰“å¼€ä¸€ä¸ªåªè¯»æ–‡ä»¶ï¼Œå°†å¼•å‘ä¸€ä¸ª IOException å¼‚å¸¸ã€‚</mark></p> <p>æ³¨æ„ï¼šåœ¨åˆ›å»º FileWriter å¯¹è±¡æ—¶å¯èƒ½ä¼šå¼•å‘ IOException æˆ– SecurityException å¼‚å¸¸ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ try catch è¯­å¥æ•è·è¯¥å¼‚å¸¸ã€‚</p> <p>ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œå°†ç”¨æˆ·è¾“å…¥çš„ 4 ä¸ªå­—ç¬¦ä¸²ä¿å­˜åˆ° D:\myJava\book.txt æ–‡ä»¶ä¸­ã€‚åœ¨è¿™é‡Œä½¿ç”¨ FileWriter ç±»ä¸­çš„ write() æ–¹æ³•å¾ªç¯å‘æŒ‡å®šæ–‡ä»¶ä¸­å†™å…¥æ•°æ®ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test13</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a><span class="w">        </span><span class="n">Scanner</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Scanner</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">);</span>
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4" href="#__codelineno-162-4"></a><span class="w">        </span><span class="n">FileWriter</span><span class="w"> </span><span class="n">fw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-162-5"><a id="__codelineno-162-5" name="__codelineno-162-5" href="#__codelineno-162-5"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-6"><a id="__codelineno-162-6" name="__codelineno-162-6" href="#__codelineno-162-6"></a><span class="w">            </span><span class="n">fw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileWriter</span><span class="p">(</span><span class="s">"D:\\myJava\\book.txt"</span><span class="p">);</span><span class="w"> </span><span class="c1">// åˆ›å»ºFileWriterå¯¹è±¡</span>
</span><span id="__span-162-7"><a id="__codelineno-162-7" name="__codelineno-162-7" href="#__codelineno-162-7"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-8"><a id="__codelineno-162-8" name="__codelineno-162-8" href="#__codelineno-162-8"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¯·è¾“å…¥ç¬¬"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"ä¸ªå­—ç¬¦ä¸²ï¼š"</span><span class="p">);</span>
</span><span id="__span-162-9"><a id="__codelineno-162-9" name="__codelineno-162-9" href="#__codelineno-162-9"></a><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="na">next</span><span class="p">();</span><span class="w"> </span><span class="c1">// è¯»å–è¾“å…¥çš„åç§°</span>
</span><span id="__span-162-10"><a id="__codelineno-162-10" name="__codelineno-162-10" href="#__codelineno-162-10"></a><span class="w">                </span><span class="n">fw</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"\r\n"</span><span class="p">);</span><span class="w"> </span><span class="c1">// å¾ªç¯å†™å…¥æ–‡ä»¶</span>
</span><span id="__span-162-11"><a id="__codelineno-162-11" name="__codelineno-162-11" href="#__codelineno-162-11"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-162-12"><a id="__codelineno-162-12" name="__codelineno-162-12" href="#__codelineno-162-12"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å½•å…¥å®Œæˆï¼"</span><span class="p">);</span>
</span><span id="__span-162-13"><a id="__codelineno-162-13" name="__codelineno-162-13" href="#__codelineno-162-13"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-14"><a id="__codelineno-162-14" name="__codelineno-162-14" href="#__codelineno-162-14"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-162-15"><a id="__codelineno-162-15" name="__codelineno-162-15" href="#__codelineno-162-15"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-16"><a id="__codelineno-162-16" name="__codelineno-162-16" href="#__codelineno-162-16"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-17"><a id="__codelineno-162-17" name="__codelineno-162-17" href="#__codelineno-162-17"></a><span class="w">                </span><span class="n">fw</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"> </span><span class="c1">// å…³é—­å¯¹è±¡</span>
</span><span id="__span-162-18"><a id="__codelineno-162-18" name="__codelineno-162-18" href="#__codelineno-162-18"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-19"><a id="__codelineno-162-19" name="__codelineno-162-19" href="#__codelineno-162-19"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-162-20"><a id="__codelineno-162-20" name="__codelineno-162-20" href="#__codelineno-162-20"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-162-21"><a id="__codelineno-162-21" name="__codelineno-162-21" href="#__codelineno-162-21"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-162-22"><a id="__codelineno-162-22" name="__codelineno-162-22" href="#__codelineno-162-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-162-23"><a id="__codelineno-162-23" name="__codelineno-162-23" href="#__codelineno-162-23"></a><span class="p">}</span>
</span></code></pre></div> <p>å¦‚ä¸Šè¿°ä»£ç ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ D:\myJava\book.txt æ–‡ä»¶çš„å­—ç¬¦æ–‡ä»¶è¾“å‡ºæµå¯¹è±¡ fwï¼Œç„¶åä½¿ç”¨ for å¾ªç¯å½•å…¥ 4 ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è°ƒç”¨ write() æ–¹æ³•å°†å­—ç¬¦ä¸²å†™å…¥åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚æœ€ååœ¨ finally è¯­å¥ä¸­å…³é—­å­—ç¬¦æ–‡ä»¶è¾“å‡ºæµã€‚</p> <p>è¿è¡Œè¯¥ç¨‹åºï¼Œæ ¹æ®æç¤ºè¾“å…¥ 4 ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ¥ç€æ‰“å¼€ D:\myJava\book.txt æ–‡ä»¶ï¼Œå°†çœ‹åˆ°å†™å…¥çš„å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a>è¯·è¾“å…¥ç¬¬1ä¸ªå­—ç¬¦ä¸²ï¼š
</span><span id="__span-163-2"><a id="__codelineno-163-2" name="__codelineno-163-2" href="#__codelineno-163-2"></a>çƒ­ç‚¹è¦é—»
</span><span id="__span-163-3"><a id="__codelineno-163-3" name="__codelineno-163-3" href="#__codelineno-163-3"></a>è¯·è¾“å…¥ç¬¬2ä¸ªå­—ç¬¦ä¸²ï¼š
</span><span id="__span-163-4"><a id="__codelineno-163-4" name="__codelineno-163-4" href="#__codelineno-163-4"></a>ä¸ªæ€§æ¨è
</span><span id="__span-163-5"><a id="__codelineno-163-5" name="__codelineno-163-5" href="#__codelineno-163-5"></a>è¯·è¾“å…¥ç¬¬3ä¸ªå­—ç¬¦ä¸²ï¼š
</span><span id="__span-163-6"><a id="__codelineno-163-6" name="__codelineno-163-6" href="#__codelineno-163-6"></a>çƒ­æœæ–°é—»è¯
</span><span id="__span-163-7"><a id="__codelineno-163-7" name="__codelineno-163-7" href="#__codelineno-163-7"></a>è¯·è¾“å…¥ç¬¬4ä¸ªå­—ç¬¦ä¸²ï¼š
</span><span id="__span-163-8"><a id="__codelineno-163-8" name="__codelineno-163-8" href="#__codelineno-163-8"></a>æœ¬åœ°çœ‹ç‚¹
</span><span id="__span-163-9"><a id="__codelineno-163-9" name="__codelineno-163-9" href="#__codelineno-163-9"></a>å½•å…¥å®Œæˆï¼
</span></code></pre></div> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/5-1912191H959510.png" data-desc-position="bottom"><img src="!assets/Java/5-1912191H959510.png" alt="img" style="zoom:80%;"></a></p> <h4 id="1275å­—ç¬¦ç¼“å†²åŒºè¾“å…¥æµ">12.7.5ã€å­—ç¬¦ç¼“å†²åŒºè¾“å…¥æµ<a class="headerlink" href="#1275å­—ç¬¦ç¼“å†²åŒºè¾“å…¥æµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>==BufferedReader ç±»ä¸»è¦ç”¨äºè¾…åŠ©å…¶ä»–å­—ç¬¦è¾“å…¥æµï¼Œå®ƒå¸¦æœ‰ç¼“å†²åŒºï¼Œå¯ä»¥å…ˆå°†ä¸€æ‰¹æ•°æ®è¯»åˆ°å†…å­˜ç¼“å†²åŒºã€‚==æ¥ä¸‹æ¥çš„è¯»æ“ä½œå°±å¯ä»¥ç›´æ¥ä»ç¼“å†²åŒºä¸­è·å–æ•°æ®ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½ä»æ•°æ®æºè¯»å–æ•°æ®å¹¶è¿›è¡Œå­—ç¬¦ç¼–ç è½¬æ¢ï¼Œè¿™æ ·å°±å¯ä»¥æé«˜æ•°æ®çš„è¯»å–æ•ˆç‡ã€‚</p> <p>BufferedReader ç±»çš„æ„é€ æ–¹æ³•æœ‰å¦‚ä¸‹ä¸¤ç§é‡è½½å½¢å¼ã€‚</p> <ol> <li>BufferedReader(Reader in)ï¼šåˆ›å»ºä¸€ä¸ª BufferedReader æ¥ä¿®é¥°å‚æ•° in æŒ‡å®šçš„å­—ç¬¦è¾“å…¥æµã€‚</li> <li>BufferedReader(Reader in,int size)ï¼šåˆ›å»ºä¸€ä¸ª BufferedReader æ¥ä¿®é¥°å‚æ•° in æŒ‡å®šçš„å­—ç¬¦è¾“å…¥æµï¼Œå‚æ•° size åˆ™ç”¨äºæŒ‡å®šç¼“å†²åŒºçš„å¤§å°ï¼Œå•ä½ä¸ºå­—ç¬¦ã€‚</li> </ol> <p>é™¤äº†å¯ä»¥ä¸ºå­—ç¬¦è¾“å…¥æµæä¾›ç¼“å†²åŒºä»¥å¤–ï¼ŒBufferedReader è¿˜æä¾›äº† <code>readLine()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›åŒ…å«è¯¥è¡Œå†…å®¹çš„å­—ç¬¦ä¸²ï¼Œä½†è¯¥å­—ç¬¦ä¸²ä¸­ä¸åŒ…å«ä»»ä½•ç»ˆæ­¢ç¬¦ï¼Œå¦‚æœå·²åˆ°è¾¾æµæœ«å°¾ï¼Œåˆ™è¿”å› nullã€‚readLine() æ–¹æ³•è¡¨ç¤ºæ¯æ¬¡è¯»å–ä¸€è¡Œæ–‡æœ¬å†…å®¹ï¼Œå½“é‡åˆ°æ¢è¡Œï¼ˆ\nï¼‰ã€å›è½¦ï¼ˆ\rï¼‰æˆ–å›è½¦åç›´æ¥è·Ÿç€æ¢è¡Œæ ‡è®°ç¬¦å³å¯è®¤ä¸ºæŸè¡Œå·²ç»ˆæ­¢ã€‚</p> <p>ä½¿ç”¨ BufferedReader ç±»ä¸­çš„ readLine() æ–¹æ³•é€è¡Œè¯»å– D:\myJava\Book.txt æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå¹¶å°†è¯»å–çš„å†…å®¹åœ¨æ§åˆ¶å°ä¸­æ‰“å°è¾“å‡ºï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test13</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-2"><a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-3"><a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a><span class="w">        </span><span class="n">FileReader</span><span class="w"> </span><span class="n">fr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-164-4"><a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a><span class="w">        </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">br</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-164-5"><a id="__codelineno-164-5" name="__codelineno-164-5" href="#__codelineno-164-5"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-6"><a id="__codelineno-164-6" name="__codelineno-164-6" href="#__codelineno-164-6"></a><span class="w">            </span><span class="n">fr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileReader</span><span class="p">(</span><span class="s">"D:\\myJava\\book.txt"</span><span class="p">);</span><span class="w"> </span><span class="c1">// åˆ›å»º FileReader å¯¹è±¡</span>
</span><span id="__span-164-7"><a id="__codelineno-164-7" name="__codelineno-164-7" href="#__codelineno-164-7"></a><span class="w">            </span><span class="n">br</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">fr</span><span class="p">);</span><span class="w"> </span><span class="c1">// åˆ›å»º BufferedReader å¯¹è±¡</span>
</span><span id="__span-164-8"><a id="__codelineno-164-8" name="__codelineno-164-8" href="#__codelineno-164-8"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"D:\\myJava\\book.txt æ–‡ä»¶ä¸­çš„å†…å®¹å¦‚ä¸‹ï¼š"</span><span class="p">);</span>
</span><span id="__span-164-9"><a id="__codelineno-164-9" name="__codelineno-164-9" href="#__codelineno-164-9"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">strLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">;</span>
</span><span id="__span-164-10"><a id="__codelineno-164-10" name="__codelineno-164-10" href="#__codelineno-164-10"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">strLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">br</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// å¾ªç¯è¯»å–æ¯è¡Œæ•°æ®</span>
</span><span id="__span-164-11"><a id="__codelineno-164-11" name="__codelineno-164-11" href="#__codelineno-164-11"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">strLine</span><span class="p">);</span>
</span><span id="__span-164-12"><a id="__codelineno-164-12" name="__codelineno-164-12" href="#__codelineno-164-12"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-164-13"><a id="__codelineno-164-13" name="__codelineno-164-13" href="#__codelineno-164-13"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-14"><a id="__codelineno-164-14" name="__codelineno-164-14" href="#__codelineno-164-14"></a><span class="w">            </span><span class="n">e1</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-164-15"><a id="__codelineno-164-15" name="__codelineno-164-15" href="#__codelineno-164-15"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-16"><a id="__codelineno-164-16" name="__codelineno-164-16" href="#__codelineno-164-16"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-164-17"><a id="__codelineno-164-17" name="__codelineno-164-17" href="#__codelineno-164-17"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-18"><a id="__codelineno-164-18" name="__codelineno-164-18" href="#__codelineno-164-18"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-19"><a id="__codelineno-164-19" name="__codelineno-164-19" href="#__codelineno-164-19"></a><span class="w">                </span><span class="n">fr</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"> </span><span class="c1">// å…³é—­ FileReader å¯¹è±¡</span>
</span><span id="__span-164-20"><a id="__codelineno-164-20" name="__codelineno-164-20" href="#__codelineno-164-20"></a><span class="w">                </span><span class="n">br</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</span><span id="__span-164-21"><a id="__codelineno-164-21" name="__codelineno-164-21" href="#__codelineno-164-21"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-22"><a id="__codelineno-164-22" name="__codelineno-164-22" href="#__codelineno-164-22"></a><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-164-23"><a id="__codelineno-164-23" name="__codelineno-164-23" href="#__codelineno-164-23"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-164-24"><a id="__codelineno-164-24" name="__codelineno-164-24" href="#__codelineno-164-24"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-164-25"><a id="__codelineno-164-25" name="__codelineno-164-25" href="#__codelineno-164-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-164-26"><a id="__codelineno-164-26" name="__codelineno-164-26" href="#__codelineno-164-26"></a><span class="p">}</span>
</span></code></pre></div> <p>å¦‚ä¸Šè¿°ä»£ç ï¼Œé¦–å…ˆåˆ†åˆ«åˆ›å»ºäº†åç§°ä¸º fr çš„ FileReader å¯¹è±¡å’Œåç§°ä¸º br çš„ BufferedReader å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ BufferedReader å¯¹è±¡çš„ readLine() æ–¹æ³•é€è¡Œè¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚å¦‚æœè¯»å–çš„æ–‡ä»¶å†…å®¹ä¸º Nullï¼Œå³è¡¨æ˜å·²ç»è¯»å–åˆ°æ–‡ä»¶å°¾éƒ¨ï¼Œæ­¤æ—¶é€€å‡ºå¾ªç¯ä¸å†è¿›è¡Œè¯»å–æ“ä½œã€‚æœ€åå°†å­—ç¬¦æ–‡ä»¶è¾“å…¥æµå’Œå¸¦ç¼“å†²çš„å­—ç¬¦è¾“å…¥æµå…³é—­ã€‚</p> <p>è¿è¡Œè¯¥ç¨‹åºï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a>D:\myJava\book.txt æ–‡ä»¶ä¸­çš„å†…å®¹å¦‚ä¸‹ï¼š
</span><span id="__span-165-2"><a id="__codelineno-165-2" name="__codelineno-165-2" href="#__codelineno-165-2"></a>çƒ­ç‚¹è¦é—»
</span><span id="__span-165-3"><a id="__codelineno-165-3" name="__codelineno-165-3" href="#__codelineno-165-3"></a>ä¸ªæ€§æ¨è
</span><span id="__span-165-4"><a id="__codelineno-165-4" name="__codelineno-165-4" href="#__codelineno-165-4"></a>çƒ­æœæ–°é—»è¯
</span><span id="__span-165-5"><a id="__codelineno-165-5" name="__codelineno-165-5" href="#__codelineno-165-5"></a>æœ¬åœ°çœ‹ç‚¹
</span></code></pre></div> <h4 id="1276å­—ç¬¦ç¼“å†²åŒºè¾“å‡ºæµ">12.7.6ã€å­—ç¬¦ç¼“å†²åŒºè¾“å‡ºæµ<a class="headerlink" href="#1276å­—ç¬¦ç¼“å†²åŒºè¾“å‡ºæµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>==BufferedWriter ç±»ä¸»è¦ç”¨äºè¾…åŠ©å…¶ä»–å­—ç¬¦è¾“å‡ºæµï¼Œ==å®ƒåŒæ ·å¸¦æœ‰ç¼“å†²åŒºï¼Œå¯ä»¥å…ˆå°†ä¸€æ‰¹æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œå½“ç¼“å†²åŒºæ»¡äº†ä»¥åï¼Œå†å°†ç¼“å†²åŒºçš„æ•°æ®ä¸€æ¬¡æ€§å†™åˆ°å­—ç¬¦è¾“å‡ºæµï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†æé«˜æ•°æ®çš„å†™æ•ˆç‡ã€‚</p> <p>BufferedWriter ç±»çš„æ„é€ æ–¹æ³•æœ‰å¦‚ä¸‹ä¸¤ç§é‡è½½å½¢å¼ã€‚</p> <ol> <li>BufferedWriter(Writer out)ï¼šåˆ›å»ºä¸€ä¸ª BufferedWriter æ¥ä¿®é¥°å‚æ•° out æŒ‡å®šçš„å­—ç¬¦è¾“å‡ºæµã€‚</li> <li>BufferedWriter(Writer out,int size)ï¼šåˆ›å»ºä¸€ä¸ª BufferedWriter æ¥ä¿®é¥°å‚æ•° out æŒ‡å®šçš„å­—ç¬¦è¾“å‡ºæµï¼Œå‚æ•° size åˆ™ç”¨äºæŒ‡å®šç¼“å†²åŒºçš„å¤§å°ï¼Œå•ä½ä¸ºå­—ç¬¦ã€‚</li> </ol> <p>è¯¥ç±»é™¤äº†å¯ä»¥ç»™å­—ç¬¦è¾“å‡ºæµæä¾›ç¼“å†²åŒºä¹‹å¤–ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªæ–°çš„æ–¹æ³• newLine()ï¼Œè¯¥æ–¹æ³•ç”¨äºå†™å…¥ä¸€ä¸ªè¡Œåˆ†éš”ç¬¦ã€‚è¡Œåˆ†éš”ç¬¦å­—ç¬¦ä¸²ç”±ç³»ç»Ÿå±æ€§ line.separator å®šä¹‰ï¼Œå¹¶ä¸”ä¸ä¸€å®šæ˜¯å•ä¸ªæ–°è¡Œï¼ˆ\nï¼‰ç¬¦ã€‚</p> <p>æç¤ºï¼šBufferedWriter ç±»çš„ä½¿ç”¨ä¸ FileWriter ç±»ç›¸åŒï¼Œè¿™é‡Œä¸å†é‡è¿°ã€‚</p> <h3 id="128è½¬æ¢æµ">12.8ã€è½¬æ¢æµ<a class="headerlink" href="#128è½¬æ¢æµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå­—èŠ‚æµå¯ä»¥å¯¹æ‰€æœ‰çš„æ•°æ®è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™åœ¨å¤„ç†ä¸€äº›æ–‡æœ¬æ—¶æˆ‘ä»¬è¦ç”¨åˆ°å­—ç¬¦æµï¼Œæ¯”å¦‚ï¼ŒæŸ¥çœ‹æ–‡æœ¬çš„ä¸­æ–‡æ—¶å°±æ˜¯éœ€è¦é‡‡ç”¨å­—ç¬¦æµæ›´ä¸ºæ–¹ä¾¿ã€‚æ‰€ä»¥ Java IO æµä¸­æä¾›äº†ä¸¤ç§ç”¨äºå°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµçš„è½¬æ¢æµã€‚</p> <p>==InputStreamReader ç”¨äºå°†å­—èŠ‚è¾“å…¥æµè½¬æ¢ä¸ºå­—ç¬¦è¾“å…¥æµï¼Œ==å…¶ä¸­ ==OutputStreamWriter ç”¨äºå°†å­—èŠ‚è¾“å‡ºæµè½¬æ¢ä¸ºå­—ç¬¦è¾“å‡ºæµã€‚==ä½¿ç”¨è½¬æ¢æµå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…ä¹±ç ï¼Œè¿˜å¯ä»¥æŒ‡å®šè¾“å…¥è¾“å‡ºæ‰€ä½¿ç”¨çš„å­—ç¬¦é›†ã€‚</p> <p>åœ¨ java.txt ä¸­è¾“å…¥â€œCè¯­è¨€ä¸­æ–‡ç½‘â€è¿™ 6 ä¸ªå­—ï¼Œå°† java.txt ä¿å­˜ä¸ºâ€œUTF-8â€çš„æ ¼å¼ï¼Œç„¶åé€šè¿‡å­—èŠ‚æµçš„æ–¹å¼è¯»å–ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-2"><a id="__codelineno-166-2" name="__codelineno-166-2" href="#__codelineno-166-2"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-3"><a id="__codelineno-166-3" name="__codelineno-166-3" href="#__codelineno-166-3"></a><span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">"D://java.txt"</span><span class="p">);</span>
</span><span id="__span-166-4"><a id="__codelineno-166-4" name="__codelineno-166-4" href="#__codelineno-166-4"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-166-5"><a id="__codelineno-166-5" name="__codelineno-166-5" href="#__codelineno-166-5"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fis</span><span class="p">.</span><span class="na">read</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-6"><a id="__codelineno-166-6" name="__codelineno-166-6" href="#__codelineno-166-6"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
</span><span id="__span-166-7"><a id="__codelineno-166-7" name="__codelineno-166-7" href="#__codelineno-166-7"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-166-8"><a id="__codelineno-166-8" name="__codelineno-166-8" href="#__codelineno-166-8"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-9"><a id="__codelineno-166-9" name="__codelineno-166-9" href="#__codelineno-166-9"></a><span class="w">        </span><span class="c1">// TODO Auto-generated catch block</span>
</span><span id="__span-166-10"><a id="__codelineno-166-10" name="__codelineno-166-10" href="#__codelineno-166-10"></a><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-166-11"><a id="__codelineno-166-11" name="__codelineno-166-11" href="#__codelineno-166-11"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-12"><a id="__codelineno-166-12" name="__codelineno-166-12" href="#__codelineno-166-12"></a><span class="w">        </span><span class="c1">// TODO Auto-generated catch block</span>
</span><span id="__span-166-13"><a id="__codelineno-166-13" name="__codelineno-166-13" href="#__codelineno-166-13"></a><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-166-14"><a id="__codelineno-166-14" name="__codelineno-166-14" href="#__codelineno-166-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-166-15"><a id="__codelineno-166-15" name="__codelineno-166-15" href="#__codelineno-166-15"></a><span class="p">}</span>
</span></code></pre></div> <p>è¾“å‡ºç»“æœä¸º <code>C??????????</code>ï¼Œæˆ‘ä»¬å‘ç°ä¸­æ–‡éƒ½æ˜¯ä¹±ç ã€‚ä¸‹é¢ç”¨å­—èŠ‚æ•°ç»„ï¼Œå¹¶é€šè¿‡å­—ç¬¦ä¸²è®¾å®šç¼–ç æ ¼å¼æ¥æ˜¾å¼å†…å®¹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-2"><a id="__codelineno-167-2" name="__codelineno-167-2" href="#__codelineno-167-2"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-3"><a id="__codelineno-167-3" name="__codelineno-167-3" href="#__codelineno-167-3"></a><span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">"D://java.txt"</span><span class="p">);</span>
</span><span id="__span-167-4"><a id="__codelineno-167-4" name="__codelineno-167-4" href="#__codelineno-167-4"></a><span class="w">        </span><span class="kt">byte</span><span class="w"> </span><span class="n">b</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-167-5"><a id="__codelineno-167-5" name="__codelineno-167-5" href="#__codelineno-167-5"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-167-6"><a id="__codelineno-167-6" name="__codelineno-167-6" href="#__codelineno-167-6"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fis</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-7"><a id="__codelineno-167-7" name="__codelineno-167-7" href="#__codelineno-167-7"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="s">"UTF-8"</span><span class="p">));</span>
</span><span id="__span-167-8"><a id="__codelineno-167-8" name="__codelineno-167-8" href="#__codelineno-167-8"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-167-9"><a id="__codelineno-167-9" name="__codelineno-167-9" href="#__codelineno-167-9"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-10"><a id="__codelineno-167-10" name="__codelineno-167-10" href="#__codelineno-167-10"></a><span class="w">        </span><span class="c1">// TODO Auto-generated catch block</span>
</span><span id="__span-167-11"><a id="__codelineno-167-11" name="__codelineno-167-11" href="#__codelineno-167-11"></a><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-167-12"><a id="__codelineno-167-12" name="__codelineno-167-12" href="#__codelineno-167-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-13"><a id="__codelineno-167-13" name="__codelineno-167-13" href="#__codelineno-167-13"></a><span class="w">        </span><span class="c1">// TODO Auto-generated catch block</span>
</span><span id="__span-167-14"><a id="__codelineno-167-14" name="__codelineno-167-14" href="#__codelineno-167-14"></a><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-167-15"><a id="__codelineno-167-15" name="__codelineno-167-15" href="#__codelineno-167-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-167-16"><a id="__codelineno-167-16" name="__codelineno-167-16" href="#__codelineno-167-16"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿™æ—¶è¾“å‡ºç»“æœä¸º <code>Cè¯­è¨€ä¸­æ–‡ç½‘</code>ï¼Œä½†æ˜¯å½“å­˜å‚¨çš„æ–‡å­—è¾ƒå¤šæ—¶ï¼Œä¼šå‡ºç°è§£ç ä¸æ­£ç¡®çš„é—®é¢˜ï¼Œä¸”å­—èŠ‚é•¿åº¦æ— æ³•æ ¹æ®è§£ç å†…å®¹è‡ªåŠ¨è®¾å®šï¼Œæ­¤æ—¶å°±éœ€è¦è½¬æ¢æµæ¥å®Œæˆã€‚ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-168-2"><a id="__codelineno-168-2" name="__codelineno-168-2" href="#__codelineno-168-2"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-168-3"><a id="__codelineno-168-3" name="__codelineno-168-3" href="#__codelineno-168-3"></a><span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">"D://java.txt"</span><span class="p">);</span>
</span><span id="__span-168-4"><a id="__codelineno-168-4" name="__codelineno-168-4" href="#__codelineno-168-4"></a><span class="w">        </span><span class="n">InputStreamReader</span><span class="w"> </span><span class="n">isr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">fis</span><span class="p">,</span><span class="w"> </span><span class="s">"UTF-8"</span><span class="p">);</span>
</span><span id="__span-168-5"><a id="__codelineno-168-5" name="__codelineno-168-5" href="#__codelineno-168-5"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-168-6"><a id="__codelineno-168-6" name="__codelineno-168-6" href="#__codelineno-168-6"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isr</span><span class="p">.</span><span class="na">read</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-168-7"><a id="__codelineno-168-7" name="__codelineno-168-7" href="#__codelineno-168-7"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">    </span><span class="c1">// è¾“å‡ºç»“æœä¸ºâ€œCè¯­è¨€ä¸­æ–‡ç½‘â€</span>
</span><span id="__span-168-8"><a id="__codelineno-168-8" name="__codelineno-168-8" href="#__codelineno-168-8"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-168-9"><a id="__codelineno-168-9" name="__codelineno-168-9" href="#__codelineno-168-9"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-168-10"><a id="__codelineno-168-10" name="__codelineno-168-10" href="#__codelineno-168-10"></a><span class="w">        </span><span class="c1">// TODO Auto-generated catch block</span>
</span><span id="__span-168-11"><a id="__codelineno-168-11" name="__codelineno-168-11" href="#__codelineno-168-11"></a><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-168-12"><a id="__codelineno-168-12" name="__codelineno-168-12" href="#__codelineno-168-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-168-13"><a id="__codelineno-168-13" name="__codelineno-168-13" href="#__codelineno-168-13"></a><span class="w">        </span><span class="c1">// TODO Auto-generated catch block</span>
</span><span id="__span-168-14"><a id="__codelineno-168-14" name="__codelineno-168-14" href="#__codelineno-168-14"></a><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-168-15"><a id="__codelineno-168-15" name="__codelineno-168-15" href="#__codelineno-168-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-168-16"><a id="__codelineno-168-16" name="__codelineno-168-16" href="#__codelineno-168-16"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸‹é¢ä»¥è·å–é”®ç›˜è¾“å…¥ä¸ºä¾‹æ¥ä»‹ç»è½¬æ¢æµçš„ç”¨æ³•ã€‚Java ä½¿ç”¨ System.in ä»£è¡¨æ ‡å‡†è¾“å‡ºï¼Œå³é”®ç›˜è¾“å…¥ï¼Œä½†è¿™ä¸ªæ ‡å‡†è¾“å…¥æµæ˜¯ InputStream ç±»çš„å®ä¾‹ï¼Œä½¿ç”¨ä¸å¤ªæ–¹ä¾¿ï¼Œè€Œä¸”é”®ç›˜è¾“å…¥å†…å®¹éƒ½æ˜¯æ–‡æœ¬å†…å®¹ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ InputStreamReader å°†å…¶è½¬æ¢æˆå­—ç¬¦è¾“å…¥æµï¼Œæ™®é€šçš„ Reader è¯»å–è¾“å…¥å†…å®¹æ—¶ä¾ç„¶ä¸å¤ªæ–¹ä¾¿ï¼Œå¯ä»¥å°†æ™®é€šçš„ Reader å†æ¬¡åŒ…è£…æˆ BufferedReaderï¼Œåˆ©ç”¨ BufferedReader çš„ readLine() æ–¹æ³•å¯ä»¥ä¸€æ¬¡è¯»å–ä¸€è¡Œå†…å®¹ã€‚ç¨‹åºå¦‚ä¸‹æ‰€ç¤ºã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-169-2"><a id="__codelineno-169-2" name="__codelineno-169-2" href="#__codelineno-169-2"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-169-3"><a id="__codelineno-169-3" name="__codelineno-169-3" href="#__codelineno-169-3"></a><span class="w">        </span><span class="c1">// å°† System.in å¯¹è±¡è½¬æ¢æˆ Reader å¯¹è±¡</span>
</span><span id="__span-169-4"><a id="__codelineno-169-4" name="__codelineno-169-4" href="#__codelineno-169-4"></a><span class="w">        </span><span class="n">InputStreamReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">);</span>
</span><span id="__span-169-5"><a id="__codelineno-169-5" name="__codelineno-169-5" href="#__codelineno-169-5"></a><span class="w">        </span><span class="c1">// å°†æ™®é€šçš„Reader åŒ…è£…æˆ BufferedReader</span>
</span><span id="__span-169-6"><a id="__codelineno-169-6" name="__codelineno-169-6" href="#__codelineno-169-6"></a><span class="w">        </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">br</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">reader</span><span class="p">);</span>
</span><span id="__span-169-7"><a id="__codelineno-169-7" name="__codelineno-169-7" href="#__codelineno-169-7"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-169-8"><a id="__codelineno-169-8" name="__codelineno-169-8" href="#__codelineno-169-8"></a><span class="w">        </span><span class="c1">// åˆ©ç”¨å¾ªç¯æ–¹å¼æ¥é€è¡Œçš„è¯»å–</span>
</span><span id="__span-169-9"><a id="__codelineno-169-9" name="__codelineno-169-9" href="#__codelineno-169-9"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">br</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-169-10"><a id="__codelineno-169-10" name="__codelineno-169-10" href="#__codelineno-169-10"></a><span class="w">            </span><span class="c1">// å¦‚æœè¯»å–çš„å­—ç¬¦ä¸²ä¸ºâ€œexitâ€ï¼Œåˆ™ç¨‹åºé€€å‡º</span>
</span><span id="__span-169-11"><a id="__codelineno-169-11" name="__codelineno-169-11" href="#__codelineno-169-11"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">"exit"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-169-12"><a id="__codelineno-169-12" name="__codelineno-169-12" href="#__codelineno-169-12"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-169-13"><a id="__codelineno-169-13" name="__codelineno-169-13" href="#__codelineno-169-13"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-169-14"><a id="__codelineno-169-14" name="__codelineno-169-14" href="#__codelineno-169-14"></a><span class="w">            </span><span class="c1">// æ‰“å°è¯»å–çš„å†…å®¹</span>
</span><span id="__span-169-15"><a id="__codelineno-169-15" name="__codelineno-169-15" href="#__codelineno-169-15"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¾“å…¥å†…å®¹ä¸ºï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">line</span><span class="p">);</span>
</span><span id="__span-169-16"><a id="__codelineno-169-16" name="__codelineno-169-16" href="#__codelineno-169-16"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-169-17"><a id="__codelineno-169-17" name="__codelineno-169-17" href="#__codelineno-169-17"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-169-18"><a id="__codelineno-169-18" name="__codelineno-169-18" href="#__codelineno-169-18"></a><span class="w">        </span><span class="c1">// TODO Auto-generated catch block</span>
</span><span id="__span-169-19"><a id="__codelineno-169-19" name="__codelineno-169-19" href="#__codelineno-169-19"></a><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-169-20"><a id="__codelineno-169-20" name="__codelineno-169-20" href="#__codelineno-169-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-169-21"><a id="__codelineno-169-21" name="__codelineno-169-21" href="#__codelineno-169-21"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ä»£ç ç¬¬ 4 è¡Œå’Œç¬¬ 6 è¡Œå°† System.in åŒ…è£…æˆ BufferedReaderï¼ŒBufferReader æµå…·æœ‰ç¼“å†²åŠŸèƒ½ï¼Œå®ƒå¯ä»¥ä¸€æ¬¡è¯»å–ä¸€è¡Œæ–‡æœ¬ï¼Œä»¥æ¢è¡Œç¬¦ä¸ºæ ‡å¿—ï¼Œå¦‚æœå®ƒæ²¡æœ‰è¯»åˆ°æ¢è¡Œç¬¦ï¼Œåˆ™ç¨‹åºå µå¡ï¼Œç­‰åˆ°è¯»åˆ°æ¢è¡Œç¬¦ä¸ºæ­¢ã€‚è¿è¡Œä¸Šé¢ç¨‹åºå¯ä»¥å‘ç°è¿™ä¸ªç‰¹å¾ï¼Œåœ¨æ§åˆ¶å°æ‰§è¡Œè¾“å…¥æ—¶ï¼Œåªæœ‰æŒ‰ä¸‹å›è½¦é”®ï¼Œç¨‹åºæ‰ä¼šæ‰“å°å‡ºåˆšåˆšè¾“å…¥çš„å†…å®¹ã€‚</p> <p>æç¤ºï¼šSytem.exit(0)æ˜¯æ­£å¸¸é€€å‡ºï¼Œè¡¨ç¤ºç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸé€€å‡ºï¼›system.exit(1)æ˜¯éæ­£å¸¸é€€å‡ºï¼Œå°±æ˜¯è¯´æ— è®ºç¨‹åºæ­£åœ¨æ‰§è¡Œä¸å¦ï¼Œéƒ½é€€å‡ºï¼Œå¤§è‡´ç†è§£ä¸ºç”µè„‘ç‚¹å…³æœºå’Œæ‹”ç”µæºã€‚</p> <p>ç”±äº BufferedReader å…·æœ‰ä¸€ä¸ª readLine() æ–¹æ³•ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°è¿›è¡Œä¸€æ¬¡è¯»å…¥ä¸€è¡Œå†…å®¹ï¼Œæ‰€ä»¥ç»å¸¸æŠŠè¯»å…¥æ–‡æœ¬å†…å®¹åœ°è¾“å…¥æµåŒ…è£…æˆ BufferedReaderï¼Œç”¨æ¥æ–¹ä¾¿åœ°è¯»å–è¾“å…¥æµçš„æ–‡æœ¬å†…å®¹ã€‚</p> <p>æ—¢ç„¶æœ‰å­—èŠ‚æµè½¬å­—ç¬¦æµçš„è½¬æ¢æµï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæ²¡æœ‰å­—ç¬¦æµè½¬å­—èŠ‚æµçš„è½¬æ¢æµå‘¢ï¼Ÿ</p> <p>è¿™ä¸ªé—®é¢˜ä¸€è¯­æŒ‡å‡ºäº† Java è®¾è®¡çš„é—æ¼ä¹‹å¤„ï¼Œæƒ³ä¸€æƒ³å­—ç¬¦æµå’Œå­—èŠ‚æµçš„å·®åˆ«ã€‚å­—èŠ‚æµæ¯”å­—ç¬¦æµçš„ä½¿ç”¨èŒƒå›´è¦æ›´å¹¿ï¼Œä½†å­—ç¬¦æµæ¯”å­—èŠ‚æµæ“ä½œæ–¹ä¾¿ã€‚å¦‚æœæœ‰ä¸€ä¸ªæµå·²ç»æ˜¯å­—ç¬¦æµäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯ä¸€ä¸ªç”¨èµ·æ¥æ›´æ–¹ä¾¿çš„æµï¼Œä¸ºä»€ä¹ˆè¦è½¬æ¢æˆå­—èŠ‚æµå‘¢ï¼Ÿåä¹‹ï¼Œå¦‚æœç°åœ¨æœ‰ä¸€ä¸ªå­—èŠ‚æµï¼Œä½†å¯ä»¥ç¡®å®šè¿™ä¸ªå­—èŠ‚æµçš„å†…å®¹éƒ½æ˜¯æ–‡æœ¬å†…å®¹ï¼Œé‚£ä¹ˆæŠŠå®ƒè½¬æ¢æˆå­—ç¬¦æµæ¥å¤„ç†å°±ä¼šæ›´æ–¹ä¾¿ä¸€äº›ï¼Œæ‰€ä»¥ Java åªæä¾›äº†å°†å­—èŠ‚æµè½¬æ¢æˆå­—ç¬¦æµçš„è½¬æ¢æµï¼Œæ²¡æœ‰æä¾›å°†å­—ç¬¦æµè½¬æ¢æˆå­—èŠ‚æµçš„è½¬æ¢æµã€‚</p> <h3 id="129å¯¹è±¡åºåˆ—åŒ–è¾“å…¥è¾“å‡º">12.9ã€å¯¹è±¡åºåˆ—åŒ–è¾“å…¥è¾“å‡º<a class="headerlink" href="#129å¯¹è±¡åºåˆ—åŒ–è¾“å…¥è¾“å‡º" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>==å¯¹è±¡åºåˆ—åŒ–ï¼ˆSerializeï¼‰==æŒ‡å°†ä¸€ä¸ª Java å¯¹è±¡å†™å…¥ IO æµä¸­ï¼Œä¸æ­¤å¯¹åº”çš„æ˜¯ï¼Œå¯¹è±¡çš„ååºåˆ—åŒ–ï¼ˆDeserializeï¼‰åˆ™æŒ‡ä» IO æµä¸­æ¢å¤è¯¥ Java å¯¹è±¡ã€‚å¦‚æœæƒ³è®©æŸä¸ª Java å¯¹è±¡èƒ½å¤Ÿåºåˆ—åŒ–ï¼Œåˆ™å¿…é¡»è®©å®ƒçš„ç±»å®ç° java.io.Serializable æ¥å£ï¼Œæ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-170-1"><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Serializable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-170-2"><a id="__codelineno-170-2" name="__codelineno-170-2" href="#__codelineno-170-2"></a><span class="p">}</span>
</span></code></pre></div> <p>Serializable æ¥å£æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œå®ç°è¯¥æ¥å£æ— é¡»å®ç°ä»»ä½•æ–¹æ³•ï¼Œå®ƒåªæ˜¯å‘Šè¯‰ JVM è¯¥ç±»å¯ä»¥è¢«åºåˆ—åŒ–æœºåˆ¶å¤„ç†ã€‚é€šå¸¸å»ºè®®ç¨‹åºåˆ›å»ºçš„æ¯ä¸ª JavaBean ç±»éƒ½å®ç° Serializableã€‚</p> <p>ObjectInput æ¥å£ä¸ ObjectOutput æ¥å£åˆ†åˆ«ç»§æ‰¿äº† DataInput å’Œ DataOutput æ¥å£ï¼Œä¸»è¦æä¾›ç”¨äºè¯»å†™åŸºæœ¬æ•°æ®å’Œå¯¹è±¡æ•°æ®çš„æ–¹æ³•ã€‚ ObjectInput æ¥å£æä¾›äº† readObject() æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ç”¨äºå°†å¯¹è±¡ä»æµä¸­è¯»å‡ºã€‚ObjectOutput æä¾›äº† writeObject() æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ç”¨äºå°†å¯¹è±¡å†™å…¥æµä¸­ã€‚å› ä¸º ObjectInput ä¸ ObjectOutput éƒ½æ˜¯æ¥å£ï¼Œæ‰€ä»¥ä¸èƒ½åˆ›å»ºå¯¹è±¡ï¼Œåªèƒ½ä½¿ç”¨åˆ†åˆ«å®ç°äº†è¿™ä¸¤ä¸ªæ¥å£çš„ ObjectInputStream ç±»å’Œ ObjectOutputStream ç±»æ¥åˆ›å»ºå¯¹è±¡ã€‚</p> <p><mark>å‡¡æ˜¯è¢«<code>static</code>ä¿®é¥°çš„å­—æ®µæ˜¯ä¸ä¼šè¢«åºåˆ—åŒ–çš„ï¼Œå› ä¸ºåºåˆ—åŒ–ä¿å­˜çš„æ˜¯<strong>å¯¹è±¡çš„çŠ¶æ€</strong>è€Œéç±»çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä¼šå¿½ç•¥<code>static</code>é™æ€åŸŸä¹Ÿæ˜¯ç†æ‰€åº”å½“çš„ã€‚</mark></p> <h4 id="1291åºåˆ—åŒ–">12.9.1ã€åºåˆ—åŒ–<a class="headerlink" href="#1291åºåˆ—åŒ–" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>ObjectOutputStream ç±»ç»§æ‰¿äº† OutputStream ç±»ï¼ŒåŒæ—¶å®ç°äº† ObjectOutput æ¥å£ï¼Œæä¾›å°†å¯¹è±¡åºåˆ—åŒ–å¹¶å†™å…¥æµä¸­çš„åŠŸèƒ½ï¼Œè¯¥ç±»çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-171-1"><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a><span class="kd">public</span><span class="w"> </span><span class="nf">ObjectOutputStream</span><span class="w"> </span><span class="p">(</span><span class="n">OutputStream</span><span class="w"> </span><span class="n">out</span><span class="p">)</span>
</span></code></pre></div> <p>è¯¥æ„é€ æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª OutputStream å¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºå°†å¯¹è±¡äºŒè¿›åˆ¶æµå†™å…¥åˆ°æŒ‡å®šçš„ OutputStream ä¸­ã€‚</p> <p>ç¨‹åºé€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤æ¥åºåˆ—åŒ–å¯¹è±¡ï¼š</p> <ol> <li> <p>åˆ›å»ºä¸€ä¸ª ObjectOutputStream å¯¹è±¡ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-172-1"><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a><span class="c1">// åˆ›å»ºä¸ª ObjectOutputStream è¾“å‡ºæµ</span>
</span><span id="__span-172-2"><a id="__codelineno-172-2" name="__codelineno-172-2" href="#__codelineno-172-2"></a><span class="n">ObjectOutputStream</span><span class="w"> </span><span class="n">oos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectOutputStream</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">"object.txt"</span><span class="p">));</span>
</span></code></pre></div> </li> <li> <p>è°ƒç”¨ ObjectOutputStream å¯¹è±¡çš„ writeObject() æ–¹æ³•è¾“å‡ºå¯åºåˆ—åŒ–å¯¹è±¡ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-173-1"><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a><span class="c1">// å°†ä¸€ä¸ª Person å¯¹è±¡è¾“å‡ºåˆ°è¾“å‡ºæµä¸­</span>
</span><span id="__span-173-2"><a id="__codelineno-173-2" name="__codelineno-173-2" href="#__codelineno-173-2"></a><span class="n">oos</span><span class="p">.</span><span class="na">writerObject</span><span class="p">(</span><span class="n">per</span><span class="p">);</span>
</span></code></pre></div> </li> </ol> <p>ä¸‹é¢ç¨‹åºå®šä¹‰äº†ä¸€ä¸ª Person ç±»ï¼Œè¿™ä¸ª Person ç±»å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ Java ç±»ï¼Œåªæ˜¯å®ç°äº† Serializable æ¥å£ï¼Œè¯¥æ¥å£è¡¨ç¤ºè¯¥ç±»çš„å¯¹è±¡æ˜¯å¯åºåˆ—åŒ–çš„ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-174-1"><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span>
</span><span id="__span-174-2"><a id="__codelineno-174-2" name="__codelineno-174-2" href="#__codelineno-174-2"></a>
</span><span id="__span-174-3"><a id="__codelineno-174-3" name="__codelineno-174-3" href="#__codelineno-174-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Person</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-174-4"><a id="__codelineno-174-4" name="__codelineno-174-4" href="#__codelineno-174-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-174-5"><a id="__codelineno-174-5" name="__codelineno-174-5" href="#__codelineno-174-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
</span><span id="__span-174-6"><a id="__codelineno-174-6" name="__codelineno-174-6" href="#__codelineno-174-6"></a><span class="w">    </span><span class="c1">// æ³¨æ„æ­¤å¤„æ²¡æœ‰æä¾›æ— å‚æ•°çš„æ„é€ å™¨</span>
</span><span id="__span-174-7"><a id="__codelineno-174-7" name="__codelineno-174-7" href="#__codelineno-174-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Person</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-174-8"><a id="__codelineno-174-8" name="__codelineno-174-8" href="#__codelineno-174-8"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æœ‰å‚æ•°çš„æ„é€ å™¨"</span><span class="p">);</span>
</span><span id="__span-174-9"><a id="__codelineno-174-9" name="__codelineno-174-9" href="#__codelineno-174-9"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-174-10"><a id="__codelineno-174-10" name="__codelineno-174-10" href="#__codelineno-174-10"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
</span><span id="__span-174-11"><a id="__codelineno-174-11" name="__codelineno-174-11" href="#__codelineno-174-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-174-12"><a id="__codelineno-174-12" name="__codelineno-174-12" href="#__codelineno-174-12"></a><span class="w">    </span><span class="c1">// çœç•¥ name å’Œ ageçš„setterå’Œgetteræ–¹æ³•</span>
</span><span id="__span-174-13"><a id="__codelineno-174-13" name="__codelineno-174-13" href="#__codelineno-174-13"></a><span class="w">    </span><span class="p">...</span>
</span><span id="__span-174-14"><a id="__codelineno-174-14" name="__codelineno-174-14" href="#__codelineno-174-14"></a><span class="p">}</span>
</span></code></pre></div> <p>æ³¨æ„ï¼šPerson ç±»çš„ä¸¤ä¸ªæˆå‘˜å˜é‡åˆ†åˆ«æ˜¯ String ç±»å‹å’Œ int ç±»å‹çš„ã€‚å¦‚æœæŸä¸ªç±»çš„æˆå‘˜å˜é‡çš„ç±»å‹ä¸æ˜¯åŸºæœ¬ç±»å‹æˆ– String ç±»å‹ï¼Œè€Œæ˜¯å¦ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨ç±»å‹å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå¦åˆ™æ‹¥æœ‰è¯¥ç±»å‹æˆå‘˜å˜é‡çš„ç±»ä¹Ÿæ˜¯ä¸å¯åºåˆ—åŒ–çš„ã€‚</p> <p>ä¸‹é¢ç¨‹åºä½¿ç”¨ ObjectOutputStream å°†ä¸€ä¸ª Person å¯¹è±¡å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-175-1"><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WriteObject</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-175-2"><a id="__codelineno-175-2" name="__codelineno-175-2" href="#__codelineno-175-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-175-3"><a id="__codelineno-175-3" name="__codelineno-175-3" href="#__codelineno-175-3"></a><span class="w">        </span><span class="c1">// åˆ›å»ºä¸€ä¸ª ObjectOutputStream è¾“å‡ºæµ</span>
</span><span id="__span-175-4"><a id="__codelineno-175-4" name="__codelineno-175-4" href="#__codelineno-175-4"></a><span class="w">        </span><span class="n">ObjectOutputStream</span><span class="w"> </span><span class="n">oos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectOutputStream</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">"object.txt"</span><span class="p">));</span>
</span><span id="__span-175-5"><a id="__codelineno-175-5" name="__codelineno-175-5" href="#__codelineno-175-5"></a><span class="w">        </span><span class="n">Person</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="p">(</span><span class="s">"Cè¯­è¨€ä¸­æ–‡ç½‘"</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span>
</span><span id="__span-175-6"><a id="__codelineno-175-6" name="__codelineno-175-6" href="#__codelineno-175-6"></a><span class="w">        </span><span class="c1">// å°† Perå¯¹è±¡å†™å…¥è¾“å‡ºæµ</span>
</span><span id="__span-175-7"><a id="__codelineno-175-7" name="__codelineno-175-7" href="#__codelineno-175-7"></a><span class="w">        </span><span class="n">oos</span><span class="p">.</span><span class="na">writeObject</span><span class="p">(</span><span class="n">per</span><span class="p">);</span>
</span><span id="__span-175-8"><a id="__codelineno-175-8" name="__codelineno-175-8" href="#__codelineno-175-8"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ç¨‹åºä¸­çš„ç¬¬ 4 è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ª ObjectOutputStream è¾“å‡ºæµï¼Œè¿™ä¸ª ObjectOutputStream è¾“å‡ºæµå»ºç«‹åœ¨ä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµçš„åŸºç¡€ä¹‹ä¸Šã€‚ç¨‹åºç¬¬ 7 è¡Œä»£ç ä½¿ç”¨ writeObject() æ–¹æ³•å°†ä¸€ä¸ª Person å¯¹è±¡å†™å…¥è¾“å‡ºæµã€‚è¿è¡Œä¸Šé¢ç¨‹åºï¼Œå°†ä¼šçœ‹åˆ°ç”Ÿæˆäº†ä¸€ä¸ª object.txt æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶çš„å†…å®¹å°±æ˜¯ Person å¯¹è±¡ã€‚</p> <h4 id="1292ååºåˆ—åŒ–">12.9.2ã€ååºåˆ—åŒ–<a class="headerlink" href="#1292ååºåˆ—åŒ–" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>ObjectInputStream ç±»ç»§æ‰¿äº† InputStream ç±»ï¼ŒåŒæ—¶å®ç°äº† ObjectInput æ¥å£ï¼Œæä¾›äº†å°†å¯¹è±¡åºåˆ—åŒ–å¹¶ä»æµä¸­è¯»å–å‡ºæ¥çš„åŠŸèƒ½ã€‚è¯¥ç±»çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-176-1"><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a><span class="kd">public</span><span class="w"> </span><span class="nf">ObjectInputStream</span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">out</span><span class="p">)</span>
</span></code></pre></div> <p>è¯¥æ„é€ æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª InputStream å¯¹è±¡ï¼Œç”¨æ¥åˆ›å»ºä»æŒ‡å®š InputStream è¯»å–çš„ ObjectInputStreamã€‚</p> <p>ååºåˆ—åŒ–çš„æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p> <ol> <li> <p>åˆ›å»ºä¸€ä¸ª ObjectInputStream è¾“å…¥æµï¼Œè¿™ä¸ªè¾“å…¥æµæ˜¯ä¸€ä¸ªå¤„ç†æµï¼Œæ‰€ä»¥å¿…é¡»å»ºç«‹åœ¨å…¶ä»–èŠ‚ç‚¹æµçš„åŸºç¡€ä¹‹ä¸Šã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-177-1"><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a><span class="c1">// åˆ›å»ºä¸€ä¸ªObjectInputStreamè¾“å…¥æµ</span>
</span><span id="__span-177-2"><a id="__codelineno-177-2" name="__codelineno-177-2" href="#__codelineno-177-2"></a><span class="n">ObjectInputStream</span><span class="w"> </span><span class="n">ois</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectInputStream</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="w"> </span><span class="p">(</span><span class="s">"object. txt"</span><span class="p">));</span>
</span></code></pre></div> </li> <li> <p>è°ƒç”¨ ObjectInputStream å¯¹è±¡çš„ readObject() æ–¹æ³•è¯»å–æµä¸­çš„å¯¹è±¡ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª Object ç±»å‹çš„ Java å¯¹è±¡ï¼Œå¦‚æœç¨‹åºçŸ¥é“è¯¥ Java å¯¹è±¡çš„ç±»å‹ï¼Œåˆ™å¯ä»¥å°†è¯¥å¯¹è±¡å¼ºåˆ¶ç±»å‹è½¬æ¢æˆå…¶çœŸå®çš„ç±»å‹ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-178-1"><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a><span class="c1">// ä»è¾“å…¥æµä¸­è¯»å–ä¸€ä¸ªJavaå¯¹è±¡ï¼Œå¹¶å°†å…¶å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºPersonç±»</span>
</span><span id="__span-178-2"><a id="__codelineno-178-2" name="__codelineno-178-2" href="#__codelineno-178-2"></a><span class="n">Person</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Person</span><span class="p">)</span><span class="n">ois</span><span class="p">.</span><span class="na">readObject</span><span class="p">();</span>
</span></code></pre></div> </li> </ol> <p>ä¸‹é¢ç¨‹åºæ˜¯ä»ä¾‹ 1 ä¸­ç”Ÿæˆçš„ object.txt æ–‡ä»¶æ¥è¯»å– Person å¯¹è±¡çš„æ­¥éª¤ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-179-1"><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ReadObject</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-179-2"><a id="__codelineno-179-2" name="__codelineno-179-2" href="#__codelineno-179-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-179-3"><a id="__codelineno-179-3" name="__codelineno-179-3" href="#__codelineno-179-3"></a><span class="w">        </span><span class="c1">// åˆ›å»ºä¸€ä¸ªObjectInputStreamè¾“å…¥æµ</span>
</span><span id="__span-179-4"><a id="__codelineno-179-4" name="__codelineno-179-4" href="#__codelineno-179-4"></a><span class="w">        </span><span class="n">ObjectInputStream</span><span class="w"> </span><span class="n">ois</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectInputStream</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">"object.txt"</span><span class="p">));</span>
</span><span id="__span-179-5"><a id="__codelineno-179-5" name="__codelineno-179-5" href="#__codelineno-179-5"></a><span class="w">        </span><span class="c1">// ä»è¾“å…¥æµä¸­è¯»å–ä¸€ä¸ª Javaå¯¹è±¡ï¼Œå¹¶å°†å…¶å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºPersonç±»</span>
</span><span id="__span-179-6"><a id="__codelineno-179-6" name="__codelineno-179-6" href="#__codelineno-179-6"></a><span class="w">        </span><span class="n">Person</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Person</span><span class="p">)</span><span class="w"> </span><span class="n">ois</span><span class="p">.</span><span class="na">readObject</span><span class="p">();</span>
</span><span id="__span-179-7"><a id="__codelineno-179-7" name="__codelineno-179-7" href="#__codelineno-179-7"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"åå­—ä¸ºï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"\nå¹´é¾„ä¸ºï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="na">getAge</span><span class="p">());</span>
</span><span id="__span-179-8"><a id="__codelineno-179-8" name="__codelineno-179-8" href="#__codelineno-179-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-179-9"><a id="__codelineno-179-9" name="__codelineno-179-9" href="#__codelineno-179-9"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ç¨‹åºä¸­ç¬¬ 4 è¡Œç²—ä½“å­—ä»£ç å°†ä¸€ä¸ªæ–‡ä»¶è¾“å…¥æµåŒ…è£…æˆ ObjectInputStream è¾“å…¥æµï¼Œç¬¬ 6 è¡Œä»£ç ä½¿ç”¨ readObject() è¯»å–äº†æ–‡ä»¶ä¸­çš„ Java å¯¹è±¡ï¼Œè¿™å°±å®Œæˆäº†ååºåˆ—åŒ–è¿‡ç¨‹ã€‚</p> <p>ååºåˆ—åŒ–è¯»å–çš„ä»…ä»…æ˜¯ Java å¯¹è±¡çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ Java ç±»ï¼Œå› æ­¤é‡‡ç”¨ååºåˆ—åŒ–æ¢å¤ Java å¯¹è±¡æ—¶ï¼Œå¿…é¡»æä¾›è¯¥ Java å¯¹è±¡æ‰€å±ç±»çš„ class æ–‡ä»¶ï¼Œå¦åˆ™å°†ä¼šå¼•å‘ ClassNotFoundException å¼‚å¸¸ã€‚</p> <p>Person ç±»åªæœ‰ä¸€ä¸ªæœ‰å‚æ•°çš„æ„é€ å™¨ï¼Œæ²¡æœ‰æ— å‚æ•°çš„æ„é€ å™¨ï¼Œè€Œä¸”è¯¥æ„é€ å™¨å†…æœ‰ä¸€ä¸ªæ™®é€šçš„æ‰“å°è¯­å¥ã€‚å½“ååºåˆ—åŒ–è¯»å– Java å¯¹è±¡æ—¶ï¼Œå¹¶æ²¡æœ‰çœ‹åˆ°ç¨‹åºè°ƒç”¨è¯¥æ„é€ å™¨ï¼Œè¿™è¡¨æ˜ååºåˆ—åŒ–æœºåˆ¶æ— é¡»é€šè¿‡æ„é€ å™¨æ¥åˆå§‹åŒ– Java å¯¹è±¡ã€‚</p> <p>å¦‚æœä½¿ç”¨åºåˆ—åŒ–æœºåˆ¶å‘æ–‡ä»¶ä¸­å†™å…¥äº†å¤šä¸ª Java å¯¹è±¡ï¼Œä½¿ç”¨ååºåˆ—åŒ–æœºåˆ¶æ¢å¤å¯¹è±¡æ—¶å¿…é¡»æŒ‰å®é™…å†™å…¥çš„é¡ºåºè¯»å–ã€‚</p> <p>å½“ä¸€ä¸ªå¯åºåˆ—åŒ–ç±»æœ‰å¤šä¸ªçˆ¶ç±»æ—¶ï¼ˆåŒ…æ‹¬ç›´æ¥çˆ¶ç±»å’Œé—´æ¥çˆ¶ç±»ï¼‰ï¼Œè¿™äº›çˆ¶ç±»è¦ä¹ˆæœ‰æ— å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œè¦ä¹ˆä¹Ÿæ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå¦åˆ™ååºåˆ—åŒ–æ—¶å°†æŠ›å‡º InvalidClassException å¼‚å¸¸ã€‚å¦‚æœçˆ¶ç±»æ˜¯ä¸å¯åºåˆ—åŒ–çš„ï¼Œåªæ˜¯å¸¦æœ‰æ— å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œåˆ™è¯¥çˆ¶ç±»ä¸­å®šä¹‰çš„æˆå‘˜å˜é‡å€¼ä¸ä¼šåºåˆ—åŒ–åˆ° IO æµä¸­ã€‚</p> <hr> <p><strong>Javaåºåˆ—åŒ–ç¼–å·</strong></p> <p>Java åºåˆ—åŒ–æœºåˆ¶æ˜¯é€šè¿‡ç±»çš„åºåˆ—åŒ–ç¼–å·ï¼ˆserialVersionUIDï¼‰æ¥éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§çš„ã€‚åœ¨ååºåˆ—åŒ–æ—¶ï¼ŒJVM ä¼šæŠŠä¼ æ¥å­—èŠ‚æµä¸­çš„åºåˆ—åŒ–ç¼–å·å’Œæœ¬åœ°ç›¸åº”å®ä½“ç±»çš„åºåˆ—åŒ–ç¼–å·è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒå°±è®¤ä¸ºä¸€è‡´ï¼Œå¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦åˆ™ä¼šæŠ›å‡º InvalidCastException å¼‚å¸¸ã€‚</p> <p>åºåˆ—åŒ–ç¼–å·æœ‰ä¸¤ç§æ˜¾å¼ç”Ÿæˆæ–¹å¼ï¼š</p> <ol> <li>é»˜è®¤çš„1Lï¼Œæ¯”å¦‚ï¼šprivate static final long serialVersionUID = 1Lã€‚</li> <li>æ ¹æ®ç±»åã€æ¥å£åã€æˆå‘˜æ–¹æ³•åŠå±æ€§ç­‰æ¥ç”Ÿæˆä¸€ä¸ª 64 ä½çš„å“ˆå¸Œå­—æ®µã€‚</li> </ol> <p>å½“å®ç° Serializable æ¥å£çš„å¯¹è±¡æ²¡æœ‰æ˜¾å¼å®šä¹‰ä¸€ä¸ªåºåˆ—åŒ–ç¼–å·æ—¶ï¼ŒJava åºåˆ—åŒ–ä¼šæ ¹æ®ç¼–è¯‘çš„ Class è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåºåˆ—åŒ–ç¼–å·ï¼Œè¿™ç§æƒ…å†µä¸‹åªè¦ class æ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œåºåˆ—åŒ–å·å°±ä¼šæ”¹å˜ï¼Œå¦åˆ™ä¸€ç›´ä¸å˜ã€‚</p> <hr> <p><strong>transientå…³é”®å­—</strong></p> <p>å¦‚æœä¸å¸Œæœ›ç±»ä¸­çš„å±æ€§è¢«åºåˆ—åŒ–ï¼Œå¯ä»¥åœ¨å£°æ˜å±æ€§ä¹‹å‰åŠ ä¸Š<strong>transient</strong>å…³é”®å­—ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸‹é¢çš„ä»£ç ä¿®æ”¹è‡ªå‰é¢æ‰€ç”¨åˆ°çš„Person.javaç¨‹åºï¼Œåœ¨å£°æ˜å±æ€§æ—¶ï¼Œå‰é¢å¤šåŠ äº†ä¸€ä¸ªtransientå…³é”®å­—ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-180-1"><a id="__codelineno-180-1" name="__codelineno-180-1" href="#__codelineno-180-1"></a><span class="kd">private</span><span class="w"> </span><span class="kd">transient</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-180-2"><a id="__codelineno-180-2" name="__codelineno-180-2" href="#__codelineno-180-2"></a><span class="kd">private</span><span class="w"> </span><span class="kd">transient</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
</span></code></pre></div> <hr> <p><strong>åºåˆ—åŒ–çš„å—æ§å’ŒåŠ å¼º</strong></p> <p>åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹å…¶å®æ˜¯<strong>æœ‰æ¼æ´çš„</strong>ï¼Œå› ä¸ºä»åºåˆ—åŒ–åˆ°ååºåˆ—åŒ–æ˜¯æœ‰ä¸­é—´è¿‡ç¨‹çš„ï¼Œå¦‚æœè¢«åˆ«äººæ‹¿åˆ°äº†ä¸­é—´å­—èŠ‚æµï¼Œç„¶ååŠ ä»¥ä¼ªé€ æˆ–è€…ç¯¡æ”¹ï¼Œé‚£ååºåˆ—åŒ–å‡ºæ¥çš„å¯¹è±¡å°±ä¼šæœ‰ä¸€å®šé£é™©äº†ã€‚</p> <p>æ¯•ç«Ÿååºåˆ—åŒ–ä¹Ÿç›¸å½“äºä¸€ç§ <strong>â€œéšå¼çš„â€å¯¹è±¡æ„é€ </strong> ï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›åœ¨ååºåˆ—åŒ–æ—¶ï¼Œè¿›è¡Œ<strong>å—æ§çš„</strong>å¯¹è±¡ååºåˆ—åŒ–åŠ¨ä½œã€‚</p> <p>é‚£æ€ä¹ˆä¸ªå—æ§æ³•å‘¢ï¼Ÿ</p> <p><strong>ç­”æ¡ˆå°±æ˜¯ï¼š</strong> è‡ªè¡Œç¼–å†™<strong><code>readObject()</code></strong>å‡½æ•°ï¼Œç”¨äºå¯¹è±¡çš„ååºåˆ—åŒ–æ„é€ ï¼Œä»è€Œæä¾›çº¦æŸæ€§ã€‚æ—¢ç„¶è‡ªè¡Œç¼–å†™<code>readObject()</code>å‡½æ•°ï¼Œé‚£å°±å¯ä»¥åšå¾ˆå¤šå¯æ§çš„äº‹æƒ…ï¼šæ¯”å¦‚å„ç§åˆ¤æ–­å·¥ä½œã€‚</p> <h3 id="1210propertiesæ–‡ä»¶è§£æ">12.10ã€Propertiesæ–‡ä»¶è§£æ<a class="headerlink" href="#1210propertiesæ–‡ä»¶è§£æ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ç¼–å†™ä¸€ä¸ªè§£æPropertiesæ–‡ä»¶çš„ç±»ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-181-1"><a id="__codelineno-181-1" name="__codelineno-181-1" href="#__codelineno-181-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PropertiesDemo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-181-2"><a id="__codelineno-181-2" name="__codelineno-181-2" href="#__codelineno-181-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-181-3"><a id="__codelineno-181-3" name="__codelineno-181-3" href="#__codelineno-181-3"></a><span class="w">        </span><span class="n">Properties</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
</span><span id="__span-181-4"><a id="__codelineno-181-4" name="__codelineno-181-4" href="#__codelineno-181-4"></a><span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">"jdbc.properties"</span><span class="p">);</span>
</span><span id="__span-181-5"><a id="__codelineno-181-5" name="__codelineno-181-5" href="#__codelineno-181-5"></a><span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
</span><span id="__span-181-6"><a id="__codelineno-181-6" name="__codelineno-181-6" href="#__codelineno-181-6"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">"driver"</span><span class="p">);</span>
</span><span id="__span-181-7"><a id="__codelineno-181-7" name="__codelineno-181-7" href="#__codelineno-181-7"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">driver</span><span class="p">);</span>
</span><span id="__span-181-8"><a id="__codelineno-181-8" name="__codelineno-181-8" href="#__codelineno-181-8"></a><span class="w">        </span><span class="n">file</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</span><span id="__span-181-9"><a id="__codelineno-181-9" name="__codelineno-181-9" href="#__codelineno-181-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-181-10"><a id="__codelineno-181-10" name="__codelineno-181-10" href="#__codelineno-181-10"></a><span class="p">}</span>
</span></code></pre></div> <p>åœ¨è¯¥å·¥ç¨‹æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªjdbc.propertiesæ–‡ä»¶</p> <div class="language-properties highlight"><span class="filename">Properties</span><pre><span></span><code><span id="__span-182-1"><a id="__codelineno-182-1" name="__codelineno-182-1" href="#__codelineno-182-1"></a><span class="na">driver</span><span class="o">=</span><span class="s">com.mysql.cj.jdbc.Drvier</span>
</span></code></pre></div> <p>è¿è¡Œç»“æœä¸ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-183-1"><a id="__codelineno-183-1" name="__codelineno-183-1" href="#__codelineno-183-1"></a>com.mysql.cj.jdbc.Drvier
</span></code></pre></div> <h4 id="12101ä½¿ç”¨classgetresourceasstreamfileè·å–propertiesæ–‡ä»¶">12.10.1ã€ä½¿ç”¨class.getResourceAsStream(file)è·å–propertiesæ–‡ä»¶<a class="headerlink" href="#12101ä½¿ç”¨classgetresourceasstreamfileè·å–propertiesæ–‡ä»¶" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-184-1"><a id="__codelineno-184-1" name="__codelineno-184-1" href="#__codelineno-184-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PropertiesDemo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-184-2"><a id="__codelineno-184-2" name="__codelineno-184-2" href="#__codelineno-184-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-184-3"><a id="__codelineno-184-3" name="__codelineno-184-3" href="#__codelineno-184-3"></a><span class="w">        </span><span class="n">Properties</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
</span><span id="__span-184-4"><a id="__codelineno-184-4" name="__codelineno-184-4" href="#__codelineno-184-4"></a><span class="w">        </span><span class="c1">// propertiesæ–‡ä»¶åœ¨PropertiesDemo.javaçš„åŒ…ä¸‹</span>
</span><span id="__span-184-5"><a id="__codelineno-184-5" name="__codelineno-184-5" href="#__codelineno-184-5"></a><span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="n">PropertiesDemo</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="s">"jdbc.properties"</span><span class="p">));</span>
</span><span id="__span-184-6"><a id="__codelineno-184-6" name="__codelineno-184-6" href="#__codelineno-184-6"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">"driver"</span><span class="p">);</span>
</span><span id="__span-184-7"><a id="__codelineno-184-7" name="__codelineno-184-7" href="#__codelineno-184-7"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">driver</span><span class="p">);</span>
</span><span id="__span-184-8"><a id="__codelineno-184-8" name="__codelineno-184-8" href="#__codelineno-184-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-184-9"><a id="__codelineno-184-9" name="__codelineno-184-9" href="#__codelineno-184-9"></a><span class="p">}</span>
</span></code></pre></div> <h4 id="12102classgetclassloadergetresourceasstreamfileå’ŒclassgetresourceasstreamfileåŒºåˆ«">12.10.2ã€class.getClassLoader().getResourceAsStream(file)å’Œclass.getResourceAsStream(file)åŒºåˆ«<a class="headerlink" href="#12102classgetclassloadergetresourceasstreamfileå’ŒclassgetresourceasstreamfileåŒºåˆ«" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>å…±åŒç‚¹ï¼šéƒ½æ˜¯å®ç°è·å–åœ¨classpathè·¯å¾„ä¸‹çš„èµ„æºæ–‡ä»¶çš„è¾“å…¥æµã€‚</p> <p>ä¸ºä»€ä¹ˆæ˜¯classpathè€Œä¸æ˜¯srcï¼Œå› ä¸ºå½“webé¡¹ç›®è¿è¡Œæ—¶,IDEç¼–è¯‘å™¨ä¼šæŠŠsrcä¸‹çš„ä¸€äº›èµ„æºæ–‡ä»¶ç§»è‡³WEB-INF/classesï¼ŒclassPathç›®å½•å…¶å®å°±æ˜¯è¿™ä¸ªclassesç›®å½•ã€‚è¿™ä¸ªç›®å½•ä¸‹æ”¾çš„ä¸€èˆ¬æ˜¯webé¡¹ç›®è¿è¡Œæ—¶çš„classæ–‡ä»¶ã€èµ„æºæ–‡ä»¶(xml,properties...)ï¼›</p> <hr> <p><strong>class.getClassLoader().getResourceAsStream(file)</strong></p> <p>path ä¸ä»¥ '/' å¼€å¤´æ—¶é»˜è®¤æ˜¯ä»æ­¤ç±»æ‰€åœ¨çš„åŒ…ä¸‹å–èµ„æºï¼Œä»¥ '/' å¼€å¤´åˆ™æ˜¯ä»ClassPathæ ¹ä¸‹è·å–ã€‚å…¶åªæ˜¯é€šè¿‡pathæ„é€ ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œæœ€ç»ˆè¿˜æ˜¯ç”±ClassLoaderè·å–èµ„æºã€‚</p> <hr> <p><strong>Class.getClassLoader.getResourceAsStream(String path)</strong></p> <p>é»˜è®¤åˆ™æ˜¯ä»ClassPathæ ¹ä¸‹è·å–ï¼Œpathä¸èƒ½ä»¥ '/' å¼€å¤´ï¼Œæœ€ç»ˆæ˜¯ç”±ClassLoaderè·å–èµ„æºã€‚</p> <h3 id="1211ä½¿ç”¨printf-æ ¼å¼åŒ–è¾“å‡º">12.11ã€ä½¿ç”¨printf æ ¼å¼åŒ–è¾“å‡º<a class="headerlink" href="#1211ä½¿ç”¨printf-æ ¼å¼åŒ–è¾“å‡º" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-185-1"><a id="__codelineno-185-1" name="__codelineno-185-1" href="#__codelineno-185-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span>
</span><span id="__span-185-2"><a id="__codelineno-185-2" name="__codelineno-185-2" href="#__codelineno-185-2"></a>
</span><span id="__span-185-3"><a id="__codelineno-185-3" name="__codelineno-185-3" href="#__codelineno-185-3"></a><span class="cm">/**</span>
</span><span id="__span-185-4"><a id="__codelineno-185-4" name="__codelineno-185-4" href="#__codelineno-185-4"></a><span class="cm"> * ä½¿ç”¨printfè¾“å‡º</span>
</span><span id="__span-185-5"><a id="__codelineno-185-5" name="__codelineno-185-5" href="#__codelineno-185-5"></a><span class="cm"> */</span>
</span><span id="__span-185-6"><a id="__codelineno-185-6" name="__codelineno-185-6" href="#__codelineno-185-6"></a><span class="cm">/**å…³é”®æŠ€æœ¯ç‚¹</span>
</span><span id="__span-185-7"><a id="__codelineno-185-7" name="__codelineno-185-7" href="#__codelineno-185-7"></a><span class="cm"> * ä½¿ç”¨java.io.PrintStreamçš„printfæ–¹æ³•å®ç°Cé£æ ¼çš„è¾“å‡º</span>
</span><span id="__span-185-8"><a id="__codelineno-185-8" name="__codelineno-185-8" href="#__codelineno-185-8"></a><span class="cm"> * printf æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¾“å‡ºçš„æ ¼å¼,ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯å˜é•¿çš„,è¡¨ç¤ºå¾…è¾“å‡ºçš„æ•°æ®å¯¹è±¡</span>
</span><span id="__span-185-9"><a id="__codelineno-185-9" name="__codelineno-185-9" href="#__codelineno-185-9"></a><span class="cm"> */</span>
</span><span id="__span-185-10"><a id="__codelineno-185-10" name="__codelineno-185-10" href="#__codelineno-185-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Printf</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-185-11"><a id="__codelineno-185-11" name="__codelineno-185-11" href="#__codelineno-185-11"></a>
</span><span id="__span-185-12"><a id="__codelineno-185-12" name="__codelineno-185-12" href="#__codelineno-185-12"></a><span class="w">       </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-185-13"><a id="__codelineno-185-13" name="__codelineno-185-13" href="#__codelineno-185-13"></a><span class="w">              </span><span class="cm">/*** è¾“å‡ºå­—ç¬¦ä¸² ***/</span>
</span><span id="__span-185-14"><a id="__codelineno-185-14" name="__codelineno-185-14" href="#__codelineno-185-14"></a><span class="w">              </span><span class="c1">// %sè¡¨ç¤ºè¾“å‡ºå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯å°†åé¢çš„å­—ç¬¦ä¸²æ›¿æ¢æ¨¡å¼ä¸­çš„%s</span>
</span><span id="__span-185-15"><a id="__codelineno-185-15" name="__codelineno-185-15" href="#__codelineno-185-15"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Integer</span><span class="p">(</span><span class="mi">1212</span><span class="p">));</span>
</span><span id="__span-185-16"><a id="__codelineno-185-16" name="__codelineno-185-16" href="#__codelineno-185-16"></a><span class="w">              </span><span class="c1">// %nè¡¨ç¤ºæ¢è¡Œ</span>
</span><span id="__span-185-17"><a id="__codelineno-185-17" name="__codelineno-185-17" href="#__codelineno-185-17"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%s%n"</span><span class="p">,</span><span class="w"> </span><span class="s">"end line"</span><span class="p">);</span>
</span><span id="__span-185-18"><a id="__codelineno-185-18" name="__codelineno-185-18" href="#__codelineno-185-18"></a><span class="w">              </span><span class="c1">// è¿˜å¯ä»¥æ”¯æŒå¤šä¸ªå‚æ•°</span>
</span><span id="__span-185-19"><a id="__codelineno-185-19" name="__codelineno-185-19" href="#__codelineno-185-19"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%s = %s%n"</span><span class="p">,</span><span class="w"> </span><span class="s">"Name"</span><span class="p">,</span><span class="w"> </span><span class="s">"Zhangsan"</span><span class="p">);</span>
</span><span id="__span-185-20"><a id="__codelineno-185-20" name="__codelineno-185-20" href="#__codelineno-185-20"></a><span class="w">              </span><span class="c1">// %Så°†å­—ç¬¦ä¸²ä»¥å¤§å†™å½¢å¼è¾“å‡º</span>
</span><span id="__span-185-21"><a id="__codelineno-185-21" name="__codelineno-185-21" href="#__codelineno-185-21"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%S = %s%n"</span><span class="p">,</span><span class="w"> </span><span class="s">"Name"</span><span class="p">,</span><span class="w"> </span><span class="s">"Zhangsan"</span><span class="p">);</span>
</span><span id="__span-185-22"><a id="__codelineno-185-22" name="__codelineno-185-22" href="#__codelineno-185-22"></a><span class="w">              </span><span class="c1">// æ”¯æŒå¤šä¸ªå‚æ•°æ—¶ï¼Œå¯ä»¥åœ¨%sä¹‹é—´æ’å…¥å˜é‡ç¼–å·ï¼Œ1$è¡¨ç¤ºç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ3$è¡¨ç¤ºç¬¬3ä¸ªå­—ç¬¦ä¸²</span>
</span><span id="__span-185-23"><a id="__codelineno-185-23" name="__codelineno-185-23" href="#__codelineno-185-23"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$s = %3$s %2$s%n"</span><span class="p">,</span><span class="w"> </span><span class="s">"Name"</span><span class="p">,</span><span class="w"> </span><span class="s">"san"</span><span class="p">,</span><span class="w"> </span><span class="s">"Zhang"</span><span class="p">);</span>
</span><span id="__span-185-24"><a id="__codelineno-185-24" name="__codelineno-185-24" href="#__codelineno-185-24"></a>
</span><span id="__span-185-25"><a id="__codelineno-185-25" name="__codelineno-185-25" href="#__codelineno-185-25"></a><span class="w">              </span><span class="cm">/*** è¾“å‡ºbooleanç±»å‹ ***/</span>
</span><span id="__span-185-26"><a id="__codelineno-185-26" name="__codelineno-185-26" href="#__codelineno-185-26"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"true = %b; false = "</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
</span><span id="__span-185-27"><a id="__codelineno-185-27" name="__codelineno-185-27" href="#__codelineno-185-27"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%b%n"</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
</span><span id="__span-185-28"><a id="__codelineno-185-28" name="__codelineno-185-28" href="#__codelineno-185-28"></a>
</span><span id="__span-185-29"><a id="__codelineno-185-29" name="__codelineno-185-29" href="#__codelineno-185-29"></a><span class="w">              </span><span class="cm">/*** è¾“å‡ºæ•´æ•°ç±»å‹***/</span>
</span><span id="__span-185-30"><a id="__codelineno-185-30" name="__codelineno-185-30" href="#__codelineno-185-30"></a><span class="w">              </span><span class="n">Integer</span><span class="w"> </span><span class="n">iObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">342</span><span class="p">;</span>
</span><span id="__span-185-31"><a id="__codelineno-185-31" name="__codelineno-185-31" href="#__codelineno-185-31"></a><span class="w">              </span><span class="c1">// %dè¡¨ç¤ºå°†æ•´æ•°æ ¼å¼åŒ–ä¸º10è¿›åˆ¶æ•´æ•°</span>
</span><span id="__span-185-32"><a id="__codelineno-185-32" name="__codelineno-185-32" href="#__codelineno-185-32"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%d; %d; %d%n"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">2343L</span><span class="p">,</span><span class="w"> </span><span class="n">iObj</span><span class="p">);</span>
</span><span id="__span-185-33"><a id="__codelineno-185-33" name="__codelineno-185-33" href="#__codelineno-185-33"></a><span class="w">              </span><span class="c1">// %oè¡¨ç¤ºå°†æ•´æ•°æ ¼å¼åŒ–ä¸º8è¿›åˆ¶æ•´æ•°</span>
</span><span id="__span-185-34"><a id="__codelineno-185-34" name="__codelineno-185-34" href="#__codelineno-185-34"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%o; %o; %o%n"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">2343L</span><span class="p">,</span><span class="w"> </span><span class="n">iObj</span><span class="p">);</span>
</span><span id="__span-185-35"><a id="__codelineno-185-35" name="__codelineno-185-35" href="#__codelineno-185-35"></a><span class="w">              </span><span class="c1">// %xè¡¨ç¤ºå°†æ•´æ•°æ ¼å¼åŒ–ä¸º16è¿›åˆ¶æ•´æ•°</span>
</span><span id="__span-185-36"><a id="__codelineno-185-36" name="__codelineno-185-36" href="#__codelineno-185-36"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%x; %x; %x%n"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">2343L</span><span class="p">,</span><span class="w"> </span><span class="n">iObj</span><span class="p">);</span>
</span><span id="__span-185-37"><a id="__codelineno-185-37" name="__codelineno-185-37" href="#__codelineno-185-37"></a><span class="w">              </span><span class="c1">// %Xè¡¨ç¤ºå°†æ•´æ•°æ ¼å¼åŒ–ä¸º16è¿›åˆ¶æ•´æ•°ï¼Œå¹¶ä¸”å­—æ¯å˜æˆå¤§å†™å½¢å¼</span>
</span><span id="__span-185-38"><a id="__codelineno-185-38" name="__codelineno-185-38" href="#__codelineno-185-38"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%X; %X; %X%n"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">2343L</span><span class="p">,</span><span class="w"> </span><span class="n">iObj</span><span class="p">);</span>
</span><span id="__span-185-39"><a id="__codelineno-185-39" name="__codelineno-185-39" href="#__codelineno-185-39"></a>
</span><span id="__span-185-40"><a id="__codelineno-185-40" name="__codelineno-185-40" href="#__codelineno-185-40"></a><span class="w">              </span><span class="cm">/*** è¾“å‡ºæµ®ç‚¹ç±»å‹***/</span>
</span><span id="__span-185-41"><a id="__codelineno-185-41" name="__codelineno-185-41" href="#__codelineno-185-41"></a><span class="w">              </span><span class="n">Double</span><span class="w"> </span><span class="n">dObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">45.6d</span><span class="p">;</span>
</span><span id="__span-185-42"><a id="__codelineno-185-42" name="__codelineno-185-42" href="#__codelineno-185-42"></a><span class="w">              </span><span class="c1">// %eè¡¨ç¤ºä»¥ç§‘å­¦æŠ€æœ¯æ³•è¾“å‡ºæµ®ç‚¹æ•°</span>
</span><span id="__span-185-43"><a id="__codelineno-185-43" name="__codelineno-185-43" href="#__codelineno-185-43"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%e; %e; %e%n"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">756.403f</span><span class="p">,</span><span class="w"> </span><span class="mf">7464.232641d</span><span class="p">,</span><span class="w"> </span><span class="n">dObj</span><span class="p">);</span>
</span><span id="__span-185-44"><a id="__codelineno-185-44" name="__codelineno-185-44" href="#__codelineno-185-44"></a><span class="w">              </span><span class="c1">// %Eè¡¨ç¤ºä»¥ç§‘å­¦æŠ€æœ¯æ³•è¾“å‡ºæµ®ç‚¹æ•°ï¼Œå¹¶ä¸”ä¸ºå¤§å†™å½¢å¼            </span>
</span><span id="__span-185-45"><a id="__codelineno-185-45" name="__codelineno-185-45" href="#__codelineno-185-45"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%E; %E; %E%n"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">756.403f</span><span class="p">,</span><span class="w"> </span><span class="mf">7464.232641d</span><span class="p">,</span><span class="w"> </span><span class="n">dObj</span><span class="p">);</span>
</span><span id="__span-185-46"><a id="__codelineno-185-46" name="__codelineno-185-46" href="#__codelineno-185-46"></a><span class="w">              </span><span class="c1">// %fè¡¨ç¤ºä»¥åè¿›åˆ¶æ ¼å¼åŒ–è¾“å‡ºæµ®ç‚¹æ•°</span>
</span><span id="__span-185-47"><a id="__codelineno-185-47" name="__codelineno-185-47" href="#__codelineno-185-47"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%f; %f; %f%n"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">756.403f</span><span class="p">,</span><span class="w"> </span><span class="mf">7464.232641d</span><span class="p">,</span><span class="w"> </span><span class="n">dObj</span><span class="p">);</span>
</span><span id="__span-185-48"><a id="__codelineno-185-48" name="__codelineno-185-48" href="#__codelineno-185-48"></a><span class="w">              </span><span class="c1">// è¿˜å¯ä»¥é™åˆ¶å°æ•°ç‚¹åçš„ä½æ•°</span>
</span><span id="__span-185-49"><a id="__codelineno-185-49" name="__codelineno-185-49" href="#__codelineno-185-49"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%.1f; %.3f; %f%n"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">756.403f</span><span class="p">,</span><span class="w"> </span><span class="mf">7464.232641d</span><span class="p">,</span><span class="w"> </span><span class="n">dObj</span><span class="p">);</span>
</span><span id="__span-185-50"><a id="__codelineno-185-50" name="__codelineno-185-50" href="#__codelineno-185-50"></a>
</span><span id="__span-185-51"><a id="__codelineno-185-51" name="__codelineno-185-51" href="#__codelineno-185-51"></a><span class="w">              </span><span class="cm">/*** è¾“å‡ºæ—¥æœŸç±»å‹***/</span>
</span><span id="__span-185-52"><a id="__codelineno-185-52" name="__codelineno-185-52" href="#__codelineno-185-52"></a><span class="w">              </span><span class="c1">// %tè¡¨ç¤ºæ ¼å¼åŒ–æ—¥æœŸæ—¶é—´ç±»å‹ï¼Œ%Tæ˜¯æ—¶é—´æ—¥æœŸçš„å¤§å†™å½¢å¼ï¼Œåœ¨%tä¹‹åç”¨ç‰¹å®šçš„å­—æ¯è¡¨ç¤ºä¸åŒçš„è¾“å‡ºæ ¼å¼</span>
</span><span id="__span-185-53"><a id="__codelineno-185-53" name="__codelineno-185-53" href="#__codelineno-185-53"></a><span class="w">              </span><span class="n">Date</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">();</span>
</span><span id="__span-185-54"><a id="__codelineno-185-54" name="__codelineno-185-54" href="#__codelineno-185-54"></a><span class="w">              </span><span class="kt">long</span><span class="w"> </span><span class="n">dataL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">date</span><span class="p">.</span><span class="na">getTime</span><span class="p">();</span>
</span><span id="__span-185-55"><a id="__codelineno-185-55" name="__codelineno-185-55" href="#__codelineno-185-55"></a><span class="w">              </span><span class="c1">// æ ¼å¼åŒ–å¹´æœˆæ—¥</span>
</span><span id="__span-185-56"><a id="__codelineno-185-56" name="__codelineno-185-56" href="#__codelineno-185-56"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨yè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„å¹´ä»½ï¼ˆ2ä½æ•°çš„å¹´ï¼Œå¦‚99ï¼‰</span>
</span><span id="__span-185-57"><a id="__codelineno-185-57" name="__codelineno-185-57" href="#__codelineno-185-57"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨mè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æœˆä»½ï¼Œ%tä¹‹åç”¨dè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æ—¥å·</span>
</span><span id="__span-185-58"><a id="__codelineno-185-58" name="__codelineno-185-58" href="#__codelineno-185-58"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$ty-%1$tm-%1$td; %2$ty-%2$tm-%2$td%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">dataL</span><span class="p">);</span>
</span><span id="__span-185-59"><a id="__codelineno-185-59" name="__codelineno-185-59" href="#__codelineno-185-59"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨Yè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„å¹´ä»½ï¼ˆ4ä½æ•°çš„å¹´ï¼‰ï¼Œ</span>
</span><span id="__span-185-60"><a id="__codelineno-185-60" name="__codelineno-185-60" href="#__codelineno-185-60"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨Bè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æœˆä»½çš„å®Œæ•´åï¼Œ %tä¹‹åç”¨bè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æœˆä»½çš„ç®€ç§°</span>
</span><span id="__span-185-61"><a id="__codelineno-185-61" name="__codelineno-185-61" href="#__codelineno-185-61"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tY-%1$tB-%1$td; %2$tY-%2$tb-%2$td%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">dataL</span><span class="p">);</span>
</span><span id="__span-185-62"><a id="__codelineno-185-62" name="__codelineno-185-62" href="#__codelineno-185-62"></a>
</span><span id="__span-185-63"><a id="__codelineno-185-63" name="__codelineno-185-63" href="#__codelineno-185-63"></a><span class="w">              </span><span class="c1">// ä»¥ä¸‹æ˜¯å¸¸è§çš„æ—¥æœŸç»„åˆ</span>
</span><span id="__span-185-64"><a id="__codelineno-185-64" name="__codelineno-185-64" href="#__codelineno-185-64"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨Dè¡¨ç¤ºä»¥ "%tm/%td/%ty"æ ¼å¼åŒ–æ—¥æœŸ</span>
</span><span id="__span-185-65"><a id="__codelineno-185-65" name="__codelineno-185-65" href="#__codelineno-185-65"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tD%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span>
</span><span id="__span-185-66"><a id="__codelineno-185-66" name="__codelineno-185-66" href="#__codelineno-185-66"></a><span class="w">              </span><span class="c1">//%tä¹‹åç”¨Fè¡¨ç¤ºä»¥"%tY-%tm-%td"æ ¼å¼åŒ–æ—¥æœŸ</span>
</span><span id="__span-185-67"><a id="__codelineno-185-67" name="__codelineno-185-67" href="#__codelineno-185-67"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tF%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span>
</span><span id="__span-185-68"><a id="__codelineno-185-68" name="__codelineno-185-68" href="#__codelineno-185-68"></a>
</span><span id="__span-185-69"><a id="__codelineno-185-69" name="__codelineno-185-69" href="#__codelineno-185-69"></a><span class="w">              </span><span class="cm">/*** è¾“å‡ºæ—¶é—´ç±»å‹***/</span>
</span><span id="__span-185-70"><a id="__codelineno-185-70" name="__codelineno-185-70" href="#__codelineno-185-70"></a><span class="w">              </span><span class="c1">// è¾“å‡ºæ—¶åˆ†ç§’</span>
</span><span id="__span-185-71"><a id="__codelineno-185-71" name="__codelineno-185-71" href="#__codelineno-185-71"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨Hè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„æ—¶ï¼ˆ24è¿›åˆ¶ï¼‰ï¼Œ%tä¹‹åç”¨Iè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„æ—¶ï¼ˆ12è¿›åˆ¶ï¼‰ï¼Œ</span>
</span><span id="__span-185-72"><a id="__codelineno-185-72" name="__codelineno-185-72" href="#__codelineno-185-72"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨Mè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„åˆ†ï¼Œ%tä¹‹åç”¨Sè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„ç§’</span>
</span><span id="__span-185-73"><a id="__codelineno-185-73" name="__codelineno-185-73" href="#__codelineno-185-73"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tH:%1$tM:%1$tS; %2$tI:%2$tM:%2$tS%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">dataL</span><span class="p">);</span>
</span><span id="__span-185-74"><a id="__codelineno-185-74" name="__codelineno-185-74" href="#__codelineno-185-74"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨Lè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„ç§’ä¸­çš„æ¯«ç§’</span>
</span><span id="__span-185-75"><a id="__codelineno-185-75" name="__codelineno-185-75" href="#__codelineno-185-75"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tH:%1$tM:%1$tS %1$tL%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span>
</span><span id="__span-185-76"><a id="__codelineno-185-76" name="__codelineno-185-76" href="#__codelineno-185-76"></a><span class="w">              </span><span class="c1">// %tä¹‹åpè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„ä¸Šåˆæˆ–ä¸‹åˆä¿¡æ¯</span>
</span><span id="__span-185-77"><a id="__codelineno-185-77" name="__codelineno-185-77" href="#__codelineno-185-77"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tH:%1$tM:%1$tS %1$tL %1$tp%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span>
</span><span id="__span-185-78"><a id="__codelineno-185-78" name="__codelineno-185-78" href="#__codelineno-185-78"></a>
</span><span id="__span-185-79"><a id="__codelineno-185-79" name="__codelineno-185-79" href="#__codelineno-185-79"></a><span class="w">              </span><span class="c1">// ä»¥ä¸‹æ˜¯å¸¸è§çš„æ—¶é—´ç»„åˆ</span>
</span><span id="__span-185-80"><a id="__codelineno-185-80" name="__codelineno-185-80" href="#__codelineno-185-80"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨Rè¡¨ç¤ºä»¥"%tH:%tM"æ ¼å¼åŒ–æ—¶é—´</span>
</span><span id="__span-185-81"><a id="__codelineno-185-81" name="__codelineno-185-81" href="#__codelineno-185-81"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tR%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span>
</span><span id="__span-185-82"><a id="__codelineno-185-82" name="__codelineno-185-82" href="#__codelineno-185-82"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨Tè¡¨ç¤ºä»¥"%tH:%tM:%tS"æ ¼å¼åŒ–æ—¶é—´</span>
</span><span id="__span-185-83"><a id="__codelineno-185-83" name="__codelineno-185-83" href="#__codelineno-185-83"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tT%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span>
</span><span id="__span-185-84"><a id="__codelineno-185-84" name="__codelineno-185-84" href="#__codelineno-185-84"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨rè¡¨ç¤ºä»¥"%tI:%tM:%tS %Tp"æ ¼å¼åŒ–æ—¶é—´</span>
</span><span id="__span-185-85"><a id="__codelineno-185-85" name="__codelineno-185-85" href="#__codelineno-185-85"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tr%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span>
</span><span id="__span-185-86"><a id="__codelineno-185-86" name="__codelineno-185-86" href="#__codelineno-185-86"></a>
</span><span id="__span-185-87"><a id="__codelineno-185-87" name="__codelineno-185-87" href="#__codelineno-185-87"></a><span class="w">              </span><span class="cm">/*** è¾“å‡ºæ˜ŸæœŸ***/</span>
</span><span id="__span-185-88"><a id="__codelineno-185-88" name="__codelineno-185-88" href="#__codelineno-185-88"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨Aè¡¨ç¤ºå¾—åˆ°æ˜ŸæœŸå‡ çš„å…¨ç§°</span>
</span><span id="__span-185-89"><a id="__codelineno-185-89" name="__codelineno-185-89" href="#__codelineno-185-89"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tF %1$tA%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span>
</span><span id="__span-185-90"><a id="__codelineno-185-90" name="__codelineno-185-90" href="#__codelineno-185-90"></a><span class="w">              </span><span class="c1">// %tä¹‹åç”¨aè¡¨ç¤ºå¾—åˆ°æ˜ŸæœŸå‡ çš„ç®€ç§°</span>
</span><span id="__span-185-91"><a id="__codelineno-185-91" name="__codelineno-185-91" href="#__codelineno-185-91"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tF %1$ta%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span>
</span><span id="__span-185-92"><a id="__codelineno-185-92" name="__codelineno-185-92" href="#__codelineno-185-92"></a>
</span><span id="__span-185-93"><a id="__codelineno-185-93" name="__codelineno-185-93" href="#__codelineno-185-93"></a><span class="w">              </span><span class="c1">// è¾“å‡ºæ—¶é—´æ—¥æœŸçš„å®Œæ•´ä¿¡æ¯</span>
</span><span id="__span-185-94"><a id="__codelineno-185-94" name="__codelineno-185-94" href="#__codelineno-185-94"></a><span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">"%1$tc%n"</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span>
</span><span id="__span-185-95"><a id="__codelineno-185-95" name="__codelineno-185-95" href="#__codelineno-185-95"></a><span class="w">       </span><span class="p">}</span>
</span><span id="__span-185-96"><a id="__codelineno-185-96" name="__codelineno-185-96" href="#__codelineno-185-96"></a><span class="p">}</span>
</span><span id="__span-185-97"><a id="__codelineno-185-97" name="__codelineno-185-97" href="#__codelineno-185-97"></a><span class="cm">/**</span>
</span><span id="__span-185-98"><a id="__codelineno-185-98" name="__codelineno-185-98" href="#__codelineno-185-98"></a><span class="cm"> *printfæ–¹æ³•ä¸­,æ ¼å¼ä¸º"%s"è¡¨ç¤ºä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡ºç¬¬äºŒä¸ªå¯å˜é•¿å‚æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å€¼;</span>
</span><span id="__span-185-99"><a id="__codelineno-185-99" name="__codelineno-185-99" href="#__codelineno-185-99"></a><span class="cm"> *æ ¼å¼ä¸º"%n"è¡¨ç¤ºæ¢è¡Œ;æ ¼å¼ä¸º"%S"è¡¨ç¤ºå°†å­—ç¬¦ä¸²ä»¥å¤§å†™å½¢å¼è¾“å‡º;åœ¨"%s"ä¹‹é—´ç”¨"n$"è¡¨ç¤º</span>
</span><span id="__span-185-100"><a id="__codelineno-185-100" name="__codelineno-185-100" href="#__codelineno-185-100"></a><span class="cm"> *è¾“å‡ºå¯å˜é•¿å‚æ•°çš„ç¬¬nä¸ªå‚æ•°å€¼.æ ¼å¼ä¸º"%b"è¡¨ç¤ºä»¥å¸ƒå°”å€¼çš„å½¢å¼è¾“å‡ºç¬¬äºŒä¸ªå¯å˜é•¿å‚æ•°</span>
</span><span id="__span-185-101"><a id="__codelineno-185-101" name="__codelineno-185-101" href="#__codelineno-185-101"></a><span class="cm"> *çš„ç¬¬ä¸€ä¸ªå‚æ•°å€¼.</span>
</span><span id="__span-185-102"><a id="__codelineno-185-102" name="__codelineno-185-102" href="#__codelineno-185-102"></a><span class="cm"> */</span>
</span><span id="__span-185-103"><a id="__codelineno-185-103" name="__codelineno-185-103" href="#__codelineno-185-103"></a><span class="cm">/**</span>
</span><span id="__span-185-104"><a id="__codelineno-185-104" name="__codelineno-185-104" href="#__codelineno-185-104"></a><span class="cm"> * æ ¼å¼ä¸º"%d"è¡¨ç¤ºä»¥åè¿›åˆ¶æ•´æ•°å½¢å¼è¾“å‡º;"%o"è¡¨ç¤ºä»¥å…«è¿›åˆ¶å½¢å¼è¾“å‡º;"%x"è¡¨ç¤ºä»¥åå…­è¿›åˆ¶</span>
</span><span id="__span-185-105"><a id="__codelineno-185-105" name="__codelineno-185-105" href="#__codelineno-185-105"></a><span class="cm"> * è¾“å‡º;"%X"è¡¨ç¤ºä»¥åå…­è¿›åˆ¶è¾“å‡º,å¹¶ä¸”å°†å­—æ¯(Aã€Bã€Cã€Dã€Eã€F)æ¢æˆå¤§å†™.æ ¼å¼ä¸º"%e"è¡¨</span>
</span><span id="__span-185-106"><a id="__codelineno-185-106" name="__codelineno-185-106" href="#__codelineno-185-106"></a><span class="cm"> * ä»¥ç§‘å­¦è®¡æ•°æ³•è¾“å‡ºæµ®ç‚¹æ•°;æ ¼å¼ä¸º"%E"è¡¨ç¤ºä»¥ç§‘å­¦è®¡æ•°æ³•è¾“å‡ºæµ®ç‚¹æ•°,è€Œä¸”å°†eå¤§å†™;æ ¼å¼ä¸º</span>
</span><span id="__span-185-107"><a id="__codelineno-185-107" name="__codelineno-185-107" href="#__codelineno-185-107"></a><span class="cm"> * "%f"è¡¨ç¤ºä»¥åè¿›åˆ¶æµ®ç‚¹æ•°è¾“å‡º,åœ¨"%f"ä¹‹é—´åŠ ä¸Š".n"è¡¨ç¤ºè¾“å‡ºæ—¶ä¿ç•™å°æ•°ç‚¹åé¢nä½.</span>
</span><span id="__span-185-108"><a id="__codelineno-185-108" name="__codelineno-185-108" href="#__codelineno-185-108"></a><span class="cm"> */</span>
</span><span id="__span-185-109"><a id="__codelineno-185-109" name="__codelineno-185-109" href="#__codelineno-185-109"></a><span class="cm">/**</span>
</span><span id="__span-185-110"><a id="__codelineno-185-110" name="__codelineno-185-110" href="#__codelineno-185-110"></a><span class="cm"> * æ ¼å¼ä¸º"%t"è¡¨ç¤ºè¾“å‡ºæ—¶é—´æ—¥æœŸç±»å‹."%t"ä¹‹åç”¨yè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„äºŒä½æ•°çš„å¹´ä»½(å¦‚99)ã€ç”¨m</span>
</span><span id="__span-185-111"><a id="__codelineno-185-111" name="__codelineno-185-111" href="#__codelineno-185-111"></a><span class="cm"> * è¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æœˆä»½,ç”¨dè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æ—¥å·;"%t"ä¹‹åç”¨Yè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„å››ä½æ•°çš„å¹´ä»½</span>
</span><span id="__span-185-112"><a id="__codelineno-185-112" name="__codelineno-185-112" href="#__codelineno-185-112"></a><span class="cm"> * (å¦‚1999)ã€ç”¨Bè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æœˆä»½çš„å®Œæ•´å,ç”¨bè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æœˆä»½çš„ç®€ç§°."%t"ä¹‹åç”¨D</span>
</span><span id="__span-185-113"><a id="__codelineno-185-113" name="__codelineno-185-113" href="#__codelineno-185-113"></a><span class="cm"> * è¡¨ç¤ºä»¥"%tm/%td/%ty"çš„æ ¼å¼è¾“å‡ºæ—¥æœŸã€ç”¨Fè¡¨ç¤ºä»¥"%tY-%tm-%td"çš„æ ¼å¼è¾“å‡ºæ—¥æœŸ.</span>
</span><span id="__span-185-114"><a id="__codelineno-185-114" name="__codelineno-185-114" href="#__codelineno-185-114"></a><span class="cm"> */</span>
</span><span id="__span-185-115"><a id="__codelineno-185-115" name="__codelineno-185-115" href="#__codelineno-185-115"></a><span class="cm">/**</span>
</span><span id="__span-185-116"><a id="__codelineno-185-116" name="__codelineno-185-116" href="#__codelineno-185-116"></a><span class="cm"> * "%t"ä¹‹åç”¨Hè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„æ—¶(24è¿›åˆ¶),ç”¨Iè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„æ—¶(12è¿›åˆ¶),ç”¨Mè¡¨ç¤ºè¾“å‡ºæ—¶é—´</span>
</span><span id="__span-185-117"><a id="__codelineno-185-117" name="__codelineno-185-117" href="#__codelineno-185-117"></a><span class="cm"> * åˆ†,ç”¨Sè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„ç§’,ç”¨Lè¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„ç§’ä¸­çš„æ¯«ç§’æ•°ã€ç”¨ p è¡¨ç¤ºè¾“å‡ºæ—¶é—´çš„æ˜¯ä¸Šåˆè¿˜æ˜¯</span>
</span><span id="__span-185-118"><a id="__codelineno-185-118" name="__codelineno-185-118" href="#__codelineno-185-118"></a><span class="cm"> * ä¸‹åˆ."%t"ä¹‹åç”¨Rè¡¨ç¤ºä»¥"%tH:%tM"çš„æ ¼å¼è¾“å‡ºæ—¶é—´ã€ç”¨Tè¡¨ç¤ºä»¥"%tH:%tM:%tS"çš„æ ¼å¼è¾“å‡º</span>
</span><span id="__span-185-119"><a id="__codelineno-185-119" name="__codelineno-185-119" href="#__codelineno-185-119"></a><span class="cm"> * æ—¶é—´ã€ç”¨rè¡¨ç¤ºä»¥"%tI:%tM:%tS %Tp"çš„æ ¼å¼è¾“å‡ºæ—¶é—´.</span>
</span><span id="__span-185-120"><a id="__codelineno-185-120" name="__codelineno-185-120" href="#__codelineno-185-120"></a><span class="cm"> */</span>
</span><span id="__span-185-121"><a id="__codelineno-185-121" name="__codelineno-185-121" href="#__codelineno-185-121"></a><span class="cm">/**</span>
</span><span id="__span-185-122"><a id="__codelineno-185-122" name="__codelineno-185-122" href="#__codelineno-185-122"></a><span class="cm"> * "%t"ä¹‹åç”¨Aè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„å…¨ç§°,ç”¨aè¡¨ç¤ºè¾“å‡ºæ—¥æœŸçš„æ˜ŸæœŸç®€ç§°.</span>
</span><span id="__span-185-123"><a id="__codelineno-185-123" name="__codelineno-185-123" href="#__codelineno-185-123"></a><span class="cm"> */</span>
</span></code></pre></div> <h3 id="1212å†…å­˜æµ">12.12ã€å†…å­˜æµ<a class="headerlink" href="#1212å†…å­˜æµ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>é™¤äº†æ–‡ä»¶ä¹‹å¤–ï¼ŒIO æ“ä½œä¹Ÿå¯ä»¥å‘ç”Ÿåœ¨å†…å­˜ä¸­ï¼Œå‘ç”Ÿåœ¨å†…å­˜ä¸­çš„æ“ä½œæµä¹Ÿæˆä¸ºå†…å­˜æµã€‚</p> <p>å†…å­˜æµä¹Ÿåˆ†ä¸ºä¸¤ç±»ï¼š</p> <ul> <li>å­—èŠ‚å†…å­˜æµ<ul> <li>ByteArrayOutputStream</li> <li>ByteArrayInputStream (Byte buf[])</li> </ul> </li> <li>å­—ç¬¦å†…å­˜æµ<ul> <li>CharArrayReader</li> <li>CharArrayWriter</li> </ul> </li> </ul> <p><strong>å†…å­˜æµå®ç°å­—æ¯çš„è½¬æ¢</strong></p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-186-1"><a id="__codelineno-186-1" name="__codelineno-186-1" href="#__codelineno-186-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-186-2"><a id="__codelineno-186-2" name="__codelineno-186-2" href="#__codelineno-186-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-186-3"><a id="__codelineno-186-3" name="__codelineno-186-3" href="#__codelineno-186-3"></a><span class="w">        </span><span class="c1">//1.å†…å­˜æµå®ç°å­—æ¯çš„è½¬æ¢</span>
</span><span id="__span-186-4"><a id="__codelineno-186-4" name="__codelineno-186-4" href="#__codelineno-186-4"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"hello"</span><span class="p">;</span>
</span><span id="__span-186-5"><a id="__codelineno-186-5" name="__codelineno-186-5" href="#__codelineno-186-5"></a><span class="w">        </span><span class="c1">//2.å–å¾—å†…å­˜çš„è¾“å…¥è¾“å‡ºæµ</span>
</span><span id="__span-186-6"><a id="__codelineno-186-6" name="__codelineno-186-6" href="#__codelineno-186-6"></a><span class="w">        </span><span class="n">ByteArrayInputStream</span><span class="w"> </span><span class="n">inputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayInputStream</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>
</span><span id="__span-186-7"><a id="__codelineno-186-7" name="__codelineno-186-7" href="#__codelineno-186-7"></a><span class="w">        </span><span class="n">ByteArrayOutputStream</span><span class="w"> </span><span class="n">outputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayOutputStream</span><span class="p">();</span>
</span><span id="__span-186-8"><a id="__codelineno-186-8" name="__codelineno-186-8" href="#__codelineno-186-8"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-186-9"><a id="__codelineno-186-9" name="__codelineno-186-9" href="#__codelineno-186-9"></a><span class="w">        </span><span class="k">while</span><span class="p">((</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inputStream</span><span class="p">.</span><span class="na">read</span><span class="p">())</span><span class="o">!=-</span><span class="mi">1</span><span class="p">){</span>
</span><span id="__span-186-10"><a id="__codelineno-186-10" name="__codelineno-186-10" href="#__codelineno-186-10"></a><span class="w">            </span><span class="n">outputStream</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">Character</span><span class="p">.</span><span class="na">toUpperCase</span><span class="p">(</span><span class="n">len</span><span class="p">));</span>
</span><span id="__span-186-11"><a id="__codelineno-186-11" name="__codelineno-186-11" href="#__codelineno-186-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-186-12"><a id="__codelineno-186-12" name="__codelineno-186-12" href="#__codelineno-186-12"></a><span class="w">        </span><span class="c1">//ç›´æ¥å°†å†…å­˜è¾“å‡ºæµè¾“å‡º</span>
</span><span id="__span-186-13"><a id="__codelineno-186-13" name="__codelineno-186-13" href="#__codelineno-186-13"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">outputStream</span><span class="p">);</span>
</span><span id="__span-186-14"><a id="__codelineno-186-14" name="__codelineno-186-14" href="#__codelineno-186-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-186-15"><a id="__codelineno-186-15" name="__codelineno-186-15" href="#__codelineno-186-15"></a><span class="p">}</span>
</span></code></pre></div> <p><strong>ä½¿ç”¨ toString() æ–¹æ³•æ—¶å‡ºç°ä¹±ç çš„è§£å†³åŠæ³•</strong></p> <p>å¯ä»¥ä½¿ç”¨<code>toString(java.nio.charset.Charset charset)</code>çš„æ–¹å¼è®¾ç½®ç¼–ç ï¼š<code>toString(StandardCharsets.UTF_8)</code>;</p> <p>æˆ–è€…<code>new String(outputStream.toByteArray(), StandardCharsets.UTF_8)</code>;</p> <h2 id="13ç½‘ç»œç¼–ç¨‹">13ã€ç½‘ç»œç¼–ç¨‹<a class="headerlink" href="#13ç½‘ç»œç¼–ç¨‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>è®¡ç®—æœºç½‘ç»œæ˜¯é€šè¿‡ä¼ è¾“ä»‹è´¨ã€é€šä¿¡è®¾æ–½å’Œç½‘ç»œé€šä¿¡åè®®ï¼ŒæŠŠåˆ†æ•£åœ¨ä¸åŒåœ°ç‚¹çš„è®¡ç®—æœºè®¾å¤‡äº’è¿èµ·æ¥çš„ï¼Œå®ç°èµ„æºå…±äº«å’Œæ•°æ®ä¼ è¾“çš„ç³»ç»Ÿã€‚ç½‘ç»œç¼–ç¨‹å°±æ˜¯ç¼–å†™ç¨‹åºä½¿äº’è”ç½‘çš„ä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰è®¾å¤‡ï¼ˆå¦‚è®¡ç®—æœºï¼‰ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚Javaè¯­è¨€å¯¹ç½‘ç»œç¼–ç¨‹æä¾›äº†è‰¯å¥½çš„æ”¯æŒã€‚é€šè¿‡å…¶æä¾›çš„æ¥å£æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œç½‘ç»œç¼–ç¨‹ã€‚</p> <p>è®¡ç®—æœºç½‘ç»œåˆ†ä¸ºç½‘ç»œåè®®å’Œç½‘ç»œä½“ç³»ç»“æ„ã€‚</p> <h3 id="131ç½‘ç»œä½“ç³»ç»“æ„">13.1ã€ç½‘ç»œä½“ç³»ç»“æ„<a class="headerlink" href="#131ç½‘ç»œä½“ç³»ç»“æ„" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>é€šè¿‡ç½‘ç»œå‘é€æ•°æ®æ˜¯ä¸€é¡¹å¤æ‚çš„æ“ä½œï¼Œå¿…é¡»ä»”ç»†åœ°åè°ƒç½‘ç»œçš„ç‰©ç†ç‰¹æ€§ä»¥åŠæ‰€å‘é€æ•°æ®çš„é€»è¾‘ç‰¹å¾ã€‚é€šè¿‡ç½‘ç»œå°†æ•°æ®ä»ä¸€å°ä¸»æœºå‘é€åˆ°å¦å¤–çš„ä¸»æœºï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡è®¡ç®—æœºç½‘ç»œé€šä¿¡æ¥å®Œæˆã€‚</p> <p>ç½‘ç»œé€šä¿¡çš„ä¸åŒæ–¹é¢è¢«åˆ†è§£ä¸ºå¤šä¸ªå±‚ï¼Œå±‚ä¸å±‚ä¹‹é—´ç”¨æ¥å£è¿æ¥ã€‚é€šä¿¡çš„åŒæ–¹å…·æœ‰ç›¸åŒçš„å±‚æ¬¡ï¼Œå±‚æ¬¡å®ç°çš„åŠŸèƒ½ç”±åè®®æ•°æ®å•å…ƒï¼ˆPDUï¼‰æ¥æè¿°ã€‚ä¸åŒç³»ç»Ÿä¸­çš„åŒä¸€å±‚æ„æˆå¯¹ç­‰å±‚ï¼Œå¯¹ç­‰å±‚ä¹‹é—´é€šè¿‡å¯¹ç­‰å±‚åè®®è¿›è¡Œé€šä¿¡ã€‚æ¯ä¸€å±‚è¡¨ç¤ºä¸ºç‰©ç†ç¡¬ä»¶ï¼ˆå³çº¿ç¼†å’Œç”µæµï¼‰ä¸æ‰€ä¼ è¾“ä¿¡æ¯ä¹‹é—´çš„ä¸åŒæŠ½è±¡å±‚æ¬¡ã€‚åœ¨ç†è®ºä¸Šï¼Œæ¯ä¸€å±‚åªä¸ç´§æŒ¨å…¶ä¸Šå’Œå…¶ä¸‹çš„å±‚å¯¹è¯ã€‚å°†ç½‘ç»œåˆ†å±‚ï¼Œè¿™æ ·å°±å¯ä»¥ä¿®æ”¹ç”šè‡³æ›¿æ¢æŸä¸€å±‚çš„è½¯ä»¶ï¼Œåªè¦å±‚ä¸å±‚ä¹‹é—´çš„æ¥å£ä¿æŒä¸å˜ï¼Œå°±ä¸ä¼šå½±å“åˆ°å…¶ä»–å±‚ã€‚</p> <p>è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„æ˜¯è®¡ç®—æœºç½‘ç»œå±‚æ¬¡å’Œåè®®çš„é›†åˆï¼Œç½‘ç»œä½“ç³»ç»“æ„å¯¹è®¡ç®—æœºç½‘ç»œå®ç°çš„åŠŸèƒ½ï¼Œä»¥åŠç½‘ç»œåè®®ã€å±‚æ¬¡ã€æ¥å£å’ŒæœåŠ¡è¿›è¡Œäº†æè¿°ï¼Œä½†å¹¶ä¸æ¶‰åŠå…·ä½“çš„å®ç°ã€‚æ¥å£æ˜¯åŒä¸€èŠ‚ç‚¹å†…ç›¸é‚»å±‚ä¹‹é—´äº¤æ¢ä¿¡æ¯çš„è¿æ¥å¤„ï¼Œä¹Ÿå«æœåŠ¡è®¿é—®ç‚¹ï¼ˆSAPï¼‰ã€‚</p> <p>è®¡ç®—æœºç½‘ç»œå±‚æ¬¡æ¨¡å‹ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190503122042374-56172361.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190503122042374-56172361.png" alt="img" style="zoom:80%;"></a></p> <p>ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªç½‘ç»œä½“ç³»ç»“æ„ç”±IBMå…¬å¸æå‡ºï¼ˆ1974å¹´ï¼ŒSNAï¼‰ï¼Œä»¥åå…¶ä»–å…¬å¸ä¹Ÿç›¸ç»§æå‡ºè‡ªå·±çš„ç½‘ç»œä½“ç³»ç»“æ„ã€‚ä¸ºäº†ä¿ƒè¿›è®¡ç®—æœºç½‘ç»œçš„å‘å±•ï¼Œå›½é™…æ ‡å‡†åŒ–ç»„ç»‡ISOåœ¨ç°æœ‰ç½‘ç»œçš„åŸºç¡€ä¸Šï¼Œæå‡ºäº†ä¸åŸºäºå…·ä½“æœºå‹ã€æ“ä½œç³»ç»Ÿæˆ–å…¬å¸çš„ç½‘ç»œä½“ç³»ç»“æ„ï¼Œç§°ä¸ºå¼€æ”¾ç³»ç»Ÿäº’è¿å‚è€ƒæ¨¡å‹ï¼Œå³OSI/RMï¼ˆOpen System Interconnection Reference Modelï¼‰ã€‚</p> <p>ISOåˆ¶å®šçš„OSIå‚è€ƒæ¨¡å‹è¿‡äºåºå¤§ã€å¤æ‚æ‹›è‡´äº†è®¸å¤šæ‰¹è¯„ã€‚ä¸æ­¤ç›¸å¯¹ï¼Œç¾å›½å›½é˜²éƒ¨æå‡ºäº†TCP/IPåè®®æ ˆå‚è€ƒæ¨¡å‹ï¼Œç®€åŒ–äº†OSIå‚è€ƒæ¨¡å‹ï¼Œç”±äºTCP/IPåè®®æ ˆçš„ç®€å•ï¼Œè·å¾—äº†å¹¿æ³›çš„åº”ç”¨ï¼Œå¹¶æˆä¸ºåç»­å› ç‰¹ç½‘ä½¿ç”¨çš„å‚è€ƒæ¨¡å‹ã€‚</p> <h4 id="1311osi-å‚è€ƒæ¨¡å‹">13.1.1ã€OSI å‚è€ƒæ¨¡å‹<a class="headerlink" href="#1311osi-å‚è€ƒæ¨¡å‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>OSI æ¨¡å‹æŠŠç½‘ç»œé€šä¿¡çš„å·¥ä½œåˆ†ä¸º 7 å±‚ï¼Œåˆ†åˆ«æ˜¯ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚å’Œåº”ç”¨å±‚ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190503140552307-1306184849.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190503140552307-1306184849.png" alt="img" style="zoom:80%;"></a></p> <ul> <li> <p>ç‰©ç†å±‚</p> <blockquote> <p>ç‰©ç†å±‚å¤„äºOSIçš„æœ€åº•å±‚ï¼Œæ˜¯æ•´ä¸ªå¼€æ”¾ç³»ç»Ÿçš„åŸºç¡€ã€‚ç‰©ç†å±‚æ¶‰åŠé€šä¿¡ä¿¡é“ä¸Šä¼ è¾“çš„åŸå§‹æ¯”ç‰¹æµï¼ˆbitsï¼‰ï¼Œå®ƒçš„åŠŸèƒ½ä¸»è¦æ˜¯ä¸ºæ•°æ®ç«¯è®¾å¤‡æä¾›ä¼ é€æ•°æ®çš„é€šè·¯ä»¥åŠä¼ è¾“æ•°æ®ã€‚ - æ•°æ®é“¾è·¯å±‚</p> <p>æ•°æ®é“¾è·¯å±‚çš„ä¸»è¦ä»»åŠ¡æ˜¯å®ç°è®¡ç®—æœºç½‘ç»œä¸­ç›¸é‚»èŠ‚ç‚¹ä¹‹é—´çš„å¯é ä¼ è¾“ï¼ŒæŠŠåŸå§‹çš„ã€æœ‰å·®é”™çš„ç‰©ç†ä¼ è¾“çº¿åŠ ä¸Šæ•°æ®é“¾è·¯åè®®ä»¥åï¼Œæ„æˆé€»è¾‘ä¸Šå¯é çš„æ•°æ®é“¾è·¯ã€‚éœ€è¦å®Œæˆçš„åŠŸèƒ½æœ‰é“¾è·¯ç®¡ç†ã€æˆå¸§ã€å·®é”™æ§åˆ¶ä»¥åŠæµé‡æ§åˆ¶ç­‰ã€‚å…¶ä¸­æˆå¸§æ˜¯å¯¹ç‰©ç†å±‚çš„åŸå§‹æ¯”ç‰¹æµè¿›è¡Œç•Œå®šï¼Œæ•°æ®é“¾è·¯å±‚ä¹Ÿèƒ½å¤Ÿå¯¹å¸§çš„ä¸¢å¤±è¿›è¡Œå¤„ç†ã€‚ - ç½‘ç»œå±‚</p> <p>ç½‘ç»œå±‚æ¶‰åŠæºä¸»æœºèŠ‚ç‚¹åˆ°ç›®çš„ä¸»æœºèŠ‚ç‚¹ä¹‹é—´å¯é çš„ç½‘ç»œä¼ è¾“ï¼Œå®ƒéœ€è¦å®Œæˆçš„åŠŸèƒ½ä¸»è¦åŒ…æ‹¬è·¯ç”±é€‰æ‹©ã€ç½‘ç»œå¯»å€ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ã€ç½‘ç»œäº’è¿ç­‰ã€‚ - ä¼ è¾“å±‚</p> <p>ä¼ è¾“å±‚èµ·ç€æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼Œæ¶‰åŠæºç«¯èŠ‚ç‚¹åˆ°ç›®çš„ç«¯èŠ‚ç‚¹ä¹‹é—´å¯é çš„ä¿¡æ¯ä¼ è¾“ã€‚ä¼ è¾“å±‚éœ€è¦è§£å†³è·¨è¶Šç½‘ç»œè¿æ¥çš„å»ºç«‹å’Œé‡Šæ”¾ï¼Œå¯¹åº•å±‚ä¸å¯é çš„ç½‘ç»œï¼Œå»ºç«‹è¿æ¥æ—¶éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‡Šæ”¾è¿æ¥æ—¶éœ€è¦å››æ¬¡æŒ¥æ‰‹ã€‚ã€€ - ä¼šè¯å±‚å’Œè¡¨ç¤ºå±‚</p> <p>ä¼šè¯å±‚çš„ä¸»è¦åŠŸèƒ½æ˜¯è´Ÿè´£åº”ç”¨ç¨‹åºä¹‹é—´å»ºç«‹ã€ç»´æŒå’Œä¸­æ–­ä¼šè¯ï¼ŒåŒæ—¶ä¹Ÿæä¾›å¯¹è®¾å¤‡å’Œç»“ç‚¹ä¹‹é—´çš„ä¼šè¯æ§åˆ¶ï¼Œåè°ƒç³»ç»Ÿå’ŒæœåŠ¡ä¹‹é—´çš„äº¤æµï¼Œå¹¶é€šè¿‡æä¾›å•å·¥ã€åŠåŒå·¥å’Œå…¨åŒå·¥3ç§ä¸åŒçš„é€šä¿¡æ–¹å¼ï¼Œä½¿ç³»ç»Ÿå’ŒæœåŠ¡ä¹‹é—´æœ‰åºåœ°è¿›è¡Œé€šä¿¡ã€‚ è¡¨ç¤ºå±‚å…³å¿ƒæ‰€ä¼ è¾“æ•°æ®ä¿¡æ¯çš„æ ¼å¼å®šä¹‰ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯æŠŠåº”ç”¨å±‚æä¾›çš„ä¿¡æ¯å˜æ¢ä¸ºèƒ½å¤Ÿå…±åŒç†è§£çš„å½¢å¼ï¼Œæä¾›å­—ç¬¦ä»£ç ã€æ•°æ®æ ¼å¼ã€æ§åˆ¶ä¿¡æ¯æ ¼å¼ã€åŠ å¯†ç­‰çš„ç»Ÿä¸€è¡¨ç¤ºã€‚ - åº”ç”¨å±‚</p> <p>åº”ç”¨å±‚ä¸ºOSIçš„æœ€é«˜å±‚ï¼Œæ˜¯ç›´æ¥ä¸ºåº”ç”¨è¿›ç¨‹æä¾›æœåŠ¡çš„ã€‚å…¶ä½œç”¨æ˜¯åœ¨å®ç°å¤šä¸ªç³»ç»Ÿåº”ç”¨è¿›ç¨‹ç›¸äº’é€šä¿¡çš„åŒæ—¶ï¼Œå®Œæˆä¸€ç³»åˆ—ä¸šåŠ¡å¤„ç†æ‰€éœ€çš„æœåŠ¡ã€‚</p> </blockquote> </li> </ul> <h4 id="1312tcpipå‚è€ƒæ¨¡å‹">13.1.2ã€TCP/IPå‚è€ƒæ¨¡å‹<a class="headerlink" href="#1312tcpipå‚è€ƒæ¨¡å‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>TCP/IPï¼Œå³Transmission Control Protocol/Internet Protocolçš„ç®€å†™ï¼Œä¸­è¯‘åä¸ºä¼ è¾“æ§åˆ¶åè®®/å› ç‰¹ç½‘äº’è”åè®®ï¼Œæ˜¯Internetæœ€åŸºæœ¬çš„åè®®ï¼ŒInternetå›½é™…äº’è”ç½‘ç»œçš„åŸºç¡€ã€‚</p> <p>TCP/IPåè®®æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ç½‘ç»œåè®®ç°‡ï¼Œå®ƒçš„åå­—ä¸»è¦å–è‡ªæœ€é‡è¦çš„ç½‘ç»œå±‚IPåè®®å’Œä¼ è¾“å±‚TCPåè®®ã€‚TCP/IPåè®®å®šä¹‰äº†ç”µå­è®¾å¤‡å¦‚ä½•è¿å…¥å› ç‰¹ç½‘ï¼Œä»¥åŠæ•°æ®å¦‚ä½•åœ¨å®ƒä»¬ä¹‹é—´ä¼ è¾“çš„æ ‡å‡†ã€‚TCP/IPå‚è€ƒæ¨¡å‹é‡‡ç”¨4å±‚çš„å±‚çº§ç»“æ„ï¼Œæ¯ä¸€å±‚éƒ½å‘¼å«å®ƒçš„ä¸‹ä¸€å±‚æ‰€æä¾›çš„åè®®æ¥å®Œæˆè‡ªå·±çš„éœ€æ±‚ï¼Œè¿™4ä¸ªå±‚æ¬¡åˆ†åˆ«æ˜¯ï¼šç½‘ç»œæ¥å£å±‚ã€ç½‘ç»œå±‚ï¼ˆIPå±‚ï¼‰ã€ä¼ è¾“å±‚ï¼ˆTCPå±‚ï¼‰ã€åº”ç”¨å±‚ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190503162526581-1315509304.gif" data-desc-position="bottom"><img src="!assets/Java/1217276-20190503162526581-1315509304.gif" alt="img" style="zoom:80%;"></a></p> <ul> <li>ç½‘ç»œæ¥å£å±‚ TCP/IPåè®®å¯¹ç½‘ç»œæ¥å£å±‚æ²¡æœ‰ç»™å‡ºå…·ä½“çš„æè¿°ï¼Œç½‘ç»œæ¥å£å±‚å¯¹åº”ç€OSIå‚è€ƒæ¨¡å‹çš„ç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚ã€‚</li> <li>ç½‘ç»œå±‚ï¼ˆIPå±‚ï¼‰ ç½‘ç»œå±‚æ˜¯æ•´ä¸ªTCP/IPåè®®æ ˆçš„æ ¸å¿ƒã€‚å®ƒçš„åŠŸèƒ½æ˜¯æŠŠåˆ†ç»„å‘å¾€ç›®æ ‡ç½‘ç»œæˆ–ä¸»æœºã€‚åŒæ—¶ï¼Œä¸ºäº†å°½å¿«åœ°å‘é€åˆ†ç»„ï¼Œå¯èƒ½éœ€è¦æ²¿ä¸åŒçš„è·¯å¾„åŒæ—¶è¿›è¡Œåˆ†ç»„ä¼ é€’ã€‚å› æ­¤ï¼Œåˆ†ç»„åˆ°è¾¾çš„é¡ºåºå’Œå‘é€çš„é¡ºåºå¯èƒ½ä¸åŒï¼Œè¿™å°±éœ€è¦ä¸Šå±‚å¿…é¡»å¯¹åˆ†ç»„è¿›è¡Œæ’åºã€‚ç½‘ç»œå±‚é™¤äº†éœ€è¦å®Œæˆè·¯ç”±çš„åŠŸèƒ½å¤–ï¼Œä¹Ÿå¯ä»¥å®Œæˆå°†ä¸åŒç±»å‹çš„ç½‘ç»œï¼ˆå¼‚æ„ç½‘ï¼‰äº’è¿çš„ä»»åŠ¡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œäº’è”ç½‘å±‚è¿˜éœ€è¦å®Œæˆæ‹¥å¡æ§åˆ¶çš„åŠŸèƒ½ã€‚</li> <li>ä¼ è¾“å±‚ï¼ˆTCPå±‚ï¼‰ TCPå±‚è´Ÿè´£åœ¨åº”ç”¨è¿›ç¨‹ä¹‹é—´å»ºç«‹ç«¯åˆ°ç«¯çš„è¿æ¥å’Œå¯é é€šä¿¡ï¼Œå®ƒåªå­˜åœ¨ä¸ç«¯èŠ‚ç‚¹ä¸­ã€‚TCPå±‚æ¶‰åŠä¸¤ä¸ªåè®®ï¼ŒTCPå’ŒUDPã€‚å…¶ä¸­ï¼ŒTCPåè®®æä¾›é¢å‘è¿æ¥çš„æœåŠ¡ï¼Œæä¾›æŒ‰å­—èŠ‚æµçš„æœ‰åºã€å¯é ä¼ è¾“ï¼Œå¯ä»¥å®ç°è¿æ¥ç®¡ç†ã€å·®é”™æ§åˆ¶ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ç­‰ã€‚UDPåè®®æä¾›æ— è¿æ¥çš„æœåŠ¡ï¼Œç”¨äºä¸éœ€è¦æˆ–æ— æ³•å®ç°é¢å‘è¿æ¥çš„ç½‘ç»œåº”ç”¨ä¸­ã€‚</li> <li>åº”ç”¨å±‚ åº”ç”¨å±‚ä¸ºInternetä¸­çš„å„ç§ç½‘ç»œåº”ç”¨æä¾›æœåŠ¡ã€‚</li> </ul> <h3 id="132ç½‘ç»œåè®®">13.2ã€ç½‘ç»œåè®®<a class="headerlink" href="#132ç½‘ç»œåè®®" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å¦‚åŒäººä¸äººä¹‹é—´ç›¸äº’äº¤æµæ˜¯éœ€è¦éµå¾ªä¸€å®šçš„è§„åˆ™ï¼ˆå¦‚è¯­è¨€ï¼‰ä¸€æ ·ï¼Œè®¡ç®—æœºä¹‹é—´èƒ½å¤Ÿè¿›è¡Œç›¸äº’é€šä¿¡æ˜¯å› ä¸ºå®ƒä»¬éƒ½å…±åŒéµå®ˆä¸€å®šçš„è§„åˆ™ï¼Œå³ç½‘ç»œåè®®ã€‚</p> <p>OSIå‚è€ƒæ¨¡å‹å’ŒTCP/IPæ¨¡å‹åœ¨ä¸åŒçš„å±‚æ¬¡ä¸­æœ‰è®¸å¤šä¸åŒçš„ç½‘ç»œåè®®ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190503164338008-348345936.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190503164338008-348345936.png" alt="img" style="zoom:80%;"></a></p> <p>ç½‘ç»œåè®®ä¹‹é—´çš„å…³ç³»å›¾å¦‚ä¸‹ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190503165942538-1220277464.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190503165942538-1220277464.png" alt="img" style="zoom:80%;"></a></p> <h4 id="1321ipåè®®">13.2.1ã€IPåè®®<a class="headerlink" href="#1321ipåè®®" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>IPåè®®ï¼ˆInternet protocolï¼‰çš„ä½œç”¨åœ¨äºæŠŠå„ç§æ•°æ®åŒ…å‡†å¤‡æ— è¯¯çš„ä¼ é€’ç»™å¯¹æ–¹ï¼Œå…¶ä¸­ä¸¤ä¸ªé‡è¦çš„æ¡ä»¶æ˜¯IPåœ°å€å’ŒMACåœ°å€ã€‚ç”±äºIPåœ°å€æ˜¯ç¨€æœ‰èµ„æºï¼Œä¸å¯èƒ½æ¯ä¸ªäººéƒ½æ‹¥æœ‰ä¸€ä¸ªIPåœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸çš„IPåœ°å€æ˜¯è·¯ç”±å™¨ç»™æˆ‘ä»¬ç”Ÿæˆçš„IPåœ°å€ï¼Œè·¯ç”±å™¨é‡Œé¢ä¼šè®°å½•æˆ‘ä»¬çš„MACåœ°å€ã€‚è€ŒMACåœ°å€æ˜¯å…¨çƒå”¯ä¸€çš„ã€‚ä¸¾ä¾‹ï¼ŒIPåœ°å€å°±å¦‚åŒæ˜¯æˆ‘ä»¬å±…ä½å°åŒºçš„åœ°å€ï¼Œè€ŒMACåœ°å€å°±æ˜¯æˆ‘ä»¬ä½çš„é‚£æ ‹æ¥¼é‚£ä¸ªæˆ¿é—´é‚£ä¸ªäººã€‚IPåœ°å€é‡‡ç”¨çš„IPv4æ ¼å¼ï¼Œç›®å‰æ­£åœ¨å‘IPv6è¿‡æ¸¡ã€‚</p> <h4 id="1322tcpåè®®">13.2.2ã€TCPåè®®<a class="headerlink" href="#1322tcpåè®®" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>TCPï¼ˆTransmission Control Protocolï¼‰ï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯é¢å‘è¿æ¥çš„ä¼ è¾“å±‚åè®®ã€‚TCP å±‚æ˜¯ä½äº IP å±‚ä¹‹ä¸Šï¼Œåº”ç”¨å±‚ä¹‹ä¸‹çš„ä¸­é—´å±‚ã€‚ä¸åŒä¸»æœºçš„åº”ç”¨å±‚ä¹‹é—´ç»å¸¸éœ€è¦å¯é çš„ã€åƒç®¡é“ä¸€æ ·çš„è¿æ¥ï¼Œä½†æ˜¯ IP å±‚ä¸æä¾›è¿™æ ·çš„æµæœºåˆ¶ï¼Œè€Œæ˜¯æä¾›ä¸å¯é çš„åŒ…äº¤æ¢ã€‚TCP åè®®é‡‡ç”¨å­—èŠ‚æµä¼ è¾“æ•°æ®ã€‚</p> <h5 id="tcpçš„æŠ¥æ–‡æ ¼å¼">TCPçš„æŠ¥æ–‡æ ¼å¼<a class="headerlink" href="#tcpçš„æŠ¥æ–‡æ ¼å¼" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <p>TCP æŠ¥æ–‡æ®µåŒ…æ‹¬åè®®é¦–éƒ¨å’Œæ•°æ®ä¸¤éƒ¨åˆ†ï¼Œåè®®é¦–éƒ¨çš„å›ºå®šéƒ¨åˆ†æ˜¯ 20 ä¸ªå­—èŠ‚ï¼Œé¦–éƒ¨çš„å›ºå®šéƒ¨åˆ†åé¢æ˜¯é€‰é¡¹éƒ¨åˆ†ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190504001611594-373661106.jpg" data-desc-position="bottom"><img src="!assets/Java/1217276-20190504001611594-373661106.jpg" alt="img" style="zoom:80%;"></a></p> <p>ä¸‹é¢æ˜¯æŠ¥æ–‡æ®µé¦–éƒ¨å„ä¸ªå­—æ®µçš„å«ä¹‰ï¼š</p> <ol> <li><strong>æºç«¯å£å·ä»¥åŠç›®çš„ç«¯å£å·</strong>ï¼šå„å 2ä¸ªå­—èŠ‚ï¼Œç«¯å£æ˜¯ä¼ è¾“å±‚å’Œåº”ç”¨å±‚çš„æœåŠ¡æ¥å£ï¼Œç”¨äºå¯»æ‰¾å‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„è¿›ç¨‹ï¼Œä¸€èˆ¬æ¥è®²ï¼Œé€šè¿‡ç«¯å£å·å’ŒIPåœ°å€ï¼Œå¯ä»¥å”¯ä¸€ç¡®å®šä¸€ä¸ªTCPè¿æ¥ï¼Œåœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œé€šå¸¸è¢«ç§°ä¸ºä¸€ä¸ªsocketæ¥å£ã€‚</li> <li><strong>åºå·</strong>ï¼šSeqåºå·ï¼Œå 4ä¸ªå­—èŠ‚ã€32ä½ã€‚ç”¨æ¥æ ‡è¯†ä»TCPå‘é€ç«¯å‘TCPæ¥æ”¶ç«¯å‘é€çš„æ•°æ®å­—èŠ‚æµã€‚å‘èµ·æ–¹å‘é€æ•°æ®æ—¶å¯¹æ­¤è¿›è¡Œæ ‡è®°ã€‚</li> <li><strong>ç¡®è®¤åºå·</strong>ï¼šAckåºå·ï¼Œå 4ä¸ªå­—èŠ‚ã€32ä½ã€‚åŒ…å«å‘é€ç¡®è®¤çš„ä¸€ç«¯æ‰€æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºå·ã€‚åªæœ‰ACKæ ‡è®°ä½ä¸º1æ—¶ï¼Œç¡®è®¤åºå·å­—æ®µæ‰æœ‰æ•ˆï¼Œå› æ­¤ï¼Œç¡®è®¤åºå·åº”è¯¥æ˜¯ä¸Šæ¬¡å·²ç»æˆåŠŸæ”¶åˆ°æ•°æ®å­—èŠ‚åºå·åŠ 1ï¼Œå³Ack=Seq + 1ã€‚</li> <li><strong>æ•°æ®åç§»</strong>ï¼šå 4ä¸ªå­—èŠ‚ï¼Œç”¨äºæŒ‡å‡ºTCPé¦–éƒ¨é•¿åº¦ï¼Œè‹¥ä¸å­˜åœ¨é€‰é¡¹ï¼Œåˆ™è¿™ä¸ªå€¼ä¸º20å­—èŠ‚ï¼Œæ•°æ®åç§»çš„æœ€å¤§å€¼ä¸º60å­—èŠ‚ã€‚</li> <li><strong>ä¿ç•™å­—æ®µ</strong>å 6ä½ï¼Œæš‚æ—¶å¯å¿½ç•¥ï¼Œå€¼å…¨ä¸º0ã€‚</li> <li><strong>æ ‡å¿—ä½ï¼Œ6ä¸ª</strong><ul> <li>URG(ç´§æ€¥)ï¼šä¸º1æ—¶è¡¨æ˜ç´§æ€¥æŒ‡é’ˆå­—æ®µæœ‰æ•ˆ</li> <li>ACK(ç¡®è®¤)ï¼šä¸º1æ—¶è¡¨æ˜ç¡®è®¤å·å­—æ®µæœ‰æ•ˆ</li> <li>PSH(æ¨é€)ï¼šä¸º1æ—¶æ¥æ”¶æ–¹åº”å°½å¿«å°†è¿™ä¸ªæŠ¥æ–‡æ®µäº¤ç»™åº”ç”¨å±‚</li> <li>RST(å¤ä½)ï¼šä¸º1æ—¶è¡¨æ˜TCPè¿æ¥å‡ºç°æ•…éšœå¿…é¡»é‡å»ºè¿æ¥</li> <li>SYN(åŒæ­¥)ï¼šåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·</li> <li>FIN(ç»ˆæ­¢)ï¼šä¸º1æ—¶è¡¨æ˜å‘é€ç«¯æ•°æ®å‘é€å®Œæ¯•è¦æ±‚é‡Šæ”¾è¿æ¥</li> </ul> </li> <li><strong>æ¥æ”¶çª—å£ï¼š</strong>å 2ä¸ªå­—èŠ‚ï¼Œç”¨äºæµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ï¼Œè¡¨ç¤ºå½“å‰æ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ã€‚åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œé€šå¸¸æ˜¯ç”¨æ¥æ”¶æ–¹çš„æ¥æ”¶èƒ½åŠ›çš„å¤§å°æ¥æ§åˆ¶å‘é€æ–¹çš„æ•°æ®å‘é€é‡ã€‚TCPè¿æ¥çš„ä¸€ç«¯æ ¹æ®ç¼“å†²åŒºå¤§å°ç¡®å®šè‡ªå·±çš„æ¥æ”¶çª—å£å€¼ï¼Œå‘Šè¯‰å¯¹æ–¹ï¼Œä½¿å¯¹æ–¹å¯ä»¥ç¡®å®šå‘é€æ•°æ®çš„å­—èŠ‚æ•°ã€‚</li> <li><strong>æ ¡éªŒå’Œï¼š</strong>å 2ä¸ªå­—èŠ‚ï¼ŒèŒƒå›´åŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®ä¸¤éƒ¨åˆ†ã€‚</li> <li>é€‰é¡¹æ˜¯å¯é€‰çš„ï¼Œé»˜è®¤æƒ…å†µæ˜¯ä¸é€‰ã€‚</li> </ol> <h5 id="ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹">ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹<a class="headerlink" href="#ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <p><mark>TCPæ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œå› æ­¤æ¯ä¸ªTCPè¿æ¥éƒ½æœ‰3ä¸ªé˜¶æ®µï¼šè¿æ¥å»ºç«‹ã€æ•°æ®ä¼ é€å’Œè¿æ¥é‡Šæ”¾ã€‚è¿æ¥å»ºç«‹ç»å†ä¸‰ä¸ªæ­¥éª¤ï¼Œé€šå¸¸ç§°ä¸ºâ€œä¸‰æ¬¡æ¡æ‰‹â€ã€‚</mark></p> <p>TCPä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹å¦‚ä¸‹ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190503210424740-1764008697.jpg" data-desc-position="bottom"><img src="!assets/Java/1217276-20190503210424740-1764008697.jpg" alt="img" style="zoom:80%;"></a></p> <ol> <li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ˆå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼‰ å®¢æˆ·æœºå‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ã€‚å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µå†…å®¹ï¼šSYN=1ï¼Œseq=xï¼›SYN=1æ„æ€æ˜¯ä¸€ä¸ªTCPçš„SYNæ ‡å¿—ä½ç½®ä¸º1çš„åŒ…ï¼ŒæŒ‡æ˜å®¢æˆ·ç«¯æ‰“ç®—è¿æ¥çš„æœåŠ¡å™¨çš„ç«¯å£ï¼›seq=xè¡¨ç¤ºå®¢æˆ·ç«¯åˆå§‹åºå·xï¼Œä¿å­˜åœ¨åŒ…å¤´çš„åºåˆ—å·ï¼ˆSequence Numberï¼‰å­—æ®µé‡Œã€‚</li> <li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ˆæœåŠ¡ç«¯å›ä¼ ç¡®è®¤ï¼‰ æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œå¦‚æœåŒæ„å»ºç«‹è¿æ¥ï¼Œå‘å®¢æˆ·æœºå‘å›ç¡®è®¤æŠ¥æ–‡æ®µï¼ˆACKï¼‰åº”ç­”ï¼Œå¹¶ä¸ºè¯¥TCPè¿æ¥åˆ†é…TCPç¼“å­˜å’Œå˜é‡ã€‚æœåŠ¡å™¨å‘å›ç¡®è®¤æŠ¥æ–‡æ®µå†…å®¹ï¼šSYN=1ï¼ŒACK=1ï¼Œseq=yï¼Œack=x+1ï¼›SYNæ ‡å¿—ä½å’ŒACKæ ‡å¿—ä½å‡ä¸º1ï¼ŒåŒæ—¶å°†ç¡®è®¤åºå·ï¼ˆAcknowledgement Numberï¼‰è®¾ç½®ä¸ºå®¢æˆ·çš„ISNåŠ 1ï¼Œå³x+1ï¼›seq=yä¸ºæœåŠ¡ç«¯åˆå§‹åºå·yã€‚</li> <li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ˆå®¢æˆ·ç«¯å›ä¼ ç¡®è®¤ï¼‰ å®¢æˆ·æœºæ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤æŠ¥æ–‡æ®µåï¼Œå‘æœåŠ¡å™¨ç»™å‡ºç¡®è®¤æŠ¥æ–‡æ®µï¼ˆACKï¼‰ï¼Œå¹¶ä¸”ä¹Ÿè¦ç»™è¯¥è¿æ¥åˆ†é…ç¼“å­˜å’Œå˜é‡ã€‚æ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥ESTABLISHEDï¼ˆTCPè¿æ¥æˆåŠŸï¼‰çŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚å®¢æˆ·ç«¯å‘å›ç¡®è®¤æŠ¥æ–‡æ®µå†…å®¹ï¼šACK=1ï¼Œseq=x+1ï¼Œack=y+1ï¼›ACK=1ä¸ºç¡®è®¤æŠ¥æ–‡æ®µï¼›seq=x+1ä¸ºå®¢æˆ·ç«¯åºå·åŠ 1ï¼›ack=y+1,ä¸ºæœåŠ¡å™¨å‘æ¥çš„ACKçš„åˆå§‹åºå·å­—æ®µ+1ã€‚</li> </ol> <p><mark>æ³¨æ„ï¼šæ¡æ‰‹è¿‡ç¨‹ä¸­ä¼ é€çš„åŒ…é‡Œä¸åŒ…å«æ•°æ®ï¼Œä¸‰æ¬¡æ¡æ‰‹å®Œæ¯•åï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ‰æ­£å¼å¼€å§‹ä¼ é€æ•°æ®</mark></p> <hr> <p>TCPå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹å¦‚ä¸‹ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190503231436105-1355677452.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190503231436105-1355677452.png" alt="img" style="zoom:80%;"></a></p> <p>ç”±äºTCPè¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼Œå› æ­¤æ¯ä¸ªæ–¹å‘éƒ½å¿…é¡»å•ç‹¬è¿›è¡Œå…³é—­ã€‚è¿™åŸåˆ™æ˜¯å½“ä¸€æ–¹å®Œæˆå®ƒçš„æ•°æ®å‘é€ä»»åŠ¡åå°±èƒ½å‘é€ä¸€ä¸ªFINæ¥ç»ˆæ­¢è¿™ä¸ªæ–¹å‘çš„è¿æ¥ã€‚æ”¶åˆ°ä¸€ä¸ªFINåªæ„å‘³ç€è¿™ä¸€æ–¹å‘ä¸Šæ²¡æœ‰æ•°æ®æµåŠ¨ï¼Œä¸€ä¸ªTCPè¿æ¥åœ¨æ”¶åˆ°ä¸€ä¸ªFINåä»èƒ½å‘é€æ•°æ®ã€‚é¦–å…ˆè¿›è¡Œå…³é—­çš„ä¸€æ–¹å°†æ‰§è¡Œä¸»åŠ¨å…³é—­ï¼Œè€Œå¦ä¸€æ–¹æ‰§è¡Œè¢«åŠ¨å…³é—­ã€‚</p> <ol> <li>TCPå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„æ•°æ®ä¼ é€ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN_WAIT_1çŠ¶æ€ã€‚å‘é€æŠ¥æ–‡æ®µå†…å®¹ï¼šFIN=1ï¼Œseq=uï¼›FIN=1è¡¨ç¤ºè¯·æ±‚åˆ‡æ–­è¿æ¥ï¼›seq=uä¸ºå®¢æˆ·ç«¯è¯·æ±‚åˆå§‹åºå·ã€‚</li> <li>æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªFINï¼Œå®ƒå‘å›ä¸€ä¸ªACKç»™å®¢æˆ·ç«¯ï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ 1ã€‚å’ŒSYNä¸€æ ·ï¼Œä¸€ä¸ªFINå°†å ç”¨ä¸€ä¸ªåºå·ï¼›æœåŠ¡ç«¯è¿›å…¥CLOSE_WAITçŠ¶æ€ã€‚å‘é€æŠ¥æ–‡æ®µå†…å®¹ï¼šACK=1ï¼Œseq=vï¼Œack=u+1ï¼›ACK=1ä¸ºç¡®è®¤æŠ¥æ–‡ï¼›seq=vä¸ºæœåŠ¡å™¨ç¡®è®¤åˆå§‹åºå·ï¼›ack=u+1ä¸ºå®¢æˆ·ç«¯åˆå§‹åºå·åŠ 1ã€‚</li> <li>æœåŠ¡å™¨å…³é—­å®¢æˆ·ç«¯çš„è¿æ¥åï¼Œå‘é€ä¸€ä¸ªFINç»™å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯è¿›å…¥LAST_ACKçŠ¶æ€ã€‚å‘é€æŠ¥æ–‡æ®µå†…å®¹ï¼šFIN=1ï¼ŒACK=1ï¼Œseq=wï¼Œack=u+1ï¼›FIN=1ä¸ºè¯·æ±‚åˆ‡æ–­è¿æ¥ï¼ŒACK=1ä¸ºç¡®è®¤æŠ¥æ–‡ï¼Œseq=wä¸ºæœåŠ¡ç«¯è¯·æ±‚åˆ‡æ–­åˆå§‹åºå·ã€‚</li> <li>å®¢æˆ·ç«¯æ”¶åˆ°FINåï¼Œå®¢æˆ·ç«¯è¿›å…¥TIME_WAITçŠ¶æ€ï¼Œæ¥ç€å‘å›ä¸€ä¸ªACKæŠ¥æ–‡ç»™æœåŠ¡ç«¯ç¡®è®¤ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºå·åŠ 1ï¼ŒæœåŠ¡ç«¯è¿›å…¥CLOSEDçŠ¶æ€ï¼Œå®Œæˆå››æ¬¡æŒ¥æ‰‹ã€‚å‘é€æŠ¥æ–‡å†…å®¹ï¼šACK=1ï¼Œseq=u+1ï¼Œack=w+1ï¼›ACK=1ä¸ºç¡®è®¤æŠ¥æ–‡ï¼Œseq=u+1ä¸ºå®¢æˆ·ç«¯åˆå§‹åºå·åŠ 1ï¼Œack=w+1ä¸ºæœåŠ¡å™¨åˆå§‹åºå·åŠ 1ã€‚</li> </ol> <p><mark>æ³¨æ„ï¼šä¸ºä»€ä¹ˆè¿æ¥çš„æ—¶å€™æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­çš„æ—¶å€™å´æ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ</mark></p> <p>å› ä¸ºå½“æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„SYNè¿æ¥è¯·æ±‚æŠ¥æ–‡åï¼Œå¯ä»¥ç›´æ¥å‘é€SYN+ACKæŠ¥æ–‡ã€‚å…¶ä¸­ACKæŠ¥æ–‡æ˜¯ç”¨æ¥åº”ç­”çš„ï¼ŒSYNæŠ¥æ–‡æ˜¯ç”¨æ¥åŒæ­¥çš„ã€‚ä½†æ˜¯å…³é—­è¿æ¥æ—¶ï¼Œå½“æœåŠ¡ç«¯æ”¶åˆ°FINæŠ¥æ–‡æ—¶ï¼Œå¾ˆå¯èƒ½å¹¶ä¸ä¼šç«‹å³å…³é—­socketï¼Œæ‰€ä»¥åªèƒ½å…ˆå›å¤ä¸€ä¸ªACKæŠ¥æ–‡ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ï¼Œâ€œä½ å‘çš„FINæŠ¥æ–‡ï¼Œæˆ‘æ”¶åˆ°äº†â€ã€‚åªæœ‰ç­‰åˆ°æœåŠ¡ç«¯æ‰€æœ‰çš„æŠ¥æ–‡éƒ½å‘é€å®Œäº†ï¼Œæˆ‘æ‰èƒ½å‘é€FINæŠ¥æ–‡ï¼Œå› æ­¤ä¸èƒ½ä¸€èµ·å‘é€ï¼Œæ•…éœ€è¦å››æ­¥æŒ¥æ‰‹ã€‚</p> <h5 id="tcpç²˜åŒ…">TCPç²˜åŒ…<a class="headerlink" href="#tcpç²˜åŒ…" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <p>TCPåè®®æ˜¯ç½‘ç»œé€šä¿¡åè®®ä¸­ååˆ†é‡è¦çš„åè®®ï¼Œç›¸æ¯”äºUDPåè®®æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯é çš„ä¼ è¾“åè®®ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªé¢å‘æ•°æ®æµçš„åè®®ï¼›æ‰€è°“é¢å‘æ•°æ®æµï¼Œå…¶å®æ˜¯æŒ‡æ•°æ®ä¼ è¾“æ˜¯ä»¥æµå¼çš„æ–¹å¼ä¼ è¾“ï¼Œè¿™äº›ä¼ è¾“çš„æ•°æ®å°±åƒä¸€æ¡æ²³é‡Œçš„æ°´ï¼Œä»–ä»¬ä¹‹é—´æ˜¯æ²¡æœ‰ç¼éš™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´TCPåè®®ä¼ è¾“çš„æ•°æ®æ˜¯æ— è¾¹ç•Œçš„ï¼›è€ŒUDPæ˜¯é¢å‘æ•°æ®åŒ…çš„ï¼Œæ”¶å‘æ•°æ®åŒ…è¦ä¹ˆå…¨æ”¶è¦ä¹ˆä¸æ”¶ï¼Œæ•°æ®åŒ…ä¸æ•°æ®åŒ…ä¹‹é—´æ˜¯æœ‰æ˜æ˜¾çš„è¾¹ç•Œçš„ã€‚</p> <hr> <p><strong>TCP ç²˜åŒ…</strong></p> <p>ç²˜åŒ…å‘ç”Ÿåœ¨å‘é€æˆ–æ¥æ”¶ç¼“å†²åŒºä¸­ï¼›åº”ç”¨ç¨‹åºä»ç¼“å†²åŒºä¸­å–æ•°æ®æ˜¯æ•´ä¸ªç¼“å†²åŒºä¸­æœ‰å¤šå°‘å–å¤šå°‘ï¼›é‚£ä¹ˆå°±æœ‰å¯èƒ½ç¬¬ä¸€ä¸ªæ•°æ®çš„å°¾éƒ¨å’Œç¬¬äºŒä¸ªæ•°æ®çš„å¤´éƒ¨åŒæ—¶å­˜åœ¨ç¼“å†²åŒºï¼Œè€ŒTCPæ˜¯æµå¼çš„ï¼Œæ•°æ®æ— è¾¹ç•Œï¼Œè¿™æ—¶å‘ç”Ÿç²˜åŒ…ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/SouthEast" data-desc-position="bottom"><img src="!assets/Java/SouthEast" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" style="zoom: 67%;"></a></p> <p><strong>å‘é€æ–¹äº§ç”Ÿç²˜åŒ…</strong></p> <p>é‡‡ç”¨TCPåè®®ä¼ è¾“æ•°æ®çš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç»å¸¸æ˜¯ä¿æŒä¸€ä¸ªé•¿è¿æ¥çš„çŠ¶æ€ï¼ˆä¸€æ¬¡è¿æ¥å‘ä¸€æ¬¡æ•°æ®ä¸å­˜åœ¨ç²˜åŒ…ï¼‰ï¼ŒåŒæ–¹åœ¨è¿æ¥ä¸æ–­å¼€çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¸€ç›´ä¼ è¾“æ•°æ®ï¼›ä½†å½“å‘é€çš„æ•°æ®åŒ…è¿‡äºçš„å°æ—¶ï¼Œé‚£ä¹ˆTCPåè®®é»˜è®¤çš„ä¼šå¯ç”¨Nagleç®—æ³•ï¼Œå°†è¿™äº›è¾ƒå°çš„æ•°æ®åŒ…è¿›è¡Œåˆå¹¶å‘é€ï¼ˆç¼“å†²åŒºæ•°æ®å‘é€æ˜¯ä¸€ä¸ªå †å‹çš„è¿‡ç¨‹ï¼‰ï¼›è¿™ä¸ªåˆå¹¶è¿‡ç¨‹å°±æ˜¯åœ¨å‘é€ç¼“å†²åŒºä¸­è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®å‘é€å‡ºæ¥å®ƒå·²ç»æ˜¯ç²˜åŒ…çš„çŠ¶æ€äº†ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/640-162821934986822" data-desc-position="bottom"><img src="!assets/Java/640-162821934986822" alt="img" style="zoom: 67%;"></a></p> <p><strong>æ¥æ”¶æ–¹äº§ç”Ÿç²˜åŒ…</strong></p> <p>æ¥æ”¶æ–¹é‡‡ç”¨TCPåè®®æ¥æ”¶æ•°æ®æ—¶çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šä»ç½‘ç»œæ¨¡å‹çš„ä¸‹æ–¹ä¼ é€’è‡³ä¼ è¾“å±‚ï¼Œä¼ è¾“å±‚çš„TCPåè®®å¤„ç†æ˜¯å°†å…¶æ”¾ç½®æ¥æ”¶ç¼“å†²åŒºï¼Œç„¶åç”±åº”ç”¨å±‚æ¥ä¸»åŠ¨è·å–ï¼ˆCè¯­è¨€ç”¨recvã€readç­‰å‡½æ•°ï¼‰ï¼›è¿™æ—¶ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ç¨‹åºä¸­è°ƒç”¨çš„è¯»å–æ•°æ®å‡½æ•°ä¸èƒ½åŠæ—¶çš„æŠŠç¼“å†²åŒºä¸­çš„æ•°æ®æ‹¿å‡ºæ¥ï¼Œè€Œä¸‹ä¸€ä¸ªæ•°æ®åˆåˆ°æ¥å¹¶æœ‰ä¸€éƒ¨åˆ†æ”¾å…¥çš„ç¼“å†²åŒºæœ«å°¾ï¼Œç­‰æˆ‘ä»¬è¯»å–æ•°æ®æ—¶å°±æ˜¯ä¸€ä¸ªç²˜åŒ…ï¼›ï¼ˆæ”¾æ•°æ®çš„é€Ÿåº¦ &gt; åº”ç”¨å±‚æ‹¿æ•°æ®é€Ÿåº¦ï¼‰</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/SouthEast-162821939066325" data-desc-position="bottom"><img src="!assets/Java/SouthEast-162821939066325" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" style="zoom: 50%;"></a></p> <hr> <p><strong>TCPç²˜åŒ…è§£å†³æ–¹æ¡ˆ</strong></p> <p>åœ¨æ¶ˆæ¯çš„å¤´éƒ¨æ·»åŠ æ•°æ®åŒ…é•¿åº¦ï¼Œæ¥æ”¶æ–¹æ ¹æ®æ¶ˆæ¯é•¿åº¦è¿›è¡Œæ¥æ”¶ã€‚åœ¨ä¸€æ¡TCPè¿æ¥ä¸Šï¼Œæ•°æ®çš„æµå¼ä¼ è¾“<strong>åœ¨æ¥æ”¶ç¼“å†²åŒºé‡Œ</strong>æ˜¯æœ‰åºçš„ï¼Œå…¶ä¸»è¦çš„é—®é¢˜å°±æ˜¯ç¬¬ä¸€ä¸ªåŒ…çš„åŒ…å°¾ä¸ç¬¬äºŒä¸ªåŒ…çš„åŒ…å¤´å…±å­˜æ¥æ”¶ç¼“å†²åŒºï¼Œæ‰€ä»¥æ ¹æ®é•¿åº¦è¯»å–æ˜¯ååˆ†åˆé€‚çš„ã€‚</p> <p>ä¹Ÿå¯ä»¥ä½¿ç”¨åº”ç”¨ç¨‹åºåœ¨æ¯æ¡æ¶ˆæ¯å¤´å‰é¢åŠ åè®®å¤´ã€å°¾éƒ¨åŠ æ ¡éªŒç ï¼Œ å³ä½¿ç²˜åŒ…äº†ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å…ˆè§£æç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åæŠŠå‰©ä½™çš„æ•°æ®è·Ÿåé¢çš„è¯»å–çš„æ•°æ®å…ˆæ‹¼æ¥ï¼Œç„¶åæ‰¾å‡ºä¸€æ¡å®Œæ•´çš„æ¶ˆæ¯æ•°æ®ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p> <ul> <li> <p>è§£å†³å‘é€æ–¹ç²˜åŒ…</p> <blockquote> <p>å‘é€äº§ç”Ÿæ˜¯å› ä¸ºNagleç®—æ³•åˆå¹¶å°æ•°æ®åŒ…ï¼Œé‚£ä¹ˆå¯ä»¥ç¦ç”¨æ‰è¯¥ç®—æ³•ï¼›</p> <p>TCPæä¾›äº†å¼ºåˆ¶æ•°æ®ç«‹å³ä¼ é€çš„æ“ä½œæŒ‡ä»¤pushï¼Œå½“å¡«å…¥æ•°æ®åè°ƒç”¨æ“ä½œæŒ‡ä»¤å°±å¯ä»¥ç«‹å³å°†æ•°æ®å‘é€ï¼Œè€Œä¸å¿…ç­‰å¾…å‘é€ç¼“å†²åŒºå¡«å……è‡ªåŠ¨å‘é€ï¼›</p> <p>æ•°æ®åŒ…ä¸­åŠ å¤´ï¼Œå¤´éƒ¨ä¿¡æ¯ä¸ºæ•´ä¸ªæ•°æ®çš„é•¿åº¦ï¼ˆæœ€å¹¿æ³›æœ€å¸¸ç”¨ï¼‰ã€‚</p> </blockquote> </li> <li> <p>è§£å†³æ¥æ”¶æ–¹ç²˜åŒ…</p> <blockquote> <p>è§£ææ•°æ®åŒ…å¤´éƒ¨ä¿¡æ¯ï¼Œæ ¹æ®é•¿åº¦æ¥æ¥æ”¶ï¼›</p> <p>çŸ­è¿æ¥ä¼ è¾“ï¼Œå»ºç«‹ä¸€æ¬¡è¿æ¥åªä¼ è¾“ä¸€æ¬¡æ•°æ®å°±å…³é—­ï¼›ï¼ˆä¸æ¨èï¼‰</p> </blockquote> </li> </ul> <h4 id="1323udpåè®®">13.2.3ã€UDPåè®®<a class="headerlink" href="#1323udpåè®®" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>UDPï¼ˆUser Datagram Protocolï¼‰ï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œå®ƒæ˜¯ TCP/IP åè®®ç°‡ä¸­æ— è¿æ¥çš„è¿è¾“å±‚åè®®ã€‚</p> <ol> <li>UDP æ˜¯ä¸€ä¸ªéè¿æ¥çš„åè®®ï¼Œä¼ è¾“æ•°æ®ä¹‹å‰æºç«¯å’Œç»ˆç«¯ä¸å»ºç«‹è¿æ¥ï¼Œå½“å®ƒæƒ³ä¼ é€æ—¶å°±ç®€å•åœ°å»æŠ“å–æ¥è‡ªåº”ç”¨ç¨‹åºçš„æ•°æ®ï¼Œå¹¶å°½å¯èƒ½å¿«åœ°æŠŠå®ƒæ‰”åˆ°ç½‘ç»œä¸Šã€‚åœ¨å‘é€ç«¯ï¼ŒUDP ä¼ é€æ•°æ®çš„é€Ÿåº¦ä»…ä»…æ˜¯å—åº”ç”¨ç¨‹åºç”Ÿæˆæ•°æ®çš„é€Ÿåº¦ã€è®¡ç®—æœºçš„èƒ½åŠ›å’Œä¼ è¾“å¸¦å®½çš„é™åˆ¶ï¼›åœ¨æ¥æ”¶ç«¯ï¼ŒUDP æŠŠæ¯ä¸ªæ¶ˆæ¯æ®µæ”¾åœ¨é˜Ÿåˆ—ä¸­ï¼Œåº”ç”¨ç¨‹åºæ¯æ¬¡ä»é˜Ÿåˆ—ä¸­è¯»ä¸€ä¸ªæ¶ˆæ¯æ®µã€‚</li> <li>ç”±äºä¼ è¾“æ•°æ®ä¸å»ºç«‹è¿æ¥ï¼Œå› æ­¤ä¹Ÿå°±ä¸éœ€è¦ç»´æŠ¤è¿æ¥çŠ¶æ€ï¼ŒåŒ…æ‹¬æ”¶å‘çŠ¶æ€ç­‰ï¼Œå› æ­¤ä¸€å°æœåŠ¡å™¨å¯åŒæ—¶å‘å¤šä¸ªå®¢æˆ·ç«¯ä¼ è¾“ç›¸åŒçš„æ¶ˆæ¯ã€‚</li> <li>UDP ä¿¡æ¯åŒ…çš„æ ‡é¢˜å¾ˆçŸ­ï¼Œåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œç›¸å¯¹äº TCP çš„ 20 ä¸ªå­—èŠ‚ä¿¡æ¯åŒ…çš„é¢å¤–å¼€é”€å¾ˆå°ã€‚</li> <li>ååé‡ä¸å—æ‹¥æŒ¤æ§åˆ¶ç®—æ³•çš„è°ƒèŠ‚ï¼Œåªå—åº”ç”¨è½¯ä»¶ç”Ÿæˆæ•°æ®çš„é€Ÿç‡ã€ä¼ è¾“å¸¦å®½ã€æºç«¯å’Œç»ˆç«¯ä¸»æœºæ€§èƒ½çš„é™åˆ¶ã€‚</li> <li>UDP ä½¿ç”¨å°½é‡æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œå³ä¸ä¿è¯å¯é äº¤ä»˜ï¼Œå› æ­¤ä¸»æœºä¸éœ€è¦ç»´æŒå¤æ‚çš„é“¾æ¥çŠ¶æ€è¡¨ã€‚</li> <li>UDP æ˜¯é¢å‘æŠ¥æ–‡çš„ã€‚å‘é€æ–¹çš„ UDP å¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨å—å°±å‘ä¸‹äº¤ä»˜ç»™ IP å±‚ã€‚æ—¢ä¸æ‹†åˆ†ï¼Œä¹Ÿä¸åˆå¹¶ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œï¼Œå› æ­¤ï¼Œåº”ç”¨ç¨‹åºéœ€è¦é€‰æ‹©åˆé€‚çš„æŠ¥æ–‡å¤§å°ã€‚</li> </ol> <hr> <p><strong>UDPåè®®æ ¼å¼</strong></p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190504154900038-1234898266.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190504154900038-1234898266.png" alt="img" style="zoom:80%;"></a></p> <p>UDPåè®®ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šé¦–éƒ¨å’Œæ•°æ®ã€‚å…¶ä¸­ï¼Œé¦–éƒ¨ä»…æœ‰8ä¸ªå­—èŠ‚ï¼ŒåŒ…æ‹¬æºç«¯å£å’Œç›®çš„ç«¯å£ã€é•¿åº¦ï¼ˆUDPç”¨äºæ•°æ®æŠ¥çš„é•¿åº¦ï¼‰ã€æ ¡éªŒå’Œã€‚</p> <hr> <p><strong>TCPä¸UDPçš„åŒºåˆ«</strong></p> <ol> <li>TCPåŸºäºè¿æ¥ï¼ŒUDPæ˜¯æ— è¿æ¥çš„ï¼›</li> <li>å¯¹ç³»ç»Ÿèµ„æºçš„è¦æ±‚ï¼ŒTCPè¾ƒå¤šï¼ŒUDPè¾ƒå°‘ï¼›</li> <li>UDPç¨‹åºç»“æ„è¾ƒç®€å•ï¼›</li> <li>TCPæ˜¯æµæ¨¡å¼ï¼Œè€ŒUDPæ˜¯æ•°æ®æŠ¥æ¨¡å¼ï¼›</li> <li>TCPä¿è¯æ•°æ®æ­£ç¡®æ€§ï¼Œè€ŒUDPå¯èƒ½ä¸¢åŒ…ï¼›TCPä¿è¯æ•°æ®é¡ºåºï¼Œè€ŒUDPä¸ä¿è¯ã€‚</li> </ol> <h4 id="1324httpåè®®">13.2.4ã€HTTPåè®®<a class="headerlink" href="#1324httpåè®®" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>HTTPï¼ˆHypertext Transfer Protocolï¼‰ï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œå®ƒæ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚HTTPæ˜¯ä¸€ç§åº”ç”¨å±‚åè®®ï¼Œå®ƒæ˜¯åŸºäºTCPåè®®ä¹‹ä¸Šçš„è¯·æ±‚/å“åº”å¼çš„åè®®ã€‚HTTPåè®®æ˜¯Webæµè§ˆå™¨å’ŒWebæœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„æ ‡å‡†åè®®ã€‚HTTPæŒ‡å®šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å¦‚ä½•å»ºç«‹è¿æ¥ã€å®¢æˆ·ç«¯å¦‚ä½•ä»æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡å™¨å¦‚ä½•å“åº”è¯·æ±‚ï¼Œä»¥åŠæœ€åå¦‚ä½•å…³é—­è¿æ¥ã€‚HTTPè¿æ¥ä½¿ç”¨TCP/IPæ¥ä¼ è¾“æ•°æ®ã€‚</p> <p>å¯¹äºä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ¯ä¸€ä¸ªè¯·æ±‚ï¼Œéƒ½æœ‰4ä¸ªæ­¥éª¤ï¼š</p> <ol> <li>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯åœ¨ç«¯å£80æ‰“å¼€ä¸æœåŠ¡å™¨çš„ä¸€ä¸ªTCPè¿æ¥ï¼ŒURLä¸­è¿˜å¯ä»¥æŒ‡å®šå…¶ä»–ç«¯å£ã€‚</li> <li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼Œè¯·æ±‚æŒ‡å®šè·¯å¾„ä¸Šçš„èµ„æºã€‚è¿™ä¸ªèµ„æºåŒ…æ‹¬ä¸€ä¸ªé¦–éƒ¨ï¼Œå¯é€‰åœ°ï¼ˆå–å†³äºè¯·æ±‚çš„æ€§è´¨ï¼‰è¿˜å¯ä»¥æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œåé¢æ˜¯è¿™ä¸ªè¯·æ±‚çš„æ•°æ®ã€‚</li> <li>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€å“åº”ã€‚å“åº”ä»¥å“åº”ç å¼€å¤´ï¼Œåé¢æ˜¯åŒ…å«æ•°æ®çš„é¦–éƒ¨ã€ä¸€ä¸ªç©ºè¡Œä»¥åŠæ‰€è¯·æ±‚çš„æ–‡æ¡£æˆ–é”™è¯¯æ¶ˆæ¯ã€‚</li> <li>æœåŠ¡å™¨å…³é—­è¿æ¥ã€‚</li> </ol> <p>ç°åœ¨ä½¿ç”¨çš„HTTPåè®®æ˜¯HTTP/1.1ç‰ˆæœ¬ï¼Œ1997å¹´ä¹‹å‰é‡‡ç”¨çš„æ˜¯HTTP1.0ç‰ˆæœ¬ã€‚HTTPè¿æ¥åœ¨1.0ç‰ˆæœ¬ä¸­é‡‡ç”¨éæŒç»­è¿æ¥å·¥ä½œæ–¹å¼ï¼Œ1.1ç‰ˆæœ¬é‡‡ç”¨çš„æ˜¯æŒç»­è¿æ¥å·¥ä½œæ–¹å¼ï¼ŒæŒç»­è¿æ¥æ˜¯æŒ‡æœåŠ¡å™¨åœ¨å‘é€å“åº”åä»ç„¶åœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒè¿™æ¡ç”±TCPè¿è¾“å±‚åè®®å»ºç«‹èµ·æ¥çš„è¿æ¥ï¼Œä½¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥ç»§ç»­åœ¨è¿™æ¡è¿æ¥ä¸Šä¼ è¾“HTTPæŠ¥æ–‡ã€‚</p> <p>æ˜¯å¦é‡‡ç”¨æŒç»­è¿æ¥å·¥ä½œæ–¹å¼ï¼Œ1.0ä¸­é»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦åœ¨HTTPå¤´åŠ å…¥â€œConnection:Keep-Aliveâ€ï¼Œæ‰èƒ½å¯ç”¨Keep-Aliveã€‚HTTP1.1ä¸­é»˜è®¤å¯ç”¨Keep-Aliveï¼Œå¦‚æœåŠ å…¥â€œConnection:closeâ€ï¼Œæ‰å…³é—­ã€‚ç›®å‰å¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½æ˜¯ç”¨HTTP1.1åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤éƒ½ä¼šå‘èµ·Keep-Aliveçš„è¿æ¥è¯·æ±‚äº†ï¼Œæ‰€ä»¥æ˜¯å¦èƒ½å®Œæˆä¸€ä¸ªå®Œæ•´çš„Keep-Aliveè¿æ¥å°±çœ‹æœåŠ¡å™¨è®¾ç½®æƒ…å†µã€‚</p> <hr> <p><strong>HTTPæŠ¥æ–‡</strong></p> <p>HTTPåè®®æ˜¯åŸºäºTCPåè®®ä¹‹ä¸Šçš„è¯·æ±‚/å“åº”å¼åè®®ï¼Œä¸‹é¢ä¸»è¦ä»‹ç»HTTPæŠ¥æ–‡çš„æ ¼å¼ï¼ŒHTTPæŠ¥æ–‡ä¸»è¦æœ‰è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ä¸¤ç§ã€‚</p> <p>HTTPè¯·æ±‚æŠ¥æ–‡çš„æ ¼å¼ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190504230113716-231823746.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190504230113716-231823746.png" alt="img" style="zoom:80%;"></a></p> <p>HTTPè¯·æ±‚æŠ¥æ–‡ç”±<strong>è¯·æ±‚è¡Œã€é¦–éƒ¨è¡Œå’Œå®ä½“ä¸»ä½“</strong>ç»„æˆï¼Œç”±æµè§ˆå™¨å‘é€ç»™æœåŠ¡å™¨ã€‚ä¸Šé¢è¿™å¼ å›¾ä¸­SPè¡¨ç¤ºç©ºæ ¼ï¼Œcr lfè¡¨ç¤ºå›è½¦å’Œæ¢è¡Œã€‚ä¸‹å›¾æ˜¯è°·æ­Œæµè§ˆå™¨å†…è®¿é—®æœåŠ¡å™¨æŸ¥çœ‹çš„HTTPè¯·æ±‚ä¾‹å­ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190505002716130-1447539444.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190505002716130-1447539444.png" alt="img" style="zoom:80%;"></a></p> <p>HTTPå“åº”æŠ¥æ–‡æ ¼å¼ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190505001517048-1489396333.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190505001517048-1489396333.png" alt="img" style="zoom:80%;"></a></p> <p>ä¸Šé¢è¿™å¼ å›¾æ˜¯HTTPå“åº”æŠ¥æ–‡ï¼Œå®ƒç”±<strong>çŠ¶æ€è¡Œã€é¦–éƒ¨è¡Œå’Œå®ä½“ä¸»ä½“</strong>ç»„æˆã€‚ä¸‹å›¾ä¸ºHTTPå“åº”æŠ¥æ–‡ä¾‹å­ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190505003116790-1900233646.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190505003116790-1900233646.png" alt="img" style="zoom:80%;"></a></p> <hr> <p><strong>HTTPè¯·æ±‚æ–¹æ³•å’Œå“åº”çŠ¶æ€ç </strong></p> <p>åœ¨ä¸Šé¢çš„HTTPè¯·æ±‚æŠ¥æ–‡ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚æ–¹æ³•æ˜¯GETï¼Œè¿™è¡¨ç¤ºè¯·æ±‚è¯»å–ç”±URLæ‰€æ ‡å¿—çš„ä¿¡æ¯ï¼Œé™¤äº†GETï¼Œè¿˜æœ‰å…¶ä»–å‡ ç§å¸¸ç”¨çš„æ–¹æ³•ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190505003337425-1910585386.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190505003337425-1910585386.png" alt="img" style="zoom:80%;"></a></p> <p>åœ¨HTTPå“åº”æŠ¥æ–‡çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ°çŠ¶æ€ç æ˜¯200ï¼Œè¡¨ç¤ºå“åº”æˆåŠŸã€‚ä¸‹è¡¨æ˜¯å…¶ä»–çŠ¶æ€ç ï¼Œæ€»å…±5å¤§ç±»ï¼Œ33ç§ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1217276-20190505004242552-665354194.png" data-desc-position="bottom"><img src="!assets/Java/1217276-20190505004242552-665354194.png" alt="img" style="zoom:80%;"></a></p> <hr> <p><strong>HTTPå’ŒHTTPSçš„åŒºåˆ«</strong></p> <p>HTTPSï¼ˆå…¨ç§°ï¼šHyper Text Transfer Protocol over Secure Socket Layerï¼‰ï¼Œæ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„HTTPé€šé“ï¼Œç®€å•æ¥è¯´å°±æ˜¯HTTPçš„å®‰å…¨ç‰ˆã€‚å³HTTPä¸‹åŠ å…¥SSLå±‚ï¼ŒHTTPSçš„å®‰å…¨åŸºç¡€æ˜¯SSLï¼Œå› æ­¤åŠ å¯†çš„è¯¦ç»†å†…å®¹å°±éœ€è¦SSLã€‚å®ƒæ˜¯ä¸€ä¸ªURL schemeï¼ˆæŠ½è±¡æ ‡è¯†ç¬¦ä½“ç³»ï¼‰ï¼Œå¥æ³•ç±»åŒhttp:ä½“ç³»ï¼Œç”¨äºå®‰å…¨çš„HTTPæ•°æ®ä¼ è¾“ã€‚https:URLè¡¨æ˜å®ƒä½¿ç”¨äº†HTTPï¼Œä½†HTTPSå­˜åœ¨ä¸åŒäºHTTPçš„é»˜è®¤ç«¯å£åŠä¸€ä¸ªåŠ å¯†/èº«ä»½éªŒè¯å±‚ï¼ˆåœ¨HTTPä¸TCPä¹‹é—´ï¼‰ã€‚</p> <p>HTTPåè®®è¢«ç”¨äºåœ¨Webæµè§ˆå™¨å’Œç½‘ç«™æœåŠ¡å™¨ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚HTTPåè®®ä»¥æ˜æ–‡æ–¹å¼å‘é€å†…å®¹ï¼Œä¸æä¾›ä»»ä½•æ–¹å¼çš„æ•°æ®åŠ å¯†ï¼Œå¦‚æœæ”»å‡»è€…æˆªå–äº†Webæµè§ˆå™¨å’Œç½‘ç«™æœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“æŠ¥æ–‡ï¼Œå°±å¯ä»¥ç›´æ¥è¯»æ‡‚å…¶ä¸­çš„ä¿¡æ¯ï¼Œå› æ­¤HTTPåè®®ä¸é€‚åˆä¼ è¾“ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ä¿¡ç”¨å¼€å·ã€å¯†ç ç­‰ã€‚</p> <p>ä¸ºäº†è§£å†³HTTPåè®®çš„è¿™ä¸€ç¼ºé™·ï¼Œéœ€è¦ä½¿ç”¨å¦ä¸€ç§åè®®ï¼šå®‰å…¨å¥—æ¥å­—å±‚è¶…æ–‡æœ¬ä¼ è¾“åè®®HTTPSã€‚ä¸ºäº†æ•°æ®ä¼ è¾“çš„å®‰å…¨ï¼ŒHTTPSåœ¨HTTPçš„åŸºç¡€ä¸ŠåŠ å…¥äº†SSLåè®®ï¼ŒSSLä¾é è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œå¹¶ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡åŠ å¯†ã€‚</p> <p>HTTPSå’ŒHTTPçš„åŒºåˆ«ä¸»è¦ä¸ºä»¥ä¸‹å››ç‚¹ï¼š</p> <ul> <li>httpsåè®®éœ€è¦åˆ°caç”³è¯·è¯ä¹¦ï¼Œä¸€èˆ¬å…è´¹è¯ä¹¦å¾ˆå°‘ï¼Œéœ€è¦ç¼´è´¹ã€‚</li> <li>httpæ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¿¡æ¯æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œhttpsåˆ™æ˜¯å…·æœ‰å®‰å…¨æ€§çš„sslåŠ å¯†ä¼ è¾“åè®®ã€‚</li> <li>httpå’Œhttpsä½¿ç”¨çš„æ˜¯å®Œå…¨ä¸åŒçš„è¿æ¥æ–¹å¼ï¼Œç”¨çš„ç«¯å£ä¹Ÿä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯80ï¼Œåè€…æ˜¯443ã€‚</li> <li>httpçš„è¿æ¥å¾ˆç®€å•ï¼Œæ˜¯æ— çŠ¶æ€çš„ï¼›httpsåè®®æ˜¯æœ‰ssl+httpåè®®æ„å»ºçš„å¯è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€èº«ä»½è®¤è¯çš„ç½‘ç»œåè®®ï¼Œæ¯”httpåè®®å®‰å…¨ã€‚</li> </ul> <hr> <p><strong>HTTPå’ŒTCP/IPåè®®çš„å…³ç³»</strong></p> <p>ç½‘ç»œä¸­æœ‰ä¸€æ®µæ¯”è¾ƒå®¹æ˜“ç†è§£çš„ä»‹ç»ï¼š</p> <p>â€œæˆ‘ä»¬åœ¨ä¼ è¾“æ•°æ®æ—¶ï¼Œå¯ä»¥åªä½¿ç”¨ï¼ˆä¼ è¾“å±‚ï¼‰TCP/IPåè®®ï¼Œä½†æ˜¯é‚£æ ·çš„è¯ï¼Œå¦‚æœæ²¡æœ‰åº”ç”¨å±‚ï¼Œä¾¿æ— æ³•è¯†åˆ«æ•°æ®å†…å®¹ï¼Œå¦‚æœæƒ³è¦ä½¿ä¼ è¾“çš„æ•°æ®æœ‰æ„ä¹‰ï¼Œåˆ™å¿…é¡»ä½¿ç”¨åˆ°åº”ç”¨å±‚åè®®ï¼Œåº”ç”¨å±‚åè®®æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚HTTPã€FTPã€TELNETç­‰ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰åº”ç”¨å±‚åè®®ã€‚WEBä½¿ç”¨HTTPåè®®ä½œåº”ç”¨å±‚åè®®ï¼Œä»¥å°è£…HTTPæ–‡æœ¬ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨TCP/IPåšä¼ è¾“å±‚åè®®å°†å®ƒå‘åˆ°ç½‘ç»œä¸Šã€‚â€</p> <h3 id="133socket">13.3ã€Socket<a class="headerlink" href="#133socket" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <h4 id="1331socketæ¦‚è¿°">13.3.1ã€Socketæ¦‚è¿°<a class="headerlink" href="#1331socketæ¦‚è¿°" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Javaçš„ç½‘ç»œç¼–ç¨‹ä¸»è¦æ¶‰åŠåˆ°çš„å†…å®¹æ˜¯Socketç¼–ç¨‹ã€‚Socketï¼Œå¥—æ¥å­—ï¼Œå°±æ˜¯ä¸¤å°ä¸»æœºä¹‹é—´é€»è¾‘è¿æ¥çš„ç«¯ç‚¹ã€‚TCP/IPåè®®æ˜¯ä¼ è¾“å±‚åè®®ï¼Œä¸»è¦è§£å†³æ•°æ®å¦‚ä½•åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œè€ŒHTTPæ˜¯åº”ç”¨å±‚åè®®ï¼Œä¸»è¦è§£å†³å¦‚ä½•åŒ…è£…æ•°æ®ã€‚Socketæ˜¯é€šä¿¡çš„åŸºçŸ³ï¼Œæ˜¯æ”¯æŒTCP/IPåè®®çš„ç½‘ç»œé€šä¿¡çš„åŸºæœ¬æ“ä½œå•å…ƒã€‚å®ƒæ˜¯ç½‘ç»œé€šä¿¡è¿‡ç¨‹ä¸­ç«¯ç‚¹çš„æŠ½è±¡è¡¨ç¤ºï¼ŒåŒ…å«è¿›è¡Œç½‘ç»œé€šä¿¡å¿…é¡»çš„äº”ç§ä¿¡æ¯ï¼šè¿æ¥ä½¿ç”¨çš„åè®®ã€æœ¬åœ°ä¸»æœºçš„IPåœ°å€ã€æœ¬åœ°è¿›ç¨‹çš„åè®®ç«¯å£ã€è¿œç¨‹ä¸»æœºçš„IPåœ°å€ã€è¿œç¨‹è¿›ç¨‹çš„åè®®ç«¯å£ã€‚</p> <p>åº”ç”¨å±‚é€šè¿‡ä¼ è¾“å±‚è¿›è¡Œæ•°æ®é€šä¿¡æ—¶ï¼ŒTCPä¼šé‡åˆ°åŒæ—¶ä¸ºå¤šä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹æä¾›å¹¶å‘æœåŠ¡çš„é—®é¢˜ã€‚å¤šä¸ªTCPè¿æ¥æˆ–å¤šä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹å¯èƒ½éœ€è¦é€šè¿‡åŒä¸€ä¸ªTCPåè®®ç«¯å£ä¼ è¾“æ•°æ®ã€‚ä¸ºäº†åŒºåˆ«ä¸åŒçš„åº”ç”¨ç¨‹åºè¿›ç¨‹å’Œè¿æ¥ï¼Œè®¸å¤šè®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸ºåº”ç”¨ç¨‹åºä¸TCP/IPåè®®äº¤äº’æä¾›äº†å¥—æ¥å­—ï¼ˆSocketï¼‰æ¥å£ã€‚åº”ç”¨å±‚å¯ä»¥å’Œä¼ è¾“å±‚é€šè¿‡Socketæ¥å£ï¼ŒåŒºåˆ†æ¥è‡ªä¸åŒåº”ç”¨ç¨‹åºè¿›ç¨‹æˆ–ç½‘ç»œè¿æ¥çš„é€šä¿¡ï¼Œå®ç°æ•°æ®ä¼ è¾“çš„å¹¶å‘æœåŠ¡ã€‚</p> <p>Socketï¼Œå®é™…ä¸Šæ˜¯å¯¹TCP/IPåè®®çš„å°è£…ï¼ŒSocketæœ¬èº«å¹¶ä¸æ˜¯åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªè°ƒç”¨æ¥å£ï¼ˆAPIï¼‰ï¼Œé€šè¿‡Socketï¼Œæˆ‘ä»¬æ‰èƒ½ä½¿ç”¨TCP/IPåè®®ã€‚å®é™…ä¸Šï¼ŒSocketè·ŸTCP/IPåè®®æ²¡æœ‰å¿…ç„¶çš„å…³ç³»ï¼ŒSocketç¼–ç¨‹æ¥å£åœ¨è®¾è®¡çš„æ—¶å€™ï¼Œå°±å¸Œæœ›ä¹Ÿèƒ½é€‚åº”å…¶ä»–çš„ç½‘ç»œåè®®ã€‚æ‰€ä»¥è¯´ï¼ŒSocketçš„å‡ºç°ï¼Œåªæ˜¯ä½¿å¾—ç¨‹åºå‘˜æ›´æ–¹ä¾¿åœ°ä½¿ç”¨TCP/IPåè®®æ ˆè€Œå·²ï¼Œæ˜¯å¯¹TCP/IPåè®®çš„æŠ½è±¡ï¼Œä»è€Œå½¢æˆäº†æˆ‘ä»¬çŸ¥é“çš„ä¸€äº›æœ€åŸºæœ¬çš„å‡½æ•°æ¥å£ï¼Œæ¯”å¦‚createã€listenã€acceptã€sendã€readå’Œwriteç­‰ç­‰ã€‚ç½‘ç»œæœ‰ä¸€æ®µå…³äºsocketå’ŒTCP/IPåè®®å…³ç³»çš„è¯´æ³•æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼š</p> <p>â€œTCP/IPåªæ˜¯ä¸€ä¸ªåè®®æ ˆï¼Œå°±åƒæ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶ä¸€æ ·ï¼Œå¿…é¡»è¦å…·ä½“å®ç°ï¼ŒåŒæ—¶è¿˜è¦æä¾›å¯¹å¤–çš„æ“ä½œæ¥å£ã€‚è¿™ä¸ªå°±åƒæ“ä½œç³»ç»Ÿä¼šæä¾›æ ‡å‡†çš„ç¼–ç¨‹æ¥å£ï¼Œæ¯”å¦‚win32ç¼–ç¨‹æ¥å£ä¸€æ ·ï¼ŒTCP/IPä¹Ÿè¦æä¾›å¯ä¾›ç¨‹åºå‘˜åšç½‘ç»œå¼€å‘æ‰€ç”¨çš„æ¥å£ï¼Œè¿™å°±æ˜¯Socketç¼–ç¨‹æ¥å£ã€‚â€ </p> <p>å®é™…ä¸Šï¼Œä¼ è¾“å±‚çš„TCPæ˜¯åŸºäºç½‘ç»œå±‚çš„IPåè®®çš„ï¼Œè€Œåº”ç”¨å±‚çš„HTTPåè®®åˆæ˜¯åŸºäºä¼ è¾“å±‚çš„TCPåè®®çš„ï¼Œè€ŒSocketæœ¬èº«ä¸ç®—æ˜¯åè®®ï¼Œå°±åƒä¸Šé¢æ‰€è¯´ï¼Œå®ƒåªæ˜¯æä¾›äº†ä¸€ä¸ªé’ˆå¯¹TCPæˆ–è€…UDPç¼–ç¨‹çš„æ¥å£ã€‚socketæ˜¯å¯¹ç«¯å£é€šä¿¡å¼€å‘çš„å·¥å…·,å®ƒè¦æ›´åº•å±‚ä¸€äº›ã€‚</p> <h4 id="1332å¥—æ¥å­—æœ‰å“ªäº›ç±»å‹">13.3.2ã€å¥—æ¥å­—æœ‰å“ªäº›ç±»å‹<a class="headerlink" href="#1332å¥—æ¥å­—æœ‰å“ªäº›ç±»å‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>è¿™ä¸ªä¸–ç•Œä¸Šæœ‰å¾ˆå¤šç§å¥—æ¥å­—ï¼ˆsocketï¼‰ï¼Œæ¯”å¦‚ DARPA Internet åœ°å€ï¼ˆInternet å¥—æ¥å­—ï¼‰ã€æœ¬åœ°èŠ‚ç‚¹çš„è·¯å¾„åï¼ˆUnixå¥—æ¥å­—ï¼‰ã€CCITT X.25åœ°å€ï¼ˆX.25 å¥—æ¥å­—ï¼‰ç­‰ã€‚ä½†æœ¬æ•™ç¨‹åªè®²ç¬¬ä¸€ç§å¥—æ¥å­—â€”â€”Internet å¥—æ¥å­—ï¼Œå®ƒæ˜¯æœ€å…·ä»£è¡¨æ€§çš„ï¼Œä¹Ÿæ˜¯æœ€ç»å…¸æœ€å¸¸ç”¨çš„ã€‚</p> <p>æ ¹æ®æ•°æ®çš„ä¼ è¾“æ–¹å¼ï¼Œå¯ä»¥å°† Internet å¥—æ¥å­—åˆ†æˆä¸¤ç§ç±»å‹ã€‚é€šè¿‡ socket() å‡½æ•°åˆ›å»ºè¿æ¥æ—¶ï¼Œå¿…é¡»å‘Šè¯‰å®ƒä½¿ç”¨å“ªç§æ•°æ®ä¼ è¾“æ–¹å¼ã€‚</p> <hr> <p><strong>æµæ ¼å¼å¥—æ¥å­—ï¼ˆSOCK_STREAMï¼‰</strong></p> <p>æµæ ¼å¼å¥—æ¥å­—ï¼ˆStream Socketsï¼‰ä¹Ÿå«â€œé¢å‘è¿æ¥çš„å¥—æ¥å­—â€ï¼Œåœ¨ä»£ç ä¸­ä½¿ç”¨ SOCK_STREAM è¡¨ç¤ºã€‚</p> <p><mark>SOCK_STREAM æ˜¯ä¸€ç§å¯é çš„ã€åŒå‘çš„é€šä¿¡æ•°æ®æµï¼Œæ•°æ®å¯ä»¥å‡†ç¡®æ— è¯¯åœ°åˆ°è¾¾å¦ä¸€å°è®¡ç®—æœºï¼Œå¦‚æœæŸåæˆ–ä¸¢å¤±ï¼Œå¯ä»¥é‡æ–°å‘é€ã€‚</mark></p> <p>SOCK_STREAM æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹å¾ï¼š</p> <ul> <li>æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šæ¶ˆå¤±ï¼›</li> <li>æ•°æ®æ˜¯æŒ‰ç…§é¡ºåºä¼ è¾“çš„ï¼›</li> <li>æ•°æ®çš„å‘é€å’Œæ¥æ”¶ä¸æ˜¯åŒæ­¥çš„ï¼ˆæœ‰çš„æ•™ç¨‹ä¹Ÿç§°â€œä¸å­˜åœ¨æ•°æ®è¾¹ç•Œâ€ï¼‰ã€‚</li> </ul> <p>å¯ä»¥å°† SOCK_STREAM æ¯”å–»æˆä¸€æ¡ä¼ é€å¸¦ï¼Œåªè¦ä¼ é€å¸¦æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼ˆä¸ä¼šæ–­ç½‘ï¼‰ï¼Œå°±èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼›åŒæ—¶ï¼Œè¾ƒæ™šä¼ é€çš„æ•°æ®ä¸ä¼šå…ˆåˆ°è¾¾ï¼Œè¾ƒæ—©ä¼ é€çš„æ•°æ®ä¸ä¼šæ™šåˆ°è¾¾ï¼Œè¿™å°±ä¿è¯äº†æ•°æ®æ˜¯æŒ‰ç…§é¡ºåºä¼ é€’çš„ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1-1Z1232154153L.gif" data-desc-position="bottom"><img src="!assets/Java/1-1Z1232154153L.gif" alt="å°†é¢å‘è¿æ¥çš„å¥—æ¥å­—æ¯”å–»æˆä¼ é€å¸¦" style="zoom:80%;"></a></p> <p>ä¸ºä»€ä¹ˆæµæ ¼å¼å¥—æ¥å­—å¯ä»¥è¾¾åˆ°é«˜è´¨é‡çš„æ•°æ®ä¼ è¾“å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå®ƒä½¿ç”¨äº† TCP åè®®ï¼ˆThe Transmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼‰ï¼ŒTCP åè®®ä¼šæ§åˆ¶ä½ çš„æ•°æ®æŒ‰ç…§é¡ºåºåˆ°è¾¾å¹¶ä¸”æ²¡æœ‰é”™è¯¯ã€‚</p> <p>ä½ ä¹Ÿè®¸è§è¿‡ TCPï¼Œæ˜¯å› ä¸ºä½ ç»å¸¸å¬è¯´â€œTCP/IPâ€ã€‚TCP ç”¨æ¥ç¡®ä¿æ•°æ®çš„æ­£ç¡®æ€§ï¼ŒIPï¼ˆInternet Protocolï¼Œç½‘ç»œåè®®ï¼‰ç”¨æ¥æ§åˆ¶æ•°æ®å¦‚ä½•ä»æºå¤´åˆ°è¾¾ç›®çš„åœ°ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„â€œè·¯ç”±â€ã€‚</p> <p>å‡è®¾ä¼ é€å¸¦ä¼ é€çš„æ˜¯æ°´æœï¼Œæ¥æ”¶è€…éœ€è¦å‡‘é½ 100 ä¸ªåæ‰èƒ½è£…è¢‹ï¼Œä½†æ˜¯ä¼ é€å¸¦å¯èƒ½æŠŠè¿™ 100 ä¸ªæ°´æœåˆ†æ‰¹ä¼ é€ï¼Œæ¯”å¦‚ç¬¬ä¸€æ‰¹ä¼ é€ 20 ä¸ªï¼Œç¬¬äºŒæ‰¹ä¼ é€ 50 ä¸ªï¼Œç¬¬ä¸‰æ‰¹ä¼ é€ 30 ä¸ªã€‚æ¥æ”¶è€…ä¸éœ€è¦å’Œä¼ é€å¸¦ä¿æŒåŒæ­¥ï¼Œåªè¦æ ¹æ®è‡ªå·±çš„èŠ‚å¥æ¥è£…è¢‹å³å¯ï¼Œä¸ç”¨ç®¡ä¼ é€å¸¦ä¼ é€äº†å‡ æ‰¹ï¼Œä¹Ÿä¸ç”¨æ¯åˆ°ä¸€æ‰¹å°±è£…è¢‹ä¸€æ¬¡ï¼Œå¯ä»¥ç­‰åˆ°å‡‘å¤Ÿäº† 100 ä¸ªæ°´æœå†è£…è¢‹ã€‚</p> <p>æµæ ¼å¼å¥—æ¥å­—çš„å†…éƒ¨æœ‰ä¸€ä¸ªç¼“å†²åŒºï¼ˆä¹Ÿå°±æ˜¯å­—ç¬¦æ•°ç»„ï¼‰ï¼Œé€šè¿‡ socket ä¼ è¾“çš„æ•°æ®å°†ä¿å­˜åˆ°è¿™ä¸ªç¼“å†²åŒºã€‚æ¥æ”¶ç«¯åœ¨æ”¶åˆ°æ•°æ®åå¹¶ä¸ä¸€å®šç«‹å³è¯»å–ï¼Œåªè¦æ•°æ®ä¸è¶…è¿‡ç¼“å†²åŒºçš„å®¹é‡ï¼Œæ¥æ”¶ç«¯æœ‰å¯èƒ½åœ¨ç¼“å†²åŒºè¢«å¡«æ»¡ä»¥åä¸€æ¬¡æ€§åœ°è¯»å–ï¼Œä¹Ÿå¯èƒ½åˆ†æˆå¥½å‡ æ¬¡è¯»å–ã€‚</p> <p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡æ•°æ®åˆ†å‡ æ¬¡ä¼ é€è¿‡æ¥ï¼Œæ¥æ”¶ç«¯åªéœ€è¦æ ¹æ®è‡ªå·±çš„è¦æ±‚è¯»å–ï¼Œä¸ç”¨éå¾—åœ¨æ•°æ®åˆ°è¾¾æ—¶ç«‹å³è¯»å–ã€‚ä¼ é€ç«¯æœ‰è‡ªå·±çš„èŠ‚å¥ï¼Œæ¥æ”¶ç«¯ä¹Ÿæœ‰è‡ªå·±çš„èŠ‚å¥ï¼Œå®ƒä»¬æ˜¯ä¸ä¸€è‡´çš„ã€‚</p> <p>æµæ ¼å¼å¥—æ¥å­—æœ‰ä»€ä¹ˆå®é™…çš„åº”ç”¨åœºæ™¯å—ï¼Ÿæµè§ˆå™¨æ‰€ä½¿ç”¨çš„ http åè®®å°±åŸºäºé¢å‘è¿æ¥çš„å¥—æ¥å­—ï¼Œå› ä¸ºå¿…é¡»è¦ç¡®ä¿æ•°æ®å‡†ç¡®æ— è¯¯ï¼Œå¦åˆ™åŠ è½½çš„ HTML å°†æ— æ³•è§£æã€‚</p> <hr> <p><strong>æ•°æ®æŠ¥æ ¼å¼å¥—æ¥å­—ï¼ˆSOCK_DGRAMï¼‰</strong></p> <p>æ•°æ®æŠ¥æ ¼å¼å¥—æ¥å­—ï¼ˆDatagram Socketsï¼‰ä¹Ÿå«â€œæ— è¿æ¥çš„å¥—æ¥å­—â€ï¼Œåœ¨ä»£ç ä¸­ä½¿ç”¨ SOCK_DGRAM è¡¨ç¤ºã€‚</p> <p>è®¡ç®—æœºåªç®¡ä¼ è¾“æ•°æ®ï¼Œä¸ä½œæ•°æ®æ ¡éªŒï¼Œå¦‚æœæ•°æ®åœ¨ä¼ è¾“ä¸­æŸåï¼Œæˆ–è€…æ²¡æœ‰åˆ°è¾¾å¦ä¸€å°è®¡ç®—æœºï¼Œæ˜¯æ²¡æœ‰åŠæ³•è¡¥æ•‘çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®é”™äº†å°±é”™äº†ï¼Œæ— æ³•é‡ä¼ ã€‚</p> <p>å› ä¸ºæ•°æ®æŠ¥å¥—æ¥å­—æ‰€åšçš„æ ¡éªŒå·¥ä½œå°‘ï¼Œæ‰€ä»¥åœ¨ä¼ è¾“æ•ˆç‡æ–¹é¢æ¯”æµæ ¼å¼å¥—æ¥å­—è¦é«˜ã€‚</p> <p>å¯ä»¥å°† SOCK_DGRAM æ¯”å–»æˆé«˜é€Ÿç§»åŠ¨çš„æ‘©æ‰˜è½¦å¿«é€’ï¼Œå®ƒæœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p> <ul> <li>å¼ºè°ƒå¿«é€Ÿä¼ è¾“è€Œéä¼ è¾“é¡ºåºï¼›</li> <li>ä¼ è¾“çš„æ•°æ®å¯èƒ½ä¸¢å¤±ä¹Ÿå¯èƒ½æŸæ¯ï¼›</li> <li>é™åˆ¶æ¯æ¬¡ä¼ è¾“çš„æ•°æ®å¤§å°ï¼›</li> <li>æ•°æ®çš„å‘é€å’Œæ¥æ”¶æ˜¯åŒæ­¥çš„ï¼ˆæœ‰çš„æ•™ç¨‹ä¹Ÿç§°â€œå­˜åœ¨æ•°æ®è¾¹ç•Œâ€ï¼‰ã€‚</li> </ul> <p>ä¼—æ‰€å‘¨çŸ¥ï¼Œé€Ÿåº¦æ˜¯å¿«é€’è¡Œä¸šçš„ç”Ÿå‘½ã€‚ç”¨æ‘©æ‰˜è½¦å‘å¾€åŒä¸€åœ°ç‚¹çš„ä¸¤ä»¶åŒ…è£¹æ— éœ€ä¿è¯é¡ºåºï¼Œåªè¦ä»¥æœ€å¿«çš„é€Ÿåº¦äº¤ç»™å®¢æˆ·å°±è¡Œã€‚è¿™ç§æ–¹å¼å­˜åœ¨æŸåæˆ–ä¸¢å¤±çš„é£é™©ï¼Œè€Œä¸”åŒ…è£¹å¤§å°æœ‰ä¸€å®šé™åˆ¶ã€‚å› æ­¤ï¼Œæƒ³è¦ä¼ é€’å¤§é‡åŒ…è£¹ï¼Œå°±å¾—åˆ†é…å‘é€ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/1-1Z123222015527.gif" data-desc-position="bottom"><img src="!assets/Java/1-1Z123222015527.gif" alt="å°†æ— è¿æ¥å¥—æ¥å­—æ¯”å–»æˆæ‘©æ‰˜è½¦å¿«é€’" style="zoom:80%;"></a></p> <p>å¦å¤–ï¼Œç”¨ä¸¤è¾†æ‘©æ‰˜è½¦åˆ†åˆ«å‘é€ä¸¤ä»¶åŒ…è£¹ï¼Œé‚£ä¹ˆæ¥æ”¶è€…ä¹Ÿéœ€è¦åˆ†ä¸¤æ¬¡æ¥æ”¶ï¼Œæ‰€ä»¥â€œæ•°æ®çš„å‘é€å’Œæ¥æ”¶æ˜¯åŒæ­¥çš„â€ï¼›æ¢å¥è¯è¯´ï¼Œæ¥æ”¶æ¬¡æ•°åº”è¯¥å’Œå‘é€æ¬¡æ•°ç›¸åŒã€‚</p> <p><mark>æ€»ä¹‹ï¼Œæ•°æ®æŠ¥å¥—æ¥å­—æ˜¯ä¸€ç§ä¸å¯é çš„ã€ä¸æŒ‰é¡ºåºä¼ é€’çš„ã€ä»¥è¿½æ±‚é€Ÿåº¦ä¸ºç›®çš„çš„å¥—æ¥å­—ã€‚</mark></p> <p>æ•°æ®æŠ¥å¥—æ¥å­—ä¹Ÿä½¿ç”¨ IP åè®®ä½œè·¯ç”±ï¼Œä½†æ˜¯å®ƒä¸ä½¿ç”¨ TCP åè®®ï¼Œè€Œæ˜¯ä½¿ç”¨ UDP åè®®ï¼ˆUser Datagram Protocolï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ã€‚</p> <p>QQ è§†é¢‘èŠå¤©å’Œè¯­éŸ³èŠå¤©å°±ä½¿ç”¨ SOCK_DGRAM æ¥ä¼ è¾“æ•°æ®ï¼Œå› ä¸ºé¦–å…ˆè¦ä¿è¯é€šä¿¡çš„æ•ˆç‡ï¼Œå°½é‡å‡å°å»¶è¿Ÿï¼Œè€Œæ•°æ®çš„æ­£ç¡®æ€§æ˜¯æ¬¡è¦çš„ï¼Œå³ä½¿ä¸¢å¤±å¾ˆå°çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œè§†é¢‘å’ŒéŸ³é¢‘ä¹Ÿå¯ä»¥æ­£å¸¸è§£æï¼Œæœ€å¤šå‡ºç°å™ªç‚¹æˆ–æ‚éŸ³ï¼Œä¸ä¼šå¯¹é€šä¿¡è´¨é‡æœ‰å®è´¨çš„å½±å“ã€‚</p> <h3 id="134tcpip-é€šè®¯çš„å®ç°">13.4ã€TCP/IP é€šè®¯çš„å®ç°<a class="headerlink" href="#134tcpip-é€šè®¯çš„å®ç°" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å¥—æ¥å­—ä½¿ç”¨TCPæä¾›äº†ä¸¤å°è®¡ç®—æœºä¹‹é—´çš„é€šä¿¡æœºåˆ¶ã€‚ å®¢æˆ·ç«¯ç¨‹åºåˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œå¹¶å°è¯•è¿æ¥æœåŠ¡å™¨çš„å¥—æ¥å­—ã€‚</p> <p>å½“è¿æ¥å»ºç«‹æ—¶ï¼ŒæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ª Socket å¯¹è±¡ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç°åœ¨å¯ä»¥é€šè¿‡å¯¹ Socket å¯¹è±¡çš„å†™å…¥å’Œè¯»å–æ¥è¿›è¡Œé€šä¿¡ã€‚</p> <p>java.net.Socket ç±»ä»£è¡¨ä¸€ä¸ªå¥—æ¥å­—ï¼Œå¹¶ä¸” java.net.ServerSocket ç±»ä¸ºæœåŠ¡å™¨ç¨‹åºæä¾›äº†ä¸€ç§æ¥ç›‘å¬å®¢æˆ·ç«¯ï¼Œå¹¶ä¸ä»–ä»¬å»ºç«‹è¿æ¥çš„æœºåˆ¶ã€‚</p> <p>ä»¥ä¸‹æ­¥éª¤åœ¨ä¸¤å°è®¡ç®—æœºä¹‹é—´ä½¿ç”¨å¥—æ¥å­—å»ºç«‹TCPè¿æ¥æ—¶ä¼šå‡ºç°ï¼š</p> <ul> <li>æœåŠ¡å™¨å®ä¾‹åŒ–ä¸€ä¸ª ServerSocket å¯¹è±¡ï¼Œè¡¨ç¤ºé€šè¿‡æœåŠ¡å™¨ä¸Šçš„ç«¯å£é€šä¿¡ã€‚</li> <li>æœåŠ¡å™¨è°ƒç”¨ ServerSocket ç±»çš„ accept() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šç»™å®šçš„ç«¯å£ã€‚</li> <li>æœåŠ¡å™¨æ­£åœ¨ç­‰å¾…æ—¶ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹åŒ–ä¸€ä¸ª Socket å¯¹è±¡ï¼ŒæŒ‡å®šæœåŠ¡å™¨åç§°å’Œç«¯å£å·æ¥è¯·æ±‚è¿æ¥ã€‚</li> <li>Socket ç±»çš„æ„é€ å‡½æ•°è¯•å›¾å°†å®¢æˆ·ç«¯è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨å’Œç«¯å£å·ã€‚å¦‚æœé€šä¿¡è¢«å»ºç«‹ï¼Œåˆ™åœ¨å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ª Socket å¯¹è±¡èƒ½å¤Ÿä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚</li> <li>åœ¨æœåŠ¡å™¨ç«¯ï¼Œaccept() æ–¹æ³•è¿”å›æœåŠ¡å™¨ä¸Šä¸€ä¸ªæ–°çš„ socket å¼•ç”¨ï¼Œè¯¥ socket è¿æ¥åˆ°å®¢æˆ·ç«¯çš„ socketã€‚</li> </ul> <p>è¿æ¥å»ºç«‹åï¼Œé€šè¿‡ä½¿ç”¨ I/O æµåœ¨è¿›è¡Œé€šä¿¡ï¼Œæ¯ä¸€ä¸ªsocketéƒ½æœ‰ä¸€ä¸ªè¾“å‡ºæµå’Œä¸€ä¸ªè¾“å…¥æµï¼Œå®¢æˆ·ç«¯çš„è¾“å‡ºæµè¿æ¥åˆ°æœåŠ¡å™¨ç«¯çš„è¾“å…¥æµï¼Œè€Œå®¢æˆ·ç«¯çš„è¾“å…¥æµè¿æ¥åˆ°æœåŠ¡å™¨ç«¯çš„è¾“å‡ºæµã€‚</p> <p>TCP æ˜¯ä¸€ä¸ªåŒå‘çš„é€šä¿¡åè®®ï¼Œå› æ­¤æ•°æ®å¯ä»¥é€šè¿‡ä¸¤ä¸ªæ•°æ®æµåœ¨åŒä¸€æ—¶é—´å‘é€ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç±»æä¾›çš„ä¸€å¥—å®Œæ•´çš„æœ‰ç”¨çš„æ–¹æ³•æ¥å®ç° socketã€‚</p> <h4 id="1341serversocketç±»">13.4.1ã€ServerSocketç±»<a class="headerlink" href="#1341serversocketç±»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>æœåŠ¡å™¨åº”ç”¨ç¨‹åºé€šè¿‡ä½¿ç”¨ java.net.ServerSocket ç±»ä»¥è·å–ä¸€ä¸ªç«¯å£,å¹¶ä¸”ä¾¦å¬å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p> <p>ServerSocket ç±»æœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼š</p> <table> <thead> <tr> <th>æ–¹æ³•</th> <th>æ–¹æ³•æè¿°</th> </tr> </thead> <tbody> <tr> <td>public ServerSocket(int port) throws IOException</td> <td>åˆ›å»ºç»‘å®šåˆ°ç‰¹å®šç«¯å£çš„æœåŠ¡å™¨å¥—æ¥å­—</td> </tr> <tr> <td>public ServerSocket(int port, int backlog) throws IOException</td> <td>åˆ©ç”¨æŒ‡å®šçš„ backlog åˆ›å»ºæœåŠ¡å™¨å¥—æ¥å­—å¹¶å°†å…¶ç»‘å®šåˆ°æŒ‡å®šçš„æœ¬åœ°ç«¯å£å·</td> </tr> <tr> <td>public ServerSocket(int port, int backlog, InetAddress address) throws IOException</td> <td>ä½¿ç”¨æŒ‡å®šçš„ç«¯å£ã€ä¾¦å¬ backlog å’Œè¦ç»‘å®šåˆ°çš„æœ¬åœ° IP åœ°å€åˆ›å»ºæœåŠ¡å™¨</td> </tr> <tr> <td>public ServerSocket() throws IOException</td> <td>åˆ›å»ºéç»‘å®šæœåŠ¡å™¨å¥—æ¥å­—</td> </tr> </tbody> </table> <p>å¦‚æœ ServerSocket æ„é€ æ–¹æ³•æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œå°±æ„å‘³ç€ä½ çš„åº”ç”¨ç¨‹åºå·²ç»æˆåŠŸç»‘å®šåˆ°æŒ‡å®šçš„ç«¯å£ï¼Œå¹¶ä¸”ä¾¦å¬å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p> <p>ServerSocket ç±»çš„å¸¸ç”¨æ–¹æ³•ï¼š</p> <table> <thead> <tr> <th>æ–¹æ³•</th> <th>æ–¹æ³•æè¿°</th> </tr> </thead> <tbody> <tr> <td>int getLocalPort()</td> <td>è¿”å›æ­¤å¥—æ¥å­—åœ¨å…¶ä¸Šä¾¦å¬çš„ç«¯å£</td> </tr> <tr> <td>Socket accept() throws IOException</td> <td>ä¾¦å¬å¹¶æ¥å—åˆ°æ­¤å¥—æ¥å­—çš„è¿æ¥</td> </tr> <tr> <td>void setSoTimeout(int timeout)</td> <td>é€šè¿‡æŒ‡å®šè¶…æ—¶å€¼å¯ç”¨/ç¦ç”¨ SO_TIMEOUTï¼Œä»¥æ¯«ç§’ä¸ºå•ä½</td> </tr> <tr> <td>void bind(SocketAddress host, int backlog)</td> <td>å°† ServerSocket ç»‘å®šåˆ°ç‰¹å®šåœ°å€ï¼ˆIP åœ°å€å’Œç«¯å£å·ï¼‰</td> </tr> </tbody> </table> <h4 id="1342socketç±»">13.4.2ã€Socketç±»<a class="headerlink" href="#1342socketç±»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>java.net.Socket ç±»ä»£è¡¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½ç”¨æ¥äº’ç›¸æ²Ÿé€šçš„å¥—æ¥å­—ã€‚å®¢æˆ·ç«¯è¦è·å–ä¸€ä¸ª Socket å¯¹è±¡é€šè¿‡å®ä¾‹åŒ– ï¼Œè€ŒæœåŠ¡å™¨è·å¾—ä¸€ä¸ª Socket å¯¹è±¡åˆ™é€šè¿‡ accept() æ–¹æ³•çš„è¿”å›å€¼ã€‚</p> <p>Socket ç±»æœ‰äº”ä¸ªæ„é€ æ–¹æ³•ï¼š</p> <table> <thead> <tr> <th>æ–¹æ³•</th> <th>æ–¹æ³•æè¿°</th> </tr> </thead> <tbody> <tr> <td>public Socket(String host, int port) throws UnknownHostException, IOException</td> <td>åˆ›å»ºä¸€ä¸ªæµå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®šä¸»æœºä¸Šçš„æŒ‡å®šç«¯å£å·</td> </tr> <tr> <td>public Socket(InetAddress host, int port) throws IOException</td> <td>åˆ›å»ºä¸€ä¸ªæµå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®š IP åœ°å€çš„æŒ‡å®šç«¯å£å·</td> </tr> <tr> <td>public Socket(String host, int port, InetAddress localAddress, int localPort) throws IOException</td> <td>åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®šè¿œç¨‹ä¸»æœºä¸Šçš„æŒ‡å®šè¿œç¨‹ç«¯å£</td> </tr> <tr> <td>public Socket(InetAddress host, int port, InetAddress localAddress, int localPort) throws IOException</td> <td>åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®šè¿œç¨‹åœ°å€ä¸Šçš„æŒ‡å®šè¿œç¨‹ç«¯å£</td> </tr> <tr> <td>public Socket()</td> <td>é€šè¿‡ç³»ç»Ÿé»˜è®¤ç±»å‹çš„ SocketImpl åˆ›å»ºæœªè¿æ¥å¥—æ¥å­—</td> </tr> </tbody> </table> <p>å½“ Socket æ„é€ æ–¹æ³•è¿”å›ï¼Œå¹¶æ²¡æœ‰ç®€å•çš„å®ä¾‹åŒ–äº†ä¸€ä¸ª Socket å¯¹è±¡ï¼Œå®ƒå®é™…ä¸Šä¼šå°è¯•è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨å’Œç«¯å£ã€‚</p> <p>ä¸‹é¢åˆ—å‡ºäº†ä¸€äº›æ„Ÿå…´è¶£çš„æ–¹æ³•ï¼Œæ³¨æ„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½æœ‰ä¸€ä¸ª Socket å¯¹è±¡ï¼Œæ‰€ä»¥æ— è®ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯éƒ½èƒ½å¤Ÿè°ƒç”¨è¿™äº›æ–¹æ³•ã€‚</p> <table> <thead> <tr> <th>æ–¹æ³•</th> <th>æ–¹æ³•æè¿°</th> </tr> </thead> <tbody> <tr> <td>void connect(SocketAddress host, int timeout) throws IOException</td> <td>å°†æ­¤å¥—æ¥å­—è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªè¶…æ—¶å€¼</td> </tr> <tr> <td>InetAddress getInetAddress()</td> <td>è¿”å›å¥—æ¥å­—è¿æ¥çš„åœ°å€</td> </tr> <tr> <td>int getPort()</td> <td>è¿”å›æ­¤å¥—æ¥å­—è¿æ¥åˆ°çš„è¿œç¨‹ç«¯å£</td> </tr> <tr> <td>int getLocalPort()</td> <td>è¿”å›æ­¤å¥—æ¥å­—ç»‘å®šåˆ°çš„æœ¬åœ°ç«¯å£</td> </tr> <tr> <td>SocketAddress getRemoteSocketAddress()</td> <td>è¿”å›æ­¤å¥—æ¥å­—è¿æ¥çš„ç«¯ç‚¹çš„åœ°å€ï¼Œå¦‚æœæœªè¿æ¥åˆ™è¿”å› null</td> </tr> <tr> <td>InputStream getInputStream() throws IOException</td> <td>è¿”å›æ­¤å¥—æ¥å­—çš„è¾“å…¥æµ</td> </tr> <tr> <td>OutputStream getOutputStream() throws IOException</td> <td>è¿”å›æ­¤å¥—æ¥å­—çš„è¾“å‡ºæµ</td> </tr> <tr> <td>void close() throws IOException</td> <td>å…³é—­æ­¤å¥—æ¥å­—</td> </tr> </tbody> </table> <h4 id="1343inetaddressç±»">13.4.3ã€InetAddressç±»<a class="headerlink" href="#1343inetaddressç±»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>è¿™ä¸ªç±»è¡¨ç¤ºäº’è”ç½‘åè®®(IP)åœ°å€ã€‚ä¸‹é¢åˆ—å‡ºäº† Socket ç¼–ç¨‹æ—¶æ¯”è¾ƒæœ‰ç”¨çš„æ–¹æ³•ï¼š</p> <table> <thead> <tr> <th>æ–¹æ³•</th> <th>æ–¹æ³•æè¿°</th> </tr> </thead> <tbody> <tr> <td>static InetAddress getByAddress(byte[] addr)</td> <td>åœ¨ç»™å®šåŸå§‹ IP åœ°å€çš„æƒ…å†µä¸‹ï¼Œè¿”å› InetAddress å¯¹è±¡</td> </tr> <tr> <td>static InetAddress getByAddress(String host, byte[] addr)</td> <td>æ ¹æ®æä¾›çš„ä¸»æœºåå’Œ IP åœ°å€åˆ›å»º InetAddress</td> </tr> <tr> <td>static InetAddress getByName(String host)</td> <td>åœ¨ç»™å®šä¸»æœºåçš„æƒ…å†µä¸‹ç¡®å®šä¸»æœºçš„ IP åœ°å€</td> </tr> <tr> <td>String getHostAddress()</td> <td>è¿”å› IP åœ°å€å­—ç¬¦ä¸²ï¼ˆä»¥æ–‡æœ¬è¡¨ç°å½¢å¼ï¼‰</td> </tr> <tr> <td>String getHostName()</td> <td>è·å–æ­¤ IP åœ°å€çš„ä¸»æœºå</td> </tr> <tr> <td>static InetAddress getLocalHost()</td> <td>è¿”å›æœ¬åœ°ä¸»æœº</td> </tr> <tr> <td>String toString()</td> <td>å°†æ­¤ IP åœ°å€è½¬æ¢ä¸º String</td> </tr> </tbody> </table> <h4 id="1344å®ç°èŠå¤©å®¤èŠå¤©">13.4.4ã€å®ç°èŠå¤©å®¤èŠå¤©<a class="headerlink" href="#1344å®ç°èŠå¤©å®¤èŠå¤©" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>æœåŠ¡å¤„ç†å™¨ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-187-1"><a id="__codelineno-187-1" name="__codelineno-187-1" href="#__codelineno-187-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ServerHandler</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-187-2"><a id="__codelineno-187-2" name="__codelineno-187-2" href="#__codelineno-187-2"></a><span class="w">    </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-187-3"><a id="__codelineno-187-3" name="__codelineno-187-3" href="#__codelineno-187-3"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Socket</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="p">;</span>
</span><span id="__span-187-4"><a id="__codelineno-187-4" name="__codelineno-187-4" href="#__codelineno-187-4"></a>
</span><span id="__span-187-5"><a id="__codelineno-187-5" name="__codelineno-187-5" href="#__codelineno-187-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ServerHandler</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Socket</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-187-6"><a id="__codelineno-187-6" name="__codelineno-187-6" href="#__codelineno-187-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">;</span>
</span><span id="__span-187-7"><a id="__codelineno-187-7" name="__codelineno-187-7" href="#__codelineno-187-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-187-8"><a id="__codelineno-187-8" name="__codelineno-187-8" href="#__codelineno-187-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-187-9"><a id="__codelineno-187-9" name="__codelineno-187-9" href="#__codelineno-187-9"></a>
</span><span id="__span-187-10"><a id="__codelineno-187-10" name="__codelineno-187-10" href="#__codelineno-187-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-187-11"><a id="__codelineno-187-11" name="__codelineno-187-11" href="#__codelineno-187-11"></a><span class="w">        </span><span class="n">InetAddress</span><span class="w"> </span><span class="n">inetAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="na">getInetAddress</span><span class="p">();</span>
</span><span id="__span-187-12"><a id="__codelineno-187-12" name="__codelineno-187-12" href="#__codelineno-187-12"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">inetAddress</span><span class="p">.</span><span class="na">getHostAddress</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"ä¸Šçº¿äº†..."</span><span class="p">);</span>
</span><span id="__span-187-13"><a id="__codelineno-187-13" name="__codelineno-187-13" href="#__codelineno-187-13"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-187-14"><a id="__codelineno-187-14" name="__codelineno-187-14" href="#__codelineno-187-14"></a><span class="w">            </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">bufferedReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">()));</span>
</span><span id="__span-187-15"><a id="__codelineno-187-15" name="__codelineno-187-15" href="#__codelineno-187-15"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">;</span>
</span><span id="__span-187-16"><a id="__codelineno-187-16" name="__codelineno-187-16" href="#__codelineno-187-16"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bufferedReader</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-187-17"><a id="__codelineno-187-17" name="__codelineno-187-17" href="#__codelineno-187-17"></a><span class="w">                </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inetAddress</span><span class="p">.</span><span class="na">getHostAddress</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">string</span><span class="p">;</span>
</span><span id="__span-187-18"><a id="__codelineno-187-18" name="__codelineno-187-18" href="#__codelineno-187-18"></a><span class="w">                </span><span class="n">send</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
</span><span id="__span-187-19"><a id="__codelineno-187-19" name="__codelineno-187-19" href="#__codelineno-187-19"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-187-20"><a id="__codelineno-187-20" name="__codelineno-187-20" href="#__codelineno-187-20"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-187-21"><a id="__codelineno-187-21" name="__codelineno-187-21" href="#__codelineno-187-21"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">inetAddress</span><span class="p">.</span><span class="na">getHostAddress</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"ä¸‹çº¿..."</span><span class="p">);</span>
</span><span id="__span-187-22"><a id="__codelineno-187-22" name="__codelineno-187-22" href="#__codelineno-187-22"></a><span class="w">            </span><span class="n">list</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">socket</span><span class="p">);</span>
</span><span id="__span-187-23"><a id="__codelineno-187-23" name="__codelineno-187-23" href="#__codelineno-187-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-187-24"><a id="__codelineno-187-24" name="__codelineno-187-24" href="#__codelineno-187-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-187-25"><a id="__codelineno-187-25" name="__codelineno-187-25" href="#__codelineno-187-25"></a>
</span><span id="__span-187-26"><a id="__codelineno-187-26" name="__codelineno-187-26" href="#__codelineno-187-26"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-187-27"><a id="__codelineno-187-27" name="__codelineno-187-27" href="#__codelineno-187-27"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Socket</span><span class="w"> </span><span class="n">sk</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-187-28"><a id="__codelineno-187-28" name="__codelineno-187-28" href="#__codelineno-187-28"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sk</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">socket</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-187-29"><a id="__codelineno-187-29" name="__codelineno-187-29" href="#__codelineno-187-29"></a><span class="w">                </span><span class="n">PrintStream</span><span class="w"> </span><span class="n">printStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PrintStream</span><span class="p">(</span><span class="n">sk</span><span class="p">.</span><span class="na">getOutputStream</span><span class="p">());</span>
</span><span id="__span-187-30"><a id="__codelineno-187-30" name="__codelineno-187-30" href="#__codelineno-187-30"></a><span class="w">                </span><span class="n">printStream</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span><span id="__span-187-31"><a id="__codelineno-187-31" name="__codelineno-187-31" href="#__codelineno-187-31"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-187-32"><a id="__codelineno-187-32" name="__codelineno-187-32" href="#__codelineno-187-32"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-187-33"><a id="__codelineno-187-33" name="__codelineno-187-33" href="#__codelineno-187-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-187-34"><a id="__codelineno-187-34" name="__codelineno-187-34" href="#__codelineno-187-34"></a><span class="p">}</span>
</span></code></pre></div> <p>æœåŠ¡å™¨ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-188-1"><a id="__codelineno-188-1" name="__codelineno-188-1" href="#__codelineno-188-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-188-2"><a id="__codelineno-188-2" name="__codelineno-188-2" href="#__codelineno-188-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-188-3"><a id="__codelineno-188-3" name="__codelineno-188-3" href="#__codelineno-188-3"></a><span class="w">        </span><span class="n">ServerSocket</span><span class="w"> </span><span class="n">serverSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServerSocket</span><span class="p">(</span><span class="mi">8898</span><span class="p">);</span>
</span><span id="__span-188-4"><a id="__codelineno-188-4" name="__codelineno-188-4" href="#__codelineno-188-4"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æœåŠ¡å™¨å¯åŠ¨..."</span><span class="p">);</span>
</span><span id="__span-188-5"><a id="__codelineno-188-5" name="__codelineno-188-5" href="#__codelineno-188-5"></a>
</span><span id="__span-188-6"><a id="__codelineno-188-6" name="__codelineno-188-6" href="#__codelineno-188-6"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Socket</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
</span><span id="__span-188-7"><a id="__codelineno-188-7" name="__codelineno-188-7" href="#__codelineno-188-7"></a>
</span><span id="__span-188-8"><a id="__codelineno-188-8" name="__codelineno-188-8" href="#__codelineno-188-8"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-188-9"><a id="__codelineno-188-9" name="__codelineno-188-9" href="#__codelineno-188-9"></a><span class="w">            </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serverSocket</span><span class="p">.</span><span class="na">accept</span><span class="p">();</span>
</span><span id="__span-188-10"><a id="__codelineno-188-10" name="__codelineno-188-10" href="#__codelineno-188-10"></a><span class="w">            </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-188-11"><a id="__codelineno-188-11" name="__codelineno-188-11" href="#__codelineno-188-11"></a><span class="w">                </span><span class="n">list</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">socket</span><span class="p">);</span>
</span><span id="__span-188-12"><a id="__codelineno-188-12" name="__codelineno-188-12" href="#__codelineno-188-12"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-188-13"><a id="__codelineno-188-13" name="__codelineno-188-13" href="#__codelineno-188-13"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">ServerHandler</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-188-14"><a id="__codelineno-188-14" name="__codelineno-188-14" href="#__codelineno-188-14"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-188-15"><a id="__codelineno-188-15" name="__codelineno-188-15" href="#__codelineno-188-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-188-16"><a id="__codelineno-188-16" name="__codelineno-188-16" href="#__codelineno-188-16"></a><span class="p">}</span>
</span></code></pre></div> <p>å®¢æˆ·ç«¯å‘é€ä¿¡æ¯çº¿ç¨‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-189-1"><a id="__codelineno-189-1" name="__codelineno-189-1" href="#__codelineno-189-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ClientSend</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-189-2"><a id="__codelineno-189-2" name="__codelineno-189-2" href="#__codelineno-189-2"></a><span class="w">    </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-189-3"><a id="__codelineno-189-3" name="__codelineno-189-3" href="#__codelineno-189-3"></a>
</span><span id="__span-189-4"><a id="__codelineno-189-4" name="__codelineno-189-4" href="#__codelineno-189-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ClientSend</span><span class="p">(</span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-189-5"><a id="__codelineno-189-5" name="__codelineno-189-5" href="#__codelineno-189-5"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-189-6"><a id="__codelineno-189-6" name="__codelineno-189-6" href="#__codelineno-189-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-189-7"><a id="__codelineno-189-7" name="__codelineno-189-7" href="#__codelineno-189-7"></a>
</span><span id="__span-189-8"><a id="__codelineno-189-8" name="__codelineno-189-8" href="#__codelineno-189-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-189-9"><a id="__codelineno-189-9" name="__codelineno-189-9" href="#__codelineno-189-9"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-189-10"><a id="__codelineno-189-10" name="__codelineno-189-10" href="#__codelineno-189-10"></a><span class="w">            </span><span class="n">PrintStream</span><span class="w"> </span><span class="n">printStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PrintStream</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="na">getOutputStream</span><span class="p">());</span>
</span><span id="__span-189-11"><a id="__codelineno-189-11" name="__codelineno-189-11" href="#__codelineno-189-11"></a><span class="w">            </span><span class="n">Scanner</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Scanner</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">);</span>
</span><span id="__span-189-12"><a id="__codelineno-189-12" name="__codelineno-189-12" href="#__codelineno-189-12"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¯·è¾“å…¥ä¿¡æ¯"</span><span class="p">);</span>
</span><span id="__span-189-13"><a id="__codelineno-189-13" name="__codelineno-189-13" href="#__codelineno-189-13"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-189-14"><a id="__codelineno-189-14" name="__codelineno-189-14" href="#__codelineno-189-14"></a><span class="w">                </span><span class="n">printStream</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">in</span><span class="p">.</span><span class="na">nextLine</span><span class="p">());</span>
</span><span id="__span-189-15"><a id="__codelineno-189-15" name="__codelineno-189-15" href="#__codelineno-189-15"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-189-16"><a id="__codelineno-189-16" name="__codelineno-189-16" href="#__codelineno-189-16"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-189-17"><a id="__codelineno-189-17" name="__codelineno-189-17" href="#__codelineno-189-17"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å½“å‰å®¢æˆ·ç«¯ç¦»çº¿"</span><span class="p">);</span>
</span><span id="__span-189-18"><a id="__codelineno-189-18" name="__codelineno-189-18" href="#__codelineno-189-18"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-189-19"><a id="__codelineno-189-19" name="__codelineno-189-19" href="#__codelineno-189-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-189-20"><a id="__codelineno-189-20" name="__codelineno-189-20" href="#__codelineno-189-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-189-21"><a id="__codelineno-189-21" name="__codelineno-189-21" href="#__codelineno-189-21"></a><span class="p">}</span>
</span></code></pre></div> <p>å®¢æˆ·ç«¯æ¥æ”¶ä¿¡æ¯çº¿ç¨‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-190-1"><a id="__codelineno-190-1" name="__codelineno-190-1" href="#__codelineno-190-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ClientReader</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-190-2"><a id="__codelineno-190-2" name="__codelineno-190-2" href="#__codelineno-190-2"></a><span class="w">    </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-190-3"><a id="__codelineno-190-3" name="__codelineno-190-3" href="#__codelineno-190-3"></a>
</span><span id="__span-190-4"><a id="__codelineno-190-4" name="__codelineno-190-4" href="#__codelineno-190-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ClientReader</span><span class="p">(</span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-190-5"><a id="__codelineno-190-5" name="__codelineno-190-5" href="#__codelineno-190-5"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-190-6"><a id="__codelineno-190-6" name="__codelineno-190-6" href="#__codelineno-190-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-190-7"><a id="__codelineno-190-7" name="__codelineno-190-7" href="#__codelineno-190-7"></a>
</span><span id="__span-190-8"><a id="__codelineno-190-8" name="__codelineno-190-8" href="#__codelineno-190-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-190-9"><a id="__codelineno-190-9" name="__codelineno-190-9" href="#__codelineno-190-9"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-190-10"><a id="__codelineno-190-10" name="__codelineno-190-10" href="#__codelineno-190-10"></a><span class="w">            </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">bufferedReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">((</span><span class="k">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">())));</span>
</span><span id="__span-190-11"><a id="__codelineno-190-11" name="__codelineno-190-11" href="#__codelineno-190-11"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">;</span>
</span><span id="__span-190-12"><a id="__codelineno-190-12" name="__codelineno-190-12" href="#__codelineno-190-12"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bufferedReader</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-190-13"><a id="__codelineno-190-13" name="__codelineno-190-13" href="#__codelineno-190-13"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
</span><span id="__span-190-14"><a id="__codelineno-190-14" name="__codelineno-190-14" href="#__codelineno-190-14"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-190-15"><a id="__codelineno-190-15" name="__codelineno-190-15" href="#__codelineno-190-15"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-190-16"><a id="__codelineno-190-16" name="__codelineno-190-16" href="#__codelineno-190-16"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æœåŠ¡å™¨å·²å…³é—­"</span><span class="p">);</span>
</span><span id="__span-190-17"><a id="__codelineno-190-17" name="__codelineno-190-17" href="#__codelineno-190-17"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-190-18"><a id="__codelineno-190-18" name="__codelineno-190-18" href="#__codelineno-190-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-190-19"><a id="__codelineno-190-19" name="__codelineno-190-19" href="#__codelineno-190-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-190-20"><a id="__codelineno-190-20" name="__codelineno-190-20" href="#__codelineno-190-20"></a><span class="p">}</span>
</span></code></pre></div> <p>å®¢æˆ·ç«¯ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-191-1"><a id="__codelineno-191-1" name="__codelineno-191-1" href="#__codelineno-191-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Client</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-191-2"><a id="__codelineno-191-2" name="__codelineno-191-2" href="#__codelineno-191-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-191-3"><a id="__codelineno-191-3" name="__codelineno-191-3" href="#__codelineno-191-3"></a><span class="w">        </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Socket</span><span class="p">(</span><span class="s">"192.168.42.165"</span><span class="p">,</span><span class="w"> </span><span class="mi">8898</span><span class="p">);</span>
</span><span id="__span-191-4"><a id="__codelineno-191-4" name="__codelineno-191-4" href="#__codelineno-191-4"></a>
</span><span id="__span-191-5"><a id="__codelineno-191-5" name="__codelineno-191-5" href="#__codelineno-191-5"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">ClientSend</span><span class="p">(</span><span class="n">socket</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-191-6"><a id="__codelineno-191-6" name="__codelineno-191-6" href="#__codelineno-191-6"></a>
</span><span id="__span-191-7"><a id="__codelineno-191-7" name="__codelineno-191-7" href="#__codelineno-191-7"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">ClientReader</span><span class="p">(</span><span class="n">socket</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-191-8"><a id="__codelineno-191-8" name="__codelineno-191-8" href="#__codelineno-191-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-191-9"><a id="__codelineno-191-9" name="__codelineno-191-9" href="#__codelineno-191-9"></a><span class="p">}</span>
</span></code></pre></div> <h3 id="135udp-é€šè®¯çš„å®ç°">13.5ã€UDP é€šè®¯çš„å®ç°<a class="headerlink" href="#135udp-é€šè®¯çš„å®ç°" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ä¸TCPç›¸æ¯”ï¼ŒUDPæ˜¯ä¸€ç§æ— è¿æ¥çš„ä¼ è¾“å±‚åè®®ï¼Œæä¾›é¢å‘äº‹åŠ¡çš„ç®€å•ä¸å¯é ä¿¡æ¯ä¼ é€æœåŠ¡ã€‚UDPé€šè®¯ä¸»è¦ç”¨åˆ°ä¸¤ä¸ªç±»DatagramPacketå’ŒDatagramSocketã€‚</p> <h4 id="1351datagramsocke">13.5.1ã€DatagramSocke<a class="headerlink" href="#1351datagramsocke" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>æ­¤ç±»è¡¨ç¤ºç”¨æ¥å‘é€å’Œæ¥æ”¶æ•°æ®æŠ¥åŒ…çš„å¥—æ¥å­—ã€‚</p> <p>æ•°æ®æŠ¥å¥—æ¥å­—æ˜¯åŒ…æŠ•é€’æœåŠ¡çš„å‘é€æˆ–æ¥æ”¶ç‚¹ã€‚æ¯ä¸ªåœ¨æ•°æ®æŠ¥å¥—æ¥å­—ä¸Šå‘é€æˆ–æ¥æ”¶çš„åŒ…éƒ½æ˜¯å•ç‹¬ç¼–å€å’Œè·¯ç”±çš„ã€‚ä»ä¸€å°æœºå™¨å‘é€åˆ°å¦ä¸€å°æœºå™¨çš„å¤šä¸ªåŒ…å¯èƒ½é€‰æ‹©ä¸åŒçš„è·¯ç”±ï¼Œä¹Ÿå¯èƒ½æŒ‰ä¸åŒçš„é¡ºåºåˆ°è¾¾ã€‚</p> <p>æ„é€ æ–¹æ³•:</p> <table> <thead> <tr> <th>æ–¹æ³•</th> <th>æ–¹æ³•æè¿°</th> </tr> </thead> <tbody> <tr> <td>DatagramSocket()</td> <td>æ„é€ æ•°æ®æŠ¥å¥—æ¥å­—å¹¶å°†å…¶ç»‘å®šåˆ°æœ¬åœ°ä¸»æœºä¸Šçš„ä»»ä½•å¯ç”¨ç«¯å£</td> </tr> <tr> <td>DatagramSocket(DatagramSocketImpl impl</td> <td>ä½¿ç”¨æŒ‡å®šçš„DatagramSocketImplåˆ›å»ºä¸€ä¸ªæœªç»‘å®šçš„æ•°æ®æŠ¥å¥—æ¥å­—</td> </tr> <tr> <td>DatagramSocket(int port)</td> <td>æ„é€ æ•°æ®æŠ¥å¥—æ¥å­—å¹¶å°†å…¶ç»‘å®šåˆ°æœ¬åœ°ä¸»æœºä¸Šçš„æŒ‡å®šç«¯å£</td> </tr> <tr> <td>DatagramSocket(int port, InetAddress laddr)</td> <td>åˆ›å»ºä¸€ä¸ªæ•°æ®æŠ¥å¥—æ¥å­—ï¼Œç»‘å®šåˆ°æŒ‡å®šçš„æœ¬åœ°åœ°å€</td> </tr> <tr> <td>DatagramSocket(SocketAddress bindaddr)</td> <td>åˆ›å»ºä¸€ä¸ªæ•°æ®æŠ¥å¥—æ¥å­—ï¼Œç»‘å®šåˆ°æŒ‡å®šçš„æœ¬åœ°å¥—æ¥å­—åœ°å€</td> </tr> </tbody> </table> <p>å¸¸ç”¨çš„æ–¹æ³•ï¼š</p> <table> <thead> <tr> <th>æ–¹æ³•</th> <th>æ–¹æ³•æè¿°</th> </tr> </thead> <tbody> <tr> <td>void bind(SocketAddress add)</td> <td>å°†æ­¤DatagramSocketç»‘å®šåˆ°ç‰¹å®šçš„åœ°å€å’Œç«¯å£</td> </tr> <tr> <td>boolean isBound()</td> <td>è¿”å›å¥—æ¥å­—çš„ç»‘å®šçŠ¶æ€</td> </tr> <tr> <td>void close()</td> <td>å…³é—­æ­¤æ•°æ®æŠ¥å¥—æ¥å­—</td> </tr> <tr> <td>void isClosed()</td> <td>è¿”å›å¥—æ¥å­—æ˜¯å¦å…³é—­</td> </tr> <tr> <td>void connect(InetAddress address, int port)</td> <td>å°†å¥—æ¥å­—è¿æ¥åˆ°æ­¤å¥—æ¥å­—çš„è¿œç¨‹åœ°å€</td> </tr> <tr> <td>void connect(SocketAddress addr)</td> <td>å°†æ­¤å¥—æ¥å­—è¿æ¥åˆ°è¿œç¨‹å¥—æ¥å­—åœ°å€ï¼ˆIPåœ°å€+ç«¯å£å·ï¼‰</td> </tr> <tr> <td>boolean isConnected()</td> <td>è¿”å›å¥—æ¥å­—çš„è¿æ¥çŠ¶æ€</td> </tr> <tr> <td>InetAddress getInetAddress()</td> <td>è¿”å›æ­¤å¥—æ¥å­—è¿æ¥åˆ°çš„åœ°å€</td> </tr> <tr> <td>InetAddress getLocalAddress()</td> <td>è·å–å¥—æ¥å­—æ‰€ç»‘å®šçš„æœ¬åœ°åœ°å€</td> </tr> <tr> <td>int getLocalPort()</td> <td>è¿”å›æ­¤å¥—æ¥å­—ç»‘å®šåˆ°çš„æœ¬åœ°ä¸»æœºä¸Šçš„ç«¯å£å·</td> </tr> <tr> <td>SocketAddress getLocalSocketAddress()</td> <td>è¿”å›æ­¤å¥—æ¥å­—ç»‘å®šåˆ°çš„ç«¯ç‚¹çš„åœ°å€</td> </tr> <tr> <td>int getPort()</td> <td>è¿”å›æ­¤å¥—æ¥å­—è¿æ¥åˆ°çš„ç«¯å£å·</td> </tr> <tr> <td>SocketAddress getRemoteSocketAddress()</td> <td>è¿”å›æ­¤å¥—æ¥å­—è¿æ¥ï¼Œæˆ–ç«¯ç‚¹çš„åœ°å€ <code>null</code>å¦‚æœæ˜¯æœªè¿æ¥</td> </tr> <tr> <td>void receive(DatagramPacket p)</td> <td>ä»æ­¤å¥—æ¥å­—æ¥æ”¶æ•°æ®æŠ¥åŒ…</td> </tr> <tr> <td>void send(DatagramPacket)</td> <td>ä»æ­¤å¥—æ¥å­—å‘é€æ•°æ®æŠ¥åŒ…</td> </tr> </tbody> </table> <h4 id="1352datagrampacket">13.5.2ã€DatagramPacket<a class="headerlink" href="#1352datagrampacket" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>è¯¥ç±»è¡¨ç¤ºæ•°æ®æŠ¥åŒ…ã€‚</p> <p>æ•°æ®æŠ¥åŒ…ç”¨äºå®ç°æ— è¿æ¥åˆ†ç»„ä¼ é€æœåŠ¡ã€‚ ä»…åŸºäºè¯¥æ•°æ®åŒ…ä¸­åŒ…å«çš„ä¿¡æ¯ï¼Œæ¯ä¸ªæ¶ˆæ¯ä»ä¸€å°æœºå™¨è·¯ç”±åˆ°å¦ä¸€å°æœºå™¨ã€‚ ä»ä¸€å°æœºå™¨å‘é€åˆ°å¦ä¸€å°æœºå™¨çš„å¤šä¸ªåˆ†ç»„å¯èƒ½ä¼šæœ‰ä¸åŒçš„è·¯ç”±ï¼Œå¹¶ä¸”å¯èƒ½ä»¥ä»»ä½•é¡ºåºåˆ°è¾¾ã€‚ åŒ…ä¼ é€ä¸èƒ½ä¿è¯ã€‚ </p> <table> <thead> <tr> <th>æ–¹æ³•</th> <th>æ–¹æ³•æè¿°</th> </tr> </thead> <tbody> <tr> <td>DatagramPacket(byte[] buf, int length)</td> <td>æ„é€ ä¸€ä¸ªé•¿åº¦ä¸ºlendthç”¨äºæ¥æ”¶çš„æ•°æ®åŒ… DatagramPacket</td> </tr> <tr> <td>DatagramPacket(byte[] buf, int length, InetAddress address, int port)</td> <td>æ„é€ ç”¨äºå‘é€é•¿åº¦çš„åˆ†ç»„çš„æ•°æ®æŠ¥åŒ…ï¼Œlengthä¸ºé•¿åº¦ï¼ŒaddressæŒ‡å®šä¸»æœºï¼ŒportæŒ‡å®šç«¯å£å·</td> </tr> </tbody> </table> <h4 id="1353å®ç°èŠå¤©å®¤èŠå¤©">13.5.3ã€å®ç°èŠå¤©å®¤èŠå¤©<a class="headerlink" href="#1353å®ç°èŠå¤©å®¤èŠå¤©" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>æœåŠ¡æ§åˆ¶å™¨ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-192-1"><a id="__codelineno-192-1" name="__codelineno-192-1" href="#__codelineno-192-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ServerHandler</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-192-2"><a id="__codelineno-192-2" name="__codelineno-192-2" href="#__codelineno-192-2"></a><span class="w">    </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-192-3"><a id="__codelineno-192-3" name="__codelineno-192-3" href="#__codelineno-192-3"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Socket</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="p">;</span>
</span><span id="__span-192-4"><a id="__codelineno-192-4" name="__codelineno-192-4" href="#__codelineno-192-4"></a>
</span><span id="__span-192-5"><a id="__codelineno-192-5" name="__codelineno-192-5" href="#__codelineno-192-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ServerHandler</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Socket</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-192-6"><a id="__codelineno-192-6" name="__codelineno-192-6" href="#__codelineno-192-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">;</span>
</span><span id="__span-192-7"><a id="__codelineno-192-7" name="__codelineno-192-7" href="#__codelineno-192-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-192-8"><a id="__codelineno-192-8" name="__codelineno-192-8" href="#__codelineno-192-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-192-9"><a id="__codelineno-192-9" name="__codelineno-192-9" href="#__codelineno-192-9"></a>
</span><span id="__span-192-10"><a id="__codelineno-192-10" name="__codelineno-192-10" href="#__codelineno-192-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-192-11"><a id="__codelineno-192-11" name="__codelineno-192-11" href="#__codelineno-192-11"></a><span class="w">        </span><span class="n">InetAddress</span><span class="w"> </span><span class="n">inetAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="na">getInetAddress</span><span class="p">();</span>
</span><span id="__span-192-12"><a id="__codelineno-192-12" name="__codelineno-192-12" href="#__codelineno-192-12"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">inetAddress</span><span class="p">.</span><span class="na">getHostAddress</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"ä¸Šçº¿äº†..."</span><span class="p">);</span>
</span><span id="__span-192-13"><a id="__codelineno-192-13" name="__codelineno-192-13" href="#__codelineno-192-13"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-192-14"><a id="__codelineno-192-14" name="__codelineno-192-14" href="#__codelineno-192-14"></a><span class="w">            </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">bufferedReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">()));</span>
</span><span id="__span-192-15"><a id="__codelineno-192-15" name="__codelineno-192-15" href="#__codelineno-192-15"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">;</span>
</span><span id="__span-192-16"><a id="__codelineno-192-16" name="__codelineno-192-16" href="#__codelineno-192-16"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bufferedReader</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-192-17"><a id="__codelineno-192-17" name="__codelineno-192-17" href="#__codelineno-192-17"></a><span class="w">                </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inetAddress</span><span class="p">.</span><span class="na">getHostAddress</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">string</span><span class="p">;</span>
</span><span id="__span-192-18"><a id="__codelineno-192-18" name="__codelineno-192-18" href="#__codelineno-192-18"></a><span class="w">                </span><span class="n">send</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
</span><span id="__span-192-19"><a id="__codelineno-192-19" name="__codelineno-192-19" href="#__codelineno-192-19"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-192-20"><a id="__codelineno-192-20" name="__codelineno-192-20" href="#__codelineno-192-20"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-192-21"><a id="__codelineno-192-21" name="__codelineno-192-21" href="#__codelineno-192-21"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">inetAddress</span><span class="p">.</span><span class="na">getHostAddress</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"ä¸‹çº¿..."</span><span class="p">);</span>
</span><span id="__span-192-22"><a id="__codelineno-192-22" name="__codelineno-192-22" href="#__codelineno-192-22"></a><span class="w">            </span><span class="n">list</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">socket</span><span class="p">);</span>
</span><span id="__span-192-23"><a id="__codelineno-192-23" name="__codelineno-192-23" href="#__codelineno-192-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-192-24"><a id="__codelineno-192-24" name="__codelineno-192-24" href="#__codelineno-192-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-192-25"><a id="__codelineno-192-25" name="__codelineno-192-25" href="#__codelineno-192-25"></a>
</span><span id="__span-192-26"><a id="__codelineno-192-26" name="__codelineno-192-26" href="#__codelineno-192-26"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-192-27"><a id="__codelineno-192-27" name="__codelineno-192-27" href="#__codelineno-192-27"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Socket</span><span class="w"> </span><span class="n">sk</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-192-28"><a id="__codelineno-192-28" name="__codelineno-192-28" href="#__codelineno-192-28"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sk</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">socket</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-192-29"><a id="__codelineno-192-29" name="__codelineno-192-29" href="#__codelineno-192-29"></a><span class="w">                </span><span class="n">PrintStream</span><span class="w"> </span><span class="n">printStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PrintStream</span><span class="p">(</span><span class="n">sk</span><span class="p">.</span><span class="na">getOutputStream</span><span class="p">());</span>
</span><span id="__span-192-30"><a id="__codelineno-192-30" name="__codelineno-192-30" href="#__codelineno-192-30"></a><span class="w">                </span><span class="n">printStream</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span><span id="__span-192-31"><a id="__codelineno-192-31" name="__codelineno-192-31" href="#__codelineno-192-31"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-192-32"><a id="__codelineno-192-32" name="__codelineno-192-32" href="#__codelineno-192-32"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-192-33"><a id="__codelineno-192-33" name="__codelineno-192-33" href="#__codelineno-192-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-192-34"><a id="__codelineno-192-34" name="__codelineno-192-34" href="#__codelineno-192-34"></a><span class="p">}</span>
</span></code></pre></div> <p>æœåŠ¡å™¨ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-193-1"><a id="__codelineno-193-1" name="__codelineno-193-1" href="#__codelineno-193-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-193-2"><a id="__codelineno-193-2" name="__codelineno-193-2" href="#__codelineno-193-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-193-3"><a id="__codelineno-193-3" name="__codelineno-193-3" href="#__codelineno-193-3"></a><span class="w">        </span><span class="n">ServerSocket</span><span class="w"> </span><span class="n">serverSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServerSocket</span><span class="p">(</span><span class="mi">8898</span><span class="p">);</span>
</span><span id="__span-193-4"><a id="__codelineno-193-4" name="__codelineno-193-4" href="#__codelineno-193-4"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æœåŠ¡å™¨å¯åŠ¨..."</span><span class="p">);</span>
</span><span id="__span-193-5"><a id="__codelineno-193-5" name="__codelineno-193-5" href="#__codelineno-193-5"></a>
</span><span id="__span-193-6"><a id="__codelineno-193-6" name="__codelineno-193-6" href="#__codelineno-193-6"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Socket</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
</span><span id="__span-193-7"><a id="__codelineno-193-7" name="__codelineno-193-7" href="#__codelineno-193-7"></a>
</span><span id="__span-193-8"><a id="__codelineno-193-8" name="__codelineno-193-8" href="#__codelineno-193-8"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-193-9"><a id="__codelineno-193-9" name="__codelineno-193-9" href="#__codelineno-193-9"></a><span class="w">            </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serverSocket</span><span class="p">.</span><span class="na">accept</span><span class="p">();</span>
</span><span id="__span-193-10"><a id="__codelineno-193-10" name="__codelineno-193-10" href="#__codelineno-193-10"></a><span class="w">            </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-193-11"><a id="__codelineno-193-11" name="__codelineno-193-11" href="#__codelineno-193-11"></a><span class="w">                </span><span class="n">list</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">socket</span><span class="p">);</span>
</span><span id="__span-193-12"><a id="__codelineno-193-12" name="__codelineno-193-12" href="#__codelineno-193-12"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-193-13"><a id="__codelineno-193-13" name="__codelineno-193-13" href="#__codelineno-193-13"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">ServerHandler</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-193-14"><a id="__codelineno-193-14" name="__codelineno-193-14" href="#__codelineno-193-14"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-193-15"><a id="__codelineno-193-15" name="__codelineno-193-15" href="#__codelineno-193-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-193-16"><a id="__codelineno-193-16" name="__codelineno-193-16" href="#__codelineno-193-16"></a><span class="p">}</span>
</span></code></pre></div> <p>å®¢æˆ·ç«¯æ¥æ”¶ä¿¡æ¯çº¿ç¨‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-194-1"><a id="__codelineno-194-1" name="__codelineno-194-1" href="#__codelineno-194-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ClientSend</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-194-2"><a id="__codelineno-194-2" name="__codelineno-194-2" href="#__codelineno-194-2"></a><span class="w">    </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-194-3"><a id="__codelineno-194-3" name="__codelineno-194-3" href="#__codelineno-194-3"></a>
</span><span id="__span-194-4"><a id="__codelineno-194-4" name="__codelineno-194-4" href="#__codelineno-194-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ClientSend</span><span class="p">(</span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-194-5"><a id="__codelineno-194-5" name="__codelineno-194-5" href="#__codelineno-194-5"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-194-6"><a id="__codelineno-194-6" name="__codelineno-194-6" href="#__codelineno-194-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-194-7"><a id="__codelineno-194-7" name="__codelineno-194-7" href="#__codelineno-194-7"></a>
</span><span id="__span-194-8"><a id="__codelineno-194-8" name="__codelineno-194-8" href="#__codelineno-194-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-194-9"><a id="__codelineno-194-9" name="__codelineno-194-9" href="#__codelineno-194-9"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-194-10"><a id="__codelineno-194-10" name="__codelineno-194-10" href="#__codelineno-194-10"></a><span class="w">            </span><span class="n">PrintStream</span><span class="w"> </span><span class="n">printStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PrintStream</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="na">getOutputStream</span><span class="p">());</span>
</span><span id="__span-194-11"><a id="__codelineno-194-11" name="__codelineno-194-11" href="#__codelineno-194-11"></a><span class="w">            </span><span class="n">Scanner</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Scanner</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">);</span>
</span><span id="__span-194-12"><a id="__codelineno-194-12" name="__codelineno-194-12" href="#__codelineno-194-12"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¯·è¾“å…¥ä¿¡æ¯"</span><span class="p">);</span>
</span><span id="__span-194-13"><a id="__codelineno-194-13" name="__codelineno-194-13" href="#__codelineno-194-13"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-194-14"><a id="__codelineno-194-14" name="__codelineno-194-14" href="#__codelineno-194-14"></a><span class="w">                </span><span class="n">printStream</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">in</span><span class="p">.</span><span class="na">nextLine</span><span class="p">());</span>
</span><span id="__span-194-15"><a id="__codelineno-194-15" name="__codelineno-194-15" href="#__codelineno-194-15"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-194-16"><a id="__codelineno-194-16" name="__codelineno-194-16" href="#__codelineno-194-16"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-194-17"><a id="__codelineno-194-17" name="__codelineno-194-17" href="#__codelineno-194-17"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"å½“å‰å®¢æˆ·ç«¯ç¦»çº¿"</span><span class="p">);</span>
</span><span id="__span-194-18"><a id="__codelineno-194-18" name="__codelineno-194-18" href="#__codelineno-194-18"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-194-19"><a id="__codelineno-194-19" name="__codelineno-194-19" href="#__codelineno-194-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-194-20"><a id="__codelineno-194-20" name="__codelineno-194-20" href="#__codelineno-194-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-194-21"><a id="__codelineno-194-21" name="__codelineno-194-21" href="#__codelineno-194-21"></a><span class="p">}</span>
</span></code></pre></div> <p>å®¢æˆ·ç«¯å‘é€ä¿¡æ¯çº¿ç¨‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-195-1"><a id="__codelineno-195-1" name="__codelineno-195-1" href="#__codelineno-195-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ClientReader</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-195-2"><a id="__codelineno-195-2" name="__codelineno-195-2" href="#__codelineno-195-2"></a><span class="w">    </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-195-3"><a id="__codelineno-195-3" name="__codelineno-195-3" href="#__codelineno-195-3"></a>
</span><span id="__span-195-4"><a id="__codelineno-195-4" name="__codelineno-195-4" href="#__codelineno-195-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ClientReader</span><span class="p">(</span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-195-5"><a id="__codelineno-195-5" name="__codelineno-195-5" href="#__codelineno-195-5"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">;</span>
</span><span id="__span-195-6"><a id="__codelineno-195-6" name="__codelineno-195-6" href="#__codelineno-195-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-195-7"><a id="__codelineno-195-7" name="__codelineno-195-7" href="#__codelineno-195-7"></a>
</span><span id="__span-195-8"><a id="__codelineno-195-8" name="__codelineno-195-8" href="#__codelineno-195-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-195-9"><a id="__codelineno-195-9" name="__codelineno-195-9" href="#__codelineno-195-9"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-195-10"><a id="__codelineno-195-10" name="__codelineno-195-10" href="#__codelineno-195-10"></a><span class="w">            </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">bufferedReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">((</span><span class="k">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">())));</span>
</span><span id="__span-195-11"><a id="__codelineno-195-11" name="__codelineno-195-11" href="#__codelineno-195-11"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">;</span>
</span><span id="__span-195-12"><a id="__codelineno-195-12" name="__codelineno-195-12" href="#__codelineno-195-12"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bufferedReader</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-195-13"><a id="__codelineno-195-13" name="__codelineno-195-13" href="#__codelineno-195-13"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
</span><span id="__span-195-14"><a id="__codelineno-195-14" name="__codelineno-195-14" href="#__codelineno-195-14"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-195-15"><a id="__codelineno-195-15" name="__codelineno-195-15" href="#__codelineno-195-15"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-195-16"><a id="__codelineno-195-16" name="__codelineno-195-16" href="#__codelineno-195-16"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æœåŠ¡å™¨å·²å…³é—­"</span><span class="p">);</span>
</span><span id="__span-195-17"><a id="__codelineno-195-17" name="__codelineno-195-17" href="#__codelineno-195-17"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-195-18"><a id="__codelineno-195-18" name="__codelineno-195-18" href="#__codelineno-195-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-195-19"><a id="__codelineno-195-19" name="__codelineno-195-19" href="#__codelineno-195-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-195-20"><a id="__codelineno-195-20" name="__codelineno-195-20" href="#__codelineno-195-20"></a><span class="p">}</span>
</span></code></pre></div> <p>å®¢æˆ·ç«¯ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-196-1"><a id="__codelineno-196-1" name="__codelineno-196-1" href="#__codelineno-196-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Client</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-196-2"><a id="__codelineno-196-2" name="__codelineno-196-2" href="#__codelineno-196-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-196-3"><a id="__codelineno-196-3" name="__codelineno-196-3" href="#__codelineno-196-3"></a><span class="w">        </span><span class="n">Socket</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Socket</span><span class="p">(</span><span class="s">"192.168.42.165"</span><span class="p">,</span><span class="w"> </span><span class="mi">8898</span><span class="p">);</span>
</span><span id="__span-196-4"><a id="__codelineno-196-4" name="__codelineno-196-4" href="#__codelineno-196-4"></a>
</span><span id="__span-196-5"><a id="__codelineno-196-5" name="__codelineno-196-5" href="#__codelineno-196-5"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">ClientSend</span><span class="p">(</span><span class="n">socket</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-196-6"><a id="__codelineno-196-6" name="__codelineno-196-6" href="#__codelineno-196-6"></a>
</span><span id="__span-196-7"><a id="__codelineno-196-7" name="__codelineno-196-7" href="#__codelineno-196-7"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">ClientReader</span><span class="p">(</span><span class="n">socket</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-196-8"><a id="__codelineno-196-8" name="__codelineno-196-8" href="#__codelineno-196-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-196-9"><a id="__codelineno-196-9" name="__codelineno-196-9" href="#__codelineno-196-9"></a><span class="p">}</span>
</span></code></pre></div> <hr> <p><strong>åˆ©ç”¨å¹¿æ’­IPå®ç°ç¾¤èŠ</strong></p> <p>å¹¿æ’­åœ°å€(Broadcast Address)æ˜¯ä¸“é—¨ç”¨äºåŒæ—¶å‘ç½‘ç»œä¸­æ‰€æœ‰å·¥ä½œç«™è¿›è¡Œå‘é€çš„ä¸€ä¸ªåœ°å€ã€‚åœ¨ä½¿ç”¨TCP/IP åè®®çš„ç½‘ç»œä¸­ï¼Œä¸»æœºæ ‡è¯†æ®µhost ID ä¸ºå…¨1 çš„IP åœ°å€ä¸ºå¹¿æ’­åœ°å€ï¼Œå¹¿æ’­çš„åˆ†ç»„ä¼ é€ç»™host IDæ®µæ‰€æ¶‰åŠçš„æ‰€æœ‰è®¡ç®—æœºã€‚ä¾‹å¦‚ï¼Œå¯¹äº10.1.1.0 ï¼ˆ255.255.255.0 ï¼‰ç½‘æ®µï¼Œå…¶å¹¿æ’­åœ°å€ä¸º10.1.1.255 ï¼ˆ255 å³ä¸º2 è¿›åˆ¶çš„11111111 ï¼‰ï¼Œå½“å‘å‡ºä¸€ä¸ªç›®çš„åœ°å€ä¸º10.1.1.255 çš„åˆ†ç»„ï¼ˆå°åŒ…ï¼‰æ—¶ï¼Œå®ƒå°†è¢«åˆ†å‘ç»™è¯¥ç½‘æ®µä¸Šçš„æ‰€æœ‰è®¡ç®—æœºã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-197-1"><a id="__codelineno-197-1" name="__codelineno-197-1" href="#__codelineno-197-1"></a><span class="cm">/**</span>
</span><span id="__span-197-2"><a id="__codelineno-197-2" name="__codelineno-197-2" href="#__codelineno-197-2"></a><span class="cm"> * å‘é€æ¶ˆæ¯</span>
</span><span id="__span-197-3"><a id="__codelineno-197-3" name="__codelineno-197-3" href="#__codelineno-197-3"></a><span class="cm"> *</span>
</span><span id="__span-197-4"><a id="__codelineno-197-4" name="__codelineno-197-4" href="#__codelineno-197-4"></a><span class="cm"> * @author LIU</span>
</span><span id="__span-197-5"><a id="__codelineno-197-5" name="__codelineno-197-5" href="#__codelineno-197-5"></a><span class="cm"> */</span>
</span><span id="__span-197-6"><a id="__codelineno-197-6" name="__codelineno-197-6" href="#__codelineno-197-6"></a><span class="kd">class</span> <span class="nc">Send</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-7"><a id="__codelineno-197-7" name="__codelineno-197-7" href="#__codelineno-197-7"></a><span class="w">    </span><span class="n">DatagramSocket</span><span class="w"> </span><span class="n">ds</span><span class="p">;</span>
</span><span id="__span-197-8"><a id="__codelineno-197-8" name="__codelineno-197-8" href="#__codelineno-197-8"></a>
</span><span id="__span-197-9"><a id="__codelineno-197-9" name="__codelineno-197-9" href="#__codelineno-197-9"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Send</span><span class="p">(</span><span class="n">DatagramSocket</span><span class="w"> </span><span class="n">ds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-10"><a id="__codelineno-197-10" name="__codelineno-197-10" href="#__codelineno-197-10"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="p">;</span>
</span><span id="__span-197-11"><a id="__codelineno-197-11" name="__codelineno-197-11" href="#__codelineno-197-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-197-12"><a id="__codelineno-197-12" name="__codelineno-197-12" href="#__codelineno-197-12"></a>
</span><span id="__span-197-13"><a id="__codelineno-197-13" name="__codelineno-197-13" href="#__codelineno-197-13"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-197-14"><a id="__codelineno-197-14" name="__codelineno-197-14" href="#__codelineno-197-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-15"><a id="__codelineno-197-15" name="__codelineno-197-15" href="#__codelineno-197-15"></a><span class="w">        </span><span class="c1">// TODO Auto-generated method stub</span>
</span><span id="__span-197-16"><a id="__codelineno-197-16" name="__codelineno-197-16" href="#__codelineno-197-16"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-17"><a id="__codelineno-197-17" name="__codelineno-197-17" href="#__codelineno-197-17"></a><span class="w">            </span><span class="n">Scanner</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Scanner</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">);</span>
</span><span id="__span-197-18"><a id="__codelineno-197-18" name="__codelineno-197-18" href="#__codelineno-197-18"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-19"><a id="__codelineno-197-19" name="__codelineno-197-19" href="#__codelineno-197-19"></a><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">sendBuf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">nextLine</span><span class="p">();</span>
</span><span id="__span-197-20"><a id="__codelineno-197-20" name="__codelineno-197-20" href="#__codelineno-197-20"></a><span class="w">                </span><span class="c1">// å‘é€çš„ å†…å®¹ï¼Œé•¿åº¦ï¼ŒIPï¼Œç«¯å£</span>
</span><span id="__span-197-21"><a id="__codelineno-197-21" name="__codelineno-197-21" href="#__codelineno-197-21"></a><span class="w">                </span><span class="n">DatagramPacket</span><span class="w"> </span><span class="n">dpSend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DatagramPacket</span><span class="p">(</span><span class="n">sendBuf</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(),</span><span class="w"> </span><span class="n">sendBuf</span><span class="p">.</span><span class="na">getBytes</span><span class="p">().</span><span class="na">length</span><span class="p">,</span><span class="w"> </span><span class="n">InetAddress</span><span class="p">.</span><span class="na">getByName</span><span class="p">(</span><span class="s">"192.168.8.255"</span><span class="p">),</span><span class="w"> </span><span class="mi">9988</span><span class="p">);</span>
</span><span id="__span-197-22"><a id="__codelineno-197-22" name="__codelineno-197-22" href="#__codelineno-197-22"></a><span class="w">                </span><span class="n">ds</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">dpSend</span><span class="p">);</span>
</span><span id="__span-197-23"><a id="__codelineno-197-23" name="__codelineno-197-23" href="#__codelineno-197-23"></a>
</span><span id="__span-197-24"><a id="__codelineno-197-24" name="__codelineno-197-24" href="#__codelineno-197-24"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æˆ‘è¯´ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sendBuf</span><span class="p">);</span>
</span><span id="__span-197-25"><a id="__codelineno-197-25" name="__codelineno-197-25" href="#__codelineno-197-25"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-197-26"><a id="__codelineno-197-26" name="__codelineno-197-26" href="#__codelineno-197-26"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-27"><a id="__codelineno-197-27" name="__codelineno-197-27" href="#__codelineno-197-27"></a><span class="w">            </span><span class="c1">// TODO: handle exception</span>
</span><span id="__span-197-28"><a id="__codelineno-197-28" name="__codelineno-197-28" href="#__codelineno-197-28"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-197-29"><a id="__codelineno-197-29" name="__codelineno-197-29" href="#__codelineno-197-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-197-30"><a id="__codelineno-197-30" name="__codelineno-197-30" href="#__codelineno-197-30"></a><span class="p">}</span>
</span><span id="__span-197-31"><a id="__codelineno-197-31" name="__codelineno-197-31" href="#__codelineno-197-31"></a>
</span><span id="__span-197-32"><a id="__codelineno-197-32" name="__codelineno-197-32" href="#__codelineno-197-32"></a>
</span><span id="__span-197-33"><a id="__codelineno-197-33" name="__codelineno-197-33" href="#__codelineno-197-33"></a><span class="cm">/**</span>
</span><span id="__span-197-34"><a id="__codelineno-197-34" name="__codelineno-197-34" href="#__codelineno-197-34"></a><span class="cm"> * æ¥æ”¶æ¶ˆæ¯</span>
</span><span id="__span-197-35"><a id="__codelineno-197-35" name="__codelineno-197-35" href="#__codelineno-197-35"></a><span class="cm"> *</span>
</span><span id="__span-197-36"><a id="__codelineno-197-36" name="__codelineno-197-36" href="#__codelineno-197-36"></a><span class="cm"> * @author LIU</span>
</span><span id="__span-197-37"><a id="__codelineno-197-37" name="__codelineno-197-37" href="#__codelineno-197-37"></a><span class="cm"> */</span>
</span><span id="__span-197-38"><a id="__codelineno-197-38" name="__codelineno-197-38" href="#__codelineno-197-38"></a><span class="kd">class</span> <span class="nc">Recv</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-39"><a id="__codelineno-197-39" name="__codelineno-197-39" href="#__codelineno-197-39"></a><span class="w">    </span><span class="n">DatagramSocket</span><span class="w"> </span><span class="n">ds</span><span class="p">;</span>
</span><span id="__span-197-40"><a id="__codelineno-197-40" name="__codelineno-197-40" href="#__codelineno-197-40"></a>
</span><span id="__span-197-41"><a id="__codelineno-197-41" name="__codelineno-197-41" href="#__codelineno-197-41"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Recv</span><span class="p">(</span><span class="n">DatagramSocket</span><span class="w"> </span><span class="n">ds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-42"><a id="__codelineno-197-42" name="__codelineno-197-42" href="#__codelineno-197-42"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="p">;</span>
</span><span id="__span-197-43"><a id="__codelineno-197-43" name="__codelineno-197-43" href="#__codelineno-197-43"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-197-44"><a id="__codelineno-197-44" name="__codelineno-197-44" href="#__codelineno-197-44"></a>
</span><span id="__span-197-45"><a id="__codelineno-197-45" name="__codelineno-197-45" href="#__codelineno-197-45"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-197-46"><a id="__codelineno-197-46" name="__codelineno-197-46" href="#__codelineno-197-46"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-47"><a id="__codelineno-197-47" name="__codelineno-197-47" href="#__codelineno-197-47"></a><span class="w">        </span><span class="c1">// TODO Auto-generated method stub</span>
</span><span id="__span-197-48"><a id="__codelineno-197-48" name="__codelineno-197-48" href="#__codelineno-197-48"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-49"><a id="__codelineno-197-49" name="__codelineno-197-49" href="#__codelineno-197-49"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-50"><a id="__codelineno-197-50" name="__codelineno-197-50" href="#__codelineno-197-50"></a><span class="w">                </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">recvBuf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-197-51"><a id="__codelineno-197-51" name="__codelineno-197-51" href="#__codelineno-197-51"></a><span class="w">                </span><span class="c1">//æ¥æ”¶çš„ å†…å®¹ï¼Œé•¿åº¦</span>
</span><span id="__span-197-52"><a id="__codelineno-197-52" name="__codelineno-197-52" href="#__codelineno-197-52"></a><span class="w">                </span><span class="n">DatagramPacket</span><span class="w"> </span><span class="n">dpRecv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DatagramPacket</span><span class="p">(</span><span class="n">recvBuf</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span>
</span><span id="__span-197-53"><a id="__codelineno-197-53" name="__codelineno-197-53" href="#__codelineno-197-53"></a><span class="w">                </span><span class="n">ds</span><span class="p">.</span><span class="na">receive</span><span class="p">(</span><span class="n">dpRecv</span><span class="p">);</span>
</span><span id="__span-197-54"><a id="__codelineno-197-54" name="__codelineno-197-54" href="#__codelineno-197-54"></a><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">dpRecv</span><span class="p">.</span><span class="na">getData</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">dpRecv</span><span class="p">.</span><span class="na">getLength</span><span class="p">());</span>
</span><span id="__span-197-55"><a id="__codelineno-197-55" name="__codelineno-197-55" href="#__codelineno-197-55"></a>
</span><span id="__span-197-56"><a id="__codelineno-197-56" name="__codelineno-197-56" href="#__codelineno-197-56"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">dpRecv</span><span class="p">.</span><span class="na">getAddress</span><span class="p">().</span><span class="na">getHostAddress</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"è¯´ï¼š"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">str</span><span class="p">);</span>
</span><span id="__span-197-57"><a id="__codelineno-197-57" name="__codelineno-197-57" href="#__codelineno-197-57"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-197-58"><a id="__codelineno-197-58" name="__codelineno-197-58" href="#__codelineno-197-58"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-59"><a id="__codelineno-197-59" name="__codelineno-197-59" href="#__codelineno-197-59"></a><span class="w">            </span><span class="c1">// TODO: handle exception</span>
</span><span id="__span-197-60"><a id="__codelineno-197-60" name="__codelineno-197-60" href="#__codelineno-197-60"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-197-61"><a id="__codelineno-197-61" name="__codelineno-197-61" href="#__codelineno-197-61"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-197-62"><a id="__codelineno-197-62" name="__codelineno-197-62" href="#__codelineno-197-62"></a><span class="p">}</span>
</span><span id="__span-197-63"><a id="__codelineno-197-63" name="__codelineno-197-63" href="#__codelineno-197-63"></a>
</span><span id="__span-197-64"><a id="__codelineno-197-64" name="__codelineno-197-64" href="#__codelineno-197-64"></a>
</span><span id="__span-197-65"><a id="__codelineno-197-65" name="__codelineno-197-65" href="#__codelineno-197-65"></a><span class="cm">/**</span>
</span><span id="__span-197-66"><a id="__codelineno-197-66" name="__codelineno-197-66" href="#__codelineno-197-66"></a><span class="cm"> * å¼€å§‹æ‰§è¡Œå¯¹è¯</span>
</span><span id="__span-197-67"><a id="__codelineno-197-67" name="__codelineno-197-67" href="#__codelineno-197-67"></a><span class="cm"> *</span>
</span><span id="__span-197-68"><a id="__codelineno-197-68" name="__codelineno-197-68" href="#__codelineno-197-68"></a><span class="cm"> * @author LIU</span>
</span><span id="__span-197-69"><a id="__codelineno-197-69" name="__codelineno-197-69" href="#__codelineno-197-69"></a><span class="cm"> */</span>
</span><span id="__span-197-70"><a id="__codelineno-197-70" name="__codelineno-197-70" href="#__codelineno-197-70"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UDP</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-71"><a id="__codelineno-197-71" name="__codelineno-197-71" href="#__codelineno-197-71"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-72"><a id="__codelineno-197-72" name="__codelineno-197-72" href="#__codelineno-197-72"></a><span class="w">        </span><span class="c1">// TODO Auto-generated method stub</span>
</span><span id="__span-197-73"><a id="__codelineno-197-73" name="__codelineno-197-73" href="#__codelineno-197-73"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-74"><a id="__codelineno-197-74" name="__codelineno-197-74" href="#__codelineno-197-74"></a><span class="w">            </span><span class="n">DatagramSocket</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DatagramSocket</span><span class="p">(</span><span class="mi">9988</span><span class="p">);</span>
</span><span id="__span-197-75"><a id="__codelineno-197-75" name="__codelineno-197-75" href="#__codelineno-197-75"></a>
</span><span id="__span-197-76"><a id="__codelineno-197-76" name="__codelineno-197-76" href="#__codelineno-197-76"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Send</span><span class="p">(</span><span class="n">ds</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-197-77"><a id="__codelineno-197-77" name="__codelineno-197-77" href="#__codelineno-197-77"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Recv</span><span class="p">(</span><span class="n">ds</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-197-78"><a id="__codelineno-197-78" name="__codelineno-197-78" href="#__codelineno-197-78"></a>
</span><span id="__span-197-79"><a id="__codelineno-197-79" name="__codelineno-197-79" href="#__codelineno-197-79"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-197-80"><a id="__codelineno-197-80" name="__codelineno-197-80" href="#__codelineno-197-80"></a><span class="w">            </span><span class="c1">// TODO: handle exception</span>
</span><span id="__span-197-81"><a id="__codelineno-197-81" name="__codelineno-197-81" href="#__codelineno-197-81"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-197-82"><a id="__codelineno-197-82" name="__codelineno-197-82" href="#__codelineno-197-82"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-197-83"><a id="__codelineno-197-83" name="__codelineno-197-83" href="#__codelineno-197-83"></a><span class="p">}</span>
</span></code></pre></div> <h3 id="136åŸºäº-http-åè®®ç¼–ç¨‹">13.6ã€åŸºäº HTTP åè®®ç¼–ç¨‹<a class="headerlink" href="#136åŸºäº-http-åè®®ç¼–ç¨‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>httpï¼ˆHypertext transfer protocolï¼‰è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œé€šè¿‡æµè§ˆå™¨å’ŒæœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤äº’ï¼Œè¿›è¡Œè¶…æ–‡æœ¬ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ç­‰ï¼‰ä¼ è¾“çš„è§„å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œhttp åè®®è§„å®šäº†è¶…æ–‡æœ¬ä¼ è¾“æ‰€è¦éµå®ˆçš„è§„åˆ™ã€‚é‚£ä¹ˆç½‘é¡µåœ¨è¾“å…¥ URL åˆ°åŠ è½½ï¼Œhttp ç©¶ç«Ÿåšäº†å“ªäº›å·¥ä½œå‘¢ï¼Ÿï¼ˆè§ä¸‹å›¾ï¼‰</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/17230018-9fe0c3c244864b36b22ce0eb7ec74842.png" data-desc-position="bottom"><img src="!assets/Java/17230018-9fe0c3c244864b36b22ce0eb7ec74842.png" alt="img" style="zoom:80%;float:left"></a></p> <p>æµè§ˆå™¨è´Ÿè´£å‘èµ·è¯·æ±‚å’Œæœ€åçš„å“åº”è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚åï¼Œå¤„ç†è¯·æ±‚ã€‚æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥çœ‹è¿™ä¸ªè¿‡ç¨‹ï¼Œhttpæ˜¯å¦‚ä½•è®¾å®šæ­¥éª¤ï¼Œè®¾ç½®è§„èŒƒçš„ã€‚</p> <ol> <li> <p>è¾“å…¥URLã€‚ä¸ç®¡æ˜¯é“¾æ¥è¿˜æ˜¯åœ°å€æ çš„è¾“å…¥ï¼Œæƒ…å†µéƒ½æ˜¯ä¸€æ ·çš„ã€‚http åè®®å·²ç»è§„å®šäº† URL çš„æ ¼å¼ï¼Œé€šè¿‡ http åè®®ä¸­çš„åŸŸåæˆ–IPæ‰¾åˆ°æœåŠ¡å™¨ã€‚</p> </li> <li> <p>æ‰¾åˆ°æœåŠ¡å™¨çš„åŒæ—¶ï¼Œä¼šæœ‰ http çš„è¯·æ±‚å‘é€è¿‡æ¥ï¼Œå‘Šè¯‰æœåŠ¡å™¨æˆ‘æ±‚ä½ åšä»€ä¹ˆï¼Ÿhttp åè®®è§„å®šäº†å‘é€è¯·æ±‚çš„æ ¼å¼**ï¼Œè¿™ä¸ªæ ¼å¼æœ‰ä¸‰éƒ¨åˆ†ç»„æˆè¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ã€‚</p> <p>è¯·æ±‚è¡ŒåŒ…æ‹¬è¯·æ±‚çš„æ–¹å¼ï¼ˆgetã€postæˆ–å…¶ä»–ï¼‰ã€è¦æ±‚å“åº”çš„æ–‡ä»¶ã€http ç‰ˆæœ¬ã€‚</p> <p>è¯·æ±‚å¤´åŒ…æ‹¬æœ¬æœºä¿¡æ¯ã€æµè§ˆå™¨ä¿¡æ¯ç­‰ç­‰ï¼Œå½“ç„¶ï¼Œä¹ŸåŒ…æ‹¬URLä¸­ ï¼Ÿåé¢çš„å‚æ•°ã€‚å¦‚å›¾ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/17231440-44a1e2aa088b40e9b444361c4a5548ae.png" data-desc-position="bottom"><img src="!assets/Java/17231440-44a1e2aa088b40e9b444361c4a5548ae.png" alt="img" style="zoom: 80%;"></a> è¯·æ±‚ä½“åŒ…æ‹¬ POST ä¼ é€’æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼ŒGet æ–¹å¼ä¼ å€¼æ—¶ï¼Œè¯·æ±‚ä½“ä¸ºç©ºã€‚</p> </li> <li> <p>è¯·æ±‚ä¿¡æ¯å‘é€è‡³æœåŠ¡å™¨ä»¥åï¼ŒæœåŠ¡å™¨ä¼šè·å–ä¼ é€’è¿‡æ¥çš„ç›¸å…³ä¿¡æ¯è¿›è¡Œåç«¯ç¨‹åºçš„å¤„ç†ã€‚ä¸€èˆ¬é€šè¿‡ request.querystring è·å–URLä¼ é€’è¿‡æ¥çš„å€¼ã€é€šè¿‡ request.form è·å– POST ä¼ é€’è¿‡æ¥çš„å€¼ï¼Œå½“ç„¶ï¼Œä¹Ÿæ˜¯å¯ä»¥è·å–åˆ°æ‰€æœ‰çš„å…¶ä»–è¯·æ±‚è¿‡æ¥çš„ä¿¡æ¯ï¼Œå¦‚æµè§ˆå™¨ä¿¡æ¯ã€cookieä¿¡æ¯ã€æ“ä½œç³»ç»Ÿä¿¡æ¯ç­‰ã€‚è·å–ç›¸å…³çš„æ•°æ®ä»¥åï¼ŒæœåŠ¡å™¨å°±ä¼šæ ¹æ®ç¨‹åºè¿›è¡Œå¤„ç†ã€‚</p> </li> <li> <p>å¤„ç†å®Œæˆä»¥åï¼ŒæœåŠ¡å™¨ä¼šåšå‡ºå“åº”ï¼Œå‘æµè§ˆå™¨è¾“å‡ºç›¸å…³ä¿¡æ¯ã€‚http å¯¹å“åº”çš„æ ¼å¼ä¹Ÿåšå‡ºäº†è§„å®šï¼Œå“åº”çš„ä¿¡æ¯ä¸»è¦åŒ…æ‹¬ï¼Œå“åº”ç ã€å“åº”å¤´ã€å“åº”ä½“ã€‚ å“åº”ç ç”¨æ¥æ ‡è¯†æœåŠ¡å™¨å“åº”çš„ç»“æœï¼Œå¦‚æˆ‘ä»¬å¸¸çœ‹åˆ°çš„200ã€404ç­‰ã€‚å¤§è‡´çš„åˆ†ç±»å¦‚ä¸‹ï¼š1å¼€å¤´çš„è¡¨ç¤ºæ¶ˆæ¯ï¼Œ2å¼€å¤´è¡¨ç¤ºæˆåŠŸï¼Œ3å¼€å¤´è¡¨ç¤ºé‡å®šå‘ï¼Œ4å¼€å¤´è¡¨ç¤ºå¤±è´¥ï¼Œ5å¼€å¤´è¡¨ç¤ºæœåŠ¡å™¨å¼‚å¸¸ã€‚</p> <p>å“åº”å¤´è®°å½•æœåŠ¡å™¨ç›¸å…³ä¿¡æ¯å¦‚æœåŠ¡å™¨æ˜¯å¦å¯ç”¨å‹ç¼©ã€æœåŠ¡å™¨ä¸º IIS æˆ– Ngnixã€ç¨‹åºæ‰€ç”¨æœåŠ¡ç«¯è¯­è¨€ç­‰ç­‰ã€‚å½“ç„¶ï¼Œç¼“å­˜ä¹Ÿæ˜¯åœ¨è¿™é‡Œè®¾ç½®çš„ï¼Œé€šè¿‡ä¿®æ”¹å“åº”å¤´å¯ä»¥ä¿®æ”¹ html åœ¨æœ¬åœ°ç¼“å­˜çš„æƒ…å†µï¼Œå¦‚è®¾ç½®æµè§ˆå™¨ç¼“å­˜è¿‡æœŸçš„æ—¶é—´ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/17233401-2eb186f25c0d4780b0d31111b6ce941f.png" data-desc-position="bottom"><img src="!assets/Java/17233401-2eb186f25c0d4780b0d31111b6ce941f.png" alt="img" style="zoom:80%;"></a> å“åº”ä½“ä¸»è¦æ˜¯çœ‹åˆ°çš„htmlçš„ç›¸å…³å†…å®¹äº†ã€‚</p> </li> </ol> <p>å®Œæˆä»¥ä¸Šå››éƒ¨æ“ä½œä»¥åï¼Œæµè§ˆå™¨å°±æ–­å¼€äº†ä¸æœåŠ¡å™¨çš„æ•°æ®è¿æ¥ï¼Œä¸èƒ½å†è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå¦‚æœéœ€è¦å†æ¬¡è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œé‚£ä¹ˆä¸€åˆ‡å°±è¦ä»è¾“å…¥URLå¼€å§‹ã€‚</p> <p>å¦‚æ­¤ï¼Œä¾¿æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç½‘é¡µæµç¨‹ï¼Œhttp ä»ä¸­çš„ä½œç”¨å°±æ˜¯å¯¹æ•´ä¸ªæµç¨‹è¿›è¡Œè§„å®šï¼ŒåŒ…æ‹¬æ‰§è¡Œæ­¥éª¤ï¼Œæ¯ä¸€æ­¥çš„æ•°æ®æ ¼å¼ã€‚åªæœ‰äº†è§£ http åè®®ä»¥åŠç½‘é¡µæ˜¯å¦‚ä½•äº§ç”Ÿçš„ä»¥åï¼Œæ‰èƒ½å¯¹ç½‘é¡µè¿›è¡Œæ›´å¥½çš„æ§åˆ¶ï¼Œä¾‹å¦‚æ§åˆ¶æµè§ˆå™¨ç¼“å­˜ã€é€šè¿‡éæµè§ˆå™¨å‘é€ http è¯·æ±‚ã€get å’Œ post ä¼ å€¼çš„é€‰æ‹©ï¼Œç”šè‡³æ˜¯å»ºç«‹é•¿è¿æ¥ï¼Œè¿™äº›éƒ½æ˜¯ä»¥ http åè®®ä¸ºåŸºç¡€ã€‚</p> <hr> <p>HTTP çš„åº•å±‚æ˜¯ TCP/IPã€‚æ‰€ä»¥ GET å’Œ POST çš„åº•å±‚ä¹Ÿæ˜¯ TCP/IPï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒGET/POST éƒ½æ˜¯ TCP é“¾æ¥ã€‚GET å’Œ POST èƒ½åšçš„äº‹æƒ…æ˜¯ä¸€æ ·ä¸€æ ·çš„ã€‚ä½ è¦ç»™ GET åŠ ä¸Š request bodyï¼Œç»™ POST å¸¦ä¸Šurlå‚æ•°ï¼ŒæŠ€æœ¯ä¸Šæ˜¯å®Œå…¨è¡Œçš„é€šçš„ã€‚</p> <p>åœ¨å¤§ä¸‡ç»´ç½‘ä¸–ç•Œä¸­ï¼ŒTCP å°±åƒæ±½è½¦ï¼Œæˆ‘ä»¬ç”¨ TCP æ¥è¿è¾“æ•°æ®ï¼Œå®ƒå¾ˆå¯é ï¼Œä»æ¥ä¸ä¼šå‘ç”Ÿä¸¢ä»¶å°‘ä»¶çš„ç°è±¡ã€‚ä½†æ˜¯å¦‚æœè·¯ä¸Šè·‘çš„å…¨æ˜¯çœ‹èµ·æ¥ä¸€æ¨¡ä¸€æ ·çš„æ±½è½¦ï¼Œé‚£è¿™ä¸ªä¸–ç•Œçœ‹èµ·æ¥æ˜¯ä¸€å›¢æ··ä¹±ï¼Œé€æ€¥ä»¶çš„æ±½è½¦å¯èƒ½è¢«å‰é¢æ»¡è½½è´§ç‰©çš„æ±½è½¦æ‹¦å µåœ¨è·¯ä¸Šï¼Œæ•´ä¸ªäº¤é€šç³»ç»Ÿä¸€å®šä¼šç˜«ç—ªã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œäº¤é€šè§„åˆ™ HTTP è¯ç”Ÿäº†ã€‚HTTP ç»™æ±½è½¦è¿è¾“è®¾å®šäº†å¥½å‡ ä¸ªæœåŠ¡ç±»åˆ«ï¼Œæœ‰ GET, POST, PUT, DELETE ç­‰ç­‰ï¼ŒHTTP è§„å®šï¼Œå½“æ‰§è¡Œ GET è¯·æ±‚çš„æ—¶å€™ï¼Œè¦ç»™æ±½è½¦è´´ä¸ŠGET çš„æ ‡ç­¾ï¼ˆè®¾ç½®methodä¸ºGETï¼‰ï¼Œè€Œä¸”è¦æ±‚æŠŠä¼ é€çš„æ•°æ®æ”¾åœ¨è½¦é¡¶ä¸Šï¼ˆurlä¸­ï¼‰ä»¥æ–¹ä¾¿è®°å½•ã€‚å¦‚æœæ˜¯ POSTè¯·æ±‚ï¼Œå°±è¦åœ¨è½¦ä¸Šè´´ä¸Š POST çš„æ ‡ç­¾ï¼Œå¹¶æŠŠè´§ç‰©æ”¾åœ¨è½¦å¢é‡Œã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ GET çš„æ—¶å€™å¾€è½¦å¢å†…å·å·è—ç‚¹è´§ç‰©ï¼Œä½†æ˜¯è¿™æ˜¯å¾ˆä¸å…‰å½©ï¼›ä¹Ÿå¯ä»¥åœ¨POSTçš„æ—¶å€™åœ¨è½¦é¡¶ä¸Šä¹Ÿæ”¾ä¸€äº›æ•°æ®ï¼Œè®©äººè§‰å¾—å‚»ä¹ä¹çš„ã€‚HTTPåªæ˜¯ä¸ªè¡Œä¸ºå‡†åˆ™ï¼Œè€Œ TCP æ‰æ˜¯ GET å’Œ POST æ€ä¹ˆå®ç°çš„åŸºæœ¬ã€‚</p> <p>è¿˜æœ‰å¦ä¸€ä¸ªé‡è¦çš„è§’è‰²ï¼šè¿è¾“å…¬å¸ã€‚ä¸åŒçš„æµè§ˆå™¨ï¼ˆå‘èµ·httpè¯·æ±‚ï¼‰å’ŒæœåŠ¡å™¨ï¼ˆæ¥å—httpè¯·æ±‚ï¼‰å°±æ˜¯ä¸åŒçš„è¿è¾“å…¬å¸ã€‚ è™½ç„¶ç†è®ºä¸Šï¼Œä½ å¯ä»¥åœ¨è½¦é¡¶ä¸Šæ— é™çš„å †è´§ç‰©ï¼ˆurlä¸­æ— é™åŠ å‚æ•°ï¼‰ã€‚ä½†æ˜¯è¿è¾“å…¬å¸å¯ä¸å‚»ï¼Œè£…è´§å’Œå¸è´§ä¹Ÿæ˜¯æœ‰å¾ˆå¤§æˆæœ¬çš„ï¼Œä»–ä»¬ä¼šé™åˆ¶å•æ¬¡è¿è¾“é‡æ¥æ§åˆ¶é£é™©ï¼Œæ•°æ®é‡å¤ªå¤§å¯¹æµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½æ˜¯å¾ˆå¤§è´Ÿæ‹…ã€‚ä¸šç•Œä¸æˆæ–‡çš„è§„å®šæ˜¯ï¼Œï¼ˆå¤§å¤šæ•°ï¼‰æµè§ˆå™¨é€šå¸¸éƒ½ä¼šé™åˆ¶ url é•¿åº¦åœ¨ 2K ä¸ªå­—èŠ‚ï¼Œè€Œï¼ˆå¤§å¤šæ•°ï¼‰æœåŠ¡å™¨æœ€å¤šå¤„ç† 64K å¤§å°çš„ urlã€‚è¶…è¿‡çš„éƒ¨åˆ†ï¼Œæ•ä¸å¤„ç†ã€‚å¦‚æœä½ ç”¨ GET æœåŠ¡ï¼Œåœ¨ request body å·å·è—äº†æ•°æ®ï¼Œä¸åŒæœåŠ¡å™¨çš„å¤„ç†æ–¹å¼ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œæœ‰äº›æœåŠ¡å™¨ä¼šå¸®ä½ å¸è´§ï¼Œè¯»å‡ºæ•°æ®ï¼Œæœ‰äº›æœåŠ¡å™¨ç›´æ¥å¿½ç•¥ï¼Œæ‰€ä»¥ï¼Œè™½ç„¶ GET å¯ä»¥å¸¦ request bodyï¼Œä¹Ÿä¸èƒ½ä¿è¯ä¸€å®šèƒ½è¢«æ¥æ”¶åˆ°å“¦ã€‚</p> <hr> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-198-1"><a id="__codelineno-198-1" name="__codelineno-198-1" href="#__codelineno-198-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HttpDemo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-198-2"><a id="__codelineno-198-2" name="__codelineno-198-2" href="#__codelineno-198-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-198-3"><a id="__codelineno-198-3" name="__codelineno-198-3" href="#__codelineno-198-3"></a><span class="w">        </span><span class="c1">// ä½¿ç”¨HTTPåè®®æ–¹å¼è·å–ç½‘ç»œèµ„æºåœ°å€</span>
</span><span id="__span-198-4"><a id="__codelineno-198-4" name="__codelineno-198-4" href="#__codelineno-198-4"></a><span class="w">        </span><span class="n">URL</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="s">"http://www.mtpiao.com"</span><span class="p">);</span>
</span><span id="__span-198-5"><a id="__codelineno-198-5" name="__codelineno-198-5" href="#__codelineno-198-5"></a><span class="w">        </span><span class="c1">// é€šè¿‡urlå¯¹è±¡æä¾›çš„ openConnection æ–¹æ³•è·å–èµ„æºé“¾æ¥</span>
</span><span id="__span-198-6"><a id="__codelineno-198-6" name="__codelineno-198-6" href="#__codelineno-198-6"></a><span class="w">        </span><span class="n">HttpURLConnection</span><span class="w"> </span><span class="n">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HttpURLConnection</span><span class="p">)</span><span class="w"> </span><span class="n">url</span><span class="p">.</span><span class="na">openConnection</span><span class="p">();</span>
</span><span id="__span-198-7"><a id="__codelineno-198-7" name="__codelineno-198-7" href="#__codelineno-198-7"></a><span class="w">        </span><span class="c1">// é€šè¿‡å­—ç¬¦ç¼“å†²æµè·å–ç½‘ç»œä¿¡æ¯</span>
</span><span id="__span-198-8"><a id="__codelineno-198-8" name="__codelineno-198-8" href="#__codelineno-198-8"></a><span class="w">        </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">br</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">http</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">()));</span>
</span><span id="__span-198-9"><a id="__codelineno-198-9" name="__codelineno-198-9" href="#__codelineno-198-9"></a><span class="w">        </span><span class="c1">// è¯»å–</span>
</span><span id="__span-198-10"><a id="__codelineno-198-10" name="__codelineno-198-10" href="#__codelineno-198-10"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="p">;</span>
</span><span id="__span-198-11"><a id="__codelineno-198-11" name="__codelineno-198-11" href="#__codelineno-198-11"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">br</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-198-12"><a id="__codelineno-198-12" name="__codelineno-198-12" href="#__codelineno-198-12"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span><span id="__span-198-13"><a id="__codelineno-198-13" name="__codelineno-198-13" href="#__codelineno-198-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-198-14"><a id="__codelineno-198-14" name="__codelineno-198-14" href="#__codelineno-198-14"></a><span class="w">        </span><span class="n">br</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</span><span id="__span-198-15"><a id="__codelineno-198-15" name="__codelineno-198-15" href="#__codelineno-198-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-198-16"><a id="__codelineno-198-16" name="__codelineno-198-16" href="#__codelineno-198-16"></a><span class="p">}</span>
</span></code></pre></div> <h2 id="15æ³¨è§£annotation">15ã€æ³¨è§£ï¼ˆAnnotationï¼‰<a class="headerlink" href="#15æ³¨è§£annotation" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <h3 id="151æ³¨è§£ç®€ä»‹">15.1ã€æ³¨è§£ç®€ä»‹<a class="headerlink" href="#151æ³¨è§£ç®€ä»‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Java æ³¨è§£ç”¨äºä¸º Java ä»£ç æä¾›å…ƒæ•°æ®ã€‚ä½œä¸ºå…ƒæ•°æ®ï¼Œæ³¨è§£ä¸ç›´æ¥å½±å“ä½ çš„ä»£ç æ‰§è¡Œï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ç±»å‹çš„æ³¨è§£å®é™…ä¸Šå¯ä»¥ç”¨äºè¿™ä¸€ç›®çš„ã€‚Java æ³¨è§£æ˜¯ä» Java5 å¼€å§‹æ·»åŠ åˆ° Java çš„ã€‚</p> <p>å…¶å®åŒ classs å’Œ interface ä¸€æ ·ï¼Œæ³¨è§£ä¹Ÿå±äºä¸€ç§ç±»å‹ã€‚</p> <hr> <p><strong>æ³¨è§£çš„å®šä¹‰</strong></p> <p>æ³¨è§£é€šè¿‡ <code>@interface</code>å…³é”®å­—è¿›è¡Œå®šä¹‰ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-199-1"><a id="__codelineno-199-1" name="__codelineno-199-1" href="#__codelineno-199-1"></a><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">TestAnnotation</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-199-2"><a id="__codelineno-199-2" name="__codelineno-199-2" href="#__codelineno-199-2"></a><span class="p">}</span>
</span></code></pre></div> <p>å®ƒçš„å½¢å¼è·Ÿæ¥å£å¾ˆç±»ä¼¼ï¼Œä¸è¿‡å‰é¢å¤šäº†ä¸€ä¸ª @ ç¬¦å·ã€‚ä¸Šé¢çš„ä»£ç å°±åˆ›å»ºäº†ä¸€ä¸ªåå­—ä¸º TestAnnotaion çš„æ³¨è§£ã€‚</p> <hr> <p><strong>æ³¨è§£çš„åº”ç”¨</strong></p> <p>ä¸Šé¢åˆ›å»ºäº†ä¸€ä¸ªæ³¨è§£ï¼Œé‚£ä¹ˆæ³¨è§£çš„çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-200-1"><a id="__codelineno-200-1" name="__codelineno-200-1" href="#__codelineno-200-1"></a><span class="nd">@TestAnnotation</span>
</span><span id="__span-200-2"><a id="__codelineno-200-2" name="__codelineno-200-2" href="#__codelineno-200-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-200-3"><a id="__codelineno-200-3" name="__codelineno-200-3" href="#__codelineno-200-3"></a><span class="p">}</span>
</span></code></pre></div> <p>åˆ›å»ºä¸€ä¸ªç±» Test,ç„¶ååœ¨ç±»å®šä¹‰çš„åœ°æ–¹åŠ ä¸Š @TestAnnotation å°±å¯ä»¥ç”¨ TestAnnotation æ³¨è§£è¿™ä¸ªç±»äº†ã€‚</p> <p>ä¸è¿‡ï¼Œè¦æƒ³æ³¨è§£èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œè¿˜éœ€è¦ä»‹ç»ä¸€ä¸‹ä¸€ä¸ªæ–°çš„æ¦‚å¿µé‚£å°±æ˜¯å…ƒæ³¨è§£ã€‚</p> <h3 id="152å…ƒæ³¨è§£">15.2ã€å…ƒæ³¨è§£<a class="headerlink" href="#152å…ƒæ³¨è§£" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å…ƒæ³¨è§£æ˜¯å¯ä»¥æ³¨è§£åˆ°æ³¨è§£ä¸Šçš„æ³¨è§£ï¼Œæˆ–è€…è¯´å…ƒæ³¨è§£æ˜¯ä¸€ç§åŸºæœ¬æ³¨è§£ï¼Œä½†æ˜¯å®ƒèƒ½å¤Ÿåº”ç”¨åˆ°å…¶å®ƒçš„æ³¨è§£ä¸Šé¢ã€‚</p> <p>å¦‚æœéš¾äºç†è§£çš„è¯ï¼Œå¯ä»¥è¿™æ ·ç†è§£ã€‚å…ƒæ³¨è§£ä¹Ÿæ˜¯ä¸€å¼ æ ‡ç­¾ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€å¼ ç‰¹æ®Šçš„æ ‡ç­¾ï¼Œå®ƒçš„ä½œç”¨å’Œç›®çš„å°±æ˜¯ç»™å…¶ä»–æ™®é€šçš„æ ‡ç­¾è¿›è¡Œè§£é‡Šè¯´æ˜çš„ã€‚</p> <p>å…ƒæ ‡ç­¾æœ‰ @Retentionã€@Documentedã€@Targetã€@Inheritedã€@Repeatable 5 ç§ã€‚</p> <hr> <p><strong>@Retention</strong></p> <p>Retention çš„è‹±æ–‡æ„ä¸ºä¿ç•™æœŸçš„æ„æ€ã€‚å½“ @Retention åº”ç”¨åˆ°ä¸€ä¸ªæ³¨è§£ä¸Šçš„æ—¶å€™ï¼Œå®ƒè§£é‡Šè¯´æ˜äº†è¿™ä¸ªæ³¨è§£çš„çš„å­˜æ´»æ—¶é—´ã€‚</p> <p>å®ƒçš„å–å€¼å¦‚ä¸‹ï¼š</p> <ul> <li>RetentionPolicy.SOURCE æ³¨è§£åªåœ¨æºç é˜¶æ®µä¿ç•™ï¼Œåœ¨ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘æ—¶å®ƒå°†è¢«ä¸¢å¼ƒå¿½è§†ã€‚</li> <li>RetentionPolicy.CLASS æ³¨è§£åªè¢«ä¿ç•™åˆ°ç¼–è¯‘è¿›è¡Œçš„æ—¶å€™ï¼Œå®ƒå¹¶ä¸ä¼šè¢«åŠ è½½åˆ° JVM ä¸­ã€‚</li> <li>RetentionPolicy.RUNTIME æ³¨è§£å¯ä»¥ä¿ç•™åˆ°ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šè¢«åŠ è½½è¿›å…¥åˆ° JVM ä¸­ï¼Œæ‰€ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶å¯ä»¥è·å–åˆ°å®ƒä»¬ã€‚</li> </ul> <p>åŠ æ·±ç†è§£ï¼š@Retention å»ç»™ä¸€å¼ æ ‡ç­¾è§£é‡Šçš„æ—¶å€™ï¼Œå®ƒæŒ‡å®šäº†è¿™å¼ æ ‡ç­¾å¼ è´´çš„æ—¶é—´ã€‚@Retention ç›¸å½“äºç»™ä¸€å¼ æ ‡ç­¾ä¸Šé¢ç›–äº†ä¸€å¼ æ—¶é—´æˆ³ï¼Œæ—¶é—´æˆ³æŒ‡æ˜äº†æ ‡ç­¾å¼ è´´çš„æ—¶é—´å‘¨æœŸã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-201-1"><a id="__codelineno-201-1" name="__codelineno-201-1" href="#__codelineno-201-1"></a><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
</span><span id="__span-201-2"><a id="__codelineno-201-2" name="__codelineno-201-2" href="#__codelineno-201-2"></a><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">TestAnnotation</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-201-3"><a id="__codelineno-201-3" name="__codelineno-201-3" href="#__codelineno-201-3"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒæŒ‡å®š TestAnnotation å¯ä»¥åœ¨ç¨‹åºè¿è¡Œå‘¨æœŸè¢«è·å–åˆ°ï¼Œå› æ­¤å®ƒçš„ç”Ÿå‘½å‘¨æœŸéå¸¸çš„é•¿ã€‚</p> <hr> <p><strong>@Documented</strong></p> <p>é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªå…ƒæ³¨è§£è‚¯å®šæ˜¯å’Œæ–‡æ¡£æœ‰å…³ã€‚å®ƒçš„ä½œç”¨æ˜¯èƒ½å¤Ÿå°†æ³¨è§£ä¸­çš„å…ƒç´ åŒ…å«åˆ° Javadoc ä¸­å»ã€‚</p> <hr> <p><strong>@Target</strong></p> <p>Target æ˜¯ç›®æ ‡çš„æ„æ€ï¼Œ@Target æŒ‡å®šäº†æ³¨è§£è¿ç”¨çš„åœ°æ–¹ï¼›å½“ä¸€ä¸ªæ³¨è§£è¢« @Target æ³¨è§£æ—¶ï¼Œè¿™ä¸ªæ³¨è§£å°±è¢«é™å®šäº†è¿ç”¨çš„åœºæ™¯ã€‚</p> <p>ç±»æ¯”åˆ°æ ‡ç­¾ï¼ŒåŸæœ¬æ ‡ç­¾æ˜¯ä½ æƒ³å¼ è´´åˆ°å“ªä¸ªåœ°æ–¹å°±åˆ°å“ªä¸ªåœ°æ–¹ï¼Œä½†æ˜¯å› ä¸º @Target çš„å­˜åœ¨ï¼Œå®ƒå¼ è´´çš„åœ°æ–¹å°±éå¸¸å…·ä½“äº†ï¼Œæ¯”å¦‚åªèƒ½å¼ è´´åˆ°æ–¹æ³•ä¸Šã€ç±»ä¸Šã€æ–¹æ³•å‚æ•°ä¸Šç­‰ç­‰ã€‚@Target æœ‰ä¸‹é¢çš„å–å€¼ï¼š</p> <ul> <li>ElementType.ANNOTATION_TYPE å¯ä»¥ç»™ä¸€ä¸ªæ³¨è§£è¿›è¡Œæ³¨è§£</li> <li>ElementType.CONSTRUCTOR å¯ä»¥ç»™æ„é€ æ–¹æ³•è¿›è¡Œæ³¨è§£</li> <li>ElementType.FIELD å¯ä»¥ç»™å±æ€§è¿›è¡Œæ³¨è§£</li> <li>ElementType.LOCAL_VARIABLE å¯ä»¥ç»™å±€éƒ¨å˜é‡è¿›è¡Œæ³¨è§£</li> <li>ElementType.METHOD å¯ä»¥ç»™æ–¹æ³•è¿›è¡Œæ³¨è§£</li> <li>ElementType.PACKAGE å¯ä»¥ç»™ä¸€ä¸ªåŒ…è¿›è¡Œæ³¨è§£</li> <li>ElementType.PARAMETER å¯ä»¥ç»™ä¸€ä¸ªæ–¹æ³•å†…çš„å‚æ•°è¿›è¡Œæ³¨è§£</li> <li>ElementType.TYPE å¯ä»¥ç»™ä¸€ä¸ªç±»å‹è¿›è¡Œæ³¨è§£ï¼Œæ¯”å¦‚ç±»ã€æ¥å£ã€æšä¸¾</li> </ul> <hr> <p><strong>@Inherited</strong></p> <p>Inherited æ˜¯ç»§æ‰¿çš„æ„æ€ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯è¯´æ³¨è§£æœ¬èº«å¯ä»¥ç»§æ‰¿ï¼Œè€Œæ˜¯è¯´å¦‚æœä¸€ä¸ªè¶…ç±»è¢« @Inherited æ³¨è§£è¿‡çš„æ³¨è§£è¿›è¡Œæ³¨è§£çš„è¯ï¼Œé‚£ä¹ˆå¦‚æœå®ƒçš„å­ç±»æ²¡æœ‰è¢«ä»»ä½•æ³¨è§£åº”ç”¨çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå­ç±»å°±ç»§æ‰¿äº†è¶…ç±»çš„æ³¨è§£ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-202-1"><a id="__codelineno-202-1" name="__codelineno-202-1" href="#__codelineno-202-1"></a><span class="nd">@Inherited</span>
</span><span id="__span-202-2"><a id="__codelineno-202-2" name="__codelineno-202-2" href="#__codelineno-202-2"></a><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
</span><span id="__span-202-3"><a id="__codelineno-202-3" name="__codelineno-202-3" href="#__codelineno-202-3"></a><span class="nd">@interface</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-202-4"><a id="__codelineno-202-4" name="__codelineno-202-4" href="#__codelineno-202-4"></a>
</span><span id="__span-202-5"><a id="__codelineno-202-5" name="__codelineno-202-5" href="#__codelineno-202-5"></a><span class="nd">@Test</span>
</span><span id="__span-202-6"><a id="__codelineno-202-6" name="__codelineno-202-6" href="#__codelineno-202-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">A</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-202-7"><a id="__codelineno-202-7" name="__codelineno-202-7" href="#__codelineno-202-7"></a>
</span><span id="__span-202-8"><a id="__codelineno-202-8" name="__codelineno-202-8" href="#__codelineno-202-8"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">B</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div> <p>æ³¨è§£ Test è¢« @Inherited ä¿®é¥°ï¼Œä¹‹åç±» A è¢« Test æ³¨è§£ï¼Œç±» B ç»§æ‰¿ A,ç±» B ä¹Ÿæ‹¥æœ‰ Test è¿™ä¸ªæ³¨è§£ã€‚</p> <p>è€å­éå¸¸æœ‰é’±ï¼Œæ‰€ä»¥äººä»¬ç»™ä»–è´´äº†ä¸€å¼ æ ‡ç­¾å«åšå¯Œè±ªã€‚è€å­çš„å„¿å­é•¿å¤§åï¼Œåªè¦æ²¡æœ‰å’Œè€å­æ–­ç»çˆ¶å­å…³ç³»ï¼Œè™½ç„¶åˆ«äººæ²¡æœ‰ç»™ä»–è´´æ ‡ç­¾ï¼Œä½†æ˜¯ä»–è‡ªç„¶ä¹Ÿæ˜¯å¯Œè±ªã€‚è€å­çš„å­™å­é•¿å¤§äº†ï¼Œè‡ªç„¶ä¹Ÿæ˜¯å¯Œè±ªã€‚</p> <hr> <p><strong>@Repeatable</strong></p> <p>Repeatable è‡ªç„¶æ˜¯å¯é‡å¤çš„æ„æ€ã€‚@Repeatable æ˜¯ Java 1.8 æ‰åŠ è¿›æ¥çš„ï¼Œæ‰€ä»¥ç®—æ˜¯ä¸€ä¸ªæ–°çš„ç‰¹æ€§ã€‚</p> <p>ä»€ä¹ˆæ ·çš„æ³¨è§£ä¼šå¤šæ¬¡åº”ç”¨å‘¢ï¼Ÿé€šå¸¸æ˜¯æ³¨è§£çš„å€¼å¯ä»¥åŒæ—¶å–å¤šä¸ªã€‚</p> <p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªäººä»–æ—¢æ˜¯ç¨‹åºå‘˜åˆæ˜¯äº§å“ç»ç†,åŒæ—¶ä»–è¿˜æ˜¯ä¸ªç”»å®¶ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-203-1"><a id="__codelineno-203-1" name="__codelineno-203-1" href="#__codelineno-203-1"></a><span class="nd">@interface</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-203-2"><a id="__codelineno-203-2" name="__codelineno-203-2" href="#__codelineno-203-2"></a><span class="w">    </span><span class="n">Person</span><span class="o">[]</span><span class="w">  </span><span class="nf">value</span><span class="p">();</span>
</span><span id="__span-203-3"><a id="__codelineno-203-3" name="__codelineno-203-3" href="#__codelineno-203-3"></a><span class="p">}</span>
</span><span id="__span-203-4"><a id="__codelineno-203-4" name="__codelineno-203-4" href="#__codelineno-203-4"></a>
</span><span id="__span-203-5"><a id="__codelineno-203-5" name="__codelineno-203-5" href="#__codelineno-203-5"></a><span class="nd">@Repeatable</span><span class="p">(</span><span class="n">Persons</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-203-6"><a id="__codelineno-203-6" name="__codelineno-203-6" href="#__codelineno-203-6"></a><span class="nd">@interface</span><span class="w"> </span><span class="n">Person</span><span class="p">{</span>
</span><span id="__span-203-7"><a id="__codelineno-203-7" name="__codelineno-203-7" href="#__codelineno-203-7"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">role</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s">""</span><span class="p">;</span>
</span><span id="__span-203-8"><a id="__codelineno-203-8" name="__codelineno-203-8" href="#__codelineno-203-8"></a><span class="p">}</span>
</span><span id="__span-203-9"><a id="__codelineno-203-9" name="__codelineno-203-9" href="#__codelineno-203-9"></a>
</span><span id="__span-203-10"><a id="__codelineno-203-10" name="__codelineno-203-10" href="#__codelineno-203-10"></a><span class="nd">@Person</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"artist"</span><span class="p">)</span>
</span><span id="__span-203-11"><a id="__codelineno-203-11" name="__codelineno-203-11" href="#__codelineno-203-11"></a><span class="nd">@Person</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"coder"</span><span class="p">)</span>
</span><span id="__span-203-12"><a id="__codelineno-203-12" name="__codelineno-203-12" href="#__codelineno-203-12"></a><span class="nd">@Person</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s">"PM"</span><span class="p">)</span>
</span><span id="__span-203-13"><a id="__codelineno-203-13" name="__codelineno-203-13" href="#__codelineno-203-13"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SuperMan</span><span class="p">{</span>
</span><span id="__span-203-14"><a id="__codelineno-203-14" name="__codelineno-203-14" href="#__codelineno-203-14"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢çš„ä»£ç ï¼Œ@Repeatable æ³¨è§£äº† Personã€‚è€Œ @Repeatable åé¢æ‹¬å·ä¸­çš„ç±»ç›¸å½“äºä¸€ä¸ªå®¹å™¨æ³¨è§£ã€‚</p> <p>ä»€ä¹ˆæ˜¯å®¹å™¨æ³¨è§£å‘¢ï¼Ÿå°±æ˜¯ç”¨æ¥å­˜æ”¾å…¶å®ƒæ³¨è§£çš„åœ°æ–¹ã€‚å®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ³¨è§£ã€‚æŒ‰ç…§è§„å®šï¼Œå®ƒé‡Œé¢å¿…é¡»è¦æœ‰ä¸€ä¸ª value çš„å±æ€§ï¼Œå±æ€§ç±»å‹æ˜¯ä¸€ä¸ªè¢« @Repeatable æ³¨è§£è¿‡çš„æ³¨è§£æ•°ç»„ï¼Œæ³¨æ„å®ƒæ˜¯æ•°ç»„ã€‚</p> <h3 id="153æ³¨è§£çš„å±æ€§">15.3ã€æ³¨è§£çš„å±æ€§<a class="headerlink" href="#153æ³¨è§£çš„å±æ€§" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æ³¨è§£çš„å±æ€§ä¹Ÿå«åšæˆå‘˜å˜é‡ã€‚æ³¨è§£åªæœ‰æˆå‘˜å˜é‡ï¼Œæ²¡æœ‰æ–¹æ³•ã€‚æ³¨è§£çš„æˆå‘˜å˜é‡åœ¨æ³¨è§£çš„å®šä¹‰ä¸­ä»¥â€œæ— å½¢å‚çš„æ–¹æ³•â€å½¢å¼æ¥å£°æ˜ï¼Œå…¶æ–¹æ³•åå®šä¹‰äº†è¯¥æˆå‘˜å˜é‡çš„åå­—ï¼Œå…¶è¿”å›å€¼å®šä¹‰äº†è¯¥æˆå‘˜å˜é‡çš„ç±»å‹ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-204-1"><a id="__codelineno-204-1" name="__codelineno-204-1" href="#__codelineno-204-1"></a><span class="nd">@Target</span><span class="p">(</span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">)</span>
</span><span id="__span-204-2"><a id="__codelineno-204-2" name="__codelineno-204-2" href="#__codelineno-204-2"></a><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
</span><span id="__span-204-3"><a id="__codelineno-204-3" name="__codelineno-204-3" href="#__codelineno-204-3"></a><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">TestAnnotation</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-204-4"><a id="__codelineno-204-4" name="__codelineno-204-4" href="#__codelineno-204-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">id</span><span class="p">();</span>
</span><span id="__span-204-5"><a id="__codelineno-204-5" name="__codelineno-204-5" href="#__codelineno-204-5"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">msg</span><span class="p">();</span>
</span><span id="__span-204-6"><a id="__codelineno-204-6" name="__codelineno-204-6" href="#__codelineno-204-6"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ä»£ç å®šä¹‰äº† TestAnnotation è¿™ä¸ªæ³¨è§£ä¸­æ‹¥æœ‰ id å’Œ msg ä¸¤ä¸ªå±æ€§ã€‚åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œåº”è¯¥ç»™å®ƒä»¬è¿›è¡Œèµ‹å€¼ã€‚</p> <p>èµ‹å€¼çš„æ–¹å¼æ˜¯åœ¨æ³¨è§£çš„æ‹¬å·å†…ä»¥ <code>value=""</code> å½¢å¼ï¼Œå¤šä¸ªå±æ€§ä¹‹é—´ç”¨ <code>,</code>éš”å¼€ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-205-1"><a id="__codelineno-205-1" name="__codelineno-205-1" href="#__codelineno-205-1"></a><span class="nd">@TestAnnotation</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s">"hello annotation"</span><span class="p">)</span>
</span><span id="__span-205-2"><a id="__codelineno-205-2" name="__codelineno-205-2" href="#__codelineno-205-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-205-3"><a id="__codelineno-205-3" name="__codelineno-205-3" href="#__codelineno-205-3"></a><span class="p">}</span>
</span></code></pre></div> <p>æ³¨è§£ä¸­å±æ€§å¯ä»¥æœ‰é»˜è®¤å€¼ï¼Œé»˜è®¤å€¼éœ€è¦ç”¨ default å…³é”®å€¼æŒ‡å®šã€‚æ¯”å¦‚ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-206-1"><a id="__codelineno-206-1" name="__codelineno-206-1" href="#__codelineno-206-1"></a><span class="nd">@Target</span><span class="p">(</span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">)</span>
</span><span id="__span-206-2"><a id="__codelineno-206-2" name="__codelineno-206-2" href="#__codelineno-206-2"></a><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
</span><span id="__span-206-3"><a id="__codelineno-206-3" name="__codelineno-206-3" href="#__codelineno-206-3"></a><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">TestAnnotation</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-206-4"><a id="__codelineno-206-4" name="__codelineno-206-4" href="#__codelineno-206-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">id</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-206-5"><a id="__codelineno-206-5" name="__codelineno-206-5" href="#__codelineno-206-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">msg</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="s">"Hi"</span><span class="p">;</span>
</span><span id="__span-206-6"><a id="__codelineno-206-6" name="__codelineno-206-6" href="#__codelineno-206-6"></a><span class="p">}</span>
</span></code></pre></div> <p>TestAnnotation ä¸­ id å±æ€§é»˜è®¤å€¼ä¸º -1ï¼Œmsg å±æ€§é»˜è®¤å€¼ä¸º Hiã€‚</p> <p>å®ƒå¯ä»¥è¿™æ ·åº”ç”¨ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-207-1"><a id="__codelineno-207-1" name="__codelineno-207-1" href="#__codelineno-207-1"></a><span class="nd">@TestAnnotation</span><span class="p">()</span>
</span><span id="__span-207-2"><a id="__codelineno-207-2" name="__codelineno-207-2" href="#__codelineno-207-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div> <p>å› ä¸ºæœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥æ— éœ€è¦å†åœ¨ @TestAnnotation åé¢çš„æ‹¬å·é‡Œé¢è¿›è¡Œèµ‹å€¼äº†ï¼Œè¿™ä¸€æ­¥å¯ä»¥çœç•¥ã€‚</p> <p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µã€‚å¦‚æœä¸€ä¸ªæ³¨è§£å†…ä»…ä»…åªæœ‰ä¸€ä¸ªåå­—ä¸º value çš„å±æ€§æ—¶ï¼Œåº”ç”¨è¿™ä¸ªæ³¨è§£æ—¶å¯ä»¥ç›´æ¥æ¥å±æ€§å€¼å¡«å†™åˆ°æ‹¬å·å†…ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-208-1"><a id="__codelineno-208-1" name="__codelineno-208-1" href="#__codelineno-208-1"></a><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-208-2"><a id="__codelineno-208-2" name="__codelineno-208-2" href="#__codelineno-208-2"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">value</span><span class="p">();</span>
</span><span id="__span-208-3"><a id="__codelineno-208-3" name="__codelineno-208-3" href="#__codelineno-208-3"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢ä»£ç ä¸­ï¼ŒCheck è¿™ä¸ªæ³¨è§£åªæœ‰ value è¿™ä¸ªå±æ€§ã€‚æ‰€ä»¥å¯ä»¥è¿™æ ·åº”ç”¨ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-209-1"><a id="__codelineno-209-1" name="__codelineno-209-1" href="#__codelineno-209-1"></a><span class="nd">@Check</span><span class="p">(</span><span class="s">"hi"</span><span class="p">)</span>
</span><span id="__span-209-2"><a id="__codelineno-209-2" name="__codelineno-209-2" href="#__codelineno-209-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span></code></pre></div> <p>è¿™å’Œä¸‹é¢çš„æ•ˆæœæ˜¯ä¸€æ ·çš„</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-210-1"><a id="__codelineno-210-1" name="__codelineno-210-1" href="#__codelineno-210-1"></a><span class="nd">@Check</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">"hi"</span><span class="p">)</span>
</span><span id="__span-210-2"><a id="__codelineno-210-2" name="__codelineno-210-2" href="#__codelineno-210-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span></code></pre></div> <p>æœ€åï¼Œè¿˜éœ€è¦æ³¨æ„çš„ä¸€ç§æƒ…å†µæ˜¯ä¸€ä¸ªæ³¨è§£æ²¡æœ‰ä»»ä½•å±æ€§ã€‚æ¯”å¦‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-211-1"><a id="__codelineno-211-1" name="__codelineno-211-1" href="#__codelineno-211-1"></a><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">Perform</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div> <p>é‚£ä¹ˆåœ¨åº”ç”¨è¿™ä¸ªæ³¨è§£çš„æ—¶å€™ï¼Œæ‹¬å·éƒ½å¯ä»¥çœç•¥ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-212-1"><a id="__codelineno-212-1" name="__codelineno-212-1" href="#__codelineno-212-1"></a><span class="nd">@Perform</span>
</span><span id="__span-212-2"><a id="__codelineno-212-2" name="__codelineno-212-2" href="#__codelineno-212-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testMethod</span><span class="p">(){}</span>
</span></code></pre></div> <h3 id="154java-é¢„ç½®çš„æ³¨è§£">15.4ã€Java é¢„ç½®çš„æ³¨è§£<a class="headerlink" href="#154java-é¢„ç½®çš„æ³¨è§£" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>@Deprecated</strong></p> <p>è¿™ä¸ªå…ƒç´ æ˜¯ç”¨æ¥æ ‡è®°è¿‡æ—¶çš„å…ƒç´ ã€‚ç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µé‡åˆ°è¿™ä¸ªæ³¨è§£æ—¶ä¼šå‘å‡ºæé†’è­¦å‘Šï¼Œå‘Šè¯‰å¼€å‘è€…æ­£åœ¨è°ƒç”¨ä¸€ä¸ªè¿‡æ—¶çš„å…ƒç´ æ¯”å¦‚è¿‡æ—¶çš„æ–¹æ³•ã€è¿‡æ—¶çš„ç±»ã€è¿‡æ—¶çš„æˆå‘˜å˜é‡ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-213-1"><a id="__codelineno-213-1" name="__codelineno-213-1" href="#__codelineno-213-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Hero</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-213-2"><a id="__codelineno-213-2" name="__codelineno-213-2" href="#__codelineno-213-2"></a><span class="w">    </span><span class="nd">@Deprecated</span>
</span><span id="__span-213-3"><a id="__codelineno-213-3" name="__codelineno-213-3" href="#__codelineno-213-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">say</span><span class="p">(){</span>
</span><span id="__span-213-4"><a id="__codelineno-213-4" name="__codelineno-213-4" href="#__codelineno-213-4"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Noting has to say!"</span><span class="p">);</span>
</span><span id="__span-213-5"><a id="__codelineno-213-5" name="__codelineno-213-5" href="#__codelineno-213-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-213-6"><a id="__codelineno-213-6" name="__codelineno-213-6" href="#__codelineno-213-6"></a>
</span><span id="__span-213-7"><a id="__codelineno-213-7" name="__codelineno-213-7" href="#__codelineno-213-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">speak</span><span class="p">(){</span>
</span><span id="__span-213-8"><a id="__codelineno-213-8" name="__codelineno-213-8" href="#__codelineno-213-8"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"I have a dream!"</span><span class="p">);</span>
</span><span id="__span-213-9"><a id="__codelineno-213-9" name="__codelineno-213-9" href="#__codelineno-213-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-213-10"><a id="__codelineno-213-10" name="__codelineno-213-10" href="#__codelineno-213-10"></a><span class="p">}</span>
</span></code></pre></div> <p>å®šä¹‰äº†ä¸€ä¸ª Hero ç±»ï¼Œå®ƒæœ‰ä¸¤ä¸ªæ–¹æ³• say() å’Œ speak() ï¼Œå…¶ä¸­ say() è¢« @Deprecated æ³¨è§£ã€‚ç„¶åæˆ‘ä»¬åœ¨ IDE ä¸­åˆ†åˆ«è°ƒç”¨å®ƒä»¬ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Java/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcwNjI3MjE0MDA4NTg4" data-desc-position="bottom"><img src="!assets/Java/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcwNjI3MjE0MDA4NTg4" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" style="zoom:80%;float:left"></a></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œsay() æ–¹æ³•ä¸Šé¢è¢«ä¸€æ¡ç›´çº¿åˆ’äº†ä¸€æ¡ï¼Œè¿™å…¶å®å°±æ˜¯ç¼–è¯‘å™¨è¯†åˆ«åçš„æé†’æ•ˆæœã€‚</p> <hr> <p><strong>@Override</strong></p> <p>æç¤ºå­ç±»è¦å¤å†™çˆ¶ç±»ä¸­è¢« @Override ä¿®é¥°çš„æ–¹æ³•</p> <hr> <p><strong>@SuppressWarnings</strong></p> <p>é˜»æ­¢è­¦å‘Šçš„æ„æ€ã€‚ä¹‹å‰è¯´è¿‡è°ƒç”¨è¢« @Deprecated æ³¨è§£çš„æ–¹æ³•åï¼Œç¼–è¯‘å™¨ä¼šè­¦å‘Šæé†’ï¼Œè€Œæœ‰æ—¶å€™å¼€å‘è€…ä¼šå¿½ç•¥è¿™ç§è­¦å‘Šï¼Œä»–ä»¬å¯ä»¥åœ¨è°ƒç”¨çš„åœ°æ–¹é€šè¿‡ @SuppressWarnings è¾¾åˆ°ç›®çš„ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-214-1"><a id="__codelineno-214-1" name="__codelineno-214-1" href="#__codelineno-214-1"></a><span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">"deprecation"</span><span class="p">)</span>
</span><span id="__span-214-2"><a id="__codelineno-214-2" name="__codelineno-214-2" href="#__codelineno-214-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test1</span><span class="p">(){</span>
</span><span id="__span-214-3"><a id="__codelineno-214-3" name="__codelineno-214-3" href="#__codelineno-214-3"></a><span class="w">    </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Hero</span><span class="p">();</span>
</span><span id="__span-214-4"><a id="__codelineno-214-4" name="__codelineno-214-4" href="#__codelineno-214-4"></a><span class="w">    </span><span class="n">hero</span><span class="p">.</span><span class="na">say</span><span class="p">();</span>
</span><span id="__span-214-5"><a id="__codelineno-214-5" name="__codelineno-214-5" href="#__codelineno-214-5"></a><span class="w">    </span><span class="n">hero</span><span class="p">.</span><span class="na">speak</span><span class="p">();</span>
</span><span id="__span-214-6"><a id="__codelineno-214-6" name="__codelineno-214-6" href="#__codelineno-214-6"></a><span class="p">}</span>
</span></code></pre></div> <hr> <p><strong>@FunctionalInterface</strong></p> <p>å‡½æ•°å¼æ¥å£æ³¨è§£ï¼Œè¿™ä¸ªæ˜¯ Java 1.8 ç‰ˆæœ¬å¼•å…¥çš„æ–°ç‰¹æ€§ã€‚å‡½æ•°å¼ç¼–ç¨‹å¾ˆç«ï¼Œæ‰€ä»¥ Java 8 ä¹ŸåŠæ—¶æ·»åŠ äº†è¿™ä¸ªç‰¹æ€§ã€‚</p> <h3 id="155æ³¨è§£çš„æå–">15.5ã€æ³¨è§£çš„æå–<a class="headerlink" href="#155æ³¨è§£çš„æå–" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æ³¨è§£é€šè¿‡åå°„è·å–ã€‚é¦–å…ˆå¯ä»¥é€šè¿‡ Class å¯¹è±¡çš„ isAnnotationPresent() æ–¹æ³•åˆ¤æ–­å®ƒæ˜¯å¦åº”ç”¨äº†æŸä¸ªæ³¨è§£ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-215-1"><a id="__codelineno-215-1" name="__codelineno-215-1" href="#__codelineno-215-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isAnnotationPresent</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Annotation</span><span class="o">&gt;</span><span class="w"> </span><span class="n">annotationClass</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div> <p>ç„¶åé€šè¿‡ getAnnotation() æ–¹æ³•æ¥è·å– Annotation å¯¹è±¡ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-216-1"><a id="__codelineno-216-1" name="__codelineno-216-1" href="#__codelineno-216-1"></a><span class="kd">public</span><span class="w"> </span><span class="o">&lt;</span><span class="n">A</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Annotation</span><span class="o">&gt;</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="nf">getAnnotation</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="n">annotationClass</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div> <p>æˆ–è€…æ˜¯ getAnnotations() æ–¹æ³•ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-217-1"><a id="__codelineno-217-1" name="__codelineno-217-1" href="#__codelineno-217-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">Annotation</span><span class="o">[]</span><span class="w"> </span><span class="nf">getAnnotations</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div> <p>å‰ä¸€ç§æ–¹æ³•è¿”å›æŒ‡å®šç±»å‹çš„æ³¨è§£ï¼Œåä¸€ç§æ–¹æ³•è¿”å›æ³¨è§£åˆ°è¿™ä¸ªå…ƒç´ ä¸Šçš„æ‰€æœ‰æ³¨è§£ã€‚å¦‚æœè·å–åˆ°çš„ Annotation å¦‚æœä¸ä¸º nullï¼Œåˆ™å°±å¯ä»¥è°ƒç”¨å®ƒä»¬çš„å±æ€§æ–¹æ³•äº†ã€‚æ¯”å¦‚:</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-218-1"><a id="__codelineno-218-1" name="__codelineno-218-1" href="#__codelineno-218-1"></a><span class="nd">@TestAnnotation</span><span class="p">()</span>
</span><span id="__span-218-2"><a id="__codelineno-218-2" name="__codelineno-218-2" href="#__codelineno-218-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-218-3"><a id="__codelineno-218-3" name="__codelineno-218-3" href="#__codelineno-218-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">        </span>
</span><span id="__span-218-4"><a id="__codelineno-218-4" name="__codelineno-218-4" href="#__codelineno-218-4"></a><span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">hasAnnotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Test</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">isAnnotationPresent</span><span class="p">(</span><span class="n">TestAnnotation</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-218-5"><a id="__codelineno-218-5" name="__codelineno-218-5" href="#__codelineno-218-5"></a>
</span><span id="__span-218-6"><a id="__codelineno-218-6" name="__codelineno-218-6" href="#__codelineno-218-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">hasAnnotation</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-218-7"><a id="__codelineno-218-7" name="__codelineno-218-7" href="#__codelineno-218-7"></a><span class="w">            </span><span class="n">TestAnnotation</span><span class="w"> </span><span class="n">testAnnotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Test</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getAnnotation</span><span class="p">(</span><span class="n">TestAnnotation</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-218-8"><a id="__codelineno-218-8" name="__codelineno-218-8" href="#__codelineno-218-8"></a>
</span><span id="__span-218-9"><a id="__codelineno-218-9" name="__codelineno-218-9" href="#__codelineno-218-9"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"id:"</span><span class="o">+</span><span class="n">testAnnotation</span><span class="p">.</span><span class="na">id</span><span class="p">());</span>
</span><span id="__span-218-10"><a id="__codelineno-218-10" name="__codelineno-218-10" href="#__codelineno-218-10"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"msg:"</span><span class="o">+</span><span class="n">testAnnotation</span><span class="p">.</span><span class="na">msg</span><span class="p">());</span>
</span><span id="__span-218-11"><a id="__codelineno-218-11" name="__codelineno-218-11" href="#__codelineno-218-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-218-12"><a id="__codelineno-218-12" name="__codelineno-218-12" href="#__codelineno-218-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-218-13"><a id="__codelineno-218-13" name="__codelineno-218-13" href="#__codelineno-218-13"></a><span class="p">}</span>
</span></code></pre></div> <p>ç¨‹åºçš„è¿è¡Œç»“æœæ˜¯ï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-219-1"><a id="__codelineno-219-1" name="__codelineno-219-1" href="#__codelineno-219-1"></a>id:-1
</span><span id="__span-219-2"><a id="__codelineno-219-2" name="__codelineno-219-2" href="#__codelineno-219-2"></a>msg:
</span></code></pre></div> <p>è¿™ä¸ªæ­£æ˜¯ TestAnnotation ä¸­ id å’Œ msg çš„é»˜è®¤å€¼ã€‚</p> <p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåªæ˜¯æ£€é˜…å‡ºäº†æ³¨è§£åœ¨ç±»ä¸Šçš„æ³¨è§£ï¼Œå…¶å®å±æ€§ã€æ–¹æ³•ä¸Šçš„æ³¨è§£ç…§æ ·æ˜¯å¯ä»¥çš„ã€‚åŒæ ·è¿˜æ˜¯è¦å‡æ‰‹äºåå°„ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-220-1"><a id="__codelineno-220-1" name="__codelineno-220-1" href="#__codelineno-220-1"></a><span class="nd">@TestAnnotation</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s">"hello"</span><span class="p">)</span>
</span><span id="__span-220-2"><a id="__codelineno-220-2" name="__codelineno-220-2" href="#__codelineno-220-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-220-3"><a id="__codelineno-220-3" name="__codelineno-220-3" href="#__codelineno-220-3"></a><span class="w">    </span><span class="nd">@Check</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">"hi"</span><span class="p">)</span>
</span><span id="__span-220-4"><a id="__codelineno-220-4" name="__codelineno-220-4" href="#__codelineno-220-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-220-5"><a id="__codelineno-220-5" name="__codelineno-220-5" href="#__codelineno-220-5"></a>
</span><span id="__span-220-6"><a id="__codelineno-220-6" name="__codelineno-220-6" href="#__codelineno-220-6"></a><span class="w">    </span><span class="nd">@Perform</span>
</span><span id="__span-220-7"><a id="__codelineno-220-7" name="__codelineno-220-7" href="#__codelineno-220-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testMethod</span><span class="p">(){}</span>
</span><span id="__span-220-8"><a id="__codelineno-220-8" name="__codelineno-220-8" href="#__codelineno-220-8"></a>
</span><span id="__span-220-9"><a id="__codelineno-220-9" name="__codelineno-220-9" href="#__codelineno-220-9"></a><span class="w">    </span><span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">"deprecation"</span><span class="p">)</span>
</span><span id="__span-220-10"><a id="__codelineno-220-10" name="__codelineno-220-10" href="#__codelineno-220-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test1</span><span class="p">(){</span>
</span><span id="__span-220-11"><a id="__codelineno-220-11" name="__codelineno-220-11" href="#__codelineno-220-11"></a><span class="w">        </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Hero</span><span class="p">();</span>
</span><span id="__span-220-12"><a id="__codelineno-220-12" name="__codelineno-220-12" href="#__codelineno-220-12"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">say</span><span class="p">();</span>
</span><span id="__span-220-13"><a id="__codelineno-220-13" name="__codelineno-220-13" href="#__codelineno-220-13"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">speak</span><span class="p">();</span>
</span><span id="__span-220-14"><a id="__codelineno-220-14" name="__codelineno-220-14" href="#__codelineno-220-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-220-15"><a id="__codelineno-220-15" name="__codelineno-220-15" href="#__codelineno-220-15"></a>
</span><span id="__span-220-16"><a id="__codelineno-220-16" name="__codelineno-220-16" href="#__codelineno-220-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-220-17"><a id="__codelineno-220-17" name="__codelineno-220-17" href="#__codelineno-220-17"></a><span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">hasAnnotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Test</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">isAnnotationPresent</span><span class="p">(</span><span class="n">TestAnnotation</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-220-18"><a id="__codelineno-220-18" name="__codelineno-220-18" href="#__codelineno-220-18"></a>
</span><span id="__span-220-19"><a id="__codelineno-220-19" name="__codelineno-220-19" href="#__codelineno-220-19"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">hasAnnotation</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-220-20"><a id="__codelineno-220-20" name="__codelineno-220-20" href="#__codelineno-220-20"></a><span class="w">            </span><span class="n">TestAnnotation</span><span class="w"> </span><span class="n">testAnnotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Test</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getAnnotation</span><span class="p">(</span><span class="n">TestAnnotation</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-220-21"><a id="__codelineno-220-21" name="__codelineno-220-21" href="#__codelineno-220-21"></a><span class="w">            </span><span class="c1">//è·å–ç±»çš„æ³¨è§£</span>
</span><span id="__span-220-22"><a id="__codelineno-220-22" name="__codelineno-220-22" href="#__codelineno-220-22"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"id:"</span><span class="o">+</span><span class="n">testAnnotation</span><span class="p">.</span><span class="na">id</span><span class="p">());</span>
</span><span id="__span-220-23"><a id="__codelineno-220-23" name="__codelineno-220-23" href="#__codelineno-220-23"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"msg:"</span><span class="o">+</span><span class="n">testAnnotation</span><span class="p">.</span><span class="na">msg</span><span class="p">());</span>
</span><span id="__span-220-24"><a id="__codelineno-220-24" name="__codelineno-220-24" href="#__codelineno-220-24"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-220-25"><a id="__codelineno-220-25" name="__codelineno-220-25" href="#__codelineno-220-25"></a>
</span><span id="__span-220-26"><a id="__codelineno-220-26" name="__codelineno-220-26" href="#__codelineno-220-26"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-220-27"><a id="__codelineno-220-27" name="__codelineno-220-27" href="#__codelineno-220-27"></a><span class="w">            </span><span class="n">Field</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Test</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">"a"</span><span class="p">);</span>
</span><span id="__span-220-28"><a id="__codelineno-220-28" name="__codelineno-220-28" href="#__codelineno-220-28"></a><span class="w">            </span><span class="n">a</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span id="__span-220-29"><a id="__codelineno-220-29" name="__codelineno-220-29" href="#__codelineno-220-29"></a><span class="w">            </span><span class="c1">//è·å–ä¸€ä¸ªæˆå‘˜å˜é‡ä¸Šçš„æ³¨è§£</span>
</span><span id="__span-220-30"><a id="__codelineno-220-30" name="__codelineno-220-30" href="#__codelineno-220-30"></a><span class="w">            </span><span class="n">Check</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="na">getAnnotation</span><span class="p">(</span><span class="n">Check</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-220-31"><a id="__codelineno-220-31" name="__codelineno-220-31" href="#__codelineno-220-31"></a>
</span><span id="__span-220-32"><a id="__codelineno-220-32" name="__codelineno-220-32" href="#__codelineno-220-32"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-220-33"><a id="__codelineno-220-33" name="__codelineno-220-33" href="#__codelineno-220-33"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"check value:"</span><span class="o">+</span><span class="n">check</span><span class="p">.</span><span class="na">value</span><span class="p">());</span>
</span><span id="__span-220-34"><a id="__codelineno-220-34" name="__codelineno-220-34" href="#__codelineno-220-34"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-220-35"><a id="__codelineno-220-35" name="__codelineno-220-35" href="#__codelineno-220-35"></a>
</span><span id="__span-220-36"><a id="__codelineno-220-36" name="__codelineno-220-36" href="#__codelineno-220-36"></a><span class="w">            </span><span class="n">Method</span><span class="w"> </span><span class="n">testMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Test</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getDeclaredMethod</span><span class="p">(</span><span class="s">"testMethod"</span><span class="p">);</span>
</span><span id="__span-220-37"><a id="__codelineno-220-37" name="__codelineno-220-37" href="#__codelineno-220-37"></a>
</span><span id="__span-220-38"><a id="__codelineno-220-38" name="__codelineno-220-38" href="#__codelineno-220-38"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">testMethod</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-220-39"><a id="__codelineno-220-39" name="__codelineno-220-39" href="#__codelineno-220-39"></a><span class="w">                </span><span class="c1">// è·å–æ–¹æ³•ä¸­çš„æ³¨è§£</span>
</span><span id="__span-220-40"><a id="__codelineno-220-40" name="__codelineno-220-40" href="#__codelineno-220-40"></a><span class="w">                </span><span class="n">Annotation</span><span class="o">[]</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testMethod</span><span class="p">.</span><span class="na">getAnnotations</span><span class="p">();</span>
</span><span id="__span-220-41"><a id="__codelineno-220-41" name="__codelineno-220-41" href="#__codelineno-220-41"></a><span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ans</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-220-42"><a id="__codelineno-220-42" name="__codelineno-220-42" href="#__codelineno-220-42"></a><span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"method testMethod annotation:"</span><span class="o">+</span><span class="n">ans</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">annotationType</span><span class="p">().</span><span class="na">getSimpleName</span><span class="p">());</span>
</span><span id="__span-220-43"><a id="__codelineno-220-43" name="__codelineno-220-43" href="#__codelineno-220-43"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-220-44"><a id="__codelineno-220-44" name="__codelineno-220-44" href="#__codelineno-220-44"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-220-45"><a id="__codelineno-220-45" name="__codelineno-220-45" href="#__codelineno-220-45"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NoSuchFieldException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-220-46"><a id="__codelineno-220-46" name="__codelineno-220-46" href="#__codelineno-220-46"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-220-47"><a id="__codelineno-220-47" name="__codelineno-220-47" href="#__codelineno-220-47"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-220-48"><a id="__codelineno-220-48" name="__codelineno-220-48" href="#__codelineno-220-48"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SecurityException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-220-49"><a id="__codelineno-220-49" name="__codelineno-220-49" href="#__codelineno-220-49"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-220-50"><a id="__codelineno-220-50" name="__codelineno-220-50" href="#__codelineno-220-50"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-220-51"><a id="__codelineno-220-51" name="__codelineno-220-51" href="#__codelineno-220-51"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NoSuchMethodException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-220-52"><a id="__codelineno-220-52" name="__codelineno-220-52" href="#__codelineno-220-52"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
</span><span id="__span-220-53"><a id="__codelineno-220-53" name="__codelineno-220-53" href="#__codelineno-220-53"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-220-54"><a id="__codelineno-220-54" name="__codelineno-220-54" href="#__codelineno-220-54"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-220-55"><a id="__codelineno-220-55" name="__codelineno-220-55" href="#__codelineno-220-55"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-220-56"><a id="__codelineno-220-56" name="__codelineno-220-56" href="#__codelineno-220-56"></a><span class="p">}</span>
</span></code></pre></div> <p>å®ƒä»¬çš„ç»“æœå¦‚ä¸‹ï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-221-1"><a id="__codelineno-221-1" name="__codelineno-221-1" href="#__codelineno-221-1"></a>id:-1
</span><span id="__span-221-2"><a id="__codelineno-221-2" name="__codelineno-221-2" href="#__codelineno-221-2"></a>msg:hello
</span><span id="__span-221-3"><a id="__codelineno-221-3" name="__codelineno-221-3" href="#__codelineno-221-3"></a>check value:hi
</span><span id="__span-221-4"><a id="__codelineno-221-4" name="__codelineno-221-4" href="#__codelineno-221-4"></a>method testMethod annotation:Perform
</span></code></pre></div> <p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ³¨è§£è¦åœ¨è¿è¡Œæ—¶è¢«æˆåŠŸæå–ï¼Œé‚£ä¹ˆ @Retention(RetentionPolicy.RUNTIME) æ˜¯å¿…é¡»çš„ã€‚</p> <h3 id="156è‡ªå®šä¹‰æ³¨è§£">15.6ã€è‡ªå®šä¹‰æ³¨è§£<a class="headerlink" href="#156è‡ªå®šä¹‰æ³¨è§£" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å†™ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ï¼Œæµ‹è¯•ç¨‹åºå‘˜çš„ä»£ç æœ‰æ— æ˜æ˜¾çš„å¼‚å¸¸ã€‚</p> <p>â€”â€” ç¨‹åºå‘˜ A : æˆ‘å†™äº†ä¸€ä¸ªç±»ï¼Œå®ƒçš„åå­—å«åš NoBugï¼Œå› ä¸ºå®ƒæ‰€æœ‰çš„æ–¹æ³•éƒ½æ²¡æœ‰é”™è¯¯ã€‚ â€”â€” æˆ‘ï¼šè‡ªä¿¡æ˜¯å¥½äº‹ï¼Œä¸è¿‡ä¸ºäº†é˜²æ­¢æ„å¤–ï¼Œè®©æˆ‘æµ‹è¯•ä¸€ä¸‹å¦‚ä½•ï¼Ÿ â€”â€” ç¨‹åºå‘˜ A: æ€ä¹ˆæµ‹è¯•ï¼Ÿ â€”â€” æˆ‘ï¼šæŠŠä½ å†™çš„ä»£ç çš„æ–¹æ³•éƒ½åŠ ä¸Š @Jiecha è¿™ä¸ªæ³¨è§£å°±å¥½äº†ã€‚ â€”â€” ç¨‹åºå‘˜ A: å¥½çš„ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-222-1"><a id="__codelineno-222-1" name="__codelineno-222-1" href="#__codelineno-222-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NoBug</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-222-2"><a id="__codelineno-222-2" name="__codelineno-222-2" href="#__codelineno-222-2"></a><span class="w">    </span><span class="nd">@Jiecha</span>
</span><span id="__span-222-3"><a id="__codelineno-222-3" name="__codelineno-222-3" href="#__codelineno-222-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">suanShu</span><span class="p">(){</span>
</span><span id="__span-222-4"><a id="__codelineno-222-4" name="__codelineno-222-4" href="#__codelineno-222-4"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"1234567890"</span><span class="p">);</span>
</span><span id="__span-222-5"><a id="__codelineno-222-5" name="__codelineno-222-5" href="#__codelineno-222-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-222-6"><a id="__codelineno-222-6" name="__codelineno-222-6" href="#__codelineno-222-6"></a>
</span><span id="__span-222-7"><a id="__codelineno-222-7" name="__codelineno-222-7" href="#__codelineno-222-7"></a><span class="w">    </span><span class="nd">@Jiecha</span>
</span><span id="__span-222-8"><a id="__codelineno-222-8" name="__codelineno-222-8" href="#__codelineno-222-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">jiafa</span><span class="p">(){</span>
</span><span id="__span-222-9"><a id="__codelineno-222-9" name="__codelineno-222-9" href="#__codelineno-222-9"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"1+1="</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-222-10"><a id="__codelineno-222-10" name="__codelineno-222-10" href="#__codelineno-222-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-222-11"><a id="__codelineno-222-11" name="__codelineno-222-11" href="#__codelineno-222-11"></a>
</span><span id="__span-222-12"><a id="__codelineno-222-12" name="__codelineno-222-12" href="#__codelineno-222-12"></a><span class="w">    </span><span class="nd">@Jiecha</span>
</span><span id="__span-222-13"><a id="__codelineno-222-13" name="__codelineno-222-13" href="#__codelineno-222-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">jiefa</span><span class="p">(){</span>
</span><span id="__span-222-14"><a id="__codelineno-222-14" name="__codelineno-222-14" href="#__codelineno-222-14"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"1-1="</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span><span id="__span-222-15"><a id="__codelineno-222-15" name="__codelineno-222-15" href="#__codelineno-222-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-222-16"><a id="__codelineno-222-16" name="__codelineno-222-16" href="#__codelineno-222-16"></a>
</span><span id="__span-222-17"><a id="__codelineno-222-17" name="__codelineno-222-17" href="#__codelineno-222-17"></a><span class="w">    </span><span class="nd">@Jiecha</span>
</span><span id="__span-222-18"><a id="__codelineno-222-18" name="__codelineno-222-18" href="#__codelineno-222-18"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">chengfa</span><span class="p">(){</span>
</span><span id="__span-222-19"><a id="__codelineno-222-19" name="__codelineno-222-19" href="#__codelineno-222-19"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"3 x 5="</span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="mi">5</span><span class="p">);</span>
</span><span id="__span-222-20"><a id="__codelineno-222-20" name="__codelineno-222-20" href="#__codelineno-222-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-222-21"><a id="__codelineno-222-21" name="__codelineno-222-21" href="#__codelineno-222-21"></a>
</span><span id="__span-222-22"><a id="__codelineno-222-22" name="__codelineno-222-22" href="#__codelineno-222-22"></a><span class="w">    </span><span class="nd">@Jiecha</span>
</span><span id="__span-222-23"><a id="__codelineno-222-23" name="__codelineno-222-23" href="#__codelineno-222-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">chufa</span><span class="p">(){</span>
</span><span id="__span-222-24"><a id="__codelineno-222-24" name="__codelineno-222-24" href="#__codelineno-222-24"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"6 / 0="</span><span class="o">+</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-222-25"><a id="__codelineno-222-25" name="__codelineno-222-25" href="#__codelineno-222-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-222-26"><a id="__codelineno-222-26" name="__codelineno-222-26" href="#__codelineno-222-26"></a>
</span><span id="__span-222-27"><a id="__codelineno-222-27" name="__codelineno-222-27" href="#__codelineno-222-27"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ziwojieshao</span><span class="p">(){</span>
</span><span id="__span-222-28"><a id="__codelineno-222-28" name="__codelineno-222-28" href="#__codelineno-222-28"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æˆ‘å†™çš„ç¨‹åºæ²¡æœ‰ bug!"</span><span class="p">);</span>
</span><span id="__span-222-29"><a id="__codelineno-222-29" name="__codelineno-222-29" href="#__codelineno-222-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-222-30"><a id="__codelineno-222-30" name="__codelineno-222-30" href="#__codelineno-222-30"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸Šé¢çš„ä»£ç ï¼Œæœ‰äº›æ–¹æ³•ä¸Šé¢è¿ç”¨äº† @Jiecha æ³¨è§£ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-223-1"><a id="__codelineno-223-1" name="__codelineno-223-1" href="#__codelineno-223-1"></a><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
</span><span id="__span-223-2"><a id="__codelineno-223-2" name="__codelineno-223-2" href="#__codelineno-223-2"></a><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">Jiecha</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-223-3"><a id="__codelineno-223-3" name="__codelineno-223-3" href="#__codelineno-223-3"></a><span class="p">}</span>
</span></code></pre></div> <p>ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±» TestTool å°±å¯ä»¥æµ‹è¯• NoBug ç›¸åº”çš„æ–¹æ³•:</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-224-1"><a id="__codelineno-224-1" name="__codelineno-224-1" href="#__codelineno-224-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestTool</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-224-2"><a id="__codelineno-224-2" name="__codelineno-224-2" href="#__codelineno-224-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">    </span>
</span><span id="__span-224-3"><a id="__codelineno-224-3" name="__codelineno-224-3" href="#__codelineno-224-3"></a><span class="w">        </span><span class="n">NoBug</span><span class="w"> </span><span class="n">testobj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NoBug</span><span class="p">();</span>
</span><span id="__span-224-4"><a id="__codelineno-224-4" name="__codelineno-224-4" href="#__codelineno-224-4"></a>
</span><span id="__span-224-5"><a id="__codelineno-224-5" name="__codelineno-224-5" href="#__codelineno-224-5"></a><span class="w">        </span><span class="n">Class</span><span class="w"> </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testobj</span><span class="p">.</span><span class="na">getClass</span><span class="p">();</span>
</span><span id="__span-224-6"><a id="__codelineno-224-6" name="__codelineno-224-6" href="#__codelineno-224-6"></a>
</span><span id="__span-224-7"><a id="__codelineno-224-7" name="__codelineno-224-7" href="#__codelineno-224-7"></a><span class="w">        </span><span class="n">Method</span><span class="o">[]</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clazz</span><span class="p">.</span><span class="na">getDeclaredMethods</span><span class="p">();</span>
</span><span id="__span-224-8"><a id="__codelineno-224-8" name="__codelineno-224-8" href="#__codelineno-224-8"></a><span class="w">        </span><span class="c1">//ç”¨æ¥è®°å½•æµ‹è¯•äº§ç”Ÿçš„ log ä¿¡æ¯</span>
</span><span id="__span-224-9"><a id="__codelineno-224-9" name="__codelineno-224-9" href="#__codelineno-224-9"></a><span class="w">        </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span>
</span><span id="__span-224-10"><a id="__codelineno-224-10" name="__codelineno-224-10" href="#__codelineno-224-10"></a><span class="w">        </span><span class="c1">// è®°å½•å¼‚å¸¸çš„æ¬¡æ•°</span>
</span><span id="__span-224-11"><a id="__codelineno-224-11" name="__codelineno-224-11" href="#__codelineno-224-11"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">errornum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-224-12"><a id="__codelineno-224-12" name="__codelineno-224-12" href="#__codelineno-224-12"></a>
</span><span id="__span-224-13"><a id="__codelineno-224-13" name="__codelineno-224-13" href="#__codelineno-224-13"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">m</span><span class="p">:</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-224-14"><a id="__codelineno-224-14" name="__codelineno-224-14" href="#__codelineno-224-14"></a><span class="w">            </span><span class="c1">// åªæœ‰è¢« @Jiecha æ ‡æ³¨è¿‡çš„æ–¹æ³•æ‰è¿›è¡Œæµ‹è¯•</span>
</span><span id="__span-224-15"><a id="__codelineno-224-15" name="__codelineno-224-15" href="#__codelineno-224-15"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="na">isAnnotationPresent</span><span class="p">(</span><span class="w"> </span><span class="n">Jiecha</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-224-16"><a id="__codelineno-224-16" name="__codelineno-224-16" href="#__codelineno-224-16"></a><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-224-17"><a id="__codelineno-224-17" name="__codelineno-224-17" href="#__codelineno-224-17"></a><span class="w">                    </span><span class="n">m</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span id="__span-224-18"><a id="__codelineno-224-18" name="__codelineno-224-18" href="#__codelineno-224-18"></a><span class="w">                    </span><span class="n">m</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">testobj</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
</span><span id="__span-224-19"><a id="__codelineno-224-19" name="__codelineno-224-19" href="#__codelineno-224-19"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-224-20"><a id="__codelineno-224-20" name="__codelineno-224-20" href="#__codelineno-224-20"></a><span class="w">                    </span><span class="n">errornum</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-224-21"><a id="__codelineno-224-21" name="__codelineno-224-21" href="#__codelineno-224-21"></a><span class="w">                    </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
</span><span id="__span-224-22"><a id="__codelineno-224-22" name="__codelineno-224-22" href="#__codelineno-224-22"></a><span class="w">                    </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
</span><span id="__span-224-23"><a id="__codelineno-224-23" name="__codelineno-224-23" href="#__codelineno-224-23"></a><span class="w">                    </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"has error:"</span><span class="p">);</span>
</span><span id="__span-224-24"><a id="__codelineno-224-24" name="__codelineno-224-24" href="#__codelineno-224-24"></a><span class="w">                    </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"\n\r  caused by "</span><span class="p">);</span>
</span><span id="__span-224-25"><a id="__codelineno-224-25" name="__codelineno-224-25" href="#__codelineno-224-25"></a><span class="w">                    </span><span class="c1">//è®°å½•æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå‘ç”Ÿçš„å¼‚å¸¸çš„åç§°</span>
</span><span id="__span-224-26"><a id="__codelineno-224-26" name="__codelineno-224-26" href="#__codelineno-224-26"></a><span class="w">                    </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getCause</span><span class="p">().</span><span class="na">getClass</span><span class="p">().</span><span class="na">getSimpleName</span><span class="p">());</span>
</span><span id="__span-224-27"><a id="__codelineno-224-27" name="__codelineno-224-27" href="#__codelineno-224-27"></a><span class="w">                    </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"\n\r"</span><span class="p">);</span>
</span><span id="__span-224-28"><a id="__codelineno-224-28" name="__codelineno-224-28" href="#__codelineno-224-28"></a><span class="w">                    </span><span class="c1">//è®°å½•æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå‘ç”Ÿçš„å¼‚å¸¸çš„å…·ä½“ä¿¡æ¯</span>
</span><span id="__span-224-29"><a id="__codelineno-224-29" name="__codelineno-224-29" href="#__codelineno-224-29"></a><span class="w">                    </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getCause</span><span class="p">().</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-224-30"><a id="__codelineno-224-30" name="__codelineno-224-30" href="#__codelineno-224-30"></a><span class="w">                    </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">"\n\r"</span><span class="p">);</span>
</span><span id="__span-224-31"><a id="__codelineno-224-31" name="__codelineno-224-31" href="#__codelineno-224-31"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span>
</span><span id="__span-224-32"><a id="__codelineno-224-32" name="__codelineno-224-32" href="#__codelineno-224-32"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-224-33"><a id="__codelineno-224-33" name="__codelineno-224-33" href="#__codelineno-224-33"></a><span class="w">        </span><span class="p">}</span><span class="w">   </span>
</span><span id="__span-224-34"><a id="__codelineno-224-34" name="__codelineno-224-34" href="#__codelineno-224-34"></a>
</span><span id="__span-224-35"><a id="__codelineno-224-35" name="__codelineno-224-35" href="#__codelineno-224-35"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">clazz</span><span class="p">.</span><span class="na">getSimpleName</span><span class="p">());</span>
</span><span id="__span-224-36"><a id="__codelineno-224-36" name="__codelineno-224-36" href="#__codelineno-224-36"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">" has  "</span><span class="p">);</span>
</span><span id="__span-224-37"><a id="__codelineno-224-37" name="__codelineno-224-37" href="#__codelineno-224-37"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">errornum</span><span class="p">);</span>
</span><span id="__span-224-38"><a id="__codelineno-224-38" name="__codelineno-224-38" href="#__codelineno-224-38"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">" error."</span><span class="p">);</span>
</span><span id="__span-224-39"><a id="__codelineno-224-39" name="__codelineno-224-39" href="#__codelineno-224-39"></a>
</span><span id="__span-224-40"><a id="__codelineno-224-40" name="__codelineno-224-40" href="#__codelineno-224-40"></a><span class="w">        </span><span class="c1">// ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</span>
</span><span id="__span-224-41"><a id="__codelineno-224-41" name="__codelineno-224-41" href="#__codelineno-224-41"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">log</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
</span><span id="__span-224-42"><a id="__codelineno-224-42" name="__codelineno-224-42" href="#__codelineno-224-42"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-224-43"><a id="__codelineno-224-43" name="__codelineno-224-43" href="#__codelineno-224-43"></a><span class="p">}</span>
</span></code></pre></div> <p>æµ‹è¯•ç»“æœä¸ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-225-1"><a id="__codelineno-225-1" name="__codelineno-225-1" href="#__codelineno-225-1"></a>1234567890
</span><span id="__span-225-2"><a id="__codelineno-225-2" name="__codelineno-225-2" href="#__codelineno-225-2"></a>1+1=11
</span><span id="__span-225-3"><a id="__codelineno-225-3" name="__codelineno-225-3" href="#__codelineno-225-3"></a>1-1=0
</span><span id="__span-225-4"><a id="__codelineno-225-4" name="__codelineno-225-4" href="#__codelineno-225-4"></a>3 x 5=15
</span><span id="__span-225-5"><a id="__codelineno-225-5" name="__codelineno-225-5" href="#__codelineno-225-5"></a>chufa has error:
</span><span id="__span-225-6"><a id="__codelineno-225-6" name="__codelineno-225-6" href="#__codelineno-225-6"></a>
</span><span id="__span-225-7"><a id="__codelineno-225-7" name="__codelineno-225-7" href="#__codelineno-225-7"></a>  caused by ArithmeticException
</span><span id="__span-225-8"><a id="__codelineno-225-8" name="__codelineno-225-8" href="#__codelineno-225-8"></a>
</span><span id="__span-225-9"><a id="__codelineno-225-9" name="__codelineno-225-9" href="#__codelineno-225-9"></a>/ by zero
</span><span id="__span-225-10"><a id="__codelineno-225-10" name="__codelineno-225-10" href="#__codelineno-225-10"></a>
</span><span id="__span-225-11"><a id="__codelineno-225-11" name="__codelineno-225-11" href="#__codelineno-225-11"></a>NoBug has  1 error.
</span></code></pre></div> <p>æç¤º NoBug ç±»ä¸­çš„ chufa() è¿™ä¸ªæ–¹æ³•æœ‰å¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸åç§°å«åš ArithmeticExceptionï¼ŒåŸå› æ˜¯è¿ç®—è¿‡ç¨‹ä¸­è¿›è¡Œäº†é™¤ 0 çš„æ“ä½œã€‚</p> <aside class="md-source-file"> <span class="md-source-file__fact"> <span class="md-icon" title="æœ€åæ›´æ–°"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2026å¹´1æœˆ22æ—¥ 20:21:58 UTC">2026å¹´1æœˆ22æ—¥ 20:21:58</span> </span> <span class="md-source-file__fact"> <span class="md-icon" title="åˆ›å»ºæ—¥æœŸ"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2021å¹´4æœˆ26æ—¥ 11:39:30 UTC">2021å¹´4æœˆ26æ—¥ 11:39:30</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type="button" class="md-top md-icon" data-md-component="top" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> å›åˆ°é¡µé¢é¡¶éƒ¨ </button> </main> <footer class="md-footer"> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> Made with <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.top", "navigation.indexes", "navigation.tracking", "navigation.instant", "navigation.path", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src="../assets/javascripts/bundle.79ae519e.min.js"></script> <script src="../_javascripts/auto_title.js"></script>  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>