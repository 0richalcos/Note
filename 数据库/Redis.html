<!DOCTYPE html><html lang="zh" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://0richalcos.github.io/Note/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html"><link rel="prev" href="Oracle.html"><link rel="next" href="Vastbase.html"><link rel="icon" href="../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Redis - éšä¾¿è®°è®°</title><link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css"><link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel="stylesheet" href="../_stylesheets/extra.css"><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal"> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a href="#1nosqlæ¦‚è¿°" class="md-skip"> è·³è½¬è‡³ </a> </div> <div data-md-component="announce"> </div> <header class="md-header md-header--shadow" data-md-component="header"> <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰"> <a href="../index.html" title="éšä¾¿è®°è®°" class="md-header__button md-logo" aria-label="éšä¾¿è®°è®°" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> <label class="md-header__button md-icon" for="__drawer"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> éšä¾¿è®°è®° </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> Redis </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input class="md-option" data-md-color-media data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal" aria-label="åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼" type="radio" name="__palette" id="__palette_0"> <label class="md-header__button md-icon" title="åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼" for="__palette_1" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> <input class="md-option" data-md-color-media data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal" aria-label="åˆ‡æ¢åˆ°äº®è‰²æ¨¡å¼" type="radio" name="__palette" id="__palette_1"> <label class="md-header__button md-icon" title="åˆ‡æ¢åˆ°äº®è‰²æ¨¡å¼" for="__palette_0" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for="__search"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required> <label class="md-search__icon md-icon" for="__search"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class="md-search__options" aria-label="æŸ¥æ‰¾"> <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“ </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <div class="md-header__source"> <a href="https://github.com/0richalcos/Note" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class="md-source__repository"> GitHub </div> </a> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav class="md-nav md-nav--primary" aria-label="å¯¼èˆªæ " data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a href="../index.html" title="éšä¾¿è®°è®°" class="md-nav__button md-logo" aria-label="éšä¾¿è®°è®°" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> éšä¾¿è®°è®° </label> <div class="md-nav__source"> <a href="https://github.com/0richalcos/Note" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class="md-source__repository"> GitHub </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../index.html" class="md-nav__link"> <span class="md-ellipsis"> ğŸ  é¦–é¡µ </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2"> <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0"> <span class="md-ellipsis"> â™¨ï¸ Java </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> â™¨ï¸ Java </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../Java/Java.html" class="md-nav__link"> <span class="md-ellipsis"> Java </span> </a> </li> <li class="md-nav__item"> <a href="../Java/Java8.html" class="md-nav__link"> <span class="md-ellipsis"> Java 8 </span> </a> </li> <li class="md-nav__item"> <a href="../Java/JavaBasics.html" class="md-nav__link"> <span class="md-ellipsis"> Java åŸºç¡€ </span> </a> </li> <li class="md-nav__item"> <a href="../Java/JavaCollection.html" class="md-nav__link"> <span class="md-ellipsis"> Java é›†åˆ </span> </a> </li> <li class="md-nav__item"> <a href="../Java/JavaObject.html" class="md-nav__link"> <span class="md-ellipsis"> Java ç±»å’Œå¯¹è±¡ </span> </a> </li> <li class="md-nav__item"> <a href="../Java/JavaWeb.html" class="md-nav__link"> <span class="md-ellipsis"> JavaWeb </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3"> <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0"> <span class="md-ellipsis"> ğŸ§® æ•°æ®ç»“æ„åŠç®—æ³• </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_3"> <span class="md-nav__icon md-icon"></span> ğŸ§® æ•°æ®ç»“æ„åŠç®—æ³• </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E7%AE%97%E6%B3%95/Algorithm.html" class="md-nav__link"> <span class="md-ellipsis"> Algorithm </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E7%AE%97%E6%B3%95/DesignPattern.html" class="md-nav__link"> <span class="md-ellipsis"> DesignPattern </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4"> <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0"> <span class="md-ellipsis"> ğŸƒ Spring </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> ğŸƒ Spring </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../Spring/Spring.html" class="md-nav__link"> <span class="md-ellipsis"> Spring </span> </a> </li> <li class="md-nav__item"> <a href="../Spring/SpringBoot.html" class="md-nav__link"> <span class="md-ellipsis"> SpringBoot </span> </a> </li> <li class="md-nav__item"> <a href="../Spring/SpringCloud.html" class="md-nav__link"> <span class="md-ellipsis"> SpringCloud </span> </a> </li> <li class="md-nav__item"> <a href="../Spring/SpringMVC.html" class="md-nav__link"> <span class="md-ellipsis"> SpringMVC </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5"> <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0"> <span class="md-ellipsis"> ğŸ’¾ æŒä¹…å±‚æ¡†æ¶ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_5"> <span class="md-nav__icon md-icon"></span> ğŸ’¾ æŒä¹…å±‚æ¡†æ¶ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/MyBatis-Plus.html" class="md-nav__link"> <span class="md-ellipsis"> MyBatis-Plus </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/Mybatis.html" class="md-nav__link"> <span class="md-ellipsis"> Mybatis </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6"> <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0"> <span class="md-ellipsis"> ğŸ” è®¤è¯ä¸æˆæƒ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_6"> <span class="md-nav__icon md-icon"></span> ğŸ” è®¤è¯ä¸æˆæƒ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/SSO.html" class="md-nav__link"> <span class="md-ellipsis"> SSO </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/Sa-Token.html" class="md-nav__link"> <span class="md-ellipsis"> Sa-Token </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/Shiro.html" class="md-nav__link"> <span class="md-ellipsis"> Shiro </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7"> <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0"> <span class="md-ellipsis"> ğŸŒ å‰ç«¯ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7"> <span class="md-nav__icon md-icon"></span> ğŸŒ å‰ç«¯ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/CSS.html" class="md-nav__link"> <span class="md-ellipsis"> CSS </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/JavaScript.html" class="md-nav__link"> <span class="md-ellipsis"> JavaScript </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/Vue.html" class="md-nav__link"> <span class="md-ellipsis"> Vue </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/jQuery.html" class="md-nav__link"> <span class="md-ellipsis"> jQuery </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5"> <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0"> <span class="md-ellipsis"> æ¨¡æ¿å¼•æ“ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_5"> <span class="md-nav__icon md-icon"></span> æ¨¡æ¿å¼•æ“ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/Thymeleaf.html" class="md-nav__link"> <span class="md-ellipsis"> Thymeleaf </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6"> <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0"> <span class="md-ellipsis"> ç»„ä»¶åº“ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_6"> <span class="md-nav__icon md-icon"></span> ç»„ä»¶åº“ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/AntV-X6.html" class="md-nav__link"> <span class="md-ellipsis"> AntV-X6 </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/ApacheECharts.html" class="md-nav__link"> <span class="md-ellipsis"> ApacheECharts </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/Axios.html" class="md-nav__link"> <span class="md-ellipsis"> Axios </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/BootstrapTable.html" class="md-nav__link"> <span class="md-ellipsis"> BootstrapTable </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/DHTMLXGantt.html" class="md-nav__link"> <span class="md-ellipsis"> DHTMLXGantt </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/Element.html" class="md-nav__link"> <span class="md-ellipsis"> Element </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/FullCalendar.html" class="md-nav__link"> <span class="md-ellipsis"> FullCalendar </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/X-editable.html" class="md-nav__link"> <span class="md-ellipsis"> X-editable </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked> <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0"> <span class="md-ellipsis"> ğŸ“Š æ•°æ®åº“ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true"> <label class="md-nav__title" for="__nav_8"> <span class="md-nav__icon md-icon"></span> ğŸ“Š æ•°æ®åº“ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="Dameng.html" class="md-nav__link"> <span class="md-ellipsis"> Dameng </span> </a> </li> <li class="md-nav__item"> <a href="MySQL.html" class="md-nav__link"> <span class="md-ellipsis"> MySQL </span> </a> </li> <li class="md-nav__item"> <a href="MySQLQuery.html" class="md-nav__link"> <span class="md-ellipsis"> MySQLQuery </span> </a> </li> <li class="md-nav__item"> <a href="OceanBase.html" class="md-nav__link"> <span class="md-ellipsis"> OceanBase </span> </a> </li> <li class="md-nav__item"> <a href="Oracle.html" class="md-nav__link"> <span class="md-ellipsis"> Oracle </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc"> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> Redis </span> <span class="md-nav__icon md-icon"></span> </label> <a href="Redis.html" class="md-nav__link md-nav__link--active"> <span class="md-ellipsis"> Redis </span> </a> <nav class="md-nav md-nav--secondary" aria-label="ç›®å½•"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> ç›®å½• </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix> <li class="md-nav__item"> <a href="#1nosqlæ¦‚è¿°" class="md-nav__link"> <span class="md-ellipsis"> 1ã€NoSQLæ¦‚è¿° </span> </a> <nav class="md-nav" aria-label="1ã€NoSQLæ¦‚è¿°"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#11ä¸ºä»€ä¹ˆè¦ç”¨-nosql" class="md-nav__link"> <span class="md-ellipsis"> 1.1ã€ä¸ºä»€ä¹ˆè¦ç”¨ NoSQLï¼Ÿ </span> </a> </li> <li class="md-nav__item"> <a href="#12ä»€ä¹ˆæ˜¯-nosql" class="md-nav__link"> <span class="md-ellipsis"> 1.2ã€ä»€ä¹ˆæ˜¯ NoSQLï¼Ÿ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#2redis-å…¥é—¨" class="md-nav__link"> <span class="md-ellipsis"> 2ã€Redis å…¥é—¨ </span> </a> <nav class="md-nav" aria-label="2ã€Redis å…¥é—¨"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#21æ¦‚è¿°" class="md-nav__link"> <span class="md-ellipsis"> 2.1ã€æ¦‚è¿° </span> </a> </li> <li class="md-nav__item"> <a href="#22reids-å®‰è£…" class="md-nav__link"> <span class="md-ellipsis"> 2.2ã€Reids å®‰è£… </span> </a> <nav class="md-nav" aria-label="2.2ã€Reids å®‰è£…"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#221linxu" class="md-nav__link"> <span class="md-ellipsis"> 2.2.1ã€Linxu </span> </a> <nav class="md-nav" aria-label="2.2.1ã€Linxu"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#å®‰è£…-reids" class="md-nav__link"> <span class="md-ellipsis"> å®‰è£… Reids </span> </a> </li> <li class="md-nav__item"> <a href="#é…ç½®-systemd-æœåŠ¡" class="md-nav__link"> <span class="md-ellipsis"> é…ç½® systemd æœåŠ¡ </span> </a> </li> <li class="md-nav__item"> <a href="#å¸è½½å¹¶åˆ é™¤" class="md-nav__link"> <span class="md-ellipsis"> å¸è½½å¹¶åˆ é™¤ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#222docker" class="md-nav__link"> <span class="md-ellipsis"> 2.2.2ã€Docker </span> </a> </li> <li class="md-nav__item"> <a href="#222windows" class="md-nav__link"> <span class="md-ellipsis"> 2.2.2ã€Windows </span> </a> </li> <li class="md-nav__item"> <a href="#223å®‰è£…é‡åˆ°çš„ä¸€äº›é—®é¢˜" class="md-nav__link"> <span class="md-ellipsis"> 2.2.3ã€å®‰è£…é‡åˆ°çš„ä¸€äº›é—®é¢˜ </span> </a> <nav class="md-nav" aria-label="2.2.3ã€å®‰è£…é‡åˆ°çš„ä¸€äº›é—®é¢˜"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#arm64ç¯å¢ƒå¯åŠ¨bug" class="md-nav__link"> <span class="md-ellipsis"> ARM64ç¯å¢ƒå¯åŠ¨BUG </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#23åŸºç¡€çŸ¥è¯†" class="md-nav__link"> <span class="md-ellipsis"> 2.3ã€åŸºç¡€çŸ¥è¯† </span> </a> <nav class="md-nav" aria-label="2.3ã€åŸºç¡€çŸ¥è¯†"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#231å¿«é€Ÿä¸Šæ‰‹" class="md-nav__link"> <span class="md-ellipsis"> 2.3.1ã€å¿«é€Ÿä¸Šæ‰‹ </span> </a> <nav class="md-nav" aria-label="2.3.1ã€å¿«é€Ÿä¸Šæ‰‹"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#å¯åŠ¨" class="md-nav__link"> <span class="md-ellipsis"> å¯åŠ¨ </span> </a> </li> <li class="md-nav__item"> <a href="#è¿æ¥" class="md-nav__link"> <span class="md-ellipsis"> è¿æ¥ </span> </a> </li> <li class="md-nav__item"> <a href="#å…³é—­" class="md-nav__link"> <span class="md-ellipsis"> å…³é—­ </span> </a> </li> <li class="md-nav__item"> <a href="#redis-å·¥å…·" class="md-nav__link"> <span class="md-ellipsis"> Redis å·¥å…· </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#232å¸¸ç”¨å‘½ä»¤" class="md-nav__link"> <span class="md-ellipsis"> 2.3.2ã€å¸¸ç”¨å‘½ä»¤ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#3äº”å¤§æ•°æ®ç±»å‹" class="md-nav__link"> <span class="md-ellipsis"> 3ã€äº”å¤§æ•°æ®ç±»å‹ </span> </a> <nav class="md-nav" aria-label="3ã€äº”å¤§æ•°æ®ç±»å‹"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#31stringå­—ç¬¦ä¸²" class="md-nav__link"> <span class="md-ellipsis"> 3.1ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#32liståˆ—è¡¨" class="md-nav__link"> <span class="md-ellipsis"> 3.2ã€Listï¼ˆåˆ—è¡¨ï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#33seté›†åˆ" class="md-nav__link"> <span class="md-ellipsis"> 3.3ã€Setï¼ˆé›†åˆï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#34hashå“ˆå¸Œ" class="md-nav__link"> <span class="md-ellipsis"> 3.4ã€Hashï¼ˆå“ˆå¸Œï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#35zsetæœ‰åºé›†åˆ" class="md-nav__link"> <span class="md-ellipsis"> 3.5ã€Zsetï¼ˆæœ‰åºé›†åˆï¼‰ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#4ä¸‰å¤§ç‰¹æ®Šç±»å‹" class="md-nav__link"> <span class="md-ellipsis"> 4ã€ä¸‰å¤§ç‰¹æ®Šç±»å‹ </span> </a> <nav class="md-nav" aria-label="4ã€ä¸‰å¤§ç‰¹æ®Šç±»å‹"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#41geospatialåœ°ç†ä½ç½®" class="md-nav__link"> <span class="md-ellipsis"> 4.1ã€geospatialï¼ˆåœ°ç†ä½ç½®ï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#42hyperloglog" class="md-nav__link"> <span class="md-ellipsis"> 4.2ã€hyperloglog </span> </a> </li> <li class="md-nav__item"> <a href="#43bitmap" class="md-nav__link"> <span class="md-ellipsis"> 4.3ã€Bitmap </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#5äº‹åŠ¡" class="md-nav__link"> <span class="md-ellipsis"> 5ã€äº‹åŠ¡ </span> </a> <nav class="md-nav" aria-label="5ã€äº‹åŠ¡"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#51äº‹åŠ¡çš„æµç¨‹" class="md-nav__link"> <span class="md-ellipsis"> 5.1ã€äº‹åŠ¡çš„æµç¨‹ </span> </a> </li> <li class="md-nav__item"> <a href="#52watch" class="md-nav__link"> <span class="md-ellipsis"> 5.2ã€watch </span> </a> </li> <li class="md-nav__item"> <a href="#53äº‹åŠ¡é”™è¯¯ä¸å›æ»š" class="md-nav__link"> <span class="md-ellipsis"> 5.3ã€äº‹åŠ¡é”™è¯¯ä¸å›æ»š </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#6jedis" class="md-nav__link"> <span class="md-ellipsis"> 6ã€Jedis </span> </a> </li> <li class="md-nav__item"> <a href="#7spring-boot-æ•´åˆ" class="md-nav__link"> <span class="md-ellipsis"> 7ã€Spring Boot æ•´åˆ </span> </a> <nav class="md-nav" aria-label="7ã€Spring Boot æ•´åˆ"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#71redistemplate-åŠåºåˆ—åŒ–æ–¹å¼" class="md-nav__link"> <span class="md-ellipsis"> 7.1ã€RedisTemplate åŠåºåˆ—åŒ–æ–¹å¼ </span> </a> </li> <li class="md-nav__item"> <a href="#72è·å–-redis-è¿æ¥ä¿¡æ¯" class="md-nav__link"> <span class="md-ellipsis"> 7.2ã€è·å– Redis è¿æ¥ä¿¡æ¯ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#8redis-é…ç½®è¯¦è§£" class="md-nav__link"> <span class="md-ellipsis"> 8ã€Redis é…ç½®è¯¦è§£ </span> </a> <nav class="md-nav" aria-label="8ã€Redis é…ç½®è¯¦è§£"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#81redisconf-è¯¦è§£" class="md-nav__link"> <span class="md-ellipsis"> 8.1ã€redis.conf è¯¦è§£ </span> </a> <nav class="md-nav" aria-label="8.1ã€redis.conf è¯¦è§£"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#811å•ä½" class="md-nav__link"> <span class="md-ellipsis"> 8.1.1ã€å•ä½ </span> </a> </li> <li class="md-nav__item"> <a href="#812åŒ…å«" class="md-nav__link"> <span class="md-ellipsis"> 8.1.2ã€åŒ…å« </span> </a> </li> <li class="md-nav__item"> <a href="#813ç½‘ç»œ" class="md-nav__link"> <span class="md-ellipsis"> 8.1.3ã€ç½‘ç»œ </span> </a> </li> <li class="md-nav__item"> <a href="#814é€šç”¨" class="md-nav__link"> <span class="md-ellipsis"> 8.1.4ã€é€šç”¨ </span> </a> </li> <li class="md-nav__item"> <a href="#815å¿«ç…§" class="md-nav__link"> <span class="md-ellipsis"> 8.1.5ã€å¿«ç…§ </span> </a> </li> <li class="md-nav__item"> <a href="#816å¤åˆ¶" class="md-nav__link"> <span class="md-ellipsis"> 8.1.6ã€å¤åˆ¶ </span> </a> </li> <li class="md-nav__item"> <a href="#817å®‰å…¨" class="md-nav__link"> <span class="md-ellipsis"> 8.1.7ã€å®‰å…¨ </span> </a> </li> <li class="md-nav__item"> <a href="#818å®¢æˆ·ç«¯" class="md-nav__link"> <span class="md-ellipsis"> 8.1.8ã€å®¢æˆ·ç«¯ </span> </a> </li> <li class="md-nav__item"> <a href="#819å†…å­˜ç®¡ç†" class="md-nav__link"> <span class="md-ellipsis"> 8.1.9ã€å†…å­˜ç®¡ç† </span> </a> </li> <li class="md-nav__item"> <a href="#8110aof-æ¨¡å¼" class="md-nav__link"> <span class="md-ellipsis"> 8.1.10ã€AOF æ¨¡å¼ </span> </a> </li> <li class="md-nav__item"> <a href="#8111é›†ç¾¤" class="md-nav__link"> <span class="md-ellipsis"> 8.1.11ã€é›†ç¾¤ </span> </a> </li> <li class="md-nav__item"> <a href="#8112æ…¢æ—¥å¿—" class="md-nav__link"> <span class="md-ellipsis"> 8.1.12ã€æ…¢æ—¥å¿— </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#82sentinelconf-è¯¦è§£" class="md-nav__link"> <span class="md-ellipsis"> 8.2ã€sentinel.conf è¯¦è§£ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#9æŒä¹…åŒ–" class="md-nav__link"> <span class="md-ellipsis"> 9ã€æŒä¹…åŒ– </span> </a> <nav class="md-nav" aria-label="9ã€æŒä¹…åŒ–"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#91rdb" class="md-nav__link"> <span class="md-ellipsis"> 9.1ã€RDB </span> </a> <nav class="md-nav" aria-label="9.1ã€RDB"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#911å¼€å¯-rdb-æŒä¹…åŒ–æ–¹å¼" class="md-nav__link"> <span class="md-ellipsis"> 9.1.1ã€å¼€å¯ RDB æŒä¹…åŒ–æ–¹å¼ </span> </a> </li> <li class="md-nav__item"> <a href="#912rdb-æ–‡ä»¶" class="md-nav__link"> <span class="md-ellipsis"> 9.1.2ã€RDB æ–‡ä»¶ </span> </a> </li> <li class="md-nav__item"> <a href="#913rdb-çš„ä¼˜ç¼ºç‚¹" class="md-nav__link"> <span class="md-ellipsis"> 9.1.3ã€RDB çš„ä¼˜ç¼ºç‚¹ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#92aof" class="md-nav__link"> <span class="md-ellipsis"> 9.2ã€AOF </span> </a> <nav class="md-nav" aria-label="9.2ã€AOF"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#921å¼€å¯-aof-æŒä¹…åŒ–æ–¹å¼" class="md-nav__link"> <span class="md-ellipsis"> 9.2.1ã€å¼€å¯ AOF æŒä¹…åŒ–æ–¹å¼ </span> </a> </li> <li class="md-nav__item"> <a href="#922aof-æ–‡ä»¶" class="md-nav__link"> <span class="md-ellipsis"> 9.2.2ã€AOF æ–‡ä»¶ </span> </a> </li> <li class="md-nav__item"> <a href="#923aof-çš„ä¼˜ç¼ºç‚¹" class="md-nav__link"> <span class="md-ellipsis"> 9.2.3ã€AOF çš„ä¼˜ç¼ºç‚¹ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#10è®¢é˜…ä¸å‘å¸ƒ" class="md-nav__link"> <span class="md-ellipsis"> 10ã€è®¢é˜…ä¸å‘å¸ƒ </span> </a> <nav class="md-nav" aria-label="10ã€è®¢é˜…ä¸å‘å¸ƒ"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#101è®¢é˜…ä¸é€€è®¢é¢‘é“" class="md-nav__link"> <span class="md-ellipsis"> 10.1ã€è®¢é˜…ä¸é€€è®¢é¢‘é“ </span> </a> </li> <li class="md-nav__item"> <a href="#102å‘é€ä¿¡æ¯åˆ°é¢‘é“" class="md-nav__link"> <span class="md-ellipsis"> 10.2ã€å‘é€ä¿¡æ¯åˆ°é¢‘é“ </span> </a> </li> <li class="md-nav__item"> <a href="#103æ¨¡å¼çš„è®¢é˜…ä¸ä¿¡æ¯å‘é€" class="md-nav__link"> <span class="md-ellipsis"> 10.3ã€æ¨¡å¼çš„è®¢é˜…ä¸ä¿¡æ¯å‘é€ </span> </a> </li> <li class="md-nav__item"> <a href="#104è®¢é˜…ä¸é€€è®¢æ¨¡å¼" class="md-nav__link"> <span class="md-ellipsis"> 10.4ã€è®¢é˜…ä¸é€€è®¢æ¨¡å¼ </span> </a> </li> <li class="md-nav__item"> <a href="#105å‘é€ä¿¡æ¯åˆ°æ¨¡å¼" class="md-nav__link"> <span class="md-ellipsis"> 10.5ã€å‘é€ä¿¡æ¯åˆ°æ¨¡å¼ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#11redis-é›†ç¾¤" class="md-nav__link"> <span class="md-ellipsis"> 11ã€Redis é›†ç¾¤ </span> </a> <nav class="md-nav" aria-label="11ã€Redis é›†ç¾¤"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#111ä¸»ä»å¤åˆ¶" class="md-nav__link"> <span class="md-ellipsis"> 11.1ã€ä¸»ä»å¤åˆ¶ </span> </a> <nav class="md-nav" aria-label="11.1ã€ä¸»ä»å¤åˆ¶"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1111ä¸»ä»å¤åˆ¶ä»‹ç»" class="md-nav__link"> <span class="md-ellipsis"> 11.1.1ã€ä¸»ä»å¤åˆ¶ä»‹ç» </span> </a> </li> <li class="md-nav__item"> <a href="#1112ä¸»ä»å¤åˆ¶æ­å»º" class="md-nav__link"> <span class="md-ellipsis"> 11.1.2ã€ä¸»ä»å¤åˆ¶æ­å»º </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#112sentinel-æ¨¡å¼" class="md-nav__link"> <span class="md-ellipsis"> 11.2ã€Sentinel æ¨¡å¼ </span> </a> <nav class="md-nav" aria-label="11.2ã€Sentinel æ¨¡å¼"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1121å“¨å…µæ¨¡å¼ä»‹ç»" class="md-nav__link"> <span class="md-ellipsis"> 11.2.1ã€å“¨å…µæ¨¡å¼ä»‹ç» </span> </a> </li> <li class="md-nav__item"> <a href="#1122å“¨å…µæ¨¡å¼æ­å»º" class="md-nav__link"> <span class="md-ellipsis"> 11.2.2ã€å“¨å…µæ¨¡å¼æ­å»º </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#113cluster-æ¨¡å¼" class="md-nav__link"> <span class="md-ellipsis"> 11.3ã€Cluster æ¨¡å¼ </span> </a> <nav class="md-nav" aria-label="11.3ã€Cluster æ¨¡å¼"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1131cluster-æ¨¡å¼ä»‹ç»" class="md-nav__link"> <span class="md-ellipsis"> 11.3.1ã€Cluster æ¨¡å¼ä»‹ç» </span> </a> </li> <li class="md-nav__item"> <a href="#1132cluster-æ¨¡å¼æ­å»º" class="md-nav__link"> <span class="md-ellipsis"> 11.3.2ã€Cluster æ¨¡å¼æ­å»º </span> </a> </li> <li class="md-nav__item"> <a href="#1133redis-cluster-æ“ä½œ" class="md-nav__link"> <span class="md-ellipsis"> 11.3.3ã€Redis Cluster æ“ä½œ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#12ç¼“å­˜é›ªå´©å‡»ç©¿ç©¿é€" class="md-nav__link"> <span class="md-ellipsis"> 12ã€ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€ </span> </a> <nav class="md-nav" aria-label="12ã€ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#121ç¼“å­˜é›ªå´©" class="md-nav__link"> <span class="md-ellipsis"> 12.1ã€ç¼“å­˜é›ªå´© </span> </a> </li> <li class="md-nav__item"> <a href="#122ç¼“å­˜å‡»ç©¿" class="md-nav__link"> <span class="md-ellipsis"> 12.2ã€ç¼“å­˜å‡»ç©¿ </span> </a> </li> <li class="md-nav__item"> <a href="#123ç¼“å­˜ç©¿é€" class="md-nav__link"> <span class="md-ellipsis"> 12.3ã€ç¼“å­˜ç©¿é€ </span> </a> </li> <li class="md-nav__item"> <a href="#124ç¼“å­˜é¢„çƒ­" class="md-nav__link"> <span class="md-ellipsis"> 12.4ã€ç¼“å­˜é¢„çƒ­ </span> </a> </li> <li class="md-nav__item"> <a href="#125ç¼“å­˜é™çº§" class="md-nav__link"> <span class="md-ellipsis"> 12.5ã€ç¼“å­˜é™çº§ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#13redis-å®ç°åˆ†å¸ƒå¼é”" class="md-nav__link"> <span class="md-ellipsis"> 13ã€Redis å®ç°åˆ†å¸ƒå¼é” </span> </a> </li> <li class="md-nav__item"> <a href="#14redis-å®ç°åˆ†å¸ƒå¼ç¼“å­˜" class="md-nav__link"> <span class="md-ellipsis"> 14ã€Redis å®ç°åˆ†å¸ƒå¼ç¼“å­˜ </span> </a> <nav class="md-nav" aria-label="14ã€Redis å®ç°åˆ†å¸ƒå¼ç¼“å­˜"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#141æ­å»ºç¯å¢ƒ" class="md-nav__link"> <span class="md-ellipsis"> 14.1ã€æ­å»ºç¯å¢ƒ </span> </a> </li> <li class="md-nav__item"> <a href="#142å¼€å¯-mybatis-çš„äºŒçº§ç¼“å­˜" class="md-nav__link"> <span class="md-ellipsis"> 14.2ã€å¼€å¯ Mybatis çš„äºŒçº§ç¼“å­˜ </span> </a> </li> <li class="md-nav__item"> <a href="#143ä½¿ç”¨-redis-ä½œä¸ºç¼“å­˜" class="md-nav__link"> <span class="md-ellipsis"> 14.3ã€ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜ </span> </a> </li> <li class="md-nav__item"> <a href="#144é—®é¢˜åŠä¼˜åŒ–" class="md-nav__link"> <span class="md-ellipsis"> 14.4ã€é—®é¢˜åŠä¼˜åŒ– </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#15redis-session-ç®¡ç†" class="md-nav__link"> <span class="md-ellipsis"> 15ã€Redis Session ç®¡ç† </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="Vastbase.html" class="md-nav__link"> <span class="md-ellipsis"> Vastbase </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9"> <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0"> <span class="md-ellipsis"> ğŸ” æœç´¢å¼•æ“ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_9"> <span class="md-nav__icon md-icon"></span> ğŸ” æœç´¢å¼•æ“ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/Elasticsearch.html" class="md-nav__link"> <span class="md-ellipsis"> Elasticsearch </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10"> <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0"> <span class="md-ellipsis"> ğŸ“‡ åˆ†å¸ƒå¼å­˜å‚¨ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_10"> <span class="md-nav__icon md-icon"></span> ğŸ“‡ åˆ†å¸ƒå¼å­˜å‚¨ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/FastDFS.html" class="md-nav__link"> <span class="md-ellipsis"> FastDFS </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/MinIO.html" class="md-nav__link"> <span class="md-ellipsis"> MinIO </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11"> <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0"> <span class="md-ellipsis"> ğŸ›°ï¸ ç½‘ç»œé€šä¿¡ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_11"> <span class="md-nav__icon md-icon"></span> ğŸ›°ï¸ ç½‘ç»œé€šä¿¡ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/Encryption.html" class="md-nav__link"> <span class="md-ellipsis"> Encryption </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/HTTP.html" class="md-nav__link"> <span class="md-ellipsis"> HTTP </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/OpenVPN.html" class="md-nav__link"> <span class="md-ellipsis"> OpenVPN </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/VNC.html" class="md-nav__link"> <span class="md-ellipsis"> VNC </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/WebSocket.html" class="md-nav__link"> <span class="md-ellipsis"> WebSocket </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/frp.html" class="md-nav__link"> <span class="md-ellipsis"> frp </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12"> <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0"> <span class="md-ellipsis"> ğŸ—ƒï¸ æ–‡ä»¶å¤„ç† </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12"> <span class="md-nav__icon md-icon"></span> ğŸ—ƒï¸ æ–‡ä»¶å¤„ç† </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_1"> <label class="md-nav__link" for="__nav_12_1" id="__nav_12_1_label" tabindex="0"> <span class="md-ellipsis"> Office </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_1_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12_1"> <span class="md-nav__icon md-icon"></span> Office </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/ApachePOI.html" class="md-nav__link"> <span class="md-ellipsis"> ApachePOI </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/EasyExcel.html" class="md-nav__link"> <span class="md-ellipsis"> EasyExcel </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/OnlyOffice.html" class="md-nav__link"> <span class="md-ellipsis"> OnlyOffice </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/Poi-tl.html" class="md-nav__link"> <span class="md-ellipsis"> Poi-tl </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/Spire.OfficeForJava.html" class="md-nav__link"> <span class="md-ellipsis"> Spire.OfficeForJava </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_2"> <label class="md-nav__link" for="__nav_12_2" id="__nav_12_2_label" tabindex="0"> <span class="md-ellipsis"> PDF </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_2_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12_2"> <span class="md-nav__icon md-icon"></span> PDF </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/PDF/ApachePDFBox.html" class="md-nav__link"> <span class="md-ellipsis"> ApachePDFBox </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_3"> <label class="md-nav__link" for="__nav_12_3" id="__nav_12_3_label" tabindex="0"> <span class="md-ellipsis"> XML </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_3_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12_3"> <span class="md-nav__icon md-icon"></span> XML </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/XML/XMLParse.html" class="md-nav__link"> <span class="md-ellipsis"> XMLParse </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_4"> <label class="md-nav__link" for="__nav_12_4" id="__nav_12_4_label" tabindex="0"> <span class="md-ellipsis"> ZIP </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_4_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12_4"> <span class="md-nav__icon md-icon"></span> ZIP </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/ZIP/Zip4j.html" class="md-nav__link"> <span class="md-ellipsis"> Zip4j </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13"> <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0"> <span class="md-ellipsis"> âŒ› å®šæ—¶ä»»åŠ¡ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_13"> <span class="md-nav__icon md-icon"></span> âŒ› å®šæ—¶ä»»åŠ¡ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/XXL-JOB.html" class="md-nav__link"> <span class="md-ellipsis"> XXL-JOB </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14"> <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0"> <span class="md-ellipsis"> ğŸ§‘â€ğŸ”§ è¿ç»´ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_14"> <span class="md-nav__icon md-icon"></span> ğŸ§‘â€ğŸ”§ è¿ç»´ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/Docker.html" class="md-nav__link"> <span class="md-ellipsis"> Docker </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/Linux.html" class="md-nav__link"> <span class="md-ellipsis"> Linux </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/NSSM.html" class="md-nav__link"> <span class="md-ellipsis"> NSSM </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/Nginx.html" class="md-nav__link"> <span class="md-ellipsis"> Nginx </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/Tomcat.html" class="md-nav__link"> <span class="md-ellipsis"> Tomcat </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/TongWeb.html" class="md-nav__link"> <span class="md-ellipsis"> TongWeb </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/WSL.html" class="md-nav__link"> <span class="md-ellipsis"> WSL </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/WebLogic.html" class="md-nav__link"> <span class="md-ellipsis"> WebLogic </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15"> <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0"> <span class="md-ellipsis"> ğŸ› ï¸ å¼€å‘å·¥å…· </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_15"> <span class="md-nav__icon md-icon"></span> ğŸ› ï¸ å¼€å‘å·¥å…· </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Git.html" class="md-nav__link"> <span class="md-ellipsis"> Git </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Maven.html" class="md-nav__link"> <span class="md-ellipsis"> Maven </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Node.js.html" class="md-nav__link"> <span class="md-ellipsis"> Node.js </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Swagger.html" class="md-nav__link"> <span class="md-ellipsis"> Swagger </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16"> <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0"> <span class="md-ellipsis"> ğŸ‘» å…¶ä»– </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_16"> <span class="md-nav__icon md-icon"></span> ğŸ‘» å…¶ä»– </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%85%B6%E4%BB%96/Settings.html" class="md-nav__link"> <span class="md-ellipsis"> Settings </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%85%B6%E4%BB%96/Solutions.html" class="md-nav__link"> <span class="md-ellipsis"> Solutions </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%85%B6%E4%BB%96/Weasel.html" class="md-nav__link"> <span class="md-ellipsis"> Weasel </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav class="md-nav md-nav--secondary" aria-label="ç›®å½•"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> ç›®å½• </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix> <li class="md-nav__item"> <a href="#1nosqlæ¦‚è¿°" class="md-nav__link"> <span class="md-ellipsis"> 1ã€NoSQLæ¦‚è¿° </span> </a> <nav class="md-nav" aria-label="1ã€NoSQLæ¦‚è¿°"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#11ä¸ºä»€ä¹ˆè¦ç”¨-nosql" class="md-nav__link"> <span class="md-ellipsis"> 1.1ã€ä¸ºä»€ä¹ˆè¦ç”¨ NoSQLï¼Ÿ </span> </a> </li> <li class="md-nav__item"> <a href="#12ä»€ä¹ˆæ˜¯-nosql" class="md-nav__link"> <span class="md-ellipsis"> 1.2ã€ä»€ä¹ˆæ˜¯ NoSQLï¼Ÿ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#2redis-å…¥é—¨" class="md-nav__link"> <span class="md-ellipsis"> 2ã€Redis å…¥é—¨ </span> </a> <nav class="md-nav" aria-label="2ã€Redis å…¥é—¨"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#21æ¦‚è¿°" class="md-nav__link"> <span class="md-ellipsis"> 2.1ã€æ¦‚è¿° </span> </a> </li> <li class="md-nav__item"> <a href="#22reids-å®‰è£…" class="md-nav__link"> <span class="md-ellipsis"> 2.2ã€Reids å®‰è£… </span> </a> <nav class="md-nav" aria-label="2.2ã€Reids å®‰è£…"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#221linxu" class="md-nav__link"> <span class="md-ellipsis"> 2.2.1ã€Linxu </span> </a> <nav class="md-nav" aria-label="2.2.1ã€Linxu"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#å®‰è£…-reids" class="md-nav__link"> <span class="md-ellipsis"> å®‰è£… Reids </span> </a> </li> <li class="md-nav__item"> <a href="#é…ç½®-systemd-æœåŠ¡" class="md-nav__link"> <span class="md-ellipsis"> é…ç½® systemd æœåŠ¡ </span> </a> </li> <li class="md-nav__item"> <a href="#å¸è½½å¹¶åˆ é™¤" class="md-nav__link"> <span class="md-ellipsis"> å¸è½½å¹¶åˆ é™¤ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#222docker" class="md-nav__link"> <span class="md-ellipsis"> 2.2.2ã€Docker </span> </a> </li> <li class="md-nav__item"> <a href="#222windows" class="md-nav__link"> <span class="md-ellipsis"> 2.2.2ã€Windows </span> </a> </li> <li class="md-nav__item"> <a href="#223å®‰è£…é‡åˆ°çš„ä¸€äº›é—®é¢˜" class="md-nav__link"> <span class="md-ellipsis"> 2.2.3ã€å®‰è£…é‡åˆ°çš„ä¸€äº›é—®é¢˜ </span> </a> <nav class="md-nav" aria-label="2.2.3ã€å®‰è£…é‡åˆ°çš„ä¸€äº›é—®é¢˜"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#arm64ç¯å¢ƒå¯åŠ¨bug" class="md-nav__link"> <span class="md-ellipsis"> ARM64ç¯å¢ƒå¯åŠ¨BUG </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#23åŸºç¡€çŸ¥è¯†" class="md-nav__link"> <span class="md-ellipsis"> 2.3ã€åŸºç¡€çŸ¥è¯† </span> </a> <nav class="md-nav" aria-label="2.3ã€åŸºç¡€çŸ¥è¯†"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#231å¿«é€Ÿä¸Šæ‰‹" class="md-nav__link"> <span class="md-ellipsis"> 2.3.1ã€å¿«é€Ÿä¸Šæ‰‹ </span> </a> <nav class="md-nav" aria-label="2.3.1ã€å¿«é€Ÿä¸Šæ‰‹"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#å¯åŠ¨" class="md-nav__link"> <span class="md-ellipsis"> å¯åŠ¨ </span> </a> </li> <li class="md-nav__item"> <a href="#è¿æ¥" class="md-nav__link"> <span class="md-ellipsis"> è¿æ¥ </span> </a> </li> <li class="md-nav__item"> <a href="#å…³é—­" class="md-nav__link"> <span class="md-ellipsis"> å…³é—­ </span> </a> </li> <li class="md-nav__item"> <a href="#redis-å·¥å…·" class="md-nav__link"> <span class="md-ellipsis"> Redis å·¥å…· </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#232å¸¸ç”¨å‘½ä»¤" class="md-nav__link"> <span class="md-ellipsis"> 2.3.2ã€å¸¸ç”¨å‘½ä»¤ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#3äº”å¤§æ•°æ®ç±»å‹" class="md-nav__link"> <span class="md-ellipsis"> 3ã€äº”å¤§æ•°æ®ç±»å‹ </span> </a> <nav class="md-nav" aria-label="3ã€äº”å¤§æ•°æ®ç±»å‹"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#31stringå­—ç¬¦ä¸²" class="md-nav__link"> <span class="md-ellipsis"> 3.1ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#32liståˆ—è¡¨" class="md-nav__link"> <span class="md-ellipsis"> 3.2ã€Listï¼ˆåˆ—è¡¨ï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#33seté›†åˆ" class="md-nav__link"> <span class="md-ellipsis"> 3.3ã€Setï¼ˆé›†åˆï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#34hashå“ˆå¸Œ" class="md-nav__link"> <span class="md-ellipsis"> 3.4ã€Hashï¼ˆå“ˆå¸Œï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#35zsetæœ‰åºé›†åˆ" class="md-nav__link"> <span class="md-ellipsis"> 3.5ã€Zsetï¼ˆæœ‰åºé›†åˆï¼‰ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#4ä¸‰å¤§ç‰¹æ®Šç±»å‹" class="md-nav__link"> <span class="md-ellipsis"> 4ã€ä¸‰å¤§ç‰¹æ®Šç±»å‹ </span> </a> <nav class="md-nav" aria-label="4ã€ä¸‰å¤§ç‰¹æ®Šç±»å‹"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#41geospatialåœ°ç†ä½ç½®" class="md-nav__link"> <span class="md-ellipsis"> 4.1ã€geospatialï¼ˆåœ°ç†ä½ç½®ï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#42hyperloglog" class="md-nav__link"> <span class="md-ellipsis"> 4.2ã€hyperloglog </span> </a> </li> <li class="md-nav__item"> <a href="#43bitmap" class="md-nav__link"> <span class="md-ellipsis"> 4.3ã€Bitmap </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#5äº‹åŠ¡" class="md-nav__link"> <span class="md-ellipsis"> 5ã€äº‹åŠ¡ </span> </a> <nav class="md-nav" aria-label="5ã€äº‹åŠ¡"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#51äº‹åŠ¡çš„æµç¨‹" class="md-nav__link"> <span class="md-ellipsis"> 5.1ã€äº‹åŠ¡çš„æµç¨‹ </span> </a> </li> <li class="md-nav__item"> <a href="#52watch" class="md-nav__link"> <span class="md-ellipsis"> 5.2ã€watch </span> </a> </li> <li class="md-nav__item"> <a href="#53äº‹åŠ¡é”™è¯¯ä¸å›æ»š" class="md-nav__link"> <span class="md-ellipsis"> 5.3ã€äº‹åŠ¡é”™è¯¯ä¸å›æ»š </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#6jedis" class="md-nav__link"> <span class="md-ellipsis"> 6ã€Jedis </span> </a> </li> <li class="md-nav__item"> <a href="#7spring-boot-æ•´åˆ" class="md-nav__link"> <span class="md-ellipsis"> 7ã€Spring Boot æ•´åˆ </span> </a> <nav class="md-nav" aria-label="7ã€Spring Boot æ•´åˆ"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#71redistemplate-åŠåºåˆ—åŒ–æ–¹å¼" class="md-nav__link"> <span class="md-ellipsis"> 7.1ã€RedisTemplate åŠåºåˆ—åŒ–æ–¹å¼ </span> </a> </li> <li class="md-nav__item"> <a href="#72è·å–-redis-è¿æ¥ä¿¡æ¯" class="md-nav__link"> <span class="md-ellipsis"> 7.2ã€è·å– Redis è¿æ¥ä¿¡æ¯ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#8redis-é…ç½®è¯¦è§£" class="md-nav__link"> <span class="md-ellipsis"> 8ã€Redis é…ç½®è¯¦è§£ </span> </a> <nav class="md-nav" aria-label="8ã€Redis é…ç½®è¯¦è§£"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#81redisconf-è¯¦è§£" class="md-nav__link"> <span class="md-ellipsis"> 8.1ã€redis.conf è¯¦è§£ </span> </a> <nav class="md-nav" aria-label="8.1ã€redis.conf è¯¦è§£"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#811å•ä½" class="md-nav__link"> <span class="md-ellipsis"> 8.1.1ã€å•ä½ </span> </a> </li> <li class="md-nav__item"> <a href="#812åŒ…å«" class="md-nav__link"> <span class="md-ellipsis"> 8.1.2ã€åŒ…å« </span> </a> </li> <li class="md-nav__item"> <a href="#813ç½‘ç»œ" class="md-nav__link"> <span class="md-ellipsis"> 8.1.3ã€ç½‘ç»œ </span> </a> </li> <li class="md-nav__item"> <a href="#814é€šç”¨" class="md-nav__link"> <span class="md-ellipsis"> 8.1.4ã€é€šç”¨ </span> </a> </li> <li class="md-nav__item"> <a href="#815å¿«ç…§" class="md-nav__link"> <span class="md-ellipsis"> 8.1.5ã€å¿«ç…§ </span> </a> </li> <li class="md-nav__item"> <a href="#816å¤åˆ¶" class="md-nav__link"> <span class="md-ellipsis"> 8.1.6ã€å¤åˆ¶ </span> </a> </li> <li class="md-nav__item"> <a href="#817å®‰å…¨" class="md-nav__link"> <span class="md-ellipsis"> 8.1.7ã€å®‰å…¨ </span> </a> </li> <li class="md-nav__item"> <a href="#818å®¢æˆ·ç«¯" class="md-nav__link"> <span class="md-ellipsis"> 8.1.8ã€å®¢æˆ·ç«¯ </span> </a> </li> <li class="md-nav__item"> <a href="#819å†…å­˜ç®¡ç†" class="md-nav__link"> <span class="md-ellipsis"> 8.1.9ã€å†…å­˜ç®¡ç† </span> </a> </li> <li class="md-nav__item"> <a href="#8110aof-æ¨¡å¼" class="md-nav__link"> <span class="md-ellipsis"> 8.1.10ã€AOF æ¨¡å¼ </span> </a> </li> <li class="md-nav__item"> <a href="#8111é›†ç¾¤" class="md-nav__link"> <span class="md-ellipsis"> 8.1.11ã€é›†ç¾¤ </span> </a> </li> <li class="md-nav__item"> <a href="#8112æ…¢æ—¥å¿—" class="md-nav__link"> <span class="md-ellipsis"> 8.1.12ã€æ…¢æ—¥å¿— </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#82sentinelconf-è¯¦è§£" class="md-nav__link"> <span class="md-ellipsis"> 8.2ã€sentinel.conf è¯¦è§£ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#9æŒä¹…åŒ–" class="md-nav__link"> <span class="md-ellipsis"> 9ã€æŒä¹…åŒ– </span> </a> <nav class="md-nav" aria-label="9ã€æŒä¹…åŒ–"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#91rdb" class="md-nav__link"> <span class="md-ellipsis"> 9.1ã€RDB </span> </a> <nav class="md-nav" aria-label="9.1ã€RDB"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#911å¼€å¯-rdb-æŒä¹…åŒ–æ–¹å¼" class="md-nav__link"> <span class="md-ellipsis"> 9.1.1ã€å¼€å¯ RDB æŒä¹…åŒ–æ–¹å¼ </span> </a> </li> <li class="md-nav__item"> <a href="#912rdb-æ–‡ä»¶" class="md-nav__link"> <span class="md-ellipsis"> 9.1.2ã€RDB æ–‡ä»¶ </span> </a> </li> <li class="md-nav__item"> <a href="#913rdb-çš„ä¼˜ç¼ºç‚¹" class="md-nav__link"> <span class="md-ellipsis"> 9.1.3ã€RDB çš„ä¼˜ç¼ºç‚¹ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#92aof" class="md-nav__link"> <span class="md-ellipsis"> 9.2ã€AOF </span> </a> <nav class="md-nav" aria-label="9.2ã€AOF"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#921å¼€å¯-aof-æŒä¹…åŒ–æ–¹å¼" class="md-nav__link"> <span class="md-ellipsis"> 9.2.1ã€å¼€å¯ AOF æŒä¹…åŒ–æ–¹å¼ </span> </a> </li> <li class="md-nav__item"> <a href="#922aof-æ–‡ä»¶" class="md-nav__link"> <span class="md-ellipsis"> 9.2.2ã€AOF æ–‡ä»¶ </span> </a> </li> <li class="md-nav__item"> <a href="#923aof-çš„ä¼˜ç¼ºç‚¹" class="md-nav__link"> <span class="md-ellipsis"> 9.2.3ã€AOF çš„ä¼˜ç¼ºç‚¹ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#10è®¢é˜…ä¸å‘å¸ƒ" class="md-nav__link"> <span class="md-ellipsis"> 10ã€è®¢é˜…ä¸å‘å¸ƒ </span> </a> <nav class="md-nav" aria-label="10ã€è®¢é˜…ä¸å‘å¸ƒ"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#101è®¢é˜…ä¸é€€è®¢é¢‘é“" class="md-nav__link"> <span class="md-ellipsis"> 10.1ã€è®¢é˜…ä¸é€€è®¢é¢‘é“ </span> </a> </li> <li class="md-nav__item"> <a href="#102å‘é€ä¿¡æ¯åˆ°é¢‘é“" class="md-nav__link"> <span class="md-ellipsis"> 10.2ã€å‘é€ä¿¡æ¯åˆ°é¢‘é“ </span> </a> </li> <li class="md-nav__item"> <a href="#103æ¨¡å¼çš„è®¢é˜…ä¸ä¿¡æ¯å‘é€" class="md-nav__link"> <span class="md-ellipsis"> 10.3ã€æ¨¡å¼çš„è®¢é˜…ä¸ä¿¡æ¯å‘é€ </span> </a> </li> <li class="md-nav__item"> <a href="#104è®¢é˜…ä¸é€€è®¢æ¨¡å¼" class="md-nav__link"> <span class="md-ellipsis"> 10.4ã€è®¢é˜…ä¸é€€è®¢æ¨¡å¼ </span> </a> </li> <li class="md-nav__item"> <a href="#105å‘é€ä¿¡æ¯åˆ°æ¨¡å¼" class="md-nav__link"> <span class="md-ellipsis"> 10.5ã€å‘é€ä¿¡æ¯åˆ°æ¨¡å¼ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#11redis-é›†ç¾¤" class="md-nav__link"> <span class="md-ellipsis"> 11ã€Redis é›†ç¾¤ </span> </a> <nav class="md-nav" aria-label="11ã€Redis é›†ç¾¤"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#111ä¸»ä»å¤åˆ¶" class="md-nav__link"> <span class="md-ellipsis"> 11.1ã€ä¸»ä»å¤åˆ¶ </span> </a> <nav class="md-nav" aria-label="11.1ã€ä¸»ä»å¤åˆ¶"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1111ä¸»ä»å¤åˆ¶ä»‹ç»" class="md-nav__link"> <span class="md-ellipsis"> 11.1.1ã€ä¸»ä»å¤åˆ¶ä»‹ç» </span> </a> </li> <li class="md-nav__item"> <a href="#1112ä¸»ä»å¤åˆ¶æ­å»º" class="md-nav__link"> <span class="md-ellipsis"> 11.1.2ã€ä¸»ä»å¤åˆ¶æ­å»º </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#112sentinel-æ¨¡å¼" class="md-nav__link"> <span class="md-ellipsis"> 11.2ã€Sentinel æ¨¡å¼ </span> </a> <nav class="md-nav" aria-label="11.2ã€Sentinel æ¨¡å¼"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1121å“¨å…µæ¨¡å¼ä»‹ç»" class="md-nav__link"> <span class="md-ellipsis"> 11.2.1ã€å“¨å…µæ¨¡å¼ä»‹ç» </span> </a> </li> <li class="md-nav__item"> <a href="#1122å“¨å…µæ¨¡å¼æ­å»º" class="md-nav__link"> <span class="md-ellipsis"> 11.2.2ã€å“¨å…µæ¨¡å¼æ­å»º </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#113cluster-æ¨¡å¼" class="md-nav__link"> <span class="md-ellipsis"> 11.3ã€Cluster æ¨¡å¼ </span> </a> <nav class="md-nav" aria-label="11.3ã€Cluster æ¨¡å¼"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1131cluster-æ¨¡å¼ä»‹ç»" class="md-nav__link"> <span class="md-ellipsis"> 11.3.1ã€Cluster æ¨¡å¼ä»‹ç» </span> </a> </li> <li class="md-nav__item"> <a href="#1132cluster-æ¨¡å¼æ­å»º" class="md-nav__link"> <span class="md-ellipsis"> 11.3.2ã€Cluster æ¨¡å¼æ­å»º </span> </a> </li> <li class="md-nav__item"> <a href="#1133redis-cluster-æ“ä½œ" class="md-nav__link"> <span class="md-ellipsis"> 11.3.3ã€Redis Cluster æ“ä½œ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#12ç¼“å­˜é›ªå´©å‡»ç©¿ç©¿é€" class="md-nav__link"> <span class="md-ellipsis"> 12ã€ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€ </span> </a> <nav class="md-nav" aria-label="12ã€ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#121ç¼“å­˜é›ªå´©" class="md-nav__link"> <span class="md-ellipsis"> 12.1ã€ç¼“å­˜é›ªå´© </span> </a> </li> <li class="md-nav__item"> <a href="#122ç¼“å­˜å‡»ç©¿" class="md-nav__link"> <span class="md-ellipsis"> 12.2ã€ç¼“å­˜å‡»ç©¿ </span> </a> </li> <li class="md-nav__item"> <a href="#123ç¼“å­˜ç©¿é€" class="md-nav__link"> <span class="md-ellipsis"> 12.3ã€ç¼“å­˜ç©¿é€ </span> </a> </li> <li class="md-nav__item"> <a href="#124ç¼“å­˜é¢„çƒ­" class="md-nav__link"> <span class="md-ellipsis"> 12.4ã€ç¼“å­˜é¢„çƒ­ </span> </a> </li> <li class="md-nav__item"> <a href="#125ç¼“å­˜é™çº§" class="md-nav__link"> <span class="md-ellipsis"> 12.5ã€ç¼“å­˜é™çº§ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#13redis-å®ç°åˆ†å¸ƒå¼é”" class="md-nav__link"> <span class="md-ellipsis"> 13ã€Redis å®ç°åˆ†å¸ƒå¼é” </span> </a> </li> <li class="md-nav__item"> <a href="#14redis-å®ç°åˆ†å¸ƒå¼ç¼“å­˜" class="md-nav__link"> <span class="md-ellipsis"> 14ã€Redis å®ç°åˆ†å¸ƒå¼ç¼“å­˜ </span> </a> <nav class="md-nav" aria-label="14ã€Redis å®ç°åˆ†å¸ƒå¼ç¼“å­˜"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#141æ­å»ºç¯å¢ƒ" class="md-nav__link"> <span class="md-ellipsis"> 14.1ã€æ­å»ºç¯å¢ƒ </span> </a> </li> <li class="md-nav__item"> <a href="#142å¼€å¯-mybatis-çš„äºŒçº§ç¼“å­˜" class="md-nav__link"> <span class="md-ellipsis"> 14.2ã€å¼€å¯ Mybatis çš„äºŒçº§ç¼“å­˜ </span> </a> </li> <li class="md-nav__item"> <a href="#143ä½¿ç”¨-redis-ä½œä¸ºç¼“å­˜" class="md-nav__link"> <span class="md-ellipsis"> 14.3ã€ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜ </span> </a> </li> <li class="md-nav__item"> <a href="#144é—®é¢˜åŠä¼˜åŒ–" class="md-nav__link"> <span class="md-ellipsis"> 14.4ã€é—®é¢˜åŠä¼˜åŒ– </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#15redis-session-ç®¡ç†" class="md-nav__link"> <span class="md-ellipsis"> 15ã€Redis Session ç®¡ç† </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <nav class="md-path" aria-label="å¯¼èˆªæ "> <ol class="md-path__list"> <li class="md-path__item"> <a href="../index.html" class="md-path__link"> <span class="md-ellipsis"> ğŸ  é¦–é¡µ </span> </a> </li> <li class="md-path__item"> <a href="Dameng.html" class="md-path__link"> <span class="md-ellipsis"> ğŸ“Š æ•°æ®åº“ </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1 id="redis">Redis<a class="headerlink" href="#redis" title="é”šç‚¹é“¾æ¥">Â¶</a></h1> <h2 id="1nosqlæ¦‚è¿°">1ã€NoSQLæ¦‚è¿°<a class="headerlink" href="#1nosqlæ¦‚è¿°" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <h3 id="11ä¸ºä»€ä¹ˆè¦ç”¨-nosql">1.1ã€ä¸ºä»€ä¹ˆè¦ç”¨ NoSQLï¼Ÿ<a class="headerlink" href="#11ä¸ºä»€ä¹ˆè¦ç”¨-nosql" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>å•æœº MySQL å¹´ä»£</strong></p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20200815224858013.png" data-desc-position="bottom"><img src="!assets/Redis/image-20200815224858013.png" alt="image-20200815224858013" style="zoom: 67%;"></a></p> <p>DAL æ˜¯æ•°æ®è®¿é—®å±‚çš„è‹±æ–‡ç¼©å†™ï¼Œå³ä¸ºæ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰ã€‚å…¶åŠŸèƒ½ä¸»è¦æ˜¯è´Ÿè´£æ•°æ®åº“çš„è®¿é—®ã€‚ç®€å•åœ°è¯´å°±æ˜¯å®ç°å¯¹æ•°æ®è¡¨çš„ Selectï¼ˆæŸ¥è¯¢ï¼‰ã€Insertï¼ˆæ’å…¥ï¼‰ã€Updateï¼ˆæ›´æ–°ï¼‰ã€Deleteï¼ˆåˆ é™¤ï¼‰ç­‰æ“ä½œã€‚</p> <p>90å¹´ä»£ä¸€ä¸ªç½‘ç«™çš„è®¿é—®é‡ä¸ä¼šå¤ªå¤§ï¼Œå•ä¸ªæ•°æ®åº“å®Œå…¨è¶³å¤Ÿï¼Œé‚£ä¸ªæ—¶å€™ï¼Œæ›´å¤šçš„æ˜¯å»ä½¿ç”¨é™æ€ HTMLï¼ŒæœåŠ¡å™¨æ ¹æœ¬æ²¡æœ‰å¤ªå¤§å‹åŠ›ã€‚</p> <p>é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œç½‘ç«™çš„ç“¶é¢ˆæ˜¯ä»€ä¹ˆï¼Ÿ</p> <ul> <li>æ•°æ®é‡å¦‚æœå¤ªå¤§ï¼Œä¸€ä¸ªæœºå™¨æ”¾ä¸ä¸‹</li> <li>æ•°æ®çš„ç´¢å¼•ï¼ˆB+Treeï¼‰ï¼Œä¸€ä¸ªæœºå™¨å†…å­˜ä¹Ÿæ”¾ä¸ä¸‹</li> <li>è®¿é—®é‡ï¼ˆè¯»å†™æ··åˆï¼‰ï¼Œä¸€ä¸ªæœåŠ¡å™¨æ‰¿å—ä¸äº†</li> </ul> <p><strong>Memcachedï¼ˆç¼“å­˜ï¼‰+ MySQL + å‚ç›´æ‹†åˆ†ï¼ˆè¯»å†™åˆ†ç¦»ï¼‰</strong></p> <p>ç½‘ç«™ 80% çš„æƒ…å†µéƒ½æ˜¯åœ¨è¯»ï¼Œæ¯æ¬¡éƒ½è¦å»æŸ¥è¯¢æ•°æ®å°±ååˆ†éº»çƒ¦ï¼Œä¸ºäº†å‡è½»æ•°æ®åº“çš„å‹åŠ›ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜æ¥ä¿è¯æ•ˆç‡ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20200815225617475.png" data-desc-position="bottom"><img src="!assets/Redis/image-20200815225617475.png" alt="image-20200815225617475" style="zoom:67%;"></a></p> <p><strong>åˆ†è¡¨åˆ†åº“ + æ°´å“æ‹†åˆ† + MySQL é›†ç¾¤</strong></p> <p>æ—©äº›å¹´ MyISAMï¼šè¡¨é” ï¼Œååˆ†å½±å“æ•ˆç‡ï¼Œé«˜å¹¶å‘ä¸‹å°±ä¼šå‡ºç°ä¸¥é‡çš„é”é—®é¢˜</p> <p>è½¬æˆ˜ InnoDBï¼šè¡Œé”ï¼ˆå¦‚æœä½¿ç”¨é’ˆå¯¹ InnoDB çš„è¡¨ä½¿ç”¨è¡Œé”ï¼Œè¢«é”å®šå­—æ®µä¸æ˜¯ä¸»é”®ï¼Œä¹Ÿæ²¡æœ‰é’ˆå¯¹å®ƒå»ºç«‹ç´¢å¼•çš„è¯ï¼Œè¡Œé”é”å®šçš„ä¹Ÿæ˜¯æ•´å¼ è¡¨ï¼‰</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20200815230653794.png" data-desc-position="bottom"><img src="!assets/Redis/image-20200815230653794.png" alt="image-20200815230653794" style="zoom:80%;"></a></p> <p><strong>ç°ä»Šï¼ˆå¤§æ•°æ®æ—¶ä»£ï¼‰</strong></p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20200815235909929.png" data-desc-position="bottom"><img src="!assets/Redis/image-20200815235909929.png" alt="image-20200815235909929" style="zoom: 80%;"></a></p> <p>ç°ä»Šå¦‚æœæ¶‰åŠå¤§æ•°æ®é‡çš„éœ€æ±‚ï¼Œæ¯”å¦‚ä¸€äº›å•†å“æŠ¢è´­çš„æƒ…æ™¯ï¼Œæˆ–è€…æ˜¯ä¸»é¡µè®¿é—®é‡ç¬é—´è¾ƒå¤§çš„æ—¶å€™ï¼Œå•ä¸€ä½¿ç”¨æ•°æ®åº“æ¥ä¿å­˜æ•°æ®çš„ç³»ç»Ÿä¼šå› ä¸ºé¢å‘ç£ç›˜ï¼Œç£ç›˜è¯»/å†™é€Ÿåº¦æ¯”è¾ƒæ…¢çš„é—®é¢˜è€Œå­˜åœ¨ä¸¥é‡çš„æ€§èƒ½å¼Šç«¯ï¼Œä¸€ç¬é—´æˆåƒä¸Šä¸‡çš„è¯·æ±‚åˆ°æ¥ï¼Œéœ€è¦ç³»ç»Ÿåœ¨æçŸ­çš„æ—¶é—´å†…å®Œæˆæˆåƒä¸Šä¸‡æ¬¡çš„è¯»/å†™æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™å¾€å¾€ä¸æ˜¯æ•°æ®åº“èƒ½å¤Ÿæ‰¿å—çš„ï¼Œæå…¶å®¹æ˜“é€ æˆæ•°æ®åº“ç³»ç»Ÿç˜«ç—ªï¼Œæœ€ç»ˆå‡ºç°æœåŠ¡å®•æœºè¿™ç§ä¸¥é‡çš„é—®é¢˜ã€‚ä¸ºäº†å…‹æœä¸Šè¿°çš„é—®é¢˜ï¼Œé¡¹ç›®é€šå¸¸ä¼šå¼•å…¥ NoSQL æŠ€æœ¯ã€‚</p> <h3 id="12ä»€ä¹ˆæ˜¯-nosql">1.2ã€ä»€ä¹ˆæ˜¯ NoSQLï¼Ÿ<a class="headerlink" href="#12ä»€ä¹ˆæ˜¯-nosql" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>NoSQL = Not Only SQLï¼ˆä¸ä»…ä»…æ˜¯ SQLï¼‰</p> <p><strong>NoSQL çš„ç‰¹ç‚¹ï¼š</strong></p> <ul> <li>æ–¹ä¾¿æ‰©å±•ï¼ˆæ•°æ®ä¹‹é—´æ²¡æœ‰å…³ç³»ï¼Œå¾ˆå¥½æ‰©å±•ï¼‰</li> <li>å¤§æ•°æ®é‡é«˜æ€§èƒ½ï¼ˆRedis ä¸€ç§’å†™ 8 ä¸‡æ¬¡ï¼Œè¯»å– 11 ä¸‡ï¼ŒNoSQL çš„ç¼“å­˜è®°å½•çº§ï¼Œæ˜¯ä¸€ç§ç»†ç²’åº¦çš„ç¼“å­˜ï¼Œæ€§èƒ½ä¼šæ¯”è¾ƒé«˜ï¼‰</li> <li>æ•°æ®ç±»å‹æ˜¯å¤šæ ·å‹çš„ï¼ˆä¸éœ€è¦äº‹å…ˆè®¾è®¡æ•°æ®åº“ï¼Œéšç”¨éšå–ï¼‰</li> </ul> <p><strong>ä¼ ç»Ÿ RDBMS å’Œ MySQL</strong></p> <ul> <li> <p>ä¼ ç»Ÿçš„ RDBMS</p> <ul> <li>ç»“æ„åŒ–ç»„ç»‡</li> <li>SQL</li> <li>æ•°æ®å’Œå…³ç³»éƒ½å­˜åœ¨å•ç‹¬çš„è¡¨ä¸­</li> <li>ä¸¥æ ¼çš„ä¸€è‡´æ€§</li> <li>åŸºç¡€çš„äº‹åŠ¡</li> </ul> </li> <li> <p>NoSQL</p> <ul> <li>ä¸ä»…ä»…æ˜¯æ•°æ®</li> <li>æ²¡æœ‰å›ºå®šçš„æŸ¥è¯¢è¯­è¨€</li> <li>é”®å€¼å¯¹å­˜å‚¨ã€åˆ—å­˜å‚¨ã€æ–‡æ¡£å­˜å‚¨ï¼Œå›¾å½¢æ•°æ®åº“ï¼ˆç¤¾äº¤å…³ç³»ï¼‰</li> <li>æœ€ç»ˆä¸€è‡´æ€§</li> <li>CPA å®šç†å’Œ BASE</li> <li>é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€é«˜å¯æ‰©</li> </ul> </li> </ul> <p><strong>äº†è§£ 3V + 3 é«˜</strong></p> <p>å¤§æ•°æ®æ—¶ä»£çš„ 3Vï¼šä¸»è¦æè¿°é—®é¢˜çš„</p> <ul> <li>æµ·é‡ Volume</li> <li>å¤šæ · Variety</li> <li>å®æ—¶ Velocity</li> </ul> <p>å¤§æ•°æ®æ—¶ä»£çš„ 3 é«˜ ï¼šä¸»è¦æ˜¯å¯¹ç¨‹åºçš„è¦æ±‚</p> <ul> <li>é«˜å¹¶å‘</li> <li>é«˜å¯æ‰©</li> <li>é«˜æ€§èƒ½</li> </ul> <p><strong>NoSQL æ•°æ®åº“çš„å››å¤§åˆ†ç±»çš„åˆ†æ</strong></p> <table> <thead> <tr> <th>åˆ†ç±»</th> <th>Example ä¸¾ä¾‹</th> <th>å…¸å‹åº”ç”¨åœºæ™¯</th> <th>æ•°æ®æ¨¡å‹</th> <th>ä¼˜ç‚¹</th> <th>ç¼ºç‚¹</th> </tr> </thead> <tbody> <tr> <td>é”®å€¼ï¼ˆkey-valueï¼‰</td> <td>Tokyo Cabinet/Tyrant, Redis, Voldemort, Oracle BDB</td> <td>å†…å®¹ç¼“å­˜ï¼Œä¸»è¦ç”¨äºå¤„ç†å¤§é‡æ•°æ®çš„é«˜è®¿é—®è´Ÿè½½ï¼Œä¹Ÿç”¨äºä¸€äº›æ—¥å¿—ç³»ç»Ÿç­‰ç­‰ã€‚</td> <td>Key æŒ‡å‘ Value çš„é”®å€¼å¯¹ï¼Œé€šå¸¸ç”¨ hash table æ¥å®ç°</td> <td>æŸ¥æ‰¾é€Ÿåº¦å¿«</td> <td>æ•°æ®æ— ç»“æ„åŒ–ï¼Œé€šå¸¸åªè¢«å½“ä½œå­—ç¬¦ä¸²æˆ–è€…äºŒè¿›åˆ¶æ•°æ®</td> </tr> <tr> <td>åˆ—å­˜å‚¨æ•°æ®åº“</td> <td>Cassandra, HBase, Riak</td> <td>åˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿ</td> <td>ä»¥åˆ—ç°‡å¼å­˜å‚¨ï¼Œå°†åŒä¸€åˆ—æ•°æ®å­˜åœ¨ä¸€èµ·</td> <td>æŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œå¯æ‰©å±•æ€§å¼ºï¼Œæ›´å®¹æ˜“è¿›è¡Œåˆ†å¸ƒå¼æ‰©å±•</td> <td>åŠŸèƒ½ç›¸å¯¹å±€é™</td> </tr> <tr> <td>æ–‡æ¡£å‹æ•°æ®åº“</td> <td>CouchDB, MongoDb</td> <td>Webåº”ç”¨ï¼ˆä¸Key-Valueç±»ä¼¼ï¼ŒValueæ˜¯ç»“æ„åŒ–çš„ï¼Œä¸åŒçš„æ˜¯æ•°æ®åº“èƒ½å¤Ÿäº†è§£Valueçš„å†…å®¹ï¼‰</td> <td>Key-Value å¯¹åº”çš„é”®å€¼å¯¹ï¼ŒValue ä¸ºç»“æ„åŒ–æ•°æ®</td> <td>æ•°æ®ç»“æ„è¦æ±‚ä¸ä¸¥æ ¼ï¼Œè¡¨ç»“æ„å¯å˜ï¼Œä¸éœ€è¦åƒå…³ç³»å‹æ•°æ®åº“ä¸€æ ·éœ€è¦é¢„å…ˆå®šä¹‰è¡¨ç»“æ„</td> <td>æŸ¥è¯¢æ€§èƒ½ä¸é«˜ï¼Œè€Œä¸”ç¼ºä¹ç»Ÿä¸€çš„æŸ¥è¯¢è¯­æ³•ã€‚</td> </tr> <tr> <td>å›¾å½¢(Graph)æ•°æ®åº“</td> <td>Neo4J, InfoGrid, Infinite Graph</td> <td>ç¤¾äº¤ç½‘ç»œï¼Œæ¨èç³»ç»Ÿç­‰ã€‚ä¸“æ³¨äºæ„å»ºå…³ç³»å›¾è°±</td> <td>å›¾ç»“æ„</td> <td>åˆ©ç”¨å›¾ç»“æ„ç›¸å…³ç®—æ³•ã€‚æ¯”å¦‚æœ€çŸ­è·¯å¾„å¯»å€ï¼ŒN åº¦å…³ç³»æŸ¥æ‰¾ç­‰</td> <td>å¾ˆå¤šæ—¶å€™éœ€è¦å¯¹æ•´ä¸ªå›¾åšè®¡ç®—æ‰èƒ½å¾—å‡ºéœ€è¦çš„ä¿¡æ¯ï¼Œè€Œä¸”è¿™ç§ç»“æ„ä¸å¤ªå¥½åšåˆ†å¸ƒå¼çš„é›†ç¾¤</td> </tr> </tbody> </table> <h2 id="2redis-å…¥é—¨">2ã€Redis å…¥é—¨<a class="headerlink" href="#2redis-å…¥é—¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <h3 id="21æ¦‚è¿°">2.1ã€æ¦‚è¿°<a class="headerlink" href="#21æ¦‚è¿°" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Redisï¼ˆRemote Dictionary Server )ï¼Œå³è¿œç¨‹å­—å…¸æœåŠ¡ï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€Key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„APIã€‚</p> <p>Redis ä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº† master-slaveï¼ˆä¸»ä»ï¼‰åŒæ­¥ã€‚æ˜¯å½“ä¸‹æœ€çƒ­é—¨çš„ NoSQL æŠ€æœ¯ä¹‹ä¸€ï¼Œä¹Ÿè¢«äººä»¬æˆä¸ºç»“æ„åŒ–æ•°æ®åº“ã€‚</p> <p><strong>Redis èƒ½å¹²å˜›ï¼Ÿ</strong></p> <ul> <li>å†…å­˜å­˜å‚¨ã€æŒä¹…åŒ–ï¼Œå†…å­˜ä¸­æ˜¯æ–­ç”µå³å¤±ï¼Œæ‰€ä»¥è¯´æŒä¹…åŒ–å¾ˆé‡è¦ï¼ˆRDBã€AOFï¼‰</li> <li>æ•ˆç‡é«˜ï¼Œå¯ä»¥ç”¨äºé«˜é€Ÿç¼“å­˜</li> <li>å‘å¸ƒè®¢é˜…ç³»ç»Ÿ</li> <li>åœ°å›¾ä¿¡æ¯åˆ†æ</li> <li>è®¡æ—¶å™¨ã€è®¡æ•°å™¨ï¼ˆæµè§ˆé‡ï¼‰</li> <li>...</li> </ul> <p><strong>Redis çš„ç‰¹æ€§</strong></p> <ul> <li>å¤šæ ·çš„æ•°æ®ç±»å‹</li> <li>æŒä¹…åŒ–</li> <li>é›†ç¾¤</li> <li>äº‹åŠ¡</li> <li>...</li> </ul> <p>Redis æ˜¯å•çº¿ç¨‹çš„ï¼ˆ6.0 æ˜¯å¤šçº¿ç¨‹ï¼‰ï¼Œå› ä¸º Redis æ˜¯åŸºäºå†…å­˜æ“ä½œï¼ŒCPU ä¸æ˜¯ Reids æ€§èƒ½ç“¶é¢ˆï¼ŒReids çš„ç“¶é¢ˆæ˜¯æ ¹æ®æœºå™¨çš„å†…å­˜å’Œç½‘ç»œçš„å¸¦å®½ï¼Œè€Œä¸”Redis å•çº¿ç¨‹ååˆ†å¿«ã€‚</p> <h3 id="22reids-å®‰è£…">2.2ã€Reids å®‰è£…<a class="headerlink" href="#22reids-å®‰è£…" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <h4 id="221linxu">2.2.1ã€Linxu<a class="headerlink" href="#221linxu" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>å¦‚æœå«Œéº»çƒ¦å¹¶ä¸”æœåŠ¡å™¨å¯ä»¥è¿æ¥äº’è”ç½‘ï¼Œå¯ä»¥ä½¿ç”¨åœ¨çº¿å®‰è£…çš„æ–¹å¼ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1">## å®‰è£…redisï¼Œå®‰è£…åredisé»˜è®¤ä¸ºå¯åŠ¨çŠ¶æ€</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>apt<span class="w"> </span>install<span class="w"> </span>redis
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1">## å¯åŠ¨redisæœåŠ¡</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>redis-server<span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1">## å¯åŠ¨å®¢æˆ·ç«¯</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>redis-cli
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="c1">## å¸è½½</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>apt<span class="w"> </span>purge<span class="w"> </span>--auto-remove<span class="w"> </span>redis-server
</span></code></pre></div> <p>ä¸€èˆ¬æœåŠ¡å™¨ä¸»è¦è¿˜æ˜¯ä½¿ç”¨ç¦»çº¿å®‰è£…å¹¶ä¸”æ‰‹åŠ¨é…ç½®ç¯å¢ƒã€‚</p> <h5 id="å®‰è£…-reids">å®‰è£… Reids<a class="headerlink" href="#å®‰è£…-reids" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <ol> <li> <p>ä¸‹è½½æºç ï¼ˆæœåŠ¡ç¦»çº¿å¯ä»¥ä½¿ç”¨ SFTP ç­‰å·¥å…·ä¸Šä¼ è¿‡å»ï¼‰ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>wget<span class="w"> </span>http://download.redis.io/releases/redis-6.0.5.tar.gz
</span></code></pre></div> </li> <li> <p>è§£å‹åˆ° <code>/usr/local</code> ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>tar<span class="w"> </span>-xzf<span class="w"> </span>./redis-6.0.5.tar.gz<span class="w"> </span>-C<span class="w"> </span>/usr/local/
</span></code></pre></div> </li> <li> <p>æ›´æ”¹æ–‡ä»¶å¤¹åç§°ä¸º <code>redis</code>ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>mv<span class="w"> </span>/usr/local/redis-6.0.5/<span class="w"> </span>/usr/local/redis/
</span></code></pre></div> </li> <li> <p>è¿›å…¥ç›®å½•ï¼ŒC/C++ æ„å»ºï¼Œç±»ä¼¼ mvn installï¼Œnpm buildï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nb">cd</span><span class="w"> </span>/usr/local/redis
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>sudo<span class="w"> </span>make
</span></code></pre></div> </li> <li> <p>å®‰è£…ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>sudo<span class="w"> </span>make<span class="w"> </span>install
</span></code></pre></div> </li> <li> <p>å¯åŠ¨ Redisï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>src/redis-server
</span></code></pre></div> </li> </ol> <h5 id="é…ç½®-systemd-æœåŠ¡">é…ç½® systemd æœåŠ¡<a class="headerlink" href="#é…ç½®-systemd-æœåŠ¡" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <ol> <li> <p>Redis å®‰è£…åï¼Œé»˜è®¤é…ç½®æ–‡ä»¶ä½äºæºç ç›®å½•ä¸­çš„ redis.conf æ–‡ä»¶ã€‚å¯ä»¥å°†å…¶å¤åˆ¶åˆ° <code>/etc/redis/</code> ç›®å½•ï¼Œå¹¶è¿›è¡Œè‡ªå®šä¹‰é…ç½®ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>mkdir<span class="w"> </span>/etc/redis/
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>cp<span class="w"> </span>/usr/local/redis/redis.conf<span class="w"> </span>/etc/redis/
</span></code></pre></div> </li> <li> <p>æ–°å»ºä¸€ä¸ªç³»ç»ŸæœåŠ¡æ–‡ä»¶ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>vim<span class="w"> </span>/etc/systemd/system/redis.service
</span></code></pre></div> <p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="o">[</span>Unit<span class="o">]</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nv">Description</span><span class="o">=</span>Redis<span class="w"> </span>Server
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nv">After</span><span class="o">=</span>network.target
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="o">[</span>Service<span class="o">]</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="nv">ExecStart</span><span class="o">=</span>/usr/local/bin/redis-server<span class="w"> </span>/etc/redis/redis.conf
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="nv">ExecStop</span><span class="o">=</span>/usr/local/bin/redis-cli<span class="w"> </span>shutdown
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="nv">Restart</span><span class="o">=</span>always
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="o">[</span>Install<span class="o">]</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</span></code></pre></div> </li> <li> <p>é‡è½½ç³»ç»ŸæœåŠ¡ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>systemctl<span class="w"> </span>daemon-reload
</span></code></pre></div> </li> <li> <p>æ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯å’Œæ£€æŸ¥ Redis æœåŠ¡çš„çŠ¶æ€ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>systemctl<span class="w"> </span>start<span class="w"> </span>redis
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>systemctl<span class="w"> </span>stop<span class="w"> </span>redis
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>redis
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>systemctl<span class="w"> </span>status<span class="w"> </span>redis
</span></code></pre></div> </li> <li> <p>å¦‚æœæƒ³è¦åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ Redis æœåŠ¡ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>redis
</span></code></pre></div> </li> </ol> <h5 id="å¸è½½å¹¶åˆ é™¤">å¸è½½å¹¶åˆ é™¤<a class="headerlink" href="#å¸è½½å¹¶åˆ é™¤" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">## å…ˆåœä¸‹redisï¼Œç„¶ååˆ é™¤å®‰è£…ç›®å½•</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>/usr/local/redis<span class="w"> </span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="c1">## åˆ é™¤æ‰€æœ‰redisç›¸å…³å‘½ä»¤è„šæœ¬</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>rm<span class="w"> </span>-rf<span class="w"> </span>/usr/bin/redis-*
</span></code></pre></div> <h4 id="222docker">2.2.2ã€Docker<a class="headerlink" href="#222docker" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <ol> <li> <p>ä¸‹è½½ redis é•œåƒï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>docker<span class="w"> </span>pull<span class="w"> </span>redis
</span></code></pre></div> </li> <li> <p>åˆ›å»º reids å®¹å™¨ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>docker<span class="w"> </span>run<span class="w"> </span>--name<span class="w"> </span>redis<span class="w"> </span>-td<span class="w"> </span>-p<span class="w"> </span><span class="m">6379</span>:6379<span class="w"> </span>redis
</span></code></pre></div> </li> <li> <p>è¿›å…¥ reids å®¹å™¨ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>redis<span class="w"> </span>bash
</span></code></pre></div> </li> <li> <p>å¯åŠ¨å®¢æˆ·ç«¯ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>redis-cli
</span></code></pre></div> </li> </ol> <h4 id="222windows">2.2.2ã€Windows<a class="headerlink" href="#222windows" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>å‰å¾€ <a href="https://github.com/redis-windows/redis-windows/releases">åœ°å€</a> ä¸‹è½½å®‰è£…åŒ…ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="./!assets/Redis/image-20250426033944475.png" data-desc-position="bottom"><img src="./!assets/Redis/image-20250426033944475.png" alt="image-20250426033944475" style="zoom: 50%;"></a></p> <p>å„ä¸ªç‰ˆæœ¬å·®å¼‚ï¼š</p> <table> <thead> <tr> <th>ç‰¹æ€§</th> <th>Cygwin ç‰ˆæœ¬</th> <th>MSYS2 ç‰ˆæœ¬</th> </tr> </thead> <tbody> <tr> <td>æ„å»ºç¯å¢ƒ</td> <td>ä½¿ç”¨ Cygwin ç¼–è¯‘ï¼Œå…¼å®¹ POSIX ç‰¹æ€§æ›´å¤šã€‚</td> <td>ä½¿ç”¨ MSYS2 ç¼–è¯‘ï¼Œé€Ÿåº¦æ›´å¿«ã€æ›´è½»é‡ã€‚</td> </tr> <tr> <td>æ€§èƒ½è¡¨ç°</td> <td>ç›¸å¯¹è¾ƒæ…¢ä¸€äº›ã€‚</td> <td>ç›¸å¯¹æ›´å¿«ã€æ›´æ¥è¿‘åŸç”Ÿã€‚</td> </tr> <tr> <td>å…¼å®¹æ€§</td> <td>ä¸ Linux ç¨‹åºæ¥å£æ›´ç›¸ä¼¼ã€‚</td> <td>æ›´é€‚åˆ Windows åŸç”Ÿå¼€å‘åœºæ™¯ã€‚</td> </tr> <tr> <td>åº•å±‚ä¾èµ–</td> <td>ä¾èµ– <code>cygwin1.dll</code>ã€‚</td> <td>ä¾èµ– <code>msys-2.0.dll</code>ã€‚</td> </tr> <tr> <td>with-Service</td> <td>å¯é€šè¿‡ Windows æœåŠ¡æ–¹å¼å®‰è£…å’Œå¯åŠ¨ Redisã€‚</td> <td>å¯é€šè¿‡ Windows æœåŠ¡æ–¹å¼å®‰è£…å’Œå¯åŠ¨ Redisã€‚</td> </tr> </tbody> </table> <p>ä¸‹è½½å®Œæˆåè§£å‹ï¼Œæä¾›ä¸‰ç§è¿è¡Œæ¨¡å¼ï¼š</p> <ul> <li>è¿è¡Œé¡¹ç›®ä¸­çš„ start.bat è„šæœ¬ï¼Œä¸€é”®å¯åŠ¨ã€‚</li> <li>ä½¿ç”¨å‘½ä»¤è¡Œã€‚</li> <li>ä»¥ç³»ç»ŸæœåŠ¡è¿è¡Œã€‚</li> </ul> <p><strong>å‘½ä»¤è¡Œå¯åŠ¨</strong></p> <p>å…ˆå°†å®‰è£…ç›®å½•é…ç½®ç¯å¢ƒå˜é‡ã€‚</p> <p><code>cmd</code> å¯åŠ¨ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>redis-server.exe<span class="w"> </span>redis.conf
</span></code></pre></div> <p><code>powershell</code> å¯åŠ¨ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>./redis-server.exe<span class="w"> </span>redis.conf
</span></code></pre></div> <p><strong>å®‰è£…æœåŠ¡</strong></p> <p>å¯å®ç°å¼€æœºè‡ªå¯åŠ¨ è¯·ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼Œå¹¶å°† RedisService.exe æ”¹ä¸ºå®é™…å­˜æ”¾çš„è·¯å¾„ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>sc<span class="w"> </span>create<span class="w"> </span>Redis<span class="w"> </span><span class="nv">binpath</span><span class="o">=</span><span class="w"> </span><span class="s2">"C:\Software\Redis\RedisService.exe"</span><span class="w"> </span><span class="nv">start</span><span class="o">=</span><span class="w"> </span>auto
</span></code></pre></div> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>é€‰é¡¹ä¸å…¶å€¼ä¹‹é—´éœ€è¦ç©ºæ ¼ï¼ˆä¾‹å¦‚ <code>start= auto</code>ï¼‰ï¼Œ å¦‚æœçœç•¥ç©ºæ ¼ï¼Œæ“ä½œå°†å¤±è´¥æ–°ç‰ˆ Windows å¯å¿½ç•¥ã€‚</p> </div> <p>å®Œæˆåå¯ä»¥åœ¨ã€æœåŠ¡ã€‘ç•Œé¢çœ‹åˆ°ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20221128134544993.png" data-desc-position="bottom"><img src="!assets/Redis/image-20221128134544993.png" alt="image-20221128134544993" style="zoom:50%;"></a></p> <p>æœåŠ¡é»˜è®¤ä¸ºè‡ªåŠ¨å¯åŠ¨çŠ¶æ€ï¼ˆå¼€æœºè‡ªå¯ï¼‰ï¼Œå¦‚æœä¸å¸Œæœ›è‡ªåŠ¨å¯åŠ¨å¯ä»¥æ”¹ä¸ºæ‰‹åŠ¨å¯åŠ¨ï¼Œé€šè¿‡æœåŠ¡é¡µé¢æˆ–è€…ä»¥ä¸‹å‘½ä»¤æ§åˆ¶ Redis æœåŠ¡ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">## å¯åŠ¨ Redis æœåŠ¡</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>sc<span class="w"> </span>start<span class="w"> </span>Redis
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="c1">## åœæ­¢ Redis æœåŠ¡</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>sc<span class="w"> </span>stop<span class="w"> </span>Redis
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="c1">## å¸è½½ Redis æœåŠ¡</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>sc<span class="w"> </span>delete<span class="w"> </span>Redis
</span></code></pre></div> <h4 id="223å®‰è£…é‡åˆ°çš„ä¸€äº›é—®é¢˜">2.2.3ã€å®‰è£…é‡åˆ°çš„ä¸€äº›é—®é¢˜<a class="headerlink" href="#223å®‰è£…é‡åˆ°çš„ä¸€äº›é—®é¢˜" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <h5 id="arm64ç¯å¢ƒå¯åŠ¨bug">ARM64ç¯å¢ƒå¯åŠ¨BUG<a class="headerlink" href="#arm64ç¯å¢ƒå¯åŠ¨bug" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>1:C 24 Apr 2022 14:31:23.525 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>1:C 24 Apr 2022 14:31:23.525 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=1, just started
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>1:C 24 Apr 2022 14:31:23.525 # Configuration loaded
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>1:M 24 Apr 2022 14:31:23.526 * monotonic clock: POSIX clock_gettime
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>                _._                                                  
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>           _.-``__ ''-._                                             
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>      _.-``    `.  `_.  ''-._           Redis 6.2.6 (00000000/0) 64 bit
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>  .-`` .-```.  ```\/    _.,_ ''-._                                  
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a> (    '      ,       .-`  | `,    )     Running in standalone mode
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a> |`-._`-...-` __...-.``-._|'` _.-'|     Port: 16379
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a> |    `-._   `._    /     _.-'    |     PID: 1
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>  `-._    `-._  `-./  _.-'    _.-'                                   
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a> |`-._`-._    `-.__.-'    _.-'_.-'|                                  
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a> |    `-._`-._        _.-'_.-'    |           https://redis.io       
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>  `-._    `-._`-.__.-'_.-'    _.-'                                   
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a> |`-._`-._    `-.__.-'    _.-'_.-'|                                  
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a> |    `-._`-._        _.-'_.-'    |                                  
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>  `-._    `-._`-.__.-'_.-'    _.-'                                   
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>      `-._    `-.__.-'    _.-'                                       
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>          `-._        _.-'                                           
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>              `-.__.-'                                               
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>1:M 24 Apr 2022 14:31:23.526 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>1:M 24 Apr 2022 14:31:23.526 # Server initialized
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>1:M 24 Apr 2022 14:31:23.527 # WARNING Your kernel has a bug that could lead to data corruption during background save. Please upgrade to the latest stable kernel.
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>1:M 24 Apr 2022 14:31:23.527 # Redis will now exit to prevent data corruption. Note that it is possible to suppress this warning by setting the following config: ignore-warnings ARM64-COW-BUG
</span></code></pre></div> <p><strong>è§£å†³åŠæ³•</strong></p> <p>åœ¨ redis.conf æœ€åä¸€è¡Œå–æ¶ˆä»¥ä¸‹é…ç½®æ³¨é‡Šï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>ignore-warnings ARM64-COW-BUG
</span></code></pre></div> <p>å¦‚æœæ²¡æœ‰çš„è¯å°±æ‰‹åŠ¨æ–°å¢é…ç½®ã€‚</p> <h3 id="23åŸºç¡€çŸ¥è¯†">2.3ã€åŸºç¡€çŸ¥è¯†<a class="headerlink" href="#23åŸºç¡€çŸ¥è¯†" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <h4 id="231å¿«é€Ÿä¸Šæ‰‹">2.3.1ã€å¿«é€Ÿä¸Šæ‰‹<a class="headerlink" href="#231å¿«é€Ÿä¸Šæ‰‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <h5 id="å¯åŠ¨">å¯åŠ¨<a class="headerlink" href="#å¯åŠ¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <p>å¯åŠ¨ Redis æœåŠ¡å™¨ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>redis-server
</span></code></pre></div> <p>å¸¦é…ç½®æ–‡ä»¶å¯åŠ¨ï¼ˆ<code>/etc/redis/redis.conf</code> ä¸ºé…ç½®æ–‡ä»¶åœ°å€ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œå°†é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°äº† <code>/etc/redis</code> ä¸‹ï¼‰ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>redis-server<span class="w"> </span>/etc/redis/redis.conf
</span></code></pre></div> <p>å¸¦é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œä¸”æŒ‡å®šæŸå‡ ä¸ªé…ç½®ï¼Œé…ç½®åç§°å‰åŠ  <code>--</code>ï¼Œä¼šè¦†ç›–é…ç½®æ–‡ä»¶é‡Œå€¼ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>redis-server<span class="w"> </span>/etc/redis/redis.conf<span class="w"> </span>--daemonize<span class="w"> </span>yes<span class="w"> </span>--port<span class="w"> </span><span class="m">1123</span>
</span></code></pre></div> <p>æŸ¥çœ‹ç‰ˆæœ¬å·ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>redis-server<span class="w"> </span>-v
</span></code></pre></div> <h5 id="è¿æ¥">è¿æ¥<a class="headerlink" href="#è¿æ¥" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <p>å¯åŠ¨ Redis å®¢æˆ·ç«¯ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>redis-cli
</span></code></pre></div> <p>äº¤äº’æ¨¡å¼ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>redis-cli<span class="w"> </span>-h<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>-p<span class="w"> </span><span class="m">6379</span>
</span></code></pre></div> <h5 id="å…³é—­">å…³é—­<a class="headerlink" href="#å…³é—­" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <p>å…³é—­ Redisï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>redis-cli<span class="w"> </span>shutdown
</span></code></pre></div> <p>å¦‚æœ Redis è®¾ç½®å¯†ç ï¼Œéœ€è¦ç™»å½• Redis åå…ˆè®¤è¯å† <code>shutdown</code> å‘½ä»¤å…³é—­ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>auth<span class="w"> </span>&lt;å¯†ç &gt;
</span></code></pre></div> <h5 id="redis-å·¥å…·">Redis å·¥å…·<a class="headerlink" href="#redis-å·¥å…·" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <p>Redis æ€§èƒ½æµ‹è¯•å·¥å…·ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>redis-benchmark
</span></code></pre></div> <p>aof æ–‡ä»¶ä¿®å¤å·¥å…·ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>redis-check-aof
</span></code></pre></div> <p>rdb æ–‡ä»¶æ£€æŸ¥å·¥å…·ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>redis-check-dump
</span></code></pre></div> <h4 id="232å¸¸ç”¨å‘½ä»¤">2.3.2ã€å¸¸ç”¨å‘½ä»¤<a class="headerlink" href="#232å¸¸ç”¨å‘½ä»¤" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <table> <thead> <tr> <th>å‘½ä»¤</th> <th>æè¿°</th> </tr> </thead> <tbody> <tr> <td><code>select [db_index]</code></td> <td>åˆ‡æ¢åˆ° db_index å·æ•°æ®åº“ï¼ŒRedis é»˜è®¤ 16 ä¸ªæ•°æ®åº“ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨ç¬¬ 0 ä¸ª</td> </tr> <tr> <td><code>dbsize</code></td> <td>æŸ¥çœ‹æ•°æ®åº“å¤§å°</td> </tr> <tr> <td><code>keys *</code></td> <td>æŸ¥çœ‹æ‰€æœ‰çš„é”®</td> </tr> <tr> <td><code>flushdb</code></td> <td>æ¸…ç©ºå½“å‰æ•°æ®åº“</td> </tr> <tr> <td><code>flushall</code></td> <td>æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“</td> </tr> <tr> <td><code>move [key] [db_index]</code></td> <td>å½“å‰æ•°æ®åº“çš„ key ç§»åŠ¨åˆ°ç»™å®šçš„æ•°æ®åº“ db_index å½“ä¸­</td> </tr> <tr> <td><code>expire [key] [second]</code></td> <td>è®¾ç½®è¯¥ key åœ¨ second ç§’åè¿‡æœŸ</td> </tr> <tr> <td><code>ttl [key]</code></td> <td>æ˜¾ç¤º key çš„å‰©ä½™æœ‰æ•ˆæ—¶é—´ï¼ˆtime to live å­˜æ´»æ—¶é—´ï¼‰</td> </tr> <tr> <td><code>type [key]</code></td> <td>æ˜¾ç¤º key çš„ç±»å‹</td> </tr> <tr> <td><code>exists [key]</code></td> <td>æŸ¥çœ‹ key æ˜¯å¦å­˜åœ¨ï¼Œ1 è¡¨ç¤ºå­˜åœ¨ï¼Œ0 è¡¨ç¤ºä¸å­˜åœ¨</td> </tr> <tr> <td><code>del [key]</code></td> <td>åˆ é™¤è¯¥ key</td> </tr> </tbody> </table> <h2 id="3äº”å¤§æ•°æ®ç±»å‹">3ã€äº”å¤§æ•°æ®ç±»å‹<a class="headerlink" href="#3äº”å¤§æ•°æ®ç±»å‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>Redis æ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSDè®¸å¯ï¼‰çš„ï¼Œå†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚ å®ƒæ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚ å­—ç¬¦ä¸²ï¼ˆstringsï¼‰ï¼Œ æ•£åˆ—ï¼ˆhashesï¼‰ï¼Œ åˆ—è¡¨ï¼ˆlistsï¼‰ï¼Œ é›†åˆï¼ˆsetsï¼‰ï¼Œ æœ‰åºé›†åˆï¼ˆsorted setsï¼‰ ä¸èŒƒå›´æŸ¥è¯¢ï¼Œ bitmapsï¼Œ hyperloglogs å’Œ åœ°ç†ç©ºé—´ï¼ˆgeospatialï¼‰ ç´¢å¼•åŠå¾„æŸ¥è¯¢ã€‚ Redis å†…ç½®äº† å¤åˆ¶ï¼ˆreplicationï¼‰ï¼ŒLUAè„šæœ¬ï¼ˆLua scriptingï¼‰ï¼Œ LRUé©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰ï¼Œäº‹åŠ¡ï¼ˆtransactionsï¼‰ å’Œä¸åŒçº§åˆ«çš„ ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰ï¼Œ å¹¶é€šè¿‡ Rediså“¨å…µï¼ˆSentinelï¼‰å’Œè‡ªåŠ¨åˆ†åŒºï¼ˆClusterï¼‰æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰ã€‚</p> <h3 id="31stringå­—ç¬¦ä¸²">3.1ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰<a class="headerlink" href="#31stringå­—ç¬¦ä¸²" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>string æ˜¯ redis æœ€åŸºæœ¬çš„ç±»å‹ï¼Œå¯ä»¥ç†è§£æˆä¸ Memcached ä¸€æ¨¡ä¸€æ ·çš„ç±»å‹ï¼Œä¸€ä¸ª key å¯¹åº”ä¸€ä¸ª valueã€‚value å…¶å®ä¸ä»…æ˜¯ Stringï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°å­—ã€‚string ç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„æ€æ˜¯ redis çš„ string å¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚ jpg å›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚string ç±»å‹æ˜¯ Redis æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œstring ç±»å‹çš„å€¼æœ€å¤§èƒ½å­˜å‚¨ 512MBã€‚</p> <p>å¸¸ç”¨å‘½ä»¤ï¼š<code>get</code>ã€<code>set</code>ã€<code>incr</code>ã€<code>decr</code>ã€<code>mget</code> ç­‰ã€‚</p> <p>åº”ç”¨åœºæ™¯ï¼šString æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç±»å‹ï¼Œæ™®é€šçš„ key / value å­˜å‚¨éƒ½å¯ä»¥å½’ä¸ºæ­¤ç±»ï¼Œå³å¯ä»¥å®Œå…¨å®ç°ç›®å‰ Memcached çš„åŠŸèƒ½ï¼Œå¹¶ä¸”æ•ˆç‡æ›´é«˜ã€‚è¿˜å¯ä»¥äº«å— Redis çš„å®šæ—¶æŒä¹…åŒ–ï¼Œæ“ä½œæ—¥å¿—åŠ Replication ç­‰åŠŸèƒ½ã€‚</p> <p>ä½¿ç”¨åœºæ™¯ï¼šå¸¸è§„ key-value ç¼“å­˜åº”ç”¨ã€‚å¸¸è§„è®¡æ•°ï¼šå¾®åšæ•°ï¼Œç²‰ä¸æ•°ã€‚</p> <p><strong>è¿½åŠ å­—ç¬¦ä¸²</strong></p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>key1<span class="w"> </span>v1<span class="w"> </span><span class="c1"># è®¾ç½®å€¼</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>OK
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>get<span class="w"> </span>key1<span class="w"> </span><span class="c1"># è·å–å€¼</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="s2">"v1"</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>keys<span class="w"> </span>*<span class="w"> </span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"key1"</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>exists<span class="w"> </span>key1
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>append<span class="w"> </span>key1<span class="w"> </span><span class="s1">'hello'</span><span class="w"> </span><span class="c1"># è¿½åŠ å­—ç¬¦ä¸²ï¼Œå¦‚æœå½“å‰ key ä¸å­˜åœ¨ï¼Œå°±ç›¸å½“äº set key</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">7</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>get<span class="w"> </span>key1
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="s2">"v1hello"</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>strlen<span class="w"> </span>key1<span class="w"> </span><span class="c1"># è·å–å­—ç¬¦ä¸²é•¿åº¦</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">7</span>
</span></code></pre></div> <p><strong>è®¡æ•°å™¨</strong></p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>views<span class="w"> </span><span class="m">0</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>OK
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>get<span class="w"> </span>views
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="s2">"0"</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>incr<span class="w"> </span>views<span class="w"> </span><span class="c1"># è‡ªå¢ 1</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>incr<span class="w"> </span>views
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">2</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>incrby<span class="w"> </span>views<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># è‡ªå¢ 10</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>decr<span class="w"> </span>views<span class="w"> </span><span class="c1"># è‡ªå‡ 1</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">11</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>decrby<span class="w"> </span>views<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># è‡ªå‡ 10</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span></code></pre></div> <p><strong>æˆªå–å­—ç¬¦ä¸²</strong></p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>key1<span class="w"> </span><span class="s1">'Orihcalcos'</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>OK
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>get<span class="w"> </span>key1
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="s2">"Orihcalcos"</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>getrange<span class="w"> </span>key1<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c1"># æˆªå–å­—ç¬¦ä¸² [2,3]ï¼Œå°† get æ”¹ä¸º set åˆ™è¡¨ç¤ºæ›¿æ¢</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="s2">"ih"</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>getrange<span class="w"> </span>key1<span class="w"> </span><span class="m">2</span><span class="w"> </span>-1<span class="w"> </span><span class="c1"># å¦‚æœ end å‚æ•°ä¸º -1 åˆ™è¡¨ç¤ºæˆªå–å®Œ</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="s2">"ihcalcos"</span>
</span></code></pre></div> <p><strong>æœ‰æ•ˆæ—¶é—´</strong></p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>setex<span class="w"> </span>key<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="s1">'Orichalcos'</span><span class="w"> </span><span class="c1"># è®¾ç½®è¿‡æœŸæ—¶é—´ ï¼ˆset expireï¼‰</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>OK
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>ttl<span class="w"> </span>key
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>ttl<span class="w"> </span>key
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span>-2
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>setnx<span class="w"> </span>mykey<span class="w"> </span><span class="s1">'redis'</span><span class="w"> </span><span class="c1"># ä¸å­˜åœ¨åˆ™è®¾ç½®ï¼ˆset not existï¼‰</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>setnx<span class="w"> </span>mykey<span class="w"> </span><span class="s1">'Orichalcos'</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>get<span class="w"> </span>mykey
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="s2">"redis"</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>get<span class="w"> </span>key
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="o">(</span>nil<span class="o">)</span>
</span></code></pre></div> <p><strong>ç¾¤ä½“å¯¼å…¥</strong></p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>mset<span class="w"> </span>k1<span class="w"> </span>v1<span class="w"> </span>k2<span class="w"> </span>v2<span class="w"> </span><span class="c1"># ç¾¤ä½“å¯¼å…¥</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>OK
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>msetnx<span class="w"> </span>k1<span class="w"> </span>v1<span class="w"> </span>k3<span class="w"> </span>v3<span class="w"> </span><span class="c1"># msetnx å…·æœ‰åŸå­æ€§</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span></code></pre></div> <p><strong>å¯¹è±¡</strong></p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>user:1<span class="w"> </span><span class="o">{</span>name:zhangsan,age:3<span class="o">}</span><span class="w"> </span><span class="c1"># è®¾ç½®ä¸€ä¸ª user:1 å¯¹è±¡ï¼Œä½¿ç”¨ json å­—ç¬¦æ¥ä¿å­˜ä¸€ä¸ªå¯¹è±¡</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>OK
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>mset<span class="w"> </span>user:1:name<span class="w"> </span>zhangsan<span class="w"> </span>user:1:age<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="c1"># user:{id}:{filed}</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>OK
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>mget<span class="w"> </span>user:1:name<span class="w"> </span>user:1:age
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"zhangsan"</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"2"</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>get<span class="w"> </span>user:1
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="s2">"{name:zhangsan,age:3}"</span>
</span></code></pre></div> <p><strong>getset</strong></p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>getset<span class="w"> </span>db<span class="w"> </span>redis<span class="w"> </span><span class="c1"># å¦‚æœä¸å­˜åœ¨å€¼ï¼Œåˆ™è¿”å› nil</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="o">(</span>nil<span class="o">)</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>get<span class="w"> </span>db
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="s2">"redis"</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>getset<span class="w"> </span>db<span class="w"> </span>mongodb<span class="w"> </span><span class="c1"># å¦‚æœå­˜åœ¨å€¼ï¼Œè·å–åŸæ¥çš„å€¼ï¼Œå¹¶è®¾ç½®æ–°çš„å€¼</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="s2">"redis"</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>get<span class="w"> </span>db
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="s2">"mongodb"</span>
</span></code></pre></div> <h3 id="32liståˆ—è¡¨">3.2ã€Listï¼ˆåˆ—è¡¨ï¼‰<a class="headerlink" href="#32liståˆ—è¡¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚</p> <p>å¸¸ç”¨å‘½ä»¤ï¼š<code>lpush</code>ï¼ˆæ·»åŠ å·¦è¾¹å…ƒç´ ï¼‰ï¼Œ<code>rpush</code>ï¼Œ<code>lpop</code>ï¼ˆç§»é™¤å·¦è¾¹ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œ<code>rpop</code>ï¼Œ<code>lrange</code>ï¼ˆè·å–åˆ—è¡¨ç‰‡æ®µï¼ŒLrange key start stopï¼‰ç­‰ã€‚</p> <p>åº”ç”¨åœºæ™¯ï¼šRedis list çš„åº”ç”¨åœºæ™¯éå¸¸å¤šï¼Œä¹Ÿæ˜¯ Redis æœ€é‡è¦çš„æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œæ¯”å¦‚ twitter çš„å…³æ³¨åˆ—è¡¨ï¼Œç²‰ä¸åˆ—è¡¨ç­‰éƒ½å¯ä»¥ç”¨ Redis çš„ list ç»“æ„æ¥å®ç°ã€‚</p> <p>å®ç°æ–¹å¼ï¼šRedis çš„ list æ˜¯æ¯ä¸ªå­å…ƒç´ éƒ½æ˜¯ String ç±»å‹çš„åŒå‘é“¾è¡¨ï¼Œå¯ä»¥é€šè¿‡ <code>push</code> å’Œ <code>pop</code> æ“ä½œä»åˆ—è¡¨çš„å¤´éƒ¨æˆ–è€…å°¾éƒ¨æ·»åŠ æˆ–è€…åˆ é™¤å…ƒç´ ï¼Œå¯ä»¥æ”¯æŒåå‘æŸ¥æ‰¾å’Œéå†ï¼Œè¿™æ · List æ—¢å¯ä»¥ä½œä¸ºæ ˆï¼Œä¹Ÿå¯ä»¥ä½œä¸ºé˜Ÿåˆ—ï¼Œä¸è¿‡å¸¦æ¥äº†éƒ¨åˆ†é¢å¤–çš„å†…å­˜å¼€é”€ã€‚è·å–è¶Šæ¥è¿‘ä¸¤ç«¯çš„å…ƒç´ é€Ÿåº¦è¶Šå¿«ï¼Œé€šè¿‡ç´¢å¼•è®¿é—®æ—¶ä¼šæ¯”è¾ƒæ…¢ã€‚Redis å†…éƒ¨çš„å¾ˆå¤šå®ç°ï¼ŒåŒ…æ‹¬å‘é€ç¼“å†²é˜Ÿåˆ—ç­‰ä¹Ÿéƒ½æ˜¯ç”¨çš„è¿™ä¸ªæ•°æ®ç»“æ„ã€‚</p> <p>ä½¿ç”¨åœºæ™¯ï¼š</p> <ul> <li>æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼šä½¿ç”¨ list å¯ä»¥æ„å»ºé˜Ÿåˆ—ç³»ç»Ÿï¼Œè½»æ¾åœ°å®ç°æœ€æ–°æ¶ˆæ¯æ’è¡Œç­‰åŠŸèƒ½ã€‚åˆ©ç”¨ List çš„ <code>push</code> æ“ä½œï¼Œå°†ä»»åŠ¡å­˜åœ¨ List ä¸­ï¼Œç„¶åå·¥ä½œçº¿ç¨‹å†ç”¨ <code>pop</code> æ“ä½œå°†ä»»åŠ¡å–å‡ºè¿›è¡Œæ‰§è¡Œï¼Œä½¿ç”¨ sorted set ç”šè‡³å¯ä»¥æ„å»ºæœ‰ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ç³»ç»Ÿã€‚æ¯”å¦‚ï¼šå°† Redis ç”¨ä½œæ—¥å¿—æ”¶é›†å™¨ï¼Œå®é™…ä¸Šè¿˜æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¤šä¸ªç«¯ç‚¹å°†æ—¥å¿—ä¿¡æ¯å†™å…¥ Redisï¼Œç„¶åä¸€ä¸ª worker ç»Ÿä¸€å°†æ‰€æœ‰æ—¥å¿—å†™åˆ°ç£ç›˜ã€‚</li> <li>å–æœ€æ–° N ä¸ªæ•°æ®çš„æ“ä½œï¼šè®°å½•å‰ N ä¸ªæœ€æ–°ç™»é™†çš„ç”¨æˆ· Id åˆ—è¡¨ï¼Œè¶…å‡ºçš„èŒƒå›´å¯ä»¥ä»æ•°æ®åº“ä¸­è·å¾—ã€‚</li> </ul> <p>åˆ—è¡¨æœ€å¤šå¯å­˜å‚¨ 2<sup>32</sup> - 1 å…ƒç´  (4294967295, æ¯ä¸ªåˆ—è¡¨å¯å­˜å‚¨40å¤šäº¿)ã€‚</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lpush<span class="w"> </span>list<span class="w"> </span>one<span class="w"> </span><span class="c1"># å°†ä¸€ä¸ªå€¼æˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨ï¼ˆå·¦ï¼‰</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lpush<span class="w"> </span>list<span class="w"> </span>two
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">2</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lpush<span class="w"> </span>list<span class="w"> </span>three
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">3</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1<span class="w"> </span><span class="c1"># è·å– list ä¸­æ‰€æœ‰çš„å€¼</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"three"</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"two"</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"one"</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># é€šè¿‡åŒºé—´è·å–å…·ä½“çš„å€¼ [0,1]</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"three"</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"two"</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>rpush<span class="w"> </span>list<span class="w"> </span>zero<span class="w"> </span><span class="c1"># å°†ä¸€ä¸ªå€¼æˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å°¾éƒ¨ï¼ˆå³ï¼‰</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">4</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"three"</span>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"two"</span>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"one"</span>
</span><span id="__span-42-20"><a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="s2">"zero"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"three"</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"two"</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"one"</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="s2">"zero"</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lpop<span class="w"> </span>list<span class="w"> </span><span class="c1"># ç§»é™¤ list çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="s2">"three"</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>rpop<span class="w"> </span>list<span class="w"> </span><span class="c1"># ç§»é™¤ list çš„æœ€åä¸€ä¸ªå…ƒç´ </span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="s2">"zero"</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"two"</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"one"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"two"</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"one"</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lindex<span class="w"> </span>list<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># é€šè¿‡ä¸‹æ ‡è·å– list ä¸­çš„æŸä¸€ä¸ªå€¼</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="s2">"one"</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lindex<span class="w"> </span>list<span class="w"> </span><span class="m">0</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="s2">"two"</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>llen<span class="w"> </span>list<span class="w"> </span><span class="c1"># è¿”å›åˆ—è¡¨çš„é•¿åº¦</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">2</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"three"</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"three"</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"two"</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="s2">"one"</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrem<span class="w"> </span>list<span class="w"> </span><span class="m">1</span><span class="w"> </span>three<span class="w"> </span><span class="c1"># åˆ é™¤ list ä¸­çš„ä¸€ä¸ª keyï¼ˆ1 ä¸æ˜¯ä¸‹æ ‡è€Œæ˜¯æ•°é‡ï¼Œä»å·¦å¼€å§‹åˆ é™¤ï¼‰</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"three"</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"two"</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"one"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>mylist<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello3"</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello2"</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello1"</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello"</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>ltrim<span class="w"> </span>mylist<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="c1"># é€šè¿‡ä¸‹æ ‡æˆªå–æŒ‡å®šé•¿åº¦çš„ listï¼Œè¿™ä¸ª list å°†è¢«æ”¹å˜ï¼Œlrange ä¸ä¼šæ”¹å˜åŸ list</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>OK
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>mylist<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello2"</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello1"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>mylist<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello2"</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello1"</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>rpoplpush<span class="w"> </span>mylist<span class="w"> </span>myotherlist<span class="w"> </span><span class="c1"># ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå°†å®ƒç§»åŠ¨åˆ°æ–°çš„åˆ—è¡¨ä¸­</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="s2">"hello1"</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>mylist<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello2"</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>myotherlist<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello1"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"v3"</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"v2"</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"v1"</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lset<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>vv<span class="w"> </span><span class="c1"># æ›¿æ¢æ‰æŒ‡å®šä¸‹æ ‡çš„å€¼ï¼Œlist å’Œ index éƒ½å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™æŠ¥é”™</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>OK
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"vv"</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"v2"</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"v1"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>rpush<span class="w"> </span>list<span class="w"> </span>hello
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>rpush<span class="w"> </span>list<span class="w"> </span>world
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">2</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello"</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"world"</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>linsert<span class="w"> </span>list<span class="w"> </span>before<span class="w"> </span><span class="s1">'world'</span><span class="w"> </span>my<span class="w"> </span><span class="c1"># åœ¨æŸä¸ªå…ƒç´  ä¹‹å‰/ä¹‹å æ’å…¥æ–°çš„å…ƒç´ </span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">3</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>lrange<span class="w"> </span>list<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello"</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"my"</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"world"</span>
</span></code></pre></div> <h3 id="33seté›†åˆ">3.3ã€Setï¼ˆé›†åˆï¼‰<a class="headerlink" href="#33seté›†åˆ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Redis set æ˜¯ string ç±»å‹çš„æ— åºé›†åˆã€‚é›†åˆæ˜¯é€šè¿‡ intset å’Œ hashtable å®ç°çš„ï¼Œæ¦‚å¿µå’Œæ•°å­¦ä¸­ä¸ªçš„é›†åˆåŸºæœ¬ç±»ä¼¼ï¼Œå¯ä»¥äº¤é›†ï¼Œå¹¶é›†ï¼Œå·®é›†ç­‰ç­‰ï¼Œset ä¸­çš„å…ƒç´ æ˜¯æ²¡æœ‰é¡ºåºçš„ã€‚æ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚</p> <p>å¸¸ç”¨å‘½ä»¤ï¼š<code>sadd</code>ï¼Œ<code>spop</code>ï¼Œ<code>smembers</code>ï¼Œ<code>sunion</code> ç­‰ã€‚</p> <p>åº”ç”¨åœºæ™¯ï¼šRedis set å¯¹å¤–æä¾›çš„åŠŸèƒ½ä¸ list ç±»ä¼¼æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„åŠŸèƒ½ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äº set æ˜¯å¯ä»¥è‡ªåŠ¨æ’é‡çš„ï¼Œå½“éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œset æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸” set æä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ª set é›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ list æ‰€ä¸èƒ½æä¾›çš„ã€‚</p> <p>æ¡ˆä¾‹ï¼šåœ¨å¾®åšä¸­ï¼Œå¯ä»¥å°†ä¸€ä¸ªç”¨æˆ·æ‰€æœ‰çš„å…³æ³¨äººå­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œå°†å…¶æ‰€æœ‰ç²‰ä¸å­˜åœ¨ä¸€ä¸ªé›†åˆã€‚Redisè¿˜ä¸ºé›†åˆæä¾›äº†æ±‚äº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰æ“ä½œï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°å¦‚å…±åŒå…³æ³¨ã€å…±åŒå–œå¥½ã€äºŒåº¦å¥½å‹ç­‰åŠŸèƒ½ï¼Œå¯¹ä¸Šé¢çš„æ‰€æœ‰é›†åˆæ“ä½œï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸åŒçš„å‘½ä»¤é€‰æ‹©å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯è¿˜æ˜¯å­˜é›†åˆ°ä¸€ä¸ªæ–°çš„é›†åˆä¸­ã€‚</p> <p>é›†åˆä¸­æœ€å¤§çš„æˆå‘˜æ•°ä¸º 2<sup>32</sup> - 1(4294967295, æ¯ä¸ªé›†åˆå¯å­˜å‚¨40å¤šäº¿ä¸ªæˆå‘˜)ã€‚</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sadd<span class="w"> </span>myset<span class="w"> </span>hello<span class="w"> </span><span class="c1"># é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼ŒæˆåŠŸè¿”å›1ï¼Œå¦‚æœå…ƒç´ å·²ç»åœ¨é›†åˆä¸­è¿”å› 0ï¼Œå¦‚æœ key å¯¹åº”çš„ set ä¸å­˜åœ¨åˆ™è¿”å›é”™è¯¯</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sadd<span class="w"> </span>myset<span class="w"> </span>orichalcos
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sadd<span class="w"> </span>myset<span class="w"> </span>hello_orichalcos
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>smembers<span class="w"> </span>myset<span class="w"> </span><span class="c1"># æŸ¥çœ‹æŒ‡å®š set çš„æ‰€æœ‰å€¼</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello_orichalcos"</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"orichalcos"</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello"</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sismember<span class="w"> </span>myset<span class="w"> </span>hello<span class="w"> </span><span class="c1"># åˆ¤æ–­æŸä¸€ä¸ªå€¼æ˜¯ä¸æ˜¯åœ¨ set é›†åˆä¸­</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sismember<span class="w"> </span>myset<span class="w"> </span>hell
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>scard<span class="w"> </span>myset<span class="w"> </span><span class="c1"># è·å– set é›†åˆä¸­çš„å†…å®¹å…ƒç´ ä¸ªæ•°</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">3</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>smembers<span class="w"> </span>myset
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello_orichalcos"</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"orichalcos"</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"hei"</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>srem<span class="w"> </span>myset<span class="w"> </span>hei<span class="w"> </span><span class="c1"># ç§»é™¤ set é›†åˆä¸­çš„æŒ‡å®šå…ƒç´ </span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>smembers<span class="w"> </span>myset
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello_orichalcos"</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"orichalcos"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>srandmember<span class="w"> </span>myset<span class="w"> </span><span class="c1"># éšæœºæŠ½å‡ºä¸€ä¸ªå…ƒç´ </span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="s2">"hello_orichalcos"</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>srandmember<span class="w"> </span>myset
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="s2">"hello_world"</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>srandmember<span class="w"> </span>myset<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="c1"># éšæœºæŠ½å‡ºæŒ‡å®šä¸ªæ•°çš„å…ƒç´ </span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello_world"</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sadd<span class="w"> </span>mylist<span class="w"> </span>hello
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sadd<span class="w"> </span>mylist<span class="w"> </span>world
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sadd<span class="w"> </span>mylist<span class="w"> </span>orichalcos
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>spop<span class="w"> </span>mylist<span class="w"> </span><span class="c1"># éšæœºåˆ é™¤ä¸€ä¸ªå…ƒç´ </span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="s2">"orichalcos"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>smembers<span class="w"> </span>mylist
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"orichalcos"</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"world"</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello"</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>smove<span class="w"> </span>mylist<span class="w"> </span>myset<span class="w"> </span>orichalcos<span class="w"> </span><span class="c1"># å°†ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œç§»åŠ¨åˆ°å¦ä¸€ä¸ª set é›†åˆä¸­</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>smembers<span class="w"> </span>myset
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"orichalcos"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1">## å¯ä»¥ç”¨äºå…±åŒå…³æ³¨ï¼Œå…±åŒçˆ±å¥½ï¼Œæ¨èå¥½å‹</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sadd<span class="w"> </span>key1<span class="w"> </span>a<span class="w"> </span>b<span class="w"> </span>c
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">3</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sadd<span class="w"> </span>key2<span class="w"> </span>c<span class="w"> </span>d<span class="w"> </span>e
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">3</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sdiff<span class="w"> </span>key1<span class="w"> </span>key2<span class="w"> </span><span class="c1"># å·®é›†</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"b"</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"a"</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sinter<span class="w"> </span>key1<span class="w"> </span>key2<span class="w"> </span><span class="c1"># äº¤é›†</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"c"</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>sunion<span class="w"> </span>key1<span class="w"> </span>key2<span class="w"> </span><span class="c1"># å¹¶é›†</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"b"</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"c"</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"d"</span>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="s2">"a"</span>
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="m">5</span><span class="o">)</span><span class="w"> </span><span class="s2">"e"</span>
</span></code></pre></div> <h3 id="34hashå“ˆå¸Œ">3.4ã€Hashï¼ˆå“ˆå¸Œï¼‰<a class="headerlink" href="#34hashå“ˆå¸Œ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Redis hash æ˜¯ä¸€ä¸ªé”®å€¼ (key =&gt; value) å¯¹é›†åˆã€‚Redis hash æ˜¯ä¸€ä¸ª string ç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œhash ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</p> <p>å¸¸ç”¨å‘½ä»¤ï¼š<code>hget</code>ï¼Œ<code>hset</code>ï¼Œ<code>hgetall</code> ç­‰ã€‚</p> <p>ä½¿ç”¨åœºæ™¯ï¼šå­˜å‚¨éƒ¨åˆ†å˜æ›´æ•°æ®ï¼Œå¦‚ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚æ¯ä¸ª hash å¯ä»¥å­˜å‚¨ 2<sup>32</sup> -1 é”®å€¼å¯¹ï¼ˆ40å¤šäº¿ï¼‰ã€‚</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hset<span class="w"> </span>myhash<span class="w"> </span>field1<span class="w"> </span>orichalcos<span class="w"> </span><span class="c1"># set ä¸€ä¸ªå…·ä½“ key-value</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hget<span class="w"> </span>myhash<span class="w"> </span>field1<span class="w"> </span><span class="c1"># è·å–ä¸€ä¸ªå­—æ®µå€¼</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="s2">"orichalcos"</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hmset<span class="w"> </span>myhash<span class="w"> </span>field2<span class="w"> </span>hello<span class="w"> </span>field3<span class="w"> </span>world<span class="w"> </span><span class="c1"># set å¤šä¸ª key-value</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>OK
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hmget<span class="w"> </span>myhash<span class="w"> </span>field2<span class="w"> </span>field3<span class="w"> </span><span class="c1"># è·å–å¤šä¸ªå­—æ®µå€¼</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello"</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"world"</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hgetall<span class="w"> </span>myhash<span class="w"> </span><span class="c1"># è·å–å…¨éƒ¨çš„æ•°æ®</span>
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"field1"</span>
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"orichalcos"</span>
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"field2"</span>
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello"</span>
</span><span id="__span-56-15"><a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a><span class="m">5</span><span class="o">)</span><span class="w"> </span><span class="s2">"field3"</span>
</span><span id="__span-56-16"><a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a><span class="m">6</span><span class="o">)</span><span class="w"> </span><span class="s2">"world"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hdel<span class="w"> </span>myhash<span class="w"> </span>field1<span class="w"> </span><span class="c1"># åˆ é™¤ hash æŒ‡å®š key å­—æ®µï¼Œvalue ä¹Ÿä¼šæ¶ˆå¤±</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hgetall<span class="w"> </span>myhash<span class="w"> </span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"field2"</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello"</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"field3"</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="s2">"world"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hgetall<span class="w"> </span>myhash
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"field2"</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello"</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"field3"</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="s2">"world"</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hlen<span class="w"> </span>myhash<span class="w"> </span><span class="c1"># è·å– hash è¡¨çš„å­—æ®µæ•°é‡</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">2</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hexists<span class="w"> </span>myhash<span class="w"> </span>field1<span class="w"> </span><span class="c1"># åˆ¤æ–­ hash ä¸­æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hexists<span class="w"> </span>myhash<span class="w"> </span>field2
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hkeys<span class="w"> </span>myhash<span class="w"> </span><span class="c1"># è·å–æ‰€æœ‰çš„ field</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"field2"</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"field3"</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hvals<span class="w"> </span>myhash<span class="w"> </span><span class="c1"># è·å–æ‰€æœ‰çš„ value</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hello"</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"world"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hset<span class="w"> </span>myash<span class="w"> </span>field4<span class="w"> </span><span class="m">5</span><span class="w"> </span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hget<span class="w"> </span>myash<span class="w"> </span>field4
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="s2">"5"</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hincrby<span class="w"> </span>myash<span class="w"> </span>field4<span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># æŒ‡å®šå¢é‡</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hsetnx<span class="w"> </span>myhash<span class="w"> </span>field4<span class="w"> </span>hello<span class="w"> </span><span class="c1"># å¦‚æœä¸å­˜åœ¨åˆ™å¯ä»¥è®¾ç½®</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>hsetnx<span class="w"> </span>myhash<span class="w"> </span>field4<span class="w"> </span>hello
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span></code></pre></div> <p>â€‹ </p> <h3 id="35zsetæœ‰åºé›†åˆ">3.5ã€Zsetï¼ˆæœ‰åºé›†åˆï¼‰<a class="headerlink" href="#35zsetæœ‰åºé›†åˆ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Redis zset å’Œ set ä¸€æ ·ä¹Ÿæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆ,ä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚</p> <p>å¸¸ç”¨å‘½ä»¤ï¼š<code>zadd</code>ï¼Œ<code>zrange</code>ï¼Œ<code>zrem</code>ï¼Œ<code>zcard</code> ç­‰</p> <p>ä½¿ç”¨åœºæ™¯ï¼šRedis sorted set çš„ä½¿ç”¨åœºæ™¯ä¸ set ç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯ set ä¸æ˜¯è‡ªåŠ¨æœ‰åºçš„ï¼Œè€Œ sorted set å¯ä»¥é€šè¿‡ç”¨æˆ·é¢å¤–æä¾›ä¸€ä¸ªä¼˜å…ˆçº§ (score) çš„å‚æ•°æ¥ä¸ºæˆå‘˜æ’åºï¼Œå¹¶ä¸”æ˜¯æ’å…¥æœ‰åºçš„ï¼Œå³è‡ªåŠ¨æ’åºã€‚å½“éœ€è¦ä¸€ä¸ªæœ‰åºçš„å¹¶ä¸”ä¸é‡å¤çš„é›†åˆåˆ—è¡¨ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹© sorted set æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ twitter çš„ public timeline å¯ä»¥ä»¥å‘è¡¨æ—¶é—´ä½œä¸º score æ¥å­˜å‚¨ï¼Œè¿™æ ·è·å–æ—¶å°±æ˜¯è‡ªåŠ¨æŒ‰æ—¶é—´æ’å¥½åºçš„ã€‚å’Œ Set ç›¸æ¯”ï¼ŒSorted Set å…³è”äº†ä¸€ä¸ª double ç±»å‹æƒé‡å‚æ•°scoreï¼Œä½¿å¾—é›†åˆä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰ score è¿›è¡Œæœ‰åºæ’åˆ—ï¼Œredis æ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚zset çš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†åˆ†æ•°(score) å´å¯ä»¥é‡å¤ã€‚æ¯”å¦‚ä¸€ä¸ªå­˜å‚¨å…¨ç­åŒå­¦æˆç»©çš„ Sorted Setï¼Œå…¶é›†åˆ value å¯ä»¥æ˜¯åŒå­¦çš„å­¦å·ï¼Œè€Œ score å°±å¯ä»¥æ˜¯å…¶è€ƒè¯•å¾—åˆ†ï¼Œè¿™æ ·åœ¨æ•°æ®æ’å…¥é›†åˆçš„æ—¶å€™ï¼Œå°±å·²ç»è¿›è¡Œäº†å¤©ç„¶çš„æ’åºã€‚å¦å¤–è¿˜å¯ä»¥ç”¨ Sorted Set æ¥åšå¸¦æƒé‡çš„é˜Ÿåˆ—ï¼Œæ¯”å¦‚æ™®é€šæ¶ˆæ¯çš„ score ä¸º1ï¼Œé‡è¦æ¶ˆæ¯çš„ score ä¸º2ï¼Œç„¶åå·¥ä½œçº¿ç¨‹å¯ä»¥é€‰æ‹©æŒ‰ score çš„å€’åºæ¥è·å–å·¥ä½œä»»åŠ¡ã€‚è®©é‡è¦çš„ä»»åŠ¡ä¼˜å…ˆæ‰§è¡Œã€‚</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zadd<span class="w"> </span>myset<span class="w"> </span><span class="m">1</span><span class="w"> </span>one<span class="w"> </span><span class="c1"># æ·»åŠ ä¸€ä¸ªå€¼</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zadd<span class="w"> </span>myset<span class="w"> </span><span class="m">2</span><span class="w"> </span>two<span class="w"> </span><span class="m">3</span><span class="w"> </span>threee<span class="w"> </span><span class="c1"># æ·»åŠ å¤šä¸ªå€¼</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">2</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zrange<span class="w"> </span>myset<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"one"</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"two"</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"threee"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zadd<span class="w"> </span>salary<span class="w"> </span><span class="m">2500</span><span class="w"> </span>xiaohong<span class="w"> </span><span class="m">2000</span><span class="w"> </span>zhangsan<span class="w"> </span><span class="m">500</span><span class="w"> </span>Orichalcos
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">3</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zrange<span class="w"> </span>salary<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"Orichalcos"</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"zhangsan"</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"xiaohong"</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zrangebyscore<span class="w"> </span>salary<span class="w"> </span>-inf<span class="w"> </span>+inf<span class="w"> </span><span class="c1"># æ˜¾ç¤ºæ‰€æœ‰å€¼ ä»å°åˆ°å¤§</span>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"Orichalcos"</span>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"zhangsan"</span>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"xiaohong"</span>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zrevrangebyscore<span class="w"> </span>salary<span class="w"> </span>+inf<span class="w"> </span>-inf<span class="w"> </span><span class="c1">#æ˜¾ç¤ºæ‰€æœ‰å€¼ ä»å¤§åˆ°å°</span>
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"xiaohong"</span>
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"zhangsan"</span>
</span><span id="__span-63-14"><a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"Orichalcos"</span>
</span><span id="__span-63-15"><a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zrangebyscore<span class="w"> </span>salary<span class="w"> </span>-inf<span class="w"> </span>+inf<span class="w"> </span>withscores<span class="w"> </span><span class="c1"># æ˜¾ç¤ºæ‰€æœ‰ä¿¡æ¯ ä»å°åˆ°å¤§</span>
</span><span id="__span-63-16"><a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"Orichalcos"</span>
</span><span id="__span-63-17"><a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"500"</span>
</span><span id="__span-63-18"><a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"zhangsan"</span>
</span><span id="__span-63-19"><a id="__codelineno-63-19" name="__codelineno-63-19" href="#__codelineno-63-19"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="s2">"2000"</span>
</span><span id="__span-63-20"><a id="__codelineno-63-20" name="__codelineno-63-20" href="#__codelineno-63-20"></a><span class="m">5</span><span class="o">)</span><span class="w"> </span><span class="s2">"xiaohong"</span>
</span><span id="__span-63-21"><a id="__codelineno-63-21" name="__codelineno-63-21" href="#__codelineno-63-21"></a><span class="m">6</span><span class="o">)</span><span class="w"> </span><span class="s2">"2500"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zrange<span class="w"> </span>salary<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"Orichalcos"</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"zhangsan"</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"xiaohong"</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zrem<span class="w"> </span>salary<span class="w"> </span>xiaohong<span class="w"> </span><span class="c1"># åˆ é™¤æŒ‡å®šå…ƒç´ </span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zrange<span class="w"> </span>salary<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"Orichalcos"</span>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"zhangsan"</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zcard<span class="w"> </span>salary<span class="w"> </span><span class="c1"># è·å–æœ‰åºé›†åˆä¸­çš„ä¸ªæ•°</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">2</span>
</span></code></pre></div> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zrange<span class="w"> </span>myset<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"one"</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"two"</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"threee"</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zcount<span class="w"> </span>myset<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="c1"># è·å–æŒ‡å®šåŒºé—´çš„æˆå‘˜æ•°é‡</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">2</span>
</span></code></pre></div> <h2 id="4ä¸‰å¤§ç‰¹æ®Šç±»å‹">4ã€ä¸‰å¤§ç‰¹æ®Šç±»å‹<a class="headerlink" href="#4ä¸‰å¤§ç‰¹æ®Šç±»å‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <h3 id="41geospatialåœ°ç†ä½ç½®">4.1ã€geospatialï¼ˆåœ°ç†ä½ç½®ï¼‰<a class="headerlink" href="#41geospatialåœ°ç†ä½ç½®" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æœ‹å‹çš„å®šä½ï¼Œé™„è¿‘çš„äººï¼Œæ‰“è½¦è·ç¦»çš„è®¡ç®—ï¼Ÿ</p> <p>Reids çš„ Geo åœ¨ Reids 3.2 ç‰ˆæœ¬å°±æ¨å‡ºäº†ï¼è¿™ä¸ªåŠŸèƒ½å¯ä»¥æ¨ç®—åœ°ç†ä½ç½®çš„ä¿¡æ¯ï¼Œä¸¤åœ°ä¹‹é—´çš„è·ç¦»ï¼Œæ–¹åœ†å‡ é‡Œçš„äººã€‚</p> <p>åªæœ‰å…­ä¸ªå‘½ä»¤ï¼š</p> <ul> <li><code>geoadd</code></li> <li><code>geodist</code></li> <li><code>geohash</code></li> <li><code>geopos</code></li> <li><code>georadius</code></li> <li><code>georadiusbymember</code></li> </ul> <p><strong>geoadd</strong></p> <p>æ·»åŠ åœ°ç†ä½ç½®ï¼Œè§„åˆ™ï¼šä¸¤çº§æ— æ³•ç›´æ¥æ·»åŠ ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä¸‹è½½åŸå¸‚æ•°æ®ï¼Œç›´æ¥é€šè¿‡ java ç¨‹åºä¸€æ¬¡æ€§å¯¼å…¥ï¼</p> <p>æœ‰æ•ˆçš„ç»åº¦ä» -180 åº¦åˆ° 180 åº¦ï¼Œæœ‰æ•ˆçš„çº¬åº¦ä» -85.05112878 åº¦åˆ° 85.05112878 åº¦ï¼Œå½“åæ ‡ä½ç½®è¶…å‡ºä¸Šè¯‰æŒ‡å®šèŒƒå›´æ—¶ï¼Œè¯¥å‘½ä»¤å°†ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>geoadd<span class="w"> </span>china:city<span class="w"> </span><span class="m">116</span>.40<span class="w"> </span><span class="m">39</span>.90<span class="w"> </span>beijing
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>geoadd<span class="w"> </span>china:city<span class="w"> </span><span class="m">121</span>.47<span class="w"> </span><span class="m">31</span>.23<span class="w"> </span>shanghai
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>geoadd<span class="w"> </span>china:city<span class="w"> </span><span class="m">106</span>.50<span class="w"> </span><span class="m">29</span>.53<span class="w"> </span>chongqi<span class="w"> </span><span class="m">114</span>.05<span class="w"> </span><span class="m">22</span>.52<span class="w"> </span>shenzhen
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">2</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>geoadd<span class="w"> </span>china:city<span class="w"> </span><span class="m">120</span>.16<span class="w"> </span><span class="m">30</span>.24<span class="w"> </span>hangzhou<span class="w"> </span><span class="m">108</span>.96<span class="w"> </span><span class="m">34</span>.26<span class="w"> </span>xian
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>
</span></code></pre></div> <p><strong>geopos</strong></p> <p>è·å–å½“å‰å®šä½ï¼Œä¸€å®šæ˜¯ä¸€ä¸ªåæ ‡å€¼ã€‚</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>geopos<span class="w"> </span>china:city<span class="w"> </span>beijing
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"116.39999896287918091"</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"39.90000009167092543"</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>geopos<span class="w"> </span>china:city<span class="w"> </span>hangzhou
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"120.1600000262260437"</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"30.2400003229490224"</span>
</span></code></pre></div> <p><strong>geodist</strong></p> <p>ä¸¤äººä¹‹é—´çš„è·ç¦»ã€‚</p> <p>å•ä½ï¼š</p> <ul> <li><strong>m</strong> è¡¨ç¤ºå•ä½ä¸º ç±³ã€‚</li> <li><strong>km</strong> è¡¨ç¤ºå•ä½ä¸º åƒç±³ã€‚</li> <li><strong>mi</strong> è¡¨ç¤ºå•ä½ä¸º è‹±é‡Œã€‚</li> <li><strong>ft</strong> è¡¨ç¤ºå•ä½ä¸º è‹±å°ºã€‚</li> </ul> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>geodist<span class="w"> </span>china:city<span class="w"> </span>beijing<span class="w"> </span>chongqi
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="s2">"1464070.8051"</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>geodist<span class="w"> </span>china:city<span class="w"> </span>beijing<span class="w"> </span>chongqi<span class="w"> </span>km
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="s2">"1464.0708"</span>
</span></code></pre></div> <p><strong>georadius</strong></p> <p>ä»¥ç»™å®šçš„çš„ç»åº¦çº¬åº¦ä¸ºä¸­å¿ƒï¼Œæ‰¾å‡ºæŸä¸€åŠå¾„å†…çš„å…ƒç´ ã€‚</p> <p>æˆ‘é™„è¿‘çš„äººï¼Ÿ</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>georadius<span class="w"> </span>china:city<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span>km<span class="w"> </span><span class="c1"># ä»¥ 100ï¼Œ30 è¿™ä¸ªç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œå¯»æ‰¾ 1000km å†…çš„åŸå¸‚</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"chongqi"</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"xian"</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>georadius<span class="w"> </span>china:city<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span>km<span class="w"> </span>withdist<span class="w"> </span><span class="c1"># æ˜¾ç¤ºåˆ°ä¸­å¿ƒçš„è·ç¦»</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"chongqi"</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"629.6756"</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"xian"</span>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"967.2846"</span>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>georadius<span class="w"> </span>china:city<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span>km<span class="w"> </span>withcoord<span class="w"> </span><span class="c1"># æ˜¾ç¤ºä»–äººçš„å®šä½ä¿¡æ¯</span>
</span><span id="__span-70-10"><a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"chongqi"</span>
</span><span id="__span-70-11"><a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a><span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"106.49999767541885376"</span>
</span><span id="__span-70-12"><a id="__codelineno-70-12" name="__codelineno-70-12" href="#__codelineno-70-12"></a><span class="w">      </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"29.52999957900659211"</span>
</span><span id="__span-70-13"><a id="__codelineno-70-13" name="__codelineno-70-13" href="#__codelineno-70-13"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"xian"</span>
</span><span id="__span-70-14"><a id="__codelineno-70-14" name="__codelineno-70-14" href="#__codelineno-70-14"></a><span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"108.96000176668167114"</span>
</span><span id="__span-70-15"><a id="__codelineno-70-15" name="__codelineno-70-15" href="#__codelineno-70-15"></a><span class="w">      </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"34.25999964418929977"</span>
</span><span id="__span-70-16"><a id="__codelineno-70-16" name="__codelineno-70-16" href="#__codelineno-70-16"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>georadius<span class="w"> </span>china:city<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span>km<span class="w"> </span>withcoord<span class="w"> </span>count<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># ç­›é€‰å‡ºæŒ‡å®šçš„ç»“æœ</span>
</span><span id="__span-70-17"><a id="__codelineno-70-17" name="__codelineno-70-17" href="#__codelineno-70-17"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"chongqi"</span>
</span><span id="__span-70-18"><a id="__codelineno-70-18" name="__codelineno-70-18" href="#__codelineno-70-18"></a><span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"106.49999767541885376"</span>
</span><span id="__span-70-19"><a id="__codelineno-70-19" name="__codelineno-70-19" href="#__codelineno-70-19"></a><span class="w">      </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"29.52999957900659211"</span>
</span></code></pre></div> <p><strong>georadiusbymember</strong></p> <p>æ‰¾å‡ºä½äºæŒ‡å®šå…ƒç´ å‘¨å›´çš„å…¶ä»–å…ƒç´ ã€‚</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>georadiusbymember<span class="w"> </span>china:city<span class="w"> </span>beijing<span class="w"> </span><span class="m">1000</span><span class="w"> </span>km
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"beijing"</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"xian"</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>georadiusbymember<span class="w"> </span>china:city<span class="w"> </span>shanghai<span class="w"> </span><span class="m">1000</span><span class="w"> </span>km
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"hangzhou"</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"shanghai"</span>
</span></code></pre></div> <p><strong>geohash</strong></p> <p>è¯¥å‘½ä»¤å°†è¿”å›11ä¸ªå­—ç¬¦çš„Geohashå­—ç¬¦ä¸²ã€‚</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>geohash<span class="w"> </span>china:city<span class="w"> </span>beijing<span class="w"> </span>chongqi
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"wx4fbxxfke0"</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"wm5xzrybty0"</span>
</span></code></pre></div> <p>GEO åº•å±‚çš„å®ç°åŸç†å…¶å®å°±æ˜¯ Zsetï¼Œå¯ä»¥ä½¿ç”¨ Zset å‘½ä»¤æ¥æ“ä½œ geoã€‚</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zrange<span class="w"> </span>china:city<span class="w"> </span><span class="m">0</span><span class="w"> </span>-1
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"chongqi"</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"xian"</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"shenzhen"</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="s2">"hangzhou"</span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="m">5</span><span class="o">)</span><span class="w"> </span><span class="s2">"shanghai"</span>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="m">6</span><span class="o">)</span><span class="w"> </span><span class="s2">"beijing"</span>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>zrem<span class="w"> </span>china:city<span class="w"> </span>xian
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span></code></pre></div> <h3 id="42hyperloglog">4.2ã€hyperloglog<a class="headerlink" href="#42hyperloglog" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>Redis Hyperloglog åŸºæ•°ç»Ÿè®¡ç®—æ³•ã€‚</p> <p>ä¼˜ç‚¹ï¼šå ç”¨å†…å­˜æ˜¯å›ºå®šçš„ï¼Œ2<sup>64</sup> ä¸åŒçš„å…ƒç´ çš„åªéœ€è¦ 12KB çš„å†…å­˜ï¼Œå¦‚æœåªè¦ä»å†…å­˜è§’åº¦æ¥æ¯”è¾ƒçš„è¯ Hyperloglog é¦–é€‰ã€‚</p> <p>ä¼ ç»Ÿçš„æ–¹å¼ï¼Œset ä¿å­˜ç”¨æˆ·çš„ idï¼Œç„¶åå°±å¯ä»¥ç»Ÿè®¡ set ä¸­çš„å…ƒç´ çš„æ•°é‡ä½œä¸ºæ ‡å‡†åˆ¤æ–­ï¼è¿™ä¸ªæ–¹å¼å¦‚æœä¿å­˜å¤§é‡çš„ç”¨æˆ· idï¼Œå°±ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºç›®çš„æ˜¯ä¸ºäº†è®¡æ•°ï¼Œè€Œä¸æ˜¯ä¿å­˜ç”¨æˆ· idï¼›å¹¶ä¸”å…·æœ‰ 0.81% çš„é”™è¯¯ç‡ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç”¨äº UV ä»»åŠ¡ï¼Œè¿™ä¸ªå¯ä»¥å¿½ç•¥ä¸è®°ã€‚</p> <blockquote> <p><strong>UVï¼ˆUnique visitorï¼‰</strong> æ˜¯æŒ‡é€šè¿‡äº’è”ç½‘è®¿é—®ã€æµè§ˆè¿™ä¸ªç½‘é¡µçš„è‡ªç„¶äººã€‚è®¿é—®æ‚¨ç½‘ç«™çš„ä¸€å°ç”µè„‘å®¢æˆ·ç«¯ä¸ºä¸€ä¸ªè®¿å®¢ã€‚00:00-24:00å†…ç›¸åŒçš„å®¢æˆ·ç«¯åªè¢«è®¡ç®—ä¸€æ¬¡ã€‚</p> <p>ä¸€å¤©å†…åŒä¸ªè®¿å®¢å¤šæ¬¡è®¿é—®ä»…è®¡ç®—ä¸€ä¸ªUVã€‚</p> <p><strong>IPï¼ˆInternet Protocolï¼‰</strong> ç‹¬ç«‹IPæ˜¯æŒ‡è®¿é—®è¿‡æŸç«™ç‚¹çš„IPæ€»æ•°ï¼Œä»¥ç”¨æˆ·çš„IPåœ°å€ä½œä¸ºç»Ÿè®¡ä¾æ®ã€‚00:00-24:00å†…ç›¸åŒIPåœ°å€ä¹‹è¢«è®¡ç®—ä¸€æ¬¡ã€‚</p> <p><strong>UVä¸IPåŒºåˆ«ï¼š</strong> å¦‚ï¼šä½ å’Œä½ çš„å®¶äººç”¨å„è‡ªçš„è´¦å·åœ¨åŒä¸€å°ç”µè„‘ä¸Šç™»å½•æ–°æµªå¾®åšï¼Œåˆ™IPæ•°+1ï¼ŒUVæ•°+2ã€‚ç”±äºä½¿ç”¨çš„æ˜¯åŒä¸€å°ç”µè„‘ï¼Œæ‰€ä»¥IPä¸å˜ï¼Œä½†ä½¿ç”¨çš„ä¸åŒè´¦å·ï¼Œæ‰€ä»¥UV+2</p> <p><strong>PVï¼ˆPage Viewï¼‰</strong> å³é¡µé¢æµè§ˆé‡æˆ–ç‚¹å‡»é‡ï¼Œç”¨æˆ·æ¯1æ¬¡å¯¹ç½‘ç«™ä¸­çš„æ¯ä¸ªç½‘é¡µè®¿é—®å‡è¢«è®°å½•1ä¸ªPVã€‚ç”¨æˆ·å¯¹åŒä¸€é¡µé¢çš„å¤šæ¬¡è®¿é—®ï¼Œè®¿é—®é‡ç´¯è®¡ï¼Œç”¨ä»¥è¡¡é‡ç½‘ç«™ç”¨æˆ·è®¿é—®çš„ç½‘é¡µæ•°é‡ã€‚</p> <p><strong>VVï¼ˆVisit Viewï¼‰</strong> ç”¨ä»¥ç»Ÿè®¡æ‰€æœ‰è®¿å®¢1å¤©å†…è®¿é—®ç½‘ç«™çš„æ¬¡æ•°ã€‚å½“è®¿å®¢å®Œæˆæ‰€æœ‰æµè§ˆå¹¶æœ€ç»ˆå…³æ‰è¯¥ç½‘ç«™çš„æ‰€æœ‰é¡µé¢æ—¶ä¾¿å®Œæˆäº†ä¸€æ¬¡è®¿é—®ï¼ŒåŒä¸€è®¿å®¢1å¤©å†…å¯èƒ½æœ‰å¤šæ¬¡è®¿é—®è¡Œä¸ºï¼Œè®¿é—®æ¬¡æ•°ç´¯è®¡ã€‚</p> <p><strong>PVä¸VVåŒºåˆ«ï¼š</strong> å¦‚ï¼šä½ ä»Šå¤©10ç‚¹é’Ÿæ‰“å¼€äº†ç™¾åº¦ï¼Œè®¿é—®äº†å®ƒçš„ä¸‰ä¸ªé¡µé¢ï¼›11ç‚¹é’Ÿåˆæ‰“å¼€äº†ç™¾åº¦ï¼Œè®¿é—®äº†å®ƒçš„ä¸¤ä¸ªé¡µé¢ï¼Œåˆ™PVæ•°+5ï¼ŒVVæ•°+2. PVæ˜¯æŒ‡é¡µé¢çš„æµè§ˆæ¬¡æ•°ï¼ŒVVæ˜¯æŒ‡ä½ è®¿é—®ç½‘ç«™çš„æ¬¡æ•°ã€‚</p> </blockquote> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>pfadd<span class="w"> </span>mykey<span class="w"> </span>a<span class="w"> </span>b<span class="w"> </span>c<span class="w"> </span>d<span class="w"> </span>e<span class="w"> </span>f<span class="w"> </span>g<span class="w"> </span>h<span class="w"> </span>i<span class="w"> </span>j<span class="w"> </span><span class="c1"># åˆ›å»ºç¬¬ä¸€ç»„å…ƒç´  mykey</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>pfcount<span class="w"> </span>mykey<span class="w"> </span><span class="c1"># ç»Ÿè®¡ mykey å…ƒç´ çš„åŸºæ•°æ•°é‡</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">10</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>pfadd<span class="w"> </span>mykey2<span class="w"> </span>i<span class="w"> </span>j<span class="w"> </span>z<span class="w"> </span>x<span class="w"> </span>c<span class="w"> </span>v<span class="w"> </span>b<span class="w"> </span>n<span class="w"> </span>m<span class="w"> </span><span class="c1"># åˆ›å»ºç¬¬äºŒç»„å…ƒç´  mykey2</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>pfcount<span class="w"> </span>mykey2
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">9</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>pfmerge<span class="w"> </span>mykey3<span class="w"> </span>mykey<span class="w"> </span>mykey2<span class="w"> </span><span class="c1"># åˆå¹¶ä¸¤ç»„</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a>OK
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>pfcount<span class="w"> </span>mykey3
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">15</span>
</span></code></pre></div> <h3 id="43bitmap">4.3ã€Bitmap<a class="headerlink" href="#43bitmap" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ç»Ÿè®¡ç”¨æˆ·ä¿¡æ¯ï¼Œæ´»è·ƒ-ä¸æ´»è·ƒï¼›ç™»å½•-æœªç™»å½•ï¼›æ‰“å¡-æœªæ‰“å¡ã€‚è¿™ç§ä¸¤ä¸ªçŠ¶æ€çš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ Bitmapsã€‚</p> <p>Bitmaps ä½å›¾ï¼Œæ•°æ®ç»“æ„ï¼éƒ½æ˜¯æ“ä½œäºŒè¿›åˆ¶ä½æ¥è®°å½•ï¼Œå°±åªæœ‰ 0 å’Œ 1 ä¸¤ä¸ªçŠ¶æ€ï¼</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>setbit<span class="w"> </span>sign<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>setbit<span class="w"> </span>sign<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>setbit<span class="w"> </span>sign<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>setbit<span class="w"> </span>sign<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>setbit<span class="w"> </span>sign<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>setbit<span class="w"> </span>sign<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>setbit<span class="w"> </span>sign<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-15"><a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>getbit<span class="w"> </span>sign<span class="w"> </span><span class="m">3</span>
</span><span id="__span-75-16"><a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-75-17"><a id="__codelineno-75-17" name="__codelineno-75-17" href="#__codelineno-75-17"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>getbit<span class="w"> </span>sign<span class="w"> </span><span class="m">6</span>
</span><span id="__span-75-18"><a id="__codelineno-75-18" name="__codelineno-75-18" href="#__codelineno-75-18"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-19"><a id="__codelineno-75-19" name="__codelineno-75-19" href="#__codelineno-75-19"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>bitcount<span class="w"> </span>sign
</span><span id="__span-75-20"><a id="__codelineno-75-20" name="__codelineno-75-20" href="#__codelineno-75-20"></a><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">3</span>
</span></code></pre></div> <h2 id="5äº‹åŠ¡">5ã€äº‹åŠ¡<a class="headerlink" href="#5äº‹åŠ¡" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>Redis é€šè¿‡ <code>multi</code>ã€ <code>discard</code> ã€<code>exec</code> å’Œ <code>watch</code> å››ä¸ªå‘½ä»¤æ¥å®ç°äº‹åŠ¡åŠŸèƒ½ã€‚</p> <p>äº‹åŠ¡æä¾›äº†ä¸€ç§ â€œå°†å¤šä¸ªå‘½ä»¤æ‰“åŒ…ï¼Œ ç„¶åä¸€æ¬¡æ€§ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œâ€ çš„æœºåˆ¶ï¼Œ å¹¶ä¸”äº‹åŠ¡åœ¨æ‰§è¡Œçš„æœŸé—´ä¸ä¼šä¸»åŠ¨ä¸­æ–­ï¼›æœåŠ¡å™¨åœ¨æ‰§è¡Œå®Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ä¹‹åï¼Œ æ‰ä¼šç»§ç»­å¤„ç†å…¶ä»–å®¢æˆ·ç«¯çš„å…¶ä»–å‘½ä»¤ã€‚</p> <p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„ä¾‹å­ï¼Œ å®ƒå…ˆä»¥ <code>multi</code> å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œ ç„¶åå°†å¤šä¸ªå‘½ä»¤å…¥é˜Ÿåˆ°äº‹åŠ¡ä¸­ï¼Œ æœ€åç”± <code>exec</code> å‘½ä»¤è§¦å‘äº‹åŠ¡ï¼Œ ä¸€å¹¶æ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>redis&gt;<span class="w"> </span>multi
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>OK
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>redis&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>book-name<span class="w"> </span><span class="s2">"Mastering C++ in 21 days"</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>QUEUED
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>redis&gt;<span class="w"> </span>get<span class="w"> </span>book-name
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>QUEUED
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a>
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a>redis&gt;<span class="w"> </span>sadd<span class="w"> </span>tag<span class="w"> </span><span class="s2">"C++"</span><span class="w"> </span><span class="s2">"Programming"</span><span class="w"> </span><span class="s2">"Mastering Series"</span>
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a>QUEUED
</span><span id="__span-76-12"><a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a>
</span><span id="__span-76-13"><a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a>redis&gt;<span class="w"> </span>smembers<span class="w"> </span>tag
</span><span id="__span-76-14"><a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a>QUEUED
</span><span id="__span-76-15"><a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a>
</span><span id="__span-76-16"><a id="__codelineno-76-16" name="__codelineno-76-16" href="#__codelineno-76-16"></a>redis&gt;<span class="w"> </span><span class="nb">exec</span>
</span><span id="__span-76-17"><a id="__codelineno-76-17" name="__codelineno-76-17" href="#__codelineno-76-17"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span>OK
</span><span id="__span-76-18"><a id="__codelineno-76-18" name="__codelineno-76-18" href="#__codelineno-76-18"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"Mastering C++ in 21 days"</span>
</span><span id="__span-76-19"><a id="__codelineno-76-19" name="__codelineno-76-19" href="#__codelineno-76-19"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>integer<span class="o">)</span><span class="w"> </span><span class="m">3</span>
</span><span id="__span-76-20"><a id="__codelineno-76-20" name="__codelineno-76-20" href="#__codelineno-76-20"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">"Mastering Series"</span>
</span><span id="__span-76-21"><a id="__codelineno-76-21" name="__codelineno-76-21" href="#__codelineno-76-21"></a><span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">"C++"</span>
</span><span id="__span-76-22"><a id="__codelineno-76-22" name="__codelineno-76-22" href="#__codelineno-76-22"></a><span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="s2">"Programming"</span>
</span></code></pre></div> <h3 id="51äº‹åŠ¡çš„æµç¨‹">5.1ã€äº‹åŠ¡çš„æµç¨‹<a class="headerlink" href="#51äº‹åŠ¡çš„æµç¨‹" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ä¸€ä¸ªäº‹åŠ¡ä»å¼€å§‹åˆ°æ‰§è¡Œä¼šç»å†ä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼š</p> <ol> <li>å¼€å¯äº‹åŠ¡ï¼ˆ<code>multi</code>ï¼‰</li> <li>å‘½ä»¤å…¥é˜Ÿ</li> <li>æ‰§è¡Œäº‹åŠ¡ï¼ˆ<code>exec</code>ï¼‰</li> </ol> <p><strong>å¼€å¯äº‹åŠ¡</strong></p> <p><code>multi</code> å‘½ä»¤çš„æ‰§è¡Œæ ‡è®°äº‹åŠ¡çš„å¼€å§‹ï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>redis&gt;<span class="w"> </span>multi
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>OK
</span></code></pre></div> <p>è¿™ä¸ªå‘½ä»¤å”¯ä¸€åšçš„å°±æ˜¯ï¼Œ å°†å®¢æˆ·ç«¯çš„ REDIS_MULTI é€‰é¡¹æ‰“å¼€ï¼Œ è®©å®¢æˆ·ç«¯ä»éäº‹åŠ¡çŠ¶æ€åˆ‡æ¢åˆ°äº‹åŠ¡çŠ¶æ€ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-0ff9f2e58803dbb8c1c400e1f8191f77d4c2917e.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-0ff9f2e58803dbb8c1c400e1f8191f77d4c2917e.svg" alt style></a></p> <p>äº‹åŠ¡çŠ¶æ€ä¸‹çš„å‘½ä»¤ä»¥å•ä¸ªå‘½ä»¤ä¸ºå•ä½æ‰§è¡Œï¼Œå‰ä¸€ä¸ªå‘½ä»¤å’Œåä¸€ä¸ªå‘½ä»¤çš„å®¢æˆ·ç«¯ä¸ä¸€å®šæ˜¯åŒä¸€ä¸ªï¼›è€Œäº‹åŠ¡çŠ¶æ€åˆ™æ˜¯ä»¥ä¸€ä¸ªäº‹åŠ¡ä¸ºå•ä½ï¼Œæ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤ï¼šé™¤éå½“å‰äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå¦åˆ™æœåŠ¡å™¨ä¸ä¼šä¸­æ–­äº‹åŠ¡ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œå…¶ä»–å®¢æˆ·ç«¯çš„å…¶ä»–å‘½ä»¤ã€‚</p> <p><strong>å‘½ä»¤å…¥é˜Ÿ</strong></p> <p>å½“å®¢æˆ·ç«¯å¤„äºéäº‹åŠ¡çŠ¶æ€ä¸‹æ—¶ï¼Œ æ‰€æœ‰å‘é€ç»™æœåŠ¡å™¨ç«¯çš„å‘½ä»¤éƒ½ä¼šç«‹å³è¢«æœåŠ¡å™¨æ‰§è¡Œï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>redis&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>msg<span class="w"> </span><span class="s2">"hello moto"</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>OK
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>redis&gt;<span class="w"> </span>get<span class="w"> </span>msg
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="s2">"hello moto"</span>
</span></code></pre></div> <p>ä½†æ˜¯ï¼Œ å½“å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹åï¼Œ æœåŠ¡å™¨åœ¨æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤æ—¶ï¼Œ ä¸ä¼šç«‹å³æ‰§è¡Œå‘½ä»¤ï¼Œ è€Œæ˜¯å°†è¿™äº›å‘½ä»¤å…¨éƒ¨æ”¾è¿›ä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—é‡Œï¼Œ ç„¶åè¿”å› QUEUED ï¼Œ è¡¨ç¤ºå‘½ä»¤å·²å…¥é˜Ÿï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>redis&gt;<span class="w"> </span>multi
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>OK
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>redis&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>msg<span class="w"> </span><span class="s2">"hello moto"</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a>QUEUED
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a>redis&gt;<span class="w"> </span>get<span class="w"> </span>msg
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a>QUEUED
</span></code></pre></div> <p>ä»¥ä¸‹æµç¨‹å›¾å±•ç¤ºäº†è¿™ä¸€è¡Œä¸ºï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-8a0f8eae0bb8180e877b799921dd690267c2d3b4.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-8a0f8eae0bb8180e877b799921dd690267c2d3b4.svg" alt style></a></p> <p>äº‹åŠ¡é˜Ÿåˆ—æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ æ¯ä¸ªæ•°ç»„é¡¹æ˜¯éƒ½åŒ…å«ä¸‰ä¸ªå±æ€§ï¼š</p> <ul> <li>è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆcmdï¼‰</li> <li>å‘½ä»¤çš„å‚æ•°ï¼ˆargvï¼‰</li> <li>å‚æ•°çš„ä¸ªæ•°ï¼ˆargcï¼‰</li> </ul> <p>ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æœå®¢æˆ·ç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>redis&gt;<span class="w"> </span>multi
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>OK
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>redis&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>book-name<span class="w"> </span><span class="s2">"Mastering C++ in 21 days"</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>QUEUED
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>redis&gt;<span class="w"> </span>get<span class="w"> </span>book-name
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a>QUEUED
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a>
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a>redis&gt;<span class="w"> </span>sadd<span class="w"> </span>tag<span class="w"> </span><span class="s2">"C++"</span><span class="w"> </span><span class="s2">"Programming"</span><span class="w"> </span><span class="s2">"Mastering Series"</span>
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a>QUEUED
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a>
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a>redis&gt;<span class="w"> </span>smembers<span class="w"> </span>tag
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a>QUEUED
</span></code></pre></div> <p>é‚£ä¹ˆç¨‹åºå°†ä¸ºå®¢æˆ·ç«¯åˆ›å»ºä»¥ä¸‹äº‹åŠ¡é˜Ÿåˆ—ï¼š</p> <table> <thead> <tr> <th>æ•°ç»„ç´¢å¼•</th> <th>cmd</th> <th>argv</th> <th>argc</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>set</td> <td>["book-name", "Mastering C++ in 21 days"]</td> <td>2</td> </tr> <tr> <td>1</td> <td>get</td> <td>["book-name"]</td> <td>1</td> </tr> <tr> <td>2</td> <td>sadd</td> <td>["tag", "C++", "Programming", "Mastering Series"]</td> <td>4</td> </tr> <tr> <td>3</td> <td>smembets</td> <td>["tag"]</td> <td>1</td> </tr> </tbody> </table> <blockquote> <p>Redis çš„äº‹åŠ¡æ˜¯ä¸å¯åµŒå¥—çš„ï¼Œ å½“å®¢æˆ·ç«¯å·²ç»å¤„äºäº‹åŠ¡çŠ¶æ€ï¼Œ è€Œå®¢æˆ·ç«¯åˆå†å‘æœåŠ¡å™¨å‘é€ <code>multi</code> æ—¶ï¼Œ æœåŠ¡å™¨åªæ˜¯ç®€å•åœ°å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé”™è¯¯ï¼Œ ç„¶åç»§ç»­ç­‰å¾…å…¶ä»–å‘½ä»¤çš„å…¥é˜Ÿã€‚ <code>multi</code> å‘½ä»¤çš„å‘é€ä¸ä¼šé€ æˆæ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œ ä¹Ÿä¸ä¼šä¿®æ”¹äº‹åŠ¡é˜Ÿåˆ—ä¸­å·²æœ‰çš„æ•°æ®ã€‚</p> </blockquote> <p><strong>æ‰§è¡Œäº‹åŠ¡</strong></p> <p>å½“å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹åï¼Œ å®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤å°±ä¼šè¢«æ”¾è¿›äº‹åŠ¡é˜Ÿåˆ—é‡Œï¼Œä½†å…¶å®å¹¶ä¸æ˜¯æ‰€æœ‰çš„å‘½ä»¤éƒ½ä¼šè¢«æ”¾è¿›äº‹åŠ¡é˜Ÿåˆ—ï¼Œ å…¶ä¸­çš„ä¾‹å¤–å°±æ˜¯ <code>exec</code>ã€ <code>discard</code>ã€ <code>multi</code> å’Œ <code>watch</code> è¿™å››ä¸ªå‘½ä»¤ï¼›å½“è¿™å››ä¸ªå‘½ä»¤ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œ å®ƒä»¬ä¼šåƒå®¢æˆ·ç«¯å¤„äºéäº‹åŠ¡çŠ¶æ€ä¸€æ ·ï¼Œ ç›´æ¥è¢«æœåŠ¡å™¨æ‰§è¡Œï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-836c8a3dc33526a649d9ecf5b7b959d72b38cc7d.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-836c8a3dc33526a649d9ecf5b7b959d72b38cc7d.svg" alt style></a></p> <p>å¦‚æœå®¢æˆ·ç«¯æ­£å¤„äºäº‹åŠ¡çŠ¶æ€ï¼Œ é‚£ä¹ˆå½“ <code>exec</code> å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œ æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯æ‰€ä¿å­˜çš„äº‹åŠ¡é˜Ÿåˆ—ï¼Œ ä»¥å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„æ–¹å¼æ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼š æœ€å…ˆå…¥é˜Ÿçš„å‘½ä»¤æœ€å…ˆæ‰§è¡Œï¼Œ è€Œæœ€åå…¥é˜Ÿçš„å‘½ä»¤æœ€åæ‰§è¡Œã€‚</p> <p>æ¯”å¦‚è¯´ï¼Œå¯¹äºä»¥ä¸‹äº‹åŠ¡é˜Ÿåˆ—ï¼š</p> <table> <thead> <tr> <th>æ•°ç»„ç´¢å¼•</th> <th>cmd</th> <th>argv</th> <th>argc</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>set</td> <td>["book-name", "Mastering C++ in 21 days"]</td> <td>2</td> </tr> <tr> <td>1</td> <td>get</td> <td>["book-name"]</td> <td>1</td> </tr> <tr> <td>2</td> <td>sadd</td> <td>["tag", "C++", "Programming", "Mastering Series"]</td> <td>4</td> </tr> <tr> <td>3</td> <td>smembets</td> <td>["tag"]</td> <td>1</td> </tr> </tbody> </table> <p>ç¨‹åºä¼šé¦–å…ˆæ‰§è¡Œ <code>set</code> å‘½ä»¤ï¼Œ ç„¶åæ‰§è¡Œ <code>get</code> å‘½ä»¤ï¼Œ å†ç„¶åæ‰§è¡Œ <code>sadd</code> å‘½ä»¤ï¼Œ æœ€åæ‰§è¡Œ <code>smembers</code> å‘½ä»¤ï¼Œæ‰§è¡Œäº‹åŠ¡ä¸­çš„å‘½ä»¤æ‰€å¾—çš„ç»“æœä¼šä»¥ FIFO çš„é¡ºåºä¿å­˜åˆ°ä¸€ä¸ªå›å¤é˜Ÿåˆ—ä¸­ã€‚</p> <p>æ¯”å¦‚è¯´ï¼Œå¯¹äºä¸Šé¢ç»™å‡ºçš„äº‹åŠ¡é˜Ÿåˆ—ï¼Œç¨‹åºå°†ä¸ºé˜Ÿåˆ—ä¸­çš„å‘½ä»¤åˆ›å»ºå¦‚ä¸‹å›å¤é˜Ÿåˆ—ï¼š</p> <table> <thead> <tr> <th>æ•°ç»„ç´¢å¼•</th> <th>å›å¤ç±»å‹</th> <th>å›å¤å†…å®¹</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>status code reply</td> <td>OK</td> </tr> <tr> <td>1</td> <td>bulk reply</td> <td>"Mastering C++ in 21 days"</td> </tr> <tr> <td>2</td> <td>integer reply</td> <td>3</td> </tr> <tr> <td>3</td> <td>multi-bulk reply</td> <td>["Mastering Series", "C++", "Programming"]</td> </tr> </tbody> </table> <p>å½“äº‹åŠ¡é˜Ÿåˆ—é‡Œçš„æ‰€æœ‰å‘½ä»¤è¢«æ‰§è¡Œå®Œä¹‹åï¼Œ <code>exec</code> å‘½ä»¤ä¼šå°†å›å¤é˜Ÿåˆ—ä½œä¸ºè‡ªå·±çš„æ‰§è¡Œç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œ å®¢æˆ·ç«¯ä»äº‹åŠ¡çŠ¶æ€è¿”å›åˆ°éäº‹åŠ¡çŠ¶æ€ï¼Œ è‡³æ­¤ï¼Œ äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</p> <blockquote> <p><code>discard</code> å‘½ä»¤ç”¨äºå–æ¶ˆä¸€ä¸ªäº‹åŠ¡ï¼Œ å®ƒæ¸…ç©ºå®¢æˆ·ç«¯çš„æ•´ä¸ªäº‹åŠ¡é˜Ÿåˆ—ï¼Œ ç„¶åå°†å®¢æˆ·ç«¯ä»äº‹åŠ¡çŠ¶æ€è°ƒæ•´å›éäº‹åŠ¡çŠ¶æ€ï¼Œ æœ€åè¿”å›å­—ç¬¦ä¸² OK ç»™å®¢æˆ·ç«¯ï¼Œ è¯´æ˜äº‹åŠ¡å·²è¢«å–æ¶ˆã€‚</p> </blockquote> <h3 id="52watch">5.2ã€watch<a class="headerlink" href="#52watch" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><code>watch</code> å‘½ä»¤ç”¨äºåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰ç›‘è§†ä»»æ„æ•°é‡çš„é”®ï¼š å½“è°ƒç”¨ <code>exec</code> å‘½ä»¤æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œ å¦‚æœä»»æ„ä¸€ä¸ªè¢«ç›‘è§†çš„é”®å·²ç»è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹äº†ï¼Œ é‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡ä¸å†æ‰§è¡Œï¼Œ ç›´æ¥è¿”å›å¤±è´¥ã€‚</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>redis&gt;<span class="w"> </span>watch<span class="w"> </span>name
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>OK
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>redis&gt;<span class="w"> </span>multi
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>OK
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>redis&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>name<span class="w"> </span>peter
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a>QUEUED
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a>
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a>redis&gt;<span class="w"> </span><span class="nb">exec</span>
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="o">(</span>nil<span class="o">)</span>
</span></code></pre></div> <p>ä»¥ä¸‹æ‰§è¡Œåºåˆ—å±•ç¤ºäº†ä¸Šé¢çš„ä¾‹å­æ˜¯å¦‚ä½•å¤±è´¥çš„ï¼š</p> <table> <thead> <tr> <th>æ—¶é—´</th> <th>å®¢æˆ·ç«¯ A</th> <th>å®¢æˆ·ç«¯ B</th> </tr> </thead> <tbody> <tr> <td>T1</td> <td>watch name</td> <td></td> </tr> <tr> <td>T2</td> <td>multi</td> <td></td> </tr> <tr> <td>T3</td> <td>set name peter</td> <td></td> </tr> <tr> <td>T4</td> <td></td> <td>set name john</td> </tr> <tr> <td>T5</td> <td>exec</td> <td></td> </tr> </tbody> </table> <p>åœ¨æ—¶é—´ T4 ï¼Œå®¢æˆ·ç«¯ B ä¿®æ”¹äº† name é”®çš„å€¼ï¼Œ å½“å®¢æˆ·ç«¯ A åœ¨ T5 æ‰§è¡Œ <code>exec</code> æ—¶ï¼ŒRedis ä¼šå‘ç° name è¿™ä¸ªè¢«ç›‘è§†çš„é”®å·²ç»è¢«ä¿®æ”¹ï¼Œ å› æ­¤å®¢æˆ·ç«¯ A çš„äº‹åŠ¡ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œæ˜¯ç›´æ¥è¿”å›å¤±è´¥ã€‚</p> <p><strong>watch çš„å®ç°</strong></p> <p>åœ¨æ¯ä¸ªä»£è¡¨æ•°æ®åº“çš„ redis.h/redisDb ç»“æ„ç±»å‹ä¸­ï¼Œ éƒ½ä¿å­˜äº†ä¸€ä¸ª watched_keys å­—å…¸ï¼Œ å­—å…¸çš„é”®æ˜¯è¿™ä¸ªæ•°æ®åº“è¢«ç›‘è§†çš„é”®ï¼Œ è€Œå­—å…¸çš„å€¼åˆ™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œ é“¾è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰ç›‘è§†è¿™ä¸ªé”®çš„å®¢æˆ·ç«¯ã€‚</p> <p>æ¯”å¦‚è¯´ï¼Œä»¥ä¸‹å­—å…¸å°±å±•ç¤ºäº†ä¸€ä¸ª watched_keys å­—å…¸çš„ä¾‹å­ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-9aea81f33da1373550c590eb0b7ca0c2b3d38366.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-9aea81f33da1373550c590eb0b7ca0c2b3d38366.svg" alt style></a></p> <p>å…¶ä¸­ï¼Œ é”® key1 æ­£åœ¨è¢« client2 ã€ client5 å’Œ client1 ä¸‰ä¸ªå®¢æˆ·ç«¯ç›‘è§†ï¼Œ å…¶ä»–ä¸€äº›é”®ä¹Ÿåˆ†åˆ«è¢«å…¶ä»–åˆ«çš„å®¢æˆ·ç«¯ç›‘è§†ç€ã€‚</p> <p><code>watch</code> å‘½ä»¤çš„ä½œç”¨ï¼Œ å°±æ˜¯å°†å½“å‰å®¢æˆ·ç«¯å’Œè¦ç›‘è§†çš„é”®åœ¨ watched_keys ä¸­è¿›è¡Œå…³è”</p> <p>å¦‚æœå½“å‰å®¢æˆ·ç«¯ä¸º client10086 ï¼Œ é‚£ä¹ˆå½“å®¢æˆ·ç«¯æ‰§è¡Œ <code>watch key1 key2</code> æ—¶ï¼Œ å‰é¢å±•ç¤ºçš„ watched_keys å°†è¢«ä¿®æ”¹æˆè¿™ä¸ªæ ·å­ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-fe5e31054c282a3cdd86656994fe1678a3d4f201.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-fe5e31054c282a3cdd86656994fe1678a3d4f201.svg" alt style></a></p> <p>é€šè¿‡ watched_keys å­—å…¸ï¼Œ å¦‚æœç¨‹åºæƒ³æ£€æŸ¥æŸä¸ªé”®æ˜¯å¦è¢«ç›‘è§†ï¼Œ é‚£ä¹ˆå®ƒåªè¦æ£€æŸ¥å­—å…¸ä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸ªé”®å³å¯ï¼› å¦‚æœç¨‹åºè¦è·å–ç›‘è§†æŸä¸ªé”®çš„æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œ é‚£ä¹ˆåªè¦å–å‡ºé”®çš„å€¼ï¼ˆä¸€ä¸ªé“¾è¡¨ï¼‰ï¼Œ ç„¶åå¯¹é“¾è¡¨è¿›è¡Œéå†å³å¯ã€‚</p> <p><strong>watch çš„è§¦å‘</strong></p> <p>åœ¨ä»»ä½•å¯¹æ•°æ®åº“é”®ç©ºé—´ï¼ˆkey spaceï¼‰è¿›è¡Œä¿®æ”¹çš„å‘½ä»¤æˆåŠŸæ‰§è¡Œä¹‹å ï¼ˆæ¯”å¦‚ <code>flushdb</code>ã€ <code>set</code>ã€ <code>del</code>ã€ <code>lpush</code>ã€ <code>sadd</code>ã€ <code>zrem</code>ï¼Œè¯¸å¦‚æ­¤ç±»ï¼‰ï¼Œ multi.c/touchWatchedKey å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ï¼›å®ƒæ£€æŸ¥æ•°æ®åº“çš„ watched_keys å­—å…¸ï¼Œ çœ‹æ˜¯å¦æœ‰å®¢æˆ·ç«¯åœ¨ç›‘è§†å·²ç»è¢«å‘½ä»¤ä¿®æ”¹çš„é”®ï¼Œ å¦‚æœæœ‰çš„è¯ï¼Œ ç¨‹åºå°†æ‰€æœ‰ç›‘è§† è¿™ä¸ª/è¿™äº› è¢«ä¿®æ”¹é”®çš„å®¢æˆ·ç«¯çš„ REDIS_DIRTY_CAS é€‰é¡¹æ‰“å¼€ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-e5c66122242aa10939b696dfeeb905343c5202bd.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-e5c66122242aa10939b696dfeeb905343c5202bd.svg" alt style></a></p> <p>å½“å®¢æˆ·ç«¯å‘é€ <code>exec</code> å‘½ä»¤ã€è§¦å‘äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œ æœåŠ¡å™¨ä¼šå¯¹å®¢æˆ·ç«¯çš„çŠ¶æ€è¿›è¡Œæ£€æŸ¥ï¼š</p> <ul> <li>å¦‚æœå®¢æˆ·ç«¯çš„ REDIS_DIRTY_CAS é€‰é¡¹å·²ç»è¢«æ‰“å¼€ï¼Œé‚£ä¹ˆè¯´æ˜è¢«å®¢æˆ·ç«¯ç›‘è§†çš„é”®è‡³å°‘æœ‰ä¸€ä¸ªå·²ç»è¢«ä¿®æ”¹äº†ï¼Œäº‹åŠ¡çš„å®‰å…¨æ€§å·²ç»è¢«ç ´åã€‚æœåŠ¡å™¨ä¼šæ”¾å¼ƒæ‰§è¡Œè¿™ä¸ªäº‹åŠ¡ï¼Œç›´æ¥å‘å®¢æˆ·ç«¯è¿”å›ç©ºå›å¤ï¼Œè¡¨ç¤ºäº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚</li> <li>å¦‚æœ REDIS_DIRTY_CAS é€‰é¡¹æ²¡æœ‰è¢«æ‰“å¼€ï¼Œé‚£ä¹ˆè¯´æ˜æ‰€æœ‰ç›‘è§†é”®éƒ½å®‰å…¨ï¼ŒæœåŠ¡å™¨æ­£å¼æ‰§è¡Œäº‹åŠ¡ã€‚</li> </ul> <p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æ•°æ®åº“çš„ watched_keys å­—å…¸å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-9aea81f33da1373550c590eb0b7ca0c2b3d38366.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-9aea81f33da1373550c590eb0b7ca0c2b3d38366.svg" alt style></a></p> <p>å¦‚æœæŸä¸ªå®¢æˆ·ç«¯å¯¹ key1 è¿›è¡Œäº†ä¿®æ”¹ï¼ˆæ¯”å¦‚æ‰§è¡Œ DEL key1 ï¼‰ï¼Œ é‚£ä¹ˆæ‰€æœ‰ç›‘è§† key1 çš„å®¢æˆ·ç«¯ï¼Œ åŒ…æ‹¬ client2 ã€ client5 å’Œ client1 çš„ REDIS_DIRTY_CAS é€‰é¡¹éƒ½ä¼šè¢«æ‰“å¼€ï¼Œ å½“å®¢æˆ·ç«¯ client2 ã€ client5 å’Œ client1 æ‰§è¡Œ <code>exec</code> çš„æ—¶å€™ï¼Œ å®ƒä»¬çš„äº‹åŠ¡éƒ½ä¼šä»¥å¤±è´¥å‘Šç»ˆã€‚</p> <p>æœ€åï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯ç»“æŸå®ƒçš„äº‹åŠ¡æ—¶ï¼Œæ— è®ºäº‹åŠ¡æ˜¯æˆåŠŸæ‰§è¡Œï¼Œè¿˜æ˜¯å¤±è´¥ï¼Œ watched_keys å­—å…¸ä¸­å’Œè¿™ä¸ªå®¢æˆ·ç«¯ç›¸å…³çš„èµ„æ–™éƒ½ä¼šè¢«æ¸…é™¤ã€‚</p> <h3 id="53äº‹åŠ¡é”™è¯¯ä¸å›æ»š">5.3ã€äº‹åŠ¡é”™è¯¯ä¸å›æ»š<a class="headerlink" href="#53äº‹åŠ¡é”™è¯¯ä¸å›æ»š" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>å½“å‘½ä»¤å…¥é˜Ÿæ—¶å°±æŠ¥é”™ï¼Œé‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡ä¸­æ‰€æœ‰çš„å‘½ä»¤éƒ½ä¸ä¼šæ‰§è¡Œï¼š</strong></p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>multi
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>OK
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>k1<span class="w"> </span>v1
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a>QUEUED
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>k2<span class="w"> </span>v2
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a>QUEUED
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>getset<span class="w"> </span>k1
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="o">(</span>error<span class="o">)</span><span class="w"> </span>ERR<span class="w"> </span>wrong<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>arguments<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">'getset'</span><span class="w"> </span><span class="nb">command</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>k3<span class="w"> </span>v3
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a>QUEUED
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">exec</span>
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12" href="#__codelineno-82-12"></a><span class="o">(</span>error<span class="o">)</span><span class="w"> </span>EXECABORT<span class="w"> </span>Transaction<span class="w"> </span>discarded<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>previous<span class="w"> </span>errors.
</span></code></pre></div> <p><strong>å¦‚æœå‘½ä»¤æ‰§è¡Œæ—¶å‡ºé”™ï¼Œä½†æ˜¯å…¥é˜Ÿæ—¶æˆåŠŸï¼Œé‚£ä¹ˆäº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œè¯¥å‘½ä»¤å‡ºé”™ï¼Œä½†æ˜¯å…¶ä»–çš„å‘½ä»¤ä¼šæˆåŠŸæ‰§è¡Œï¼š</strong></p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>multi
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>OK
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>k1<span class="w"> </span><span class="s1">'v1'</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a>QUEUED
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>incr<span class="w"> </span>k1
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a>QUEUED
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>k2<span class="w"> </span>v2
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a>QUEUED
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>get<span class="w"> </span>k1
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a>QUEUED
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">exec</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span>OK
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>error<span class="o">)</span><span class="w"> </span>ERR<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>an<span class="w"> </span>integer<span class="w"> </span>or<span class="w"> </span>out<span class="w"> </span>of<span class="w"> </span>range
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="m">3</span><span class="o">)</span><span class="w"> </span>OK
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="s2">"v1"</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span>get<span class="w"> </span>k1
</span><span id="__span-83-17"><a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a><span class="s2">"v1"</span>
</span></code></pre></div> <p>åœ¨ä¼ ç»Ÿçš„ ACID é‡Œï¼ŒåŸå­æ€§æœ‰ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ ç»Ÿ DB é‡Œé¢è¯´çš„å›æ»šã€‚å½“æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªå¤±è´¥çš„äº‹åŠ¡å¯ä»¥å‘ç°ï¼Œå°±ç®—ä¸­é—´å‡ºç°äº†å¤±è´¥ï¼Œ<code>set k1 'v1'</code> è¿™ä¸ªæ“ä½œä¹Ÿå·²ç»è¢«æ‰§è¡Œäº†ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå›æ»šï¼Œä»ä¸¥æ ¼çš„æ„ä¹‰ä¸Šæ¥è¯´ Redis å¹¶ä¸å…·å¤‡åŸå­æ€§ã€‚</p> <p>å†è°ˆè°ˆéš”ç¦»æ€§ï¼ŒRedis å› ä¸ºæ˜¯å•çº¿ç¨‹æ“ä½œï¼Œæ‰€ä»¥åœ¨éš”ç¦»æ€§ä¸Šæœ‰å¤©ç”Ÿçš„éš”ç¦»æœºåˆ¶ï¼Œå½“ Redis æ‰§è¡Œäº‹åŠ¡æ—¶ï¼ŒRedis çš„æœåŠ¡ç«¯ä¿è¯åœ¨æ‰§è¡Œäº‹åŠ¡æœŸé—´ä¸ä¼šå¯¹äº‹åŠ¡è¿›è¡Œä¸­æ–­ï¼Œæ‰€ä»¥ï¼ŒRedis äº‹åŠ¡æ€»æ˜¯ä»¥ä¸²è¡Œçš„æ–¹å¼è¿è¡Œï¼Œäº‹åŠ¡ä¹Ÿå…·å¤‡éš”ç¦»æ€§ã€‚</p> <p><strong>äº‹åŠ¡å›æ»š</strong></p> <p>Redis ä¸æ”¯æŒäº‹åŠ¡å›æ»šï¼</p> <p>æ ¹æ®å®˜æ–¹æ–‡æ¡£å¤§æ¦‚æ„æ€ï¼Œä½œè€…ä¸æ”¯æŒäº‹åŠ¡å›æ»šçš„åŸå› æœ‰ä»¥ä¸‹ä¸¤ä¸ªï¼š</p> <ul> <li>ä»–è®¤ä¸º Redis äº‹åŠ¡çš„æ‰§è¡Œæ—¶ï¼Œé”™è¯¯é€šå¸¸éƒ½æ˜¯ç¼–ç¨‹é”™è¯¯é€ æˆçš„ï¼Œè¿™ç§é”™è¯¯é€šå¸¸åªä¼šå‡ºç°åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œè€Œå¾ˆå°‘ä¼šåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å‡ºç°ï¼Œæ‰€ä»¥ä»–è®¤ä¸ºæ²¡æœ‰å¿…è¦ä¸º Redis å¼€å‘äº‹åŠ¡å›æ»šåŠŸèƒ½</li> <li>ä¸æ”¯æŒäº‹åŠ¡å›æ»šæ˜¯å› ä¸ºè¿™ç§å¤æ‚çš„åŠŸèƒ½å’Œ Redis è¿½æ±‚çš„ç®€å•é«˜æ•ˆçš„è®¾è®¡ä¸»æ—¨ä¸ç¬¦åˆ</li> </ul> <h2 id="6jedis">6ã€Jedis<a class="headerlink" href="#6jedis" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>ä»€ä¹ˆæ˜¯ Jedis æ˜¯ Redis æ¨èçš„ Java è¿æ¥å¼€å‘å·¥å…·ï¼ä½¿ç”¨ Java æ“ä½œ Redis çš„ä¸­é—´ä»¶ï¼Œå¦‚æœè¦ä½¿ç”¨ Java æ“ä½œ Redisï¼Œé‚£ä¹ˆä¸€å®šè¦å¯¹ Jedis ååˆ†ç†Ÿæ‚‰ã€‚</p> <ol> <li> <p>å¯¼å…¥ç›¸å…³çš„ä¾èµ–</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="cm">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>redis.clients<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>jedis<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>3.3.0<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>fastjson<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>1.2.67<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div> </li> <li> <p>ç¼–ç æµ‹è¯•ï¼š</p> <ul> <li>è¿æ¥æ•°æ®åº“</li> <li>æ“ä½œå‘½ä»¤</li> <li>æ–­å¼€è¿æ¥</li> </ul> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="w">        </span><span class="n">Jedis</span><span class="w"> </span><span class="n">jedis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Jedis</span><span class="p">(</span><span class="s">"120.79.171.55"</span><span class="p">,</span><span class="w"> </span><span class="mi">6379</span><span class="p">);</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">jedis</span><span class="p">.</span><span class="na">ping</span><span class="p">());</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="w">        </span><span class="n">jedis</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="p">}</span>
</span></code></pre></div> <p>è¾“å‡ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>PONG
</span></code></pre></div> </li> </ol> <p>å…¶ä½™çš„ API æ“ä½œå’Œ Reids çš„å‘½ä»¤ä¸€æ ·ã€‚</p> <p><strong>Jedis æ“ä½œäº‹åŠ¡</strong></p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RTransaction</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="w">        </span><span class="n">Jedis</span><span class="w"> </span><span class="n">jedis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Jedis</span><span class="p">(</span><span class="s">"120.79.171.55"</span><span class="p">,</span><span class="w"> </span><span class="mi">6379</span><span class="p">);</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="w">        </span><span class="n">JSONObject</span><span class="w"> </span><span class="n">jsonObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JSONObject</span><span class="p">();</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">        </span><span class="n">jsonObject</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">"hello"</span><span class="p">,</span><span class="w"> </span><span class="s">"world"</span><span class="p">);</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w">        </span><span class="n">jsonObject</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span><span class="w"> </span><span class="s">"Orichalcos"</span><span class="p">);</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jsonObject</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w">        </span><span class="c1">//å¼€å¯äº‹åŠ¡</span>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w">        </span><span class="n">Transaction</span><span class="w"> </span><span class="n">multi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jedis</span><span class="p">.</span><span class="na">multi</span><span class="p">();</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a><span class="w">            </span><span class="n">multi</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="s">"user1"</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">);</span>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a><span class="w">            </span><span class="n">multi</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="s">"user2"</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">);</span>
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a>
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="w">            </span><span class="c1">//æ‰§è¡Œäº‹åŠ¡</span>
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a><span class="w">            </span><span class="n">multi</span><span class="p">.</span><span class="na">exec</span><span class="p">();</span>
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-20"><a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a><span class="w">            </span><span class="c1">//æ”¾å¼ƒäº‹åŠ¡</span>
</span><span id="__span-87-21"><a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a><span class="w">            </span><span class="n">multi</span><span class="p">.</span><span class="na">discard</span><span class="p">();</span>
</span><span id="__span-87-22"><a id="__codelineno-87-22" name="__codelineno-87-22" href="#__codelineno-87-22"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-23"><a id="__codelineno-87-23" name="__codelineno-87-23" href="#__codelineno-87-23"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">jedis</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">"user1"</span><span class="p">));</span>
</span><span id="__span-87-24"><a id="__codelineno-87-24" name="__codelineno-87-24" href="#__codelineno-87-24"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">jedis</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">"user2"</span><span class="p">));</span>
</span><span id="__span-87-25"><a id="__codelineno-87-25" name="__codelineno-87-25" href="#__codelineno-87-25"></a><span class="w">            </span><span class="c1">//å…³é—­è¿æ¥</span>
</span><span id="__span-87-26"><a id="__codelineno-87-26" name="__codelineno-87-26" href="#__codelineno-87-26"></a><span class="w">            </span><span class="n">jedis</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</span><span id="__span-87-27"><a id="__codelineno-87-27" name="__codelineno-87-27" href="#__codelineno-87-27"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-87-28"><a id="__codelineno-87-28" name="__codelineno-87-28" href="#__codelineno-87-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-87-29"><a id="__codelineno-87-29" name="__codelineno-87-29" href="#__codelineno-87-29"></a><span class="p">}</span>
</span></code></pre></div> <h2 id="7spring-boot-æ•´åˆ">7ã€Spring Boot æ•´åˆ<a class="headerlink" href="#7spring-boot-æ•´åˆ" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>RedisTemplate æ˜¯ Spring Data Redis æä¾›çš„ä¸€ä¸ªå¼ºå¤§çš„æ¨¡æ¿ç±»ï¼Œç”¨äºåœ¨ Spring åº”ç”¨ä¸­ä¸ Redis è¿›è¡Œäº¤äº’ã€‚å®ƒæ˜¯ä¸ Spring æ¡†æ¶ç´§å¯†é›†æˆçš„ï¼Œå¯ä»¥é€‚ç”¨äºå¤šç§ Redis å®¢æˆ·ç«¯å®ç°ï¼ŒåŒ…æ‹¬ Jedis å’Œ Lettuceã€‚</p> <p>åœ¨æ—©æœŸç‰ˆæœ¬çš„ Spring Data Redis ä¸­ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ Jedis ä½œä¸º Redis å®¢æˆ·ç«¯ã€‚ä½†ä» Spring Data Redis 2.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒLettuce æˆä¸ºäº†é»˜è®¤çš„ Redis å®¢æˆ·ç«¯å®ç°ã€‚</p> <p>Jedis æ˜¯ä¸€ä¸ªåŸºäºåŒæ­¥ã€éçº¿ç¨‹å®‰å…¨çš„ Redis å®¢æˆ·ç«¯ï¼Œå¦‚æœæƒ³è¦é¿å…ä¸å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨ Jedis Pool è¿æ¥æ± ã€‚</p> <p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒLettuce æ˜¯ä¸€ä¸ªåŸºäºå¼‚æ­¥ã€çº¿ç¨‹å®‰å…¨å’Œå¯æ‰©å±•çš„ Redis å®¢æˆ·ç«¯ï¼Œæ”¯æŒå¤šä¸ªè¿æ¥å’Œé«˜çº§åŠŸèƒ½ã€‚</p> <p>å¦‚æœä½ ä½¿ç”¨ Spring Bootï¼Œå½“æ·»åŠ äº† <code>spring-boot-starter-data-redis</code> ä¾èµ–åï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šä½¿ç”¨ Lettuce ä½œä¸º Redis å®¢æˆ·ç«¯å®ç°ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ çš„åº”ç”¨éœ€è¦ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®ä½¿ç”¨ Jedisã€‚</p> <p>æ— è®ºä½¿ç”¨ Jedis è¿˜æ˜¯ Lettuceï¼ŒRedisTemplate éƒ½æä¾›äº†ä¸€ç§åœ¨ Spring åº”ç”¨ä¸­æ›´æ–¹ä¾¿åœ°ä¸ Redis è¿›è¡Œäº¤äº’çš„æ–¹å¼ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥æ‰§è¡Œå„ç§ Redis æ“ä½œï¼Œå¦‚è®¾ç½®é”®å€¼ã€è·å–å€¼ã€æ‰§è¡Œäº‹åŠ¡ç­‰ã€‚å½“ç„¶ï¼Œå…·ä½“çš„ä»£ç å’Œé…ç½®å¯èƒ½å› ä¸ºä½ ä½¿ç”¨çš„å®¢æˆ·ç«¯å®ç°è€Œç•¥æœ‰ä¸åŒï¼Œä½†ä½¿ç”¨ RedisTemplate èƒ½å¤Ÿåœ¨ä½ åˆ‡æ¢ Redis å®¢æˆ·ç«¯å®ç°æ—¶å‡å°‘ä»£ç æ”¹åŠ¨çš„å·¥ä½œé‡ã€‚</p> <p><strong>æ•´åˆæµ‹è¯•</strong></p> <ol> <li> <p>å¯¼å…¥ä¾èµ–</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div> </li> <li> <p>é…ç½®è¿æ¥</p> <div class="language-properties highlight"><span class="filename">Properties</span><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="na">spring.redis.host</span><span class="o">=</span><span class="s">120.79.171.55</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="na">spring.redis.port</span><span class="o">=</span><span class="s">6379</span>
</span></code></pre></div> </li> <li> <p>æµ‹è¯•</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="nd">@SpringBootTest</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="kd">class</span> <span class="nc">Redis02SpringbootApplicationTests</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="w">    </span><span class="nd">@Autowired</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">;</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">contextLoads</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="w">        </span><span class="c1">//redisTemplate</span>
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="w">        </span><span class="c1">//opsForValue()</span>
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="w">        </span><span class="c1">//opsForSet()</span>
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a><span class="w">        </span><span class="c1">//opsForHash()</span>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a>
</span><span id="__span-90-13"><a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a><span class="w">        </span><span class="c1">//è·å– redis çš„è¿æ¥å¯¹è±¡</span>
</span><span id="__span-90-14"><a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a><span class="w">        </span><span class="c1">//RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();</span>
</span><span id="__span-90-15"><a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a><span class="w">        </span><span class="c1">//connection.flushDb();</span>
</span><span id="__span-90-16"><a id="__codelineno-90-16" name="__codelineno-90-16" href="#__codelineno-90-16"></a><span class="w">        </span><span class="c1">//connection.flushAll();</span>
</span><span id="__span-90-17"><a id="__codelineno-90-17" name="__codelineno-90-17" href="#__codelineno-90-17"></a>
</span><span id="__span-90-18"><a id="__codelineno-90-18" name="__codelineno-90-18" href="#__codelineno-90-18"></a><span class="w">        </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">set</span><span class="p">(</span><span class="s">"mykey"</span><span class="p">,</span><span class="s">"Orichalcos"</span><span class="p">);</span>
</span><span id="__span-90-19"><a id="__codelineno-90-19" name="__codelineno-90-19" href="#__codelineno-90-19"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">"mykey"</span><span class="p">));</span>
</span><span id="__span-90-20"><a id="__codelineno-90-20" name="__codelineno-90-20" href="#__codelineno-90-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-90-21"><a id="__codelineno-90-21" name="__codelineno-90-21" href="#__codelineno-90-21"></a><span class="p">}</span>
</span></code></pre></div> </li> </ol> <h3 id="71redistemplate-åŠåºåˆ—åŒ–æ–¹å¼">7.1ã€RedisTemplate åŠåºåˆ—åŒ–æ–¹å¼<a class="headerlink" href="#71redistemplate-åŠåºåˆ—åŒ–æ–¹å¼" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>è¿è¡Œä¸Šä¸ªä¾‹å­åï¼Œåœ¨ Redis ä¸­é€šè¿‡ <code>keys *</code> å‘½ä»¤å¯ä»¥çœ‹åˆ°ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="s2">"\xac\xed\x00\x05t\x00\x05mykey"</span>
</span></code></pre></div> <p>å¯ä»¥ä½¿ç”¨ StringRedisTemplate æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p> <p><strong>RedisSerializer</strong></p> <p>RedisSerializer æ¥å£ æ˜¯ Redis åºåˆ—åŒ–æ¥å£ï¼Œç”¨äº Redis KEY å’Œ VALUE çš„åºåˆ—åŒ–ï¼Œå®ç°ç±»å¦‚ä¸‹ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210527235233341.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210527235233341.png" alt="image-20210527235233341" style="zoom:50%;"></a></p> <p><strong>ä¸¤ç§ Template çš„åŒºåˆ«</strong></p> <ul> <li> <p>ä¸¤è€…çš„å…³ç³»ï¼š StringRedisTemplate ç»§æ‰¿ RedisTemplateã€‚</p> </li> <li> <p>ä»–ä»¬çš„æ•°æ®æ˜¯ä¸å…±é€šçš„ï¼›ä¹Ÿå°±æ˜¯è¯´ StringRedisTemplate åªèƒ½ç®¡ç† StringRedisTemplate é‡Œé¢çš„æ•°æ®ï¼ŒRedisTemplate åªèƒ½ç®¡ç† RedisTemplate ä¸­çš„æ•°æ®ã€‚</p> </li> <li> <p>ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ä¸»è¦åœ¨äºä»–ä»¬ä½¿ç”¨çš„åºåˆ—åŒ–ç±»ï¼š</p> <blockquote> <p>RedisTemplate ä½¿ç”¨çš„æ˜¯ JdkSerializationRedisSerializerï¼ˆå¦‚æœå­˜å…¥å¯¹è±¡ï¼Œå¯¹è±¡è¦å®ç° Serializable æ¥å£ï¼‰ï¼Œå­˜å…¥æ•°æ®ä¼šå°†æ•°æ®å…ˆåºåˆ—åŒ–æˆå­—èŠ‚æ•°ç»„ç„¶ååœ¨å­˜å…¥ Redis æ•°æ®åº“ã€‚è¿™ä¸ªæ—¶å€™æ‰“å¼€ Redis æŸ¥çœ‹çš„æ—¶å€™ï¼Œä½ ä¼šçœ‹åˆ°ä½ çš„æ•°æ®ä¸æ˜¯ä»¥å¯è¯»çš„å½¢å¼å±•ç°çš„ï¼Œè€Œæ˜¯ä»¥å­—èŠ‚æ•°ç»„æ˜¾ç¤ºï¼Œç±»ä¼¼ä¸‹é¢ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/20180311192010923.png" data-desc-position="bottom"><img src="!assets/Redis/20180311192010923.png" alt="img" style="zoom:80%;"></a> </p> <p>å½“ç„¶ä» Redis è·å–æ•°æ®çš„æ—¶å€™ä¹Ÿä¼šé»˜è®¤å°†æ•°æ®å½“åšå­—èŠ‚æ•°ç»„è½¬åŒ–ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå½“éœ€è¦è·å–çš„æ•°æ®ä¸æ˜¯ä»¥å­—èŠ‚æ•°ç»„å­˜åœ¨ Redis å½“ä¸­è€Œæ˜¯æ­£å¸¸çš„å¯è¯»çš„å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œæ¯”å¦‚è¯´ä¸‹é¢è¿™ç§å½¢å¼çš„æ•°æ®ï¼š <a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/20180311192129306.png" data-desc-position="bottom"><img src="!assets/Redis/20180311192129306.png" alt="img" style="zoom:80%;"></a></p> <p>RedisTemplate å°±æ— æ³•è·å–å¯¼æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™è·å–åˆ°çš„å€¼å°±æ˜¯ NULLã€‚æ­¤æ—¶ StringRedisTempate å°±æ´¾ä¸Šäº†ç”¨åœºï¼Œ StringRedisTemplate ä½¿ç”¨çš„æ˜¯ StringRedisSerializerï¼Œå½“ Redis å½“ä¸­çš„æ•°æ®å€¼æ˜¯ä»¥å¯è¯»çš„å½¢å¼æ˜¾ç¤ºå‡ºæ¥çš„æ—¶å€™ï¼Œåªèƒ½ä½¿ç”¨ StringRedisTemplate æ‰èƒ½è·å–åˆ°é‡Œé¢çš„æ•°æ®ã€‚</p> </blockquote> </li> </ul> <p><strong>ä¸¤ç§ Template çš„æºç åˆ†æ</strong></p> <p>StringRedisTemplate çš„éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StringRedisTemplate</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="cm">     * Constructs a new &lt;code&gt;StringRedisTemplate&lt;/code&gt; instance. {@link #setConnectionFactory(RedisConnectionFactory)}</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="cm">     * and {@link #afterPropertiesSet()} still need to be called.</span>
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="cm">     */</span>
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">StringRedisTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="w">        </span><span class="n">setKeySerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">string</span><span class="p">());</span>
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a><span class="w">        </span><span class="n">setValueSerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">string</span><span class="p">());</span>
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a><span class="w">        </span><span class="n">setHashKeySerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">string</span><span class="p">());</span>
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a><span class="w">        </span><span class="n">setHashValueSerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">string</span><span class="p">());</span>
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-92-13"><a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a>
</span><span id="__span-92-14"><a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a><span class="p">}</span>
</span></code></pre></div> <p>é€šè¿‡è¯¥æºç å¯ä»¥çœ‹åˆ° StringRedisTemplate é‡‡ç”¨çš„æ˜¯ <code>RedisSerializer.string()</code> æ¥åºåˆ—åŒ– Redis ä¸­å­˜å‚¨æ•°æ®çš„ Key çš„ã€‚</p> <p>ä¸‹é¢å†æ¥çœ‹çœ‹ RedisTemplate ä¸­é»˜è®¤é‡‡ç”¨ä»€ä¹ˆå½¢å¼æ¥åºåˆ—åŒ–å¯¹åº”çš„ Keyã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RedisTemplate</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">RedisAccessor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">RedisOperations</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">BeanClassLoaderAware</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="w">    </span><span class="c1">// çœç•¥å…¶ä»–æºç </span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">RedisSerializer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">defaultSerializer</span><span class="p">;</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">ClassLoader</span><span class="w"> </span><span class="n">classLoader</span><span class="p">;</span>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a>
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="w">    </span><span class="cm">/*</span>
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="cm">     * (non-Javadoc)</span>
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a><span class="cm">     * @see org.springframework.data.redis.core.RedisAccessor#afterPropertiesSet()</span>
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="cm">     */</span>
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterPropertiesSet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a>
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">afterPropertiesSet</span><span class="p">();</span>
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a>
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a><span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">defaultUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a>
</span><span id="__span-93-17"><a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">defaultSerializer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-18"><a id="__codelineno-93-18" name="__codelineno-93-18" href="#__codelineno-93-18"></a>
</span><span id="__span-93-19"><a id="__codelineno-93-19" name="__codelineno-93-19" href="#__codelineno-93-19"></a><span class="w">            </span><span class="n">defaultSerializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JdkSerializationRedisSerializer</span><span class="p">(</span>
</span><span id="__span-93-20"><a id="__codelineno-93-20" name="__codelineno-93-20" href="#__codelineno-93-20"></a><span class="w">                    </span><span class="n">classLoader</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">classLoader</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getClassLoader</span><span class="p">());</span>
</span><span id="__span-93-21"><a id="__codelineno-93-21" name="__codelineno-93-21" href="#__codelineno-93-21"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-93-22"><a id="__codelineno-93-22" name="__codelineno-93-22" href="#__codelineno-93-22"></a>
</span><span id="__span-93-23"><a id="__codelineno-93-23" name="__codelineno-93-23" href="#__codelineno-93-23"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">enableDefaultSerializer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-24"><a id="__codelineno-93-24" name="__codelineno-93-24" href="#__codelineno-93-24"></a>
</span><span id="__span-93-25"><a id="__codelineno-93-25" name="__codelineno-93-25" href="#__codelineno-93-25"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">keySerializer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-26"><a id="__codelineno-93-26" name="__codelineno-93-26" href="#__codelineno-93-26"></a><span class="w">                </span><span class="n">keySerializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultSerializer</span><span class="p">;</span>
</span><span id="__span-93-27"><a id="__codelineno-93-27" name="__codelineno-93-27" href="#__codelineno-93-27"></a><span class="w">                </span><span class="n">defaultUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-93-28"><a id="__codelineno-93-28" name="__codelineno-93-28" href="#__codelineno-93-28"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-93-29"><a id="__codelineno-93-29" name="__codelineno-93-29" href="#__codelineno-93-29"></a><span class="w">            </span><span class="c1">// çœç•¥å…¶ä»–æºç </span>
</span><span id="__span-93-30"><a id="__codelineno-93-30" name="__codelineno-93-30" href="#__codelineno-93-30"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-93-31"><a id="__codelineno-93-31" name="__codelineno-93-31" href="#__codelineno-93-31"></a>
</span><span id="__span-93-32"><a id="__codelineno-93-32" name="__codelineno-93-32" href="#__codelineno-93-32"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">enableDefaultSerializer</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">defaultUsed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-33"><a id="__codelineno-93-33" name="__codelineno-93-33" href="#__codelineno-93-33"></a><span class="w">            </span><span class="n">Assert</span><span class="p">.</span><span class="na">notNull</span><span class="p">(</span><span class="n">defaultSerializer</span><span class="p">,</span><span class="w"> </span><span class="s">"default serializer null and not all serializers initialized"</span><span class="p">);</span>
</span><span id="__span-93-34"><a id="__codelineno-93-34" name="__codelineno-93-34" href="#__codelineno-93-34"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-93-35"><a id="__codelineno-93-35" name="__codelineno-93-35" href="#__codelineno-93-35"></a>
</span><span id="__span-93-36"><a id="__codelineno-93-36" name="__codelineno-93-36" href="#__codelineno-93-36"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scriptExecutor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-37"><a id="__codelineno-93-37" name="__codelineno-93-37" href="#__codelineno-93-37"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">scriptExecutor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultScriptExecutor</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-93-38"><a id="__codelineno-93-38" name="__codelineno-93-38" href="#__codelineno-93-38"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-93-39"><a id="__codelineno-93-39" name="__codelineno-93-39" href="#__codelineno-93-39"></a>
</span><span id="__span-93-40"><a id="__codelineno-93-40" name="__codelineno-93-40" href="#__codelineno-93-40"></a><span class="w">        </span><span class="n">initialized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-93-41"><a id="__codelineno-93-41" name="__codelineno-93-41" href="#__codelineno-93-41"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-93-42"><a id="__codelineno-93-42" name="__codelineno-93-42" href="#__codelineno-93-42"></a><span class="w">    </span><span class="c1">// çœç•¥å…¶ä»–æºç    </span>
</span><span id="__span-93-43"><a id="__codelineno-93-43" name="__codelineno-93-43" href="#__codelineno-93-43"></a><span class="p">}</span>
</span></code></pre></div> <p>å¯ä»¥çœ‹åˆ° RedisTemplate ä½¿ç”¨çš„åºåˆ—åŒ–ç±»ä¸º defaultSerializerï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º JdkSerializationRedisSerializerã€‚å¦‚æœæœªæŒ‡å®š Key çš„åºåˆ—åŒ–ç±»ï¼ŒkeySerializer ä¸ defaultSerializer é‡‡ç”¨ç›¸åŒçš„åºåˆ—åŒ–ç±»ã€‚</p> <p>é€šè¿‡ä¸Šè¿°ä¸¤ä¸ª Template çš„åˆ†æå°±å¯ä»¥çœ‹å‡ºå®ƒä»¬åœ¨ Redis å­˜å‚¨çš„ Keyï¼Œé‡‡ç”¨äº†ä¸åŒçš„åºåˆ—åŒ–æ–¹æ³•ã€‚è€Œä¸” JdkSerializationRedisSerializer åºåˆ—åŒ–æ—¶ä¼šåœ¨ Key çš„å‰é¢æ·»åŠ ä¸€äº›ç‰¹æ®Šå­—ç¬¦ã€‚</p> <p>é‚£ä¹ˆï¼Œå¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æƒ³é€šç”¨ StringRedisTemplate å’Œ RedisTemplate è¿›è¡Œå­—ç¬¦ä¸²çš„å¤„ç†è¯¥æ€ä¹ˆåŠï¼Ÿ</p> <p>æ­¤æ—¶å°±éœ€è¦æŒ‡å®šç»Ÿä¸€çš„ Key çš„åºåˆ—åŒ–å¤„ç†ç±»ï¼Œæ¯”å¦‚åœ¨ RedisTemplate åºåˆ—åŒ–æ—¶æŒ‡å®šä¸ StringRedisTemplate ç›¸åŒçš„ç±»ã€‚åœ¨ä¸Šè¿°å•å…ƒæµ‹è¯•ä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="nd">@BeforeEach</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="w">    </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">setKeySerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">string</span><span class="p">());</span>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¹Ÿå°±æ˜¯è®¾ç½® RedisTemplate ä¹Ÿä½¿ç”¨ <code>RedisSerializer.string()</code> æ¥åºåˆ—åŒ– Keyã€‚æ³¨æ„æ­¤å¤„ä½¿ç”¨çš„æ˜¯ Junit5ã€‚</p> <p>è¿™æ ·å°±è§£å†³é—®é¢˜äº†å—ï¼Ÿæ²¡æœ‰ã€‚å› ä¸º RedisTemplate çš„ Value ä¹Ÿæ˜¯é‡‡ç”¨é»˜è®¤çš„åºåˆ—åŒ–ç±»ï¼Œä¹Ÿè¦è¿›è¡Œç»Ÿä¸€ä¿®æ”¹ã€‚</p> <p>å› æ­¤ä¸Šé¢çš„æ–¹æ³•å˜æˆå¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="nd">@BeforeEach</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="w">    </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">setKeySerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">string</span><span class="p">());</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="w">    </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">setValueSerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">string</span><span class="p">());</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="p">}</span>
</span></code></pre></div> <p><strong>Jackson å®ç° JSON çš„åºåˆ—åŒ–æ–¹å¼</strong></p> <p><code>org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer</code> ä½¿ç”¨ Jackson å®ç° JSON çš„åºåˆ—åŒ–æ–¹å¼ï¼Œå¹¶ä¸”ä» Generic å•è¯å¯ä»¥çœ‹å‡ºï¼Œæ˜¯æ”¯æŒæ‰€æœ‰ç±»ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="kd">public</span><span class="w"> </span><span class="nf">GenericJackson2JsonRedisSerializer</span><span class="p">(</span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">classPropertyTypeName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="w">            </span><span class="p">.....</span>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="w">            </span><span class="p">.....</span><span class="w"> </span>
</span><span id="__span-96-5"><a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">hasText</span><span class="p">(</span><span class="n">classPropertyTypeName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-96-6"><a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="w">            </span><span class="n">mapper</span><span class="p">.</span><span class="na">enableDefaultTypingAsProperty</span><span class="p">(</span><span class="n">DefaultTyping</span><span class="p">.</span><span class="na">NON_FINAL</span><span class="p">,</span><span class="w"> </span><span class="n">classPropertyTypeName</span><span class="p">);</span>
</span><span id="__span-96-7"><a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-96-8"><a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a><span class="w">            </span><span class="n">mapper</span><span class="p">.</span><span class="na">enableDefaultTyping</span><span class="p">(</span><span class="n">DefaultTyping</span><span class="p">.</span><span class="na">NON_FINAL</span><span class="p">,</span><span class="w"> </span><span class="n">As</span><span class="p">.</span><span class="na">PROPERTY</span><span class="p">);</span>
</span><span id="__span-96-9"><a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-96-10"><a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div> <p><em>classPropertyTypeName</em> ä¸ä¸ºç©ºçš„è¯ï¼Œä½¿ç”¨ä¼ å…¥å¯¹è±¡çš„ <em>classPropertyTypeName</em> å±æ€§å¯¹åº”çš„å€¼ï¼Œä½œä¸ºé»˜è®¤ç±»å‹ï¼ˆDefault Typingï¼‰ ï¼Œå¦åˆ™ä½¿ç”¨ä¼ å…¥å¯¹è±¡çš„ç±»å…¨åï¼Œä½œä¸ºé»˜è®¤ç±»å‹ï¼ˆDefault Typingï¼‰ã€‚åŒæ—¶é€šè¿‡ Default Typing ï¼Œä¼šåœ¨å­—ç¬¦ä¸²å¤šå†—ä½™ä¸€ä¸ªç±»å‹ï¼Œè¿™æ ·ååºåˆ—åŒ–å°±çŸ¥é“å…·ä½“çš„ç±»å‹äº†</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="nd">@Bean</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">redisTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="w">    </span><span class="c1">// åˆ›å»º RedisTemplate å¯¹è±¡</span>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="w">    </span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="o">&lt;&gt;</span><span class="p">();</span>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a>
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="w">    </span><span class="c1">// è®¾ç½® RedisConnection å·¥å‚ã€‚ å®ƒå°±æ˜¯å®ç°å¤šç§ Java Redis å®¢æˆ·ç«¯æ¥å…¥çš„ç§˜å¯†å·¥å‚</span>
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="w">    </span><span class="n">template</span><span class="p">.</span><span class="na">setConnectionFactory</span><span class="p">(</span><span class="n">connectionFactory</span><span class="p">);</span>
</span><span id="__span-97-8"><a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a>
</span><span id="__span-97-9"><a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="w">    </span><span class="c1">// ä½¿ç”¨ String åºåˆ—åŒ–æ–¹å¼ï¼Œåºåˆ—åŒ– KEY ã€‚</span>
</span><span id="__span-97-10"><a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="w">    </span><span class="n">template</span><span class="p">.</span><span class="na">setKeySerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">string</span><span class="p">());</span>
</span><span id="__span-97-11"><a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a>
</span><span id="__span-97-12"><a id="__codelineno-97-12" name="__codelineno-97-12" href="#__codelineno-97-12"></a><span class="w">    </span><span class="c1">// ä½¿ç”¨ JSON åºåˆ—åŒ–æ–¹å¼ï¼ˆåº“æ˜¯ Jackson ï¼‰ï¼Œåºåˆ—åŒ– VALUE ã€‚</span>
</span><span id="__span-97-13"><a id="__codelineno-97-13" name="__codelineno-97-13" href="#__codelineno-97-13"></a><span class="w">    </span><span class="n">template</span><span class="p">.</span><span class="na">setValueSerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">json</span><span class="p">());</span>
</span><span id="__span-97-14"><a id="__codelineno-97-14" name="__codelineno-97-14" href="#__codelineno-97-14"></a>
</span><span id="__span-97-15"><a id="__codelineno-97-15" name="__codelineno-97-15" href="#__codelineno-97-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">template</span><span class="p">;</span>
</span><span id="__span-97-16"><a id="__codelineno-97-16" name="__codelineno-97-16" href="#__codelineno-97-16"></a><span class="p">}</span>
</span></code></pre></div> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="nd">@Test</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testJacksonSerializer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="s">"Orichalcos"</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">);</span>
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="w">    </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">set</span><span class="p">(</span><span class="s">"user"</span><span class="p">,</span><span class="n">user</span><span class="p">);</span>
</span><span id="__span-98-5"><a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">"user"</span><span class="p">));</span>
</span><span id="__span-98-6"><a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="p">}</span>
</span></code></pre></div> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>###æ‰“å°è¾“å‡º
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>User(name=Orichalcos, age=18)
</span></code></pre></div> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210528012258213.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210528012258213.png" alt="image-20210528012258213" style="zoom: 50%;"></a></p> <p><strong>è‡ªå®šä¹‰ redisTemplate</strong></p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="nd">@Configuration</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RedisConfig</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="w">    </span><span class="nd">@Bean</span>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="w">    </span><span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">"all"</span><span class="p">)</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">redisTemplate</span><span class="p">(</span><span class="n">RedisConnectionFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="w">        </span><span class="c1">//ä¸€èˆ¬ä¸ºäº†å¼€å‘æ–¹ä¾¿ ä½¿ç”¨&lt;String, Object&gt;</span>
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="w">        </span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="o">&lt;&gt;</span><span class="p">();</span>
</span><span id="__span-100-8"><a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a><span class="w">        </span><span class="n">template</span><span class="p">.</span><span class="na">setConnectionFactory</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
</span><span id="__span-100-9"><a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a>
</span><span id="__span-100-10"><a id="__codelineno-100-10" name="__codelineno-100-10" href="#__codelineno-100-10"></a><span class="w">        </span><span class="c1">//JSONåºåˆ—åŒ–é…ç½®</span>
</span><span id="__span-100-11"><a id="__codelineno-100-11" name="__codelineno-100-11" href="#__codelineno-100-11"></a><span class="w">        </span><span class="n">Jackson2JsonRedisSerializer</span><span class="w"> </span><span class="n">jackson2JsonRedisSerializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Jackson2JsonRedisSerializer</span><span class="p">(</span><span class="n">Object</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-100-12"><a id="__codelineno-100-12" name="__codelineno-100-12" href="#__codelineno-100-12"></a><span class="w">        </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
</span><span id="__span-100-13"><a id="__codelineno-100-13" name="__codelineno-100-13" href="#__codelineno-100-13"></a><span class="w">        </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="n">PropertyAccessor</span><span class="p">.</span><span class="na">ALL</span><span class="p">,</span><span class="w"> </span><span class="n">JsonAutoDetect</span><span class="p">.</span><span class="na">Visibility</span><span class="p">.</span><span class="na">ANY</span><span class="p">);</span>
</span><span id="__span-100-14"><a id="__codelineno-100-14" name="__codelineno-100-14" href="#__codelineno-100-14"></a><span class="w">        </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">enableDefaultTyping</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">DefaultTyping</span><span class="p">.</span><span class="na">NON_FINAL</span><span class="p">);</span>
</span><span id="__span-100-15"><a id="__codelineno-100-15" name="__codelineno-100-15" href="#__codelineno-100-15"></a><span class="w">        </span><span class="n">jackson2JsonRedisSerializer</span><span class="p">.</span><span class="na">setObjectMapper</span><span class="p">(</span><span class="n">objectMapper</span><span class="p">);</span>
</span><span id="__span-100-16"><a id="__codelineno-100-16" name="__codelineno-100-16" href="#__codelineno-100-16"></a>
</span><span id="__span-100-17"><a id="__codelineno-100-17" name="__codelineno-100-17" href="#__codelineno-100-17"></a><span class="w">        </span><span class="c1">//String çš„åºåˆ—åŒ–</span>
</span><span id="__span-100-18"><a id="__codelineno-100-18" name="__codelineno-100-18" href="#__codelineno-100-18"></a><span class="w">        </span><span class="n">StringRedisSerializer</span><span class="w"> </span><span class="n">stringRedisSerializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringRedisSerializer</span><span class="p">();</span>
</span><span id="__span-100-19"><a id="__codelineno-100-19" name="__codelineno-100-19" href="#__codelineno-100-19"></a>
</span><span id="__span-100-20"><a id="__codelineno-100-20" name="__codelineno-100-20" href="#__codelineno-100-20"></a><span class="w">        </span><span class="c1">//key é‡‡ç”¨ String çš„åºåˆ—åŒ–æ–¹å¼</span>
</span><span id="__span-100-21"><a id="__codelineno-100-21" name="__codelineno-100-21" href="#__codelineno-100-21"></a><span class="w">        </span><span class="n">template</span><span class="p">.</span><span class="na">setKeySerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">string</span><span class="p">());</span>
</span><span id="__span-100-22"><a id="__codelineno-100-22" name="__codelineno-100-22" href="#__codelineno-100-22"></a><span class="w">        </span><span class="c1">//hash çš„ key ä¹Ÿé‡‡ç”¨ String çš„åºåˆ—åŒ–æ–¹å¼</span>
</span><span id="__span-100-23"><a id="__codelineno-100-23" name="__codelineno-100-23" href="#__codelineno-100-23"></a><span class="w">        </span><span class="n">template</span><span class="p">.</span><span class="na">setHashKeySerializer</span><span class="p">(</span><span class="n">stringRedisSerializer</span><span class="p">);</span>
</span><span id="__span-100-24"><a id="__codelineno-100-24" name="__codelineno-100-24" href="#__codelineno-100-24"></a><span class="w">        </span><span class="c1">//value åºåˆ—åŒ–æ–¹å¼é‡‡ç”¨ jackson</span>
</span><span id="__span-100-25"><a id="__codelineno-100-25" name="__codelineno-100-25" href="#__codelineno-100-25"></a><span class="w">        </span><span class="n">template</span><span class="p">.</span><span class="na">setValueSerializer</span><span class="p">(</span><span class="n">jackson2JsonRedisSerializer</span><span class="p">);</span>
</span><span id="__span-100-26"><a id="__codelineno-100-26" name="__codelineno-100-26" href="#__codelineno-100-26"></a><span class="w">        </span><span class="c1">//hash çš„ value åºåˆ—åŒ–æ–¹å¼é‡‡ç”¨ jackson</span>
</span><span id="__span-100-27"><a id="__codelineno-100-27" name="__codelineno-100-27" href="#__codelineno-100-27"></a><span class="w">        </span><span class="n">template</span><span class="p">.</span><span class="na">setHashValueSerializer</span><span class="p">(</span><span class="n">jackson2JsonRedisSerializer</span><span class="p">);</span>
</span><span id="__span-100-28"><a id="__codelineno-100-28" name="__codelineno-100-28" href="#__codelineno-100-28"></a><span class="w">        </span><span class="n">template</span><span class="p">.</span><span class="na">afterPropertiesSet</span><span class="p">();</span>
</span><span id="__span-100-29"><a id="__codelineno-100-29" name="__codelineno-100-29" href="#__codelineno-100-29"></a>
</span><span id="__span-100-30"><a id="__codelineno-100-30" name="__codelineno-100-30" href="#__codelineno-100-30"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">template</span><span class="p">;</span>
</span><span id="__span-100-31"><a id="__codelineno-100-31" name="__codelineno-100-31" href="#__codelineno-100-31"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-100-32"><a id="__codelineno-100-32" name="__codelineno-100-32" href="#__codelineno-100-32"></a><span class="p">}</span>
</span></code></pre></div> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="nd">@SpringBootTest</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="kd">class</span> <span class="nc">Redis02SpringbootApplicationTests</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="w">    </span><span class="nd">@Autowired</span>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">"redisTemplate"</span><span class="p">)</span>
</span><span id="__span-101-5"><a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">;</span>
</span><span id="__span-101-6"><a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a>
</span><span id="__span-101-7"><a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-101-8"><a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-101-9"><a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="s">"Orichalcos"</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-101-10"><a id="__codelineno-101-10" name="__codelineno-101-10" href="#__codelineno-101-10"></a><span class="w">        </span><span class="c1">//String jsonUser = new ObjectMapper().writeValueAsString(user);</span>
</span><span id="__span-101-11"><a id="__codelineno-101-11" name="__codelineno-101-11" href="#__codelineno-101-11"></a><span class="w">        </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">set</span><span class="p">(</span><span class="s">"user"</span><span class="p">,</span><span class="w"> </span><span class="n">jsonUser</span><span class="p">);</span>
</span><span id="__span-101-12"><a id="__codelineno-101-12" name="__codelineno-101-12" href="#__codelineno-101-12"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">"user"</span><span class="p">));</span>
</span><span id="__span-101-13"><a id="__codelineno-101-13" name="__codelineno-101-13" href="#__codelineno-101-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-101-14"><a id="__codelineno-101-14" name="__codelineno-101-14" href="#__codelineno-101-14"></a><span class="p">}</span>
</span></code></pre></div> <h3 id="72è·å–-redis-è¿æ¥ä¿¡æ¯">7.2ã€è·å– Redis è¿æ¥ä¿¡æ¯<a class="headerlink" href="#72è·å–-redis-è¿æ¥ä¿¡æ¯" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>è·å– Redis è¿æ¥çš„ä¸»æœºåå’Œç«¯å£æ˜¯ç”± Redis å®¢æˆ·ç«¯åº“è‡ªèº«æä¾›çš„åŠŸèƒ½ã€‚è¿™äº›ç»†èŠ‚åœ¨ä¸åŒçš„å®¢æˆ·ç«¯åº“ï¼ˆå¦‚ Jedis å’Œ Lettuceï¼‰ä¸­å¯èƒ½æœ‰æ‰€ä¸åŒã€‚</p> <p>å¯¹äº Jedis å®¢æˆ·ç«¯åº“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è·å–è¿æ¥ä¿¡æ¯ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="n">JedisConnectionFactory</span><span class="w"> </span><span class="n">jedisConnectionFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">JedisConnectionFactory</span><span class="p">)</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">getConnectionFactory</span><span class="p">();</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="n">String</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jedisConnectionFactory</span><span class="p">.</span><span class="na">getHostName</span><span class="p">();</span>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jedisConnectionFactory</span><span class="p">.</span><span class="na">getPort</span><span class="p">();</span>
</span></code></pre></div> <p>å¯¹äº Lettuce å®¢æˆ·ç«¯åº“ï¼Œè·å–è¿æ¥ä¿¡æ¯çš„æ–¹å¼å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="n">LettuceConnectionFactory</span><span class="w"> </span><span class="n">lettuceConnectionFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">LettuceConnectionFactory</span><span class="p">)</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">getConnectionFactory</span><span class="p">();</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="n">RedisURI</span><span class="w"> </span><span class="n">redisUri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lettuceConnectionFactory</span><span class="p">.</span><span class="na">getStandaloneConfiguration</span><span class="p">().</span><span class="na">getClientOptions</span><span class="p">().</span><span class="na">getUris</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="n">String</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisUri</span><span class="p">.</span><span class="na">getHost</span><span class="p">();</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisUri</span><span class="p">.</span><span class="na">getPort</span><span class="p">();</span>
</span></code></pre></div> <h2 id="8redis-é…ç½®è¯¦è§£">8ã€Redis é…ç½®è¯¦è§£<a class="headerlink" href="#8redis-é…ç½®è¯¦è§£" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <h3 id="81redisconf-è¯¦è§£">8.1ã€redis.conf è¯¦è§£<a class="headerlink" href="#81redisconf-è¯¦è§£" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <h4 id="811å•ä½">8.1.1ã€å•ä½<a class="headerlink" href="#811å•ä½" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210531165111502.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210531165111502.png" alt="image-20210531165111502" style></a></p> <p>å•ä½å¤§å°å†™ä¸æ•æ„Ÿï¼Œ<code>1GB</code>ã€<code>1Gb</code>ã€<code>1gB</code>éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p> <h4 id="812åŒ…å«">8.1.2ã€åŒ…å«<a class="headerlink" href="#812åŒ…å«" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>INCLOUDESï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210531171044748.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210531171044748.png" alt="image-20210531171044748" style></a></p> <p>å¯ä»¥æŠŠå¤šä¸ªé…ç½®æ–‡ä»¶åŒ…å«è¿›æ¥ï¼Œå¦‚æœå°†æ­¤é…ç½®å†™åœ¨ redis.conf æ–‡ä»¶çš„å¼€å¤´ï¼Œé‚£ä¹ˆåé¢çš„é…ç½®ä¼šè¦†ç›–å¼•å…¥æ–‡ä»¶çš„é…ç½®ï¼Œå¦‚æœæƒ³ä»¥å¼•å…¥æ–‡ä»¶çš„é…ç½®ä¸ºä¸»ï¼Œé‚£ä¹ˆéœ€è¦å°† include é…ç½®å†™åœ¨ redis.conf æ–‡ä»¶çš„æœ«å°¾</p> <h4 id="813ç½‘ç»œ">8.1.3ã€ç½‘ç»œ<a class="headerlink" href="#813ç½‘ç»œ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>NETWORKï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="c1">## ç»‘å®šçš„IPï¼Œé»˜è®¤ä¸ºæœ¬æœºåœ°å€ï¼Œå¦‚æœä¸é™åˆ¶å¯ä»¥åœ¨å‰é¢åŠ  # æ³¨é‡Šæ‰</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="nb">bind</span><span class="w"> </span><span class="m">172</span>.0.0.1
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a>
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="c1">## ä¿æŠ¤æ¨¡å¼ï¼Œå¦‚æœæƒ³è¦è¿œç¨‹è®¿é—®ï¼Œè¿™ä¸ªè¦å…³æ‰</span>
</span><span id="__span-104-5"><a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a>protected-mode<span class="w"> </span>no
</span><span id="__span-104-6"><a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a>
</span><span id="__span-104-7"><a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a><span class="c1">## ç«¯å£å·</span>
</span><span id="__span-104-8"><a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a>prot<span class="w"> </span><span class="m">6379</span>
</span><span id="__span-104-9"><a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a>
</span><span id="__span-104-10"><a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a><span class="c1">## è®¾ç½®å®¢æˆ·ç«¯è¿æ¥æ—¶çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚å½“å®¢æˆ·ç«¯åœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰å‘å‡ºä»»ä½•æŒ‡ä»¤ï¼Œé‚£ä¹ˆå…³é—­è¯¥è¿æ¥</span>
</span><span id="__span-104-11"><a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a><span class="c1">## 0æ˜¯å…³é—­æ­¤è®¾ç½®</span>
</span><span id="__span-104-12"><a id="__codelineno-104-12" name="__codelineno-104-12" href="#__codelineno-104-12"></a>timeout<span class="w"> </span><span class="m">0</span>
</span></code></pre></div> <h4 id="814é€šç”¨">8.1.4ã€é€šç”¨<a class="headerlink" href="#814é€šç”¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>GENERALï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="c1">## ä»¥å®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼è¿è¡Œ</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="c1">## å¦‚æœä½  systemctl æ¥ç®¡ç† Redis æœåŠ¡ï¼ˆå³é€šè¿‡ systemd å¯åŠ¨ Redisï¼‰ï¼Œå°±å¿…é¡»æŠŠè¿™é‡Œæ”¹ä¸º no</span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a>deamonize<span class="w"> </span>yes
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a>
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="c1">## å¦‚æœä»¥åå°çš„æ–¹å¼è¿è¡Œï¼Œé‚£ä¹ˆå°±éœ€è¦æŒ‡å®šä¸€ä¸ª pid æ–‡ä»¶</span>
</span><span id="__span-105-6"><a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a>pidfile<span class="w"> </span>/var/run/redis/redis-server.pid
</span><span id="__span-105-7"><a id="__codelineno-105-7" name="__codelineno-105-7" href="#__codelineno-105-7"></a>
</span><span id="__span-105-8"><a id="__codelineno-105-8" name="__codelineno-105-8" href="#__codelineno-105-8"></a><span class="c1">## æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«</span>
</span><span id="__span-105-9"><a id="__codelineno-105-9" name="__codelineno-105-9" href="#__codelineno-105-9"></a><span class="c1">## Redisæ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warning</span>
</span><span id="__span-105-10"><a id="__codelineno-105-10" name="__codelineno-105-10" href="#__codelineno-105-10"></a><span class="c1">## debug è®°å½•å¾ˆå¤šä¿¡æ¯ï¼Œç”¨äºå¼€å‘å’Œæµ‹è¯•</span>
</span><span id="__span-105-11"><a id="__codelineno-105-11" name="__codelineno-105-11" href="#__codelineno-105-11"></a><span class="c1">## varbose æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¸åƒdebugä¼šè®°å½•é‚£ä¹ˆå¤š</span>
</span><span id="__span-105-12"><a id="__codelineno-105-12" name="__codelineno-105-12" href="#__codelineno-105-12"></a><span class="c1">## notice æ™®é€šçš„verboseï¼Œå¸¸ç”¨äºç”Ÿäº§ç¯å¢ƒ</span>
</span><span id="__span-105-13"><a id="__codelineno-105-13" name="__codelineno-105-13" href="#__codelineno-105-13"></a><span class="c1">## warning åªæœ‰éå¸¸é‡è¦æˆ–è€…ä¸¥é‡çš„ä¿¡æ¯ä¼šè®°å½•åˆ°æ—¥å¿—</span>
</span><span id="__span-105-14"><a id="__codelineno-105-14" name="__codelineno-105-14" href="#__codelineno-105-14"></a>loglevel<span class="w"> </span>debug
</span><span id="__span-105-15"><a id="__codelineno-105-15" name="__codelineno-105-15" href="#__codelineno-105-15"></a>
</span><span id="__span-105-16"><a id="__codelineno-105-16" name="__codelineno-105-16" href="#__codelineno-105-16"></a><span class="c1">## é…ç½®logæ–‡ä»¶åœ°å€</span>
</span><span id="__span-105-17"><a id="__codelineno-105-17" name="__codelineno-105-17" href="#__codelineno-105-17"></a>logfile<span class="w"> </span>/var/log/redis/redis.log
</span><span id="__span-105-18"><a id="__codelineno-105-18" name="__codelineno-105-18" href="#__codelineno-105-18"></a>
</span><span id="__span-105-19"><a id="__codelineno-105-19" name="__codelineno-105-19" href="#__codelineno-105-19"></a><span class="c1">## å¯ç”¨æ•°æ®åº“æ•°</span>
</span><span id="__span-105-20"><a id="__codelineno-105-20" name="__codelineno-105-20" href="#__codelineno-105-20"></a><span class="c1">## é»˜è®¤å€¼ä¸º16ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ï¼Œæ•°æ®åº“èŒƒå›´åœ¨0-ï¼ˆdatabase-1ï¼‰ä¹‹é—´</span>
</span><span id="__span-105-21"><a id="__codelineno-105-21" name="__codelineno-105-21" href="#__codelineno-105-21"></a>databases<span class="w"> </span><span class="m">16</span>
</span><span id="__span-105-22"><a id="__codelineno-105-22" name="__codelineno-105-22" href="#__codelineno-105-22"></a>
</span><span id="__span-105-23"><a id="__codelineno-105-23" name="__codelineno-105-23" href="#__codelineno-105-23"></a><span class="c1">## æ˜¯å¦æ€»æ˜¯æ˜¾ç¤º logo</span>
</span><span id="__span-105-24"><a id="__codelineno-105-24" name="__codelineno-105-24" href="#__codelineno-105-24"></a>always-show-logo<span class="w"> </span>yes
</span></code></pre></div> <h4 id="815å¿«ç…§">8.1.5ã€å¿«ç…§<a class="headerlink" href="#815å¿«ç…§" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>SNAPSHOTTINGï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="c1">## æŒ‡å‡ºåœ¨å¤šé•¿æ—¶é—´å†…ï¼Œæœ‰å¤šå°‘æ¬¡æ›´æ–°æ“ä½œï¼Œå°±å°†æ•°æ®åŒæ­¥åˆ°æ•°æ®æ–‡ä»¶rdbã€‚</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="c1">## ç›¸å½“äºæ¡ä»¶è§¦å‘æŠ“å–å¿«ç…§ï¼Œè¿™ä¸ªå¯ä»¥å¤šä¸ªæ¡ä»¶é…åˆ</span>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="c1">#</span>
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="c1">## æ¯”å¦‚é»˜è®¤é…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®ï¼Œå°±è®¾ç½®äº†ä¸‰ä¸ªæ¡ä»¶</span>
</span><span id="__span-106-5"><a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="c1">#</span>
</span><span id="__span-106-6"><a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a><span class="c1">## save 900 1 900ç§’å†…è‡³å°‘æœ‰1ä¸ªkeyè¢«æ”¹å˜</span>
</span><span id="__span-106-7"><a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a><span class="c1">## save 300 10 300ç§’å†…è‡³å°‘æœ‰300ä¸ªkeyè¢«æ”¹å˜</span>
</span><span id="__span-106-8"><a id="__codelineno-106-8" name="__codelineno-106-8" href="#__codelineno-106-8"></a><span class="c1">## save 60 10000 60ç§’å†…è‡³å°‘æœ‰10000ä¸ªkeyè¢«æ”¹å˜</span>
</span><span id="__span-106-9"><a id="__codelineno-106-9" name="__codelineno-106-9" href="#__codelineno-106-9"></a>
</span><span id="__span-106-10"><a id="__codelineno-106-10" name="__codelineno-106-10" href="#__codelineno-106-10"></a>save<span class="w"> </span><span class="m">900</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-106-11"><a id="__codelineno-106-11" name="__codelineno-106-11" href="#__codelineno-106-11"></a>save<span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="m">10</span>
</span><span id="__span-106-12"><a id="__codelineno-106-12" name="__codelineno-106-12" href="#__codelineno-106-12"></a>save<span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">10000</span>
</span><span id="__span-106-13"><a id="__codelineno-106-13" name="__codelineno-106-13" href="#__codelineno-106-13"></a>
</span><span id="__span-106-14"><a id="__codelineno-106-14" name="__codelineno-106-14" href="#__codelineno-106-14"></a><span class="c1">## åˆ›å»ºå¿«ç…§å‡ºé”™åæ˜¯å¦åœæ­¢å†™å…¥</span>
</span><span id="__span-106-15"><a id="__codelineno-106-15" name="__codelineno-106-15" href="#__codelineno-106-15"></a>stop-writes-on-bgsave-error<span class="w"> </span>yes
</span><span id="__span-106-16"><a id="__codelineno-106-16" name="__codelineno-106-16" href="#__codelineno-106-16"></a>
</span><span id="__span-106-17"><a id="__codelineno-106-17" name="__codelineno-106-17" href="#__codelineno-106-17"></a><span class="c1">## å­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶ï¼ˆæŒä¹…åŒ–åˆ°rdbæ–‡ä»¶ï¼‰æ˜¯å¦å‹ç¼©æ•°æ®</span>
</span><span id="__span-106-18"><a id="__codelineno-106-18" name="__codelineno-106-18" href="#__codelineno-106-18"></a>rdbcompression<span class="w"> </span>yes
</span><span id="__span-106-19"><a id="__codelineno-106-19" name="__codelineno-106-19" href="#__codelineno-106-19"></a>
</span><span id="__span-106-20"><a id="__codelineno-106-20" name="__codelineno-106-20" href="#__codelineno-106-20"></a><span class="c1">## ä¿å­˜ rdb æ–‡ä»¶æ—¶ï¼Œè¿›è¡Œé”™è¯¯çš„æ£€æŸ¥æ ¡æ£€</span>
</span><span id="__span-106-21"><a id="__codelineno-106-21" name="__codelineno-106-21" href="#__codelineno-106-21"></a>rdbchecksum<span class="w"> </span>yes
</span><span id="__span-106-22"><a id="__codelineno-106-22" name="__codelineno-106-22" href="#__codelineno-106-22"></a>
</span><span id="__span-106-23"><a id="__codelineno-106-23" name="__codelineno-106-23" href="#__codelineno-106-23"></a><span class="c1">## æœ¬åœ°æŒä¹…åŒ–æ•°æ®åº“æ–‡ä»¶å</span>
</span><span id="__span-106-24"><a id="__codelineno-106-24" name="__codelineno-106-24" href="#__codelineno-106-24"></a>dbfilename<span class="w"> </span>dump.rdb
</span><span id="__span-106-25"><a id="__codelineno-106-25" name="__codelineno-106-25" href="#__codelineno-106-25"></a>
</span><span id="__span-106-26"><a id="__codelineno-106-26" name="__codelineno-106-26" href="#__codelineno-106-26"></a><span class="c1">## å·¥ä½œç›®å½•</span>
</span><span id="__span-106-27"><a id="__codelineno-106-27" name="__codelineno-106-27" href="#__codelineno-106-27"></a><span class="c1">#</span>
</span><span id="__span-106-28"><a id="__codelineno-106-28" name="__codelineno-106-28" href="#__codelineno-106-28"></a><span class="c1">## æ•°æ®åº“é•œåƒå¤‡ä»½çš„æ–‡ä»¶æ”¾ç½®çš„è·¯å¾„ã€‚</span>
</span><span id="__span-106-29"><a id="__codelineno-106-29" name="__codelineno-106-29" href="#__codelineno-106-29"></a><span class="c1">## è¿™é‡Œçš„è·¯å¾„è·Ÿæ–‡ä»¶åè¦åˆ†å¼€é…ç½®æ˜¯å› ä¸ºredisåœ¨è¿›è¡Œå¤‡ä»½æ—¶ï¼Œå…ˆä¼šå°†å½“å‰æ•°æ®åº“çš„çŠ¶æ€å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œç­‰å¤‡ä»½å®Œæˆæ—¶ï¼Œ</span>
</span><span id="__span-106-30"><a id="__codelineno-106-30" name="__codelineno-106-30" href="#__codelineno-106-30"></a><span class="c1">## å†æŠŠè¯¥è¯¥ä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸ºä¸Šé¢æ‰€æŒ‡å®šçš„æ–‡ä»¶ï¼Œè€Œè¿™é‡Œçš„ä¸´æ—¶æ–‡ä»¶å’Œä¸Šé¢æ‰€é…ç½®çš„å¤‡ä»½æ–‡ä»¶éƒ½ä¼šæ”¾åœ¨è¿™ä¸ªæŒ‡å®šçš„è·¯å¾„å½“ä¸­ã€‚</span>
</span><span id="__span-106-31"><a id="__codelineno-106-31" name="__codelineno-106-31" href="#__codelineno-106-31"></a><span class="c1">#</span>
</span><span id="__span-106-32"><a id="__codelineno-106-32" name="__codelineno-106-32" href="#__codelineno-106-32"></a><span class="c1">## AOFæ–‡ä»¶ä¹Ÿä¼šå­˜æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹é¢</span>
</span><span id="__span-106-33"><a id="__codelineno-106-33" name="__codelineno-106-33" href="#__codelineno-106-33"></a><span class="c1">#</span>
</span><span id="__span-106-34"><a id="__codelineno-106-34" name="__codelineno-106-34" href="#__codelineno-106-34"></a><span class="c1">## æ³¨æ„è¿™é‡Œå¿…é¡»æŒ‡å®šä¸€ä¸ªç›®å½•è€Œä¸æ˜¯æ–‡ä»¶</span>
</span><span id="__span-106-35"><a id="__codelineno-106-35" name="__codelineno-106-35" href="#__codelineno-106-35"></a>dir<span class="w"> </span>./
</span></code></pre></div> <h4 id="816å¤åˆ¶">8.1.6ã€å¤åˆ¶<a class="headerlink" href="#816å¤åˆ¶" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>REPLICATIONï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="c1">## ä¸»ä»å¤åˆ¶. è®¾ç½®è¯¥æ•°æ®åº“ä¸ºå…¶ä»–æ•°æ®åº“çš„ä»æ•°æ®åº“.</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="c1">## è®¾ç½®å½“æœ¬æœºä¸ºslaveæœåŠ¡æ—¶ï¼Œè®¾ç½®masteræœåŠ¡çš„IPåœ°å€åŠç«¯å£ï¼Œåœ¨Rediså¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä»masterè¿›è¡Œæ•°æ®åŒæ­¥</span>
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="c1">#</span>
</span><span id="__span-107-4"><a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="c1">## replicaof &lt;masterip&gt; &lt;masterport&gt;</span>
</span><span id="__span-107-5"><a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a>
</span><span id="__span-107-6"><a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a><span class="c1">## å½“masteræœåŠ¡è®¾ç½®äº†å¯†ç ä¿æŠ¤æ—¶(ç”¨requirepassåˆ¶å®šçš„å¯†ç )</span>
</span><span id="__span-107-7"><a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a><span class="c1">## slavæœåŠ¡è¿æ¥masterçš„å¯†ç </span>
</span><span id="__span-107-8"><a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a><span class="c1">#</span>
</span><span id="__span-107-9"><a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a><span class="c1">## masterauth &lt;master-password&gt;</span>
</span><span id="__span-107-10"><a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a>
</span><span id="__span-107-11"><a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a><span class="c1">## å½“ä»åº“åŒä¸»æœºå¤±å»è¿æ¥æˆ–è€…å¤åˆ¶æ­£åœ¨è¿›è¡Œï¼Œä»æœºåº“æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼ï¼š</span>
</span><span id="__span-107-12"><a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a><span class="c1">#</span>
</span><span id="__span-107-13"><a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a><span class="c1">## 1) å¦‚æœreplica-serve-stale-dataè®¾ç½®ä¸ºyes(é»˜è®¤è®¾ç½®)ï¼Œä»åº“ä¼šç»§ç»­ç›¸åº”å®¢æˆ·ç«¯çš„è¯·æ±‚</span>
</span><span id="__span-107-14"><a id="__codelineno-107-14" name="__codelineno-107-14" href="#__codelineno-107-14"></a><span class="c1">#</span>
</span><span id="__span-107-15"><a id="__codelineno-107-15" name="__codelineno-107-15" href="#__codelineno-107-15"></a><span class="c1">## 2) å¦‚æœreplica-serve-stale-dataæ˜¯æŒ‡ä¸ºnoï¼Œé™¤å»INFOå’ŒSLAVOFå‘½ä»¤ä¹‹å¤–çš„ä»»ä½•è¯·æ±‚éƒ½ä¼šè¿”å›ä¸€ä¸ª</span>
</span><span id="__span-107-16"><a id="__codelineno-107-16" name="__codelineno-107-16" href="#__codelineno-107-16"></a><span class="c1">## é”™è¯¯"SYNC with master in progress"</span>
</span><span id="__span-107-17"><a id="__codelineno-107-17" name="__codelineno-107-17" href="#__codelineno-107-17"></a><span class="c1">#</span>
</span><span id="__span-107-18"><a id="__codelineno-107-18" name="__codelineno-107-18" href="#__codelineno-107-18"></a>replica-serve-stale-data<span class="w"> </span>yes
</span><span id="__span-107-19"><a id="__codelineno-107-19" name="__codelineno-107-19" href="#__codelineno-107-19"></a>
</span><span id="__span-107-20"><a id="__codelineno-107-20" name="__codelineno-107-20" href="#__codelineno-107-20"></a><span class="c1">## ä»åº“ä¼šæŒ‰ç…§ä¸€ä¸ªæ—¶é—´é—´éš”å‘ä¸»åº“å‘é€PINGs.å¯ä»¥é€šè¿‡repl-ping-replica-periodè®¾ç½®è¿™ä¸ªæ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯10ç§’</span>
</span><span id="__span-107-21"><a id="__codelineno-107-21" name="__codelineno-107-21" href="#__codelineno-107-21"></a><span class="c1">#</span>
</span><span id="__span-107-22"><a id="__codelineno-107-22" name="__codelineno-107-22" href="#__codelineno-107-22"></a><span class="c1">## repl-ping-replica-period 10</span>
</span><span id="__span-107-23"><a id="__codelineno-107-23" name="__codelineno-107-23" href="#__codelineno-107-23"></a>
</span><span id="__span-107-24"><a id="__codelineno-107-24" name="__codelineno-107-24" href="#__codelineno-107-24"></a><span class="c1">## â€œå¿ƒè·³æ£€æµ‹â€ è¿™ä¸ªå€¼å¯¹ä¸‰ä¸ªåœºæ™¯éƒ½æœ‰æ•ˆï¼š</span>
</span><span id="__span-107-25"><a id="__codelineno-107-25" name="__codelineno-107-25" href="#__codelineno-107-25"></a><span class="c1">## å¤§é‡çš„I/Oæ“ä½œï¼Œä»èŠ‚ç‚¹æ”¶åˆ°ä¸»èŠ‚ç‚¹çš„å“åº”æ—¶é—´ã€‚</span>
</span><span id="__span-107-26"><a id="__codelineno-107-26" name="__codelineno-107-26" href="#__codelineno-107-26"></a><span class="c1">## ä»èŠ‚ç‚¹è®¤ä¸ºä¸»èŠ‚ç‚¹çš„è¶…æ—¶æ—¶é—´</span>
</span><span id="__span-107-27"><a id="__codelineno-107-27" name="__codelineno-107-27" href="#__codelineno-107-27"></a><span class="c1">## ä¸»èŠ‚ç‚¹è®¤ä¸ºä»èŠ‚ç‚¹çš„è¶…æ—¶æ—¶é—´</span>
</span><span id="__span-107-28"><a id="__codelineno-107-28" name="__codelineno-107-28" href="#__codelineno-107-28"></a><span class="c1">## repl-timeout 60</span>
</span></code></pre></div> <h4 id="817å®‰å…¨">8.1.7ã€å®‰å…¨<a class="headerlink" href="#817å®‰å…¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>SECURITYï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="c1">## è®¾ç½®å®¢æˆ·ç«¯è¿æ¥åè¿›è¡Œä»»ä½•å…¶ä»–æŒ‡å®šå‰éœ€è¦ä½¿ç”¨çš„å¯†ç ã€‚</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="c1">## è­¦å‘Šï¼šå› ä¸ºredisé€Ÿåº¦ç›¸å½“å¿«ï¼Œæ‰€ä»¥åœ¨ä¸€å°æ¯”è¾ƒå¥½çš„æœåŠ¡å™¨ä¸‹ï¼Œä¸€ä¸ªå¤–éƒ¨çš„ç”¨æˆ·å¯ä»¥åœ¨ä¸€ç§’é’Ÿè¿›è¡Œ150Kæ¬¡çš„å¯†ç å°è¯•ï¼Œ</span>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="c1">## è¿™æ„å‘³ç€ä½ éœ€è¦æŒ‡å®šéå¸¸éå¸¸å¼ºå¤§çš„å¯†ç æ¥é˜²æ­¢æš´åŠ›ç ´è§£</span>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="c1">## </span>
</span><span id="__span-108-5"><a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="c1">## å–æ¶ˆä»¥ä¸‹æ³¨é‡Šå¹¶ä¿®æ”¹ foobared æ¥æ°¸ä¹…è®¾ç½®å¯†ç </span>
</span><span id="__span-108-6"><a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a><span class="c1">## requirepass foobared</span>
</span></code></pre></div> <p>ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤æ¥è®¾ç½®è¿™ä¸ªå¯†ç ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>requirepass<span class="w"> </span><span class="s2">"123456"</span>
</span></code></pre></div> <p>è·å–å¯†ç ï¼š</p> <div class="language-shell highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="c1">## è·å–å‰éœ€è¦éªŒè¯</span>
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>auth<span class="w"> </span><span class="m">123456</span>
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="c1">## è·å–å¯†ç </span>
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a>config<span class="w"> </span>get<span class="w"> </span>requirepass
</span></code></pre></div> <h4 id="818å®¢æˆ·ç«¯">8.1.8ã€å®¢æˆ·ç«¯<a class="headerlink" href="#818å®¢æˆ·ç«¯" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>CLIENTSï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="c1">## è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤æ— é™åˆ¶ï¼ŒRediså¯ä»¥åŒæ—¶æ‰“å¼€çš„å®¢æˆ·ç«¯è¿æ¥æ•°ä¸ºRedisè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°ï¼Œ</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="c1">## å¦‚æœè®¾ç½® maxclients 0ï¼Œè¡¨ç¤ºä¸ä½œé™åˆ¶ã€‚</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="c1">## å½“å®¢æˆ·ç«¯è¿æ¥æ•°åˆ°è¾¾é™åˆ¶æ—¶ï¼ŒRedisä¼šå…³é—­æ–°çš„è¿æ¥å¹¶å‘å®¢æˆ·ç«¯è¿”å›max number of clients reachedé”™è¯¯ä¿¡æ¯</span>
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="c1">#</span>
</span><span id="__span-111-5"><a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="c1">## maxclients 10000</span>
</span></code></pre></div> <h4 id="819å†…å­˜ç®¡ç†">8.1.9ã€å†…å­˜ç®¡ç†<a class="headerlink" href="#819å†…å­˜ç®¡ç†" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>MEMORY MANAGEMENTï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="c1">## æŒ‡å®šRedisæœ€å¤§å†…å­˜é™åˆ¶ï¼ŒRedisåœ¨å¯åŠ¨æ—¶ä¼šæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¾¾åˆ°æœ€å¤§å†…å­˜åï¼ŒRedisä¼šå…ˆå°è¯•æ¸…é™¤å·²åˆ°æœŸæˆ–å³å°†åˆ°æœŸçš„Key</span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="c1">## RedisåŒæ—¶ä¹Ÿä¼šç§»é™¤ç©ºçš„listå¯¹è±¡</span>
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="c1">#</span>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="c1">## å½“æ­¤æ–¹æ³•å¤„ç†åï¼Œä»ç„¶åˆ°è¾¾æœ€å¤§å†…å­˜è®¾ç½®ï¼Œå°†æ— æ³•å†è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†ä»ç„¶å¯ä»¥è¿›è¡Œè¯»å–æ“ä½œ</span>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="c1">#</span>
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="c1">## æ³¨æ„ï¼šRedisæ–°çš„vmæœºåˆ¶ï¼Œä¼šæŠŠKeyå­˜æ”¾å†…å­˜ï¼ŒValueä¼šå­˜æ”¾åœ¨swapåŒº</span>
</span><span id="__span-112-7"><a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="c1">#</span>
</span><span id="__span-112-8"><a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a><span class="c1">## maxmemoryçš„è®¾ç½®æ¯”è¾ƒé€‚åˆäºæŠŠrediså½“ä½œäºç±»ä¼¼memcachedçš„ç¼“å­˜æ¥ä½¿ç”¨ï¼Œè€Œä¸é€‚åˆå½“åšä¸€ä¸ªçœŸå®çš„DBã€‚</span>
</span><span id="__span-112-9"><a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a><span class="c1">## å½“æŠŠRediså½“åšä¸€ä¸ªçœŸå®çš„æ•°æ®åº“ä½¿ç”¨çš„æ—¶å€™ï¼Œå†…å­˜ä½¿ç”¨å°†æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å¼€é”€</span>
</span><span id="__span-112-10"><a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a><span class="c1">## maxmemory &lt;bytes&gt;</span>
</span><span id="__span-112-11"><a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a>
</span><span id="__span-112-12"><a id="__codelineno-112-12" name="__codelineno-112-12" href="#__codelineno-112-12"></a><span class="c1">## å½“å†…å­˜è¾¾åˆ°æœ€å¤§å€¼çš„æ—¶å€™Redisä¼šé€‰æ‹©åˆ é™¤å“ªäº›æ•°æ®ï¼Ÿæœ‰äº”ç§æ–¹å¼å¯ä¾›é€‰æ‹©</span>
</span><span id="__span-112-13"><a id="__codelineno-112-13" name="__codelineno-112-13" href="#__codelineno-112-13"></a><span class="c1">#</span>
</span><span id="__span-112-14"><a id="__codelineno-112-14" name="__codelineno-112-14" href="#__codelineno-112-14"></a><span class="c1">## volatile-lru -&gt; åˆ©ç”¨LRUç®—æ³•ç§»é™¤è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´çš„key (LRU:æœ€è¿‘ä½¿ç”¨ Least Recently Used )</span>
</span><span id="__span-112-15"><a id="__codelineno-112-15" name="__codelineno-112-15" href="#__codelineno-112-15"></a><span class="c1">## allkeys-lru -&gt; åˆ©ç”¨LRUç®—æ³•ç§»é™¤ä»»ä½•key</span>
</span><span id="__span-112-16"><a id="__codelineno-112-16" name="__codelineno-112-16" href="#__codelineno-112-16"></a><span class="c1">## volatile-lfu -&gt; åˆ©ç”¨LFUç®—æ³•ç§»é™¤è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´çš„key (LRU:æœ€å°‘ä½¿ç”¨ Least Frequently Used )</span>
</span><span id="__span-112-17"><a id="__codelineno-112-17" name="__codelineno-112-17" href="#__codelineno-112-17"></a><span class="c1">## allkeys-lfu -&gt; åˆ©ç”¨LFUç®—æ³•ç§»é™¤ä»»ä½•key</span>
</span><span id="__span-112-18"><a id="__codelineno-112-18" name="__codelineno-112-18" href="#__codelineno-112-18"></a><span class="c1">## volatile-random -&gt; ç§»é™¤è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´çš„éšæœºkey</span>
</span><span id="__span-112-19"><a id="__codelineno-112-19" name="__codelineno-112-19" href="#__codelineno-112-19"></a><span class="c1">## allkeys-&gt;random -&gt; remove a random key, any key (éšæœºåˆ é™¤)</span>
</span><span id="__span-112-20"><a id="__codelineno-112-20" name="__codelineno-112-20" href="#__codelineno-112-20"></a><span class="c1">## volatile-ttl -&gt; ç§»é™¤å³å°†è¿‡æœŸçš„key(minor TTL)</span>
</span><span id="__span-112-21"><a id="__codelineno-112-21" name="__codelineno-112-21" href="#__codelineno-112-21"></a><span class="c1">## noeviction -&gt; ä¸ç§»é™¤ä»»ä½•keyï¼Œåªæ˜¯è¿”å›ä¸€ä¸ªå†™é”™è¯¯</span>
</span><span id="__span-112-22"><a id="__codelineno-112-22" name="__codelineno-112-22" href="#__codelineno-112-22"></a><span class="c1">#</span>
</span><span id="__span-112-23"><a id="__codelineno-112-23" name="__codelineno-112-23" href="#__codelineno-112-23"></a><span class="c1">## æ³¨æ„ï¼šå¯¹äºä¸Šé¢çš„ç­–ç•¥ï¼Œå¦‚æœæ²¡æœ‰åˆé€‚çš„keyå¯ä»¥ç§»é™¤ï¼Œå½“å†™çš„æ—¶å€™Redisä¼šè¿”å›ä¸€ä¸ªé”™è¯¯</span>
</span><span id="__span-112-24"><a id="__codelineno-112-24" name="__codelineno-112-24" href="#__codelineno-112-24"></a><span class="c1">#</span>
</span><span id="__span-112-25"><a id="__codelineno-112-25" name="__codelineno-112-25" href="#__codelineno-112-25"></a><span class="c1">## å†™å‘½ä»¤åŒ…æ‹¬: set setnx setex append</span>
</span><span id="__span-112-26"><a id="__codelineno-112-26" name="__codelineno-112-26" href="#__codelineno-112-26"></a><span class="c1">## incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span>
</span><span id="__span-112-27"><a id="__codelineno-112-27" name="__codelineno-112-27" href="#__codelineno-112-27"></a><span class="c1">## sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span>
</span><span id="__span-112-28"><a id="__codelineno-112-28" name="__codelineno-112-28" href="#__codelineno-112-28"></a><span class="c1">## zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span>
</span><span id="__span-112-29"><a id="__codelineno-112-29" name="__codelineno-112-29" href="#__codelineno-112-29"></a><span class="c1">## getset mset msetnx exec sort</span>
</span><span id="__span-112-30"><a id="__codelineno-112-30" name="__codelineno-112-30" href="#__codelineno-112-30"></a><span class="c1">#</span>
</span><span id="__span-112-31"><a id="__codelineno-112-31" name="__codelineno-112-31" href="#__codelineno-112-31"></a><span class="c1">## é»˜è®¤æ˜¯:</span>
</span><span id="__span-112-32"><a id="__codelineno-112-32" name="__codelineno-112-32" href="#__codelineno-112-32"></a><span class="c1">#</span>
</span><span id="__span-112-33"><a id="__codelineno-112-33" name="__codelineno-112-33" href="#__codelineno-112-33"></a><span class="c1">## maxmemory-policy volatile-lru</span>
</span></code></pre></div> <h4 id="8110aof-æ¨¡å¼">8.1.10ã€AOF æ¨¡å¼<a class="headerlink" href="#8110aof-æ¨¡å¼" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>AOF APPEND ONLY MODEï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="c1">## é»˜è®¤æƒ…å†µä¸‹ï¼Œredisä¼šåœ¨åå°å¼‚æ­¥çš„æŠŠæ•°æ®åº“é•œåƒå¤‡ä»½åˆ°ç£ç›˜ï¼Œä½†æ˜¯è¯¥å¤‡ä»½æ˜¯éå¸¸è€—æ—¶çš„ï¼Œè€Œä¸”å¤‡ä»½ä¹Ÿä¸èƒ½å¾ˆé¢‘ç¹ï¼Œ</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="c1">## å¦‚æœå‘ç”Ÿè¯¸å¦‚æ‹‰é—¸é™ç”µã€æ‹”æ’å¤´ç­‰çŠ¶å†µï¼Œé‚£ä¹ˆå°†é€ æˆæ¯”è¾ƒå¤§èŒƒå›´çš„æ•°æ®ä¸¢å¤±ã€‚</span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="c1">## æ‰€ä»¥redisæä¾›äº†å¦å¤–ä¸€ç§æ›´åŠ é«˜æ•ˆçš„æ•°æ®åº“å¤‡ä»½åŠç¾éš¾æ¢å¤æ–¹å¼ã€‚</span>
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="c1">## å¼€å¯append onlyæ¨¡å¼ä¹‹åï¼Œredisä¼šæŠŠæ‰€æ¥æ”¶åˆ°çš„æ¯ä¸€æ¬¡å†™æ“ä½œè¯·æ±‚éƒ½è¿½åŠ åˆ°appendonly.aofæ–‡ä»¶ä¸­ï¼Œ</span>
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="c1">## å½“redisé‡æ–°å¯åŠ¨æ—¶ï¼Œä¼šä»è¯¥æ–‡ä»¶æ¢å¤å‡ºä¹‹å‰çš„çŠ¶æ€ã€‚</span>
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a><span class="c1">## ä½†æ˜¯è¿™æ ·ä¼šé€ æˆappendonly.aofæ–‡ä»¶è¿‡å¤§ï¼Œæ‰€ä»¥redisè¿˜æ”¯æŒäº† BGREWRITEAOF æŒ‡ä»¤ï¼Œå¯¹ appendonly.aof è¿›è¡Œé‡æ–°æ•´ç†ã€‚</span>
</span><span id="__span-113-7"><a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="c1">## ä½ å¯ä»¥åŒæ—¶å¼€å¯asynchronous dumps å’Œ AOF</span>
</span><span id="__span-113-8"><a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a>appendonly<span class="w"> </span>no
</span><span id="__span-113-9"><a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a>
</span><span id="__span-113-10"><a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a><span class="c1">## AOFæ–‡ä»¶åç§° (é»˜è®¤: "appendonly.aof")</span>
</span><span id="__span-113-11"><a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a>appendfilename<span class="w"> </span><span class="s2">"appendonly.aof"</span>
</span><span id="__span-113-12"><a id="__codelineno-113-12" name="__codelineno-113-12" href="#__codelineno-113-12"></a>
</span><span id="__span-113-13"><a id="__codelineno-113-13" name="__codelineno-113-13" href="#__codelineno-113-13"></a><span class="c1">## Redisæ”¯æŒä¸‰ç§åŒæ­¥AOFæ–‡ä»¶çš„ç­–ç•¥:</span>
</span><span id="__span-113-14"><a id="__codelineno-113-14" name="__codelineno-113-14" href="#__codelineno-113-14"></a><span class="c1">#</span>
</span><span id="__span-113-15"><a id="__codelineno-113-15" name="__codelineno-113-15" href="#__codelineno-113-15"></a><span class="c1">## no: ä¸è¿›è¡ŒåŒæ­¥ï¼Œç³»ç»Ÿå»æ“ä½œ . Faster.</span>
</span><span id="__span-113-16"><a id="__codelineno-113-16" name="__codelineno-113-16" href="#__codelineno-113-16"></a><span class="c1">## always: alwaysè¡¨ç¤ºæ¯æ¬¡æœ‰å†™æ“ä½œéƒ½è¿›è¡ŒåŒæ­¥. Slow, Safest.</span>
</span><span id="__span-113-17"><a id="__codelineno-113-17" name="__codelineno-113-17" href="#__codelineno-113-17"></a><span class="c1">## everysec: è¡¨ç¤ºå¯¹å†™æ“ä½œè¿›è¡Œç´¯ç§¯ï¼Œæ¯ç§’åŒæ­¥ä¸€æ¬¡. Compromise.</span>
</span><span id="__span-113-18"><a id="__codelineno-113-18" name="__codelineno-113-18" href="#__codelineno-113-18"></a><span class="c1">#</span>
</span><span id="__span-113-19"><a id="__codelineno-113-19" name="__codelineno-113-19" href="#__codelineno-113-19"></a><span class="c1">## é»˜è®¤æ˜¯"everysec"ï¼ŒæŒ‰ç…§é€Ÿåº¦å’Œå®‰å…¨æŠ˜ä¸­è¿™æ˜¯æœ€å¥½çš„ã€‚</span>
</span><span id="__span-113-20"><a id="__codelineno-113-20" name="__codelineno-113-20" href="#__codelineno-113-20"></a><span class="c1">## å¦‚æœæƒ³è®©Redisèƒ½æ›´é«˜æ•ˆçš„è¿è¡Œï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®ä¸º"no"ï¼Œè®©æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™å»æ‰§è¡Œ</span>
</span><span id="__span-113-21"><a id="__codelineno-113-21" name="__codelineno-113-21" href="#__codelineno-113-21"></a><span class="c1">## æˆ–è€…ç›¸åæƒ³è®©æ•°æ®æ›´å®‰å…¨ä½ ä¹Ÿå¯ä»¥è®¾ç½®ä¸º"always"</span>
</span><span id="__span-113-22"><a id="__codelineno-113-22" name="__codelineno-113-22" href="#__codelineno-113-22"></a><span class="c1">#</span>
</span><span id="__span-113-23"><a id="__codelineno-113-23" name="__codelineno-113-23" href="#__codelineno-113-23"></a><span class="c1">## å¦‚æœä¸ç¡®å®šå°±ç”¨ "everysec".</span>
</span><span id="__span-113-24"><a id="__codelineno-113-24" name="__codelineno-113-24" href="#__codelineno-113-24"></a>
</span><span id="__span-113-25"><a id="__codelineno-113-25" name="__codelineno-113-25" href="#__codelineno-113-25"></a><span class="c1">## appendfsync always</span>
</span><span id="__span-113-26"><a id="__codelineno-113-26" name="__codelineno-113-26" href="#__codelineno-113-26"></a>appendfsync<span class="w"> </span>everysec
</span><span id="__span-113-27"><a id="__codelineno-113-27" name="__codelineno-113-27" href="#__codelineno-113-27"></a><span class="c1">## appendfsync no</span>
</span><span id="__span-113-28"><a id="__codelineno-113-28" name="__codelineno-113-28" href="#__codelineno-113-28"></a>
</span><span id="__span-113-29"><a id="__codelineno-113-29" name="__codelineno-113-29" href="#__codelineno-113-29"></a><span class="c1">## bgrewriteaofæœºåˆ¶ï¼Œåœ¨ä¸€ä¸ªå­è¿›ç¨‹ä¸­è¿›è¡Œaofçš„é‡å†™ï¼Œä»è€Œä¸é˜»å¡ä¸»è¿›ç¨‹å¯¹å…¶ä½™å‘½ä»¤çš„å¤„ç†ï¼ŒåŒæ—¶è§£å†³äº†aofæ–‡ä»¶è¿‡å¤§é—®é¢˜</span>
</span><span id="__span-113-30"><a id="__codelineno-113-30" name="__codelineno-113-30" href="#__codelineno-113-30"></a><span class="c1">## åŒæ—¶åœ¨æ‰§è¡Œbgrewriteaofæ“ä½œå’Œä¸»è¿›ç¨‹å†™aofæ–‡ä»¶çš„æ“ä½œï¼Œä¸¤è€…éƒ½ä¼šæ“ä½œç£ç›˜ï¼Œè€Œbgrewriteaofå¾€å¾€ä¼šæ¶‰åŠå¤§é‡ç£ç›˜æ“ä½œï¼Œ</span>
</span><span id="__span-113-31"><a id="__codelineno-113-31" name="__codelineno-113-31" href="#__codelineno-113-31"></a><span class="c1">## è¿™æ ·å°±ä¼šé€ æˆä¸»è¿›ç¨‹åœ¨å†™aofæ–‡ä»¶çš„æ—¶å€™å‡ºç°é˜»å¡çš„æƒ…å½¢ï¼Œç°åœ¨no-appendfsync-on-rewriteå‚æ•°å‡ºåœºäº†ã€‚</span>
</span><span id="__span-113-32"><a id="__codelineno-113-32" name="__codelineno-113-32" href="#__codelineno-113-32"></a><span class="c1">## å¦‚æœè¯¥å‚æ•°è®¾ç½®ä¸ºnoï¼Œæ˜¯æœ€å®‰å…¨çš„æ–¹å¼ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä½†æ˜¯è¦å¿å—é˜»å¡çš„é—®é¢˜ã€‚</span>
</span><span id="__span-113-33"><a id="__codelineno-113-33" name="__codelineno-113-33" href="#__codelineno-113-33"></a><span class="c1">## å¦‚æœè®¾ç½®ä¸ºyeså‘¢ï¼Ÿè¿™å°±ç›¸å½“äºå°†appendfsyncè®¾ç½®ä¸ºnoï¼Œè¿™è¯´æ˜å¹¶æ²¡æœ‰æ‰§è¡Œç£ç›˜æ“ä½œï¼Œåªæ˜¯å†™å…¥äº†ç¼“å†²åŒºï¼Œ</span>
</span><span id="__span-113-34"><a id="__codelineno-113-34" name="__codelineno-113-34" href="#__codelineno-113-34"></a><span class="c1">## å› æ­¤è¿™æ ·å¹¶ä¸ä¼šé€ æˆé˜»å¡ï¼ˆå› ä¸ºæ²¡æœ‰ç«äº‰ç£ç›˜ï¼‰ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªæ—¶å€™redisæŒ‚æ‰ï¼Œå°±ä¼šä¸¢å¤±æ•°æ®ã€‚</span>
</span><span id="__span-113-35"><a id="__codelineno-113-35" name="__codelineno-113-35" href="#__codelineno-113-35"></a><span class="c1">## ä¸¢å¤±å¤šå°‘æ•°æ®å‘¢ï¼Ÿåœ¨linuxçš„æ“ä½œç³»ç»Ÿçš„é»˜è®¤è®¾ç½®ä¸‹ï¼Œæœ€å¤šä¼šä¸¢å¤±30sçš„æ•°æ®ã€‚</span>
</span><span id="__span-113-36"><a id="__codelineno-113-36" name="__codelineno-113-36" href="#__codelineno-113-36"></a>no-appendfsync-on-rewrite<span class="w"> </span>no
</span><span id="__span-113-37"><a id="__codelineno-113-37" name="__codelineno-113-37" href="#__codelineno-113-37"></a>
</span><span id="__span-113-38"><a id="__codelineno-113-38" name="__codelineno-113-38" href="#__codelineno-113-38"></a><span class="c1">## Automatic rewrite of the append only file.</span>
</span><span id="__span-113-39"><a id="__codelineno-113-39" name="__codelineno-113-39" href="#__codelineno-113-39"></a><span class="c1">## AOF è‡ªåŠ¨é‡å†™</span>
</span><span id="__span-113-40"><a id="__codelineno-113-40" name="__codelineno-113-40" href="#__codelineno-113-40"></a><span class="c1">## å½“AOFæ–‡ä»¶å¢é•¿åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™Redisèƒ½å¤Ÿè°ƒç”¨ BGREWRITEAOF å¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œé‡å†™</span>
</span><span id="__span-113-41"><a id="__codelineno-113-41" name="__codelineno-113-41" href="#__codelineno-113-41"></a><span class="c1">#</span>
</span><span id="__span-113-42"><a id="__codelineno-113-42" name="__codelineno-113-42" href="#__codelineno-113-42"></a><span class="c1">## å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„ï¼šRedisä¼šè®°ä½ä¸Šæ¬¡è¿›è¡Œäº›æ—¥å¿—åæ–‡ä»¶çš„å¤§å°(å¦‚æœä»å¼€æœºä»¥æ¥è¿˜æ²¡è¿›è¡Œè¿‡é‡å†™ï¼Œé‚£æ—¥å­å¤§å°åœ¨å¼€æœºçš„æ—¶å€™ç¡®å®š)</span>
</span><span id="__span-113-43"><a id="__codelineno-113-43" name="__codelineno-113-43" href="#__codelineno-113-43"></a><span class="c1">#</span>
</span><span id="__span-113-44"><a id="__codelineno-113-44" name="__codelineno-113-44" href="#__codelineno-113-44"></a><span class="c1">## åŸºç¡€å¤§å°ä¼šåŒç°åœ¨çš„å¤§å°è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœç°åœ¨çš„å¤§å°æ¯”åŸºç¡€å¤§å°å¤§åˆ¶å®šçš„ç™¾åˆ†æ¯”ï¼Œé‡å†™åŠŸèƒ½å°†å¯åŠ¨</span>
</span><span id="__span-113-45"><a id="__codelineno-113-45" name="__codelineno-113-45" href="#__codelineno-113-45"></a><span class="c1">## åŒæ—¶éœ€è¦æŒ‡å®šä¸€ä¸ªæœ€å°å¤§å°ç”¨äºAOFé‡å†™ï¼Œè¿™ä¸ªç”¨äºé˜»æ­¢å³ä½¿æ–‡ä»¶å¾ˆå°ä½†æ˜¯å¢é•¿å¹…åº¦å¾ˆå¤§ä¹Ÿå»é‡å†™AOFæ–‡ä»¶çš„æƒ…å†µ</span>
</span><span id="__span-113-46"><a id="__codelineno-113-46" name="__codelineno-113-46" href="#__codelineno-113-46"></a><span class="c1">#</span>
</span><span id="__span-113-47"><a id="__codelineno-113-47" name="__codelineno-113-47" href="#__codelineno-113-47"></a><span class="c1">## auto-aof-rewrite-percentage:aofæ–‡ä»¶å¢é•¿æ¯”ä¾‹ï¼ŒæŒ‡å½“å‰aofæ–‡ä»¶æ¯”ä¸Šæ¬¡é‡å†™çš„å¢é•¿æ¯”ä¾‹å¤§å°ã€‚</span>
</span><span id="__span-113-48"><a id="__codelineno-113-48" name="__codelineno-113-48" href="#__codelineno-113-48"></a><span class="c1">## aofé‡å†™å³åœ¨aofæ–‡ä»¶åœ¨ä¸€å®šå¤§å°ä¹‹åï¼Œé‡æ–°å°†æ•´ä¸ªå†…å­˜å†™åˆ°aofæ–‡ä»¶å½“ä¸­ï¼Œä»¥åæ˜ æœ€æ–°çš„çŠ¶æ€(ç›¸å½“äºbgsave)ã€‚</span>
</span><span id="__span-113-49"><a id="__codelineno-113-49" name="__codelineno-113-49" href="#__codelineno-113-49"></a><span class="c1">## è¿™æ ·å°±é¿å…äº†aofæ–‡ä»¶è¿‡å¤§è€Œå®é™…å†…å­˜æ•°æ®å°çš„é—®é¢˜(é¢‘ç¹ä¿®æ”¹æ•°æ®é—®é¢˜).è®¾ç½® percentage ä¸º0å°±å…³é—­è¿™ä¸ªç‰¹æ€§</span>
</span><span id="__span-113-50"><a id="__codelineno-113-50" name="__codelineno-113-50" href="#__codelineno-113-50"></a><span class="c1">## </span>
</span><span id="__span-113-51"><a id="__codelineno-113-51" name="__codelineno-113-51" href="#__codelineno-113-51"></a><span class="c1">## auto-aof-rewrite-percentage:aofæ–‡ä»¶é‡å†™æœ€å°çš„æ–‡ä»¶å¤§å°ï¼Œå³æœ€å¼€å§‹aofæ–‡ä»¶å¿…é¡»è¦è¾¾åˆ°è¿™ä¸ªå¤§å°æ‰è§¦å‘ï¼Œ</span>
</span><span id="__span-113-52"><a id="__codelineno-113-52" name="__codelineno-113-52" href="#__codelineno-113-52"></a><span class="c1">## åé¢çš„æ¯æ¬¡é‡å†™å°±ä¸ä¼šæ ¹æ®è¿™ä¸ªå˜é‡äº†(æ ¹æ®ä¸Šä¸€æ¬¡é‡å†™å®Œæˆä¹‹åçš„å¤§å°).</span>
</span><span id="__span-113-53"><a id="__codelineno-113-53" name="__codelineno-113-53" href="#__codelineno-113-53"></a><span class="c1">## æ­¤å˜é‡ä»…åˆå§‹åŒ–å¯åŠ¨redisæœ‰æ•ˆï¼Œå¦‚æœæ˜¯redisæ¢å¤æ—¶ï¼Œåˆ™lastSizeç­‰äºåˆå§‹aofæ–‡ä»¶å¤§å°.</span>
</span><span id="__span-113-54"><a id="__codelineno-113-54" name="__codelineno-113-54" href="#__codelineno-113-54"></a>auto-aof-rewrite-percentage<span class="w"> </span><span class="m">100</span>
</span><span id="__span-113-55"><a id="__codelineno-113-55" name="__codelineno-113-55" href="#__codelineno-113-55"></a>auto-aof-rewrite-min-size<span class="w"> </span>64mb
</span></code></pre></div> <h4 id="8111é›†ç¾¤">8.1.11ã€é›†ç¾¤<a class="headerlink" href="#8111é›†ç¾¤" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>REDIS CLUSTERï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="c1">## åªæœ‰å¼€å¯äº†ä»¥ä¸‹é€‰é¡¹ï¼Œredisæ‰èƒ½æˆä¸ºé›†ç¾¤æœåŠ¡çš„ä¸€éƒ¨åˆ†</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="c1">## cluster-enabled yes</span>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a>
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="c1">## é…ç½®redisè‡ªåŠ¨ç”Ÿæˆçš„é›†ç¾¤é…ç½®æ–‡ä»¶åã€‚ç¡®ä¿åŒä¸€ç³»ç»Ÿä¸­è¿è¡Œçš„å„rediså®ä¾‹è¯¥é…ç½®æ–‡ä»¶ä¸è¦é‡åã€‚</span>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="c1">## ä¸»è¦ç”¨äºè®°å½•é›†ç¾¤ä¸­æœ‰å“ªäº›èŠ‚ç‚¹ã€ä»–ä»¬çš„çŠ¶æ€ä»¥åŠä¸€äº›æŒä¹…åŒ–å‚æ•°ç­‰ï¼Œæ–¹ä¾¿åœ¨é‡å¯æ—¶æ¢å¤è¿™äº›çŠ¶æ€ã€‚</span>
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="c1">## cluster-config-file nodes-6379.conf</span>
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a>
</span><span id="__span-114-8"><a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a><span class="c1">## é›†ç¾¤èŠ‚ç‚¹è¶…æ—¶æ¯«ç§’æ•°ã€‚è¶…æ—¶çš„èŠ‚ç‚¹å°†è¢«è§†ä¸ºä¸å¯ç”¨çŠ¶æ€ã€‚</span>
</span><span id="__span-114-9"><a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="c1">## cluster-node-timeout 15000</span>
</span><span id="__span-114-10"><a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a>
</span><span id="__span-114-11"><a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a><span class="c1">## å¦‚æœæ•°æ®å¤ªæ—§ï¼Œé›†ç¾¤ä¸­çš„ä¸å¯ç”¨masterçš„slaveèŠ‚ç‚¹ä¼šé¿å…æˆä¸ºå¤‡ç”¨masterã€‚</span>
</span><span id="__span-114-12"><a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a><span class="c1">## å¦‚æœslaveå’Œmasterå¤±è”æ—¶é—´è¶…è¿‡:</span>
</span><span id="__span-114-13"><a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a><span class="c1">## (node-timeout * slave-validity-factor) + repl-ping-slave-period </span>
</span><span id="__span-114-14"><a id="__codelineno-114-14" name="__codelineno-114-14" href="#__codelineno-114-14"></a><span class="c1">## åˆ™ä¸ä¼šè¢«æå‡ä¸ºmasterã€‚</span>
</span><span id="__span-114-15"><a id="__codelineno-114-15" name="__codelineno-114-15" href="#__codelineno-114-15"></a><span class="c1">#</span>
</span><span id="__span-114-16"><a id="__codelineno-114-16" name="__codelineno-114-16" href="#__codelineno-114-16"></a><span class="c1">## å¦‚node-timeoutä¸º30ç§’ï¼Œslave-validity-factorä¸º10, é»˜è®¤default repl-ping-slave-periodä¸º10ç§’,</span>
</span><span id="__span-114-17"><a id="__codelineno-114-17" name="__codelineno-114-17" href="#__codelineno-114-17"></a><span class="c1">## å¤±è”æ—¶é—´è¶…è¿‡310ç§’slaveå°±ä¸ä¼šæˆä¸ºmasterã€‚</span>
</span><span id="__span-114-18"><a id="__codelineno-114-18" name="__codelineno-114-18" href="#__codelineno-114-18"></a><span class="c1">## </span>
</span><span id="__span-114-19"><a id="__codelineno-114-19" name="__codelineno-114-19" href="#__codelineno-114-19"></a><span class="c1">## è¾ƒå¤§çš„slave-validity-factorå€¼å¯èƒ½å…è®¸åŒ…å«è¿‡æ—§æ•°æ®çš„slaveæˆä¸ºmasterï¼ŒåŒæ—¶è¾ƒå°çš„å€¼å¯èƒ½ä¼šé˜»æ­¢é›†ç¾¤é€‰ä¸¾å‡ºæ–°masterã€‚</span>
</span><span id="__span-114-20"><a id="__codelineno-114-20" name="__codelineno-114-20" href="#__codelineno-114-20"></a><span class="c1">## ä¸ºäº†è¾¾åˆ°æœ€å¤§é™åº¦çš„é«˜å¯ç”¨æ€§ï¼Œå¯ä»¥è®¾ç½®ä¸º0ï¼Œå³slaveä¸ç®¡å’Œmasterå¤±è”å¤šä¹…éƒ½å¯ä»¥æå‡ä¸ºmaster</span>
</span><span id="__span-114-21"><a id="__codelineno-114-21" name="__codelineno-114-21" href="#__codelineno-114-21"></a><span class="c1">## cluster-slave-validity-factor 10</span>
</span><span id="__span-114-22"><a id="__codelineno-114-22" name="__codelineno-114-22" href="#__codelineno-114-22"></a>
</span><span id="__span-114-23"><a id="__codelineno-114-23" name="__codelineno-114-23" href="#__codelineno-114-23"></a><span class="c1">## åªæœ‰åœ¨ä¹‹å‰masteræœ‰å…¶å®ƒæŒ‡å®šæ•°é‡çš„å·¥ä½œçŠ¶æ€ä¸‹çš„slaveèŠ‚ç‚¹æ—¶ï¼ŒslaveèŠ‚ç‚¹æ‰èƒ½æå‡ä¸ºmasterã€‚</span>
</span><span id="__span-114-24"><a id="__codelineno-114-24" name="__codelineno-114-24" href="#__codelineno-114-24"></a><span class="c1">## é»˜è®¤ä¸º1ï¼ˆå³è¯¥é›†ç¾¤è‡³å°‘æœ‰3ä¸ªèŠ‚ç‚¹ï¼Œ1 masterï¼‹2 slavesï¼Œmasterå®•æœºï¼Œä»æœ‰å¦å¤–1ä¸ªslaveçš„æƒ…å†µä¸‹å…¶ä¸­1ä¸ªslaveå¯ä»¥æå‡ï¼‰</span>
</span><span id="__span-114-25"><a id="__codelineno-114-25" name="__codelineno-114-25" href="#__codelineno-114-25"></a><span class="c1">## æµ‹è¯•ç¯å¢ƒå¯è®¾ç½®ä¸º0ï¼Œç”Ÿæˆç¯å¢ƒä¸­è‡³å°‘è®¾ç½®ä¸º1</span>
</span><span id="__span-114-26"><a id="__codelineno-114-26" name="__codelineno-114-26" href="#__codelineno-114-26"></a><span class="c1">## cluster-migration-barrier 1</span>
</span><span id="__span-114-27"><a id="__codelineno-114-27" name="__codelineno-114-27" href="#__codelineno-114-27"></a>
</span><span id="__span-114-28"><a id="__codelineno-114-28" name="__codelineno-114-28" href="#__codelineno-114-28"></a><span class="c1">## é»˜è®¤æƒ…å†µä¸‹å¦‚æœredisé›†ç¾¤å¦‚æœæ£€æµ‹åˆ°è‡³å°‘æœ‰1ä¸ªhash slotä¸å¯ç”¨ï¼Œé›†ç¾¤å°†åœæ­¢æŸ¥è¯¢æ•°æ®ã€‚</span>
</span><span id="__span-114-29"><a id="__codelineno-114-29" name="__codelineno-114-29" href="#__codelineno-114-29"></a><span class="c1">## å¦‚æœæ‰€æœ‰slotæ¢å¤åˆ™é›†ç¾¤è‡ªåŠ¨æ¢å¤ã€‚</span>
</span><span id="__span-114-30"><a id="__codelineno-114-30" name="__codelineno-114-30" href="#__codelineno-114-30"></a><span class="c1">## å¦‚æœéœ€è¦é›†ç¾¤éƒ¨åˆ†å¯ç”¨æƒ…å†µä¸‹ä»å¯æä¾›æŸ¥è¯¢æœåŠ¡ï¼Œè®¾ç½®ä¸ºnoã€‚</span>
</span><span id="__span-114-31"><a id="__codelineno-114-31" name="__codelineno-114-31" href="#__codelineno-114-31"></a><span class="c1">## cluster-require-full-coverage yes</span>
</span></code></pre></div> <h4 id="8112æ…¢æ—¥å¿—">8.1.12ã€æ…¢æ—¥å¿—<a class="headerlink" href="#8112æ…¢æ—¥å¿—" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>SLOW LOGï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="c1">## Redis Slow Log è®°å½•è¶…è¿‡ç‰¹å®šæ‰§è¡Œæ—¶é—´çš„å‘½ä»¤ã€‚æ‰§è¡Œæ—¶é—´ä¸åŒ…æ‹¬I/Oè®¡ç®—æ¯”å¦‚è¿æ¥å®¢æˆ·ç«¯ï¼Œè¿”å›ç»“æœç­‰ï¼Œåªæ˜¯å‘½ä»¤æ‰§è¡Œæ—¶é—´</span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="c1">#</span>
</span><span id="__span-115-3"><a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="c1">## å¯ä»¥é€šè¿‡ä¸¤ä¸ªå‚æ•°è®¾ç½®slow logï¼šä¸€ä¸ªæ˜¯å‘Šè¯‰Redisæ‰§è¡Œè¶…è¿‡å¤šå°‘æ—¶é—´è¢«è®°å½•çš„å‚æ•°slowlog-log-slower-than(å¾®å¦™)ï¼Œ</span>
</span><span id="__span-115-4"><a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a><span class="c1">## å¦ä¸€ä¸ªæ˜¯slow log çš„é•¿åº¦ã€‚å½“ä¸€ä¸ªæ–°å‘½ä»¤è¢«è®°å½•çš„æ—¶å€™æœ€æ—©çš„å‘½ä»¤å°†è¢«ä»é˜Ÿåˆ—ä¸­ç§»é™¤</span>
</span><span id="__span-115-5"><a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a>
</span><span id="__span-115-6"><a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a><span class="c1">## ä¸‹é¢çš„æ—¶é—´ä»¥å¾®å¦™å¾®å•ä½ï¼Œå› æ­¤1000000ä»£è¡¨ä¸€åˆ†é’Ÿã€‚</span>
</span><span id="__span-115-7"><a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a><span class="c1">## æ³¨æ„åˆ¶å®šä¸€ä¸ªè´Ÿæ•°å°†å…³é—­æ…¢æ—¥å¿—ï¼Œè€Œè®¾ç½®ä¸º0å°†å¼ºåˆ¶æ¯ä¸ªå‘½ä»¤éƒ½ä¼šè®°å½•</span>
</span><span id="__span-115-8"><a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a>slowlog-log-slower-than<span class="w"> </span><span class="m">10000</span>
</span><span id="__span-115-9"><a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a>
</span><span id="__span-115-10"><a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a><span class="c1">## å¯¹æ—¥å¿—é•¿åº¦æ²¡æœ‰é™åˆ¶ï¼Œåªæ˜¯è¦æ³¨æ„å®ƒä¼šæ¶ˆè€—å†…å­˜</span>
</span><span id="__span-115-11"><a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a><span class="c1">## å¯ä»¥é€šè¿‡ SLOWLOG RESET å›æ”¶è¢«æ…¢æ—¥å¿—æ¶ˆè€—çš„å†…å­˜</span>
</span><span id="__span-115-12"><a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a>slowlog-max-len<span class="w"> </span><span class="m">128</span>
</span></code></pre></div> <h3 id="82sentinelconf-è¯¦è§£">8.2ã€sentinel.conf è¯¦è§£<a class="headerlink" href="#82sentinelconf-è¯¦è§£" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="c1">## Example sentinel.conf</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="c1">## *** IMPORTANT ***</span>
</span><span id="__span-116-4"><a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a><span class="c1">## ç»‘å®šIPåœ°å€</span>
</span><span id="__span-116-5"><a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a><span class="c1">## bind 127.0.0.1 192.168.1.1</span>
</span><span id="__span-116-6"><a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a><span class="c1">## ä¿æŠ¤æ¨¡å¼ï¼ˆæ˜¯å¦ç¦æ­¢å¤–éƒ¨é“¾æ¥ï¼Œé™¤ç»‘å®šçš„ipåœ°å€å¤–ï¼‰</span>
</span><span id="__span-116-7"><a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a><span class="c1">## protected-mode no</span>
</span><span id="__span-116-8"><a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a>
</span><span id="__span-116-9"><a id="__codelineno-116-9" name="__codelineno-116-9" href="#__codelineno-116-9"></a><span class="c1">## port &lt;sentinel-port&gt;</span>
</span><span id="__span-116-10"><a id="__codelineno-116-10" name="__codelineno-116-10" href="#__codelineno-116-10"></a><span class="c1">## æ­¤Sentinelå®ä¾‹è¿è¡Œçš„ç«¯å£</span>
</span><span id="__span-116-11"><a id="__codelineno-116-11" name="__codelineno-116-11" href="#__codelineno-116-11"></a>port<span class="w"> </span><span class="m">26379</span>
</span><span id="__span-116-12"><a id="__codelineno-116-12" name="__codelineno-116-12" href="#__codelineno-116-12"></a>
</span><span id="__span-116-13"><a id="__codelineno-116-13" name="__codelineno-116-13" href="#__codelineno-116-13"></a><span class="c1">## é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis Sentinelä¸ä½œä¸ºå®ˆæŠ¤ç¨‹åºè¿è¡Œã€‚ å¦‚æœéœ€è¦ï¼Œå¯ä»¥è®¾ç½®ä¸º yesã€‚</span>
</span><span id="__span-116-14"><a id="__codelineno-116-14" name="__codelineno-116-14" href="#__codelineno-116-14"></a>daemonize<span class="w"> </span>no
</span><span id="__span-116-15"><a id="__codelineno-116-15" name="__codelineno-116-15" href="#__codelineno-116-15"></a>
</span><span id="__span-116-16"><a id="__codelineno-116-16" name="__codelineno-116-16" href="#__codelineno-116-16"></a><span class="c1">## å¯ç”¨å®ˆæŠ¤è¿›ç¨‹è¿è¡Œåï¼ŒRediså°†åœ¨/var/run/redis-sentinel.pidä¸­å†™å…¥ä¸€ä¸ªpidæ–‡ä»¶</span>
</span><span id="__span-116-17"><a id="__codelineno-116-17" name="__codelineno-116-17" href="#__codelineno-116-17"></a>pidfile<span class="w"> </span>/var/run/redis-sentinel.pid
</span><span id="__span-116-18"><a id="__codelineno-116-18" name="__codelineno-116-18" href="#__codelineno-116-18"></a>
</span><span id="__span-116-19"><a id="__codelineno-116-19" name="__codelineno-116-19" href="#__codelineno-116-19"></a><span class="c1">## æŒ‡å®šæ—¥å¿—æ–‡ä»¶åã€‚ å¦‚æœå€¼ä¸ºç©ºï¼Œå°†å¼ºåˆ¶Sentinelæ—¥å¿—æ ‡å‡†è¾“å‡ºã€‚å®ˆæŠ¤è¿›ç¨‹ä¸‹ï¼Œå¦‚æœä½¿ç”¨æ ‡å‡†è¾“å‡ºè¿›è¡Œæ—¥å¿—è®°å½•ï¼Œåˆ™æ—¥å¿—å°†å‘é€åˆ°/dev/null</span>
</span><span id="__span-116-20"><a id="__codelineno-116-20" name="__codelineno-116-20" href="#__codelineno-116-20"></a>logfile<span class="w"> </span><span class="s2">""</span>
</span><span id="__span-116-21"><a id="__codelineno-116-21" name="__codelineno-116-21" href="#__codelineno-116-21"></a>
</span><span id="__span-116-22"><a id="__codelineno-116-22" name="__codelineno-116-22" href="#__codelineno-116-22"></a><span class="c1">## sentinel announce-ip &lt;ip&gt;</span>
</span><span id="__span-116-23"><a id="__codelineno-116-23" name="__codelineno-116-23" href="#__codelineno-116-23"></a><span class="c1">## sentinel announce-port &lt;port&gt;</span>
</span><span id="__span-116-24"><a id="__codelineno-116-24" name="__codelineno-116-24" href="#__codelineno-116-24"></a><span class="c1">#</span>
</span><span id="__span-116-25"><a id="__codelineno-116-25" name="__codelineno-116-25" href="#__codelineno-116-25"></a><span class="c1">## ä¸Šè¿°ä¸¤ä¸ªé…ç½®æŒ‡ä»¤åœ¨ç¯å¢ƒä¸­éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºNATå¯ä»¥é€šè¿‡éæœ¬åœ°åœ°å€ä»å¤–éƒ¨è®¿é—®Sentinelã€‚</span>
</span><span id="__span-116-26"><a id="__codelineno-116-26" name="__codelineno-116-26" href="#__codelineno-116-26"></a><span class="c1">#</span>
</span><span id="__span-116-27"><a id="__codelineno-116-27" name="__codelineno-116-27" href="#__codelineno-116-27"></a><span class="c1">## å½“æä¾›announce-ipæ—¶ï¼ŒSentinelå°†åœ¨é€šä¿¡ä¸­å£°æ˜æŒ‡å®šçš„IPåœ°å€ï¼Œè€Œä¸æ˜¯åƒé€šå¸¸é‚£æ ·è‡ªåŠ¨æ£€æµ‹æœ¬åœ°åœ°å€ã€‚</span>
</span><span id="__span-116-28"><a id="__codelineno-116-28" name="__codelineno-116-28" href="#__codelineno-116-28"></a><span class="c1">#</span>
</span><span id="__span-116-29"><a id="__codelineno-116-29" name="__codelineno-116-29" href="#__codelineno-116-29"></a><span class="c1">## ç±»ä¼¼åœ°ï¼Œå½“æä¾›announce-port æœ‰æ•ˆä¸”éé›¶æ—¶ï¼ŒSentinelå°†å®£å¸ƒæŒ‡å®šçš„TCPç«¯å£ã€‚</span>
</span><span id="__span-116-30"><a id="__codelineno-116-30" name="__codelineno-116-30" href="#__codelineno-116-30"></a><span class="c1">#</span>
</span><span id="__span-116-31"><a id="__codelineno-116-31" name="__codelineno-116-31" href="#__codelineno-116-31"></a><span class="c1">## è¿™ä¸¤ä¸ªé€‰é¡¹ä¸éœ€è¦ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚æœåªæä¾›announce-ipï¼ŒSentinelå°†å®£å‘ŠæŒ‡å®šçš„IPå’Œâ€œportâ€é€‰é¡¹æŒ‡å®šçš„æœåŠ¡å™¨ç«¯å£ã€‚</span>
</span><span id="__span-116-32"><a id="__codelineno-116-32" name="__codelineno-116-32" href="#__codelineno-116-32"></a><span class="c1">## å¦‚æœä»…æä¾›announce-portï¼ŒSentinelå°†é€šå‘Šè‡ªåŠ¨æ£€æµ‹åˆ°çš„æœ¬åœ°IPå’ŒæŒ‡å®šç«¯å£ã€‚</span>
</span><span id="__span-116-33"><a id="__codelineno-116-33" name="__codelineno-116-33" href="#__codelineno-116-33"></a><span class="c1">#</span>
</span><span id="__span-116-34"><a id="__codelineno-116-34" name="__codelineno-116-34" href="#__codelineno-116-34"></a><span class="c1">## Example:</span>
</span><span id="__span-116-35"><a id="__codelineno-116-35" name="__codelineno-116-35" href="#__codelineno-116-35"></a><span class="c1">## sentinel announce-ip 1.2.3.4</span>
</span><span id="__span-116-36"><a id="__codelineno-116-36" name="__codelineno-116-36" href="#__codelineno-116-36"></a>
</span><span id="__span-116-37"><a id="__codelineno-116-37" name="__codelineno-116-37" href="#__codelineno-116-37"></a><span class="c1">## dir &lt;working-directory&gt;</span>
</span><span id="__span-116-38"><a id="__codelineno-116-38" name="__codelineno-116-38" href="#__codelineno-116-38"></a><span class="c1">## æ¯ä¸ªé•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹éƒ½åº”è¯¥æœ‰ä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„å·¥ä½œç›®å½•ã€‚å¯¹äºRedis Sentinelæ¥è¯´ï¼Œ/tmpå°±æ˜¯è‡ªå·±çš„å·¥ä½œç›®å½•ã€‚</span>
</span><span id="__span-116-39"><a id="__codelineno-116-39" name="__codelineno-116-39" href="#__codelineno-116-39"></a>dir<span class="w"> </span>/tmp
</span><span id="__span-116-40"><a id="__codelineno-116-40" name="__codelineno-116-40" href="#__codelineno-116-40"></a>
</span><span id="__span-116-41"><a id="__codelineno-116-41" name="__codelineno-116-41" href="#__codelineno-116-41"></a><span class="c1">## sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span>
</span><span id="__span-116-42"><a id="__codelineno-116-42" name="__codelineno-116-42" href="#__codelineno-116-42"></a><span class="c1">#</span>
</span><span id="__span-116-43"><a id="__codelineno-116-43" name="__codelineno-116-43" href="#__codelineno-116-43"></a><span class="c1">## å‘Šè¯‰Sentinelç›‘å¬æŒ‡å®šä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”åªæœ‰åœ¨è‡³å°‘&lt;quorum&gt;å“¨å…µè¾¾æˆä¸€è‡´çš„æƒ…å†µä¸‹æ‰ä¼šåˆ¤æ–­å®ƒ O_DOWN çŠ¶æ€ã€‚</span>
</span><span id="__span-116-44"><a id="__codelineno-116-44" name="__codelineno-116-44" href="#__codelineno-116-44"></a><span class="c1">## ä¸€èˆ¬å»ºè®®å°†å…¶è®¾ç½®ä¸ºSentinelèŠ‚ç‚¹çš„ä¸€åŠåŠ 1ã€‚ä¸ä»…å¦‚æ­¤ï¼Œquorumè¿˜ä¸SentinelèŠ‚ç‚¹çš„é¢†å¯¼è€…é€‰ä¸¾æœ‰å…³ã€‚</span>
</span><span id="__span-116-45"><a id="__codelineno-116-45" name="__codelineno-116-45" href="#__codelineno-116-45"></a><span class="c1">## ä¸ºäº†é€‰å‡ºSentinelçš„é¢†å¯¼è€…ï¼Œè‡³å°‘éœ€è¦max(quorum, num(sentinels) / 2 + 1)ä¸ªSentinelèŠ‚ç‚¹å‚ä¸é€‰ä¸¾</span>
</span><span id="__span-116-46"><a id="__codelineno-116-46" name="__codelineno-116-46" href="#__codelineno-116-46"></a><span class="c1">#</span>
</span><span id="__span-116-47"><a id="__codelineno-116-47" name="__codelineno-116-47" href="#__codelineno-116-47"></a><span class="c1">## å‰¯æœ¬æ˜¯è‡ªåŠ¨å‘ç°çš„ï¼Œå› æ­¤æ‚¨æ— éœ€æŒ‡å®šå‰¯æœ¬ã€‚</span>
</span><span id="__span-116-48"><a id="__codelineno-116-48" name="__codelineno-116-48" href="#__codelineno-116-48"></a><span class="c1">## Sentinelæœ¬èº«å°†é‡å†™æ­¤é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨å…¶ä»–é…ç½®é€‰é¡¹æ·»åŠ å‰¯æœ¬ã€‚å¦è¯·æ³¨æ„ï¼Œå½“å‰¯æœ¬å‡çº§ä¸ºä¸»å‰¯æœ¬æ—¶ï¼Œå°†é‡å†™é…ç½®æ–‡ä»¶ã€‚</span>
</span><span id="__span-116-49"><a id="__codelineno-116-49" name="__codelineno-116-49" href="#__codelineno-116-49"></a><span class="c1">#</span>
</span><span id="__span-116-50"><a id="__codelineno-116-50" name="__codelineno-116-50" href="#__codelineno-116-50"></a><span class="c1">## æ³¨æ„ï¼šä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰åç§°ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦æˆ–ç©ºæ ¼ã€‚</span>
</span><span id="__span-116-51"><a id="__codelineno-116-51" name="__codelineno-116-51" href="#__codelineno-116-51"></a><span class="c1">## æœ‰æ•ˆå­—ç¬¦å¯ä»¥æ˜¯ A-z 0-9 å’Œè¿™ä¸‰ä¸ªå­—ç¬¦ ".-_".</span>
</span><span id="__span-116-52"><a id="__codelineno-116-52" name="__codelineno-116-52" href="#__codelineno-116-52"></a>sentinel<span class="w"> </span>monitor<span class="w"> </span>mymaster<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="m">6379</span><span class="w"> </span><span class="m">2</span>
</span><span id="__span-116-53"><a id="__codelineno-116-53" name="__codelineno-116-53" href="#__codelineno-116-53"></a>
</span><span id="__span-116-54"><a id="__codelineno-116-54" name="__codelineno-116-54" href="#__codelineno-116-54"></a><span class="c1">## å¦‚æœredisé…ç½®äº†å¯†ç ï¼Œé‚£è¿™é‡Œå¿…é¡»é…ç½®è®¤è¯ï¼Œå¦åˆ™ä¸èƒ½è‡ªåŠ¨åˆ‡æ¢</span>
</span><span id="__span-116-55"><a id="__codelineno-116-55" name="__codelineno-116-55" href="#__codelineno-116-55"></a><span class="c1">## Example:</span>
</span><span id="__span-116-56"><a id="__codelineno-116-56" name="__codelineno-116-56" href="#__codelineno-116-56"></a><span class="c1">## sentinel auth-pass mymaster MySUPER--secret-0123passw0rd</span>
</span><span id="__span-116-57"><a id="__codelineno-116-57" name="__codelineno-116-57" href="#__codelineno-116-57"></a>
</span><span id="__span-116-58"><a id="__codelineno-116-58" name="__codelineno-116-58" href="#__codelineno-116-58"></a><span class="c1">## sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span>
</span><span id="__span-116-59"><a id="__codelineno-116-59" name="__codelineno-116-59" href="#__codelineno-116-59"></a><span class="c1">#</span>
</span><span id="__span-116-60"><a id="__codelineno-116-60" name="__codelineno-116-60" href="#__codelineno-116-60"></a><span class="c1">## ä¸»èŠ‚ç‚¹åœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰å›å¤PINGï¼Œä¾¿è®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸ºä¸»è§‚ä¸‹çº¿ S_DOWN çŠ¶æ€ã€‚</span>
</span><span id="__span-116-61"><a id="__codelineno-116-61" name="__codelineno-116-61" href="#__codelineno-116-61"></a><span class="c1">## éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥å‚æ•°ä¸ä»…ç”¨æ¥åˆ¤æ–­ä¸»èŠ‚ç‚¹çŠ¶æ€ï¼ŒåŒæ ·ä¹Ÿç”¨æ¥åˆ¤æ–­è¯¥ä¸»èŠ‚ç‚¹ä¸‹é¢çš„ä»èŠ‚ç‚¹åŠå…¶å®ƒsentinelçš„çŠ¶æ€</span>
</span><span id="__span-116-62"><a id="__codelineno-116-62" name="__codelineno-116-62" href="#__codelineno-116-62"></a><span class="c1">## é»˜è®¤æ˜¯30ç§’</span>
</span><span id="__span-116-63"><a id="__codelineno-116-63" name="__codelineno-116-63" href="#__codelineno-116-63"></a>sentinel<span class="w"> </span>down-after-milliseconds<span class="w"> </span>mymaster<span class="w"> </span><span class="m">30000</span>
</span><span id="__span-116-64"><a id="__codelineno-116-64" name="__codelineno-116-64" href="#__codelineno-116-64"></a>
</span><span id="__span-116-65"><a id="__codelineno-116-65" name="__codelineno-116-65" href="#__codelineno-116-65"></a><span class="c1">## sentinel parallel-syncs &lt;master-name&gt; &lt;numreplicas&gt;</span>
</span><span id="__span-116-66"><a id="__codelineno-116-66" name="__codelineno-116-66" href="#__codelineno-116-66"></a><span class="c1">#</span>
</span><span id="__span-116-67"><a id="__codelineno-116-67" name="__codelineno-116-67" href="#__codelineno-116-67"></a><span class="c1">## åœ¨æ•…éšœè½¬ç§»æœŸé—´ï¼Œå¤šå°‘ä¸ªå‰¯æœ¬èŠ‚ç‚¹è¿›è¡Œæ•°æ®åŒæ­¥</span>
</span><span id="__span-116-68"><a id="__codelineno-116-68" name="__codelineno-116-68" href="#__codelineno-116-68"></a><span class="c1">## å¦‚æœnumslavesè®¾ç½®è¾ƒå¤§çš„è¯ï¼Œè™½ç„¶å¤åˆ¶æ“ä½œå¹¶ä¸ä¼šé˜»å¡ä¸»èŠ‚ç‚¹ï¼Œä½†å¤šä¸ªèŠ‚ç‚¹åŒæ—¶æŒ‡å‘æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä¼šå¢åŠ ä¸»èŠ‚ç‚¹çš„ç½‘ç»œå’Œç£ç›˜IOè´Ÿè½½ã€‚</span>
</span><span id="__span-116-69"><a id="__codelineno-116-69" name="__codelineno-116-69" href="#__codelineno-116-69"></a>sentinel<span class="w"> </span>parallel-syncs<span class="w"> </span>mymaster<span class="w"> </span><span class="m">1</span>
</span><span id="__span-116-70"><a id="__codelineno-116-70" name="__codelineno-116-70" href="#__codelineno-116-70"></a>
</span><span id="__span-116-71"><a id="__codelineno-116-71" name="__codelineno-116-71" href="#__codelineno-116-71"></a><span class="c1">## sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span>
</span><span id="__span-116-72"><a id="__codelineno-116-72" name="__codelineno-116-72" href="#__codelineno-116-72"></a><span class="c1">#</span>
</span><span id="__span-116-73"><a id="__codelineno-116-73" name="__codelineno-116-73" href="#__codelineno-116-73"></a><span class="c1">## æŒ‡å®šæ•…éšœè½¬ç§»è¶…æ—¶ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚ å®ƒä»¥å¤šç§æ–¹å¼ä½¿ç”¨ï¼š</span>
</span><span id="__span-116-74"><a id="__codelineno-116-74" name="__codelineno-116-74" href="#__codelineno-116-74"></a><span class="c1">#</span>
</span><span id="__span-116-75"><a id="__codelineno-116-75" name="__codelineno-116-75" href="#__codelineno-116-75"></a><span class="c1">## - åœ¨å…ˆå‰çš„æ•…éšœè½¬ç§»ä¹‹åé‡æ–°å¯åŠ¨æ•…éšœè½¬ç§»æ‰€éœ€çš„æ—¶é—´å·²ç”±ç»™å®šçš„Sentinelé’ˆå¯¹åŒä¸€ä¸»æœåŠ¡å™¨å°è¯•ï¼Œæ˜¯æ•…éšœè½¬ç§»è¶…æ—¶çš„ä¸¤å€ã€‚</span>
</span><span id="__span-116-76"><a id="__codelineno-116-76" name="__codelineno-116-76" href="#__codelineno-116-76"></a><span class="c1">## - å½“ä¸€ä¸ªslaveä»ä¸€ä¸ªé”™è¯¯çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®å¼€å§‹è®¡ç®—æ—¶é—´ã€‚ç›´åˆ°slaveè¢«çº æ­£ä¸ºå‘æ­£ç¡®çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®æ—¶ã€‚</span>
</span><span id="__span-116-77"><a id="__codelineno-116-77" name="__codelineno-116-77" href="#__codelineno-116-77"></a><span class="c1">## - å–æ¶ˆå·²åœ¨è¿›è¡Œä½†æœªç”Ÿæˆä»»ä½•é…ç½®æ›´æ”¹çš„æ•…éšœè½¬ç§»æ‰€éœ€çš„æ—¶é—´</span>
</span><span id="__span-116-78"><a id="__codelineno-116-78" name="__codelineno-116-78" href="#__codelineno-116-78"></a><span class="c1">## - å½“è¿›è¡Œfailoveræ—¶ï¼Œé…ç½®æ‰€æœ‰slavesæŒ‡å‘æ–°çš„masteræ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚</span>
</span><span id="__span-116-79"><a id="__codelineno-116-79" name="__codelineno-116-79" href="#__codelineno-116-79"></a><span class="c1">##   å³ä½¿è¿‡äº†è¿™ä¸ªè¶…æ—¶ï¼Œslavesä¾ç„¶ä¼šè¢«æ­£ç¡®é…ç½®ä¸ºæŒ‡å‘masterã€‚</span>
</span><span id="__span-116-80"><a id="__codelineno-116-80" name="__codelineno-116-80" href="#__codelineno-116-80"></a><span class="c1">## é»˜è®¤3åˆ†é’Ÿ</span>
</span><span id="__span-116-81"><a id="__codelineno-116-81" name="__codelineno-116-81" href="#__codelineno-116-81"></a>sentinel<span class="w"> </span>failover-timeout<span class="w"> </span>mymaster<span class="w"> </span><span class="m">180000</span>
</span><span id="__span-116-82"><a id="__codelineno-116-82" name="__codelineno-116-82" href="#__codelineno-116-82"></a>
</span><span id="__span-116-83"><a id="__codelineno-116-83" name="__codelineno-116-83" href="#__codelineno-116-83"></a><span class="c1">## è„šæœ¬æ‰§è¡Œ</span>
</span><span id="__span-116-84"><a id="__codelineno-116-84" name="__codelineno-116-84" href="#__codelineno-116-84"></a><span class="c1">#</span>
</span><span id="__span-116-85"><a id="__codelineno-116-85" name="__codelineno-116-85" href="#__codelineno-116-85"></a><span class="c1">## sentinel notification-scriptå’Œsentinel reconfig-scriptç”¨äºé…ç½®è°ƒç”¨çš„è„šæœ¬ï¼Œä»¥é€šçŸ¥ç³»ç»Ÿç®¡ç†å‘˜æˆ–åœ¨æ•…éšœè½¬ç§»åé‡æ–°é…ç½®å®¢æˆ·ç«¯ã€‚</span>
</span><span id="__span-116-86"><a id="__codelineno-116-86" name="__codelineno-116-86" href="#__codelineno-116-86"></a><span class="c1">## è„šæœ¬ä½¿ç”¨ä»¥ä¸‹è§„åˆ™æ‰§è¡Œä»¥è¿›è¡Œé”™è¯¯å¤„ç†ï¼š</span>
</span><span id="__span-116-87"><a id="__codelineno-116-87" name="__codelineno-116-87" href="#__codelineno-116-87"></a><span class="c1">#</span>
</span><span id="__span-116-88"><a id="__codelineno-116-88" name="__codelineno-116-88" href="#__codelineno-116-88"></a><span class="c1">## å¦‚æœè„šæœ¬ä»¥â€œ1â€é€€å‡ºï¼Œåˆ™ç¨åé‡è¯•æ‰§è¡Œï¼ˆæœ€å¤šé‡è¯•æ¬¡æ•°ä¸ºå½“å‰è®¾ç½®çš„10æ¬¡ï¼‰ã€‚</span>
</span><span id="__span-116-89"><a id="__codelineno-116-89" name="__codelineno-116-89" href="#__codelineno-116-89"></a><span class="c1">#</span>
</span><span id="__span-116-90"><a id="__codelineno-116-90" name="__codelineno-116-90" href="#__codelineno-116-90"></a><span class="c1">## å¦‚æœè„šæœ¬ä»¥â€œ2â€ï¼ˆæˆ–æ›´é«˜çš„å€¼ï¼‰é€€å‡ºï¼Œåˆ™ä¸ä¼šé‡è¯•æ‰§è¡Œã€‚</span>
</span><span id="__span-116-91"><a id="__codelineno-116-91" name="__codelineno-116-91" href="#__codelineno-116-91"></a><span class="c1">#</span>
</span><span id="__span-116-92"><a id="__codelineno-116-92" name="__codelineno-116-92" href="#__codelineno-116-92"></a><span class="c1">## å¦‚æœè„šæœ¬å› ä¸ºæ”¶åˆ°ä¿¡å·è€Œç»ˆæ­¢ï¼Œåˆ™è¡Œä¸ºä¸é€€å‡ºä»£ç 1ç›¸åŒã€‚</span>
</span><span id="__span-116-93"><a id="__codelineno-116-93" name="__codelineno-116-93" href="#__codelineno-116-93"></a><span class="c1">#</span>
</span><span id="__span-116-94"><a id="__codelineno-116-94" name="__codelineno-116-94" href="#__codelineno-116-94"></a><span class="c1">## è„šæœ¬çš„æœ€é•¿è¿è¡Œæ—¶é—´ä¸º60ç§’ã€‚ è¾¾åˆ°æ­¤é™åˆ¶åï¼Œè„šæœ¬å°†ä»¥SIGKILLç»ˆæ­¢ï¼Œå¹¶é‡è¯•æ‰§è¡Œã€‚</span>
</span><span id="__span-116-95"><a id="__codelineno-116-95" name="__codelineno-116-95" href="#__codelineno-116-95"></a>
</span><span id="__span-116-96"><a id="__codelineno-116-96" name="__codelineno-116-96" href="#__codelineno-116-96"></a><span class="c1">## é€šçŸ¥è„šæœ¬</span>
</span><span id="__span-116-97"><a id="__codelineno-116-97" name="__codelineno-116-97" href="#__codelineno-116-97"></a><span class="c1">#</span>
</span><span id="__span-116-98"><a id="__codelineno-116-98" name="__codelineno-116-98" href="#__codelineno-116-98"></a><span class="c1">## sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span>
</span><span id="__span-116-99"><a id="__codelineno-116-99" name="__codelineno-116-99" href="#__codelineno-116-99"></a><span class="c1">#</span>
</span><span id="__span-116-100"><a id="__codelineno-116-100" name="__codelineno-116-100" href="#__codelineno-116-100"></a><span class="c1">## ä¸ºè­¦å‘Šçº§åˆ«ç”Ÿæˆçš„ä»»ä½•Sentineläº‹ä»¶è°ƒç”¨æŒ‡å®šçš„é€šçŸ¥è„šæœ¬ï¼ˆä¾‹å¦‚-sdownï¼Œ-odownç­‰ï¼‰ã€‚</span>
</span><span id="__span-116-101"><a id="__codelineno-116-101" name="__codelineno-116-101" href="#__codelineno-116-101"></a><span class="c1">## æ­¤è„šæœ¬åº”é€šè¿‡ç”µå­é‚®ä»¶ï¼ŒSMSæˆ–ä»»ä½•å…¶ä»–æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿé€šçŸ¥ç³»ç»Ÿç®¡ç†å‘˜ ç›‘æ§çš„Redisç³»ç»Ÿå‡ºäº†é—®é¢˜ã€‚</span>
</span><span id="__span-116-102"><a id="__codelineno-116-102" name="__codelineno-116-102" href="#__codelineno-116-102"></a><span class="c1">#</span>
</span><span id="__span-116-103"><a id="__codelineno-116-103" name="__codelineno-116-103" href="#__codelineno-116-103"></a><span class="c1">## ä½¿ç”¨ä¸¤ä¸ªå‚æ•°è°ƒç”¨è„šæœ¬ï¼šç¬¬ä¸€ä¸ªæ˜¯äº‹ä»¶ç±»å‹ï¼Œç¬¬äºŒä¸ªæ˜¯äº‹ä»¶æè¿°ã€‚</span>
</span><span id="__span-116-104"><a id="__codelineno-116-104" name="__codelineno-116-104" href="#__codelineno-116-104"></a><span class="c1">#</span>
</span><span id="__span-116-105"><a id="__codelineno-116-105" name="__codelineno-116-105" href="#__codelineno-116-105"></a><span class="c1">## è¯¥è„šæœ¬å¿…é¡»å­˜åœ¨ä¸”å¯æ‰§è¡Œï¼Œä»¥ä¾¿åœ¨æä¾›æ­¤é€‰é¡¹æ—¶å¯åŠ¨sentinelã€‚</span>
</span><span id="__span-116-106"><a id="__codelineno-116-106" name="__codelineno-116-106" href="#__codelineno-116-106"></a><span class="c1">#</span>
</span><span id="__span-116-107"><a id="__codelineno-116-107" name="__codelineno-116-107" href="#__codelineno-116-107"></a><span class="c1">## ä¸¾ä¾‹:</span>
</span><span id="__span-116-108"><a id="__codelineno-116-108" name="__codelineno-116-108" href="#__codelineno-116-108"></a><span class="c1">## sentinel notification-script mymaster /var/redis/notify.sh</span>
</span><span id="__span-116-109"><a id="__codelineno-116-109" name="__codelineno-116-109" href="#__codelineno-116-109"></a>
</span><span id="__span-116-110"><a id="__codelineno-116-110" name="__codelineno-116-110" href="#__codelineno-116-110"></a><span class="c1">## å®¢æˆ·é‡æ–°é…ç½®è„šæœ¬</span>
</span><span id="__span-116-111"><a id="__codelineno-116-111" name="__codelineno-116-111" href="#__codelineno-116-111"></a><span class="c1">#</span>
</span><span id="__span-116-112"><a id="__codelineno-116-112" name="__codelineno-116-112" href="#__codelineno-116-112"></a><span class="c1">## sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span>
</span><span id="__span-116-113"><a id="__codelineno-116-113" name="__codelineno-116-113" href="#__codelineno-116-113"></a><span class="c1">#</span>
</span><span id="__span-116-114"><a id="__codelineno-116-114" name="__codelineno-116-114" href="#__codelineno-116-114"></a><span class="c1">## å½“ä¸»æœåŠ¡å™¨å› æ•…éšœè½¬ç§»è€Œå˜æ›´æ—¶ï¼Œå¯ä»¥è°ƒç”¨è„šæœ¬æ‰§è¡Œç‰¹å®šäºåº”ç”¨ç¨‹åºçš„ä»»åŠ¡ï¼Œä»¥é€šçŸ¥å®¢æˆ·ç«¯ï¼Œé…ç½®å·²æ›´æ”¹ä¸”ä¸»æœåŠ¡å™¨åœ°å€å·²ç»å˜æ›´ã€‚</span>
</span><span id="__span-116-115"><a id="__codelineno-116-115" name="__codelineno-116-115" href="#__codelineno-116-115"></a><span class="c1">#</span>
</span><span id="__span-116-116"><a id="__codelineno-116-116" name="__codelineno-116-116" href="#__codelineno-116-116"></a><span class="c1">## ä»¥ä¸‹å‚æ•°å°†ä¼ é€’ç»™è„šæœ¬ï¼š</span>
</span><span id="__span-116-117"><a id="__codelineno-116-117" name="__codelineno-116-117" href="#__codelineno-116-117"></a><span class="c1">#</span>
</span><span id="__span-116-118"><a id="__codelineno-116-118" name="__codelineno-116-118" href="#__codelineno-116-118"></a><span class="c1">## &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span>
</span><span id="__span-116-119"><a id="__codelineno-116-119" name="__codelineno-116-119" href="#__codelineno-116-119"></a><span class="c1">#</span>
</span><span id="__span-116-120"><a id="__codelineno-116-120" name="__codelineno-116-120" href="#__codelineno-116-120"></a><span class="c1">## &lt;state&gt; ç›®å‰å§‹ç»ˆæ˜¯æ•…éšœè½¬ç§» "failover"</span>
</span><span id="__span-116-121"><a id="__codelineno-116-121" name="__codelineno-116-121" href="#__codelineno-116-121"></a><span class="c1">## &lt;role&gt; æ˜¯ "leader" æˆ– "observer"</span>
</span><span id="__span-116-122"><a id="__codelineno-116-122" name="__codelineno-116-122" href="#__codelineno-116-122"></a><span class="c1">#</span>
</span><span id="__span-116-123"><a id="__codelineno-116-123" name="__codelineno-116-123" href="#__codelineno-116-123"></a><span class="c1">## å‚æ•° from-ip, from-port, to-ip, to-port ç”¨äºä¼ é€’ä¸»æœåŠ¡å™¨çš„æ—§åœ°å€å’Œæ‰€é€‰å‰¯æœ¬çš„æ–°åœ°å€ã€‚</span>
</span><span id="__span-116-124"><a id="__codelineno-116-124" name="__codelineno-116-124" href="#__codelineno-116-124"></a><span class="c1">#</span>
</span><span id="__span-116-125"><a id="__codelineno-116-125" name="__codelineno-116-125" href="#__codelineno-116-125"></a><span class="c1">## ä¸¾ä¾‹:</span>
</span><span id="__span-116-126"><a id="__codelineno-116-126" name="__codelineno-116-126" href="#__codelineno-116-126"></a><span class="c1">## sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span>
</span><span id="__span-116-127"><a id="__codelineno-116-127" name="__codelineno-116-127" href="#__codelineno-116-127"></a>
</span><span id="__span-116-128"><a id="__codelineno-116-128" name="__codelineno-116-128" href="#__codelineno-116-128"></a><span class="c1">## å®‰å…¨</span>
</span><span id="__span-116-129"><a id="__codelineno-116-129" name="__codelineno-116-129" href="#__codelineno-116-129"></a><span class="c1">## é¿å…è„šæœ¬é‡ç½®ï¼Œé»˜è®¤å€¼yes</span>
</span><span id="__span-116-130"><a id="__codelineno-116-130" name="__codelineno-116-130" href="#__codelineno-116-130"></a><span class="c1">## é»˜è®¤æƒ…å†µä¸‹ï¼ŒSENTINEL SETå°†æ— æ³•åœ¨è¿è¡Œæ—¶æ›´æ”¹notification-scriptå’Œclient-reconfig-scriptã€‚</span>
</span><span id="__span-116-131"><a id="__codelineno-116-131" name="__codelineno-116-131" href="#__codelineno-116-131"></a><span class="c1">## è¿™é¿å…äº†ä¸€ä¸ªç®€å•çš„å®‰å…¨é—®é¢˜ï¼Œå®¢æˆ·ç«¯å¯ä»¥å°†è„šæœ¬è®¾ç½®ä¸ºä»»ä½•å†…å®¹å¹¶è§¦å‘æ•…éšœè½¬ç§»ä»¥ä¾¿æ‰§è¡Œç¨‹åºã€‚</span>
</span><span id="__span-116-132"><a id="__codelineno-116-132" name="__codelineno-116-132" href="#__codelineno-116-132"></a>sentinel<span class="w"> </span>deny-scripts-reconfig<span class="w"> </span>yes
</span><span id="__span-116-133"><a id="__codelineno-116-133" name="__codelineno-116-133" href="#__codelineno-116-133"></a>
</span><span id="__span-116-134"><a id="__codelineno-116-134" name="__codelineno-116-134" href="#__codelineno-116-134"></a><span class="c1">## REDISå‘½ä»¤é‡å‘½å</span>
</span><span id="__span-116-135"><a id="__codelineno-116-135" name="__codelineno-116-135" href="#__codelineno-116-135"></a><span class="c1">#</span>
</span><span id="__span-116-136"><a id="__codelineno-116-136" name="__codelineno-116-136" href="#__codelineno-116-136"></a><span class="c1">## åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å‘Šè¯‰Sentinelä½¿ç”¨ä¸åŒçš„å‘½ä»¤åç§°è€Œä¸æ˜¯æ­£å¸¸çš„å‘½ä»¤åç§°ã€‚</span>
</span><span id="__span-116-137"><a id="__codelineno-116-137" name="__codelineno-116-137" href="#__codelineno-116-137"></a><span class="c1">## ä¾‹å¦‚ï¼Œå¦‚æœä¸»â€œmymasterâ€å’Œç›¸å…³å‰¯æœ¬çš„â€œCONFIGâ€å…¨éƒ¨é‡å‘½åä¸ºâ€œGUESSMEâ€ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ï¼š</span>
</span><span id="__span-116-138"><a id="__codelineno-116-138" name="__codelineno-116-138" href="#__codelineno-116-138"></a><span class="c1">#</span>
</span><span id="__span-116-139"><a id="__codelineno-116-139" name="__codelineno-116-139" href="#__codelineno-116-139"></a><span class="c1">## SENTINEL rename-command mymaster CONFIG GUESSME</span>
</span><span id="__span-116-140"><a id="__codelineno-116-140" name="__codelineno-116-140" href="#__codelineno-116-140"></a><span class="c1">#</span>
</span><span id="__span-116-141"><a id="__codelineno-116-141" name="__codelineno-116-141" href="#__codelineno-116-141"></a><span class="c1">## è®¾ç½®æ­¤ç±»é…ç½®åï¼Œæ¯æ¬¡Sentinelä½¿ç”¨CONFIGæ—¶ï¼Œå®ƒå°†ä½¿ç”¨GUESSMEã€‚ </span>
</span><span id="__span-116-142"><a id="__codelineno-116-142" name="__codelineno-116-142" href="#__codelineno-116-142"></a><span class="c1">## è¯·æ³¨æ„ï¼Œå®é™…ä¸Šä¸éœ€è¦å°Šé‡å‘½ä»¤æ¡ˆä¾‹ï¼Œå› æ­¤åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­å†™â€œconfig guessmeâ€æ˜¯ç›¸åŒçš„ã€‚</span>
</span><span id="__span-116-143"><a id="__codelineno-116-143" name="__codelineno-116-143" href="#__codelineno-116-143"></a><span class="c1">#</span>
</span><span id="__span-116-144"><a id="__codelineno-116-144" name="__codelineno-116-144" href="#__codelineno-116-144"></a><span class="c1">## SENTINEL SETä¹Ÿå¯ç”¨äºåœ¨è¿è¡Œæ—¶æ‰§è¡Œæ­¤é…ç½®ã€‚</span>
</span><span id="__span-116-145"><a id="__codelineno-116-145" name="__codelineno-116-145" href="#__codelineno-116-145"></a><span class="c1">#</span>
</span><span id="__span-116-146"><a id="__codelineno-116-146" name="__codelineno-116-146" href="#__codelineno-116-146"></a><span class="c1">## ä¸ºäº†å°†å‘½ä»¤è®¾ç½®å›å…¶åŸå§‹åç§°ï¼ˆæ’¤æ¶ˆé‡å‘½åï¼‰ï¼Œå¯ä»¥å°†å‘½ä»¤é‡å‘½åä¸ºå®ƒè‡ªèº«ï¼š</span>
</span><span id="__span-116-147"><a id="__codelineno-116-147" name="__codelineno-116-147" href="#__codelineno-116-147"></a><span class="c1">#</span>
</span><span id="__span-116-148"><a id="__codelineno-116-148" name="__codelineno-116-148" href="#__codelineno-116-148"></a><span class="c1">## SENTINEL rename-command mymaster CONFIG CONFIG</span>
</span></code></pre></div> <h2 id="9æŒä¹…åŒ–">9ã€æŒä¹…åŒ–<a class="headerlink" href="#9æŒä¹…åŒ–" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>ä»€ä¹ˆæ˜¯RedisæŒä¹…åŒ–ï¼Ÿ</p> <p>Redis ä½œä¸ºä¸€ä¸ªé”®å€¼å¯¹å†…å­˜æ•°æ®åº“ï¼ˆNoSQLï¼‰ï¼Œæ•°æ®éƒ½å­˜å‚¨åœ¨å†…å­˜å½“ä¸­ï¼Œåœ¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œæ‰€æœ‰æ“ä½œéƒ½åœ¨å†…å­˜å½“ä¸­è¿›è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/16b91484c4f516d5.webp" data-desc-position="bottom"><img src="!assets/Redis/16b91484c4f516d5.webp" alt="img" style="zoom:67%;"></a></p> <p>ä½†æ˜¯ï¼Œ å­˜å‚¨åœ¨å†…å­˜å½“ä¸­çš„æ•°æ®ï¼Œåªè¦æœåŠ¡å™¨å…³æœº(å„ç§åŸå› å¼•èµ·çš„)ï¼Œå†…å­˜ä¸­çš„æ•°æ®å°±ä¼šæ¶ˆå¤±äº†ï¼Œä¸ä»…æœåŠ¡å™¨å…³æœºä¼šé€ æˆæ•°æ®æ¶ˆå¤±ï¼ŒRedis æœåŠ¡å™¨å®ˆæŠ¤è¿›ç¨‹é€€å‡ºï¼Œå†…å­˜ä¸­çš„æ•°æ®ä¹Ÿä¸€æ ·ä¼šæ¶ˆå¤±ã€‚</p> <p>å¯¹äºåªæŠŠ Redis å½“ç¼“å­˜æ¥ç”¨çš„é¡¹ç›®æ¥è¯´ï¼Œæ•°æ®æ¶ˆå¤±æˆ–è®¸é—®é¢˜ä¸å¤§ï¼Œé‡æ–°ä»æ•°æ®æºæŠŠæ•°æ®åŠ è½½è¿›æ¥å°±å¯ä»¥äº†ï¼Œä½†å¦‚æœç›´æ¥æŠŠç”¨æˆ·æäº¤çš„ä¸šåŠ¡æ•°æ®å­˜å‚¨åœ¨ Redis å½“ä¸­ï¼ŒæŠŠ Redis ä½œä¸ºæ•°æ®åº“æ¥ä½¿ç”¨ï¼Œåœ¨å…¶æ”¾å­˜å‚¨é‡è¦ä¸šåŠ¡æ•°æ®ï¼Œé‚£ä¹ˆ Redis çš„å†…å­˜æ•°æ®ä¸¢å¤±æ‰€é€ æˆçš„å½±å“ä¹Ÿè®¸æ˜¯æ¯ç­æ€§ã€‚</p> <p>ä¸ºäº†é¿å…å†…å­˜ä¸­æ•°æ®ä¸¢å¤±ï¼ŒRedis æä¾›äº† RDB å’Œ AOF ä¸¤ç§ä¸åŒçš„æ•°æ®æŒä¹…åŒ–æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸åŒçš„æ–¹å¼å°†æ•°æ®ä»å†…å­˜ä¸­ä¿å­˜åˆ°ç¡¬ç›˜å½“ä¸­ï¼Œä½¿æ•°æ®å¯ä»¥æŒä¹…åŒ–ä¿å­˜ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/16b9148bc2eb53a5.webp" data-desc-position="bottom"><img src="!assets/Redis/16b9148bc2eb53a5.webp" alt="img" style="zoom:67%;"></a></p> <h3 id="91rdb">9.1ã€RDB<a class="headerlink" href="#91rdb" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>RDBï¼ˆRedis DataBaseï¼‰ æ˜¯ä¸€ç§å¿«ç…§å­˜å‚¨æŒä¹…åŒ–æ–¹å¼ï¼Œå…·ä½“å°±æ˜¯å°† Redis æŸä¸€æ—¶åˆ»çš„å†…å­˜æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜çš„æ–‡ä»¶å½“ä¸­ï¼Œé»˜è®¤ä¿å­˜çš„æ–‡ä»¶åä¸º dump.rdbï¼Œè€Œåœ¨ Redis æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œä¼šé‡æ–°åŠ è½½ dump.rdb æ–‡ä»¶çš„æ•°æ®åˆ°å†…å­˜å½“ä¸­æ¢å¤æ•°æ®ã€‚</p> <h4 id="911å¼€å¯-rdb-æŒä¹…åŒ–æ–¹å¼">9.1.1ã€å¼€å¯ RDB æŒä¹…åŒ–æ–¹å¼<a class="headerlink" href="#911å¼€å¯-rdb-æŒä¹…åŒ–æ–¹å¼" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p><strong>save</strong></p> <p><code>save</code>å‘½ä»¤å¯ä»¥åŒæ­¥æ•°æ®åˆ°ç£ç›˜ä¸Šã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/16b914a74a0c8ef5.webp" data-desc-position="bottom"><img src="!assets/Redis/16b914a74a0c8ef5.webp" alt="img" style="zoom:67%;"></a></p> <p>å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€<code>save</code>å‘½ä»¤è¯·æ±‚è¿›è¡ŒæŒä¹…åŒ–æ—¶ï¼ŒæœåŠ¡å™¨ä¼šé˜»å¡<code>save</code>å‘½ä»¤ä¹‹åçš„å…¶ä»–å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç›´åˆ°æ•°æ®åŒæ­¥å®Œæˆã€‚å¦‚æœæ•°æ®é‡å¤ªå¤§ï¼ŒåŒæ­¥æ•°æ®ä¼šæ‰§è¡Œå¾ˆä¹…ï¼Œè€Œè¿™æœŸé—´ Redis æœåŠ¡å™¨ä¹Ÿæ— æ³•æ¥æ”¶å…¶ä»–è¯·æ±‚ï¼Œæ‰€ä»¥ï¼Œæœ€å¥½ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨<code>save</code>å‘½ä»¤ã€‚</p> <p><strong>bgsave</strong></p> <p>ä¸<code>save</code>å‘½ä»¤ä¸åŒï¼Œ<code>bgsave</code>å‘½ä»¤æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/16b914b543343855.webp" data-desc-position="bottom"><img src="!assets/Redis/16b914b543343855.webp" alt="img" style="zoom:67%;"></a></p> <p>å½“å®¢æˆ·ç«¯å‘æœåŠ¡å‘å‡º<code>bgsave</code>å‘½ä»¤æ—¶ï¼ŒRedis æœåŠ¡å™¨ä¸»è¿›ç¨‹ä¼š forks ä¸€ä¸ªå­è¿›ç¨‹æ¥æ•°æ®åŒæ­¥é—®é¢˜ï¼Œåœ¨å°†æ•°æ®ä¿å­˜åˆ° rdb æ–‡ä»¶ä¹‹åï¼Œå­è¿›ç¨‹ä¼šé€€å‡ºã€‚</p> <p>æ‰€ä»¥ï¼Œä¸<code>save</code>å‘½ä»¤ç›¸æ¯”ï¼ŒRedis æœåŠ¡å™¨åœ¨å¤„ç†<code>bgsave</code>é‡‡ç”¨å­çº¿ç¨‹è¿›è¡Œ IO å†™å…¥ï¼Œè€Œä¸»è¿›ç¨‹ä»ç„¶å¯ä»¥æ¥æ”¶å…¶ä»–è¯·æ±‚ï¼Œä½† forks å­è¿›ç¨‹æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥ forks å­è¿›ç¨‹æ—¶ï¼Œä¸€æ ·ä¸èƒ½æ¥æ”¶å…¶ä»–è¯·æ±‚ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœ forks ä¸€ä¸ªå­è¿›ç¨‹èŠ±è´¹çš„æ—¶é—´å¤ªä¹…ï¼ˆä¸€èˆ¬æ˜¯å¾ˆå¿«çš„ï¼‰ï¼Œ<code>bgsave</code>å‘½ä»¤ä»ç„¶æœ‰é˜»å¡å…¶ä»–å®¢æˆ·çš„è¯·æ±‚çš„æƒ…å†µå‘ç”Ÿã€‚</p> <p><strong>æœåŠ¡å™¨é…ç½®è‡ªåŠ¨è§¦å‘</strong></p> <p>é™¤äº†é€šè¿‡å®¢æˆ·ç«¯å‘é€å‘½ä»¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯åœ¨ Redis é…ç½®æ–‡ä»¶ä¸­çš„ save æŒ‡å®šåˆ°è¾¾è§¦å‘ RDB æŒä¹…åŒ–çš„æ¡ä»¶ï¼Œæ¯”å¦‚ã€å¤šå°‘ç§’å†…è‡³å°‘è¾¾åˆ°å¤šå°‘å†™æ“ä½œã€‘å°±å¼€å¯ RDB æ•°æ®åŒæ­¥ã€‚</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="c1">## 900så†…è‡³å°‘è¾¾åˆ°ä¸€æ¡å†™å‘½ä»¤</span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a>save<span class="w"> </span><span class="m">900</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="c1">## 300så†…è‡³å°‘è¾¾è‡³10æ¡å†™å‘½ä»¤</span>
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a>save<span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="m">10</span>
</span><span id="__span-117-5"><a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="c1">## 60så†…è‡³å°‘è¾¾åˆ°10000æ¡å†™å‘½ä»¤</span>
</span><span id="__span-117-6"><a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a>save<span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">10000</span>
</span></code></pre></div> <p>è¿™ç§é€šè¿‡æœåŠ¡å™¨é…ç½®æ–‡ä»¶è§¦å‘ RDB çš„æ–¹å¼ï¼Œä¸ bgsave å‘½ä»¤ç±»ä¼¼ï¼Œè¾¾åˆ°è§¦å‘æ¡ä»¶æ—¶ï¼Œä¼š forks ä¸€ä¸ªå­è¿›ç¨‹è¿›è¡Œæ•°æ®åŒæ­¥ã€‚</p> <p><strong><code>flushall</code>å’Œ<code>exit</code>çš„æ—¶å€™ä¹Ÿä¼šè§¦å‘</strong></p> <h4 id="912rdb-æ–‡ä»¶">9.1.2ã€RDB æ–‡ä»¶<a class="headerlink" href="#912rdb-æ–‡ä»¶" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>ä¸Šé¢ä¸‰ç§è®©æœåŠ¡å™¨ç”Ÿæˆ rdb æ–‡ä»¶çš„æ–¹å¼ï¼Œæ— è®ºæ˜¯ç”±ä¸»è¿›ç¨‹ç”Ÿæˆè¿˜æ˜¯å­è¿›ç¨‹æ¥ç”Ÿæˆï¼Œå…¶è¿‡ç¨‹å¦‚ä¸‹ï¼š</p> <ol> <li>ç”Ÿæˆä¸´æ—¶ rdb æ–‡ä»¶ï¼Œå¹¶å†™å…¥æ•°æ®ã€‚</li> <li>å®Œæˆæ•°æ®å†™å…¥ï¼Œç”¨ä¸´æ—¶æ–‡ä»£æ›¿ä»£æ­£å¼ rdb æ–‡ä»¶ã€‚</li> <li>åˆ é™¤åŸæ¥çš„ rdb æ–‡ä»¶ã€‚</li> </ol> <p>RDB é»˜è®¤ç”Ÿæˆçš„æ–‡ä»¶åä¸º dump.rdbï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œæ›´åŠ è¯¦ç»†é…ç½®ï¼Œæ¯”å¦‚åœ¨å•æœºä¸‹å¯åŠ¨å¤šä¸ª Redis æœåŠ¡å™¨è¿›ç¨‹æ—¶ï¼Œå¯ä»¥é€šè¿‡ç«¯å£å·é…ç½®ä¸åŒçš„rdb åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="c1">## æ˜¯å¦å‹ç¼©rdbæ–‡ä»¶</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a>rdbcompression<span class="w"> </span>yes
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a>
</span><span id="__span-118-4"><a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a><span class="c1">## rdbæ–‡ä»¶çš„åç§°</span>
</span><span id="__span-118-5"><a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a>dbfilename<span class="w"> </span>redis-6379.rdb
</span><span id="__span-118-6"><a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a>
</span><span id="__span-118-7"><a id="__codelineno-118-7" name="__codelineno-118-7" href="#__codelineno-118-7"></a><span class="c1">## rdbæ–‡ä»¶ä¿å­˜ç›®å½•</span>
</span><span id="__span-118-8"><a id="__codelineno-118-8" name="__codelineno-118-8" href="#__codelineno-118-8"></a>dir<span class="w"> </span>~/redis/
</span></code></pre></div> <h4 id="913rdb-çš„ä¼˜ç¼ºç‚¹">9.1.3ã€RDB çš„ä¼˜ç¼ºç‚¹<a class="headerlink" href="#913rdb-çš„ä¼˜ç¼ºç‚¹" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p><strong>ä¼˜ç‚¹</strong></p> <ol> <li>ä¸ AOF æ–¹å¼ç›¸æ¯”ï¼Œé€šè¿‡ rdb æ–‡ä»¶æ¢å¤æ•°æ®æ¯”è¾ƒå¿«ã€‚</li> <li>rdb æ–‡ä»¶éå¸¸ç´§å‡‘ï¼Œé€‚åˆäºæ•°æ®å¤‡ä»½ã€‚</li> <li>é€šè¿‡ RDB è¿›è¡Œæ•°æ®å¤‡ï¼Œç”±äºä½¿ç”¨å­è¿›ç¨‹ç”Ÿæˆï¼Œæ‰€ä»¥å¯¹ Redis æœåŠ¡å™¨æ€§èƒ½å½±å“è¾ƒå°ã€‚</li> </ol> <p><strong>ç¼ºç‚¹</strong></p> <ol> <li>å¦‚æœæœåŠ¡å™¨å®•æœºçš„è¯ï¼Œé‡‡ç”¨ RDB çš„æ–¹å¼ä¼šé€ æˆæŸä¸ªæ—¶æ®µå†…æ•°æ®çš„ä¸¢å¤±ï¼Œæ¯”å¦‚æˆ‘ä»¬è®¾ç½® 10 åˆ†é’ŸåŒæ­¥ä¸€æ¬¡æˆ– 5 åˆ†é’Ÿè¾¾åˆ° 1000æ¬¡ å†™å…¥å°±åŒæ­¥ä¸€æ¬¡ï¼Œé‚£ä¹ˆå¦‚æœè¿˜æ²¡è¾¾åˆ°è§¦å‘æ¡ä»¶æœåŠ¡å™¨å°±æ­»æœºäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´æ®µçš„æ•°æ®ä¼šä¸¢å¤±ã€‚</li> <li>ä½¿ç”¨<code>save</code>å‘½ä»¤ä¼šé€ æˆæœåŠ¡å™¨é˜»å¡ï¼Œç›´æ¥æ•°æ®åŒæ­¥å®Œæˆæ‰èƒ½æ¥æ”¶åç»­è¯·æ±‚ã€‚</li> <li>ä½¿ç”¨<code>bgsave</code>å‘½ä»¤åœ¨ forks å­è¿›ç¨‹æ—¶ï¼Œå¦‚æœæ•°æ®é‡å¤ªå¤§ï¼Œforks çš„è¿‡ç¨‹ä¹Ÿä¼šå‘ç”Ÿé˜»å¡ï¼Œå¦å¤–ï¼Œforks å­è¿›ç¨‹ä¼šè€—è´¹å†…å­˜ã€‚</li> </ol> <h3 id="92aof">9.2ã€AOF<a class="headerlink" href="#92aof" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ä¸ RDB å­˜å‚¨æŸä¸ªæ—¶åˆ»çš„å¿«ç…§ä¸åŒï¼ŒAOF ï¼ˆAppend-only fileï¼‰æŒä¹…åŒ–æ–¹å¼ä¼šè®°å½•å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨çš„æ¯ä¸€æ¬¡å†™æ“ä½œå‘½ä»¤ï¼Œå¹¶å°†è¿™äº›å†™æ“ä½œä»¥ Redis åè®®è¿½åŠ ä¿å­˜åˆ°ä»¥åç¼€ä¸º aof æ–‡ä»¶æœ«å°¾ï¼Œåœ¨ Redis æœåŠ¡å™¨é‡å¯æ—¶ï¼Œä¼šåŠ è½½å¹¶è¿è¡Œ aof æ–‡ä»¶çš„å‘½ä»¤ï¼Œä»¥è¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/16b916ccf4224ec3.webp" data-desc-position="bottom"><img src="!assets/Redis/16b916ccf4224ec3.webp" alt="img" style="zoom: 80%;"></a></p> <h4 id="921å¼€å¯-aof-æŒä¹…åŒ–æ–¹å¼">9.2.1ã€å¼€å¯ AOF æŒä¹…åŒ–æ–¹å¼<a class="headerlink" href="#921å¼€å¯-aof-æŒä¹…åŒ–æ–¹å¼" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Redis é»˜è®¤ä¸å¼€å¯ AOF æŒä¹…åŒ–æ–¹å¼ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯å¹¶è¿›è¡Œæ›´åŠ è¯¦ç»†çš„é…ç½®ï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="c1">## å¼€å¯aofæœºåˆ¶</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a>appendonly<span class="w"> </span>yes
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a>
</span><span id="__span-119-4"><a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a><span class="c1">## aofæ–‡ä»¶å</span>
</span><span id="__span-119-5"><a id="__codelineno-119-5" name="__codelineno-119-5" href="#__codelineno-119-5"></a>appendfilename<span class="w"> </span><span class="s2">"appendonly.aof"</span>
</span><span id="__span-119-6"><a id="__codelineno-119-6" name="__codelineno-119-6" href="#__codelineno-119-6"></a>
</span><span id="__span-119-7"><a id="__codelineno-119-7" name="__codelineno-119-7" href="#__codelineno-119-7"></a><span class="c1">## å†™å…¥ç­–ç•¥,alwaysè¡¨ç¤ºæ¯ä¸ªå†™æ“ä½œéƒ½ä¿å­˜åˆ°aofæ–‡ä»¶ä¸­,ä¹Ÿå¯ä»¥æ˜¯everysecæˆ–no</span>
</span><span id="__span-119-8"><a id="__codelineno-119-8" name="__codelineno-119-8" href="#__codelineno-119-8"></a>appendfsync<span class="w"> </span>always
</span><span id="__span-119-9"><a id="__codelineno-119-9" name="__codelineno-119-9" href="#__codelineno-119-9"></a>
</span><span id="__span-119-10"><a id="__codelineno-119-10" name="__codelineno-119-10" href="#__codelineno-119-10"></a><span class="c1">## é»˜è®¤ä¸é‡å†™aofæ–‡ä»¶</span>
</span><span id="__span-119-11"><a id="__codelineno-119-11" name="__codelineno-119-11" href="#__codelineno-119-11"></a>no-appendfsync-on-rewrite<span class="w"> </span>no
</span><span id="__span-119-12"><a id="__codelineno-119-12" name="__codelineno-119-12" href="#__codelineno-119-12"></a>
</span><span id="__span-119-13"><a id="__codelineno-119-13" name="__codelineno-119-13" href="#__codelineno-119-13"></a><span class="c1">## ä¿å­˜ç›®å½•</span>
</span><span id="__span-119-14"><a id="__codelineno-119-14" name="__codelineno-119-14" href="#__codelineno-119-14"></a>dir<span class="w"> </span>~/redis/
</span></code></pre></div> <p>appendfsync é€‰é¡¹æŒ‡å®šå†™å…¥ç­–ç•¥ï¼Œæœ‰ä¸‰ä¸ªé€‰é¡¹ï¼š</p> <ul> <li>noï¼šä¸è¿›è¡ŒåŒæ­¥ï¼Œäº¤ç”±æ“ä½œç³»ç»Ÿæ¥å¤„ç†ä»€ä¹ˆæ—¶å€™å†™å…¥ aof æ–‡ä»¶</li> <li>alwaysï¼šæ¯æ¬¡æœ‰å†™æ“ä½œéƒ½è¿›è¡ŒåŒæ­¥</li> <li>everysecï¼šå¯¹å†™æ“ä½œè¿›è¡Œç´¯ç§¯ï¼Œæ¯ç§’åŒæ­¥ä¸€æ¬¡</li> </ul> <h4 id="922aof-æ–‡ä»¶">9.2.2ã€AOF æ–‡ä»¶<a class="headerlink" href="#922aof-æ–‡ä»¶" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p><strong>AOF æ–‡ä»¶é‡å†™</strong></p> <p>AOF å°†å®¢æˆ·ç«¯çš„æ¯ä¸€ä¸ªå†™æ“ä½œéƒ½è¿½åŠ åˆ° aof æ–‡ä»¶æœ«å°¾ï¼Œæ¯”å¦‚å¯¹ä¸€ä¸ª key å¤šæ¬¡æ‰§è¡Œ incr å‘½ä»¤ï¼Œè¿™æ—¶å€™ï¼Œaof ä¿å­˜æ¯ä¸€æ¬¡å‘½ä»¤åˆ° aof æ–‡ä»¶ä¸­ï¼Œä¼šä½¿æ–‡ä»¶ä¼šå˜å¾—éå¸¸å¤§ã€‚</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a>incr<span class="w"> </span>num<span class="w"> </span><span class="m">1</span>
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a>incr<span class="w"> </span>num<span class="w"> </span><span class="m">2</span>
</span><span id="__span-120-3"><a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a>incr<span class="w"> </span>num<span class="w"> </span><span class="m">3</span>
</span><span id="__span-120-4"><a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a>incr<span class="w"> </span>num<span class="w"> </span><span class="m">4</span>
</span><span id="__span-120-5"><a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a>incr<span class="w"> </span>num<span class="w"> </span><span class="m">5</span>
</span><span id="__span-120-6"><a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a>incr<span class="w"> </span>num<span class="w"> </span><span class="m">6</span>
</span><span id="__span-120-7"><a id="__codelineno-120-7" name="__codelineno-120-7" href="#__codelineno-120-7"></a>...
</span><span id="__span-120-8"><a id="__codelineno-120-8" name="__codelineno-120-8" href="#__codelineno-120-8"></a>incr<span class="w"> </span>num<span class="w"> </span><span class="m">100000</span>
</span></code></pre></div> <p>aof æ–‡ä»¶å¤ªå¤§ï¼ŒåŠ è½½ aof æ–‡ä»¶æ¢å¤æ•°æ®æ—¶ï¼Œå°±ä¼šéå¸¸æ…¢ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis æ”¯æŒ aof æ–‡ä»¶é‡å†™ï¼Œé€šè¿‡é‡å†™ aofï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªæ¢å¤å½“å‰æ•°æ®çš„æœ€å°‘å‘½ä»¤é›†ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­é‚£ä¹ˆå¤šæ¡å‘½ä»¤ï¼Œå¯ä»¥é‡å†™ä¸ºï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="nb">set</span><span class="w"> </span>num<span class="w"> </span><span class="m">100000</span>
</span></code></pre></div> <p>é‡å†™aofæ–‡ä»¶çš„å¥½å¤„ï¼š</p> <ol> <li>å‹ç¼© aof æ–‡ä»¶ï¼Œå‡å°‘ç£ç›˜å ç”¨é‡</li> <li>å°† aof çš„å‘½ä»¤å‹ç¼©ä¸ºæœ€å°å‘½ä»¤é›†ï¼ŒåŠ å¿«äº†æ•°æ®æ¢å¤çš„é€Ÿåº¦</li> </ol> <p><strong>AOFæ–‡ä»¶æŸå</strong></p> <p>åœ¨å†™å…¥ aof æ—¥å¿—æ–‡ä»¶æ—¶ï¼Œå¦‚æœ Redis æœåŠ¡å™¨å®•æœºï¼Œåˆ™ aof æ—¥å¿—æ–‡ä»¶æ–‡ä»¶ä¼šå‡ºæ ¼å¼é”™è¯¯ï¼Œåœ¨é‡å¯ Redis æœåŠ¡å™¨æ—¶ï¼ŒRedis æœåŠ¡å™¨ä¼šæ‹’ç»è½½å…¥è¿™ä¸ª aof æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤ä¿®å¤ aof å¹¶æ¢å¤æ•°æ®ï¼š</p> <ol> <li> <p>å¤‡ä»½ç°åœ¨çš„ aof æ–‡ä»¶ï¼Œä»¥é˜²ä¸‡ä¸€</p> </li> <li> <p>ä½¿ç”¨<code>redis-check-aof</code>å‘½ä»¤ä¿®å¤ aof æ–‡ä»¶ï¼Œè¯¥å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="c1"># ä¿®å¤aofæ—¥å¿—æ–‡ä»¶</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a>$<span class="w"> </span>redis-check-aof<span class="w"> </span>-fix<span class="w"> </span>file.aof
</span></code></pre></div> </li> <li> <p>é‡å¯ Redis æœåŠ¡å™¨ï¼ŒåŠ è½½å·²ç»ä¿®å¤çš„ aof æ–‡ä»¶ï¼Œæ¢å¤æ•°æ®</p> </li> </ol> <h4 id="923aof-çš„ä¼˜ç¼ºç‚¹">9.2.3ã€AOF çš„ä¼˜ç¼ºç‚¹<a class="headerlink" href="#923aof-çš„ä¼˜ç¼ºç‚¹" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p><strong>ä¼˜ç‚¹</strong></p> <p>AOF åªæ˜¯è¿½åŠ æ—¥å¿—æ–‡ä»¶ï¼Œå› æ­¤å¯¹æœåŠ¡å™¨æ€§èƒ½å½±å“è¾ƒå°ï¼Œé€Ÿåº¦æ¯” RDB è¦å¿«ï¼Œæ¶ˆè€—çš„å†…å­˜è¾ƒå°‘ã€‚</p> <p><strong>ç¼ºç‚¹</strong></p> <ol> <li>AOF æ–¹å¼ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶å¤ªå¤§ï¼Œå³ä½¿é€šè¿‡ AOF é‡å†™ï¼Œæ–‡ä»¶ä½“ç§¯ä»ç„¶å¾ˆå¤§ã€‚</li> <li>æ¢å¤æ•°æ®çš„é€Ÿåº¦æ¯” RDB æ…¢ã€‚</li> </ol> <h2 id="10è®¢é˜…ä¸å‘å¸ƒ">10ã€è®¢é˜…ä¸å‘å¸ƒ<a class="headerlink" href="#10è®¢é˜…ä¸å‘å¸ƒ" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>Redis é€šè¿‡ <code>publish</code> ã€ <code>subscribe</code> ç­‰å‘½ä»¤å®ç°äº†è®¢é˜…ä¸å‘å¸ƒæ¨¡å¼ï¼Œ è¿™ä¸ªåŠŸèƒ½æä¾›ä¸¤ç§ä¿¡æ¯æœºåˆ¶ï¼Œ åˆ†åˆ«æ˜¯è®¢é˜…/å‘å¸ƒåˆ°é¢‘é“å’Œè®¢é˜…/å‘å¸ƒåˆ°æ¨¡å¼ã€‚</p> <p>Redis çš„<code>subscribe</code>å‘½ä»¤å¯ä»¥è®©å®¢æˆ·ç«¯è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ï¼Œ æ¯å½“æœ‰æ–°ä¿¡æ¯å‘é€åˆ°è¢«è®¢é˜…çš„é¢‘é“æ—¶ï¼Œ ä¿¡æ¯å°±ä¼šè¢«å‘é€ç»™æ‰€æœ‰è®¢é˜…æŒ‡å®šé¢‘é“çš„å®¢æˆ·ç«¯ã€‚</p> <p>ä¸‹å›¾å±•ç¤ºäº†é¢‘é“ channel1 ï¼Œ ä»¥åŠè®¢é˜…è¿™ä¸ªé¢‘é“çš„ä¸‰ä¸ªå®¢æˆ·ç«¯ â€”â€” client2 ã€ client5 å’Œ client1 ä¹‹é—´çš„å…³ç³»ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-58f7b1f1f52b28f59291d194555fc9f4b1462a4c.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-58f7b1f1f52b28f59291d194555fc9f4b1462a4c.svg" alt style></a></p> <p>å½“æœ‰æ–°æ¶ˆæ¯é€šè¿‡ <code>publish</code> å‘½ä»¤å‘é€ç»™é¢‘é“ channel1 æ—¶ï¼Œ è¿™ä¸ªæ¶ˆæ¯å°±ä¼šè¢«å‘é€ç»™è®¢é˜…å®ƒçš„ä¸‰ä¸ªå®¢æˆ·ç«¯ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-84c95abf88d6c0ac55b007da08805a4b9a582fdf.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-84c95abf88d6c0ac55b007da08805a4b9a582fdf.svg" alt style></a></p> <h3 id="101è®¢é˜…ä¸é€€è®¢é¢‘é“">10.1ã€è®¢é˜…ä¸é€€è®¢é¢‘é“<a class="headerlink" href="#101è®¢é˜…ä¸é€€è®¢é¢‘é“" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>è®¢é˜…é¢‘é“</strong></p> <p>æ¯ä¸ª Redis æœåŠ¡å™¨è¿›ç¨‹éƒ½ç»´æŒç€ä¸€ä¸ªè¡¨ç¤ºæœåŠ¡å™¨çŠ¶æ€çš„ redis.h/redisServer ç»“æ„ï¼Œ ç»“æ„çš„ pubsub_channels å±æ€§æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œ è¿™ä¸ªå­—å…¸å°±ç”¨äºä¿å­˜è®¢é˜…é¢‘é“çš„ä¿¡æ¯ï¼š</p> <div class="language-c highlight"><span class="filename">C</span><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">redisServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="w">    </span><span class="c1">// ...</span>
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="w">    </span><span class="n">dict</span><span class="w"> </span><span class="o">*</span><span class="n">pubsub_channels</span><span class="p">;</span>
</span><span id="__span-123-4"><a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="w">    </span><span class="c1">// ...</span>
</span><span id="__span-123-5"><a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a><span class="p">};</span>
</span></code></pre></div> <p>å…¶ä¸­ï¼Œå­—å…¸çš„é”®ä¸ºæ­£åœ¨è¢«è®¢é˜…çš„é¢‘é“ï¼Œ è€Œå­—å…¸çš„å€¼åˆ™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œ é“¾è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰è®¢é˜…è¿™ä¸ªé¢‘é“çš„å®¢æˆ·ç«¯ã€‚</p> <p>åœ¨ä¸‹å›¾å±•ç¤ºçš„è¿™ä¸ª pubsub_channels ç¤ºä¾‹ä¸­ï¼Œ client2 ã€ client5 å’Œ client1 å°±è®¢é˜…äº† channel1 ï¼Œ è€Œå…¶ä»–é¢‘é“ä¹Ÿåˆ†åˆ«è¢«åˆ«çš„å®¢æˆ·ç«¯æ‰€è®¢é˜…ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-241c988b86bb9bed6bf26537e654baaab4eef77b.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-241c988b86bb9bed6bf26537e654baaab4eef77b.svg" alt style></a></p> <p>å½“å®¢æˆ·ç«¯è°ƒç”¨ <code>subscribe</code> å‘½ä»¤æ—¶ï¼Œ ç¨‹åºå°±å°†å®¢æˆ·ç«¯å’Œè¦è®¢é˜…çš„é¢‘é“åœ¨ pubsub_channels å­—å…¸ä¸­å…³è”èµ·æ¥ã€‚</p> <p>å¦‚æœå®¢æˆ·ç«¯ client10086 æ‰§è¡Œå‘½ä»¤ <code>subscribe channel1 channel2 channel3</code> ï¼Œé‚£ä¹ˆå‰é¢å±•ç¤ºçš„ pubsub_channels å°†å˜æˆä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-cb250b1be4aaaedc9d5ddde113a80998d7f9c480.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-cb250b1be4aaaedc9d5ddde113a80998d7f9c480.svg" alt style></a></p> <p><code>subscribe</code> å‘½ä»¤çš„è¡Œä¸ºå¯ä»¥ç”¨ä¼ªä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š</p> <div class="language-c highlight"><span class="filename">C</span><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="n">def</span><span class="w"> </span><span class="n">SUBSCRIBE</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">channels</span><span class="p">)</span><span class="o">:</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="w">    </span><span class="cp"># éå†æ‰€æœ‰è¾“å…¥é¢‘é“</span>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">channels</span><span class="o">:</span>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a>
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a><span class="w">        </span><span class="cp"># å°†å®¢æˆ·ç«¯æ·»åŠ åˆ°é“¾è¡¨çš„æœ«å°¾</span>
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a><span class="w">        </span><span class="n">redisServer</span><span class="p">.</span><span class="n">pubsub_channels</span><span class="p">[</span><span class="n">channel</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</span></code></pre></div> <p>é€šè¿‡ pubsub_channels å­—å…¸ï¼Œ ç¨‹åºåªè¦æ£€æŸ¥æŸä¸ªé¢‘é“æ˜¯å¦ä¸ºå­—å…¸çš„é”®ï¼Œ å°±å¯ä»¥çŸ¥é“è¯¥é¢‘é“æ˜¯å¦æ­£åœ¨è¢«å®¢æˆ·ç«¯è®¢é˜…ï¼› åªè¦å–å‡ºæŸä¸ªé”®çš„å€¼ï¼Œ å°±å¯ä»¥å¾—åˆ°æ‰€æœ‰è®¢é˜…è¯¥é¢‘é“çš„å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚</p> <p><strong>é€€è®¢é¢‘é“</strong></p> <p>ä½¿ç”¨ <code>unsubscribe</code> å‘½ä»¤å¯ä»¥é€€è®¢æŒ‡å®šçš„é¢‘é“ï¼Œ è¿™ä¸ªå‘½ä»¤æ‰§è¡Œçš„æ˜¯è®¢é˜…çš„åæ“ä½œï¼š å®ƒä» pubsub_channels å­—å…¸çš„ç»™å®šé¢‘é“ï¼ˆé”®ï¼‰ä¸­ï¼Œ åˆ é™¤å…³äºå½“å‰å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œ è¿™æ ·è¢«é€€è®¢é¢‘é“çš„ä¿¡æ¯å°±ä¸ä¼šå†å‘é€ç»™è¿™ä¸ªå®¢æˆ·ç«¯ã€‚</p> <h3 id="102å‘é€ä¿¡æ¯åˆ°é¢‘é“">10.2ã€å‘é€ä¿¡æ¯åˆ°é¢‘é“<a class="headerlink" href="#102å‘é€ä¿¡æ¯åˆ°é¢‘é“" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å½“è°ƒç”¨ <code>publish channel message</code> å‘½ä»¤ï¼Œ ç¨‹åºé¦–å…ˆæ ¹æ® channel å®šä½åˆ°å­—å…¸çš„é”®ï¼Œ ç„¶åå°†ä¿¡æ¯å‘é€ç»™å­—å…¸å€¼é“¾è¡¨ä¸­çš„æ‰€æœ‰å®¢æˆ·ç«¯ã€‚</p> <p>å¯¹äºä»¥ä¸‹è¿™ä¸ª pubsub_channels å®ä¾‹ï¼Œ å¦‚æœæŸä¸ªå®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤ <code>publish channel1 "hello moto"</code> ï¼Œé‚£ä¹ˆ client2 ã€ client5 å’Œ client1 ä¸‰ä¸ªå®¢æˆ·ç«¯éƒ½å°†æ¥æ”¶åˆ° "hello moto" ä¿¡æ¯ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-241c988b86bb9bed6bf26537e654baaab4eef77b.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-241c988b86bb9bed6bf26537e654baaab4eef77b.svg" alt style></a></p> <p><code>publish</code>å‘½ä»¤çš„å®ç°å¯ä»¥ç”¨ä»¥ä¸‹ä¼ªä»£ç æ¥æè¿°ï¼š</p> <div class="language-c highlight"><span class="filename">C</span><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="n">def</span><span class="w"> </span><span class="n">PUBLISH</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="o">:</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="w">    </span><span class="cp"># éå†æ‰€æœ‰è®¢é˜…é¢‘é“ channel çš„å®¢æˆ·ç«¯</span>
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="n">pubsub_channels</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">:</span>
</span><span id="__span-125-5"><a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a>
</span><span id="__span-125-6"><a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a><span class="w">        </span><span class="cp"># å°†ä¿¡æ¯å‘é€ç»™å®ƒä»¬</span>
</span><span id="__span-125-7"><a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a><span class="w">        </span><span class="n">send_message</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
</span></code></pre></div> <h3 id="103æ¨¡å¼çš„è®¢é˜…ä¸ä¿¡æ¯å‘é€">10.3ã€æ¨¡å¼çš„è®¢é˜…ä¸ä¿¡æ¯å‘é€<a class="headerlink" href="#103æ¨¡å¼çš„è®¢é˜…ä¸ä¿¡æ¯å‘é€" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å½“ä½¿ç”¨ <code>publish</code> å‘½ä»¤å‘é€ä¿¡æ¯åˆ°æŸä¸ªé¢‘é“æ—¶ï¼Œ ä¸ä»…æ‰€æœ‰è®¢é˜…è¯¥é¢‘é“çš„å®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¿¡æ¯ï¼Œ å¦‚æœæœ‰æŸä¸ª/æŸäº›æ¨¡å¼å’Œè¿™ä¸ªé¢‘é“åŒ¹é…çš„è¯ï¼Œ é‚£ä¹ˆæ‰€æœ‰è®¢é˜…è¿™ä¸ª/è¿™äº›é¢‘é“çš„å®¢æˆ·ç«¯ä¹ŸåŒæ ·ä¼šæ”¶åˆ°ä¿¡æ¯ã€‚</p> <p>ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªå¸¦æœ‰é¢‘é“å’Œæ¨¡å¼çš„ä¾‹å­ï¼Œ å…¶ä¸­ tweet.shop.* æ¨¡å¼åŒ¹é…äº† tweet.shop.kindle é¢‘é“å’Œ tweet.shop.ipad é¢‘é“ï¼Œ å¹¶ä¸”æœ‰ä¸åŒçš„å®¢æˆ·ç«¯åˆ†åˆ«è®¢é˜…å®ƒä»¬ä¸‰ä¸ªï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-49c2b60cc3c2b52ec1623fbd8a9002eb6f335a54.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-49c2b60cc3c2b52ec1623fbd8a9002eb6f335a54.svg" alt style></a></p> <p>å½“æœ‰ä¿¡æ¯å‘é€åˆ° tweet.shop.kindle é¢‘é“æ—¶ï¼Œ é™¤äº†å‘é€ç»™ clientX å’Œ clientY ä¹‹å¤–ï¼Œ è¿˜ä¼šå‘é€ç»™è®¢é˜… tweet.shop.* æ¨¡å¼çš„ client123 å’Œ client256 ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-3d1f513ee0718a326d53152b2b97f82977e38ad6.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-3d1f513ee0718a326d53152b2b97f82977e38ad6.svg" alt style></a></p> <p>å¦ä¸€æ–¹é¢ï¼Œ å¦‚æœæ¥æ”¶åˆ°ä¿¡æ¯çš„æ˜¯é¢‘é“ tweet.shop.ipad ï¼Œ é‚£ä¹ˆ client123 å’Œ client256 åŒæ ·ä¼šæ”¶åˆ°ä¿¡æ¯ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-ba8c4d4dd538464659aeb52d6c366f23ad3d0dc1.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-ba8c4d4dd538464659aeb52d6c366f23ad3d0dc1.svg" alt style></a></p> <h3 id="104è®¢é˜…ä¸é€€è®¢æ¨¡å¼">10.4ã€è®¢é˜…ä¸é€€è®¢æ¨¡å¼<a class="headerlink" href="#104è®¢é˜…ä¸é€€è®¢æ¨¡å¼" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>è®¢é˜…æ¨¡å¼</strong></p> <p>redisServer.pubsub_patterns å±æ€§æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸­ä¿å­˜ç€æ‰€æœ‰å’Œæ¨¡å¼ç›¸å…³çš„ä¿¡æ¯ï¼š</p> <div class="language-c highlight"><span class="filename">C</span><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">redisServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="w">    </span><span class="c1">// ...</span>
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a><span class="w">    </span><span class="n">list</span><span class="w"> </span><span class="o">*</span><span class="n">pubsub_patterns</span><span class="p">;</span>
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="w">    </span><span class="c1">// ...</span>
</span><span id="__span-126-5"><a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a><span class="p">};</span>
</span></code></pre></div> <p>é“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ª redis.h/pubsubPattern ç»“æ„ï¼š</p> <div class="language-c highlight"><span class="filename">C</span><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">pubsubPattern</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="w">    </span><span class="n">redisClient</span><span class="w"> </span><span class="o">*</span><span class="n">client</span><span class="p">;</span>
</span><span id="__span-127-3"><a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="w">    </span><span class="n">robj</span><span class="w"> </span><span class="o">*</span><span class="n">pattern</span><span class="p">;</span>
</span><span id="__span-127-4"><a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="p">}</span><span class="w"> </span><span class="n">pubsubPattern</span><span class="p">;</span>
</span></code></pre></div> <p>client å±æ€§ä¿å­˜ç€è®¢é˜…æ¨¡å¼çš„å®¢æˆ·ç«¯ï¼Œè€Œ pattern å±æ€§åˆ™ä¿å­˜ç€è¢«è®¢é˜…çš„æ¨¡å¼ã€‚</p> <p>æ¯å½“è°ƒç”¨ <code>psubscribe</code> å‘½ä»¤è®¢é˜…ä¸€ä¸ªæ¨¡å¼æ—¶ï¼Œ ç¨‹åºå°±åˆ›å»ºä¸€ä¸ªåŒ…å«å®¢æˆ·ç«¯ä¿¡æ¯å’Œè¢«è®¢é˜…æ¨¡å¼çš„ pubsubPattern ç»“æ„ï¼Œ å¹¶å°†è¯¥ç»“æ„æ·»åŠ åˆ° redisServer.pubsub_patterns é“¾è¡¨ä¸­ã€‚</p> <p>ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ¨¡å¼çš„ pubsub_patterns é“¾è¡¨ï¼Œ å…¶ä¸­ client123 å’Œ client256 éƒ½æ­£åœ¨è®¢é˜… tweet.shop.* æ¨¡å¼ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-b8d101c1b582531bce2b0daef87adbaf30ebc195.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-b8d101c1b582531bce2b0daef87adbaf30ebc195.svg" alt style></a></p> <p>å¦‚æœè¿™æ—¶å®¢æˆ·ç«¯ client10086 æ‰§è¡Œ <code>psubscribe broadcast.list.*</code> ï¼Œ é‚£ä¹ˆ pubsub_patterns é“¾è¡¨å°†è¢«æ›´æ–°æˆè¿™æ ·ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-a84f3abf466ca19297faaa4e11d37f9257355c60.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-a84f3abf466ca19297faaa4e11d37f9257355c60.svg" alt style></a></p> <p>é€šè¿‡éå†æ•´ä¸ª pubsub_patterns é“¾è¡¨ï¼Œç¨‹åºå¯ä»¥æ£€æŸ¥æ‰€æœ‰æ­£åœ¨è¢«è®¢é˜…çš„æ¨¡å¼ï¼Œä»¥åŠè®¢é˜…è¿™äº›æ¨¡å¼çš„å®¢æˆ·ç«¯ã€‚</p> <p><strong>é€€è®¢æ¨¡å¼</strong></p> <p>ä½¿ç”¨ <code>punsubscribe</code> å‘½ä»¤å¯ä»¥é€€è®¢æŒ‡å®šçš„æ¨¡å¼ï¼Œ è¿™ä¸ªå‘½ä»¤æ‰§è¡Œçš„æ˜¯è®¢é˜…æ¨¡å¼çš„åæ“ä½œï¼š ç¨‹åºä¼šåˆ é™¤ redisServer.pubsub_patterns é“¾è¡¨ä¸­ï¼Œ æ‰€æœ‰å’Œè¢«é€€è®¢æ¨¡å¼ç›¸å…³è”çš„ pubsubPattern ç»“æ„ï¼Œ è¿™æ ·å®¢æˆ·ç«¯å°±ä¸ä¼šå†æ”¶åˆ°å’Œæ¨¡å¼ç›¸åŒ¹é…çš„é¢‘é“å‘æ¥çš„ä¿¡æ¯ã€‚</p> <h3 id="105å‘é€ä¿¡æ¯åˆ°æ¨¡å¼">10.5ã€å‘é€ä¿¡æ¯åˆ°æ¨¡å¼<a class="headerlink" href="#105å‘é€ä¿¡æ¯åˆ°æ¨¡å¼" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å‘é€ä¿¡æ¯åˆ°æ¨¡å¼çš„å·¥ä½œä¹Ÿæ˜¯ç”±<code>publish</code>å‘½ä»¤è¿›è¡Œçš„ï¼Œ åœ¨å‰é¢è®²è§£é¢‘é“çš„æ—¶å€™ï¼Œ ç»™å‡ºäº†è¿™æ ·ä¸€æ®µä¼ªä»£ç ï¼Œ è¯´å®ƒå®šä¹‰äº† <code>publish</code> å‘½ä»¤çš„è¡Œä¸º</p> <div class="language-c highlight"><span class="filename">C</span><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="n">def</span><span class="w"> </span><span class="n">PUBLISH</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="o">:</span>
</span><span id="__span-128-2"><a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a>
</span><span id="__span-128-3"><a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="w">    </span><span class="cp"># éå†æ‰€æœ‰è®¢é˜…é¢‘é“ channel çš„å®¢æˆ·ç«¯</span>
</span><span id="__span-128-4"><a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="n">pubsub_channels</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">:</span>
</span><span id="__span-128-5"><a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a>
</span><span id="__span-128-6"><a id="__codelineno-128-6" name="__codelineno-128-6" href="#__codelineno-128-6"></a><span class="w">        </span><span class="cp"># å°†ä¿¡æ¯å‘é€ç»™å®ƒä»¬</span>
</span><span id="__span-128-7"><a id="__codelineno-128-7" name="__codelineno-128-7" href="#__codelineno-128-7"></a><span class="w">        </span><span class="n">send_message</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
</span></code></pre></div> <p>ä½†æ˜¯ï¼Œè¿™æ®µä¼ªä»£ç å¹¶æ²¡æœ‰å®Œæ•´æè¿° <code>publish</code> å‘½ä»¤çš„è¡Œä¸ºï¼Œ å› ä¸º <code>publish</code> é™¤äº†å°† message å‘é€åˆ°æ‰€æœ‰è®¢é˜… channel çš„å®¢æˆ·ç«¯ä¹‹å¤–ï¼Œ å®ƒè¿˜ä¼šå°† channel å’Œ pubsub_patterns ä¸­çš„æ¨¡å¼è¿›è¡Œå¯¹æ¯”ï¼Œ å¦‚æœ channel å’ŒæŸä¸ªæ¨¡å¼åŒ¹é…çš„è¯ï¼Œ é‚£ä¹ˆä¹Ÿå°† message å‘é€åˆ°è®¢é˜…é‚£ä¸ªæ¨¡å¼çš„å®¢æˆ·ç«¯ã€‚</p> <p>å®Œæ•´æè¿° <code>publish</code> åŠŸèƒ½çš„ä¼ªä»£ç å®šäºå¦‚ä¸‹ï¼š</p> <div class="language-c highlight"><span class="filename">C</span><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="n">def</span><span class="w"> </span><span class="n">PUBLISH</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="o">:</span>
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a>
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="w">    </span><span class="cp"># éå†æ‰€æœ‰è®¢é˜…é¢‘é“ channel çš„å®¢æˆ·ç«¯</span>
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="n">pubsub_channels</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">:</span>
</span><span id="__span-129-5"><a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a>
</span><span id="__span-129-6"><a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a><span class="w">        </span><span class="cp"># å°†ä¿¡æ¯å‘é€ç»™å®ƒä»¬</span>
</span><span id="__span-129-7"><a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a><span class="w">        </span><span class="n">send_message</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
</span><span id="__span-129-8"><a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a>
</span><span id="__span-129-9"><a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a><span class="w">    </span><span class="cp"># å–å‡ºæ‰€æœ‰æ¨¡å¼ï¼Œä»¥åŠè®¢é˜…æ¨¡å¼çš„å®¢æˆ·ç«¯</span>
</span><span id="__span-129-10"><a id="__codelineno-129-10" name="__codelineno-129-10" href="#__codelineno-129-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="n">pubsub_patterns</span><span class="o">:</span>
</span><span id="__span-129-11"><a id="__codelineno-129-11" name="__codelineno-129-11" href="#__codelineno-129-11"></a>
</span><span id="__span-129-12"><a id="__codelineno-129-12" name="__codelineno-129-12" href="#__codelineno-129-12"></a><span class="w">        </span><span class="cp"># å¦‚æœ channel å’Œæ¨¡å¼åŒ¹é…</span>
</span><span id="__span-129-13"><a id="__codelineno-129-13" name="__codelineno-129-13" href="#__codelineno-129-13"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">match</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="p">)</span><span class="o">:</span>
</span><span id="__span-129-14"><a id="__codelineno-129-14" name="__codelineno-129-14" href="#__codelineno-129-14"></a>
</span><span id="__span-129-15"><a id="__codelineno-129-15" name="__codelineno-129-15" href="#__codelineno-129-15"></a><span class="w">            </span><span class="cp"># é‚£ä¹ˆä¹Ÿå°†ä¿¡æ¯å‘ç»™è®¢é˜…è¿™ä¸ªæ¨¡å¼çš„å®¢æˆ·ç«¯</span>
</span><span id="__span-129-16"><a id="__codelineno-129-16" name="__codelineno-129-16" href="#__codelineno-129-16"></a><span class="w">            </span><span class="n">send_message</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
</span></code></pre></div> <p>å¦‚æœ Redis æœåŠ¡å™¨çš„ pubsub_patterns çŠ¶æ€å¦‚ä¸‹ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/graphviz-a84f3abf466ca19297faaa4e11d37f9257355c60.svg" data-desc-position="bottom"><img src="!assets/Redis/graphviz-a84f3abf466ca19297faaa4e11d37f9257355c60.svg" alt style></a></p> <p>é‚£ä¹ˆå½“æŸä¸ªå®¢æˆ·ç«¯å‘é€ä¿¡æ¯ "Amazon Kindle, $69." åˆ° tweet.shop.kindle é¢‘é“æ—¶ï¼Œ é™¤äº†æ‰€æœ‰è®¢é˜…äº† tweet.shop.kindle é¢‘é“çš„å®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¿¡æ¯ä¹‹å¤–ï¼Œ å®¢æˆ·ç«¯ client123 å’Œ client256 ä¹ŸåŒæ ·ä¼šæ”¶åˆ°ä¿¡æ¯ï¼Œ å› ä¸ºè¿™ä¸¤ä¸ªå®¢æˆ·ç«¯è®¢é˜…çš„ tweet.shop.* æ¨¡å¼å’Œ tweet.shop.kindle é¢‘é“åŒ¹é…ã€‚</p> <h2 id="11redis-é›†ç¾¤">11ã€Redis é›†ç¾¤<a class="headerlink" href="#11redis-é›†ç¾¤" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>Redis æœ‰ä¸‰ç§é›†ç¾¤æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ï¼š</p> <ul> <li>ä¸»ä»å¤åˆ¶æ¨¡å¼</li> <li>Sentinel æ¨¡å¼</li> <li>Cluster æ¨¡å¼</li> </ul> <h3 id="111ä¸»ä»å¤åˆ¶">11.1ã€ä¸»ä»å¤åˆ¶<a class="headerlink" href="#111ä¸»ä»å¤åˆ¶" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <h4 id="1111ä¸»ä»å¤åˆ¶ä»‹ç»">11.1.1ã€ä¸»ä»å¤åˆ¶ä»‹ç»<a class="headerlink" href="#1111ä¸»ä»å¤åˆ¶ä»‹ç»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>é€šè¿‡æŒä¹…åŒ–åŠŸèƒ½ï¼ŒRedis ä¿è¯äº†å³ä½¿åœ¨æœåŠ¡å™¨é‡å¯çš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šä¸¢å¤±ï¼ˆæˆ–å°‘é‡ä¸¢å¤±ï¼‰æ•°æ®ï¼Œå› ä¸ºæŒä¹…åŒ–ä¼šæŠŠå†…å­˜ä¸­æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šï¼Œé‡å¯ä¼šä»ç¡¬ç›˜ä¸ŠåŠ è½½æ•°æ®ã€‚ ä½†æ˜¯ç”±äºæ•°æ®æ˜¯å­˜å‚¨åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šçš„ï¼Œå¦‚æœè¿™å°æœåŠ¡å™¨å‡ºç°ç¡¬ç›˜æ•…éšœç­‰é—®é¢˜ï¼Œä¹Ÿä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p> <p>ä¸ºäº†é¿å…å•ç‚¹æ•…éšœï¼Œé€šå¸¸çš„åšæ³•æ˜¯å°†æ•°æ®åº“å¤åˆ¶å¤šä¸ªå‰¯æœ¬ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å³ä½¿æœ‰ä¸€å°æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œå…¶ä»–æœåŠ¡å™¨ä¾ç„¶å¯ä»¥ç»§ç»­æä¾›æœåŠ¡ã€‚</p> <p>ä¸ºæ­¤ï¼Œ Redis æä¾›äº†å¤åˆ¶ï¼ˆreplicationï¼‰åŠŸèƒ½ï¼Œå¯ä»¥å®ç°å½“ä¸€å°æ•°æ®åº“ä¸­çš„æ•°æ®æ›´æ–°åï¼Œè‡ªåŠ¨å°†æ›´æ–°çš„æ•°æ®åŒæ­¥åˆ°å…¶ä»–æ•°æ®åº“ä¸Šã€‚</p> <p>åœ¨å¤åˆ¶çš„æ¦‚å¿µä¸­ï¼Œæ•°æ®åº“åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ä¸»æ•°æ®åº“ï¼ˆmasterï¼‰ï¼Œå¦ä¸€ç±»æ˜¯ä»æ•°æ®åº“ï¼ˆslaveï¼‰ã€‚master å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œå½“å†™æ“ä½œå¯¼è‡´æ•°æ®å˜åŒ–æ—¶ä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥ç»™ä» slaveã€‚è€Œ slave ä¸€èˆ¬æ˜¯åªè¯»çš„ï¼Œå¹¶æ¥å— master åŒæ­¥è¿‡æ¥çš„æ•°æ®ã€‚ä¸€ä¸ª master å¯ä»¥æ‹¥æœ‰å¤šä¸ª slaveï¼Œè€Œä¸€ä¸ª slave åªèƒ½æ‹¥æœ‰ä¸€ä¸ª masterã€‚</p> <p>slave æŒ‚äº†ä¸å½±å“å…¶ä»– slave çš„è¯»å’Œ master çš„è¯»å’Œå†™ï¼Œé‡æ–°å¯åŠ¨åä¼šå°†æ•°æ®ä» master åŒæ­¥è¿‡æ¥ï¼Œ master æŒ‚äº†ä»¥åï¼Œä¸å½±å“ slave çš„è¯»ï¼Œä½† Redis ä¸å†æä¾›å†™æœåŠ¡ï¼Œmaster é‡å¯å Redis å°†é‡æ–°å¯¹å¤–æä¾›å†™æœåŠ¡ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/1460000022808581.png" data-desc-position="bottom"><img src="!assets/Redis/1460000022808581.png" alt="img" style></a></p> <p><strong>ä¸»ä»å¤åˆ¶åŸç†</strong></p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/1460000022808583.png" data-desc-position="bottom"><img src="!assets/Redis/1460000022808583.png" alt="img" style="zoom:80%;"></a></p> <ol> <li>slave å¯åŠ¨æˆåŠŸåï¼Œè¿æ¥ masterï¼Œå‘é€ <code>sync</code> å‘½ä»¤</li> <li>master æ¥æ”¶åˆ° <code>sync</code> å‘½ä»¤åï¼Œå¼€å§‹æ‰§è¡Œ <code>bgsave</code> å‘½ä»¤ç”Ÿæˆ RDB æ–‡ä»¶å¹¶ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤</li> <li>master <code>bgsave</code> æ‰§è¡Œå®Œåï¼Œå‘æ‰€æœ‰ slave å‘é€å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åœ¨å‘é€æœŸé—´ç»§ç»­è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤</li> <li>slave æ”¶åˆ°å¿«ç…§æ–‡ä»¶åä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„å¿«ç…§</li> <li>master å¿«ç…§å‘é€å®Œæ¯•åå¼€å§‹å‘ slave å‘é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤</li> <li>slave å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥ï¼Œå¼€å§‹æ¥æ”¶å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ª master ç¼“å†²åŒºçš„å†™å‘½ä»¤ï¼ˆ<strong>slave åˆå§‹åŒ–å®Œæˆ</strong>ï¼‰</li> <li>master æ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤å°±ä¼šå‘ slave å‘é€ç›¸åŒçš„å†™å‘½ä»¤ï¼Œslave æ¥æ”¶å¹¶æ‰§è¡Œæ”¶åˆ°çš„å†™å‘½ä»¤ï¼ˆ<strong>slave åˆå§‹åŒ–å®Œæˆåçš„æ“ä½œ</strong>ï¼‰</li> <li>å‡ºç°æ–­å¼€é‡è¿åï¼Œ2.8 ä¹‹åçš„ç‰ˆæœ¬ä¼šå°†æ–­çº¿æœŸé—´çš„å‘½ä»¤ä¼ ç»™é‡æ•°æ®åº“ï¼Œå¢é‡å¤åˆ¶</li> <li>ä¸»ä»åˆšåˆšè¿æ¥çš„æ—¶å€™ï¼Œè¿›è¡Œå…¨é‡åŒæ­¥ï¼›å…¨åŒæ­¥ç»“æŸåï¼Œè¿›è¡Œå¢é‡åŒæ­¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œslave åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å‘èµ·å…¨é‡åŒæ­¥ã€‚Redis çš„ç­–ç•¥æ˜¯ï¼Œæ— è®ºå¦‚ä½•ï¼Œé¦–å…ˆä¼šå°è¯•è¿›è¡Œå¢é‡åŒæ­¥ï¼Œå¦‚ä¸æˆåŠŸï¼Œè¦æ±‚ä»æœºè¿›è¡Œå…¨é‡åŒæ­¥</li> </ol> <p>**ä¸»ä»å¤åˆ¶çš„ä¼˜ç‚¹ **</p> <ol> <li>æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œä¸»æœºä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æœºï¼Œå¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»</li> <li>ä¸ºäº†åˆ†è½½ master çš„è¯»æ“ä½œå‹åŠ›ï¼Œslave æœåŠ¡å™¨å¯ä»¥ä¸ºå®¢æˆ·ç«¯æä¾›åªè¯»æ“ä½œçš„æœåŠ¡ï¼Œå†™æœåŠ¡ä»ç„¶å¿…é¡»ç”± master æ¥å®Œæˆ</li> <li>slave åŒæ ·å¯ä»¥æ¥å—å…¶å®ƒ slave çš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„åˆ†è½½ master çš„åŒæ­¥å‹åŠ›</li> <li>master server æ˜¯ä»¥éé˜»å¡çš„æ–¹å¼ä¸º slave æä¾›æœåŠ¡ã€‚æ‰€ä»¥åœ¨ master-slave åŒæ­¥æœŸé—´ï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æäº¤æŸ¥è¯¢æˆ–ä¿®æ”¹è¯·æ±‚</li> <li>slave server åŒæ ·æ˜¯ä»¥éé˜»å¡çš„æ–¹å¼å®Œæˆæ•°æ®åŒæ­¥ã€‚åœ¨åŒæ­¥æœŸé—´ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯æäº¤æŸ¥è¯¢è¯·æ±‚ï¼ŒRedis åˆ™è¿”å›åŒæ­¥ä¹‹å‰çš„æ•°æ®</li> </ol> <p>**ä¸»ä»å¤åˆ¶çš„ç¼ºç‚¹ **</p> <ol> <li>Redis ä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œä¸»æœºä»æœºçš„å®•æœºéƒ½ä¼šå¯¼è‡´å‰ç«¯éƒ¨åˆ†è¯»å†™è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…æœºå™¨é‡å¯æˆ–è€…æ‰‹åŠ¨åˆ‡æ¢å‰ç«¯çš„ IP æ‰èƒ½æ¢å¤ï¼ˆ<strong>ä¹Ÿå°±æ˜¯è¦äººå·¥ä»‹å…¥</strong>ï¼‰</li> <li>ä¸»æœºå®•æœºï¼Œå®•æœºå‰æœ‰éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»æœºï¼Œåˆ‡æ¢ IP åè¿˜ä¼šå¼•å…¥æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¯ç”¨æ€§</li> <li>å¦‚æœå¤šä¸ª slave æ–­çº¿äº†ï¼Œéœ€è¦é‡å¯çš„æ—¶å€™ï¼Œå°½é‡ä¸è¦åœ¨åŒä¸€æ—¶é—´æ®µè¿›è¡Œé‡å¯ã€‚å› ä¸ºåªè¦ slave å¯åŠ¨ï¼Œå°±ä¼šå‘é€ <code>sync</code> è¯·æ±‚å’Œä¸»æœºå…¨é‡åŒæ­¥ï¼Œå½“å¤šä¸ª slave é‡å¯çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¯¼è‡´ master IO å‰§å¢ä»è€Œå®•æœº</li> <li>Redis è¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚</li> </ol> <h4 id="1112ä¸»ä»å¤åˆ¶æ­å»º">11.1.2ã€ä¸»ä»å¤åˆ¶æ­å»º<a class="headerlink" href="#1112ä¸»ä»å¤åˆ¶æ­å»º" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>å¯åŠ¨æ–¹å¼</p> <ul> <li> <p>å®¢æˆ·ç«¯å‘é€å‘½ä»¤</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a>slaveof<span class="w"> </span>&lt;masterip&gt;<span class="w"> </span>&lt;masterport&gt;
</span></code></pre></div> </li> <li> <p>å¯åŠ¨æœåŠ¡å™¨å‚æ•°</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a>redis-server<span class="w"> </span>-slaveof<span class="w"> </span>&lt;masterip&gt;<span class="w"> </span>&lt;masterport&gt;
</span></code></pre></div> </li> <li> <p>æœåŠ¡å™¨é…ç½®</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a>slaveof<span class="w"> </span>&lt;masterip&gt;<span class="w"> </span>&lt;masterport&gt;
</span></code></pre></div> </li> </ul> <p>æ­¤ä¸ºä»¥æœåŠ¡å™¨é…ç½®å¯åŠ¨ï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="c1">## æ–°å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¤¹ï¼Œæ–¹ä¾¿åæœŸåˆ é™¤</span>
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a>mkdir<span class="w"> </span>data
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a><span class="nb">cd</span><span class="w"> </span>data
</span><span id="__span-133-4"><a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a>
</span><span id="__span-133-5"><a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a><span class="c1">## åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶</span>
</span><span id="__span-133-6"><a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a>vim<span class="w"> </span>redis_6379.conf
</span><span id="__span-133-7"><a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a>
</span><span id="__span-133-8"><a id="__codelineno-133-8" name="__codelineno-133-8" href="#__codelineno-133-8"></a><span class="c1">## å†™å…¥å†…å®¹</span>
</span><span id="__span-133-9"><a id="__codelineno-133-9" name="__codelineno-133-9" href="#__codelineno-133-9"></a>include<span class="w"> </span>/etc/redis/redis.conf
</span><span id="__span-133-10"><a id="__codelineno-133-10" name="__codelineno-133-10" href="#__codelineno-133-10"></a>port<span class="w"> </span><span class="m">6379</span>
</span><span id="__span-133-11"><a id="__codelineno-133-11" name="__codelineno-133-11" href="#__codelineno-133-11"></a>daemonize<span class="w"> </span>no
</span><span id="__span-133-12"><a id="__codelineno-133-12" name="__codelineno-133-12" href="#__codelineno-133-12"></a>pidfile<span class="w"> </span>/root/data/redis_6379.pid
</span><span id="__span-133-13"><a id="__codelineno-133-13" name="__codelineno-133-13" href="#__codelineno-133-13"></a>logfile<span class="w"> </span><span class="s2">"redis_6379.log"</span>
</span><span id="__span-133-14"><a id="__codelineno-133-14" name="__codelineno-133-14" href="#__codelineno-133-14"></a>dbfilename<span class="w"> </span>dump_6379.rdb
</span><span id="__span-133-15"><a id="__codelineno-133-15" name="__codelineno-133-15" href="#__codelineno-133-15"></a>dir<span class="w"> </span>/root/data
</span><span id="__span-133-16"><a id="__codelineno-133-16" name="__codelineno-133-16" href="#__codelineno-133-16"></a>
</span><span id="__span-133-17"><a id="__codelineno-133-17" name="__codelineno-133-17" href="#__codelineno-133-17"></a><span class="c1">## å¤åˆ¶ä¸€ä»½ 6379 é…ç½®æ–‡ä»¶å¹¶å°†æ–‡ä»¶ä¸­çš„ 6379 æ”¹ä¸º 6380</span>
</span><span id="__span-133-18"><a id="__codelineno-133-18" name="__codelineno-133-18" href="#__codelineno-133-18"></a>sed<span class="w"> </span><span class="s1">'s/6379/6380/g'</span><span class="w"> </span>redis_6379.conf<span class="w"> </span>&gt;<span class="w"> </span>redis_6380.conf
</span><span id="__span-133-19"><a id="__codelineno-133-19" name="__codelineno-133-19" href="#__codelineno-133-19"></a>
</span><span id="__span-133-20"><a id="__codelineno-133-20" name="__codelineno-133-20" href="#__codelineno-133-20"></a><span class="c1">## 6380 é…ç½®æ–‡ä»¶æœ«å°¾è¿½åŠ  replicaof 127.0.0.1 6379ï¼Œ$a\ è¡¨ç¤ºæœ€åä¸€è¡Œï¼Œ\n è¡¨ç¤ºæ¢è¡Œ</span>
</span><span id="__span-133-21"><a id="__codelineno-133-21" name="__codelineno-133-21" href="#__codelineno-133-21"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">'$a\\nreplicaof 127.0.0.1 6379'</span><span class="w"> </span>redis_6380.conf
</span><span id="__span-133-22"><a id="__codelineno-133-22" name="__codelineno-133-22" href="#__codelineno-133-22"></a>
</span><span id="__span-133-23"><a id="__codelineno-133-23" name="__codelineno-133-23" href="#__codelineno-133-23"></a><span class="c1">## å¤åˆ¶ä¸€ä»½ 6380 é…ç½®æ–‡ä»¶å¹¶å°†æ–‡ä»¶ä¸­çš„ 6380 æ”¹ä¸º 6381</span>
</span><span id="__span-133-24"><a id="__codelineno-133-24" name="__codelineno-133-24" href="#__codelineno-133-24"></a>sed<span class="w"> </span><span class="s1">'s/6380/6381/g'</span><span class="w"> </span>redis_6380.conf<span class="w"> </span>&gt;<span class="w"> </span>redis_6381.conf
</span><span id="__span-133-25"><a id="__codelineno-133-25" name="__codelineno-133-25" href="#__codelineno-133-25"></a>
</span><span id="__span-133-26"><a id="__codelineno-133-26" name="__codelineno-133-26" href="#__codelineno-133-26"></a><span class="c1">## é¡ºåºå¯åŠ¨èŠ‚ç‚¹</span>
</span><span id="__span-133-27"><a id="__codelineno-133-27" name="__codelineno-133-27" href="#__codelineno-133-27"></a>redis-server<span class="w"> </span>redis_6379.conf
</span><span id="__span-133-28"><a id="__codelineno-133-28" name="__codelineno-133-28" href="#__codelineno-133-28"></a>redis-server<span class="w"> </span>redis_6380.conf
</span><span id="__span-133-29"><a id="__codelineno-133-29" name="__codelineno-133-29" href="#__codelineno-133-29"></a>redis-server<span class="w"> </span>redis_6381.conf
</span><span id="__span-133-30"><a id="__codelineno-133-30" name="__codelineno-133-30" href="#__codelineno-133-30"></a>
</span><span id="__span-133-31"><a id="__codelineno-133-31" name="__codelineno-133-31" href="#__codelineno-133-31"></a><span class="c1">## è¿›å…¥redis å®¢æˆ·ç«¯ï¼Œå¼€å¤šä¸ªçª—å£æŸ¥çœ‹æ–¹ä¾¿äº›</span>
</span><span id="__span-133-32"><a id="__codelineno-133-32" name="__codelineno-133-32" href="#__codelineno-133-32"></a>redis-cli<span class="w"> </span>-p<span class="w"> </span><span class="m">6379</span>
</span></code></pre></div> <p>å¯ä»¥ä½¿ç”¨<code>info replication</code>çœ‹åˆ°æœ‰ä¸¤ä¸ª slave è¿æ¥åˆ° master</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210604171651251.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210604171651251.png" alt="image-20210604171651251" style></a></p> <p><strong>æ•°æ®åŒæ­¥éªŒè¯</strong></p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="c1">## master</span>
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a>redis-cli<span class="w"> </span>-p<span class="w"> </span><span class="m">6379</span>
</span><span id="__span-134-3"><a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>k1<span class="w"> </span>v1
</span><span id="__span-134-4"><a id="__codelineno-134-4" name="__codelineno-134-4" href="#__codelineno-134-4"></a>OK
</span><span id="__span-134-5"><a id="__codelineno-134-5" name="__codelineno-134-5" href="#__codelineno-134-5"></a>
</span><span id="__span-134-6"><a id="__codelineno-134-6" name="__codelineno-134-6" href="#__codelineno-134-6"></a><span class="nb">exit</span>
</span><span id="__span-134-7"><a id="__codelineno-134-7" name="__codelineno-134-7" href="#__codelineno-134-7"></a>
</span><span id="__span-134-8"><a id="__codelineno-134-8" name="__codelineno-134-8" href="#__codelineno-134-8"></a><span class="c1">## slave1</span>
</span><span id="__span-134-9"><a id="__codelineno-134-9" name="__codelineno-134-9" href="#__codelineno-134-9"></a>redis-cli<span class="w"> </span>-p<span class="w"> </span><span class="m">6380</span>
</span><span id="__span-134-10"><a id="__codelineno-134-10" name="__codelineno-134-10" href="#__codelineno-134-10"></a><span class="m">127</span>.0.0.1:6380&gt;<span class="w"> </span>get<span class="w"> </span>k1
</span><span id="__span-134-11"><a id="__codelineno-134-11" name="__codelineno-134-11" href="#__codelineno-134-11"></a><span class="s2">"v1"</span>
</span></code></pre></div> <p><strong>Spring Boot é…ç½®</strong></p> <div class="language-yaml highlight"><span class="filename">YAML</span><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="c1">## è¿æ¥ä¸»èŠ‚ç‚¹å³å¯</span>
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="nt">spring</span><span class="p">:</span>
</span><span id="__span-135-3"><a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a><span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
</span><span id="__span-135-4"><a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a><span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span>
</span><span id="__span-135-5"><a id="__codelineno-135-5" name="__codelineno-135-5" href="#__codelineno-135-5"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
</span><span id="__span-135-6"><a id="__codelineno-135-6" name="__codelineno-135-6" href="#__codelineno-135-6"></a><span class="w">    </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span></code></pre></div> <h3 id="112sentinel-æ¨¡å¼">11.2ã€Sentinel æ¨¡å¼<a class="headerlink" href="#112sentinel-æ¨¡å¼" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <h4 id="1121å“¨å…µæ¨¡å¼ä»‹ç»">11.2.1ã€å“¨å…µæ¨¡å¼ä»‹ç»<a class="headerlink" href="#1121å“¨å…µæ¨¡å¼ä»‹ç»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>ä¸»ä»æ¨¡å¼çš„å¼Šç«¯å°±æ˜¯ä¸å…·å¤‡é«˜å¯ç”¨æ€§ï¼Œå½“ master æŒ‚æ‰ä»¥åï¼ŒRedis å°†ä¸èƒ½å†å¯¹å¤–æä¾›å†™å…¥æ“ä½œï¼Œå› æ­¤ sentinel åº”è¿è€Œç”Ÿã€‚</p> <p>sentinel æ¨¡å¼çš„ä¸»è¦ä½œç”¨åœ¨äºå®ƒèƒ½å¤Ÿè‡ªåŠ¨å®Œæˆæ•…éšœå‘ç°å’Œæ•…éšœè½¬ç§»ï¼Œå¹¶é€šçŸ¥å®¢æˆ·ç«¯ï¼Œä»è€Œå®ç°é«˜å¯ç”¨ã€‚</p> <p>sentinel ä¸­æ–‡å«ä¹‰ä¸ºå“¨å…µï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ç›‘æ§ Redis é›†ç¾¤çš„è¿è¡ŒçŠ¶å†µï¼Œå½“ masteræŒ‚äº†ä»¥åï¼Œsentinel ä¼šåœ¨ slave ä¸­é€‰æ‹©ä¸€ä¸ªåšä¸º masterï¼Œå¹¶ä¿®æ”¹å®ƒä»¬çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä»– slave çš„é…ç½®æ–‡ä»¶ä¹Ÿä¼šè¢«ä¿®æ”¹ï¼Œæ¯”å¦‚ slaveof å±æ€§ä¼šæŒ‡å‘æ–°çš„ masterï¼›å½“ master é‡æ–°å¯åŠ¨åï¼Œå®ƒå°†ä¸å†æ˜¯ master è€Œæ˜¯åšä¸º slave æ¥æ”¶æ–°çš„ master çš„åŒæ­¥æ•°æ®ã€‚</p> <p>sentinel å› ä¸ºä¹Ÿæ˜¯ä¸€ä¸ªè¿›ç¨‹æœ‰æŒ‚æ‰çš„å¯èƒ½ï¼Œæ‰€ä»¥ sentinel ä¹Ÿä¼šå¯åŠ¨å¤šä¸ªå½¢æˆä¸€ä¸ª sentinel é›†ç¾¤ï¼Œå¤š sentinel é…ç½®çš„æ—¶å€™ï¼Œsentinel ä¹‹é—´ä¹Ÿä¼šè‡ªåŠ¨ç›‘æ§ï¼Œå½“ä¸»ä»æ¨¡å¼é…ç½®å¯†ç æ—¶ï¼Œsentinel ä¹Ÿä¼šåŒæ­¥å°†é…ç½®ä¿¡æ¯ä¿®æ”¹åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œä¸éœ€è¦æ‹…å¿ƒã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/16f7a31673b35dbf.webp" data-desc-position="bottom"><img src="!assets/Redis/16f7a31673b35dbf.webp" alt="img" style="zoom:80%;"></a></p> <p><strong>å“¨å…µæ¨¡å¼çš„å·¥ä½œæ–¹å¼</strong></p> <ul> <li>åœ¨å“¨å…µæ¨¡å¼åˆ›å»ºæ—¶ï¼Œéœ€è¦é€šè¿‡é…ç½®æŒ‡å®š sentinel ä¸ master ä¹‹é—´çš„å…³ç³»ï¼Œç„¶å sentinel ä¼šä» master ä¸Šè·å–æ‰€æœ‰ slave çš„ä¿¡æ¯ï¼Œä¹‹å sentinel ä¼šå®šæ—¶å‘ master å’Œ slave å‘é€ <code>info</code> å‘½ä»¤è·å–å…¶æ‹“æ‰‘ç»“æ„å’ŒçŠ¶æ€ä¿¡æ¯</li> <li>åŸºäº Redis çš„å‘å¸ƒè®¢é˜…åŠŸèƒ½ï¼Œ æ¯ä¸ª sentinel èŠ‚ç‚¹ä¼šå‘ master çš„ <code>__sentinel__ï¼šhello</code>é¢‘é“ä¸Šå‘é€è¯¥ sentinel èŠ‚ç‚¹å¯¹äº master çš„åˆ¤æ–­ä»¥åŠå½“å‰ sentinel èŠ‚ç‚¹çš„ä¿¡æ¯ ï¼ŒåŒæ—¶æ¯ä¸ª sentinel èŠ‚ç‚¹ä¹Ÿä¼šè®¢é˜…è¯¥é¢‘é“ï¼Œ æ¥è·å–å…¶ä»– Sentinel èŠ‚ç‚¹çš„ä¿¡æ¯ä»¥åŠå®ƒä»¬å¯¹ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­</li> <li>å¦‚æœä¸€ä¸ª master è¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ª master çš„æ‰€æœ‰ sentinel è¿›ç¨‹è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤ master ä¸»æœåŠ¡å™¨çš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€</li> <li>å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ sentinel ï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ sentinel éœ€è¦å¤šä¸ªï¼Œä¸€ä¸ª sentinel å¯èƒ½ä¼šé€ æˆè¯¯åˆ¤ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤ master è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼ˆSDOWNï¼‰ï¼Œ åˆ™ master ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰ï¼Œè¿™æ—¶ä¼šè¿›è¡Œæ•…éšœè½¬ç§»æ“ä½œ</li> <li>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ª sentinel ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘é›†ç¾¤ä¸­çš„æ‰€æœ‰ master ã€slave å‘é€ <code>info</code> å‘½ä»¤</li> <li>å½“ master è¢« sentinel æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰æ—¶ï¼Œsentinel è¿›ç¨‹å‘ä¸‹çº¿çš„ master çš„æ‰€æœ‰ slave å‘é€ <code>info</code> å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡</li> <li>è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ sentinel è¿›ç¨‹åŒæ„ master ä¸‹çº¿ï¼Œ master çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚è‹¥ master é‡æ–°å‘ sentinel è¿›ç¨‹å‘é€ <code>ping</code> å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼Œmaster ä¸»æœåŠ¡å™¨çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤</li> </ul> <p><strong>æ•…éšœè½¬ç§»åŸç†</strong></p> <p>å› ä¸ºæ•…éšœè½¬ç§»çš„å·¥ä½œåªéœ€è¦ä¸€ä¸ª sentinel æ¥å®Œæˆï¼Œæ‰€ä»¥ sentinel ä¹‹é—´ä¼šå†åšä¸€æ¬¡é€‰ä¸¾å·¥ä½œï¼Œ åŸºäº Raft ç®—æ³•é€‰å‡ºä¸€ä¸ª sentinel é¢†å¯¼è€…æ¥è¿›è¡Œæ•…éšœè½¬ç§»çš„å·¥ä½œã€‚ è¢«é€‰ä¸¾å‡ºçš„ sentinel é¢†å¯¼è€…è¿›è¡Œæ•…éšœè½¬ç§»çš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p> <ol> <li>åœ¨ä»èŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰å‡ºä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ–°çš„ masterï¼Œé€‰æ‹©æ–¹æ³•å¦‚ä¸‹ï¼š<ul> <li>è¿‡æ»¤ä¸å¥åº·æˆ–è€…ä¸æ»¡è¶³è¦æ±‚çš„èŠ‚ç‚¹</li> <li>é€‰æ‹© slave-priorityï¼ˆä¼˜å…ˆçº§ï¼‰æœ€é«˜çš„ slaveï¼Œ å¦‚æœå­˜åœ¨åˆ™è¿”å›ï¼Œ ä¸å­˜åœ¨åˆ™ç»§ç»­</li> <li>é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„ slave ï¼Œ å¦‚æœå­˜åœ¨åˆ™è¿”å›ï¼Œ ä¸å­˜åœ¨åˆ™ç»§ç»­</li> <li>é€‰æ‹© runid æœ€å°çš„ salve</li> </ul> </li> <li>sentinel é¢†å¯¼è€…ä¼šå¯¹é€‰å‡ºæ¥çš„ slave æ‰§è¡Œ <code>slaveof no one</code> å‘½ä»¤è®©å…¶æˆä¸º master</li> <li>sentinel é¢†å¯¼è€…ä¼šå‘å‰©ä½™çš„ slave å‘é€å‘½ä»¤ï¼Œè®©ä»–ä»¬ä»æ–°çš„ master ä¸Šå¤åˆ¶æ•°æ®</li> <li>sentinel é¢†å¯¼è€…ä¼šå°†åŸæ¥çš„ masteræ›´æ–°ä¸ºä»èŠ‚ç‚¹ï¼Œ å¹¶å¯¹å…¶è¿›è¡Œç›‘æ§ï¼Œ å½“å…¶æ¢å¤åå‘½ä»¤å®ƒå»å¤åˆ¶æ–°çš„ master</li> </ol> <h4 id="1122å“¨å…µæ¨¡å¼æ­å»º">11.2.2ã€å“¨å…µæ¨¡å¼æ­å»º<a class="headerlink" href="#1122å“¨å…µæ¨¡å¼æ­å»º" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Redis é…ç½®æ–‡ä»¶ç”¨ä¸»ä»å¤åˆ¶çš„é‚£ä¸‰ä¸ª</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="c1">## åœ¨dataæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªsentinelé…ç½®æ–‡ä»¶</span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a>vim<span class="w"> </span>sentinel_26379.conf
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a>
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a><span class="c1">## sentinel_26379é…ç½®</span>
</span><span id="__span-136-5"><a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a>port<span class="w"> </span><span class="m">26379</span>
</span><span id="__span-136-6"><a id="__codelineno-136-6" name="__codelineno-136-6" href="#__codelineno-136-6"></a>daemonize<span class="w"> </span>no
</span><span id="__span-136-7"><a id="__codelineno-136-7" name="__codelineno-136-7" href="#__codelineno-136-7"></a>logfile<span class="w"> </span><span class="m">26379</span>.log
</span><span id="__span-136-8"><a id="__codelineno-136-8" name="__codelineno-136-8" href="#__codelineno-136-8"></a>dir<span class="w"> </span>/root/data
</span><span id="__span-136-9"><a id="__codelineno-136-9" name="__codelineno-136-9" href="#__codelineno-136-9"></a>sentinel<span class="w"> </span>monitor<span class="w"> </span>mymaster<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="m">6379</span><span class="w"> </span><span class="m">2</span>
</span><span id="__span-136-10"><a id="__codelineno-136-10" name="__codelineno-136-10" href="#__codelineno-136-10"></a>sentinel<span class="w"> </span>down-after-milliseconds<span class="w"> </span>mymaster<span class="w"> </span><span class="m">30000</span>
</span><span id="__span-136-11"><a id="__codelineno-136-11" name="__codelineno-136-11" href="#__codelineno-136-11"></a>sentinel<span class="w"> </span>parallel-syncs<span class="w"> </span>mymaster<span class="w"> </span><span class="m">1</span>
</span><span id="__span-136-12"><a id="__codelineno-136-12" name="__codelineno-136-12" href="#__codelineno-136-12"></a>sentinel<span class="w"> </span>failover-timeout<span class="w"> </span>mymaster<span class="w"> </span><span class="m">180000</span>
</span><span id="__span-136-13"><a id="__codelineno-136-13" name="__codelineno-136-13" href="#__codelineno-136-13"></a>
</span><span id="__span-136-14"><a id="__codelineno-136-14" name="__codelineno-136-14" href="#__codelineno-136-14"></a><span class="c1">## å°†é…ç½®æ–‡ä»¶å¤åˆ¶ä¸¤ä»½ï¼Œæ›´æ”¹ç«¯å£</span>
</span><span id="__span-136-15"><a id="__codelineno-136-15" name="__codelineno-136-15" href="#__codelineno-136-15"></a>sed<span class="w"> </span><span class="s1">'s/26379/26380/g'</span><span class="w"> </span>sentinel_26379.conf<span class="w"> </span>&gt;<span class="w"> </span>sentinel_26380.conf
</span><span id="__span-136-16"><a id="__codelineno-136-16" name="__codelineno-136-16" href="#__codelineno-136-16"></a>sed<span class="w"> </span><span class="s1">'s/26379/26381/g'</span><span class="w"> </span>sentinel_26379.conf<span class="w"> </span>&gt;<span class="w"> </span>sentinel_26381.conf
</span><span id="__span-136-17"><a id="__codelineno-136-17" name="__codelineno-136-17" href="#__codelineno-136-17"></a>
</span><span id="__span-136-18"><a id="__codelineno-136-18" name="__codelineno-136-18" href="#__codelineno-136-18"></a><span class="c1">## å¯åŠ¨ä¸‰ä¸ªredis</span>
</span><span id="__span-136-19"><a id="__codelineno-136-19" name="__codelineno-136-19" href="#__codelineno-136-19"></a>redis-server<span class="w"> </span>redis_6379.conf
</span><span id="__span-136-20"><a id="__codelineno-136-20" name="__codelineno-136-20" href="#__codelineno-136-20"></a>redis-server<span class="w"> </span>redis_6380.conf
</span><span id="__span-136-21"><a id="__codelineno-136-21" name="__codelineno-136-21" href="#__codelineno-136-21"></a>redis-server<span class="w"> </span>redis_6381.conf
</span><span id="__span-136-22"><a id="__codelineno-136-22" name="__codelineno-136-22" href="#__codelineno-136-22"></a>
</span><span id="__span-136-23"><a id="__codelineno-136-23" name="__codelineno-136-23" href="#__codelineno-136-23"></a><span class="c1">## å¯åŠ¨ä¸‰ä¸ªsentinel</span>
</span><span id="__span-136-24"><a id="__codelineno-136-24" name="__codelineno-136-24" href="#__codelineno-136-24"></a>redis-sentinel<span class="w"> </span>sentinel_26379.conf
</span><span id="__span-136-25"><a id="__codelineno-136-25" name="__codelineno-136-25" href="#__codelineno-136-25"></a>redis-sentinel<span class="w"> </span>sentinel_26380.conf
</span><span id="__span-136-26"><a id="__codelineno-136-26" name="__codelineno-136-26" href="#__codelineno-136-26"></a>redis-sentinel<span class="w"> </span>sentinel_26381.conf
</span></code></pre></div> <p>ä½¿ç”¨<code>ps -ef | grep redis</code>æŸ¥çœ‹è¿›ç¨‹</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210606181835383.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210606181835383.png" alt="image-20210606181835383" style></a></p> <p>å¯ä»¥ä½¿ç”¨ <code>info replication</code> å‘½ä»¤æŸ¥çœ‹ Redis é›†ç¾¤çš„çŠ¶æ€ï¼Œæ­¤æ—¶è¾“å‡ºå¦‚ä¸‹ã€‚å¯ä»¥çœ‹åˆ° 6379 èŠ‚ç‚¹ä¸º master èŠ‚ç‚¹ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªä»èŠ‚ç‚¹ï¼Œåˆ†åˆ«ä¸º slave0 å’Œ slave1ï¼Œå¯¹åº”çš„ç«¯å£ä¸º 6380 å’Œ 6381ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210606184707240.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210606184707240.png" alt="image-20210606184707240" style></a></p> <p>å¯ä»¥ä½¿ç”¨ <code>info Sentinel</code> å‘½ä»¤æŸ¥çœ‹ä»»æ„ sentinel èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œä»æœ€åä¸€å¥è¾“å‡ºå¯ä»¥çœ‹åˆ° sentinel èŠ‚ç‚¹å·²ç»æ„ŸçŸ¥åˆ° 6379 çš„ master èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¹ŸçŸ¥é“å®ƒæœ‰ä¸¤ä¸ª slaves èŠ‚ç‚¹ï¼›åŒæ—¶ sentinel èŠ‚ç‚¹å½¼æ­¤ä¹‹é—´ä¹Ÿæ„ŸçŸ¥åˆ°ï¼Œå…±æœ‰ 3 ä¸ª sentinel èŠ‚ç‚¹ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210606184818585.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210606184818585.png" alt="image-20210606184818585" style></a></p> <p><strong>æ•°æ®åŒæ­¥éªŒè¯ï¼š</strong></p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a>root@Orichalcos:~/data#<span class="w"> </span>redis-cli<span class="w"> </span>-p<span class="w"> </span><span class="m">6379</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>k1<span class="w"> </span>vi
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a>OK
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a>root@Orichalcos:~/data#<span class="w"> </span>redis-cli<span class="w"> </span>-p<span class="w"> </span><span class="m">6380</span><span class="w"> </span>get<span class="w"> </span>k1
</span><span id="__span-137-4"><a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="s2">"vi"</span>
</span></code></pre></div> <p>å…ˆæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼Œè¿™æ—¶ 6379 ä¸º masterï¼Œæœ‰ä¸¤ä¸ª slaveï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210606190000723.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210606190000723.png" alt="image-20210606190000723" style></a></p> <p>ç„¶ååœ¨ 6379 ç»ˆç«¯æŒ‰<code>Ctrl+C</code>å…³é—­ Redisï¼Œç­‰å¾…ä¸€æ®µæ—¶å€™åï¼Œå†æ¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210606190306176.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210606190306176.png" alt="image-20210606190306176" style></a></p> <p>è¿™ä¸ªæ—¶å€™ 6381 æˆä¸ºäº† masterï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ª slaveã€‚ç„¶åæ§åˆ¶ 6379 ä¸Šçº¿ï¼Œå†æ¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210606190522114.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210606190522114.png" alt="image-20210606190522114" style></a></p> <p>æ­¤æ—¶ 6379 å˜ä¸ºäº† slaveï¼Œ 6381 å·²ç„¶ç¿»èº«åšä¸»ã€‚</p> <p><strong>Spring Boot é…ç½®</strong></p> <div class="language-yaml highlight"><span class="filename">YAML</span><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="c1">## è®°å¾—å¼€å¯å“¨å…µçš„è¿œç¨‹è¿æ¥</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="nt">spring</span><span class="p">:</span>
</span><span id="__span-138-3"><a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a><span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
</span><span id="__span-138-4"><a id="__codelineno-138-4" name="__codelineno-138-4" href="#__codelineno-138-4"></a><span class="w">    </span><span class="nt">sentinel</span><span class="p">:</span>
</span><span id="__span-138-5"><a id="__codelineno-138-5" name="__codelineno-138-5" href="#__codelineno-138-5"></a><span class="w">      </span><span class="c1"># masterçš„åç§°ï¼Œå“¨å…µé…ç½®æ–‡ä»¶é‡Œ sentinel monitor æ‰€é…ç½®çš„ä¸»èŠ‚ç‚¹åå­—</span>
</span><span id="__span-138-6"><a id="__codelineno-138-6" name="__codelineno-138-6" href="#__codelineno-138-6"></a><span class="w">      </span><span class="nt">master</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mymaster</span>
</span><span id="__span-138-7"><a id="__codelineno-138-7" name="__codelineno-138-7" href="#__codelineno-138-7"></a><span class="w">      </span><span class="c1"># å“¨å…µçš„IP:Portåˆ—è¡¨</span>
</span><span id="__span-138-8"><a id="__codelineno-138-8" name="__codelineno-138-8" href="#__codelineno-138-8"></a><span class="w">      </span><span class="nt">nodes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1:26379,127.0.0.1:26380,127.0.0.1:26381</span>
</span></code></pre></div> <h3 id="113cluster-æ¨¡å¼">11.3ã€Cluster æ¨¡å¼<a class="headerlink" href="#113cluster-æ¨¡å¼" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <h4 id="1131cluster-æ¨¡å¼ä»‹ç»">11.3.1ã€Cluster æ¨¡å¼ä»‹ç»<a class="headerlink" href="#1131cluster-æ¨¡å¼ä»‹ç»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>Redis Clusteræ˜¯ä¸€ç§æœåŠ¡å™¨ Shardingï¼ˆåˆ†ç‰‡ï¼‰ æŠ€æœ¯ï¼Œ3.0ç‰ˆæœ¬å¼€å§‹æ­£å¼æä¾›ã€‚</p> <p>Redis çš„å“¨å…µæ¨¡å¼åŸºæœ¬å·²ç»å¯ä»¥å®ç°é«˜å¯ç”¨ï¼Œè¯»å†™åˆ†ç¦» ï¼Œä½†æ˜¯åœ¨è¿™ç§æ¨¡å¼ä¸‹æ¯å° Redis æœåŠ¡å™¨éƒ½å­˜å‚¨ç›¸åŒçš„æ•°æ®ï¼Œå¾ˆæµªè´¹å†…å­˜ï¼Œæ‰€ä»¥åœ¨ Redis3.0ä¸ŠåŠ å…¥äº† Cluster é›†ç¾¤æ¨¡å¼ï¼Œå®ç°äº† Redis çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯å° Redis èŠ‚ç‚¹ä¸Šå­˜å‚¨ä¸åŒçš„å†…å®¹ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/1460000022808584.png" data-desc-position="bottom"><img src="!assets/Redis/1460000022808584.png" alt="image-20200531184321294" style="zoom:80%;"></a></p> <p>åœ¨è¿™ä¸ªå›¾ä¸­ï¼Œæ¯ä¸€ä¸ªè“è‰²çš„åœˆéƒ½ä»£è¡¨ç€ä¸€ä¸ª Redis çš„æœåŠ¡å™¨èŠ‚ç‚¹ã€‚å®ƒä»¬ä»»ä½•ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½æ˜¯ç›¸äº’è¿é€šçš„ã€‚å®¢æˆ·ç«¯å¯ä»¥ä¸ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ç›¸è¿æ¥ï¼Œç„¶åå°±å¯ä»¥è®¿é—®é›†ç¾¤ä¸­çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¯¹å…¶è¿›è¡Œå­˜å–å’Œå…¶ä»–æ“ä½œã€‚</p> <p><strong>é›†ç¾¤çš„æ•°æ®åˆ†ç‰‡</strong></p> <p>Redis é›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§ hashï¼Œè€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½ã€hash slotã€‘çš„æ¦‚å¿µã€‚</p> <p>Redis é›†ç¾¤æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ª key é€šè¿‡ CRC16 æ ¡éªŒåå¯¹ 16384 å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ã€‚é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ† hash æ§½ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚å½“å‰é›†ç¾¤æœ‰3ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆï¼š</p> <ul> <li>èŠ‚ç‚¹ A åŒ…å« 0 åˆ° 5460 å·å“ˆå¸Œæ§½</li> <li>èŠ‚ç‚¹ B åŒ…å« 5461 åˆ° 10922 å·å“ˆå¸Œæ§½</li> <li>èŠ‚ç‚¹ C åŒ…å« 10923 åˆ° 16383 å·å“ˆå¸Œæ§½</li> </ul> <p>è¿™ç§ç»“æ„å¾ˆå®¹æ˜“æ·»åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹ã€‚æ¯”å¦‚å¦‚æœæˆ‘æƒ³æ–°æ·»åŠ ä¸ªèŠ‚ç‚¹ D ï¼Œ æˆ‘éœ€è¦ä»èŠ‚ç‚¹ Aï¼Œ Bï¼Œ C ä¸­å¾—éƒ¨åˆ†æ§½åˆ° D ä¸Šã€‚å¦‚æœæˆ‘æƒ³ç§»é™¤èŠ‚ç‚¹ A ï¼Œéœ€è¦å°† A ä¸­çš„æ§½ç§»åˆ° B å’Œ C èŠ‚ç‚¹ä¸Šï¼Œç„¶åå°†æ²¡æœ‰ä»»ä½•æ§½çš„ A èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤å³å¯ã€‚ç”±äºä»ä¸€ä¸ªèŠ‚ç‚¹å°†å“ˆå¸Œæ§½ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹å¹¶ä¸ä¼šåœæ­¢æœåŠ¡ï¼Œæ‰€ä»¥æ— è®ºæ·»åŠ åˆ é™¤æˆ–è€…æ”¹å˜æŸä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œæ§½çš„æ•°é‡éƒ½ä¸ä¼šé€ æˆé›†ç¾¤ä¸å¯ç”¨çš„çŠ¶æ€ã€‚</p> <p>åœ¨ Redis çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œéƒ½æœ‰è¿™ä¹ˆä¸¤ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯æ’æ§½ï¼ˆslotï¼‰ï¼Œå®ƒçš„çš„å–å€¼èŒƒå›´æ˜¯ï¼š0-16383ã€‚è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ clusterï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªé›†ç¾¤ç®¡ç†çš„æ’ä»¶ã€‚å½“æˆ‘ä»¬çš„å­˜å–çš„ Key åˆ°è¾¾çš„æ—¶å€™ï¼ŒRedis ä¼šæ ¹æ® CRC16 çš„ç®—æ³•å¾—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæŠŠç»“æœå¯¹ 16384 æ±‚ä½™æ•°ï¼Œè¿™æ ·æ¯ä¸ª key éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨ 0-16383 ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œé€šè¿‡è¿™ä¸ªå€¼ï¼Œå»æ‰¾åˆ°å¯¹åº”çš„æ’æ§½æ‰€å¯¹åº”çš„èŠ‚ç‚¹ï¼Œç„¶åç›´æ¥è‡ªåŠ¨è·³è½¬åˆ°è¿™ä¸ªå¯¹åº”çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œå­˜å–æ“ä½œã€‚</p> <p><strong>Redis é›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹</strong></p> <p>ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œredis-cluster é›†ç¾¤å¼•å…¥äº†ä¸»ä»å¤åˆ¶æ¨¡å‹ï¼Œä¸€ä¸ª master å¯¹åº”ä¸€ä¸ªæˆ–è€…å¤šä¸ª slaveï¼Œå½“ master å®•æœºçš„æ—¶å€™ï¼Œå°±ä¼šå¯ç”¨ slaveã€‚å½“å…¶å®ƒ master <code>ping</code> ä¸€ä¸ª master A æ—¶ï¼Œå¦‚æœåŠæ•°ä»¥ä¸Šçš„ master ä¸ A é€šä¿¡è¶…æ—¶ï¼Œé‚£ä¹ˆè®¤ä¸º master A å®•æœºäº†ã€‚å¦‚æœ master A å’Œå®ƒçš„ slave A1 éƒ½å®•æœºäº†ï¼Œé‚£ä¹ˆè¯¥é›†ç¾¤å°±æ— æ³•å†æä¾›æœåŠ¡äº†ã€‚</p> <p>é›†ç¾¤çš„ç‰¹ç‚¹ï¼š</p> <ul> <li>æ‰€æœ‰çš„ Redis èŠ‚ç‚¹å½¼æ­¤äº’è”ï¼ˆPING-PONGæœºåˆ¶ï¼‰ï¼Œå†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½</li> <li>èŠ‚ç‚¹çš„ fail æ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆ</li> <li>å®¢æˆ·ç«¯ä¸ Redis èŠ‚ç‚¹ç›´è¿ï¼Œä¸éœ€è¦ä¸­é—´ä»£ç†å±‚ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯</li> </ul> <h4 id="1132cluster-æ¨¡å¼æ­å»º">11.3.2ã€Cluster æ¨¡å¼æ­å»º<a class="headerlink" href="#1132cluster-æ¨¡å¼æ­å»º" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="c1">## æ¸…é™¤æ‰dataæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œåœ¨é‡Œé¢æ–°å»ºä¸€ä¸ªredis_6379.conf</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a>vim<span class="w"> </span>redis_6379.conf
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a>
</span><span id="__span-139-4"><a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="c1">## å†™å…¥ä»¥ä¸‹å†…å®¹</span>
</span><span id="__span-139-5"><a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a>include<span class="w"> </span>/etc/redis/redis.conf
</span><span id="__span-139-6"><a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a>port<span class="w"> </span><span class="m">6379</span>
</span><span id="__span-139-7"><a id="__codelineno-139-7" name="__codelineno-139-7" href="#__codelineno-139-7"></a>daemonize<span class="w"> </span>no
</span><span id="__span-139-8"><a id="__codelineno-139-8" name="__codelineno-139-8" href="#__codelineno-139-8"></a>pidfile<span class="w"> </span>/root/data/redis_6379.pid
</span><span id="__span-139-9"><a id="__codelineno-139-9" name="__codelineno-139-9" href="#__codelineno-139-9"></a>logfile<span class="w"> </span><span class="s2">"redis_6379.log"</span>
</span><span id="__span-139-10"><a id="__codelineno-139-10" name="__codelineno-139-10" href="#__codelineno-139-10"></a>dbfilename<span class="w"> </span>dump_6379.rdb
</span><span id="__span-139-11"><a id="__codelineno-139-11" name="__codelineno-139-11" href="#__codelineno-139-11"></a>dir<span class="w"> </span>/root/data
</span><span id="__span-139-12"><a id="__codelineno-139-12" name="__codelineno-139-12" href="#__codelineno-139-12"></a>cluster-enabled<span class="w"> </span>yes<span class="w"> </span>
</span><span id="__span-139-13"><a id="__codelineno-139-13" name="__codelineno-139-13" href="#__codelineno-139-13"></a>cluster-config-file<span class="w"> </span>nodes_6379.conf<span class="w"> </span>
</span><span id="__span-139-14"><a id="__codelineno-139-14" name="__codelineno-139-14" href="#__codelineno-139-14"></a>cluster-node-timeout<span class="w"> </span><span class="m">15000</span>
</span><span id="__span-139-15"><a id="__codelineno-139-15" name="__codelineno-139-15" href="#__codelineno-139-15"></a>
</span><span id="__span-139-16"><a id="__codelineno-139-16" name="__codelineno-139-16" href="#__codelineno-139-16"></a><span class="c1">## å°†æ–‡ä»¶å¤åˆ¶äº”ä»½ï¼Œæ›´æ”¹å…¶ä¸­ç«¯å£ç­‰ä¿¡æ¯</span>
</span><span id="__span-139-17"><a id="__codelineno-139-17" name="__codelineno-139-17" href="#__codelineno-139-17"></a>sed<span class="w"> </span><span class="s1">'s/6379/6380/g'</span><span class="w"> </span>redis_6379.conf<span class="w"> </span>&gt;<span class="w"> </span>redis_6380.conf
</span><span id="__span-139-18"><a id="__codelineno-139-18" name="__codelineno-139-18" href="#__codelineno-139-18"></a>sed<span class="w"> </span><span class="s1">'s/6379/6381/g'</span><span class="w"> </span>redis_6379.conf<span class="w"> </span>&gt;<span class="w"> </span>redis_6381.conf
</span><span id="__span-139-19"><a id="__codelineno-139-19" name="__codelineno-139-19" href="#__codelineno-139-19"></a>sed<span class="w"> </span><span class="s1">'s/6379/6382/g'</span><span class="w"> </span>redis_6379.conf<span class="w"> </span>&gt;<span class="w"> </span>redis_6382.conf
</span><span id="__span-139-20"><a id="__codelineno-139-20" name="__codelineno-139-20" href="#__codelineno-139-20"></a>sed<span class="w"> </span><span class="s1">'s/6379/6383/g'</span><span class="w"> </span>redis_6379.conf<span class="w"> </span>&gt;<span class="w"> </span>redis_6383.conf
</span><span id="__span-139-21"><a id="__codelineno-139-21" name="__codelineno-139-21" href="#__codelineno-139-21"></a>sed<span class="w"> </span><span class="s1">'s/6379/6384/g'</span><span class="w"> </span>redis_6379.conf<span class="w"> </span>&gt;<span class="w"> </span>redis_6384.conf
</span></code></pre></div> <p>ä½¿ç”¨<code>ps -ef | grep redis</code>æŸ¥çœ‹çŠ¶æ€ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210607151158183.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210607151158183.png" alt="image-20210607151158183" style></a></p> <p>åˆ›å»ºé›†ç¾¤ï¼Œ<code>--cluster-replicas 1</code>çš„æ„æ€æ˜¯åˆ›å»º master çš„æ—¶å€™åŒæ—¶åˆ›å»ºä¸€ä¸ª slaveï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a>redis-cli<span class="w"> </span>--cluster<span class="w"> </span>create<span class="w"> </span><span class="m">127</span>.0.0.1:6379<span class="w"> </span><span class="m">127</span>.0.0.1:6380<span class="w"> </span><span class="m">127</span>.0.0.1:6381<span class="w"> </span><span class="m">127</span>.0.0.1:6382<span class="w"> </span><span class="m">127</span>.0.0.1:6383<span class="w"> </span><span class="m">127</span>.0.0.1:6384<span class="w"> </span>--cluster-replicas<span class="w"> </span><span class="m">1</span>
</span></code></pre></div> <p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©çš„æ˜¯ä¸€ä¸»ä¸€ä»ï¼Œä¸€å…±å…­ä¸ªæœåŠ¡å™¨ï¼Œæ‰€ä»¥å…ˆè¾“å…¥çš„ 6379ã€6380ã€6381 ä¼šæˆä¸º materï¼Œå…¶ä½™çš„ä¸º slaveã€‚ä¸‹é¢æ˜¾ç¤º master0 çš„æ§½ä¸º 0-5460ã€master1 çš„æ§½ä¸º 5461-10922ã€master2 çš„æ§½ä¸º 10923-16383ã€‚åŒæ—¶ 6383 ä½œä¸º slave æŒ‡å‘ 6379ã€6384 ä½œä¸º slave æŒ‡å‘ 6380ã€6382 ä½œä¸º slave æŒ‡å‘ 6381ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210607151442056.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210607151442056.png" alt="image-20210607151442056" style></a></p> <p>å¦‚æœä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼Œå°±è¾“å…¥ yes åŒæ„ï¼Œè¿™æ—¶ä¼šå¼€å§‹åˆ›å»ºï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210607152207273.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210607152207273.png" alt="image-20210607152207273" style></a></p> <p>å¯ä»¥é€šè¿‡<code>cluster nodes</code>å‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210607154756105.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210607154756105.png" alt="image-20210607154756105" style></a></p> <p><strong>æ•°æ®éªŒè¯</strong></p> <p>æ³¨æ„ é›†ç¾¤æ¨¡å¼ä¸‹è¦å¸¦å‚æ•° <code>-c</code>ï¼Œè¡¨ç¤ºé›†ç¾¤ï¼Œå¦åˆ™åœ¨å­˜çš„æ—¶å€™ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯é›†ç¾¤ Aï¼Œä½†æ˜¯ç®—å‡ºæ¥è¦å­˜çš„æ§½çš„æ‰€åœ¨åœ°ä¸ºé›†ç¾¤ Bï¼Œè¿™æ—¶ä¼šæŠ¥é”™ï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a>root@Orichalcos:~/data#<span class="w"> </span>redis-cli<span class="w"> </span>-p<span class="w"> </span><span class="m">6379</span>
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>v1<span class="w"> </span>v1
</span><span id="__span-141-3"><a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a>OK
</span><span id="__span-141-4"><a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>v234324234<span class="w"> </span>k2
</span><span id="__span-141-5"><a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a>OK
</span><span id="__span-141-6"><a id="__codelineno-141-6" name="__codelineno-141-6" href="#__codelineno-141-6"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>vajflakjflajfklj<span class="w"> </span>k
</span><span id="__span-141-7"><a id="__codelineno-141-7" name="__codelineno-141-7" href="#__codelineno-141-7"></a><span class="o">(</span>error<span class="o">)</span><span class="w"> </span>MOVED<span class="w"> </span><span class="m">10368</span><span class="w"> </span><span class="m">127</span>.0.0.1:6380
</span><span id="__span-141-8"><a id="__codelineno-141-8" name="__codelineno-141-8" href="#__codelineno-141-8"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">exit</span>
</span><span id="__span-141-9"><a id="__codelineno-141-9" name="__codelineno-141-9" href="#__codelineno-141-9"></a>root@Orichalcos:~/data#<span class="w"> </span>redis-cli<span class="w"> </span>-p<span class="w"> </span><span class="m">6379</span><span class="w"> </span>-c
</span><span id="__span-141-10"><a id="__codelineno-141-10" name="__codelineno-141-10" href="#__codelineno-141-10"></a><span class="m">127</span>.0.0.1:6379&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>vajflakjflajfklj<span class="w"> </span>k
</span><span id="__span-141-11"><a id="__codelineno-141-11" name="__codelineno-141-11" href="#__codelineno-141-11"></a>-&gt;<span class="w"> </span>Redirected<span class="w"> </span>to<span class="w"> </span>slot<span class="w"> </span><span class="o">[</span><span class="m">10368</span><span class="o">]</span><span class="w"> </span>located<span class="w"> </span>at<span class="w"> </span><span class="m">127</span>.0.0.1:6380
</span><span id="__span-141-12"><a id="__codelineno-141-12" name="__codelineno-141-12" href="#__codelineno-141-12"></a>OK
</span><span id="__span-141-13"><a id="__codelineno-141-13" name="__codelineno-141-13" href="#__codelineno-141-13"></a><span class="m">127</span>.0.0.1:6380&gt;
</span></code></pre></div> <p><strong>Spring Booté…ç½®</strong></p> <div class="language-yaml highlight"><span class="filename">YAML</span><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="nt">spring</span><span class="p">:</span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a><span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span>
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a><span class="w">      </span><span class="c1"># ä¹¦å†™é›†ç¾¤ä¸­æ‰€æœ‰çš„nodes</span>
</span><span id="__span-142-5"><a id="__codelineno-142-5" name="__codelineno-142-5" href="#__codelineno-142-5"></a><span class="w">      </span><span class="nt">nodes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1:6379,127.0.0.1:6380,127.0.0.1:6381,127.0.0.1:6382,127.0.0.1:6383,127.0.0.1:6384</span>
</span><span id="__span-142-6"><a id="__codelineno-142-6" name="__codelineno-142-6" href="#__codelineno-142-6"></a><span class="w">      </span><span class="c1"># é‡å®šå‘çš„æœ€å¤§æ¬¡æ•°</span>
</span><span id="__span-142-7"><a id="__codelineno-142-7" name="__codelineno-142-7" href="#__codelineno-142-7"></a><span class="w">      </span><span class="nt">max-redirects</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span></code></pre></div> <h4 id="1133redis-cluster-æ“ä½œ">11.3.3ã€Redis Cluster æ“ä½œ<a class="headerlink" href="#1133redis-cluster-æ“ä½œ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>å¯ä»¥é€šè¿‡ <code>redis-cli --cluster help</code> æŸ¥çœ‹æ‰‹å†Œï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a>redis-cli<span class="w"> </span>--cluster<span class="w"> </span><span class="nb">help</span>
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a>Cluster<span class="w"> </span>Manager<span class="w"> </span>Commands:
</span><span id="__span-143-3"><a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a><span class="w">  </span>create<span class="w">         </span>host1:port1<span class="w"> </span>...<span class="w"> </span>hostN:portN<span class="w">   </span><span class="c1">#åˆ›å»ºé›†ç¾¤</span>
</span><span id="__span-143-4"><a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a><span class="w">                 </span>--cluster-replicas<span class="w"> </span>&lt;arg&gt;<span class="w">      </span><span class="c1">#ä»èŠ‚ç‚¹ä¸ªæ•°</span>
</span><span id="__span-143-5"><a id="__codelineno-143-5" name="__codelineno-143-5" href="#__codelineno-143-5"></a>
</span><span id="__span-143-6"><a id="__codelineno-143-6" name="__codelineno-143-6" href="#__codelineno-143-6"></a><span class="w">  </span>check<span class="w">          </span>host:port<span class="w">                     </span><span class="c1">#æ£€æŸ¥é›†ç¾¤</span>
</span><span id="__span-143-7"><a id="__codelineno-143-7" name="__codelineno-143-7" href="#__codelineno-143-7"></a><span class="w">                 </span>--cluster-search-multiple-owners<span class="w"> </span><span class="c1">#æ£€æŸ¥æ˜¯å¦æœ‰æ§½åŒæ—¶è¢«åˆ†é…ç»™äº†å¤šä¸ªèŠ‚ç‚¹</span>
</span><span id="__span-143-8"><a id="__codelineno-143-8" name="__codelineno-143-8" href="#__codelineno-143-8"></a>
</span><span id="__span-143-9"><a id="__codelineno-143-9" name="__codelineno-143-9" href="#__codelineno-143-9"></a><span class="w">  </span>info<span class="w">           </span>host:port<span class="w">                     </span><span class="c1">#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</span>
</span><span id="__span-143-10"><a id="__codelineno-143-10" name="__codelineno-143-10" href="#__codelineno-143-10"></a>
</span><span id="__span-143-11"><a id="__codelineno-143-11" name="__codelineno-143-11" href="#__codelineno-143-11"></a><span class="w">  </span>fix<span class="w">            </span>host:port<span class="w">                     </span><span class="c1">#ä¿®å¤é›†ç¾¤</span>
</span><span id="__span-143-12"><a id="__codelineno-143-12" name="__codelineno-143-12" href="#__codelineno-143-12"></a><span class="w">                 </span>--cluster-search-multiple-owners<span class="w"> </span><span class="c1">#ä¿®å¤æ§½çš„é‡å¤åˆ†é…é—®é¢˜</span>
</span><span id="__span-143-13"><a id="__codelineno-143-13" name="__codelineno-143-13" href="#__codelineno-143-13"></a>
</span><span id="__span-143-14"><a id="__codelineno-143-14" name="__codelineno-143-14" href="#__codelineno-143-14"></a><span class="w">  </span>reshard<span class="w">        </span>host:port<span class="w">                     </span><span class="c1">#æŒ‡å®šé›†ç¾¤çš„ä»»æ„ä¸€èŠ‚ç‚¹è¿›è¡Œè¿ç§»slotï¼Œé‡æ–°åˆ†slots</span>
</span><span id="__span-143-15"><a id="__codelineno-143-15" name="__codelineno-143-15" href="#__codelineno-143-15"></a><span class="w">                 </span>--cluster-from<span class="w"> </span>&lt;arg&gt;<span class="w">          </span><span class="c1">#éœ€è¦ä»å“ªäº›æºèŠ‚ç‚¹ä¸Šè¿ç§»slotï¼Œå¯ä»å¤šä¸ªæºèŠ‚ç‚¹å®Œæˆè¿ç§»ï¼Œä»¥é€—å·éš”å¼€ï¼Œ</span>
</span><span id="__span-143-16"><a id="__codelineno-143-16" name="__codelineno-143-16" href="#__codelineno-143-16"></a><span class="w">                                               </span><span class="c1">#ä¼ é€’çš„æ˜¯èŠ‚ç‚¹çš„node idï¼Œè¿˜å¯ä»¥ç›´æ¥ä¼ é€’--from allï¼Œè¿™æ ·æºèŠ‚ç‚¹å°±æ˜¯é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œ</span>
</span><span id="__span-143-17"><a id="__codelineno-143-17" name="__codelineno-143-17" href="#__codelineno-143-17"></a><span class="w">                                               </span><span class="c1">#ä¸ä¼ é€’è¯¥å‚æ•°çš„è¯ï¼Œåˆ™ä¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­æç¤ºç”¨æˆ·è¾“å…¥</span>
</span><span id="__span-143-18"><a id="__codelineno-143-18" name="__codelineno-143-18" href="#__codelineno-143-18"></a><span class="w">                 </span>--cluster-to<span class="w"> </span>&lt;arg&gt;<span class="w">            </span><span class="c1">#slotéœ€è¦è¿ç§»çš„ç›®çš„èŠ‚ç‚¹çš„node idï¼Œç›®çš„èŠ‚ç‚¹åªèƒ½å¡«å†™ä¸€ä¸ªï¼Œä¸ä¼ é€’è¯¥å‚æ•°çš„è¯ï¼Œ </span>
</span><span id="__span-143-19"><a id="__codelineno-143-19" name="__codelineno-143-19" href="#__codelineno-143-19"></a><span class="w">                                               </span><span class="c1">#åˆ™ä¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­æç¤ºç”¨æˆ·è¾“å…¥</span>
</span><span id="__span-143-20"><a id="__codelineno-143-20" name="__codelineno-143-20" href="#__codelineno-143-20"></a><span class="w">                 </span>--cluster-slots<span class="w"> </span>&lt;arg&gt;<span class="w">         </span><span class="c1">#éœ€è¦è¿ç§»çš„slotæ•°é‡ï¼Œä¸ä¼ é€’è¯¥å‚æ•°çš„è¯ï¼Œåˆ™ä¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­æç¤ºç”¨æˆ·è¾“å…¥ã€‚</span>
</span><span id="__span-143-21"><a id="__codelineno-143-21" name="__codelineno-143-21" href="#__codelineno-143-21"></a><span class="w">                 </span>--cluster-yes<span class="w">                 </span><span class="c1">#æŒ‡å®šè¿ç§»æ—¶çš„ç¡®è®¤è¾“å…¥</span>
</span><span id="__span-143-22"><a id="__codelineno-143-22" name="__codelineno-143-22" href="#__codelineno-143-22"></a><span class="w">                 </span>--cluster-timeout<span class="w"> </span>&lt;arg&gt;<span class="w">       </span><span class="c1">#è®¾ç½®migrateå‘½ä»¤çš„è¶…æ—¶æ—¶é—´</span>
</span><span id="__span-143-23"><a id="__codelineno-143-23" name="__codelineno-143-23" href="#__codelineno-143-23"></a><span class="w">                 </span>--cluster-pipeline<span class="w"> </span>&lt;arg&gt;<span class="w">      </span><span class="c1">#å®šä¹‰cluster getkeysinslotå‘½ä»¤ä¸€æ¬¡å–å‡ºçš„keyæ•°é‡ï¼Œä¸ä¼ çš„è¯ä½¿ç”¨é»˜è®¤å€¼ä¸º10</span>
</span><span id="__span-143-24"><a id="__codelineno-143-24" name="__codelineno-143-24" href="#__codelineno-143-24"></a><span class="w">                 </span>--cluster-replace<span class="w">             </span><span class="c1">#æ˜¯å¦ç›´æ¥replaceåˆ°ç›®æ ‡èŠ‚ç‚¹</span>
</span><span id="__span-143-25"><a id="__codelineno-143-25" name="__codelineno-143-25" href="#__codelineno-143-25"></a>
</span><span id="__span-143-26"><a id="__codelineno-143-26" name="__codelineno-143-26" href="#__codelineno-143-26"></a><span class="w">  </span>rebalance<span class="w">      </span>host:port<span class="w">                                      </span><span class="c1">#æŒ‡å®šé›†ç¾¤çš„ä»»æ„ä¸€èŠ‚ç‚¹è¿›è¡Œå¹³è¡¡é›†ç¾¤èŠ‚ç‚¹slotæ•°é‡ </span>
</span><span id="__span-143-27"><a id="__codelineno-143-27" name="__codelineno-143-27" href="#__codelineno-143-27"></a><span class="w">                 </span>--cluster-weight<span class="w"> </span>&lt;<span class="nv">node1</span><span class="o">=</span>w1...nodeN<span class="o">=</span>wN&gt;<span class="w">         </span><span class="c1">#æŒ‡å®šé›†ç¾¤èŠ‚ç‚¹çš„æƒé‡</span>
</span><span id="__span-143-28"><a id="__codelineno-143-28" name="__codelineno-143-28" href="#__codelineno-143-28"></a><span class="w">                 </span>--cluster-use-empty-masters<span class="w">                    </span><span class="c1">#è®¾ç½®å¯ä»¥è®©æ²¡æœ‰åˆ†é…slotçš„ä¸»èŠ‚ç‚¹å‚ä¸ï¼Œé»˜è®¤ä¸å…è®¸</span>
</span><span id="__span-143-29"><a id="__codelineno-143-29" name="__codelineno-143-29" href="#__codelineno-143-29"></a><span class="w">                 </span>--cluster-timeout<span class="w"> </span>&lt;arg&gt;<span class="w">                        </span><span class="c1">#è®¾ç½®migrateå‘½ä»¤çš„è¶…æ—¶æ—¶é—´</span>
</span><span id="__span-143-30"><a id="__codelineno-143-30" name="__codelineno-143-30" href="#__codelineno-143-30"></a><span class="w">                 </span>--cluster-simulate<span class="w">                             </span><span class="c1">#æ¨¡æ‹Ÿrebalanceæ“ä½œï¼Œä¸ä¼šçœŸæ­£æ‰§è¡Œè¿ç§»æ“ä½œ</span>
</span><span id="__span-143-31"><a id="__codelineno-143-31" name="__codelineno-143-31" href="#__codelineno-143-31"></a><span class="w">                 </span>--cluster-pipeline<span class="w"> </span>&lt;arg&gt;<span class="w">                       </span><span class="c1">#å®šä¹‰cluster getkeysinslotå‘½ä»¤ä¸€æ¬¡å–å‡ºçš„keyæ•°é‡ï¼Œ </span>
</span><span id="__span-143-32"><a id="__codelineno-143-32" name="__codelineno-143-32" href="#__codelineno-143-32"></a><span class="w">                                                                </span><span class="c1">#é»˜è®¤å€¼ä¸º10</span>
</span><span id="__span-143-33"><a id="__codelineno-143-33" name="__codelineno-143-33" href="#__codelineno-143-33"></a><span class="w">                 </span>--cluster-threshold<span class="w"> </span>&lt;arg&gt;<span class="w">                      </span><span class="c1">#è¿ç§»çš„sloté˜ˆå€¼è¶…è¿‡thresholdï¼Œæ‰§è¡Œrebalanceæ“ä½œ</span>
</span><span id="__span-143-34"><a id="__codelineno-143-34" name="__codelineno-143-34" href="#__codelineno-143-34"></a><span class="w">                 </span>--cluster-replace<span class="w">                              </span><span class="c1">#æ˜¯å¦ç›´æ¥replaceåˆ°ç›®æ ‡èŠ‚ç‚¹</span>
</span><span id="__span-143-35"><a id="__codelineno-143-35" name="__codelineno-143-35" href="#__codelineno-143-35"></a>
</span><span id="__span-143-36"><a id="__codelineno-143-36" name="__codelineno-143-36" href="#__codelineno-143-36"></a><span class="w">  </span>add-node<span class="w">       </span>new_host:new_port<span class="w"> </span>existing_host:existing_port<span class="w">  </span><span class="c1">#æ·»åŠ èŠ‚ç‚¹ï¼ŒæŠŠæ–°èŠ‚ç‚¹åŠ å…¥åˆ°æŒ‡å®šçš„é›†ç¾¤ï¼Œé»˜è®¤æ·»åŠ ä¸»èŠ‚ç‚¹</span>
</span><span id="__span-143-37"><a id="__codelineno-143-37" name="__codelineno-143-37" href="#__codelineno-143-37"></a><span class="w">                 </span>--cluster-slave<span class="w">                                </span><span class="c1">#æ–°èŠ‚ç‚¹ä½œä¸ºä»èŠ‚ç‚¹ï¼Œé»˜è®¤éšæœºä¸€ä¸ªä¸»èŠ‚ç‚¹</span>
</span><span id="__span-143-38"><a id="__codelineno-143-38" name="__codelineno-143-38" href="#__codelineno-143-38"></a><span class="w">                 </span>--cluster-master-id<span class="w"> </span>&lt;arg&gt;<span class="w">                      </span><span class="c1">#ç»™æ–°èŠ‚ç‚¹æŒ‡å®šä¸»èŠ‚ç‚¹</span>
</span><span id="__span-143-39"><a id="__codelineno-143-39" name="__codelineno-143-39" href="#__codelineno-143-39"></a>
</span><span id="__span-143-40"><a id="__codelineno-143-40" name="__codelineno-143-40" href="#__codelineno-143-40"></a><span class="w">  </span>del-node<span class="w">       </span>host:port<span class="w"> </span>node_id<span class="w">                              </span><span class="c1">#åˆ é™¤ç»™å®šçš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæˆåŠŸåå…³é—­è¯¥èŠ‚ç‚¹æœåŠ¡</span>
</span><span id="__span-143-41"><a id="__codelineno-143-41" name="__codelineno-143-41" href="#__codelineno-143-41"></a>
</span><span id="__span-143-42"><a id="__codelineno-143-42" name="__codelineno-143-42" href="#__codelineno-143-42"></a><span class="w">  </span>call<span class="w">           </span>host:port<span class="w"> </span><span class="nb">command</span><span class="w"> </span>arg<span class="w"> </span>arg<span class="w"> </span>..<span class="w"> </span>arg<span class="w">               </span><span class="c1">#åœ¨é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œç›¸å…³å‘½ä»¤</span>
</span><span id="__span-143-43"><a id="__codelineno-143-43" name="__codelineno-143-43" href="#__codelineno-143-43"></a>
</span><span id="__span-143-44"><a id="__codelineno-143-44" name="__codelineno-143-44" href="#__codelineno-143-44"></a><span class="w">  </span>set-timeout<span class="w">    </span>host:port<span class="w"> </span>milliseconds<span class="w">                         </span><span class="c1">#è®¾ç½®cluster-node-timeout</span>
</span><span id="__span-143-45"><a id="__codelineno-143-45" name="__codelineno-143-45" href="#__codelineno-143-45"></a>
</span><span id="__span-143-46"><a id="__codelineno-143-46" name="__codelineno-143-46" href="#__codelineno-143-46"></a><span class="w">  </span>import<span class="w">         </span>host:port<span class="w">                                      </span><span class="c1">#å°†å¤–éƒ¨redisæ•°æ®å¯¼å…¥é›†ç¾¤</span>
</span><span id="__span-143-47"><a id="__codelineno-143-47" name="__codelineno-143-47" href="#__codelineno-143-47"></a><span class="w">                 </span>--cluster-from<span class="w"> </span>&lt;arg&gt;<span class="w">                           </span><span class="c1">#å°†æŒ‡å®šå®ä¾‹çš„æ•°æ®å¯¼å…¥åˆ°é›†ç¾¤</span>
</span><span id="__span-143-48"><a id="__codelineno-143-48" name="__codelineno-143-48" href="#__codelineno-143-48"></a><span class="w">                 </span>--cluster-copy<span class="w">                                 </span><span class="c1">#migrateæ—¶æŒ‡å®šcopy</span>
</span><span id="__span-143-49"><a id="__codelineno-143-49" name="__codelineno-143-49" href="#__codelineno-143-49"></a><span class="w">                 </span>--cluster-replace<span class="w">                              </span><span class="c1">#migrateæ—¶æŒ‡å®šreplace</span>
</span></code></pre></div> <p><strong>å¢åŠ èŠ‚ç‚¹</strong></p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="c1">## å¢åŠ ä¸¤ä¸ªèŠ‚ç‚¹é…ç½®</span>
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a>sed<span class="w"> </span><span class="s1">'s/6379/6385/g'</span><span class="w"> </span>redis_6379.conf<span class="w"> </span>&gt;<span class="w"> </span>redis_6385.conf
</span><span id="__span-144-3"><a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a>sed<span class="w"> </span><span class="s1">'s/6379/6386/g'</span><span class="w"> </span>redis_6379.conf<span class="w"> </span>&gt;<span class="w"> </span>redis_6386.conf
</span><span id="__span-144-4"><a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a>
</span><span id="__span-144-5"><a id="__codelineno-144-5" name="__codelineno-144-5" href="#__codelineno-144-5"></a><span class="c1">## å¯åŠ¨</span>
</span><span id="__span-144-6"><a id="__codelineno-144-6" name="__codelineno-144-6" href="#__codelineno-144-6"></a>redis-server<span class="w"> </span>redis_6385.conf
</span><span id="__span-144-7"><a id="__codelineno-144-7" name="__codelineno-144-7" href="#__codelineno-144-7"></a>redis-server<span class="w"> </span>redis_6386.conf
</span><span id="__span-144-8"><a id="__codelineno-144-8" name="__codelineno-144-8" href="#__codelineno-144-8"></a>
</span><span id="__span-144-9"><a id="__codelineno-144-9" name="__codelineno-144-9" href="#__codelineno-144-9"></a><span class="c1">## é›†ç¾¤ä¸­å¢åŠ èŠ‚ç‚¹</span>
</span><span id="__span-144-10"><a id="__codelineno-144-10" name="__codelineno-144-10" href="#__codelineno-144-10"></a>redis-cli<span class="w"> </span>-p<span class="w"> </span><span class="m">6379</span><span class="w"> </span>--cluster<span class="w"> </span>add-node<span class="w"> </span><span class="m">127</span>.0.0.1:6385<span class="w"> </span><span class="m">127</span>.0.0.1:6379
</span><span id="__span-144-11"><a id="__codelineno-144-11" name="__codelineno-144-11" href="#__codelineno-144-11"></a>
</span><span id="__span-144-12"><a id="__codelineno-144-12" name="__codelineno-144-12" href="#__codelineno-144-12"></a><span class="c1">## æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯</span>
</span><span id="__span-144-13"><a id="__codelineno-144-13" name="__codelineno-144-13" href="#__codelineno-144-13"></a>redis-cli<span class="w"> </span>cluster<span class="w"> </span>nodes
</span></code></pre></div> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210607170233889.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210607170233889.png" alt="image-20210607170233889" style></a></p> <p>å°† 6386 æ·»åŠ ä¸º 6385 çš„ä»èŠ‚ç‚¹</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a>redis-cli<span class="w"> </span>--cluster<span class="w"> </span>add-node<span class="w"> </span><span class="m">127</span>.0.0.1:6386<span class="w"> </span><span class="m">127</span>.0.0.1:6379<span class="w"> </span>--cluster-slave<span class="w"> </span>--cluster-master-id<span class="w"> </span>57547cced0901aec48897bd97c9a6e9a40c8fbec
</span></code></pre></div> <p>è¿™ä¸ªæ—¶å€™æ˜¯æ²¡æœ‰è™½ç„¶æ–°èŠ‚ç‚¹åŠ å…¥äº†è¿›æ¥ï¼Œä½†æ˜¯æ²¡æœ‰åˆ†é…æ§½ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210607172522783.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210607172522783.png" alt="image-20210607172522783" style></a></p> <p>æ‰€ä»¥æ‰§è¡Œ <code>redis-cli --cluster reshard 127.0.0.1:6385</code>åˆ†é…æ§½ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210607174634002.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210607174634002.png" alt="image-20210607174634002" style></a></p> <p>ä¸­é—´è¾“å…¥ <code>yes</code> ç»§ç»­ï¼Œè¿™æ ·å°±åˆ†é…å®Œæ¯•ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210607173729567.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210607173729567.png" alt="image-20210607173729567" style></a></p> <p><strong>åˆ é™¤èŠ‚ç‚¹</strong></p> <p>slave ç›´æ¥åˆ é™¤å³å¯ï¼Œåˆ é™¤ master éœ€è¦å…ˆå°†æ§½ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ä¸­å»ï¼</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a>redis-cli<span class="w"> </span>--cluster<span class="w"> </span>del-node<span class="w"> </span><span class="m">127</span>.0.0.1:6386<span class="w"> </span>8b5494c818bd21c2eae793451c05ebe1eb62e2a5
</span></code></pre></div> <p>å…ˆè½¬ç§»æ§½ï¼Œä¸­é—´è¾“å…¥ <code>yes</code> ç»§ç»­ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210607175118825.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210607175118825.png" alt="image-20210607175118825" style></a></p> <p>åˆ é™¤èŠ‚ç‚¹</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a>redis-cli<span class="w"> </span>--cluster<span class="w"> </span>del-node<span class="w"> </span><span class="m">127</span>.0.0.1:6385<span class="w"> </span>57547cced0901aec48897bd97c9a6e9a40c8fbec
</span></code></pre></div> <h2 id="12ç¼“å­˜é›ªå´©å‡»ç©¿ç©¿é€">12ã€ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€<a class="headerlink" href="#12ç¼“å­˜é›ªå´©å‡»ç©¿ç©¿é€" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <h3 id="121ç¼“å­˜é›ªå´©">12.1ã€ç¼“å­˜é›ªå´©<a class="headerlink" href="#121ç¼“å­˜é›ªå´©" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©</strong></p> <p>å¦‚æœç¼“åœ¨æŸä¸€ä¸ªæ—¶åˆ»å‡ºç°å¤§è§„æ¨¡çš„ key å¤±æ•ˆï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´å¤§é‡çš„è¯·æ±‚æ‰“åœ¨äº†æ•°æ®åº“ä¸Šé¢ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›å·¨å¤§ï¼Œå¦‚æœåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ç¬é—´å°±ä¼šå¯¼è‡´æ•°æ®åº“å®•æœºã€‚è¿™æ—¶å€™å¦‚æœè¿ç»´é©¬ä¸Šåˆé‡å¯æ•°æ®åº“ï¼Œé©¬ä¸Šåˆä¼šæœ‰æ–°çš„æµé‡æŠŠæ•°æ®åº“æ‰“æ­»ã€‚è¿™å°±æ˜¯ç¼“å­˜é›ªå´©ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/16e30d2c5e17899c.png" data-desc-position="bottom"><img src="!assets/Redis/16e30d2c5e17899c.png" alt="img" style="zoom:80%;"></a></p> <p><strong>è§£å†³æ–¹æ¡ˆ</strong></p> <ol> <li> <p>äº‹å‰</p> <ul> <li> <p>å‡åŒ€è¿‡æœŸï¼š</p> <p>è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œè®©ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´å°½é‡å‡åŒ€ï¼Œé¿å…ç›¸åŒçš„è¿‡æœŸæ—¶é—´å¯¼è‡´ç¼“å­˜é›ªå´©ï¼Œé€ æˆå¤§é‡æ•°æ®åº“çš„è®¿é—®</p> </li> <li> <p>åˆ†çº§ç¼“å­˜ï¼š</p> <p>ç¬¬ä¸€ç¼“å­˜å¤±æ•ˆçš„åŸºç¡€ä¸Šï¼Œè®¿é—®äºŒçº§ç¼“å­˜ï¼Œæ¯ä¸€çº§ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´éƒ½ä¸åŒ</p> </li> <li> <p>çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ</p> <blockquote> <p>æ°¸ä¸è¿‡æœŸå®é™…åŒ…å«ä¸¤å±‚æ„æ€ï¼š</p> <ul> <li>ç‰©ç†æ°¸ä¸è¿‡æœŸï¼šé’ˆå¯¹çƒ­ç‚¹ key ä¸è®¾ç½®è¿‡æœŸæ—¶é—´</li> <li>é€»è¾‘è¿‡æœŸï¼šæŠŠè¿‡æœŸæ—¶é—´å­˜åœ¨ key å¯¹åº”çš„ value é‡Œï¼Œå¦‚æœå‘ç°è¦è¿‡æœŸäº†ï¼Œé€šè¿‡ä¸€ä¸ªåå°çš„å¼‚æ­¥çº¿ç¨‹è¿›è¡Œç¼“å­˜çš„æ„å»º</li> </ul> </blockquote> </li> <li> <p>ä¿è¯ Redis ç¼“å­˜çš„é«˜å¯ç”¨ï¼Œé˜²æ­¢ Redis å®•æœºå¯¼è‡´ç¼“å­˜é›ªå´©çš„é—®é¢˜ã€‚å¯ä»¥ä½¿ç”¨ä¸»ä»+å“¨å…µã€Reids é›†ç¾¤æ¥é¿å… Redis å…¨ç›˜å´©æºƒçš„æƒ…å†µ</p> </li> </ul> </li> <li> <p>äº‹ä¸­</p> <ul> <li> <p>äº’æ–¥é”ï¼š</p> <p>åœ¨ç¼“å­˜å¤±æ•ˆåï¼Œé€šè¿‡äº’æ–¥é”æˆ–è€…é˜Ÿåˆ—æ¥æ§åˆ¶è¯»æ•°æ®å†™ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ï¼Œæ¯”å¦‚æŸä¸ª key åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®å’Œå†™ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚è¿™ç§æ–¹å¼ä¼šé˜»å¡å…¶ä»–çº¿ç¨‹ï¼Œæ­¤æ—¶ç³»ç»Ÿçš„ååé‡ä¸‹é™</p> </li> <li> <p>ä½¿ç”¨ç†”æ–­æœºåˆ¶ï¼Œé™æµé™çº§ï¼š</p> <p>å½“æµé‡è¾¾åˆ°ä¸€å®šçš„é˜ˆå€¼ï¼Œç›´æ¥è¿”å› â€ç³»ç»Ÿæ‹¥æŒ¤â€œ ä¹‹ç±»çš„æç¤ºï¼Œé˜²æ­¢è¿‡å¤šçš„è¯·æ±‚æ‰“åœ¨æ•°æ®åº“ä¸Šå°†æ•°æ®åº“å‡»å®ï¼Œè‡³å°‘èƒ½ä¿è¯ä¸€éƒ¨åˆ†ç”¨æˆ·æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®çš„ï¼Œå…¶ä»–ç”¨æˆ·å¤šåˆ·æ–°å‡ æ¬¡ä¹Ÿèƒ½å¾—åˆ°ç»“æœ</p> </li> </ul> </li> <li> <p>äº‹å</p> <ul> <li>å¼€å§‹ Redis æŒä¹…åŒ–æœºåˆ¶ï¼Œå°½å¿«æ¢å¤ç¼“å­˜æ•°æ®ï¼Œä¸€æ—¦é‡å¯ï¼Œå°±èƒ½ä»ç£ç›˜ä¸Šè‡ªåŠ¨åŠ è½½æ•°æ®æ¢å¤å†…å­˜ä¸­çš„æ•°æ®</li> </ul> </li> </ol> <h3 id="122ç¼“å­˜å‡»ç©¿">12.2ã€ç¼“å­˜å‡»ç©¿<a class="headerlink" href="#122ç¼“å­˜å‡»ç©¿" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿</strong></p> <p>ç¼“å­˜å‡»ç©¿è·Ÿç¼“å­˜é›ªå´©æœ‰ç‚¹ç±»ä¼¼ï¼Œç¼“å­˜é›ªå´©æ˜¯å¤§è§„æ¨¡çš„ key å¤±æ•ˆï¼Œè€Œç¼“å­˜å‡»ç©¿æ˜¯æŸä¸ªçƒ­ç‚¹çš„ key å¤±æ•ˆï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹å…¶è¿›è¡Œè¯·æ±‚ï¼Œå°±ä¼šé€ æˆå¤§é‡è¯·æ±‚è¯»ç¼“å­˜æ²¡è¯»åˆ°æ•°æ®ï¼Œä»è€Œå¯¼è‡´é«˜å¹¶å‘è®¿é—®æ•°æ®åº“ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›å‰§å¢ã€‚è¿™ç§ç°è±¡å°±å«åšç¼“å­˜å‡»ç©¿ã€‚</p> <p><strong>è§£å†³æ–¹æ¡ˆ</strong></p> <ol> <li>åœ¨ç¼“å­˜å¤±æ•ˆåï¼Œé€šè¿‡äº’æ–¥é”æˆ–è€…é˜Ÿåˆ—æ¥æ§åˆ¶è¯»æ•°æ®å†™ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ï¼Œæ¯”å¦‚æŸä¸ª key åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®å’Œå†™ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚è¿™ç§æ–¹å¼ä¼šé˜»å¡å…¶ä»–çš„çº¿ç¨‹ï¼Œæ­¤æ—¶ç³»ç»Ÿçš„ååé‡ä¼šä¸‹é™</li> <li>çƒ­ç‚¹æ•°æ®ç¼“å­˜æ°¸è¿œä¸è¿‡æœŸ</li> </ol> <h3 id="123ç¼“å­˜ç©¿é€">12.3ã€ç¼“å­˜ç©¿é€<a class="headerlink" href="#123ç¼“å­˜ç©¿é€" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€</strong></p> <p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡ç”¨æˆ·è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œå³æ²¡æœ‰å‘½ä¸­ï¼ŒåŒæ—¶åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œå¯¼è‡´ç”¨æˆ·æ¯æ¬¡è¯·æ±‚è¯¥æ•°æ®éƒ½è¦å»æ•°æ®åº“ä¸­æŸ¥è¯¢ä¸€éã€‚å¦‚æœæœ‰æ¶æ„æ”»å‡»è€…ä¸æ–­è¯·æ±‚ç³»ç»Ÿä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼Œä¼šå¯¼è‡´çŸ­æ—¶é—´å¤§é‡è¯·æ±‚è½åœ¨æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³å¯¼è‡´æ•°æ®åº“æ‰¿å—ä¸ä½è€Œå®•æœºå´©æºƒã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/16e30d1847df0faf.png" data-desc-position="bottom"><img src="!assets/Redis/16e30d1847df0faf.png" alt="img" style></a></p> <p>ç¼“å­˜ç©¿é€çš„å…³é”®åœ¨äº åœ¨Redis ä¸­æŸ¥ä¸åˆ°keyå€¼ï¼Œå®ƒå’Œç¼“å­˜å‡»ç©¿çš„æ ¹æœ¬åŒºåˆ«åœ¨äºä¼ è¿›æ¥çš„ key åœ¨ Redis ä¸­æ˜¯ä¸å­˜åœ¨çš„ã€‚å‡å¦‚æœ‰é»‘å®¢ä¼ è¿›å¤§é‡çš„ä¸å­˜åœ¨çš„keyï¼Œé‚£ä¹ˆå¤§é‡çš„è¯·æ±‚æ‰“åœ¨æ•°æ®åº“ä¸Šæ˜¯å¾ˆè‡´å‘½çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨æ—¥å¸¸å¼€å‘ä¸­è¦å¯¹å‚æ•°åšå¥½æ ¡éªŒï¼Œä¸€äº›éæ³•çš„å‚æ•°ï¼Œä¸å¯èƒ½å­˜åœ¨çš„ key å°±ç›´æ¥è¿”å›é”™è¯¯æç¤ºã€‚</p> <p><strong>è§£å†³æ–¹æ¡ˆ</strong></p> <ol> <li> <p>å°†æ— æ•ˆçš„keyå­˜æ”¾è¿›Redisä¸­ï¼š</p> <p>å½“å‡ºç°RedisæŸ¥ä¸åˆ°æ•°æ®ï¼Œæ•°æ®åº“ä¹ŸæŸ¥ä¸åˆ°æ•°æ®çš„æƒ…å†µï¼Œå°±æŠŠè¿™ä¸ª key ä¿å­˜åˆ° Redis ä¸­ï¼Œè®¾ç½® <code>value="null"</code>ï¼Œå¹¶è®¾ç½®å…¶è¿‡æœŸæ—¶é—´æçŸ­ï¼Œåé¢å†å‡ºç°æŸ¥è¯¢è¿™ä¸ª key çš„è¯·æ±‚çš„æ—¶å€™ï¼Œç›´æ¥è¿”å› nullï¼Œå°±ä¸éœ€è¦å†æŸ¥è¯¢æ•°æ®åº“äº†ã€‚ä½†è¿™ç§å¤„ç†æ–¹å¼æ˜¯æœ‰é—®é¢˜çš„ï¼Œå‡å¦‚ä¼ è¿›æ¥çš„è¿™ä¸ªä¸å­˜åœ¨çš„ Key å€¼æ¯æ¬¡éƒ½æ˜¯éšæœºçš„ï¼Œé‚£å­˜è¿› Redis ä¹Ÿæ²¡æœ‰æ„ä¹‰ï¼Œç½‘å…³å±‚ <strong>Nginx</strong> æœ‰é…ç½®é¡¹ï¼Œå¯ä»¥è®©è¿ç»´å¤§å¤§å¯¹å•ä¸ª IP æ¯ç§’è®¿é—®æ¬¡æ•°è¶…å‡ºé˜ˆå€¼çš„ IP éƒ½æ‹‰é»‘ï¼Œå› ä¸ºæ­£å¸¸ç”¨æˆ·æ˜¯ä¸ä¼šåœ¨å•ç§’å†…å‘èµ·è¿™ä¹ˆå¤šæ¬¡è¯·æ±‚çš„</p> </li> <li> <p>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼š</p> <p>å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨åˆ¤å®šæŸä¸ª key ä¸å­˜åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¸å­˜åœ¨ï¼Œå¦‚æœåˆ¤å®šæŸä¸ª key å­˜åœ¨ï¼Œé‚£ä¹ˆå¾ˆå¤§å¯èƒ½æ˜¯å­˜åœ¨ï¼ˆå­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡ï¼‰ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ç¼“å­˜ä¹‹å‰å†åŠ ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†æ•°æ®åº“ä¸­çš„æ‰€æœ‰ key éƒ½å­˜å‚¨åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œåœ¨æŸ¥è¯¢ Redis å‰å…ˆå»å¸ƒéš†è¿‡æ»¤å™¨æŸ¥è¯¢ key æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±ç›´æ¥è¿”å›ï¼Œä¸è®©å…¶è®¿é—®æ•°æ®åº“ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚</p> </li> </ol> <blockquote> <p>PSï¼šåœ¨å¼€å‘ç¨‹åºçš„æ—¶å€™éƒ½è¦æœ‰ä¸€é¢— â€œä¸ä¿¡ä»»â€ çš„å¿ƒï¼Œå°±æ˜¯ä¸è¦ç›¸ä¿¡ä»»ä½•è°ƒç”¨æ–¹ï¼Œæ¯”å¦‚ä½ æä¾›äº† API æ¥å£å‡ºå»ï¼Œä½ æœ‰è¿™å‡ ä¸ªå‚æ•°ï¼Œé‚£æˆ‘è§‰å¾—ä½œä¸ºè¢«è°ƒç”¨æ–¹ï¼Œä»»ä½•å¯èƒ½çš„å‚æ•°æƒ…å†µéƒ½åº”è¯¥è¢«è€ƒè™‘åˆ°ï¼Œåšæ ¡éªŒï¼Œå› ä¸ºä½ ä¸ç›¸ä¿¡è°ƒç”¨ä½ çš„äººï¼Œä½ ä¸çŸ¥é“ä»–ä¼šä¼ ä»€ä¹ˆå‚æ•°ç»™ä½ ã€‚</p> <p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½ è¿™ä¸ªæ¥å£æ˜¯åˆ†é¡µæŸ¥è¯¢çš„ï¼Œä½†æ˜¯ä½ æ²¡å¯¹åˆ†é¡µå‚æ•°çš„å¤§å°åšé™åˆ¶ï¼Œè°ƒç”¨çš„äººä¸‡ä¸€ ä¸€å£æ°”æŸ¥ Integer.MAX_VALUE ä¸€æ¬¡è¯·æ±‚å°±è¦ä½ å‡ ç§’ï¼Œå¤šå‡ ä¸ªå¹¶å‘ä½ ä¸å°±æŒ‚äº†ä¹ˆï¼Ÿæ˜¯å…¬å¸åŒäº‹è°ƒç”¨è¿˜å¥½å¤§ä¸äº†å‘ç°äº†æ”¹æ‰ï¼Œä½†æ˜¯å¦‚æœæ˜¯é»‘å®¢æˆ–è€…ç«äº‰å¯¹æ‰‹å‘¢ï¼Ÿåœ¨ä½ åŒåä¸€å½“å¤©å°±è°ƒä½ è¿™ä¸ªæ¥å£ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œå°±ä¸ç”¨æˆ‘è¯´äº†å§ã€‚</p> </blockquote> <h3 id="124ç¼“å­˜é¢„çƒ­">12.4ã€ç¼“å­˜é¢„çƒ­<a class="headerlink" href="#124ç¼“å­˜é¢„çƒ­" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>ä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­</strong></p> <p>ç¼“å­˜é¢„çƒ­æ˜¯æŒ‡ç³»ç»Ÿä¸Šçº¿åï¼Œæå‰å°†ç›¸å…³çš„ç¼“å­˜æ•°æ®åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ï¼Œç”¨æˆ·ç›´æ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ã€‚</p> <p>å¦‚æœä¸è¿›è¡Œé¢„çƒ­ï¼Œé‚£ä¹ˆ Redis åˆå§‹çŠ¶æ€æ•°æ®ä¸ºç©ºï¼Œç³»ç»Ÿä¸Šçº¿åˆæœŸï¼Œå¯¹äºé«˜å¹¶å‘çš„æµé‡ï¼Œéƒ½ä¼šè®¿é—®åˆ°æ•°æ®åº“ä¸­ï¼Œ å¯¹æ•°æ®åº“é€ æˆæµé‡çš„å‹åŠ›ã€‚</p> <p><strong>è§£å†³æ–¹æ¡ˆ</strong></p> <ol> <li>æ•°æ®é‡ä¸å¤§çš„æ—¶å€™ï¼Œå·¥ç¨‹å¯åŠ¨çš„æ—¶å€™è¿›è¡ŒåŠ è½½ç¼“å­˜åŠ¨ä½œ</li> <li>æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡è„šæœ¬ï¼Œè¿›è¡Œç¼“å­˜çš„åˆ·æ–°</li> <li>æ•°æ®é‡å¤ªå¤§çš„æ—¶å€™ï¼Œä¼˜å…ˆä¿è¯çƒ­ç‚¹æ•°æ®è¿›è¡Œæå‰åŠ è½½åˆ°ç¼“å­˜</li> </ol> <h3 id="125ç¼“å­˜é™çº§">12.5ã€ç¼“å­˜é™çº§<a class="headerlink" href="#125ç¼“å­˜é™çº§" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ç¼“å­˜é™çº§æ˜¯æŒ‡ç¼“å­˜å¤±æ•ˆæˆ–ç¼“å­˜æœåŠ¡å™¨æŒ‚æ‰çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†å…¶ä»–æ¬¡è¦æœåŠ¡çš„æ•°æ®è¿›è¡Œç¼“å­˜é™çº§ï¼Œä»è€Œæå‡ä¸»æœåŠ¡çš„ç¨³å®šæ€§ã€‚ä¸å»è®¿é—®æ•°æ®åº“ï¼Œç›´æ¥è¿”å›é»˜è®¤æ•°æ®æˆ–è®¿é—®æœåŠ¡çš„å†…å­˜æ•°æ®ã€‚é™çº§ä¸€èˆ¬æ˜¯æœ‰æŸçš„æ“ä½œï¼Œæ‰€ä»¥å°½é‡å‡å°‘é™çº§å¯¹äºä¸šåŠ¡çš„å½±å“ç¨‹åº¦ã€‚</p> <p>é™çº§çš„ç›®çš„æ˜¯ä¿è¯æ ¸å¿ƒæœåŠ¡å¯ç”¨ï¼Œå³ä½¿æ˜¯æœ‰æŸçš„ã€‚å¦‚å»å¹´åŒåä¸€çš„æ—¶å€™æ·˜å®è´­ç‰©è½¦æ— æ³•ä¿®æ”¹åœ°å€åªèƒ½ä½¿ç”¨é»˜è®¤åœ°å€ï¼Œè¿™ä¸ªæœåŠ¡å°±æ˜¯è¢«é™çº§äº†ï¼Œè¿™é‡Œé˜¿é‡Œä¿è¯äº†è®¢å•å¯ä»¥æ­£å¸¸æäº¤å’Œä»˜æ¬¾ï¼Œä½†ä¿®æ”¹åœ°å€çš„æœåŠ¡å¯ä»¥åœ¨æœåŠ¡å™¨å‹åŠ›é™ä½ï¼Œå¹¶å‘é‡ç›¸å¯¹å‡å°‘çš„æ—¶å€™å†æ¢å¤ã€‚</p> <p>åœ¨é¡¹ç›®å®æˆ˜ä¸­é€šå¸¸ä¼šå°†éƒ¨åˆ†çƒ­ç‚¹æ•°æ®ç¼“å­˜åˆ°æœåŠ¡çš„å†…å­˜ä¸­ï¼Œè¿™æ ·ä¸€æ—¦ç¼“å­˜å‡ºç°å¼‚å¸¸ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æœåŠ¡çš„å†…å­˜æ•°æ®ï¼Œä»è€Œé¿å…æ•°æ®åº“é­å—å·¨å¤§å‹åŠ›ã€‚</p> <h2 id="13redis-å®ç°åˆ†å¸ƒå¼é”">13ã€Redis å®ç°åˆ†å¸ƒå¼é”<a class="headerlink" href="#13redis-å®ç°åˆ†å¸ƒå¼é”" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p><code>set</code> è¿˜å¯ä»¥æ·»åŠ ä¸€äº›å…¶ä»–çš„å‚æ•°ï¼š</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a>SET<span class="w"> </span>key<span class="w"> </span>value<span class="w"> </span><span class="o">[</span>EX<span class="w"> </span>seconds<span class="p">|</span>PX<span class="w"> </span>milliseconds<span class="o">]</span><span class="w"> </span><span class="o">[</span>NX<span class="p">|</span>XX<span class="o">]</span><span class="w"> </span><span class="o">[</span>KEEPTTL<span class="o">]</span>
</span></code></pre></div> <ul> <li>EX secondsï¼šä»¥ç§’ä¸ºå•ä½è®¾ç½®è¿‡æœŸæ—¶é—´</li> <li>PX millisecondsï¼šä»¥æ¯«ç§’ä¸ºå•ä½è®¾ç½®è¿‡æœŸæ—¶é—´</li> <li>NXï¼šé”®ä¸å­˜åœ¨çš„æ—¶å€™è®¾ç½®é”®å€¼</li> <li>XXï¼šé”®å­˜åœ¨çš„æ—¶å€™è®¾ç½®é”®å€¼</li> <li>KEEPTTLï¼šä¿ç•™è®¾ç½®å‰æŒ‡å®šé”®çš„ç”Ÿå­˜æ—¶é—´</li> </ul> <p><code>setnx</code> æ˜¯ SET if Not eXistsï¼ˆå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ SETï¼‰çš„ç®€å†™ã€‚</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a>setnx<span class="w"> </span>key<span class="w"> </span>value
</span></code></pre></div> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/00831rSTly1gdmpj4rnixj307802w0ss.jpg" data-desc-position="bottom"><img src="!assets/Redis/00831rSTly1gdmpj4rnixj307802w0ss.jpg" alt="img" style></a></p> <p>ç”¨æ³•å¦‚å›¾ï¼Œå¦‚æœä¸å­˜åœ¨ set æˆåŠŸè¿”å› int çš„ 1ï¼Œè¿™ä¸ª key å­˜åœ¨äº†è¿”å›0ã€‚</p> <p><code>setex</code> å°†å€¼ value å…³è”åˆ° key ï¼Œå¹¶å°† key çš„ç”Ÿå­˜æ—¶é—´è®¾ä¸º seconds (ä»¥ç§’ä¸ºå•ä½)ï¼›å¦‚æœ key å·²ç»å­˜åœ¨ï¼Œsetex å‘½ä»¤å°†è¦†å†™æ—§å€¼ã€‚</p> <div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a>setex<span class="w"> </span>key<span class="w"> </span>seconds<span class="w"> </span>value
</span></code></pre></div> <p>è€Œä¸”<code>setex</code> æ˜¯ä¸€ä¸ªåŸå­æ€§ï¼ˆatomicï¼‰æ“ä½œï¼Œå…³è”å€¼å’Œè®¾ç½®ç”Ÿå­˜æ—¶é—´ä¸¤ä¸ªåŠ¨ä½œä¼šåœ¨åŒä¸€æ—¶é—´å†…å®Œæˆã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/00831rSTly1gdmpohppykj308703w3yn.jpg" data-desc-position="bottom"><img src="!assets/Redis/00831rSTly1gdmpohppykj308703w3yn.jpg" alt="img" style></a></p> <p>æˆ‘è®¾ç½®äº† 10 ç§’çš„å¤±æ•ˆæ—¶é—´ï¼Œ<code>ttl</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹å€’è®¡æ—¶ï¼Œè´Ÿçš„è¯´æ˜å·²ç»åˆ°æœŸäº†ã€‚</p> <p><strong>è·å–é”</strong></p> <p>è·å–é”æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ <code>set</code> å‘½ä»¤ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨ <code>setnx</code> å‘½ä»¤</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="cm">/**</span>
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a><span class="cm"> * ä½¿ç”¨redisçš„setå‘½ä»¤å®ç°è·å–åˆ†å¸ƒå¼é”</span>
</span><span id="__span-151-3"><a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a><span class="cm"> *</span>
</span><span id="__span-151-4"><a id="__codelineno-151-4" name="__codelineno-151-4" href="#__codelineno-151-4"></a><span class="cm"> * @param lockKey   é”</span>
</span><span id="__span-151-5"><a id="__codelineno-151-5" name="__codelineno-151-5" href="#__codelineno-151-5"></a><span class="cm"> * @param requestId è¯·æ±‚IDï¼Œä¿è¯åŒä¸€æ€§</span>
</span><span id="__span-151-6"><a id="__codelineno-151-6" name="__codelineno-151-6" href="#__codelineno-151-6"></a><span class="cm"> * @param timeout   è¿‡æœŸæ—¶é—´ï¼Œé¿å…æ­»é”</span>
</span><span id="__span-151-7"><a id="__codelineno-151-7" name="__codelineno-151-7" href="#__codelineno-151-7"></a><span class="cm"> * @return</span>
</span><span id="__span-151-8"><a id="__codelineno-151-8" name="__codelineno-151-8" href="#__codelineno-151-8"></a><span class="cm"> */</span>
</span><span id="__span-151-9"><a id="__codelineno-151-9" name="__codelineno-151-9" href="#__codelineno-151-9"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">getLockBySet</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lockKey</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">requestId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">timeout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-151-10"><a id="__codelineno-151-10" name="__codelineno-151-10" href="#__codelineno-151-10"></a><span class="w">    </span><span class="c1">// è·å–jediså¯¹è±¡ï¼Œè´Ÿè´£ä¸è¿œç¨‹redisæœåŠ¡å™¨è¿›è¡Œé“¾æ¥</span>
</span><span id="__span-151-11"><a id="__codelineno-151-11" name="__codelineno-151-11" href="#__codelineno-151-11"></a><span class="w">    </span><span class="n">Jedis</span><span class="w"> </span><span class="n">jedis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getJedis</span><span class="p">();</span>
</span><span id="__span-151-12"><a id="__codelineno-151-12" name="__codelineno-151-12" href="#__codelineno-151-12"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jedis</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">lockKey</span><span class="p">,</span><span class="w"> </span><span class="n">requestId</span><span class="p">,</span><span class="w"> </span><span class="s">"NX"</span><span class="p">,</span><span class="w"> </span><span class="s">"EX"</span><span class="p">,</span><span class="w"> </span><span class="n">timeout</span><span class="p">);</span>
</span><span id="__span-151-13"><a id="__codelineno-151-13" name="__codelineno-151-13" href="#__codelineno-151-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"OK"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-151-14"><a id="__codelineno-151-14" name="__codelineno-151-14" href="#__codelineno-151-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-151-15"><a id="__codelineno-151-15" name="__codelineno-151-15" href="#__codelineno-151-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-151-16"><a id="__codelineno-151-16" name="__codelineno-151-16" href="#__codelineno-151-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-151-17"><a id="__codelineno-151-17" name="__codelineno-151-17" href="#__codelineno-151-17"></a><span class="p">}</span>
</span></code></pre></div> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="cm">/**</span>
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a><span class="cm"> * ä½¿ç”¨redisçš„setnxå‘½ä»¤å®ç°è·å–åˆ†å¸ƒå¼é”</span>
</span><span id="__span-152-3"><a id="__codelineno-152-3" name="__codelineno-152-3" href="#__codelineno-152-3"></a><span class="cm"> *</span>
</span><span id="__span-152-4"><a id="__codelineno-152-4" name="__codelineno-152-4" href="#__codelineno-152-4"></a><span class="cm"> * @param lockKey   é”</span>
</span><span id="__span-152-5"><a id="__codelineno-152-5" name="__codelineno-152-5" href="#__codelineno-152-5"></a><span class="cm"> * @param requestId è¯·æ±‚IDï¼Œä¿è¯åŒä¸€æ€§</span>
</span><span id="__span-152-6"><a id="__codelineno-152-6" name="__codelineno-152-6" href="#__codelineno-152-6"></a><span class="cm"> * @param timeout   è¿‡æœŸæ—¶é—´ï¼Œé¿å…æ­»é”</span>
</span><span id="__span-152-7"><a id="__codelineno-152-7" name="__codelineno-152-7" href="#__codelineno-152-7"></a><span class="cm"> * @return</span>
</span><span id="__span-152-8"><a id="__codelineno-152-8" name="__codelineno-152-8" href="#__codelineno-152-8"></a><span class="cm"> */</span>
</span><span id="__span-152-9"><a id="__codelineno-152-9" name="__codelineno-152-9" href="#__codelineno-152-9"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">getLockBySetnx</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lockKey</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">requestId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">timeout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-10"><a id="__codelineno-152-10" name="__codelineno-152-10" href="#__codelineno-152-10"></a><span class="w">    </span><span class="c1">// è·å–jediså¯¹è±¡ï¼Œè´Ÿè´£ä¸è¿œç¨‹redisæœåŠ¡å™¨è¿›è¡Œé“¾æ¥</span>
</span><span id="__span-152-11"><a id="__codelineno-152-11" name="__codelineno-152-11" href="#__codelineno-152-11"></a><span class="w">    </span><span class="n">Jedis</span><span class="w"> </span><span class="n">jedis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getJedis</span><span class="p">();</span>
</span><span id="__span-152-12"><a id="__codelineno-152-12" name="__codelineno-152-12" href="#__codelineno-152-12"></a><span class="w">    </span><span class="n">Long</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jedis</span><span class="p">.</span><span class="na">setnx</span><span class="p">(</span><span class="n">lockKey</span><span class="p">,</span><span class="w"> </span><span class="n">requestId</span><span class="p">);</span>
</span><span id="__span-152-13"><a id="__codelineno-152-13" name="__codelineno-152-13" href="#__codelineno-152-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-14"><a id="__codelineno-152-14" name="__codelineno-152-14" href="#__codelineno-152-14"></a><span class="w">        </span><span class="c1">// è®¾ç½®æœ‰æ•ˆæœŸï¼Œé˜²æ­¢æ­»é”</span>
</span><span id="__span-152-15"><a id="__codelineno-152-15" name="__codelineno-152-15" href="#__codelineno-152-15"></a><span class="w">        </span><span class="n">jedis</span><span class="p">.</span><span class="na">expire</span><span class="p">(</span><span class="n">lockKey</span><span class="p">,</span><span class="w"> </span><span class="n">timeout</span><span class="p">);</span>
</span><span id="__span-152-16"><a id="__codelineno-152-16" name="__codelineno-152-16" href="#__codelineno-152-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-152-17"><a id="__codelineno-152-17" name="__codelineno-152-17" href="#__codelineno-152-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-152-18"><a id="__codelineno-152-18" name="__codelineno-152-18" href="#__codelineno-152-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-152-19"><a id="__codelineno-152-19" name="__codelineno-152-19" href="#__codelineno-152-19"></a><span class="p">}</span>
</span></code></pre></div> <blockquote> <p>å¯ä»¥è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè·å–é”çš„æ—¶å€™å¦‚æœæœªè·å–åˆ°å¯ä»¥è®©çº¿ç¨‹ <code>sleep</code> ä¸€ä¼šå„¿ï¼Œç„¶åç»§ç»­è·å–ï¼Œç­‰åˆ°è¶…è¿‡äº†è¶…æ—¶æ—¶é—´å† â€œè·å–å¤±è´¥â€ã€‚</p> </blockquote> <p><strong>é‡Šæ”¾é”</strong></p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="cm">/**</span>
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="cm"> * ä½¿ç”¨delå‘½ä»¤é‡Šæ”¾é”</span>
</span><span id="__span-153-3"><a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a><span class="cm"> *</span>
</span><span id="__span-153-4"><a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a><span class="cm"> * @param lockKey   é”</span>
</span><span id="__span-153-5"><a id="__codelineno-153-5" name="__codelineno-153-5" href="#__codelineno-153-5"></a><span class="cm"> * @param requestId è¯·æ±‚IDï¼Œä¿è¯åŒä¸€æ€§</span>
</span><span id="__span-153-6"><a id="__codelineno-153-6" name="__codelineno-153-6" href="#__codelineno-153-6"></a><span class="cm"> */</span>
</span><span id="__span-153-7"><a id="__codelineno-153-7" name="__codelineno-153-7" href="#__codelineno-153-7"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">releaseLockByDel</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lockKey</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">requestId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-153-8"><a id="__codelineno-153-8" name="__codelineno-153-8" href="#__codelineno-153-8"></a><span class="w">    </span><span class="c1">// è·å–jediså¯¹è±¡ï¼Œè´Ÿè´£ä¸è¿œç¨‹redisæœåŠ¡å™¨è¿›è¡Œé“¾æ¥</span>
</span><span id="__span-153-9"><a id="__codelineno-153-9" name="__codelineno-153-9" href="#__codelineno-153-9"></a><span class="w">    </span><span class="n">Jedis</span><span class="w"> </span><span class="n">jedis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getJedis</span><span class="p">();</span>
</span><span id="__span-153-10"><a id="__codelineno-153-10" name="__codelineno-153-10" href="#__codelineno-153-10"></a><span class="w">    </span><span class="c1">// ä¿è¯åŒä¸€æ€§</span>
</span><span id="__span-153-11"><a id="__codelineno-153-11" name="__codelineno-153-11" href="#__codelineno-153-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">requestId</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">jedis</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">lockKey</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-153-12"><a id="__codelineno-153-12" name="__codelineno-153-12" href="#__codelineno-153-12"></a><span class="w">        </span><span class="n">jedis</span><span class="p">.</span><span class="na">del</span><span class="p">(</span><span class="n">lockKey</span><span class="p">);</span>
</span><span id="__span-153-13"><a id="__codelineno-153-13" name="__codelineno-153-13" href="#__codelineno-153-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-153-14"><a id="__codelineno-153-14" name="__codelineno-153-14" href="#__codelineno-153-14"></a><span class="p">}</span>
</span></code></pre></div> <h2 id="14redis-å®ç°åˆ†å¸ƒå¼ç¼“å­˜">14ã€Redis å®ç°åˆ†å¸ƒå¼ç¼“å­˜<a class="headerlink" href="#14redis-å®ç°åˆ†å¸ƒå¼ç¼“å­˜" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>åœ¨ Mybatis ä¸­é»˜è®¤æƒ…å†µä¸‹ï¼Œåªå¯ç”¨äº†æœ¬åœ°çš„ä¼šè¯ç¼“å­˜ï¼Œå®ƒä»…ä»…å¯¹ä¸€ä¸ªä¼šè¯ä¸­çš„æ•°æ®è¿›è¡Œç¼“å­˜ã€‚ è¦å¯ç”¨å…¨å±€çš„äºŒçº§ç¼“å­˜ï¼Œåªéœ€è¦åœ¨ SQL æ˜ å°„æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="nt">&lt;cache/&gt;</span>
</span></code></pre></div> <h3 id="141æ­å»ºç¯å¢ƒ">14.1ã€æ­å»ºç¯å¢ƒ<a class="headerlink" href="#141æ­å»ºç¯å¢ƒ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <ol> <li> <p>è¿™é‡Œæ–°å»ºä¸€ä¸ªç®€å•çš„ SpringBoot é¡¹ç›®ï¼Œå¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="nt">&lt;dependencies&gt;</span>
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-155-3"><a id="__codelineno-155-3" name="__codelineno-155-3" href="#__codelineno-155-3"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-155-4"><a id="__codelineno-155-4" name="__codelineno-155-4" href="#__codelineno-155-4"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-155-5"><a id="__codelineno-155-5" name="__codelineno-155-5" href="#__codelineno-155-5"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-155-6"><a id="__codelineno-155-6" name="__codelineno-155-6" href="#__codelineno-155-6"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-155-7"><a id="__codelineno-155-7" name="__codelineno-155-7" href="#__codelineno-155-7"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-155-8"><a id="__codelineno-155-8" name="__codelineno-155-8" href="#__codelineno-155-8"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-155-9"><a id="__codelineno-155-9" name="__codelineno-155-9" href="#__codelineno-155-9"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-155-10"><a id="__codelineno-155-10" name="__codelineno-155-10" href="#__codelineno-155-10"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-155-11"><a id="__codelineno-155-11" name="__codelineno-155-11" href="#__codelineno-155-11"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-155-12"><a id="__codelineno-155-12" name="__codelineno-155-12" href="#__codelineno-155-12"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-155-13"><a id="__codelineno-155-13" name="__codelineno-155-13" href="#__codelineno-155-13"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>2.2.0<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-155-14"><a id="__codelineno-155-14" name="__codelineno-155-14" href="#__codelineno-155-14"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-155-15"><a id="__codelineno-155-15" name="__codelineno-155-15" href="#__codelineno-155-15"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-155-16"><a id="__codelineno-155-16" name="__codelineno-155-16" href="#__codelineno-155-16"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-155-17"><a id="__codelineno-155-17" name="__codelineno-155-17" href="#__codelineno-155-17"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-155-18"><a id="__codelineno-155-18" name="__codelineno-155-18" href="#__codelineno-155-18"></a><span class="w">        </span><span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-155-19"><a id="__codelineno-155-19" name="__codelineno-155-19" href="#__codelineno-155-19"></a><span class="w">        </span><span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
</span><span id="__span-155-20"><a id="__codelineno-155-20" name="__codelineno-155-20" href="#__codelineno-155-20"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-155-21"><a id="__codelineno-155-21" name="__codelineno-155-21" href="#__codelineno-155-21"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-155-22"><a id="__codelineno-155-22" name="__codelineno-155-22" href="#__codelineno-155-22"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-155-23"><a id="__codelineno-155-23" name="__codelineno-155-23" href="#__codelineno-155-23"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-155-24"><a id="__codelineno-155-24" name="__codelineno-155-24" href="#__codelineno-155-24"></a><span class="w">        </span><span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-155-25"><a id="__codelineno-155-25" name="__codelineno-155-25" href="#__codelineno-155-25"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-155-26"><a id="__codelineno-155-26" name="__codelineno-155-26" href="#__codelineno-155-26"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-155-27"><a id="__codelineno-155-27" name="__codelineno-155-27" href="#__codelineno-155-27"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-155-28"><a id="__codelineno-155-28" name="__codelineno-155-28" href="#__codelineno-155-28"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-155-29"><a id="__codelineno-155-29" name="__codelineno-155-29" href="#__codelineno-155-29"></a><span class="w">        </span><span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
</span><span id="__span-155-30"><a id="__codelineno-155-30" name="__codelineno-155-30" href="#__codelineno-155-30"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-155-31"><a id="__codelineno-155-31" name="__codelineno-155-31" href="#__codelineno-155-31"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-155-32"><a id="__codelineno-155-32" name="__codelineno-155-32" href="#__codelineno-155-32"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-155-33"><a id="__codelineno-155-33" name="__codelineno-155-33" href="#__codelineno-155-33"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-155-34"><a id="__codelineno-155-34" name="__codelineno-155-34" href="#__codelineno-155-34"></a><span class="w">        </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-155-35"><a id="__codelineno-155-35" name="__codelineno-155-35" href="#__codelineno-155-35"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-155-36"><a id="__codelineno-155-36" name="__codelineno-155-36" href="#__codelineno-155-36"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-155-37"><a id="__codelineno-155-37" name="__codelineno-155-37" href="#__codelineno-155-37"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-155-38"><a id="__codelineno-155-38" name="__codelineno-155-38" href="#__codelineno-155-38"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>druid-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-155-39"><a id="__codelineno-155-39" name="__codelineno-155-39" href="#__codelineno-155-39"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>1.2.6<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-155-40"><a id="__codelineno-155-40" name="__codelineno-155-40" href="#__codelineno-155-40"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-155-41"><a id="__codelineno-155-41" name="__codelineno-155-41" href="#__codelineno-155-41"></a><span class="nt">&lt;/dependencies&gt;</span>
</span></code></pre></div> </li> <li> <p>ç¼–è¾‘ application.yml æ–‡ä»¶ï¼š</p> <div class="language-yaml highlight"><span class="filename">YAML</span><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="nt">server</span><span class="p">:</span>
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8888</span>
</span><span id="__span-156-3"><a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a><span class="nt">spring</span><span class="p">:</span>
</span><span id="__span-156-4"><a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a><span class="w">  </span><span class="c1">#redis</span>
</span><span id="__span-156-5"><a id="__codelineno-156-5" name="__codelineno-156-5" href="#__codelineno-156-5"></a><span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
</span><span id="__span-156-6"><a id="__codelineno-156-6" name="__codelineno-156-6" href="#__codelineno-156-6"></a><span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-156-7"><a id="__codelineno-156-7" name="__codelineno-156-7" href="#__codelineno-156-7"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
</span><span id="__span-156-8"><a id="__codelineno-156-8" name="__codelineno-156-8" href="#__codelineno-156-8"></a><span class="w">    </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-156-9"><a id="__codelineno-156-9" name="__codelineno-156-9" href="#__codelineno-156-9"></a><span class="w">  </span><span class="c1">#mysql</span>
</span><span id="__span-156-10"><a id="__codelineno-156-10" name="__codelineno-156-10" href="#__codelineno-156-10"></a><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span>
</span><span id="__span-156-11"><a id="__codelineno-156-11" name="__codelineno-156-11" href="#__codelineno-156-11"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">com.alibaba.druid.pool.DruidDataSource</span>
</span><span id="__span-156-12"><a id="__codelineno-156-12" name="__codelineno-156-12" href="#__codelineno-156-12"></a><span class="w">    </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">com.mysql.cj.jdbc.Driver</span>
</span><span id="__span-156-13"><a id="__codelineno-156-13" name="__codelineno-156-13" href="#__codelineno-156-13"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jdbc:mysql://localhost:3306/redis?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span>
</span><span id="__span-156-14"><a id="__codelineno-156-14" name="__codelineno-156-14" href="#__codelineno-156-14"></a><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-156-15"><a id="__codelineno-156-15" name="__codelineno-156-15" href="#__codelineno-156-15"></a><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-156-16"><a id="__codelineno-156-16" name="__codelineno-156-16" href="#__codelineno-156-16"></a><span class="c1">#mybatis</span>
</span><span id="__span-156-17"><a id="__codelineno-156-17" name="__codelineno-156-17" href="#__codelineno-156-17"></a><span class="nt">mybatis</span><span class="p">:</span>
</span><span id="__span-156-18"><a id="__codelineno-156-18" name="__codelineno-156-18" href="#__codelineno-156-18"></a><span class="w">  </span><span class="nt">mapper-locations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">classpath:mapper/*.xml</span>
</span><span id="__span-156-19"><a id="__codelineno-156-19" name="__codelineno-156-19" href="#__codelineno-156-19"></a><span class="w">  </span><span class="nt">type-aliases-package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">com.orichalcos.entity</span>
</span><span id="__span-156-20"><a id="__codelineno-156-20" name="__codelineno-156-20" href="#__codelineno-156-20"></a>
</span><span id="__span-156-21"><a id="__codelineno-156-21" name="__codelineno-156-21" href="#__codelineno-156-21"></a><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-156-22"><a id="__codelineno-156-22" name="__codelineno-156-22" href="#__codelineno-156-22"></a><span class="w">  </span><span class="nt">level</span><span class="p">:</span>
</span><span id="__span-156-23"><a id="__codelineno-156-23" name="__codelineno-156-23" href="#__codelineno-156-23"></a><span class="w">    </span><span class="nt">com.orichalcos.mapper</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">debug</span>
</span></code></pre></div> </li> <li> <p>æ–°å»ºä¸€ä¸ªç®€å•çš„å®ä½“ç±» User.javaï¼Œå¹¶åœ¨æ•°æ®åº“åˆ›å»ºå¯¹åº”è¡¨ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="cm">/**</span>
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a><span class="cm"> * @author Orichalcos</span>
</span><span id="__span-157-3"><a id="__codelineno-157-3" name="__codelineno-157-3" href="#__codelineno-157-3"></a><span class="cm"> */</span>
</span><span id="__span-157-4"><a id="__codelineno-157-4" name="__codelineno-157-4" href="#__codelineno-157-4"></a><span class="nd">@Data</span>
</span><span id="__span-157-5"><a id="__codelineno-157-5" name="__codelineno-157-5" href="#__codelineno-157-5"></a><span class="nd">@AllArgsConstructor</span>
</span><span id="__span-157-6"><a id="__codelineno-157-6" name="__codelineno-157-6" href="#__codelineno-157-6"></a><span class="nd">@NoArgsConstructor</span>
</span><span id="__span-157-7"><a id="__codelineno-157-7" name="__codelineno-157-7" href="#__codelineno-157-7"></a><span class="nd">@Accessors</span><span class="p">(</span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-157-8"><a id="__codelineno-157-8" name="__codelineno-157-8" href="#__codelineno-157-8"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">User</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-9"><a id="__codelineno-157-9" name="__codelineno-157-9" href="#__codelineno-157-9"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</span><span id="__span-157-10"><a id="__codelineno-157-10" name="__codelineno-157-10" href="#__codelineno-157-10"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-157-11"><a id="__codelineno-157-11" name="__codelineno-157-11" href="#__codelineno-157-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
</span><span id="__span-157-12"><a id="__codelineno-157-12" name="__codelineno-157-12" href="#__codelineno-157-12"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">bir</span><span class="p">;</span>
</span><span id="__span-157-13"><a id="__codelineno-157-13" name="__codelineno-157-13" href="#__codelineno-157-13"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p>æ–°å»º UserMapper.javaï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="cm">/**</span>
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a><span class="cm"> * @author Orichalcos</span>
</span><span id="__span-158-3"><a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="cm"> */</span>
</span><span id="__span-158-4"><a id="__codelineno-158-4" name="__codelineno-158-4" href="#__codelineno-158-4"></a><span class="nd">@Mapper</span>
</span><span id="__span-158-5"><a id="__codelineno-158-5" name="__codelineno-158-5" href="#__codelineno-158-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserMapper</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-6"><a id="__codelineno-158-6" name="__codelineno-158-6" href="#__codelineno-158-6"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">();</span>
</span><span id="__span-158-7"><a id="__codelineno-158-7" name="__codelineno-158-7" href="#__codelineno-158-7"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p>UserMapper.xmlï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
</span><span id="__span-159-2"><a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a><span class="cp">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>
</span><span id="__span-159-3"><a id="__codelineno-159-3" name="__codelineno-159-3" href="#__codelineno-159-3"></a><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">"com.orichalcos.mapper.UserMapper"</span><span class="nt">&gt;</span>
</span><span id="__span-159-4"><a id="__codelineno-159-4" name="__codelineno-159-4" href="#__codelineno-159-4"></a><span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"findAll"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"User"</span><span class="nt">&gt;</span>
</span><span id="__span-159-5"><a id="__codelineno-159-5" name="__codelineno-159-5" href="#__codelineno-159-5"></a><span class="w">        </span>select<span class="w"> </span>id,name,age,bir<span class="w"> </span>from<span class="w"> </span>t_user;
</span><span id="__span-159-6"><a id="__codelineno-159-6" name="__codelineno-159-6" href="#__codelineno-159-6"></a><span class="w">    </span><span class="nt">&lt;/select&gt;</span>
</span><span id="__span-159-7"><a id="__codelineno-159-7" name="__codelineno-159-7" href="#__codelineno-159-7"></a><span class="nt">&lt;/mapper&gt;</span>
</span></code></pre></div> </li> <li> <p>UserService.java å’Œ UserServiceImpl.javaï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserService</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">();</span>
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a><span class="p">}</span>
</span></code></pre></div> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a><span class="cm">/**</span>
</span><span id="__span-161-2"><a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a><span class="cm"> * @author Orichalcos</span>
</span><span id="__span-161-3"><a id="__codelineno-161-3" name="__codelineno-161-3" href="#__codelineno-161-3"></a><span class="cm"> */</span>
</span><span id="__span-161-4"><a id="__codelineno-161-4" name="__codelineno-161-4" href="#__codelineno-161-4"></a><span class="nd">@Service</span>
</span><span id="__span-161-5"><a id="__codelineno-161-5" name="__codelineno-161-5" href="#__codelineno-161-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-161-6"><a id="__codelineno-161-6" name="__codelineno-161-6" href="#__codelineno-161-6"></a>
</span><span id="__span-161-7"><a id="__codelineno-161-7" name="__codelineno-161-7" href="#__codelineno-161-7"></a><span class="w">    </span><span class="nd">@Autowired</span>
</span><span id="__span-161-8"><a id="__codelineno-161-8" name="__codelineno-161-8" href="#__codelineno-161-8"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserMapper</span><span class="w"> </span><span class="n">userMapper</span><span class="p">;</span>
</span><span id="__span-161-9"><a id="__codelineno-161-9" name="__codelineno-161-9" href="#__codelineno-161-9"></a>
</span><span id="__span-161-10"><a id="__codelineno-161-10" name="__codelineno-161-10" href="#__codelineno-161-10"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-161-11"><a id="__codelineno-161-11" name="__codelineno-161-11" href="#__codelineno-161-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-161-12"><a id="__codelineno-161-12" name="__codelineno-161-12" href="#__codelineno-161-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userMapper</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
</span><span id="__span-161-13"><a id="__codelineno-161-13" name="__codelineno-161-13" href="#__codelineno-161-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-161-14"><a id="__codelineno-161-14" name="__codelineno-161-14" href="#__codelineno-161-14"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p>åœ¨ test.java.com.orichalcos ä¸‹åˆ›å»ºä¸€ä¸ª TestUserService.java è¿›è¡Œæµ‹è¯•ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="nd">@SpringBootTest</span>
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestUserService</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a><span class="w">    </span><span class="nd">@Autowired</span>
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4" href="#__codelineno-162-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="n">userService</span><span class="p">;</span>
</span><span id="__span-162-5"><a id="__codelineno-162-5" name="__codelineno-162-5" href="#__codelineno-162-5"></a>
</span><span id="__span-162-6"><a id="__codelineno-162-6" name="__codelineno-162-6" href="#__codelineno-162-6"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-162-7"><a id="__codelineno-162-7" name="__codelineno-162-7" href="#__codelineno-162-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-8"><a id="__codelineno-162-8" name="__codelineno-162-8" href="#__codelineno-162-8"></a><span class="w">        </span><span class="n">userService</span><span class="p">.</span><span class="na">findAll</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"u = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="p">));</span>
</span><span id="__span-162-9"><a id="__codelineno-162-9" name="__codelineno-162-9" href="#__codelineno-162-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-162-10"><a id="__codelineno-162-10" name="__codelineno-162-10" href="#__codelineno-162-10"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p>å¯åŠ¨ <code>test()</code> æµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼Œç¯å¢ƒæ­å»ºæˆåŠŸï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a>u = User(id=1, name=orichalcos, age=18, bir=Tue Jun 15 00:00:00 CST 2021)
</span><span id="__span-163-2"><a id="__codelineno-163-2" name="__codelineno-163-2" href="#__codelineno-163-2"></a>u = User(id=2, name=å°é»‘, age=20, bir=Wed Jun 16 00:00:00 CST 2021)
</span></code></pre></div> </li> </ol> <h3 id="142å¼€å¯-mybatis-çš„äºŒçº§ç¼“å­˜">14.2ã€å¼€å¯ Mybatis çš„äºŒçº§ç¼“å­˜<a class="headerlink" href="#142å¼€å¯-mybatis-çš„äºŒçº§ç¼“å­˜" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>åœ¨å¼€å¯ä¹‹å‰ï¼Œä¿®æ”¹ä¸‹ <code>test()</code> æ–¹æ³•ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="nd">@Test</span>
</span><span id="__span-164-2"><a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-3"><a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a><span class="w">    </span><span class="n">userService</span><span class="p">.</span><span class="na">findAll</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"u = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="p">));</span>
</span><span id="__span-164-4"><a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a>
</span><span id="__span-164-5"><a id="__codelineno-164-5" name="__codelineno-164-5" href="#__codelineno-164-5"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"================================================="</span><span class="p">);</span>
</span><span id="__span-164-6"><a id="__codelineno-164-6" name="__codelineno-164-6" href="#__codelineno-164-6"></a>
</span><span id="__span-164-7"><a id="__codelineno-164-7" name="__codelineno-164-7" href="#__codelineno-164-7"></a><span class="w">    </span><span class="n">userService</span><span class="p">.</span><span class="na">findAll</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"u = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="p">));</span>
</span><span id="__span-164-8"><a id="__codelineno-164-8" name="__codelineno-164-8" href="#__codelineno-164-8"></a><span class="p">}</span>
</span></code></pre></div> <p>æŸ¥çœ‹æ‰“å°å‡ºæ¥çš„æ—¥å¿—ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210616162153913.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210616162153913.png" alt="image-20210616162153913" style></a></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºå»æ•°æ®åº“æŸ¥è¯¢äº†ä¸¤æ¬¡ã€‚</p> <p>å†åœ¨ UserMapper.xml ä¸­å¼€å¯äºŒçº§ç¼“å­˜ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a><span class="nt">&lt;cache/&gt;</span>
</span></code></pre></div> <p>å†æ¬¡å¯åŠ¨ <code>test()</code> æ–¹æ³•ï¼ŒæŸ¥çœ‹æ‰“å°çš„æ—¥å¿—ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210616162704356.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210616162704356.png" alt="image-20210616162704356" style></a></p> <p>å¯ä»¥çœ‹åˆ°è¿™é‡Œç¨‹åºåªæŸ¥è¯¢äº†ä¸€æ¬¡æ•°æ®å¯ï¼Œç¬¬äºŒæ¬¡å› ä¸ºå‡»ä¸­äº†ç¼“å­˜ï¼Œæ‰€ä»¥ç›´æ¥ç»™åˆ°äº†æ•°æ®ã€‚</p> <p>å¼€å¯ç¼“å­˜éœ€è¦å®ä½“ç±»å®ç°åºåˆ—åŒ–ï¼Œä¸ç„¶ä¼šæŠ¥åºåˆ—åŒ–çš„é”™è¯¯ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210616163022937.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210616163022937.png" alt="image-20210616163022937" style></a></p> <h3 id="143ä½¿ç”¨-redis-ä½œä¸ºç¼“å­˜">14.3ã€ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜<a class="headerlink" href="#143ä½¿ç”¨-redis-ä½œä¸ºç¼“å­˜" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>é¦–å…ˆï¼Œçœ‹çœ‹ Mybatis çš„ Cache æ¥å£çš„å®ç°ç±»ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210616163547625.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210616163547625.png" alt="image-20210616163547625" style></a></p> <p>Mybatis ä¸­é»˜è®¤ä½¿ç”¨çš„å°±æ˜¯ PerpretualCacheï¼Œå¯ä»¥çœ‹ä¸€ä¸‹æºç ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a><span class="c1">//</span>
</span><span id="__span-166-2"><a id="__codelineno-166-2" name="__codelineno-166-2" href="#__codelineno-166-2"></a><span class="c1">// Source code recreated from a .class file by IntelliJ IDEA</span>
</span><span id="__span-166-3"><a id="__codelineno-166-3" name="__codelineno-166-3" href="#__codelineno-166-3"></a><span class="c1">// (powered by FernFlower decompiler)</span>
</span><span id="__span-166-4"><a id="__codelineno-166-4" name="__codelineno-166-4" href="#__codelineno-166-4"></a><span class="c1">//</span>
</span><span id="__span-166-5"><a id="__codelineno-166-5" name="__codelineno-166-5" href="#__codelineno-166-5"></a>
</span><span id="__span-166-6"><a id="__codelineno-166-6" name="__codelineno-166-6" href="#__codelineno-166-6"></a><span class="kn">package</span><span class="w"> </span><span class="nn">org.apache.ibatis.cache.impl</span><span class="p">;</span>
</span><span id="__span-166-7"><a id="__codelineno-166-7" name="__codelineno-166-7" href="#__codelineno-166-7"></a>
</span><span id="__span-166-8"><a id="__codelineno-166-8" name="__codelineno-166-8" href="#__codelineno-166-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashMap</span><span class="p">;</span>
</span><span id="__span-166-9"><a id="__codelineno-166-9" name="__codelineno-166-9" href="#__codelineno-166-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>
</span><span id="__span-166-10"><a id="__codelineno-166-10" name="__codelineno-166-10" href="#__codelineno-166-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.cache.Cache</span><span class="p">;</span>
</span><span id="__span-166-11"><a id="__codelineno-166-11" name="__codelineno-166-11" href="#__codelineno-166-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.cache.CacheException</span><span class="p">;</span>
</span><span id="__span-166-12"><a id="__codelineno-166-12" name="__codelineno-166-12" href="#__codelineno-166-12"></a>
</span><span id="__span-166-13"><a id="__codelineno-166-13" name="__codelineno-166-13" href="#__codelineno-166-13"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PerpetualCache</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-14"><a id="__codelineno-166-14" name="__codelineno-166-14" href="#__codelineno-166-14"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</span><span id="__span-166-15"><a id="__codelineno-166-15" name="__codelineno-166-15" href="#__codelineno-166-15"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Object</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="p">();</span>
</span><span id="__span-166-16"><a id="__codelineno-166-16" name="__codelineno-166-16" href="#__codelineno-166-16"></a>
</span><span id="__span-166-17"><a id="__codelineno-166-17" name="__codelineno-166-17" href="#__codelineno-166-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">PerpetualCache</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-18"><a id="__codelineno-166-18" name="__codelineno-166-18" href="#__codelineno-166-18"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</span><span id="__span-166-19"><a id="__codelineno-166-19" name="__codelineno-166-19" href="#__codelineno-166-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-166-20"><a id="__codelineno-166-20" name="__codelineno-166-20" href="#__codelineno-166-20"></a>
</span><span id="__span-166-21"><a id="__codelineno-166-21" name="__codelineno-166-21" href="#__codelineno-166-21"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-22"><a id="__codelineno-166-22" name="__codelineno-166-22" href="#__codelineno-166-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">;</span>
</span><span id="__span-166-23"><a id="__codelineno-166-23" name="__codelineno-166-23" href="#__codelineno-166-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-166-24"><a id="__codelineno-166-24" name="__codelineno-166-24" href="#__codelineno-166-24"></a>
</span><span id="__span-166-25"><a id="__codelineno-166-25" name="__codelineno-166-25" href="#__codelineno-166-25"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-26"><a id="__codelineno-166-26" name="__codelineno-166-26" href="#__codelineno-166-26"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cache</span><span class="p">.</span><span class="na">size</span><span class="p">();</span>
</span><span id="__span-166-27"><a id="__codelineno-166-27" name="__codelineno-166-27" href="#__codelineno-166-27"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-166-28"><a id="__codelineno-166-28" name="__codelineno-166-28" href="#__codelineno-166-28"></a>
</span><span id="__span-166-29"><a id="__codelineno-166-29" name="__codelineno-166-29" href="#__codelineno-166-29"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">putObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-30"><a id="__codelineno-166-30" name="__codelineno-166-30" href="#__codelineno-166-30"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">cache</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
</span><span id="__span-166-31"><a id="__codelineno-166-31" name="__codelineno-166-31" href="#__codelineno-166-31"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-166-32"><a id="__codelineno-166-32" name="__codelineno-166-32" href="#__codelineno-166-32"></a>
</span><span id="__span-166-33"><a id="__codelineno-166-33" name="__codelineno-166-33" href="#__codelineno-166-33"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-34"><a id="__codelineno-166-34" name="__codelineno-166-34" href="#__codelineno-166-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cache</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
</span><span id="__span-166-35"><a id="__codelineno-166-35" name="__codelineno-166-35" href="#__codelineno-166-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-166-36"><a id="__codelineno-166-36" name="__codelineno-166-36" href="#__codelineno-166-36"></a>
</span><span id="__span-166-37"><a id="__codelineno-166-37" name="__codelineno-166-37" href="#__codelineno-166-37"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">removeObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-38"><a id="__codelineno-166-38" name="__codelineno-166-38" href="#__codelineno-166-38"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cache</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
</span><span id="__span-166-39"><a id="__codelineno-166-39" name="__codelineno-166-39" href="#__codelineno-166-39"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-166-40"><a id="__codelineno-166-40" name="__codelineno-166-40" href="#__codelineno-166-40"></a>
</span><span id="__span-166-41"><a id="__codelineno-166-41" name="__codelineno-166-41" href="#__codelineno-166-41"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">clear</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-166-42"><a id="__codelineno-166-42" name="__codelineno-166-42" href="#__codelineno-166-42"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">cache</span><span class="p">.</span><span class="na">clear</span><span class="p">();</span>
</span><span id="__span-166-43"><a id="__codelineno-166-43" name="__codelineno-166-43" href="#__codelineno-166-43"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-166-44"><a id="__codelineno-166-44" name="__codelineno-166-44" href="#__codelineno-166-44"></a><span class="p">...</span>
</span><span id="__span-166-45"><a id="__codelineno-166-45" name="__codelineno-166-45" href="#__codelineno-166-45"></a><span class="p">}</span>
</span></code></pre></div> <p>å¯ä»¥çœ‹åˆ°åœ¨ç±»ä¸­ç»´æŠ¤äº†ä¸€ä¸ªåä¸º cache çš„ HashMapï¼Œå¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯å¯¹ cache è¿›è¡Œæ“ä½œï¼Œå¯ä»¥å¯¹å…¶ä¸­çš„ä¸€äº›æ–¹æ³•æ‰“ä¸Šæ–­ç‚¹ debug æŸ¥çœ‹æ–¹æ³•ä»€ä¹ˆæ—¶å€™è§¦å‘ã€‚å…¶å®çœ‹åˆ°è¿™é‡Œå·²ç»å¾ˆç›´ç™½äº†ï¼šHashMap ç”¨äºå­˜æ”¾ç¼“å­˜ï¼Œå¦‚æœæŸ¥è¯¢çš„æ—¶å€™æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨ <code>putObject()</code> å°†ç¼“å­˜å­˜å…¥ï¼Œå¦‚æœå‘½ä¸­ç¼“å­˜å°±ä½¿ç”¨ <code>getObject()</code> å°†æ•°æ®å–å‡ºã€‚é‚£ä¹ˆå¦‚æœä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ª RedisCache å¹¶ä¸”å®ç° Cache æ¥å£å³å¯ã€‚</p> <p>é¦–å…ˆå…ˆæ–°å»ºä¸€ä¸ª RedisCache.java å¹¶å®ç° Cache.javaï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a><span class="cm">/**</span>
</span><span id="__span-167-2"><a id="__codelineno-167-2" name="__codelineno-167-2" href="#__codelineno-167-2"></a><span class="cm"> * @author Orichalcos</span>
</span><span id="__span-167-3"><a id="__codelineno-167-3" name="__codelineno-167-3" href="#__codelineno-167-3"></a><span class="cm"> * è‡ªå®šä¹‰Redisç¼“å­˜å®ç°</span>
</span><span id="__span-167-4"><a id="__codelineno-167-4" name="__codelineno-167-4" href="#__codelineno-167-4"></a><span class="cm"> */</span>
</span><span id="__span-167-5"><a id="__codelineno-167-5" name="__codelineno-167-5" href="#__codelineno-167-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RedisCache</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-6"><a id="__codelineno-167-6" name="__codelineno-167-6" href="#__codelineno-167-6"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-167-7"><a id="__codelineno-167-7" name="__codelineno-167-7" href="#__codelineno-167-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-8"><a id="__codelineno-167-8" name="__codelineno-167-8" href="#__codelineno-167-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-167-9"><a id="__codelineno-167-9" name="__codelineno-167-9" href="#__codelineno-167-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-167-10"><a id="__codelineno-167-10" name="__codelineno-167-10" href="#__codelineno-167-10"></a>
</span><span id="__span-167-11"><a id="__codelineno-167-11" name="__codelineno-167-11" href="#__codelineno-167-11"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-167-12"><a id="__codelineno-167-12" name="__codelineno-167-12" href="#__codelineno-167-12"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">putObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-13"><a id="__codelineno-167-13" name="__codelineno-167-13" href="#__codelineno-167-13"></a>
</span><span id="__span-167-14"><a id="__codelineno-167-14" name="__codelineno-167-14" href="#__codelineno-167-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-167-15"><a id="__codelineno-167-15" name="__codelineno-167-15" href="#__codelineno-167-15"></a>
</span><span id="__span-167-16"><a id="__codelineno-167-16" name="__codelineno-167-16" href="#__codelineno-167-16"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-167-17"><a id="__codelineno-167-17" name="__codelineno-167-17" href="#__codelineno-167-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-18"><a id="__codelineno-167-18" name="__codelineno-167-18" href="#__codelineno-167-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-167-19"><a id="__codelineno-167-19" name="__codelineno-167-19" href="#__codelineno-167-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-167-20"><a id="__codelineno-167-20" name="__codelineno-167-20" href="#__codelineno-167-20"></a>
</span><span id="__span-167-21"><a id="__codelineno-167-21" name="__codelineno-167-21" href="#__codelineno-167-21"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-167-22"><a id="__codelineno-167-22" name="__codelineno-167-22" href="#__codelineno-167-22"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">removeObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-23"><a id="__codelineno-167-23" name="__codelineno-167-23" href="#__codelineno-167-23"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-167-24"><a id="__codelineno-167-24" name="__codelineno-167-24" href="#__codelineno-167-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-167-25"><a id="__codelineno-167-25" name="__codelineno-167-25" href="#__codelineno-167-25"></a>
</span><span id="__span-167-26"><a id="__codelineno-167-26" name="__codelineno-167-26" href="#__codelineno-167-26"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-167-27"><a id="__codelineno-167-27" name="__codelineno-167-27" href="#__codelineno-167-27"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">clear</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-28"><a id="__codelineno-167-28" name="__codelineno-167-28" href="#__codelineno-167-28"></a>
</span><span id="__span-167-29"><a id="__codelineno-167-29" name="__codelineno-167-29" href="#__codelineno-167-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-167-30"><a id="__codelineno-167-30" name="__codelineno-167-30" href="#__codelineno-167-30"></a>
</span><span id="__span-167-31"><a id="__codelineno-167-31" name="__codelineno-167-31" href="#__codelineno-167-31"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-167-32"><a id="__codelineno-167-32" name="__codelineno-167-32" href="#__codelineno-167-32"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-167-33"><a id="__codelineno-167-33" name="__codelineno-167-33" href="#__codelineno-167-33"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-167-34"><a id="__codelineno-167-34" name="__codelineno-167-34" href="#__codelineno-167-34"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-167-35"><a id="__codelineno-167-35" name="__codelineno-167-35" href="#__codelineno-167-35"></a><span class="p">}</span>
</span></code></pre></div> <p>åœ¨ UserMapper.xml ä¸­å°† cache ç±»å‹æ”¹ä¸ºè‡ªå®šä¹‰çš„ RedisCacheï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a><span class="nt">&lt;cache</span><span class="w"> </span><span class="na">type=</span><span class="s">"com.orichalcos.cache.RedisCache"</span><span class="nt">/&gt;</span>
</span></code></pre></div> <p>å…ˆç›´æ¥è·‘ä¸€ä¸‹çœ‹çœ‹ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210616184214849.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210616184214849.png" alt="image-20210616184214849" style></a></p> <p>è¿™é‡ŒæŠ¥é”™æç¤ºï¼šåŸºæœ¬ç¼“å­˜å¿…é¡»è¦æœ‰ä¸€ä¸ªå­—ç¬¦ä¸² ID ä¸ºå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå‚è€ƒä¸‹ PerpetualCache.java çš„å®ç°ï¼Œè¿™æ¬¡åœ¨ RedisCache.java ä¸­æ·»åŠ å¯¹åº”çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å°†å…¶æ‰“å°å‡ºæ¥çœ‹çœ‹æ˜¯å•¥ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</span><span id="__span-169-2"><a id="__codelineno-169-2" name="__codelineno-169-2" href="#__codelineno-169-2"></a>
</span><span id="__span-169-3"><a id="__codelineno-169-3" name="__codelineno-169-3" href="#__codelineno-169-3"></a><span class="kd">public</span><span class="w"> </span><span class="nf">RedisCache</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-169-4"><a id="__codelineno-169-4" name="__codelineno-169-4" href="#__codelineno-169-4"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-169-5"><a id="__codelineno-169-5" name="__codelineno-169-5" href="#__codelineno-169-5"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</span><span id="__span-169-6"><a id="__codelineno-169-6" name="__codelineno-169-6" href="#__codelineno-169-6"></a><span class="p">}</span>
</span></code></pre></div> <p>å†æ¬¡æ‰§è¡Œ <code>test()</code>ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210616184824753.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210616184824753.png" alt="image-20210616184824753" style></a></p> <p>æ‰“å°å‡ºäº† IDï¼ŒåŸæ¥æ˜¯ Mapper æ–‡ä»¶çš„ namespaceï¼Œå¹¶ä¸”åœ¨æ§åˆ¶å°æœ€åæç¤ºæŠ¥é”™ï¼šname å‚æ•°ä¸èƒ½ä¸ºç©º</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210616184928611.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210616184928611.png" alt="image-20210616184928611" style></a></p> <p>é‚£ä¹ˆï¼Œæ ¹æ® PerpetualCache.java ä¸­çš„ <code>getId()</code> æ–¹æ³•ï¼Œå°† namespace è¿”å›å‡ºå»ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-170-1"><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a><span class="nd">@Override</span>
</span><span id="__span-170-2"><a id="__codelineno-170-2" name="__codelineno-170-2" href="#__codelineno-170-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-170-3"><a id="__codelineno-170-3" name="__codelineno-170-3" href="#__codelineno-170-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">;</span>
</span><span id="__span-170-4"><a id="__codelineno-170-4" name="__codelineno-170-4" href="#__codelineno-170-4"></a><span class="p">}</span>
</span></code></pre></div> <p>å†æ¬¡è¿è¡Œ <code>test()</code>ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210616185512068.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210616185512068.png" alt="image-20210616185512068" style></a></p> <p>å·²ç»æ²¡æœ‰é—®é¢˜äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æŸ¥è¯¢äº†æ•°æ®åº“ä¸¤æ¬¡ï¼Œå…ˆåˆ«æ€¥ï¼Œå…ˆçœ‹çœ‹ <code>putObject()</code> å’Œ <code>getObject()</code> çš„å‚æ•°æ˜¯å•¥ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-171-1"><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a><span class="nd">@Override</span>
</span><span id="__span-171-2"><a id="__codelineno-171-2" name="__codelineno-171-2" href="#__codelineno-171-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">putObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-171-3"><a id="__codelineno-171-3" name="__codelineno-171-3" href="#__codelineno-171-3"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"key===="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
</span><span id="__span-171-4"><a id="__codelineno-171-4" name="__codelineno-171-4" href="#__codelineno-171-4"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"value===="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
</span><span id="__span-171-5"><a id="__codelineno-171-5" name="__codelineno-171-5" href="#__codelineno-171-5"></a><span class="p">}</span>
</span><span id="__span-171-6"><a id="__codelineno-171-6" name="__codelineno-171-6" href="#__codelineno-171-6"></a>
</span><span id="__span-171-7"><a id="__codelineno-171-7" name="__codelineno-171-7" href="#__codelineno-171-7"></a><span class="nd">@Override</span>
</span><span id="__span-171-8"><a id="__codelineno-171-8" name="__codelineno-171-8" href="#__codelineno-171-8"></a><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-171-9"><a id="__codelineno-171-9" name="__codelineno-171-9" href="#__codelineno-171-9"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"key===="</span><span class="o">+</span><span class="n">key</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
</span><span id="__span-171-10"><a id="__codelineno-171-10" name="__codelineno-171-10" href="#__codelineno-171-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-171-11"><a id="__codelineno-171-11" name="__codelineno-171-11" href="#__codelineno-171-11"></a><span class="p">}</span>
</span></code></pre></div> <p>å†è·‘ä¸€ä¸‹ <code>test()</code>ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210616190044791.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210616190044791.png" alt="image-20210616190044791" style></a></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡æŸ¥è¯¢çš„æ—¶å€™éƒ½ä¼šé€šè¿‡ <code>getObject()</code> æ–¹æ³•å»æ‹¿ç¼“å­˜ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰æ‹¿åˆ°ï¼Œæ‰€ä»¥å»æ•°æ®åº“æŸ¥è¯¢ï¼Œç„¶åé€šè¿‡ <code>putObject()</code> å°†æ•°æ®å­˜å…¥ç¼“å­˜ã€‚</p> <p>è¿™æ ·å°±å¾ˆæ¸…æ¥šäº†ï¼ŒæŒ‰ç…§ PerpetualCache.java çš„å®ç°ï¼ˆå­˜å…¥ HashMapï¼‰ï¼Œå°†æ•°æ®å­˜å…¥ Redis ä¸­ã€‚ç”±äº RedisCache.java æ²¡æœ‰è¢« Spring æ‰˜ç®¡ï¼Œæ‰€ä»¥ä¸å¯ä»¥é€šè¿‡ <code>@Autowired</code> ç›´æ¥è·å–åˆ° RedisTemplateï¼Œè¿™é‡Œå†™ä¸€ä¸ªå·¥å…·ç±»æ¥è·å–ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-172-1"><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a><span class="cm">/**</span>
</span><span id="__span-172-2"><a id="__codelineno-172-2" name="__codelineno-172-2" href="#__codelineno-172-2"></a><span class="cm"> * @author Orichalcos</span>
</span><span id="__span-172-3"><a id="__codelineno-172-3" name="__codelineno-172-3" href="#__codelineno-172-3"></a><span class="cm"> * ç”¨æ¥è·å–springbootåˆ›å»ºå¥½çš„å·¥å‚</span>
</span><span id="__span-172-4"><a id="__codelineno-172-4" name="__codelineno-172-4" href="#__codelineno-172-4"></a><span class="cm"> */</span>
</span><span id="__span-172-5"><a id="__codelineno-172-5" name="__codelineno-172-5" href="#__codelineno-172-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApplicationContextUtils</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ApplicationContextAware</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-172-6"><a id="__codelineno-172-6" name="__codelineno-172-6" href="#__codelineno-172-6"></a>
</span><span id="__span-172-7"><a id="__codelineno-172-7" name="__codelineno-172-7" href="#__codelineno-172-7"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">;</span>
</span><span id="__span-172-8"><a id="__codelineno-172-8" name="__codelineno-172-8" href="#__codelineno-172-8"></a>
</span><span id="__span-172-9"><a id="__codelineno-172-9" name="__codelineno-172-9" href="#__codelineno-172-9"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-172-10"><a id="__codelineno-172-10" name="__codelineno-172-10" href="#__codelineno-172-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setApplicationContext</span><span class="p">(</span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">BeansException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-172-11"><a id="__codelineno-172-11" name="__codelineno-172-11" href="#__codelineno-172-11"></a><span class="w">        </span><span class="n">ApplicationContextUtils</span><span class="p">.</span><span class="na">applicationContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">;</span>
</span><span id="__span-172-12"><a id="__codelineno-172-12" name="__codelineno-172-12" href="#__codelineno-172-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-172-13"><a id="__codelineno-172-13" name="__codelineno-172-13" href="#__codelineno-172-13"></a>
</span><span id="__span-172-14"><a id="__codelineno-172-14" name="__codelineno-172-14" href="#__codelineno-172-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getBean</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-172-15"><a id="__codelineno-172-15" name="__codelineno-172-15" href="#__codelineno-172-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-172-16"><a id="__codelineno-172-16" name="__codelineno-172-16" href="#__codelineno-172-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-172-17"><a id="__codelineno-172-17" name="__codelineno-172-17" href="#__codelineno-172-17"></a><span class="p">}</span>
</span></code></pre></div> <p>å®Œå–„ RedisCache.java çš„ä»£ç ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-173-1"><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a><span class="cm">/**</span>
</span><span id="__span-173-2"><a id="__codelineno-173-2" name="__codelineno-173-2" href="#__codelineno-173-2"></a><span class="cm"> * @author Orichalcos</span>
</span><span id="__span-173-3"><a id="__codelineno-173-3" name="__codelineno-173-3" href="#__codelineno-173-3"></a><span class="cm"> * è‡ªå®šä¹‰Redisç¼“å­˜å®ç°</span>
</span><span id="__span-173-4"><a id="__codelineno-173-4" name="__codelineno-173-4" href="#__codelineno-173-4"></a><span class="cm"> */</span>
</span><span id="__span-173-5"><a id="__codelineno-173-5" name="__codelineno-173-5" href="#__codelineno-173-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RedisCache</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-6"><a id="__codelineno-173-6" name="__codelineno-173-6" href="#__codelineno-173-6"></a>
</span><span id="__span-173-7"><a id="__codelineno-173-7" name="__codelineno-173-7" href="#__codelineno-173-7"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</span><span id="__span-173-8"><a id="__codelineno-173-8" name="__codelineno-173-8" href="#__codelineno-173-8"></a>
</span><span id="__span-173-9"><a id="__codelineno-173-9" name="__codelineno-173-9" href="#__codelineno-173-9"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">RedisCache</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-10"><a id="__codelineno-173-10" name="__codelineno-173-10" href="#__codelineno-173-10"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</span><span id="__span-173-11"><a id="__codelineno-173-11" name="__codelineno-173-11" href="#__codelineno-173-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-173-12"><a id="__codelineno-173-12" name="__codelineno-173-12" href="#__codelineno-173-12"></a>
</span><span id="__span-173-13"><a id="__codelineno-173-13" name="__codelineno-173-13" href="#__codelineno-173-13"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-173-14"><a id="__codelineno-173-14" name="__codelineno-173-14" href="#__codelineno-173-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-15"><a id="__codelineno-173-15" name="__codelineno-173-15" href="#__codelineno-173-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">;</span>
</span><span id="__span-173-16"><a id="__codelineno-173-16" name="__codelineno-173-16" href="#__codelineno-173-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-173-17"><a id="__codelineno-173-17" name="__codelineno-173-17" href="#__codelineno-173-17"></a>
</span><span id="__span-173-18"><a id="__codelineno-173-18" name="__codelineno-173-18" href="#__codelineno-173-18"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-173-19"><a id="__codelineno-173-19" name="__codelineno-173-19" href="#__codelineno-173-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">putObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-20"><a id="__codelineno-173-20" name="__codelineno-173-20" href="#__codelineno-173-20"></a><span class="w">        </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
</span><span id="__span-173-21"><a id="__codelineno-173-21" name="__codelineno-173-21" href="#__codelineno-173-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-173-22"><a id="__codelineno-173-22" name="__codelineno-173-22" href="#__codelineno-173-22"></a>
</span><span id="__span-173-23"><a id="__codelineno-173-23" name="__codelineno-173-23" href="#__codelineno-173-23"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-173-24"><a id="__codelineno-173-24" name="__codelineno-173-24" href="#__codelineno-173-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-25"><a id="__codelineno-173-25" name="__codelineno-173-25" href="#__codelineno-173-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
</span><span id="__span-173-26"><a id="__codelineno-173-26" name="__codelineno-173-26" href="#__codelineno-173-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-173-27"><a id="__codelineno-173-27" name="__codelineno-173-27" href="#__codelineno-173-27"></a>
</span><span id="__span-173-28"><a id="__codelineno-173-28" name="__codelineno-173-28" href="#__codelineno-173-28"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-173-29"><a id="__codelineno-173-29" name="__codelineno-173-29" href="#__codelineno-173-29"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">removeObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-30"><a id="__codelineno-173-30" name="__codelineno-173-30" href="#__codelineno-173-30"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">delete</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
</span><span id="__span-173-31"><a id="__codelineno-173-31" name="__codelineno-173-31" href="#__codelineno-173-31"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-173-32"><a id="__codelineno-173-32" name="__codelineno-173-32" href="#__codelineno-173-32"></a>
</span><span id="__span-173-33"><a id="__codelineno-173-33" name="__codelineno-173-33" href="#__codelineno-173-33"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-173-34"><a id="__codelineno-173-34" name="__codelineno-173-34" href="#__codelineno-173-34"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">clear</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-35"><a id="__codelineno-173-35" name="__codelineno-173-35" href="#__codelineno-173-35"></a><span class="w">        </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">delete</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-173-36"><a id="__codelineno-173-36" name="__codelineno-173-36" href="#__codelineno-173-36"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-173-37"><a id="__codelineno-173-37" name="__codelineno-173-37" href="#__codelineno-173-37"></a>
</span><span id="__span-173-38"><a id="__codelineno-173-38" name="__codelineno-173-38" href="#__codelineno-173-38"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-173-39"><a id="__codelineno-173-39" name="__codelineno-173-39" href="#__codelineno-173-39"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-40"><a id="__codelineno-173-40" name="__codelineno-173-40" href="#__codelineno-173-40"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">size</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="na">intValue</span><span class="p">();</span>
</span><span id="__span-173-41"><a id="__codelineno-173-41" name="__codelineno-173-41" href="#__codelineno-173-41"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-173-42"><a id="__codelineno-173-42" name="__codelineno-173-42" href="#__codelineno-173-42"></a>
</span><span id="__span-173-43"><a id="__codelineno-173-43" name="__codelineno-173-43" href="#__codelineno-173-43"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="w"> </span><span class="nf">getRedisTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-44"><a id="__codelineno-173-44" name="__codelineno-173-44" href="#__codelineno-173-44"></a><span class="w">        </span><span class="n">RedisTemplate</span><span class="w"> </span><span class="n">redisTemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">RedisTemplate</span><span class="p">)</span><span class="w"> </span><span class="n">ApplicationContextUtils</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">"redisTemplate"</span><span class="p">);</span>
</span><span id="__span-173-45"><a id="__codelineno-173-45" name="__codelineno-173-45" href="#__codelineno-173-45"></a><span class="w">        </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">setKeySerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">string</span><span class="p">());</span>
</span><span id="__span-173-46"><a id="__codelineno-173-46" name="__codelineno-173-46" href="#__codelineno-173-46"></a><span class="w">        </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">setHashKeySerializer</span><span class="p">(</span><span class="n">RedisSerializer</span><span class="p">.</span><span class="na">string</span><span class="p">());</span>
</span><span id="__span-173-47"><a id="__codelineno-173-47" name="__codelineno-173-47" href="#__codelineno-173-47"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">;</span>
</span><span id="__span-173-48"><a id="__codelineno-173-48" name="__codelineno-173-48" href="#__codelineno-173-48"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-173-49"><a id="__codelineno-173-49" name="__codelineno-173-49" href="#__codelineno-173-49"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œ <code>test()</code> ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210617113243767.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210617113243767.png" alt="image-20210617113243767" style></a></p> <p>å·²ç»ç¬¬ä¸€æ¬¡å­˜ï¼Œç¬¬äºŒæ¬¡ç›´æ¥ä»ç¼“å­˜è·å–ï¼Œçœ‹çœ‹ Redis é‡Œï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210617113334200.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210617113334200.png" alt="image-20210617113334200" style></a></p> <h3 id="144é—®é¢˜åŠä¼˜åŒ–">14.4ã€é—®é¢˜åŠä¼˜åŒ–<a class="headerlink" href="#144é—®é¢˜åŠä¼˜åŒ–" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>å¤šè¡¨è¿æ¥é—®é¢˜</strong></p> <p>æ·»åŠ ä¸€ä¸ª Role è¡¨ï¼Œä¸ User å…³è”ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210617124427089.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210617124427089.png" alt="image-20210617124427089" style></a></p> <p>åœ¨ UserMapper.xml å¢åŠ  ResultMap æ˜ å°„å¹¶ä¿®æ”¹ <code>findAll()</code>ï¼ˆè¿™é‡Œè¿˜ä¿®æ”¹äº† User çš„ä¸»é”®ï¼Œid-&gt;user_idï¼‰ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-174-1"><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">"com.orichalcos.mapper.UserMapper"</span><span class="nt">&gt;</span>
</span><span id="__span-174-2"><a id="__codelineno-174-2" name="__codelineno-174-2" href="#__codelineno-174-2"></a>
</span><span id="__span-174-3"><a id="__codelineno-174-3" name="__codelineno-174-3" href="#__codelineno-174-3"></a><span class="w">    </span><span class="nt">&lt;cache</span><span class="w"> </span><span class="na">type=</span><span class="s">"com.orichalcos.cache.RedisCache"</span><span class="nt">/&gt;</span>
</span><span id="__span-174-4"><a id="__codelineno-174-4" name="__codelineno-174-4" href="#__codelineno-174-4"></a>
</span><span id="__span-174-5"><a id="__codelineno-174-5" name="__codelineno-174-5" href="#__codelineno-174-5"></a><span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"UserResultMap"</span><span class="w"> </span><span class="na">type=</span><span class="s">"User"</span><span class="nt">&gt;</span>
</span><span id="__span-174-6"><a id="__codelineno-174-6" name="__codelineno-174-6" href="#__codelineno-174-6"></a><span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"userId"</span><span class="w"> </span><span class="na">column=</span><span class="s">"user_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-174-7"><a id="__codelineno-174-7" name="__codelineno-174-7" href="#__codelineno-174-7"></a><span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"name"</span><span class="w"> </span><span class="na">column=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
</span><span id="__span-174-8"><a id="__codelineno-174-8" name="__codelineno-174-8" href="#__codelineno-174-8"></a><span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"age"</span><span class="w"> </span><span class="na">column=</span><span class="s">"age"</span><span class="nt">/&gt;</span>
</span><span id="__span-174-9"><a id="__codelineno-174-9" name="__codelineno-174-9" href="#__codelineno-174-9"></a><span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"bir"</span><span class="w"> </span><span class="na">column=</span><span class="s">"bir"</span><span class="nt">/&gt;</span>
</span><span id="__span-174-10"><a id="__codelineno-174-10" name="__codelineno-174-10" href="#__codelineno-174-10"></a><span class="w">        </span><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">"roles"</span><span class="w"> </span><span class="na">ofType=</span><span class="s">"Role"</span><span class="w"> </span><span class="nt">&gt;</span>
</span><span id="__span-174-11"><a id="__codelineno-174-11" name="__codelineno-174-11" href="#__codelineno-174-11"></a><span class="w">            </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"roleId"</span><span class="w"> </span><span class="na">column=</span><span class="s">"role_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-174-12"><a id="__codelineno-174-12" name="__codelineno-174-12" href="#__codelineno-174-12"></a><span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"userId"</span><span class="w"> </span><span class="na">column=</span><span class="s">"user_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-174-13"><a id="__codelineno-174-13" name="__codelineno-174-13" href="#__codelineno-174-13"></a><span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"roleName"</span><span class="w"> </span><span class="na">column=</span><span class="s">"role_name"</span><span class="nt">/&gt;</span>
</span><span id="__span-174-14"><a id="__codelineno-174-14" name="__codelineno-174-14" href="#__codelineno-174-14"></a><span class="w">        </span><span class="nt">&lt;/collection&gt;</span>
</span><span id="__span-174-15"><a id="__codelineno-174-15" name="__codelineno-174-15" href="#__codelineno-174-15"></a><span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>
</span><span id="__span-174-16"><a id="__codelineno-174-16" name="__codelineno-174-16" href="#__codelineno-174-16"></a>
</span><span id="__span-174-17"><a id="__codelineno-174-17" name="__codelineno-174-17" href="#__codelineno-174-17"></a><span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"findAll"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"UserResultMap"</span><span class="nt">&gt;</span>
</span><span id="__span-174-18"><a id="__codelineno-174-18" name="__codelineno-174-18" href="#__codelineno-174-18"></a><span class="w">        </span>select<span class="w"> </span>*
</span><span id="__span-174-19"><a id="__codelineno-174-19" name="__codelineno-174-19" href="#__codelineno-174-19"></a><span class="w">        </span>from<span class="w"> </span>t_user
</span><span id="__span-174-20"><a id="__codelineno-174-20" name="__codelineno-174-20" href="#__codelineno-174-20"></a><span class="w">                 </span>left<span class="w"> </span>join
</span><span id="__span-174-21"><a id="__codelineno-174-21" name="__codelineno-174-21" href="#__codelineno-174-21"></a><span class="w">             </span>t_role
</span><span id="__span-174-22"><a id="__codelineno-174-22" name="__codelineno-174-22" href="#__codelineno-174-22"></a><span class="w">             </span>on<span class="w"> </span>t_user.user_id<span class="w"> </span>=<span class="w"> </span>t_role.user_id;
</span><span id="__span-174-23"><a id="__codelineno-174-23" name="__codelineno-174-23" href="#__codelineno-174-23"></a><span class="w">    </span><span class="nt">&lt;/select&gt;</span>
</span><span id="__span-174-24"><a id="__codelineno-174-24" name="__codelineno-174-24" href="#__codelineno-174-24"></a><span class="nt">&lt;/mapper&gt;</span>
</span></code></pre></div> <p>åœ¨ RoleMapper.xml ä¸­å¢åŠ äº† <code>updateRole()</code>ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-175-1"><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">"updateRole"</span><span class="nt">&gt;</span>
</span><span id="__span-175-2"><a id="__codelineno-175-2" name="__codelineno-175-2" href="#__codelineno-175-2"></a><span class="w">    </span>update<span class="w"> </span>t_role
</span><span id="__span-175-3"><a id="__codelineno-175-3" name="__codelineno-175-3" href="#__codelineno-175-3"></a><span class="w">    </span>set<span class="w"> </span>role_name="user2"
</span><span id="__span-175-4"><a id="__codelineno-175-4" name="__codelineno-175-4" href="#__codelineno-175-4"></a><span class="w">    </span>where<span class="w"> </span>role_id<span class="w"> </span>=<span class="w"> </span>"1"
</span><span id="__span-175-5"><a id="__codelineno-175-5" name="__codelineno-175-5" href="#__codelineno-175-5"></a><span class="nt">&lt;/update&gt;</span>
</span></code></pre></div> <p><code>test()</code> æ”¹ä¸ºå¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-176-1"><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a><span class="nd">@Test</span>
</span><span id="__span-176-2"><a id="__codelineno-176-2" name="__codelineno-176-2" href="#__codelineno-176-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-176-3"><a id="__codelineno-176-3" name="__codelineno-176-3" href="#__codelineno-176-3"></a><span class="w">    </span><span class="n">userService</span><span class="p">.</span><span class="na">findAll</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"u = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="p">));</span>
</span><span id="__span-176-4"><a id="__codelineno-176-4" name="__codelineno-176-4" href="#__codelineno-176-4"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"================================================="</span><span class="p">);</span>
</span><span id="__span-176-5"><a id="__codelineno-176-5" name="__codelineno-176-5" href="#__codelineno-176-5"></a>
</span><span id="__span-176-6"><a id="__codelineno-176-6" name="__codelineno-176-6" href="#__codelineno-176-6"></a><span class="w">    </span><span class="n">roleService</span><span class="p">.</span><span class="na">updateRole</span><span class="p">();</span>
</span><span id="__span-176-7"><a id="__codelineno-176-7" name="__codelineno-176-7" href="#__codelineno-176-7"></a><span class="w">    </span><span class="n">userService</span><span class="p">.</span><span class="na">findAll</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"u = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="p">));</span>
</span><span id="__span-176-8"><a id="__codelineno-176-8" name="__codelineno-176-8" href="#__codelineno-176-8"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿è¡Œåå‘ç°ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210617124840634.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210617124840634.png" alt="image-20210617124840634" style></a></p> <p><code>updateRole()</code> æ‰§è¡Œåï¼Œä¼šåˆ·æ–°æ‰ com.orichalcos.mapper.RoleMapper ä¸‹çš„ç¼“å­˜ï¼Œå†æ¬¡æŸ¥è¯¢ Userï¼Œç”±äºç¼“å­˜å‘½ä¸­ä¸” com.orichalcos.mapper.UserMapper çš„ç¼“å­˜å¹¶æœªæ›´æ–°ï¼Œæ‰€ä»¥å‡ºç°äº†è¿™ç§æƒ…å†µï¼Œè§£å†³æ–¹æ³•ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-177-1"><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a><span class="cm">&lt;!--&lt;cache type="com.orichalcos.cache.RedisCache"/&gt;--&gt;</span>
</span><span id="__span-177-2"><a id="__codelineno-177-2" name="__codelineno-177-2" href="#__codelineno-177-2"></a><span class="nt">&lt;cache-ref</span><span class="w"> </span><span class="na">namespace=</span><span class="s">"com.orichalcos.mapper.UserMapper"</span><span class="nt">/&gt;</span>
</span></code></pre></div> <p>æ”¹ä¸ºå¼•ç”¨ User çš„ç¼“å­˜ï¼Œå†æ¬¡æµ‹è¯•ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20210617125449501.png" data-desc-position="bottom"><img src="!assets/Redis/image-20210617125449501.png" alt="image-20210617125449501" style></a></p> <p>ç¬¬ä¸€æ¬¡å‘½ä¸­ç¼“å­˜ï¼Œæ‰§è¡Œ <code>updateRole()</code> ååˆ é™¤äº† com.orichalcos.mapper.UserMapper ä¸‹çš„ç¼“å­˜ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡æŸ¥è¯¢äº†æ•°æ®åº“ï¼Œæ•°æ®æ­£ç¡®ï¼</p> <p><strong>å…¶ä»–çš„ä¼˜åŒ–</strong></p> <p>RedisCache.java åªæ˜¯ç®€å•å®ç°ï¼</p> <ul> <li>ç¼“å­˜ç©¿é€ï¼šå­˜å‚¨ç©ºå€¼è§£å†³</li> <li>ç¼“å­˜å‡»ç©¿ï¼šå¯ä»¥ä½¿ç”¨äº’æ–¥é”</li> <li>ç¼“å­˜é›ªå´©ï¼šç¼“å­˜æœ‰æ•ˆæœŸè®¾ç½®ä¸ºä¸€ä¸ªéšæœºèŒƒå›´</li> <li>è¯»å†™æ€§èƒ½ï¼šredis key ä¸èƒ½è¿‡é•¿ï¼Œä¼šå½±å“æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨ SHA-256 è®¡ç®—æ‘˜è¦å½“æˆ key</li> </ul> <h2 id="15redis-session-ç®¡ç†">15ã€Redis Session ç®¡ç†<a class="headerlink" href="#15redis-session-ç®¡ç†" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>Redis çš„ session ç®¡ç†æ˜¯åˆ©ç”¨ Spring æä¾›çš„ session ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå°†ä¸€ä¸ªåº”ç”¨ session äº¤ç»™ Redis å­˜å‚¨ï¼Œæ•´ä¸ªåº”ç”¨ä¸­æ‰€æœ‰ session çš„è¯·æ±‚éƒ½ä¼šå» redis ä¸­è·å–å¯¹åº”çš„ session æ•°æ®ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Redis/image-20200628201643358-1623919932602.png" data-desc-position="bottom"><img src="!assets/Redis/image-20200628201643358-1623919932602.png" alt="image-20200628201643358" style></a></p> <ol> <li> <p>å¼•å…¥ä¾èµ–ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-178-1"><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a><span class="cm">&lt;!-- https://mvnrepository.com/artifact/org.springframework.session/spring-session-data-redis --&gt;</span>
</span><span id="__span-178-2"><a id="__codelineno-178-2" name="__codelineno-178-2" href="#__codelineno-178-2"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-178-3"><a id="__codelineno-178-3" name="__codelineno-178-3" href="#__codelineno-178-3"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.springframework.session<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-178-4"><a id="__codelineno-178-4" name="__codelineno-178-4" href="#__codelineno-178-4"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>spring-session-data-redis<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-178-5"><a id="__codelineno-178-5" name="__codelineno-178-5" href="#__codelineno-178-5"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>2.5.0<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-178-6"><a id="__codelineno-178-6" name="__codelineno-178-6" href="#__codelineno-178-6"></a><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-178-7"><a id="__codelineno-178-7" name="__codelineno-178-7" href="#__codelineno-178-7"></a>
</span><span id="__span-178-8"><a id="__codelineno-178-8" name="__codelineno-178-8" href="#__codelineno-178-8"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-178-9"><a id="__codelineno-178-9" name="__codelineno-178-9" href="#__codelineno-178-9"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-178-10"><a id="__codelineno-178-10" name="__codelineno-178-10" href="#__codelineno-178-10"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-178-11"><a id="__codelineno-178-11" name="__codelineno-178-11" href="#__codelineno-178-11"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div> </li> <li> <p>æ·»åŠ  Session ç®¡ç†é…ç½®ç±»</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-179-1"><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a><span class="nd">@Configuration</span>
</span><span id="__span-179-2"><a id="__codelineno-179-2" name="__codelineno-179-2" href="#__codelineno-179-2"></a><span class="nd">@EnableRedisHttpSession</span>
</span><span id="__span-179-3"><a id="__codelineno-179-3" name="__codelineno-179-3" href="#__codelineno-179-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RedisSessionManager</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-179-4"><a id="__codelineno-179-4" name="__codelineno-179-4" href="#__codelineno-179-4"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p>æ‰“åŒ…æµ‹è¯•</p> </li> </ol> <aside class="md-source-file"> <span class="md-source-file__fact"> <span class="md-icon" title="æœ€åæ›´æ–°"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2026å¹´1æœˆ22æ—¥ 20:21:58 UTC">2026å¹´1æœˆ22æ—¥ 20:21:58</span> </span> <span class="md-source-file__fact"> <span class="md-icon" title="åˆ›å»ºæ—¥æœŸ"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2021å¹´4æœˆ26æ—¥ 11:39:30 UTC">2021å¹´4æœˆ26æ—¥ 11:39:30</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type="button" class="md-top md-icon" data-md-component="top" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> å›åˆ°é¡µé¢é¡¶éƒ¨ </button> </main> <footer class="md-footer"> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> Made with <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.top", "navigation.tracking", "navigation.instant", "navigation.path", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src="../assets/javascripts/bundle.79ae519e.min.js"></script> <script src="../_javascripts/auto_title.js"></script> <script src="../_javascripts/search_boost.js"></script>  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>