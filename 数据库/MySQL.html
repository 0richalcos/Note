
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://0richalcos.github.io/Note/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html">
      
      
        <link rel="prev" href="Dameng.html">
      
      
        <link rel="next" href="MySQLQuery.html">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>MySQL - 随便记记</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../_stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1sql" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../index.html" title="随便记记" class="md-header__button md-logo" aria-label="随便记记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            随便记记
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MySQL
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="切换深色模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换深色模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="切换亮色模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换亮色模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/0richalcos/Note" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="随便记记" class="md-nav__button md-logo" aria-label="随便记记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    随便记记
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/0richalcos/Note" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    🏠 首页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ♨️ Java
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    ♨️ Java
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/Java.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/Java8.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java 8
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/JavaBasics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java 基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/JavaCollection.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java 集合
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/JavaObject.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java 类和对象
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/JavaWeb.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JavaWeb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/%E6%B5%8B%E8%AF%95%E5%BA%8F%E5%8F%B7.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    测试序号
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    🧮 数据结构及算法
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    🧮 数据结构及算法
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E7%AE%97%E6%B3%95/Algorithm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Algorithm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E7%AE%97%E6%B3%95/DesignPattern.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DesignPattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    🍃 Spring
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    🍃 Spring
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring/Spring.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring/SpringBoot.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SpringBoot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring/SpringCloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SpringCloud
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring/SpringMVC.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SpringMVC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    💾 持久层框架
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    💾 持久层框架
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/MyBatis-Plus.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MyBatis-Plus
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/Mybatis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mybatis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    🔐 认证与授权
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    🔐 认证与授权
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/SSO.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/Sa-Token.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sa-Token
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/Shiro.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shiro
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    🌐 前端
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    🌐 前端
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/CSS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CSS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/JavaScript.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JavaScript
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/Vue.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/jQuery.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    jQuery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/Thymeleaf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thymeleaf
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    组件库
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    组件库
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/AntV-X6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AntV-X6
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/ApacheECharts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ApacheECharts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/Axios.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Axios
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/BootstrapTable.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BootstrapTable
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/DHTMLXGantt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DHTMLXGantt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/Element.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Element
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/FullCalendar.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FullCalendar
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/X-editable.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    X-editable
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    📊 数据库
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    📊 数据库
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Dameng.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dameng
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    MySQL
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="MySQL.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    MySQL
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        1、SQL 简介
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2、数据库
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2、数据库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1、什么是数据库？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22rdbms" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2、RDBMS术语
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3、安装 MySQL 数据库
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3、安装 MySQL 数据库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231windows" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3.1、Windows 安装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3.1、Windows 安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        安装数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        初始化数据库
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232ubuntu" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3.2、Ubuntu 安装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3.2、Ubuntu 安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        安装数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        初始化数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        远程访问
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        卸载数据库
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#233" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3.3、银河麒麟安装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3.3、银河麒麟安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        删除系统捆绑依赖包
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        安装数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        初始化数据库
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#234openeuler" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3.4、openEuler 安装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3.4、openEuler 安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        安装数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        初始化数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        卸载数据库
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4、创建数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.5、数据库操作
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        3、存储引擎
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3、存储引擎">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1、什么是存储引擎？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2、支持的存储引擎
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3、如何选择存储引擎？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4、修改存储引擎
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      
        4、数据表
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4、数据表">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1、创建数据表
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2、查看表结构
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3、修改数据表
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4、删除数据表
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      
        5、约束
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5、约束">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51not-null" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1、NOT NULL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52unique" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2、UNIQUE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53primary-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3、PRIMARY KEY
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54foreign-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.4、FOREIGN KEY
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55check" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5、CHECK
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56default" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.6、DEFAULT
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.7、查看表中的约束
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      
        6、增、删、改
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6、增、删、改">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1、插入数据
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2、删除数据
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3、更新数据
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      
        7、查询数据
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7、查询数据">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1、限制查询结果数和偏移
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72where" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2、WHERE 条件查询
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.2、WHERE 条件查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#721where" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2.1、WHERE的运算符
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#722like" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2.2、LIKE 子句
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#723exists" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2.3、EXISTS 运算符
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3、连接的使用
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.3、连接的使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#731inner-join" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.1、INNER JOIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#732left-join" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.2、LEFT JOIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#733right-join" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.3、RIGHT JOIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#734full-join" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.4、FULL JOIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#735cross-join" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.5、CROSS JOIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#736onwhere" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.6、ON、WHERE 的区别
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.4、排序
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.5、分组
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.5、分组">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#751rollup" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.5.1、ROLLUP
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.5.1、ROLLUP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        功能介绍
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grouping" class="md-nav__link">
    <span class="md-ellipsis">
      
        GROUPING()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#752having" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.5.2、HAVING 子句
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.6、正则表达式
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#77union" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.7、UNION
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#78null" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.8、NULL 值处理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#79withcte" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9、WITH（CTE）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.9、WITH（CTE）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#791" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9.1、公用表表达式
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#792" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9.2、递归公用表表达式
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#793" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9.3、限制公共表表达式递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#794" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9.4、递归公共表表达式示例
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.9.4、递归公共表表达式示例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        斐波那契序列生成
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        日期序列生成
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        分层数据遍历
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#795cte" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9.5、CTE 和类似结构的比较
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      
        8、视图
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      
        9、存储过程
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9、存储过程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1、存储过程的创建和调用
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2、存储过程的参数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.3、变量
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.3、变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.3.1、各种变量的介绍
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.3.2、使用变量进行累加计算
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.4、存储过程的删除
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#95" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.5、存储过程的控制语句
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.5、存储过程的控制语句">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#951" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.5.1、变量作用域
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#952" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.5.2、条件语句
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#953" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.5.3、循环语句
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#96iterate" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.6、ITERATE迭代
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      
        10、触发器
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10、触发器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.1、触发器简介
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.2、创建触发器
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.3、修改和删除触发器
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      
        11、函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11、函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.1、自定义函数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2、窗口函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.2、窗口函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1121" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.1、窗口函数的概念和语法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1122" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.2、窗口功能框架规范
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1123" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.3、窗口的命名
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1124" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.4、窗口函数介绍
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.2.4、窗口函数介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cume_dist" class="md-nav__link">
    <span class="md-ellipsis">
      
        CUME_DIST()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dense_rank" class="md-nav__link">
    <span class="md-ellipsis">
      
        DENSE_RANK()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#first_value" class="md-nav__link">
    <span class="md-ellipsis">
      
        FIRST_VALUE()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lag" class="md-nav__link">
    <span class="md-ellipsis">
      
        LAG()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#last-value" class="md-nav__link">
    <span class="md-ellipsis">
      
        LAST VALUE()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lead" class="md-nav__link">
    <span class="md-ellipsis">
      
        LEAD()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nth_value" class="md-nav__link">
    <span class="md-ellipsis">
      
        NTH_VALUE()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ntile" class="md-nav__link">
    <span class="md-ellipsis">
      
        NTILE()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#percent_rank" class="md-nav__link">
    <span class="md-ellipsis">
      
        PERCENT_RANK()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rank" class="md-nav__link">
    <span class="md-ellipsis">
      
        RANK()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#row_number" class="md-nav__link">
    <span class="md-ellipsis">
      
        ROW_NUMBER()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3、时间日期相关
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.3、时间日期相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1131" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.1、时间差
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.3.1、时间差">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#period_diff" class="md-nav__link">
    <span class="md-ellipsis">
      
        PERIOD_DIFF()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datediff" class="md-nav__link">
    <span class="md-ellipsis">
      
        DATEDIFF()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timestampdiff" class="md-nav__link">
    <span class="md-ellipsis">
      
        TIMESTAMPDIFF()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1132" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.2、当前日期
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1133" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.3、求几天前几天后
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1134" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.4、倒数第几天
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1135" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.5、提取年月日
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1136" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.6、日期转换
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.3.6、日期转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#date_format" class="md-nav__link">
    <span class="md-ellipsis">
      
        DATE_FORMAT()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#str_to_date" class="md-nav__link">
    <span class="md-ellipsis">
      
        STR_TO_DATE()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4、字符串相关
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.4、字符串相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1141" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4.1、拆分
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.4.1、拆分">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#substring" class="md-nav__link">
    <span class="md-ellipsis">
      
        SUBSTRING()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1142" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4.2、拼接
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.4.2、拼接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#concat" class="md-nav__link">
    <span class="md-ellipsis">
      
        CONCAT()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concat_ws" class="md-nav__link">
    <span class="md-ellipsis">
      
        CONCAT_WS()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group_concat" class="md-nav__link">
    <span class="md-ellipsis">
      
        GROUP_CONCAT()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1143" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4.3、字符串转数字
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.4.3、字符串转数字">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cast" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAST()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert" class="md-nav__link">
    <span class="md-ellipsis">
      
        CONVERT()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1144" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4.4、填充
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.5、数字相关
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.5、数字相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1151" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.5.1、保留两位小数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      
        12、事务
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12、事务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121acid" class="md-nav__link">
    <span class="md-ellipsis">
      
        12.1、事务的四大特性（ACID）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122" class="md-nav__link">
    <span class="md-ellipsis">
      
        12.2、事务的隔离级别
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    <span class="md-ellipsis">
      
        13、索引
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    <span class="md-ellipsis">
      
        14、临时表
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15" class="md-nav__link">
    <span class="md-ellipsis">
      
        15、备份
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15、备份">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#151" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1、数据库备份
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.1、数据库备份">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1511mysqldump" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.1、mysqldump
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#152" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.2、自动备份
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#153" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.3、数据恢复
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.3、数据恢复">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1531ibd" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.3.1、.ibd 文件恢复
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#17jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        17、JDBC
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="17、JDBC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#171jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.1、JDBC 简介
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="17.1、JDBC 简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1811drivermanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.1、DriverManager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1812connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.2、Connection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1813statement" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.3、Statement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1814resultset" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.4、ResultSet
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#172jdbc-crud" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.2、JDBC 进行 CRUD
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#173jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.3、JDBC 处理大数据
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#174jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.4、JDBC 事务控制管理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#175jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.5、JDBC 连接报错
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#18" class="md-nav__link">
    <span class="md-ellipsis">
      
        18、服务管理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18、服务管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#181sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1、SQL 模式
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.1、SQL 模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1811-sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.1、设置 SQL 模式
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1812sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.2、SQL 模式列表
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.1.2、SQL 模式列表">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no_zero_date" class="md-nav__link">
    <span class="md-ellipsis">
      
        NO_ZERO_DATE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no_zero_in_date" class="md-nav__link">
    <span class="md-ellipsis">
      
        NO_ZERO_IN_DATE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#only_full_group_by" class="md-nav__link">
    <span class="md-ellipsis">
      
        ONLY_FULL_GROUP_BY
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pad_char_to_full_length" class="md-nav__link">
    <span class="md-ellipsis">
      
        PAD_CHAR_TO_FULL_LENGTH
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipes_as_concat" class="md-nav__link">
    <span class="md-ellipsis">
      
        PIPES_AS_CONCAT
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real_as_float" class="md-nav__link">
    <span class="md-ellipsis">
      
        REAL_AS_FLOAT
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time_truncate_fractional" class="md-nav__link">
    <span class="md-ellipsis">
      
        TIME_TRUNCATE_FRACTIONAL
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1813-sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.3、组合 SQL 模式
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#182" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2、集群
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.2、集群">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1821" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2.1、主从复制
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.2.1、主从复制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        搭建主从复制
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        测试主从复制
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        可能出现的问题
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#183" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.3、配置不区分大小写
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="MySQLQuery.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MySQLQuery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="OceanBase.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OceanBase
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Oracle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Oracle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Redis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Vastbase.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vastbase
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/Elasticsearch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elasticsearch
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    📇 分布式存储
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    📇 分布式存储
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/FastDFS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FastDFS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/MinIO.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MinIO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    🛰️ 网络通信
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    🛰️ 网络通信
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/Encryption.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Encryption
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/HTTP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HTTP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/OpenVPN.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OpenVPN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/VNC.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VNC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/WebSocket.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WebSocket
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/frp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    frp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    🗃️ 文件处理
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    🗃️ 文件处理
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_1" >
        
          
          <label class="md-nav__link" for="__nav_12_1" id="__nav_12_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Office
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Office
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/ApachePOI.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ApachePOI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/EasyExcel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EasyExcel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/OnlyOffice.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OnlyOffice
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/Poi-tl.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Poi-tl
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/Spire.OfficeForJava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spire.OfficeForJava
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/PDF/ApachePDFBox.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ApachePDFBox
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/XML/XMLParse.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    XMLParse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/ZIP/Zip4j.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Zip4j
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/XXL-JOB.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    XXL-JOB
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    🧑‍🔧 运维
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    🧑‍🔧 运维
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/Docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/Linux.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/NSSM.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NSSM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/Nginx.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nginx
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/Tomcat.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tomcat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/TongWeb.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TongWeb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/WSL.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WSL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/WebLogic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WebLogic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    🛠️ 开发工具
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    🛠️ 开发工具
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Git.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Git
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Maven.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Maven
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Node.js.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Node.js
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Swagger.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Swagger
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    👻 其他
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    👻 其他
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%85%B6%E4%BB%96/Settings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Settings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%85%B6%E4%BB%96/Solutions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Solutions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%85%B6%E4%BB%96/Weasel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weasel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        1、SQL 简介
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2、数据库
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2、数据库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1、什么是数据库？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22rdbms" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2、RDBMS术语
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3、安装 MySQL 数据库
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3、安装 MySQL 数据库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231windows" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3.1、Windows 安装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3.1、Windows 安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        安装数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        初始化数据库
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232ubuntu" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3.2、Ubuntu 安装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3.2、Ubuntu 安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        安装数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        初始化数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        远程访问
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        卸载数据库
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#233" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3.3、银河麒麟安装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3.3、银河麒麟安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        删除系统捆绑依赖包
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        安装数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        初始化数据库
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#234openeuler" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3.4、openEuler 安装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3.4、openEuler 安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        安装数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        初始化数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        卸载数据库
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4、创建数据库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.5、数据库操作
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        3、存储引擎
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3、存储引擎">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1、什么是存储引擎？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2、支持的存储引擎
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3、如何选择存储引擎？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4、修改存储引擎
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      
        4、数据表
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4、数据表">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1、创建数据表
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2、查看表结构
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3、修改数据表
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4、删除数据表
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      
        5、约束
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5、约束">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51not-null" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1、NOT NULL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52unique" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2、UNIQUE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53primary-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3、PRIMARY KEY
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54foreign-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.4、FOREIGN KEY
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55check" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5、CHECK
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56default" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.6、DEFAULT
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.7、查看表中的约束
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      
        6、增、删、改
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6、增、删、改">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1、插入数据
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2、删除数据
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3、更新数据
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      
        7、查询数据
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7、查询数据">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1、限制查询结果数和偏移
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72where" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2、WHERE 条件查询
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.2、WHERE 条件查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#721where" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2.1、WHERE的运算符
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#722like" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2.2、LIKE 子句
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#723exists" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2.3、EXISTS 运算符
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3、连接的使用
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.3、连接的使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#731inner-join" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.1、INNER JOIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#732left-join" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.2、LEFT JOIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#733right-join" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.3、RIGHT JOIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#734full-join" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.4、FULL JOIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#735cross-join" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.5、CROSS JOIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#736onwhere" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3.6、ON、WHERE 的区别
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.4、排序
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.5、分组
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.5、分组">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#751rollup" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.5.1、ROLLUP
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.5.1、ROLLUP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        功能介绍
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grouping" class="md-nav__link">
    <span class="md-ellipsis">
      
        GROUPING()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#752having" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.5.2、HAVING 子句
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.6、正则表达式
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#77union" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.7、UNION
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#78null" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.8、NULL 值处理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#79withcte" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9、WITH（CTE）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.9、WITH（CTE）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#791" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9.1、公用表表达式
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#792" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9.2、递归公用表表达式
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#793" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9.3、限制公共表表达式递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#794" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9.4、递归公共表表达式示例
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.9.4、递归公共表表达式示例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        斐波那契序列生成
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        日期序列生成
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        分层数据遍历
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#795cte" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9.5、CTE 和类似结构的比较
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      
        8、视图
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      
        9、存储过程
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9、存储过程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1、存储过程的创建和调用
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2、存储过程的参数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.3、变量
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.3、变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.3.1、各种变量的介绍
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.3.2、使用变量进行累加计算
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.4、存储过程的删除
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#95" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.5、存储过程的控制语句
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.5、存储过程的控制语句">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#951" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.5.1、变量作用域
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#952" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.5.2、条件语句
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#953" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.5.3、循环语句
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#96iterate" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.6、ITERATE迭代
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      
        10、触发器
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10、触发器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.1、触发器简介
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.2、创建触发器
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.3、修改和删除触发器
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      
        11、函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11、函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.1、自定义函数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2、窗口函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.2、窗口函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1121" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.1、窗口函数的概念和语法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1122" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.2、窗口功能框架规范
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1123" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.3、窗口的命名
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1124" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.4、窗口函数介绍
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.2.4、窗口函数介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cume_dist" class="md-nav__link">
    <span class="md-ellipsis">
      
        CUME_DIST()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dense_rank" class="md-nav__link">
    <span class="md-ellipsis">
      
        DENSE_RANK()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#first_value" class="md-nav__link">
    <span class="md-ellipsis">
      
        FIRST_VALUE()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lag" class="md-nav__link">
    <span class="md-ellipsis">
      
        LAG()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#last-value" class="md-nav__link">
    <span class="md-ellipsis">
      
        LAST VALUE()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lead" class="md-nav__link">
    <span class="md-ellipsis">
      
        LEAD()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nth_value" class="md-nav__link">
    <span class="md-ellipsis">
      
        NTH_VALUE()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ntile" class="md-nav__link">
    <span class="md-ellipsis">
      
        NTILE()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#percent_rank" class="md-nav__link">
    <span class="md-ellipsis">
      
        PERCENT_RANK()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rank" class="md-nav__link">
    <span class="md-ellipsis">
      
        RANK()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#row_number" class="md-nav__link">
    <span class="md-ellipsis">
      
        ROW_NUMBER()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3、时间日期相关
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.3、时间日期相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1131" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.1、时间差
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.3.1、时间差">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#period_diff" class="md-nav__link">
    <span class="md-ellipsis">
      
        PERIOD_DIFF()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datediff" class="md-nav__link">
    <span class="md-ellipsis">
      
        DATEDIFF()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timestampdiff" class="md-nav__link">
    <span class="md-ellipsis">
      
        TIMESTAMPDIFF()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1132" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.2、当前日期
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1133" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.3、求几天前几天后
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1134" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.4、倒数第几天
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1135" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.5、提取年月日
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1136" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.6、日期转换
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.3.6、日期转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#date_format" class="md-nav__link">
    <span class="md-ellipsis">
      
        DATE_FORMAT()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#str_to_date" class="md-nav__link">
    <span class="md-ellipsis">
      
        STR_TO_DATE()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4、字符串相关
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.4、字符串相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1141" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4.1、拆分
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.4.1、拆分">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#substring" class="md-nav__link">
    <span class="md-ellipsis">
      
        SUBSTRING()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1142" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4.2、拼接
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.4.2、拼接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#concat" class="md-nav__link">
    <span class="md-ellipsis">
      
        CONCAT()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concat_ws" class="md-nav__link">
    <span class="md-ellipsis">
      
        CONCAT_WS()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group_concat" class="md-nav__link">
    <span class="md-ellipsis">
      
        GROUP_CONCAT()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1143" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4.3、字符串转数字
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.4.3、字符串转数字">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cast" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAST()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert" class="md-nav__link">
    <span class="md-ellipsis">
      
        CONVERT()
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1144" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4.4、填充
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.5、数字相关
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.5、数字相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1151" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.5.1、保留两位小数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      
        12、事务
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12、事务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121acid" class="md-nav__link">
    <span class="md-ellipsis">
      
        12.1、事务的四大特性（ACID）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122" class="md-nav__link">
    <span class="md-ellipsis">
      
        12.2、事务的隔离级别
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    <span class="md-ellipsis">
      
        13、索引
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    <span class="md-ellipsis">
      
        14、临时表
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15" class="md-nav__link">
    <span class="md-ellipsis">
      
        15、备份
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15、备份">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#151" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1、数据库备份
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.1、数据库备份">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1511mysqldump" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.1、mysqldump
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#152" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.2、自动备份
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#153" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.3、数据恢复
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.3、数据恢复">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1531ibd" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.3.1、.ibd 文件恢复
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#17jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        17、JDBC
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="17、JDBC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#171jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.1、JDBC 简介
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="17.1、JDBC 简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1811drivermanager" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.1、DriverManager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1812connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.2、Connection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1813statement" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.3、Statement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1814resultset" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.4、ResultSet
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#172jdbc-crud" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.2、JDBC 进行 CRUD
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#173jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.3、JDBC 处理大数据
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#174jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.4、JDBC 事务控制管理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#175jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.5、JDBC 连接报错
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#18" class="md-nav__link">
    <span class="md-ellipsis">
      
        18、服务管理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18、服务管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#181sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1、SQL 模式
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.1、SQL 模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1811-sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.1、设置 SQL 模式
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1812sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.2、SQL 模式列表
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.1.2、SQL 模式列表">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no_zero_date" class="md-nav__link">
    <span class="md-ellipsis">
      
        NO_ZERO_DATE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no_zero_in_date" class="md-nav__link">
    <span class="md-ellipsis">
      
        NO_ZERO_IN_DATE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#only_full_group_by" class="md-nav__link">
    <span class="md-ellipsis">
      
        ONLY_FULL_GROUP_BY
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pad_char_to_full_length" class="md-nav__link">
    <span class="md-ellipsis">
      
        PAD_CHAR_TO_FULL_LENGTH
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipes_as_concat" class="md-nav__link">
    <span class="md-ellipsis">
      
        PIPES_AS_CONCAT
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real_as_float" class="md-nav__link">
    <span class="md-ellipsis">
      
        REAL_AS_FLOAT
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time_truncate_fractional" class="md-nav__link">
    <span class="md-ellipsis">
      
        TIME_TRUNCATE_FRACTIONAL
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1813-sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.3、组合 SQL 模式
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#182" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2、集群
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.2、集群">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1821" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2.1、主从复制
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.2.1、主从复制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        搭建主从复制
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        测试主从复制
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        可能出现的问题
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#183" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.3、配置不区分大小写
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="mysql">MySQL<a class="headerlink" href="#mysql" title="Permanent link">&para;</a></h1>
<h2 id="1sql">1、SQL 简介<a class="headerlink" href="#1sql" title="Permanent link">&para;</a></h2>
<p>SQL 是用于访问和处理数据库的标准计算机语言。</p>
<p><strong>SQL 是什么？</strong></p>
<ul>
<li>SQL，指结构化查询语言，全称是 Structured Query Language</li>
<li>SQL 可以让我们访问和处理数据库</li>
<li>SQL 是一种 ANSI（American National Standards Institute）标准的计算机语言</li>
</ul>
<p><strong>SQL 能做什么？</strong></p>
<ul>
<li>SQL 面向数据库执行查询</li>
<li>SQL 可从数据库取回数据</li>
<li>SQL 可在数据库中插入新的记录</li>
<li>SQL 可更新数据库中的数据</li>
<li>SQL 可从数据库删除记录</li>
<li>SQL 可创建新的数据库</li>
<li>SQL 可在数据库中创建新表</li>
<li>SQL 可在数据库中创建存储过程</li>
<li>SQL 可在数据库中创建视图</li>
<li>SQL 可以设置表、存储过程和视图的权限</li>
</ul>
<p><strong>SQL 分类</strong></p>
<ul>
<li><strong>DDL（数据定义语言）</strong><ul>
<li>数据定义语言（Data Definition Language）</li>
<li>用来定义数据库的对象，如数据表、视图、索引等</li>
<li><code>CREATFE</code>、<code>DROP</code>、<code>ALTER</code></li>
</ul>
</li>
<li><strong>DML（数据操纵语言）</strong><ul>
<li>数据处理语言（Data Manipulation Language）</li>
<li>在数据库中更新，增加和删除记录</li>
<li><code>UPDATE</code>、<code>DELETE</code>、<code>INSERT</code></li>
</ul>
</li>
<li><strong>DCL（数据控制语言）</strong><ul>
<li>数据控制语言（Data Control Language）</li>
<li>指用于设置用户权限和控制事务语句</li>
</ul>
</li>
<li><strong>DQL（数据查询语言）</strong><ul>
<li>数据查询语言（Data Query Language）</li>
<li><code>SELECT</code></li>
</ul>
</li>
</ul>
<h2 id="2">2、数据库<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<p>MySQL 是最流行的关系型数据库管理系统，在 Web 应用方面 MySQL 是最好的 RDBMS（Relational Database Management System：关系数据库管理系统）应用软件之一。</p>
<h3 id="21">2.1、什么是数据库？<a class="headerlink" href="#21" title="Permanent link">&para;</a></h3>
<p>数据库（Database）是按照数据结构来组织、存储和管理数据的仓库。</p>
<p>每个数据库都有一个或多个不同的 API 用于创建，访问，管理，搜索和复制所保存的数据。</p>
<p>我们也可以将数据存储在文件中，但是在文件中读写数据速度相对较慢。</p>
<p>所以，现在我们使用关系型数据库管理系统（RDBMS）来存储和管理的大数据量。所谓的关系型数据库，是建立在关系模型基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据。</p>
<p>RDBMS 即关系数据库管理系统（Relational Database Management System）的特点：</p>
<ul>
<li>数据以表的的形式出现</li>
<li>每行为各种记录名称</li>
<li>每列为记录名称所对应的数据域</li>
<li>许多的行和列组成一张表单</li>
<li>若干的表单组成 Database</li>
</ul>
<h3 id="22rdbms">2.2、RDBMS术语<a class="headerlink" href="#22rdbms" title="Permanent link">&para;</a></h3>
<ul>
<li>数据库：数据库是一些关联表的集合</li>
<li>数据表：表是数据库的矩阵。在一个数据库中的表看起来像一个简单的电子表格</li>
<li>列：一列（数据元素）包含了相同类型的数据，例如邮政编码的数据</li>
<li>行：一行（=元组，或记录）是一组相关的数据，例如一条用户订阅的数据</li>
<li>冗余：存储两倍数据，冗余降低了性能，但提高了数据的安全性</li>
<li>主键：主键是唯一的。一个数据表中只能包含一个主键。你可以使用主键来查询数据</li>
<li>外键：外键用于关联两个表</li>
<li>复合键：复合键（组合键）将多个列作为一个索引建，一般用于复合索引</li>
<li>索引：使用索引可快速访问数据库表中的特定信息。索引是数据库表中一列或多列的值进行排序的一种结构。类似于书籍的目录</li>
<li>参照完整性：参照的完整性要求关系中不允许引用不存在的实体。与实体完整性是关系模型必须满足的完整性约束条件，目的是保证数据的一致性</li>
</ul>
<p>MySQL 为关系型数据库（Relational Database Management System），这种所谓的 “关系型” 可以理解为 “表格” 的概念，一个关系型数据库由一个或数个表格组成，如下图所示的一个表格：</p>
<p><img src="!assets/MySQL/image-20200528004923567.png" alt="image-20200528004923567" style="zoom:80%;" /></p>
<ul>
<li>表头（header）：每一列的名称</li>
<li>列（col）：具有相同数据类型的数据的集合</li>
<li>行（row）：每一行用来描述某条记录的具体信息</li>
<li>值（VALUE）：行的具体信息，每个值必须与该列的数据类型相同</li>
<li>键（KEY）：键的值在当前列具有唯一性</li>
</ul>
<h3 id="23-mysql">2.3、安装 MySQL 数据库<a class="headerlink" href="#23-mysql" title="Permanent link">&para;</a></h3>
<p>Windows 系统选择 msi 文件直接安装比较方便；Linux 系统如果使用 tar 文件离线解压安装，解压后会出现很多 rpm 安装包，以下为常用安装包：</p>
<table>
<thead>
<tr>
<th>文件名</th>
<th>说明</th>
<th>是否需要</th>
</tr>
</thead>
<tbody>
<tr>
<td>mysql-community-common.rpm</td>
<td>提供 MySQL 所有组件通用的配置文件和数据文件<br/>（比如字符集、帮助文件等）。</td>
<td>✅ 必须</td>
</tr>
<tr>
<td>mysql-community-libs.rpm</td>
<td>MySQL 客户端程序依赖的共享库（libmysqlclient）。</td>
<td>✅ 必须</td>
</tr>
<tr>
<td>mysql-community-client.rpm</td>
<td>提供 <code>mysql</code> 命令行客户端工具。</td>
<td>✅ 必须</td>
</tr>
<tr>
<td>mysql-community-server.rpm</td>
<td>MySQL 服务器端程序，含 <code>mysqld</code>。</td>
<td>✅ 必须（要运行服务）</td>
</tr>
<tr>
<td>mysql-community-client-plugins.rpm</td>
<td>提供客户端插件，比如 caching_sha2_password 等。</td>
<td>⚠️ 可选，推荐装</td>
</tr>
<tr>
<td>mysql-community-icu-data-files.rpm</td>
<td>ICU 数据，支持排序/字符集等国际化功能。</td>
<td>⚠️ 可选</td>
</tr>
<tr>
<td>mysql-community-devel.rpm</td>
<td>包含头文件、开发库，给编译程序用<br/>（比如编译 PHP 的 MySQL 扩展）。</td>
<td>❌ 非必须（除非你开发）</td>
</tr>
</tbody>
</table>
<h4 id="231windows">2.3.1、Windows 安装<a class="headerlink" href="#231windows" title="Permanent link">&para;</a></h4>
<p>系统版本为 Windows 11，架构为 X86_64，使用 msi 安装包离线安装。</p>
<h5 id="_1">安装数据库<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>先下载 <a href="https://dev.mysql.com/downloads/mysql/">MySQL</a>，现在的版本是 8.0.27：</p>
<p><img src="!assets/MySQL/image-20211115115209195.png" alt="image-20211115115209195" style="zoom: 67%;" /></p>
<p>这里下载的是 Zip 安装包版，可以点击 【Go to Download Page】，去载 MSI 安装版（这里下载的是安装版）：</p>
<p><img src="!assets/MySQL/image-20211115115812248.png" alt="image-20211115115812248" style="zoom: 67%;" /></p>
</li>
<li>
<p>下载后打开文件开始安装，这里选择自定义安装：</p>
<p><img src="!assets/MySQL/image-20211115141345534.png" alt="image-20211115141345534" style="zoom: 80%;" /></p>
</li>
<li>
<p>这里选择只安装基础的 MySQL 服务和 JDBC，并且勾选下面的选项：</p>
<p><img src="!assets/MySQL/image-20211115141638695.png" alt="image-20211115141638695" style="zoom: 80%;" /></p>
</li>
<li>
<p>点击 MySQL Server，下方会出现 Advanced Options（高级选项），点击高级选项，盘它！（这里是第二次装发现的，所以版本不一样）：</p>
<p><img src="!assets/MySQL/image-20220320164455188.png" alt="image-20220320164455188" style="zoom: 50%;" /></p>
</li>
<li>
<p>这里可以更改安装地址，我建议改一下数据存储地址，防止数据太多占用 C 盘空间，然后点 OK 和 Next：</p>
<p><img src="!assets/MySQL/image-20220320164751257.png" alt="image-20220320164751257" style="zoom: 50%;" /></p>
</li>
<li>
<p>取消了文档：</p>
<p><img src="!assets/MySQL/image-20211115141735403.png" alt="image-20211115141735403" style="zoom: 80%;" /></p>
</li>
<li>
<p>开始安装：</p>
<p><img src="!assets/MySQL/image-20211115141804300.png" alt="image-20211115141804300" style="zoom: 80%;" /></p>
</li>
</ol>
<h5 id="_2">初始化数据库<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>开始配置：</p>
<p><img src="!assets/MySQL/image-20211115141841846.png" alt="image-20211115141841846" style="zoom: 80%;" /></p>
</li>
<li>
<p>选择开发电脑：</p>
<p><img src="!assets/MySQL/image-20211115142116388.png" alt="image-20211115142116388" style="zoom: 80%;" /></p>
</li>
<li>
<p>这里使用默认的加密加密方法：</p>
<p><img src="!assets/MySQL/image-20211115142310317.png" alt="image-20211115142310317" style="zoom: 80%;" /></p>
</li>
<li>
<p>填写数据库密码：</p>
<p><img src="!assets/MySQL/image-20211115142333702.png" alt="image-20211115142333702" style="zoom: 80%;" /></p>
</li>
<li>
<p>取消开机自启：</p>
<p><img src="!assets/MySQL/image-20211115142440712.png" alt="image-20211115142440712" style="zoom: 80%;" /></p>
</li>
<li>
<p>应用配置：</p>
<p><img src="!assets/MySQL/image-20211115142501957.png" alt="image-20211115142501957" style="zoom: 80%;" /></p>
</li>
<li>
<p>配置环境变量：</p>
<p><img src="!assets/MySQL/image-20211115142610319.png" alt="image-20211115142610319" style="zoom: 67%;" /></p>
<p><img src="!assets/MySQL/image-20211115142647651.png" alt="image-20211115142647651" style="zoom: 80%;" /></p>
</li>
<li>
<p>访问：</p>
<div class="highlight"><pre><span></span><code>PS<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\O</span>richalcos&gt;<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p
Enter<span class="w"> </span>password:<span class="w"> </span>****
Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>MySQL<span class="w"> </span>monitor.<span class="w">  </span>Commands<span class="w"> </span>end<span class="w"> </span>with<span class="w"> </span><span class="p">;</span><span class="w"> </span>or<span class="w"> </span><span class="se">\g</span>.
Your<span class="w"> </span>MySQL<span class="w"> </span>connection<span class="w"> </span>id<span class="w"> </span>is<span class="w"> </span><span class="m">11</span>
Server<span class="w"> </span>version:<span class="w"> </span><span class="m">8</span>.0.27<span class="w"> </span>MySQL<span class="w"> </span>Community<span class="w"> </span>Server<span class="w"> </span>-<span class="w"> </span>GPL

Copyright<span class="w"> </span><span class="o">(</span>c<span class="o">)</span><span class="w"> </span><span class="m">2000</span>,<span class="w"> </span><span class="m">2021</span>,<span class="w"> </span>Oracle<span class="w"> </span>and/or<span class="w"> </span>its<span class="w"> </span>affiliates.

Oracle<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>registered<span class="w"> </span>trademark<span class="w"> </span>of<span class="w"> </span>Oracle<span class="w"> </span>Corporation<span class="w"> </span>and/or<span class="w"> </span>its
affiliates.<span class="w"> </span>Other<span class="w"> </span>names<span class="w"> </span>may<span class="w"> </span>be<span class="w"> </span>trademarks<span class="w"> </span>of<span class="w"> </span>their<span class="w"> </span>respective
owners.

Type<span class="w"> </span><span class="s1">&#39;help;&#39;</span><span class="w"> </span>or<span class="w"> </span><span class="s1">&#39;\h&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>help.<span class="w"> </span>Type<span class="w"> </span><span class="s1">&#39;\c&#39;</span><span class="w"> </span>to<span class="w"> </span>clear<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>input<span class="w"> </span>statement.

mysql&gt;
</code></pre></div>
</li>
</ol>
<h4 id="232ubuntu">2.3.2、Ubuntu 安装<a class="headerlink" href="#232ubuntu" title="Permanent link">&para;</a></h4>
<p>系统版本为 Ubuntu 20.04，架构为 X86_64，使用 <code>apt</code> 在线安装。</p>
<h5 id="_3">安装数据库<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>查看有没有安装 MySQL：</p>
<div class="highlight"><pre><span></span><code>dpkg<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mysql
</code></pre></div>
</li>
<li>
<p>安装MySQL：</p>
<div class="highlight"><pre><span></span><code>apt<span class="w"> </span>install<span class="w"> </span>mysql-server
</code></pre></div>
</li>
<li>
<p>安装完成之后可以使用如下命令来检查是否安装成功：</p>
<div class="highlight"><pre><span></span><code>netstat<span class="w"> </span>-tap<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mysql
</code></pre></div>
<p>通过上述命令检查之后，如果看到有 mysql 的 socket 处于 LISTEN 状态则表示安装成功</p>
</li>
<li>
<p>登录 mysql 数据库可以通过如下命令：</p>
<div class="highlight"><pre><span></span><code>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p
</code></pre></div>
<p>现在是 mysql 数据库是没有密码的，Enter password: 处直接回车，就能够进入 mysql 数据库。</p>
</li>
</ol>
<h5 id="_4">初始化数据库<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h5>
<p>接下来，为了确保数据库的安全性和正常运转，对数据库进行初始化操作。这个初始化操作涉及下面5个步骤：</p>
<ol>
<li>安装验证密码插件。</li>
<li>设置 root 管理员在数据库中的专有密码。</li>
<li>随后删除匿名账户，并使用 root 管理员从远程登录数据库，以确保数据库上运行的业务的安全性。</li>
<li>删除默认的测试数据库，取消测试数据库的一系列访问权限。</li>
<li>刷新授权列表，让初始化的设定立即生效。</li>
</ol>
<p>输入<code>mysql_secure_installation</code>开始：</p>
<div class="highlight"><pre><span></span><code>Securing<span class="w"> </span>the<span class="w"> </span>MySQL<span class="w"> </span>server<span class="w"> </span>deployment.

Connecting<span class="w"> </span>to<span class="w"> </span>MySQL<span class="w"> </span>using<span class="w"> </span>a<span class="w"> </span>blank<span class="w"> </span>password.

VALIDATE<span class="w"> </span>PASSWORD<span class="w"> </span>COMPONENT<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span>to<span class="w"> </span><span class="nb">test</span><span class="w"> </span>passwords
and<span class="w"> </span>improve<span class="w"> </span>security.<span class="w"> </span>It<span class="w"> </span>checks<span class="w"> </span>the<span class="w"> </span>strength<span class="w"> </span>of<span class="w"> </span>password
and<span class="w"> </span>allows<span class="w"> </span>the<span class="w"> </span>users<span class="w"> </span>to<span class="w"> </span><span class="nb">set</span><span class="w"> </span>only<span class="w"> </span>those<span class="w"> </span>passwords<span class="w"> </span>which<span class="w"> </span>are
secure<span class="w"> </span>enough.<span class="w"> </span>Would<span class="w"> </span>you<span class="w"> </span>like<span class="w"> </span>to<span class="w"> </span>setup<span class="w"> </span>VALIDATE<span class="w"> </span>PASSWORD<span class="w"> </span>component?<span class="w"> </span><span class="c1">#要安装验证密码插件吗？</span>

Press<span class="w"> </span>y<span class="p">|</span>Y<span class="w"> </span><span class="k">for</span><span class="w"> </span>Yes,<span class="w"> </span>any<span class="w"> </span>other<span class="w"> </span>key<span class="w"> </span><span class="k">for</span><span class="w"> </span>No:<span class="w"> </span>N<span class="w"> </span><span class="c1">#我选了N</span>
Please<span class="w"> </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>password<span class="w"> </span><span class="k">for</span><span class="w"> </span>root<span class="w"> </span>here.

New<span class="w"> </span>password:<span class="w"> </span><span class="c1">#输入root密码</span>

Re-enter<span class="w"> </span>new<span class="w"> </span>password:<span class="w"> </span><span class="c1">#再次输入</span>
By<span class="w"> </span>default,<span class="w"> </span>a<span class="w"> </span>MySQL<span class="w"> </span>installation<span class="w"> </span>has<span class="w"> </span>an<span class="w"> </span>anonymous<span class="w"> </span>user,
allowing<span class="w"> </span>anyone<span class="w"> </span>to<span class="w"> </span>log<span class="w"> </span>into<span class="w"> </span>MySQL<span class="w"> </span>without<span class="w"> </span>having<span class="w"> </span>to<span class="w"> </span>have
a<span class="w"> </span>user<span class="w"> </span>account<span class="w"> </span>created<span class="w"> </span><span class="k">for</span><span class="w"> </span>them.<span class="w"> </span>This<span class="w"> </span>is<span class="w"> </span>intended<span class="w"> </span>only<span class="w"> </span><span class="k">for</span>
testing,<span class="w"> </span>and<span class="w"> </span>to<span class="w"> </span>make<span class="w"> </span>the<span class="w"> </span>installation<span class="w"> </span>go<span class="w"> </span>a<span class="w"> </span>bit<span class="w"> </span>smoother.
You<span class="w"> </span>should<span class="w"> </span>remove<span class="w"> </span>them<span class="w"> </span>before<span class="w"> </span>moving<span class="w"> </span>into<span class="w"> </span>a<span class="w"> </span>production
environment.

Remove<span class="w"> </span>anonymous<span class="w"> </span>users?<span class="w"> </span><span class="o">(</span>Press<span class="w"> </span>y<span class="p">|</span>Y<span class="w"> </span><span class="k">for</span><span class="w"> </span>Yes,<span class="w"> </span>any<span class="w"> </span>other<span class="w"> </span>key<span class="w"> </span><span class="k">for</span><span class="w"> </span>No<span class="o">)</span><span class="w"> </span>:<span class="w"> </span>y<span class="w"> </span><span class="c1">#是否删除匿名用户</span>
Success.


Normally,<span class="w"> </span>root<span class="w"> </span>should<span class="w"> </span>only<span class="w"> </span>be<span class="w"> </span>allowed<span class="w"> </span>to<span class="w"> </span>connect<span class="w"> </span>from
<span class="s1">&#39;localhost&#39;</span>.<span class="w"> </span>This<span class="w"> </span>ensures<span class="w"> </span>that<span class="w"> </span>someone<span class="w"> </span>cannot<span class="w"> </span>guess<span class="w"> </span>at
the<span class="w"> </span>root<span class="w"> </span>password<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>network.

Disallow<span class="w"> </span>root<span class="w"> </span>login<span class="w"> </span>remotely?<span class="w"> </span><span class="o">(</span>Press<span class="w"> </span>y<span class="p">|</span>Y<span class="w"> </span><span class="k">for</span><span class="w"> </span>Yes,<span class="w"> </span>any<span class="w"> </span>other<span class="w"> </span>key<span class="w"> </span><span class="k">for</span><span class="w"> </span>No<span class="o">)</span><span class="w"> </span>:<span class="w"> </span>n<span class="w"> </span><span class="c1"># 是否禁止root管理员从远程登录</span>

<span class="w"> </span>...<span class="w"> </span>skipping.
By<span class="w"> </span>default,<span class="w"> </span>MySQL<span class="w"> </span>comes<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>database<span class="w"> </span>named<span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="w"> </span>that
anyone<span class="w"> </span>can<span class="w"> </span>access.<span class="w"> </span>This<span class="w"> </span>is<span class="w"> </span>also<span class="w"> </span>intended<span class="w"> </span>only<span class="w"> </span><span class="k">for</span><span class="w"> </span>testing,
and<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>removed<span class="w"> </span>before<span class="w"> </span>moving<span class="w"> </span>into<span class="w"> </span>a<span class="w"> </span>production
environment.


Remove<span class="w"> </span><span class="nb">test</span><span class="w"> </span>database<span class="w"> </span>and<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>it?<span class="w"> </span><span class="o">(</span>Press<span class="w"> </span>y<span class="p">|</span>Y<span class="w"> </span><span class="k">for</span><span class="w"> </span>Yes,<span class="w"> </span>any<span class="w"> </span>other<span class="w"> </span>key<span class="w"> </span><span class="k">for</span><span class="w"> </span>No<span class="o">)</span><span class="w"> </span>:<span class="w"> </span>y<span class="w"> </span><span class="c1">#是否删除test数据库并取消它的访问权限</span>
<span class="w"> </span>-<span class="w"> </span>Dropping<span class="w"> </span><span class="nb">test</span><span class="w"> </span>database...
Success.

<span class="w"> </span>-<span class="w"> </span>Removing<span class="w"> </span>privileges<span class="w"> </span>on<span class="w"> </span><span class="nb">test</span><span class="w"> </span>database...
Success.

Reloading<span class="w"> </span>the<span class="w"> </span>privilege<span class="w"> </span>tables<span class="w"> </span>will<span class="w"> </span>ensure<span class="w"> </span>that<span class="w"> </span>all<span class="w"> </span>changes
made<span class="w"> </span>so<span class="w"> </span>far<span class="w"> </span>will<span class="w"> </span>take<span class="w"> </span>effect<span class="w"> </span>immediately.

Reload<span class="w"> </span>privilege<span class="w"> </span>tables<span class="w"> </span>now?<span class="w"> </span><span class="o">(</span>Press<span class="w"> </span>y<span class="p">|</span>Y<span class="w"> </span><span class="k">for</span><span class="w"> </span>Yes,<span class="w"> </span>any<span class="w"> </span>other<span class="w"> </span>key<span class="w"> </span><span class="k">for</span><span class="w"> </span>No<span class="o">)</span><span class="w"> </span>:<span class="w"> </span>y<span class="w"> </span><span class="c1"># 是否刷新授权表，让初始化后的设定立即生效</span>
Success.

All<span class="w"> </span><span class="k">done</span>!
</code></pre></div>
<h5 id="_5">远程访问<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h5>
<p>控制台连接 MySQL：</p>
<div class="highlight"><pre><span></span><code>mysql&gt;<span class="w"> </span>use<span class="w"> </span>mysql<span class="p">;</span>

mysql&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>user,host,plugin<span class="w"> </span>from<span class="w"> </span>user<span class="p">;</span>
+------------------+-----------+-----------------------+
<span class="p">|</span><span class="w"> </span>user<span class="w">             </span><span class="p">|</span><span class="w"> </span>host<span class="w">      </span><span class="p">|</span><span class="w"> </span>plugin<span class="w">                </span><span class="p">|</span>
+------------------+-----------+-----------------------+
<span class="p">|</span><span class="w"> </span>debian-sys-maint<span class="w"> </span><span class="p">|</span><span class="w"> </span>localhost<span class="w"> </span><span class="p">|</span><span class="w"> </span>caching_sha2_password<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>mysql.infoschema<span class="w"> </span><span class="p">|</span><span class="w"> </span>localhost<span class="w"> </span><span class="p">|</span><span class="w"> </span>caching_sha2_password<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>mysql.session<span class="w">    </span><span class="p">|</span><span class="w"> </span>localhost<span class="w"> </span><span class="p">|</span><span class="w"> </span>caching_sha2_password<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>mysql.sys<span class="w">        </span><span class="p">|</span><span class="w"> </span>localhost<span class="w"> </span><span class="p">|</span><span class="w"> </span>caching_sha2_password<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>root<span class="w">             </span><span class="p">|</span><span class="w"> </span>localhost<span class="w"> </span><span class="p">|</span><span class="w"> </span>auth_socket<span class="w">           </span><span class="p">|</span>
+------------------+-----------+-----------------------+

mysql&gt;<span class="w"> </span>update<span class="w"> </span>user<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">host</span><span class="o">=</span><span class="s1">&#39;%&#39;</span>,plugin<span class="o">=</span><span class="s1">&#39;mysql_native_password&#39;</span><span class="w"> </span>where<span class="w"> </span><span class="nv">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>

mysql&gt;<span class="w"> </span>flush<span class="w"> </span>privileges<span class="p">;</span>

<span class="c1">## 重新设置密码</span>
mysql&gt;<span class="w"> </span>alter<span class="w"> </span>user<span class="s1">&#39;root&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="w"> </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</code></pre></div>
<blockquote>
<p>auth_socket：首先，这种验证方式不要求输入密码，即使输入了密码也不验证。这个特点让很多人觉得很不安全，实际仔细研究一下这种方式，发现还是相当安全的，因为它有另外两个限制；</p>
<ul>
<li>只能用 UNIX 的 socket 方式登陆，这就保证了只能本地登陆，用户在使用这种登陆方式时已经通过了操作系统的安全验证；</li>
<li>操作系统的用户和 MySQL 数据库的用户名必须一致，例如你要登陆 MySQL 的 root 用户，必须用操作系统的 root 用户登陆。</li>
</ul>
<p>mysql8.0 引入了新特性 caching_sha2_password；这种密码加密方式客户端不支持；客户端支持的是 mysql_native_password 这种加密方式；</p>
</blockquote>
<p>编辑 <code>/etc/mysql/mysql.conf.d/mysqld.cnf</code> 配置文件：</p>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/mysql/mysql.conf.d/mysqld.cnf
</code></pre></div>
<p>注释掉 <code>bind-address</code>：</p>
<p><img src="!assets/MySQL/image-20210420120254515.png" alt="image-20210420120254515" style="" /></p>
<p>重启服务：</p>
<div class="highlight"><pre><span></span><code>service<span class="w"> </span>mysql<span class="w"> </span>restart
</code></pre></div>
<p>测试远程访问。</p>
<h5 id="_6">卸载数据库<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>首先停止 MySQL 服务</p>
<div class="highlight"><pre><span></span><code>service<span class="w"> </span>mysql<span class="w"> </span>stop<span class="p">;</span>
service<span class="w"> </span>mysql<span class="w"> </span>status<span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在终端中查看MySQL的依赖项：</p>
<div class="highlight"><pre><span></span><code>dpkg<span class="w"> </span>--list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mysql
</code></pre></div>
</li>
<li>
<p>卸载：</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-get<span class="w"> </span>remove<span class="w"> </span>mysql-common
sudo<span class="w"> </span>apt-get<span class="w"> </span>autoremove<span class="w"> </span>--purge<span class="w"> </span>mysql-server-8.0
</code></pre></div>
</li>
<li>
<p>如果看到没有删除的文件记得手动删除：</p>
<p><img src="!assets/MySQL/image-20210420112319964.png" alt="image-20210420112319964" style="" /></p>
</li>
<li>
<p>清除残留数据：</p>
<div class="highlight"><pre><span></span><code>dpkg<span class="w"> </span>-l<span class="p">|</span>grep<span class="w"> </span>^rc<span class="p">|</span>awk<span class="w"> </span><span class="s1">&#39;{print$2}&#39;</span><span class="p">|</span>sudo<span class="w"> </span>xargs<span class="w"> </span>dpkg<span class="w"> </span>-P
</code></pre></div>
</li>
<li>
<p>再次查看MySQL的剩余依赖项：</p>
<div class="highlight"><pre><span></span><code>dpkg<span class="w"> </span>--list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mysql
</code></pre></div>
</li>
<li>
<p>删除 MySQL 的数据库信息，位置：<code>/var/lib/mysql/</code>：</p>
<p><img src="!assets/MySQL/image-20210420112705768.png" alt="image-20210420112705768" style="" /></p>
</li>
</ol>
<h4 id="233">2.3.3、银河麒麟安装<a class="headerlink" href="#233" title="Permanent link">&para;</a></h4>
<p>系统版本为银河麒麟 V10，架构为 X86，使用 tar 压缩包离线安装。</p>
<h5 id="_7">删除系统捆绑依赖包<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>删除原有的 MariaDB，因为会跟 MySQL 包安装有冲突。</p>
<p>查找：</p>
<div class="highlight"><pre><span></span><code>rpm<span class="w"> </span>-qa<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mariadb
</code></pre></div>
<p>删除 MariaDB：</p>
<div class="highlight"><pre><span></span><code>rpm<span class="w"> </span>-e<span class="w"> </span>--nodeps<span class="w"> </span><span class="k">$(</span>rpm<span class="w"> </span>-qa<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mariadb<span class="k">)</span>
</code></pre></div>
</li>
<li>
<p>倘若之前系统已经安装过 MySQL 包也一起删除。</p>
<p>查找：</p>
<div class="highlight"><pre><span></span><code>rpm<span class="w"> </span>-qa<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mysql
</code></pre></div>
<p>删除 MySQL：</p>
<div class="highlight"><pre><span></span><code>rpm<span class="w"> </span>-e<span class="w"> </span>--nodeps<span class="w"> </span><span class="k">$(</span>rpm<span class="w"> </span>-qa<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mysql<span class="k">)</span>
</code></pre></div>
</li>
</ol>
<h5 id="_8">安装数据库<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p><a href="https://dev.mysql.com/downloads/mysql/">官网</a>下载 MySQL 安装包。</p>
<p>因为 Kylinos Server V10 就是基于 CentOS 8 开发而来，所以 OS Version 选择 Red Hat Enterprise Linux 8 / Oracle Linux 8 (x86, 64-bit)，选择下载 RPM Bundle：</p>
<p><img alt="image-20250409233857708" src="%21assets/MySQL/image-20250409233857708.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>如果是别的麒麟系统也可以按照此逻辑进行安装，只需要事先查询系统基于哪个 Linux 版本，然后下载对应的安装包即可。</p>
</div>
</li>
<li>
<p>将其上传到服务器后，解压：</p>
<div class="highlight"><pre><span></span><code>tar<span class="w"> </span>-xvf<span class="w"> </span>mysql-8.0.33-1.el8.x86_64.rpm-bundle.tar
</code></pre></div>
</li>
<li>
<p>按照如下顺序逐个安装：</p>
<div class="highlight"><pre><span></span><code>rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-common-8.0.33-1.el8.x86_64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-client-plugins-8.0.33-1.el8.x86_64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-libs-8.0.33-1.el8.x86_64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-client-8.0.33-1.el8.x86_64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-icu-data-files-8.0.33-1.el8.x86_64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-server-8.0.33-1.el8.x86_64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-devel-8.0.33-1.el8.x86_64.rpm
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>如果遇到问题如下：</p>
<div class="highlight"><pre><span></span><code>error: Failed dependencies:
        net-tools is needed by mysql-community-server-8.0.33-1.el8.x86_64
</code></pre></div>
<p>可以先安装 net-tools。</p>
</div>
</li>
<li>
<p>启动服务：</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>如果想要修改 MySQL <code>lower_case_table_names</code>（大小写敏感）参数，请在执行启动命令前修改 my.cnf 文件配置。</p>
</div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>mysqld
</code></pre></div>
</li>
</ol>
<h5 id="_9">初始化数据库<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>获取初始密码并登录。</p>
<p>获取初始化临时密码：</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/var/log/mysqld.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>password
</code></pre></div>
<p>用临时密码登录数据库：</p>
<div class="highlight"><pre><span></span><code>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p
</code></pre></div>
</li>
<li>
<p>设置自己的密码：</p>
<div class="highlight"><pre><span></span><code><span class="k">alter</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="s1">&#39;xxxxxxxx&#39;</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>修改 MySQL 链接地址：</p>
<div class="highlight"><pre><span></span><code><span class="n">use</span><span class="w"> </span><span class="n">mysql</span><span class="p">;</span>

<span class="k">update</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="k">host</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="p">;</span>

<span class="k">commit</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>刷新授权信息：</p>
<div class="highlight"><pre><span></span><code><span class="n">flush</span><span class="w"> </span><span class="k">privileges</span><span class="p">;</span>
</code></pre></div>
</li>
</ol>
<h4 id="234openeuler">2.3.4、openEuler 安装<a class="headerlink" href="#234openeuler" title="Permanent link">&para;</a></h4>
<p>系统版本为 openEuler 22.03（LTS-SP3），架构为 aarch64，使用 tar 压缩包离线安装。</p>
<h5 id="_10">安装数据库<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p><a href="https://dev.mysql.com/downloads/mysql/">官网</a> 下载 MySQL 安装包。</p>
<p>因为 openEuler 基于 Red Hat Enterprise Linux 开发而来，所以 OS Version 选择 Red Hat Enterprise Linux 8 / Oracle Linux 8 (ARM, 64-bit)，选择下载 RPM Bundle：</p>
<p><img alt="image-20250416114705259" src="%21assets/MySQL/image-20250416114705259.png" /></p>
</li>
<li>
<p>将其上传到服务器后，解压：</p>
<div class="highlight"><pre><span></span><code>tar<span class="w"> </span>-xvf<span class="w"> </span>./mysql-8.0.42-1.el8.aarch64.rpm-bundle.tar
</code></pre></div>
</li>
<li>
<p>按照如下顺序逐个安装：</p>
<div class="highlight"><pre><span></span><code>rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-common-8.0.42-1.el8.aarch64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-client-plugins-8.0.42-1.el8.aarch64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-libs-8.0.42-1.el8.aarch64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-client-8.0.42-1.el8.aarch64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-icu-data-files-8.0.42-1.el8.aarch64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-server-8.0.42-1.el8.aarch64.rpm
rpm<span class="w"> </span>-ivh<span class="w"> </span>mysql-community-devel-8.0.42-1.el8.aarch64.rpm
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>如何安装的时候提示缺少依赖，可以去 <a href="https://easysoftware.openeuler.org/zh/">openEuler 软件中心</a> 下载系统对应版本的相关依赖。</p>
</div>
</li>
<li>
<p>设置开机自启：
    <div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>mysqld
</code></pre></div></p>
</li>
<li>
<p>启动服务：</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>如果想要修改 MySQL <code>lower_case_table_names</code>（大小写敏感）参数，请在执行启动命令前修改 `` 文件配置。</p>
</div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>mysqld
</code></pre></div>
</li>
</ol>
<h5 id="_11">初始化数据库<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>获取初始化临时密码：</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/var/log/mysqld.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>password
</code></pre></div>
<p>用临时密码登录数据库：</p>
<div class="highlight"><pre><span></span><code>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p
</code></pre></div>
</li>
<li>
<p>设置自己的密码：</p>
<div class="highlight"><pre><span></span><code><span class="k">alter</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="s1">&#39;xxxxxxxx&#39;</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>修改 MySQL 链接地址：</p>
<div class="highlight"><pre><span></span><code><span class="n">use</span><span class="w"> </span><span class="n">mysql</span><span class="p">;</span>

<span class="k">update</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="k">host</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="p">;</span>

<span class="k">commit</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>刷新授权信息：</p>
<div class="highlight"><pre><span></span><code><span class="n">flush</span><span class="w"> </span><span class="k">privileges</span><span class="p">;</span>
</code></pre></div>
</li>
</ol>
<h5 id="_12">卸载数据库<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>查找 MySQL 包：</p>
<div class="highlight"><pre><span></span><code>rpm<span class="w"> </span>-qa<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mysql
</code></pre></div>
</li>
<li>
<p>删除刚刚查询到的 MySQL 包 ：</p>
<div class="highlight"><pre><span></span><code>rpm<span class="w"> </span>-e<span class="w"> </span>--nodeps<span class="w"> </span><span class="k">$(</span>rpm<span class="w"> </span>-qa<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mysql<span class="k">)</span>
</code></pre></div>
</li>
<li>
<p>使用 <code>find</code> 命令查找 MySQL 的相关文件夹：</p>
<div class="highlight"><pre><span></span><code>find<span class="w"> </span>/<span class="w"> </span>-name<span class="w"> </span>mysql
</code></pre></div>
</li>
<li>
<p>使用 <code>rm</code> 命令删除所有的文件夹：</p>
<div class="highlight"><pre><span></span><code>rm<span class="w"> </span>-rf<span class="w"> </span><span class="k">$(</span>find<span class="w"> </span>/<span class="w"> </span>-name<span class="w"> </span>mysql<span class="k">)</span>
</code></pre></div>
</li>
</ol>
<h3 id="24">2.4、创建数据库<a class="headerlink" href="#24" title="Permanent link">&para;</a></h3>
<p>使用 <code>CREATE</code> 命令创建数据库，语法如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="err">[</span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="err">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">数据库名</span><span class="o">&gt;</span>
<span class="err">[[</span><span class="k">DEFAULT</span><span class="err">]</span><span class="w"> </span><span class="k">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="o">&lt;</span><span class="n">字符集名</span><span class="o">&gt;</span><span class="err">]</span><span class="w"> </span>
<span class="err">[[</span><span class="k">DEFAULT</span><span class="err">]</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">校对规则名</span><span class="o">&gt;</span><span class="err">]</span><span class="p">;</span>
</code></pre></div>
<p>[ ] 中的内容是可选的。语法说明如下：</p>
<ul>
<li>&lt;数据库名&gt;：创建数据库的名称。MySQL 的数据存储区将以目录方式表示 MySQL 数据库，因此数据库名称必须符合操作系统的文件夹命名规则，注意在 MySQL 中不区分大小写。</li>
<li><code>IF NOT EXISTS</code>：在创建数据库之前进行判断，只有该数据库目前尚不存在时才能执行操作。此选项可以用来避免数据库已经存在而重复创建的错误。</li>
<li><code>[DEFAULT] CHARACTER SET</code>：指定数据库的默认字符集。</li>
<li><code>[DEFAULT] COLLATE</code>：指定字符集的默认校对规则。</li>
</ul>
<p>可以使用 <code>SHOW CREATE DATABASE 数据库名称</code> 查看数据库的定义声明</p>
<p>为防止字符混乱的情况发生，MySQL 有时需要在创建数据库时明确指定字符集；在中国大陆地区，常用的字符集有 UTF8 和 GBK。</p>
<ul>
<li>UTF8 能够存储全球的所有字符，在任何国家都可以使用，默认的校对规则为 <code>utf8_general_ci</code>，对于中文可以使用 <code>utf8_general_ci</code>。</li>
<li>GBK 只能存储汉语涉及到的字符，不具有全球通用性，默认的校对规则为 <code>gbk_chinese_ci</code>。</li>
</ul>
<h3 id="25">2.5、数据库操作<a class="headerlink" href="#25" title="Permanent link">&para;</a></h3>
<p><strong>查看数据库</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SHOW</span><span class="w"> </span><span class="k">DATABASES</span><span class="w"> </span><span class="err">[</span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;数据库名&#39;</span><span class="err">]</span><span class="p">;</span>
</code></pre></div>
<p>语法说明如下：</p>
<ul>
<li>LIKE 从句是可选项，用于匹配指定的数据库名称。LIKE 从句可以部分匹配，也可以完全匹配。</li>
<li>数据库名由单引号 <code>''</code> 包围。</li>
</ul>
<p><strong>修改数据库</strong></p>
<p>在 MySQL 中，可以使用 <code>ALTER DATABASE</code> 或 <code>ALTER SCHEMA</code> 语句来修改已经被创建或者存在的数据库的相关参数。</p>
<p>修改数据库的语法格式为：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="err">[</span><span class="n">数据库名</span><span class="err">]</span><span class="w"> </span>
<span class="err">{[</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="err">]</span><span class="w"> </span><span class="k">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="o">&lt;</span><span class="n">字符集名</span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span>
<span class="err">[</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="err">]</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">校对规则名</span><span class="o">&gt;</span><span class="err">}</span>
</code></pre></div>
<p>语法说明如下：</p>
<ul>
<li><code>ALTER DATABASE</code> 用于更改数据库的全局特性。这些特性存储在数据库目录的 db.opt 文件中。</li>
<li>使用 <code>ALTER DATABASE</code> 需要获得数据库 <code>ALTER</code> 权限。</li>
<li>数据库名称可以忽略，此时语句对应于默认数据库。</li>
<li><code>CHARACTER SET</code> 子句用于更改默认的数据库字符集。</li>
</ul>
<p><strong>删除数据库</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="err">[</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="err">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">数据库名</span><span class="o">&gt;</span>
</code></pre></div>
<p>语法说明如下：</p>
<ul>
<li>&lt;数据库名&gt;：指定要删除的数据库名。</li>
<li><code>IF EXISTS</code>：用于防止当数据库不存在时发生错误。</li>
<li><code>DROP DATABASE</code>：删除数据库中的所有表格并同时删除数据库。使用此语句时要非常小心，以免错误删除。如果要使用 <code>DROP DATABASE</code>，需要获得数据库 <code>DROP</code> 权限。</li>
</ul>
<p>注意：MySQL 安装后，系统会自动创建名为 information_schema 和 mysql 的两个系统数据库，系统数据库存放一些和数据库相关的信息，如果删除了这两个数据库，MySQL 将不能正常工作。</p>
<p><strong>选择数据库</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">USE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">数据库名</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<h2 id="3">3、存储引擎<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1、什么是存储引擎？<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<p>数据库存储引擎是数据库底层软件组件，数据库管理系统使用数据引擎进行创建、查询、更新和删除数据操作。不同的存储引擎提供不同的存储机制、索引技巧、锁定水平等功能，使用不同的存储引擎还可以获得特定的功能。</p>
<p>现在许多数据库管理系统都支持多种不同的存储引擎。MySQL 的核心就是存储引擎。</p>
<ul>
<li>InnoDB 事务型数据库的首选引擎，支持事务安全表（ACID），支持行锁定和外键。MySQL 5.5.5 之后，InnoDB 作为默认存储引擎。</li>
<li>MyISAM 是基于 ISAM 的存储引擎，并对其进行扩展，是在 Web、数据仓储和其他应用环境下最常使用的存储引擎之一。MyISAM 拥有较高的插入、查询速度，但不支持事务。</li>
<li>MEMORY 存储引擎将表中的数据存储到内存中，为查询和引用其他数据提供快速访问。</li>
</ul>
<h3 id="32">3.2、支持的存储引擎<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<p>MySQL 支持多种类型的数据库引擎，可分别根据各个引擎的功能和特性为不同的数据库处理任务提供各自不同的适应性和灵活性。</p>
<p>MySQL 提供了多个不同的存储引擎，包括处理事务安全表的引擎和处理非事务安全表的引擎。在 MySQL 中，不需要在整个服务器中使用同一种存储引擎，针对具体的要求，可以对每一个表使用不同的存储引擎。</p>
<p>支持的存储引擎有 InnoDB、MyISAM、Memory、Merge、Archive、Federated、CSV、BLACKHOLE 等。可以使用 <code>SHOW ENGINES</code> 语句查看系统所支持的引擎类型，结果如图所示：</p>
<p><img src="!assets/MySQL/image-20200528235456064.png" alt="image-20200528235456064" style="zoom: 67%;" /></p>
<p>Support 列的值表示某种引擎是否能使用，YES 表示可以使用，NO 表示不能使用，DEFAULT 表示该引擎为当前默认的存储引擎。</p>
<h3 id="33">3.3、如何选择存储引擎？<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<p>不同的存储引擎都有各自的特点，以适应不同的需求，如表所示。为了做出选择，首先要考虑每一个存储引擎提供了哪些不同的功能。</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>MyISAM</th>
<th>MEMORY</th>
<th>InnoDB</th>
<th>Archive</th>
</tr>
</thead>
<tbody>
<tr>
<td>存储限制</td>
<td>256TB</td>
<td>RAM</td>
<td>64TB</td>
<td>None</td>
</tr>
<tr>
<td>支持事务</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>支持全文索引</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>支持树索引</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>支持哈希索引</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>支持数据缓存</td>
<td>No</td>
<td>N/A</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>支持外键</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>可以根据以下的原则来选择 MySQL 存储引擎：</p>
<ul>
<li>如果要提供提交、回滚和恢复的事务安全（ACID 兼容）能力，并要求实现并发控制，InnoDB 是一个很好的选择。</li>
<li>如果数据表主要用来插入和查询记录，则 MyISAM 引擎提供较高的处理效率。</li>
<li>如果只是临时存放数据，数据量不大，并且不需要较高的数据安全性，可以选择将数据保存在内存的 MEMORY 引擎中，MySQL 中使用该引擎作为临时表，存放查询的中间结果。</li>
<li>如果只有 <code>INSERT</code> 和 <code>SELECT</code> 操作，可以选择Archive 引擎，Archive 存储引擎支持高并发的插入操作，但是本身并不是事务安全的。Archive 存储引擎非常适合存储归档数据，如记录日志信息可以使用 Archive 引擎。</li>
</ul>
<p>提示：使用哪一种引擎要根据需要灵活选择，一个数据库中多个表可以使用不同的引擎以满足各种性能和实际需求。使用合适的存储引擎将会提高整个数据库的性能。</p>
<h3 id="34">3.4、修改存储引擎<a class="headerlink" href="#34" title="Permanent link">&para;</a></h3>
<p>InnoDB 是系统的默认引擎，支持可靠的事务处理。</p>
<p>使用下面的语句可以修改数据库临时的默认存储引擎</p>
<div class="highlight"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="n">DEFAULT_storage_engine</span><span class="o">=&lt;</span><span class="n">存储引擎名</span><span class="o">&gt;</span>
</code></pre></div>
<p>但是当再次重启客户端时，默认存储引擎仍然是 InnoDB。</p>
<h2 id="4">4、数据表<a class="headerlink" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1、创建数据表<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<p>使用 CREATE TABLE 语句创建表。其语法格式为：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="err">[</span><span class="n">表定义选项</span><span class="err">]</span><span class="p">)</span><span class="err">[</span><span class="n">表选项</span><span class="err">][</span><span class="n">分区选项</span><span class="err">]</span><span class="p">;</span>
</code></pre></div>
<p>其中，[表定义选项]的格式为：&lt;列名1&gt; &lt;类型1&gt; [,…] &lt;列名n&gt; &lt;类型n&gt;</p>
<p>CREATE TABLE 命令语法比较多，其主要是由表创建定义（CREATE-definition）、表选项（TABLE-options）和分区选项（partition-options）所组成的。</p>
<p>CREATE TABLE 语句的主要语法及使用说明如下：</p>
<ul>
<li>CREATE TABLE：用于创建给定名称的表，必须拥有表CREATE的权限。</li>
<li>&lt;表名&gt;：指定要创建表的名称，在 CREATE TABLE 之后给出，必须符合标识符命名规则。表名称被指定为 db_name.tbl_name，以便在特定的数据库中创建表。无论是否有当前数据库，都可以通过这种方式创建。在当前数据库中创建表时，可以省略 db-name。如果使用加引号的识别名，则应对数据库和表名称分别加引号。例如，'mydb'.'mytbl' 是合法的，但 'mydb.mytbl' 不合法。</li>
<li>&lt;表定义选项&gt;：表创建定义，由列名（col_name）、列的定义（column_definition）以及可能的空值说明、完整性约束或表索引组成。</li>
<li>默认的情况是，表被创建到当前的数据库中。若表已存在、没有当前数据库或者数据库不存在，则会出现错误。</li>
</ul>
<p>提示：使用 CREATE TABLE 创建表时，必须指定以下信息：</p>
<ul>
<li>要创建的表的名称不区分大小写，不能使用SQL语言中的关键字，如DROP、ALTER、INSERT等。</li>
<li>数据表中每个列（字段）的名称和数据类型，如果创建多个列，要用逗号隔开。</li>
</ul>
<p>实例：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">runoob_tb1</span><span class="p">(</span>
<span class="w">    </span><span class="n">runoob_id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">runoob_title</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">runoob_author</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">submission_date</span><span class="w"> </span><span class="kt">DATE</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">runoob_id</span><span class="p">)</span>
<span class="p">)</span><span class="k">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</code></pre></div>
<p>实例解析：</p>
<ul>
<li>如果你不想字段为NULL可以设置字段的属性为NOT NULL，在操作数据库时如果输入该字段的数据为NULL，就会报错</li>
<li>AUTO_INCREMENT定义列为自增的属性，一般用于主键，数值会自动加1</li>
<li>PRIMARY KEY关键字用于定义列为主键。可以使用多列来定义主键，列间以逗号分隔</li>
<li>ENGINE设置存储引擎，CHARSET设置编码</li>
</ul>
<p>创建MySQL的表时，表名和字段名外面的符号`不是单引号，而是英文输入法状态下的反单引号，也就是键盘左上角esc下面的那一个~按键。</p>
<p>反单引号是为了区分MySQL关键字与普通字符而引入的符号，一般的，表名与字段名都是用反单引号（也可以不用）。</p>
<h3 id="42">4.2、查看表结构<a class="headerlink" href="#42" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">DESC</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<p>或</p>
<div class="highlight"><pre><span></span><code><span class="k">SHOW</span><span class="w"> </span><span class="k">COLUMNS</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<p>其中，各个字段的含义如下：</p>
<ul>
<li>Null：表示该列是否可以存储 NULL 值。</li>
<li>Key：表示该列是否已编制索引。PRI 表示该列是表主键的一部分，UNI 表示该列是 UNIQUE 索引的一部分，MUL 表示在列中某个给定值允许出现多次。</li>
<li>Default：表示该列是否有默认值，如果有，值是多少。</li>
<li>Extra：表示可以获取的与给定列有关的附加信息，如 AUTO_INCREMENT 等。</li>
</ul>
<p>SHOW CREATE TABLE语句可以用来显示创建表时的CREATE TABLE语句，语法格式如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">SHOW</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="err">\</span><span class="n">G；</span>
</code></pre></div>
<p>提示：使用 SHOW CREATE TABLE 语句不仅可以查看创建表时的详细语句，而且可以查看存储引擎和字符编码。如果不加“\G”参数，显示的结果可能非常混乱，加上“\G”参数之后，可使显示的结果更加直观，易于查看。</p>
<h3 id="43">4.3、修改数据表<a class="headerlink" href="#43" title="Permanent link">&para;</a></h3>
<p>当我们需要修改数据表名或者修改数据表字段时，就需要使用到MySQL ALERT命令。</p>
<p><strong>删除、添加字段</strong></p>
<p>使用ALERT命令及DROP子句来删除以上表的字段：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="o">&lt;</span><span class="n">字段名</span><span class="o">&gt;</span><span class="n">；</span>
</code></pre></div>
<p>如果数据表中只剩余一个字段则无法使用DROP来删除字段</p>
<p>添加字段的语法格式如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="o">&lt;</span><span class="n">新字段名</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">数据类型</span><span class="o">&gt;</span><span class="w"> </span><span class="err">[</span><span class="n">约束条件</span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="k">FIRST</span><span class="o">|</span><span class="k">AFTER</span><span class="w"> </span><span class="n">已存在的字段名</span><span class="err">]</span><span class="n">；</span>
</code></pre></div>
<p>新字段名为需要添加的字段的名称；FIRST 为可选参数，其作用是将新添加的字段设置为表的第一个字段；AFTER 为可选参数，其作用是将新添加的字段添加到指定的已存在的字段名的后面。</p>
<p><strong>修改字段类型及名称</strong></p>
<p>修改字段的数据类型就是把字段的数据类型转换成另一种数据类型。</p>
<p>在 MySQL 中修改字段数据类型的语法规则如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">MODIFY</span><span class="w"> </span><span class="o">&lt;</span><span class="n">字段名</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">数据类型</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<p>使用CHANGE子句，语法有很大的不同。在CHANGE关键字之后，紧跟着的是你要修改的字段名，然后指定新字段名及类型。</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CHANGE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">旧字段名</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">新字段名</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">新数据类型</span><span class="o">&gt;</span><span class="n">；</span>
</code></pre></div>
<p><strong>修改字段默认值</strong></p>
<p>可以使用ALERT来修改字段的默认值：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="o">&lt;</span><span class="n">字段名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">默认值</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<p>也可以使用ALTER命令及DROP子句来删除字段的默认值：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="o">&lt;</span><span class="n">字段名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="p">;</span>
</code></pre></div>
<p>当修改字段时，可以指定是否包含值或者是否设置默认值。</p>
<p>以下实例：指定字段j为NOT NULL且默认值为100：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">MODIFY</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="kt">BIGINT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>
<p>如果你不设置默认值，MySQL会自动设置该字段默认为NULL</p>
<p><strong>修改数据表引擎</strong></p>
<p>使用ALTER命令TYPE子句来完成：</p>
<p>将表的引擎修改为MYISAM：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ENGINE</span><span class="o">=</span><span class="n">MYISAM</span><span class="p">;</span>
</code></pre></div>
<p><strong>修改表名</strong></p>
<p>如果需要修改数据表的名称，可以在ALTER TABLE语句中使用RENAME子句来实现：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">旧表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">RENAME</span><span class="w"> </span><span class="err">[</span><span class="k">TO</span><span class="err">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">新表名</span><span class="o">&gt;</span><span class="n">；</span>
</code></pre></div>
<h3 id="44">4.4、删除数据表<a class="headerlink" href="#44" title="Permanent link">&para;</a></h3>
<p>删除MySQL数据表的通用语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="err">[</span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="err">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="err">[</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名1</span><span class="o">&gt;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名2</span><span class="o">&gt;</span><span class="err">]</span><span class="w"> </span><span class="n">…</span>
</code></pre></div>
<p>语法说明如下：</p>
<ul>
<li>&lt;表名&gt;：被删除的表名。DROP TABLE 语句可以同时删除多个表，用户必须拥有该命令的权限。</li>
<li>表被删除时，所有的表数据和表定义会被取消，所以使用本语句要小心。</li>
<li>表被删除时，用户在该表上的权限并不会自动被删除。</li>
<li>参数IF EXISTS用于在删除前判断删除的表是否存在，加上该参数后，在删除表的时候，如果表不存在，SQL 语句可以顺利执行，但会发出警告（warning）。</li>
</ul>
<h2 id="5">5、约束<a class="headerlink" href="#5" title="Permanent link">&para;</a></h2>
<p>SQL约束用于规定表中的规则。</p>
<p>如果存在违反约束的数据行为，行为会被约束终止。</p>
<p>约束可以在创建表时规定（通过CREATE TABLE语句），或者在表创建之后规定（通过ALTER TABLE语句）。</p>
<p>在SQL中，有如下约束：</p>
<ul>
<li>NOT NULL：指示某列不能存储NULL值。</li>
<li>UNIQUE：保证某列的每行必须有唯一的值。</li>
<li>PRIMARY KEY：NOT NULL和UNIQUE的结合。确保某列（或两个列多个列的结合）有唯一标识，有注意更容易更快速地找到表中的一个特定的记录。</li>
<li>FOREIGN KEY：保证一个表中的数据匹配到另一个表中的值得参照完整性。</li>
<li>CHECK：保证列中的值符合指定的条件。</li>
<li>DEFAULT：规定没有给列赋值时的默认值。</li>
</ul>
<h3 id="51not-null">5.1、NOT NULL<a class="headerlink" href="#51not-null" title="Permanent link">&para;</a></h3>
<p>添加NOT NULL约束:</p>
<p>在一个已创建的表“Age”字段中添加NOT NULL约束：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">MODIFY</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">;</span>
</code></pre></div>
<p>删除NOT NULL约束:</p>
<p>在一个已创建的表的“Age”字段中删除NOT NULL约束：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">MODIFY</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="no">NULL</span><span class="p">;</span>
</code></pre></div>
<h3 id="52unique">5.2、UNIQUE<a class="headerlink" href="#52unique" title="Permanent link">&para;</a></h3>
<p>UNIQUE约束唯一标识数据库表中的每条记录。</p>
<p>UNIQUE和PRIMARY KEY约束均为列或列集合提供了唯一性的保证。</p>
<p>PRIMARY KEY约束拥有自动定义的UNIQUE约束。</p>
<p>注意：每个表可以有多个UNIQUE约束，但是每个表只能有一个PRIMARY KEY约束（一个表不能有两个主键，但是允许用多个字段组成主键）。声明为 PRIMAY KEY 的列不允许有空值；声明为 UNIQUE 的字段允许空值的存在，但只能出现一个空值。</p>
<p><strong>添加UNIQUE约束</strong></p>
<p>实例：</p>
<p>在“Persons”表创建时在“P_id”列上创建UNIQUE约束</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="p">(</span>
<span class="w">    </span><span class="n">P_Id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">LastName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">FirstName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">Address</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">City</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">P_Id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p>如需命名UNIQUE约束，并定义多个UNIQUE约束，请使用下面的语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="p">(</span>
<span class="w">    </span><span class="n">P_Id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">LastName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">FirstName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">Address</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">City</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">uc_PersonID</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="p">,</span><span class="n">LastName</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>修改UNIQUE约束</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">P_Id</span><span class="p">);</span>
</code></pre></div>
<p>如需命名UNIQUE约束，并定义多个列的UNIQUE约束：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">uc_PersonID</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">P_Id</span><span class="p">,</span><span class="n">LastName</span><span class="p">);</span>
</code></pre></div>
<p>撤销UNIQUE约束：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">uc_PersonID</span><span class="p">;</span>
</code></pre></div>
<h3 id="53primary-key">5.3、PRIMARY KEY<a class="headerlink" href="#53primary-key" title="Permanent link">&para;</a></h3>
<p>PRIMARY KEY约束唯一标识数据库表中的没条记录。</p>
<p>主键必须包含唯一的值。</p>
<p>主键列不能包含NULL值。</p>
<p>每个表应该有一个主键，并且每个表只能有一个主键。</p>
<p><strong>添加PRIMARY KEY</strong></p>
<p>实例：</p>
<p>在“Persons”表创建时在“P_Id”列上创建PRIMARY KEY约束</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="p">(</span>
<span class="w">    </span><span class="n">P_Id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">LastName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">FirstName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">Address</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">City</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p>如需命名PRIMARY KEY约束，并定义多个列的PRIMARY KEY约束：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="p">(</span>
<span class="w">    </span><span class="n">P_Id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">LastName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">FirstName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">Address</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">City</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">pk_PersonID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="p">,</span><span class="n">LastName</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p>注释：在上面的实例中，只有一个主键PRIMARY KEY（pk_PersonID）。然而，pk_PersonID的值是由两个列（P_Id和LastName）组成的。</p>
<p><strong>修改PRIMARY KEY</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="p">);</span>
</code></pre></div>
<p>如需命名PRIMARY KEY约束，并定义多个列的PRIMARY KEY约束：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">pk_PersonID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="p">,</span><span class="n">LastName</span><span class="p">);</span>
</code></pre></div>
<p>注释：如果使用ALTER语句添加主键，必须把主键列声明为不包含NULL值，</p>
<p>如果未声明，先使用以下语句修改再添加主键：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">MODIFY</span><span class="w"> </span><span class="o">&lt;</span><span class="n">字段名</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">数据类型</span><span class="o">&gt;</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">;</span>
</code></pre></div>
<p>撤销PRIMARY KEY约束</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">;</span>
</code></pre></div>
<h3 id="54foreign-key">5.4、FOREIGN KEY<a class="headerlink" href="#54foreign-key" title="Permanent link">&para;</a></h3>
<p>一个表中的FOREIGN KEY指向另一个表的UNIQUE KEY（唯一约束的键）。</p>
<p>A表的a列指向B表的b列，则：</p>
<ul>
<li>A表的a列是B表的PRIMARY KEY；</li>
<li>B表的b列是A表的FOREIGN KEY。</li>
</ul>
<p>FOREIGN KEY约束用于预防破坏表之间连接的行为。</p>
<p>FOREIGN KEY约束也能防止非法数据插入外键列，因为它必须是它指向的那个表中的值之一。</p>
<p><strong>添加FOREIGN KEY</strong></p>
<p>实例：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Orders</span><span class="p">(</span>
<span class="w">    </span><span class="n">O_Id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">OrderNo</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">P_Id</span><span class="w"> </span><span class="kt">INT</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">O_Id</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">Persons</span><span class="p">(</span><span class="n">P_Id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p>在“Orders”表创建时在“P_id”列上创建FOREIGN KEY约束</p>
<p>如需命名 FOREIGN KEY 约束，并定义多个列的 FOREIGN KEY 约束:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Orders</span><span class="p">(</span>
<span class="w">    </span><span class="n">O_Id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">OrderNo</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">P_Id</span><span class="w"> </span><span class="kt">INT</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">O_Id</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_PerOrders</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">Persons</span><span class="p">(</span><span class="n">P_Id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>修改FOREIGN KEY</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">Persons</span><span class="p">(</span><span class="n">P_Id</span><span class="p">);</span>
</code></pre></div>
<p>如需命名 FOREIGN KEY约束，并定义多个列的 FOREIGN KEY 约束:</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_PerOrders</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="p">);</span>
</code></pre></div>
<p>撤销FOREIGN KEY约束：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">fk_PerOrders</span><span class="p">;</span>
</code></pre></div>
<p><strong>级联</strong></p>
<p>这是数据库外键定义的一个可选项，用来设置当主键表中的被参考列的数据发生变化时，外键表中响应字段的变化规则。UPDATE则是主键表中被参考字段的值更新，DELETE是指在主键表中删除一条记录。</p>
<p>ON UPDATE和ON DELETE后面可以跟的词语有四个：</p>
<ul>
<li>NO ACTION：表示不做任何操作。</li>
<li>SET NULL：表示在外键表中将相应的字段设置为NULL</li>
<li>SET DEFAULT：表示设置为默认值</li>
<li>CASCADE：表示级联操作，就是说，如果主键表中被参考字段更新，外检表也更新，主键表中的记录被删除，外检表中的该行也相应删除。</li>
</ul>
<h3 id="55check">5.5、CHECK<a class="headerlink" href="#55check" title="Permanent link">&para;</a></h3>
<p>CHECK约束用于限制列中的值得范围</p>
<p>如果对单个列定义CHECK约束，那么该列只允许特定的值。</p>
<p>如果对一个表定义CHECK约束，那么此约束会基于行中其他列的值在特定的列中对值进行限制。</p>
<p><strong>添加CHECK约束</strong></p>
<p>实例：</p>
<p>在“Persons”表创建时在“P_Id”列上创建CHECK约束。CHECK约束规定“P_Id”列必须只包含大于0的整数。</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="p">(</span>
<span class="w">    </span><span class="n">P_Id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">LastName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">FirstName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">Address</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">City</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p>如需命名 CHECK约束，并定义多个列的 CHECK约束：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="p">(</span>
<span class="w">    </span><span class="n">P_Id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">LastName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">FirstName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">Address</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">City</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">chk_Person</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">City</span><span class="o">=</span><span class="s1">&#39;Sandnes&#39;</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>修改CHECK约束</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<p>如需命名 CHECK约束，并定义多个列的 CHECK约束：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">chk_Person</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">P_Id</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">City</span><span class="o">=</span><span class="s1">&#39;Sandnes&#39;</span><span class="p">);</span>
</code></pre></div>
<p>撤销CHECK约束</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="n">chk_Person</span><span class="p">;</span>
</code></pre></div>
<h3 id="56default">5.6、DEFAULT<a class="headerlink" href="#56default" title="Permanent link">&para;</a></h3>
<p><strong>添加DEFAULT约束</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="p">(</span>
<span class="w">    </span><span class="n">P_Id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">LastName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">FirstName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">Address</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">City</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;Sandnes&#39;</span>
<span class="p">);</span>
</code></pre></div>
<p>通过使用类似 GETDATE() 这样的函数，DEFAULT 约束也可以用于插入系统值：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="p">(</span>
<span class="w">    </span><span class="n">P_Id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">LastName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">FirstName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">Address</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">City</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>修改DEFAULT约束</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="n">City</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;Sandnes&#39;</span><span class="p">;</span>
</code></pre></div>
<p>撤销DEFAULT约束：</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persons</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="n">City</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="p">;</span>
</code></pre></div>
<h3 id="57">5.7、查看表中的约束<a class="headerlink" href="#57" title="Permanent link">&para;</a></h3>
<p>查看数据表中的约束语法格式如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">SHOW</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">数据表名</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<h2 id="6">6、增、删、改<a class="headerlink" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1、插入数据<a class="headerlink" href="#61" title="Permanent link">&para;</a></h3>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">field1</span><span class="p">,</span><span class="w"> </span><span class="n">field2</span><span class="p">,</span><span class="n">…fieldN</span><span class="p">)</span>
<span class="k">VALUES</span>
<span class="p">(</span><span class="n">VALUE1</span><span class="p">,</span><span class="w"> </span><span class="n">VALUE2</span><span class="p">,</span><span class="n">…VALUEN</span><span class="p">);</span>
</code></pre></div>
<p>实例：</p>
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">runoob_tb1</span>
<span class="p">(</span><span class="n">runoob_title</span><span class="p">,</span><span class="w"> </span><span class="n">runoob_author</span><span class="p">,</span><span class="w"> </span><span class="n">submission_date</span><span class="p">)</span>
<span class="k">VALUES</span>
<span class="p">(</span><span class="s1">&#39;学习PHP&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;菜鸟教程&#39;</span><span class="p">,</span><span class="w"> </span><span class="nf">NOW</span><span class="p">());</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">runoob_tb1</span>
<span class="p">(</span><span class="n">runoob_title</span><span class="p">,</span><span class="w"> </span><span class="n">runoob_author</span><span class="p">,</span><span class="w"> </span><span class="n">submission_date</span><span class="p">)</span>
<span class="k">VALUES</span>
<span class="p">(</span><span class="s1">&#39;学习MysQL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;菜鸟教程&#39;</span><span class="p">,</span><span class="w"> </span><span class="nf">NOW</span><span class="p">());</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">runoob_tb1</span>
<span class="p">(</span><span class="n">runoob_title</span><span class="p">,</span><span class="w"> </span><span class="n">runoob_author</span><span class="p">,</span><span class="w"> </span><span class="n">submission_date</span><span class="p">)</span>
<span class="k">VALUES</span>
<span class="p">(</span><span class="s1">&#39;Java教程&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;runoob.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2016-05-06&#39;</span><span class="p">);</span>
</code></pre></div>
<p>实例中 <code>NOW()</code>是一个 MySQL 函数，该函数返回日期和时间</p>
<p><strong>INSERT 多条数据</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="p">(</span><span class="n">field1</span><span class="p">,</span><span class="w"> </span><span class="n">field2</span><span class="p">,</span><span class="n">…fieldN</span><span class="p">)</span>
<span class="k">VALUES</span>
<span class="p">(</span><span class="n">VALUEA1</span><span class="p">,</span><span class="n">VALUEA2</span><span class="p">,</span><span class="n">…VALUEAN</span><span class="p">),</span>
<span class="p">(</span><span class="n">VALUEB1</span><span class="p">,</span><span class="n">VALUEB2</span><span class="p">,</span><span class="n">…VALUEBN</span><span class="p">),</span>
<span class="p">(</span><span class="n">VALUEC1</span><span class="p">,</span><span class="n">VALUEC2</span><span class="p">,</span><span class="n">…VALUECN</span><span class="p">),</span>
<span class="n">…</span><span class="p">;</span>
</code></pre></div>
<p>如果第一列是自增可以在添加数据的时候，写为 0 或 <code>NULL</code>，这样添加数据可以自增，从而可以添加全部数据，而不用特意规定哪几列添加数据。</p>
<p><strong>复制表</strong></p>
<ul>
<li>
<p>复制表结构：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">targetTable</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="n">sourceTable</span><span class="p">;</span>
</code></pre></div>
<p>或者</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">targetTable</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sourceTable</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>复制表数据：</p>
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">targetTable</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sourceTable</span><span class="p">;</span>
</code></pre></div>
<p>或者：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">targetTable</span><span class="w"> </span><span class="err">[</span><span class="k">IN</span><span class="w"> </span><span class="n">externaldatabase</span><span class="err">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sourceTable</span>
</code></pre></div>
</li>
<li>
<p>复制表结构及数据到新表：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">newTable</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">oldTable</span><span class="p">;</span>
</code></pre></div>
</li>
</ul>
<h3 id="62">6.2、删除数据<a class="headerlink" href="#62" title="Permanent link">&para;</a></h3>
<p><strong>语法：</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="err">[</span><span class="k">WHERE</span><span class="w"> </span><span class="n">Clause</span><span class="err">]</span>
</code></pre></div>
<ul>
<li>如果没有指定 <code>WHERE</code> 子句，MySQL 表中所有记录将被删除</li>
<li>你可以在 <code>WHERE</code> 子句中指定任何条件</li>
<li>你可以在单个表中一次性删除记录</li>
</ul>
<p><code>DELETE</code> 是逐行删除速度极慢，不适合大量数据删除。</p>
<p><strong>语法：</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span>
</code></pre></div>
<p>删除所有数据，保留表结构，不能撤销还原。</p>
<p><strong>区别：</strong></p>
<ol>
<li>
<p><code>DELETE</code> 语句执行删除的过程是每次从表中删除一行，并且同时将该行的删除操作作为事务记录在日志中保存以便进行进行回滚操作。</p>
<p><code>TRUNCATE TABLE</code> 则一次性地从表中删除所有的数据并不把单独的删除操作记录记入日志保存，删除行是不能恢复的。并且在删除的过程中不会激活与表有关的删除触发器。执行速度快。</p>
</li>
<li>
<p>当表被 <code>TRUNCATE</code> 后，这个表和索引所占用的空间会恢复到初始大小，<code>DELETE</code> 操作不会减少表或索引所占用的空间。<code>DROP</code> 语句将表所占用的空间全释放掉。</p>
</li>
<li>
<p><code>DELETE</code> 语句为 DML（data maintain Language)，这个操作会被放到 rollback segment 中，事务提交后才生效。如果有相应的 tigger，执行的时候将被触发。</p>
<p>由于 <code>TRUNCATE TABLE</code> 不记录在日志中，所以它不能激活触发器。</p>
</li>
</ol>
<h3 id="63">6.3、更新数据<a class="headerlink" href="#63" title="Permanent link">&para;</a></h3>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">field1</span><span class="o">=</span><span class="n">new_VALUE1</span><span class="p">,</span><span class="w"> </span><span class="n">field2</span><span class="o">=</span><span class="n">new_VALUE2</span>
<span class="err">[</span><span class="k">WHERE</span><span class="w"> </span><span class="n">Clause</span><span class="err">]</span>
</code></pre></div>
<ul>
<li>你可以同时更新一个或多个字段</li>
<li>你可以在WHERE子句中指定任何条件</li>
<li>你可以在一个单独表中同时更新数据</li>
</ul>
<h2 id="7">7、查询数据<a class="headerlink" href="#7" title="Permanent link">&para;</a></h2>
<p><code>SELECT</code> 语句用于从数据库中选取数据，结果被存储在一个结果表中，称为结果集。</p>
<h3 id="71">7.1、限制查询结果数和偏移<a class="headerlink" href="#71" title="Permanent link">&para;</a></h3>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">column_name</span><span class="p">,</span><span class="k">column_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tbale_name</span>
<span class="err">[</span><span class="k">WHERE</span><span class="w"> </span><span class="n">Clause</span><span class="err">]</span>
<span class="err">[</span><span class="k">LIMIT</span><span class="w"> </span><span class="n">N</span><span class="err">][</span><span class="k">OFFSET</span><span class="w"> </span><span class="n">M</span><span class="err">]</span>
</code></pre></div>
<ul>
<li>查询语句中你可以使用一个或多个表，表之间使用逗号(,)分割，并使用WHERE语句来设定查询条件</li>
<li>SELECT命令可以读取一条或多条记录</li>
<li>你可以使用星号(*)来代替其他字段，SELECT语句会返回表的所有字段数据</li>
<li>你可以使用WHERE语句来包含任何条件</li>
<li>你可以使用LIMIT属性来设定返回的记录数</li>
<li>你可以通过OFFSET指定SELECT语句开始查询的数据偏移量。默认情况下偏移量为0</li>
</ul>
<p><strong>实现分页</strong></p>
<p>LIMIT N：返回N条记录</p>
<p>OFFSET M：跳过M条记录，默认M=0，单独使用似乎不起作用</p>
<p>LIMIT N,M：相当于LIMIT M OFFSET N，从第N条记录开始，返回M条记录</p>
<p>实现分页：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">_TABLE</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="p">(</span><span class="n">page_number</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">lines_perpage</span><span class="p">,</span><span class="w"> </span><span class="n">lines_perpage</span>
</code></pre></div>
<p>或</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">_TABLE</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="n">lines_perpage</span><span class="w"> </span><span class="k">OFFSET</span><span class="w"> </span><span class="p">(</span><span class="n">page_number</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">lines_perpage</span>
</code></pre></div>
<h3 id="72where">7.2、WHERE 条件查询<a class="headerlink" href="#72where" title="Permanent link">&para;</a></h3>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">field1</span><span class="p">,</span><span class="w"> </span><span class="n">field2</span><span class="p">,</span><span class="n">…fieldN</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">TABLE_name1</span><span class="p">,</span><span class="w"> </span><span class="n">TABLE_name2…</span>
<span class="err">[</span><span class="k">WHERE</span><span class="w"> </span><span class="n">condition1</span><span class="w"> </span><span class="err">[</span><span class="k">AND</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">OR</span><span class="err">]</span><span class="w"> </span><span class="n">condition2…</span><span class="err">]</span>
</code></pre></div>
<ul>
<li>查询语句中你可以使用一个或多个表，表之间用逗号分隔，并使用 <code>WHERE</code> 语句来设定查询条件</li>
<li>可以在 <code>WHERE</code> 子句中指定任何条件</li>
<li>可以使用 <code>and</code> 或者 <code>or</code> 指定一个或多个条件</li>
<li><code>WHERE</code> 子句也可以运用于 SQL 的 <code>DELETE</code> 或者 <code>UPDATE</code> 命令</li>
<li><code>WHERE</code> 子句类似于程序语言中的 if 条件，根据 MySQL 表中的字段值来读取指定的数据</li>
</ul>
<p>如果想在 MySQL 数据表中读取指定的数据，<code>WHERE</code> 子句是非常有用的。使用主键来作为 <code>WHERE</code> 子句的条件查询是非常快速的。</p>
<p>如果给定的条件在表中没有任何匹配的记录，那么查询不会返回任何数据。</p>
<p>MySQL 的 <code>WHERE</code> 子句的字符串比较是不区分大小写的。可以使用 <code>BINARY</code> 关键字来设定 <code>WHERE</code> 子句的字符串比较是区分大小写的：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">field1</span><span class="p">,</span><span class="w"> </span><span class="n">field2</span><span class="p">,</span><span class="n">…fieldN</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">TABLE_name1</span><span class="p">,</span><span class="w"> </span><span class="n">TABLE_name2…</span>
<span class="err">[</span><span class="k">WHERE</span><span class="w"> </span><span class="kt">BINARY</span><span class="w"> </span><span class="n">condition1</span><span class="w"> </span><span class="err">[</span><span class="k">AND</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">OR</span><span class="err">]</span><span class="w"> </span><span class="n">condition2…</span><span class="err">]</span>
</code></pre></div>
<h4 id="721where">7.2.1、WHERE的运算符<a class="headerlink" href="#721where" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>=</code></td>
<td>等于</td>
</tr>
<tr>
<td><code>&lt;&gt;</code></td>
<td>不等于。注释：在 SQL 的一些版本中，该操作符可被写成 <code>!=</code></td>
</tr>
<tr>
<td><code>&lt;=&gt;</code></td>
<td>严格比较两个 <code>NULL</code> 值是否相等，两个操作码均为 <code>NULL</code> 时，其所得值为 <code>1</code>；当一个操作码为 <code>NULL</code> 时，其所得值为 <code>0</code></td>
</tr>
<tr>
<td><code>&gt;</code></td>
<td>大于</td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td>小于</td>
</tr>
<tr>
<td><code>&gt;=</code></td>
<td>大于等于</td>
</tr>
<tr>
<td><code>&lt;=</code></td>
<td>小于等于</td>
</tr>
<tr>
<td><code>BETWEEN</code></td>
<td>在某个范围内。实例：<code>BETWEEN 1 AND 3</code> =&gt; [1,3]</td>
</tr>
<tr>
<td><code>LIKE</code></td>
<td>搜索某种模式</td>
</tr>
<tr>
<td><code>IN</code></td>
<td>指定针对某个列的多个可能值。实例：<code>IN(1,2,3)</code></td>
</tr>
<tr>
<td><code>AND</code></td>
<td>与</td>
</tr>
<tr>
<td><code>OR</code></td>
<td>或</td>
</tr>
<tr>
<td><code>NOT</code></td>
<td>非</td>
</tr>
</tbody>
</table>
<p><strong>MySQL的整除和取余</strong></p>
<p>整除：<code>DIV</code></p>
<div class="highlight"><pre><span></span><code><span class="mi">5</span><span class="w"> </span><span class="k">DIV</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</code></pre></div>
<p>取余：<code>MOD</code></p>
<div class="highlight"><pre><span></span><code><span class="mi">5</span><span class="w"> </span><span class="k">MOD</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<h4 id="722like">7.2.2、LIKE 子句<a class="headerlink" href="#722like" title="Permanent link">&para;</a></h4>
<p><code>LIKE</code> 子句中使用百分号 <code>%</code> 字符来表示任何字符，类似于 <code>UNIX</code> 或正则表达式中的星号 <code>*</code>，如果没有使用百分号 <code>%</code>，<code>LIKE</code> 子句与等号 <code>=</code> 的效果是一样的。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">field1</span><span class="p">,</span><span class="w"> </span><span class="n">field2</span><span class="p">,</span><span class="n">…fieldN</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">field1</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="n">condition1</span><span class="w"> </span><span class="err">[</span><span class="k">and</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">or</span><span class="err">]</span><span class="w"> </span><span class="n">field2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;someVALUE&#39;</span>
</code></pre></div>
<ul>
<li>可以在 <code>WHERE</code> 子句中指定任何条件</li>
<li>可以在 <code>WHERE</code> 子句中使用 <code>LIKE</code> 子句</li>
<li>可以使用 <code>LIKE</code> 子句代替等号 <code>=</code></li>
<li><code>LIKE</code> 通常与 <code>%</code> 一同使用，类似于一个元字符的搜索</li>
<li>可以使用 <code>and</code> 或者 <code>or</code> 指定一个或多个条件</li>
<li>可以在 <code>UPDATE</code> 或 <code>DELETE</code> 命令使用 <code>WHERE…LIKE</code> 子句来指定条件 </li>
<li>MYSQL 不区分大小写，因此 <code>LIKE</code> 也是，如果想要区分大小写，在 <code>LIKE</code> 后面加上 <code>BINARY</code>，表示区分大小写</li>
</ul>
<p>在 <code>WHERE</code> <code>LIKE</code> 的条件查询中，MySQL 有两种匹配方式</p>
<ul>
<li><code>%</code>：表示任意 0 个或多个字符，可匹配任意类型和长度的字符，有些情况下若是中文，请使用两个百分号（<code>%%</code>）表示。</li>
<li><code>_</code>：表示任意单个字符，匹配单个任意字符，常用来限制表达式的字符长度语句。 </li>
</ul>
<h4 id="723exists">7.2.3、EXISTS 运算符<a class="headerlink" href="#723exists" title="Permanent link">&para;</a></h4>
<p><code>EXISTS</code> 运算符用于判断查询子句是否有记录，如果有一条或多条记录存在返回 True，否则返回 False。</p>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span>
<span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">column_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">condition</span><span class="p">);</span>
</code></pre></div>
<p><strong>IN 和 EXISTS 的区别和分析</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">B</span><span class="p">);</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>
</code></pre></div>
<p>对于以上两种情况，<code>IN</code> 是在内存里遍历比较，而 <code>EXISTS</code> 需要查询数据库，所以当 B 表数据量较大时， <code>EXISTS</code> 效率优于 <code>IN</code>。</p>
<p><code>IN()</code> 只执行一次，它查出 B 表中的所有 id 字段并缓存起来。之后，检查 A 表的 id 是否与 B 表中的 id 相等，如果相等则将 A 表的记录加入结果集中，直到遍历完 A 表的所有记录。</p>
<p>可以看出，当 B 表数据较大时不适合使用 <code>IN()</code>，因为它会 B 表数据全部遍历一次。</p>
<ul>
<li>A 表有 10000 条记录，B 表有 1000000 条记录，那么最多有可能遍历 10000*1000000 次，效率很差。</li>
<li>A表有 10000 条记录，B表有 100 条记录，那么最多有可能遍历 10000*100 次，遍历次数大大减少，效率大大提升。</li>
</ul>
<p><code>EXISTS()</code> 会执行 A.length 次，它并不缓存 <code>EXISTS()</code> 结果集，因为 <code>EXISTS()</code> 结果集的内容并不重要，重要的是其内查询语句的结果集空或者非空，空则返回 <code>false</code>，非空则返回 <code>true</code>。</p>
<p>当 B 表比 A 表数据大时适合使用 <code>EXISTS()</code>，因为它没有那么多遍历操作，只需要再执行一次查询就行。</p>
<ul>
<li>A 表有 10000 条记录，B 表有 1000000 条记录，那么 <code>EXISTS()</code> 会执行 10000 次去判断 A 表中的 id 是否与 B 表中的 id 相等。</li>
<li>A 表有 10000 条记录，B 表有 100000000 条记录，那么 <code>EXISTS()</code> 还是执行 10000次，因为它只执行 A.length 次，可见 B 表数据越多，越适合 <code>EXISTS()</code> 发挥效果。</li>
<li>A 表有 10000 条记录，B 表有 100 条记录，那么 <code>EXISTS()</code> 还是执行 10000 次，还不如使用 <code>IN()</code> 遍历 10000*100 次，因为 <code>IN()</code> 是在内存里遍历比较，而 <code>EXISTS()</code> 需要查询数据库，我们都知道查询数据库所消耗的性能更高，而内存比较很快。</li>
</ul>
<h3 id="73">7.3、连接的使用<a class="headerlink" href="#73" title="Permanent link">&para;</a></h3>
<p>可以在 <code>SELECT</code>、<code>UPDATE</code> 和 <code>DELETE</code> 语句中使用 MySQL 的 <code>JOIN</code> 来联合多表查询。</p>
<p>下文将使用两个数据库表 Table_A 和 Table_B 来进行示例讲解，其结构与数据分别如下：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Table_A</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PK</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">PK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w">   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------+</span>
<span class="o">|</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ab</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">a</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Table_B</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PK</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">PK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w">   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------+</span>
<span class="o">|</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ab</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">b</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<p>其中 PK 为 1 的记录在 Table_A 和 Table_B 中都有，2 为 Table_A 特有，3 为 Table_B 特有。</p>
<h4 id="731inner-join">7.3.1、INNER JOIN<a class="headerlink" href="#731inner-join" title="Permanent link">&para;</a></h4>
<p><code>INNER JOIN</code> 一般被译作内连接。内连接查询能将左表（表 A）和右表（表 B）中能关联起来的数据连接后返回。</p>
<p><img alt="INNER JOIN" src="E:\Users\Orichalcos\Documents\Note\Markdown!assets\MySQL\inner-join.png" /></p>
<p>示例查询：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_PK</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">B_PK</span><span class="p">,</span>
<span class="w">       </span><span class="n">A</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_Value</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">B_Value</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Table_A</span><span class="w"> </span><span class="n">A</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Table_B</span><span class="w"> </span><span class="n">B</span>
<span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">PK</span><span class="p">;</span>
</code></pre></div>
<p>查询结果：</p>
<div class="highlight"><pre><span></span><code><span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">A_PK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">B_PK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">A_Value</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">B_Value</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ab</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ab</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<h4 id="732left-join">7.3.2、LEFT JOIN<a class="headerlink" href="#732left-join" title="Permanent link">&para;</a></h4>
<p><code>LEFT JOIN</code> 一般被译作左连接，也写作 <code>LEFT OUTER JOIN</code>。左连接查询会返回左表（表 A）中所有记录，不管右表（表 B）中有没有关联的数据。在右表中找到的关联数据列也会被一起返回。</p>
<p><img alt="LEFT JOIN" src="%21assets/MySQL/left-join.png" /></p>
<p>示例查询：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_PK</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">B_PK</span><span class="p">,</span>
<span class="w">       </span><span class="n">A</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_Value</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">B_Value</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Table_A</span><span class="w"> </span><span class="n">A</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Table_B</span><span class="w"> </span><span class="n">B</span>
<span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">PK</span><span class="p">;</span>
</code></pre></div>
<p>查询结果：</p>
<div class="highlight"><pre><span></span><code><span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">A_PK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">B_PK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">A_Value</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">B_Value</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ab</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">a</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<h4 id="733right-join">7.3.3、RIGHT JOIN<a class="headerlink" href="#733right-join" title="Permanent link">&para;</a></h4>
<p><code>RIGHT JOIN</code> 一般被译作右连接，也写作 <code>RIGHT OUTER JOIN</code>。右连接查询会返回右表（表 B）中所有记录，不管左表（表 A）中有没有关联的数据。在左表中找到的关联数据列也会被一起返回。</p>
<p><img alt="RIGHT JOIN" src="%21assets/MySQL/right-join.png" /></p>
<p>示例查询：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_PK</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">B_PK</span><span class="p">,</span>
<span class="w">       </span><span class="n">A</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_Value</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">B_Value</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Table_A</span><span class="w"> </span><span class="n">A</span>
<span class="k">RIGHT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Table_B</span><span class="w"> </span><span class="n">B</span>
<span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">PK</span><span class="p">;</span>
</code></pre></div>
<p>查询结果：</p>
<div class="highlight"><pre><span></span><code><span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">A_PK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">B_PK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">A_Value</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">B_Value</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ab</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">b</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<h4 id="734full-join">7.3.4、FULL JOIN<a class="headerlink" href="#734full-join" title="Permanent link">&para;</a></h4>
<p><code>FULL JOIN</code> 一般被译作外连接、全连接，实际查询语句中可以写作 <code>FULL OUTER JOIN</code>。外连接查询能返回左右表里的所有记录，其中左右表里能关联起来的记录被连接后返回。</p>
<p><img alt="FULL OUTER JOIN" src="%21assets/MySQL/full-outer-join.png" /></p>
<p>示例查询：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_PK</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">B_PK</span><span class="p">,</span>
<span class="w">       </span><span class="n">A</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_Value</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">B_Value</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Table_A</span><span class="w"> </span><span class="n">A</span>
<span class="k">FULL</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Table_B</span><span class="w"> </span><span class="n">B</span>
<span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">PK</span><span class="p">;</span>
</code></pre></div>
<p>查询结果：</p>
<div class="highlight"><pre><span></span><code><span class="n">ERROR</span><span class="w"> </span><span class="mi">1064</span><span class="w"> </span><span class="p">(</span><span class="mi">42000</span><span class="p">):</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="k">SQL</span><span class="w"> </span><span class="n">syntax</span><span class="p">;</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">manual</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">corresponds</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="k">version</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">right</span><span class="w"> </span><span class="n">syntax</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">near</span><span class="w"> </span><span class="s1">&#39;FULL JOIN Table_B B</span>
<span class="s1">ON A.PK = B.PK&#39;</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">4</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MySQL 不支持 <code>FULL JOIN</code>。</p>
</div>
<p>应当返回的结果（使用 <code>UNION</code> 模拟）：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w">    </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Table_A</span>
<span class="w">    </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Table_B</span><span class="w"> </span>
<span class="w">    </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Table_A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Table_B</span><span class="p">.</span><span class="n">PK</span>
<span class="w">    </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">    </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="w">    </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Table_A</span>
<span class="w">    </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">RIGHT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Table_B</span><span class="w"> </span>
<span class="w">    </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Table_A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Table_B</span><span class="p">.</span><span class="n">PK</span>
<span class="w">    </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Table_A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+---------+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">PK</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">PK</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w">   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+---------+------+---------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ab</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">a</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">b</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+---------+------+---------+</span>
<span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<h4 id="735cross-join">7.3.5、CROSS JOIN<a class="headerlink" href="#735cross-join" title="Permanent link">&para;</a></h4>
<p>返回左表与右表之间符合条件的记录的迪卡尔集。</p>
<p><img alt="CORSS JOIN" src="%21assets/MySQL/cross-join.png" /></p>
<p>示例查询：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_PK</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">PK</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">B_PK</span><span class="p">,</span>
<span class="w">       </span><span class="n">A</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">A_Value</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">B_Value</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Table_A</span><span class="w"> </span><span class="n">A</span>
<span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Table_B</span><span class="w"> </span><span class="n">B</span><span class="p">;</span>
</code></pre></div>
<p>查询结果：</p>
<div class="highlight"><pre><span></span><code><span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">A_PK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">B_PK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">A_Value</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">B_Value</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ab</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">a</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">ab</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">b</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">a</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">b</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+---------+---------+</span>
<span class="mi">4</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<p>上面讲过的几种 <code>JOIN</code> 查询的结果都可以用 <code>CROSS JOIN</code> 加条件模拟出来，比如 <code>INNER JOIN</code> 对应 <code>CROSS JOIN ... WHERE A.PK = B.PK</code>。</p>
<h4 id="736onwhere">7.3.6、ON、WHERE 的区别<a class="headerlink" href="#736onwhere" title="Permanent link">&para;</a></h4>
<p>数据库在通过连接两张或多张表来返回记录时，都会生成一张中间的临时表，然后再将这张临时表返回给用户。</p>
<p>在使用 <code>LEFT JOIN</code> 时，<code>ON</code> 和 <code>WHERE</code> 条件的区别如下：</p>
<ol>
<li><code>ON</code> 条件是在生成临时表时使用的条件，它不管 <code>ON</code> 中的条件是否为真，都会返回左边表中的记录。</li>
<li><code>WHERE</code> 条件是在临时表生成好后，再对临时表进行过滤的条件。这时已经没有 <code>LEFT JOIN</code> 的含义（必须返回左边表的记录）了，条件不为真的就全部过滤掉。</li>
</ol>
<p>假设有两张表：</p>
<p><img src="!assets/MySQL/image-20211129161954956.png" alt="image-20211129161954956" style="" /></p>
<p><img src="!assets/MySQL/image-20211129162050479.png" alt="image-20211129162050479" style="" /></p>
<p>两条 SQL：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tab1</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">tab2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">(</span><span class="n">tab1</span><span class="p">.</span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tab2</span><span class="p">.</span><span class="k">size</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">tab2</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;AAA&#39;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tab1</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">tab2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">(</span><span class="n">tab1</span><span class="p">.</span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tab2</span><span class="p">.</span><span class="k">size</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">tab2</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="err">&#39;</span><span class="n">AAA</span><span class="err">’</span><span class="p">)</span>
</code></pre></div>
<p>两条 SQL 的执行过程：</p>
<p><img src="!assets/MySQL/image-20211129162254328.png" alt="image-20211129162254328" style="" /></p>
<p><img src="!assets/MySQL/image-20211129162304566.png" alt="image-20211129162304566" style="" /></p>
<h3 id="74">7.4、排序<a class="headerlink" href="#74" title="Permanent link">&para;</a></h3>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">field1</span><span class="p">,</span><span class="n">field2</span><span class="p">,</span><span class="n">…fieldN</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">TABLE_name1</span><span class="p">,</span><span class="w"> </span><span class="n">TABLE_name2…</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">field1</span><span class="w"> </span><span class="err">[</span><span class="k">ASC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">DESC</span><span class="err">][</span><span class="n">默认ASC</span><span class="err">]</span><span class="p">,</span><span class="w"> </span><span class="err">[</span><span class="n">field2…</span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="k">ASC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">DESC</span><span class="err">][</span><span class="n">默认ASC</span><span class="err">]</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>你可以使用任何字段来作为排序的条件，从而返回排序后的查询结果</li>
<li>你可以设定多个字段来排序</li>
<li>你可以使用ASC或DESC关键字来设置查询结果是按升序或降序排列。默认情况下，它是按升序排列</li>
<li>你可以添加WHERE…LIKE子句来设置条件</li>
</ul>
<p><strong>ORDER BY多列</strong></p>
<p>ORDER BY多列的时候，先按照第一个column_name排序，再按照第二个column_name排序。</p>
<ul>
<li>ORDER BY A,B    这个时候都是默认按升序排列</li>
<li>ORDER BY A desc,B 这个时候A降序，B升序排列</li>
<li>ORDER BY A, B desc 这个时候A升序，B降序排列</li>
</ul>
<p><strong>MySQL拼音排序</strong></p>
<p>如果字符集采用的是gbk（汉字编码字符集），直接在查询语句后边添加ORDER BY：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">&lt;</span><span class="n">字段名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span>
</code></pre></div>
<p>如果字符集采用的是utf8（万国码），需要先对字段进行转码然后排序：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="o">&lt;</span><span class="n">字段名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">gbk</span><span class="p">)</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span>
</code></pre></div>
<h3 id="75">7.5、分组<a class="headerlink" href="#75" title="Permanent link">&para;</a></h3>
<p><code>GROUP BY</code> 语句根据一个或多个列对结果集进行分组，<code>GROUP BY</code> 子句经常使用与聚合函数，例如<code>SUM</code>、<code>AVG</code>、<code>MAX</code>、<code>MIN</code> 和 <code>COUNT</code>。</p>
<p><code>GROUP BY</code> 语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">column_name</span><span class="p">,</span><span class="k">FUNCTION</span><span class="p">(</span><span class="n">cloumns_name</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">columns_name</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="k">VALUE</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">column_name</span><span class="p">;</span>
</code></pre></div>
<p><code>GROUP BY</code> 必须出现在 <code>FROM</code> 和 <code>WHERE</code> 之后。</p>
<p><strong>去重统计</strong></p>
<p><code>COUNT()</code> 聚合函数可配合 <code>DISTINCT</code> 关键字达到去重统计的效果：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">去重字段</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表</span><span class="o">&gt;</span>
</code></pre></div>
<h4 id="751rollup">7.5.1、ROLLUP<a class="headerlink" href="#751rollup" title="Permanent link">&para;</a></h4>
<p>在数据库查询语句中，在 <code>GROUP BY</code> 表达式之后加上 <code>WITH ROLLUP</code> 语句，可以在查询结果中包含更多高层级的统计输出。ROLLUP 功能使得可以通过单个查询语句来实现对数据进行不同层级上的分析与统计。因此，ROLLUP 功能能够很好得为 OLAP（Online Analytical Processing）任务提供支持。</p>
<h5 id="_13">功能介绍<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h5>
<p>假如有一个 <code>sales</code> 表有 <code>year</code>、<code>country</code>、<code>product</code> 和 <code>profit</code> 四列，其中 <code>profit</code> 列为某年份某个国家的某种产品的一条收益。数据表的创建语句如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">sales</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="kt">year</span><span class="w"> </span><span class="kt">INT</span><span class="p">,</span>
<span class="w">    </span><span class="n">country</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="w">    </span><span class="n">product</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
<span class="w">    </span><span class="n">profit</span><span class="w"> </span><span class="kt">INT</span>
<span class="p">);</span>
</code></pre></div>
<p>为了方便演示，在数据表中插入如下数据：</p>
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span>
<span class="w">    </span><span class="n">sales</span><span class="w"> </span><span class="p">(</span><span class="kt">year</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">profit</span><span class="p">)</span>
<span class="k">VALUES</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Finland&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Computer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Finland&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Computer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;India&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Calculator&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">150</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;India&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Computer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">400</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Finland&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Calculator&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Computer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2700</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TV&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;India&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Computer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;India&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Computer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Calculator&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">75</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Computer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1500</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TV&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">249</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Finland&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
</code></pre></div>
<p>我们经常需要使用如下查询语句对某年份某个国家的某种产品的总收益进行汇总：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="kt">year</span><span class="p">,</span>
<span class="w">    </span><span class="n">country</span><span class="p">,</span>
<span class="w">    </span><span class="n">product</span><span class="p">,</span>
<span class="w">    </span><span class="nf">SUM</span><span class="p">(</span><span class="n">profit</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">profit</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">sales</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
<span class="w">    </span><span class="kt">year</span><span class="p">,</span>
<span class="w">    </span><span class="n">country</span><span class="p">,</span>
<span class="w">    </span><span class="n">product</span><span class="p">;</span>
</code></pre></div>
<p>查询结果为：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------+---------+------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">profit</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">150</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1200</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">50</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">2700</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">TV</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="mi">250</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+</span>
</code></pre></div>
<p>通常情况下，我们不光需要这种最高层次的统计结果，也需要在更低的层次进行分析。比如说，某年份某个国家在所有产品的收益总和，或者某年份所有国家的收益总和。为了达到这样的效果，我们可能需要对 Group By List 中的属性列进行调整，并重新执行查询语句得到我们需要的结果。但是 ROLLUP 功能使得我们可以仅通过一条查询语句实现上述效果：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="kt">year</span><span class="p">,</span>
<span class="w">    </span><span class="n">country</span><span class="p">,</span>
<span class="w">    </span><span class="n">product</span><span class="p">,</span>
<span class="w">    </span><span class="nf">SUM</span><span class="p">(</span><span class="n">profit</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">profit</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">sales</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
<span class="w">    </span><span class="kt">year</span><span class="p">,</span>
<span class="w">    </span><span class="n">country</span><span class="p">,</span>
<span class="w">    </span><span class="n">product</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">ROLLUP</span><span class="p">;</span>
</code></pre></div>
<p>查询结果为：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------+---------+------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">profit</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">1600</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">150</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1200</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">1350</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">1575</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">4525</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">50</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">2700</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">TV</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="mi">250</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">3000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">3010</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+</span>
</code></pre></div>
<p>查询结果中的 <code>NULL</code> 值表示该行输出为更低层次上的聚合结果，在带 <code>WITH ROLLUP</code> 的聚合时，每当 <code>GROUP BY</code> 的属性列（非最后一列）的值发生变化时，查询结果中都会产生额外的聚合行。</p>
<p>因此，借助 <code>ROLLUP</code>，我们通过一条查询语句就能够得到 <code>GROUP BY</code> 的属性列在不同层次上的聚合结果。适用于需要在不同层次上对数据进行统计分析的场景，不仅省去了写多条查询语句重复查询的麻烦，而且提升了执行效果。</p>
<h5 id="grouping">GROUPING()<a class="headerlink" href="#grouping" title="Permanent link">&para;</a></h5>
<p>要检查 <code>NULL</code> 结果集中是否表示小计或总计，请使用 <code>GROUPING()</code> 函数。</p>
<p>当 <code>NULL</code> 在超级聚合时，<code>GROUPING()</code> 函数返回 <code>1</code> ，否则返回 <code>0</code>。<code>GROUPING()</code> 函数可用于查询，<code>HAVING</code> 子句和 <code>ORDER BY</code> 子句。</p>
<blockquote>
<p>该函数从 MySQL 8.0 开始支持</p>
</blockquote>
<p>请考虑以下查询：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="kt">year</span><span class="p">,</span>
<span class="w">    </span><span class="n">country</span><span class="p">,</span>
<span class="w">    </span><span class="n">product</span><span class="p">,</span>
<span class="w">    </span><span class="nf">SUM</span><span class="p">(</span><span class="n">profit</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">profit</span><span class="p">,</span>
<span class="w">    </span><span class="k">GROUPING</span><span class="p">(</span><span class="kt">year</span><span class="p">),</span>
<span class="w">    </span><span class="k">GROUPING</span><span class="p">(</span><span class="n">country</span><span class="p">),</span>
<span class="w">    </span><span class="k">GROUPING</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">sales</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
<span class="w">    </span><span class="kt">year</span><span class="p">,</span>
<span class="w">    </span><span class="n">country</span><span class="p">,</span>
<span class="w">    </span><span class="n">product</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">ROLLUP</span><span class="p">;</span>
</code></pre></div>
<p>查询结果为：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------+---------+------------+--------+----------------+-------------------+-------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">profit</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">GROUPING</span><span class="p">(</span><span class="kt">year</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">GROUPING</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">GROUPING</span><span class="p">(</span><span class="n">product</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+----------------+-------------------+-------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">1600</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">150</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1200</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">1350</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">1575</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">4525</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">50</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">2700</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">TV</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="mi">250</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">3000</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">3010</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+----------------+-------------------+-------------------+</span>
</code></pre></div>
<p>当 <code>NULL</code> 在 <code>year</code>  列发生在行聚合时， <code>GROUPING(year)</code> 返回 <code>1</code>，否则为 <code>0</code>。类似地，当 <code>NULL</code> 在 <code>country</code> 列发生行聚合时， <code>GROUPING(country)</code> 返回 <code>1</code> ，否则为 <code>0</code>。</p>
<p>我们经常使用 <code>GROUPING()</code> 函数将有意义的标签替换为超级聚合 <code>NULL</code> 值，而不是直接显示它。</p>
<p>以下示例显示如何将 <code>IF()</code> 函数与 <code>GROUPING()</code> 函数组合以替换超聚合 <code>NULL</code> 值 <code>year</code>、<code>counttry</code> 和 <code>product</code> 列中的标签：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="k">IF</span><span class="p">(</span><span class="k">GROUPING</span><span class="p">(</span><span class="kt">year</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;ALL Years&#39;</span><span class="p">,</span><span class="w"> </span><span class="kt">year</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="kt">year</span><span class="p">,</span>
<span class="w">    </span><span class="k">IF</span><span class="p">(</span><span class="k">GROUPING</span><span class="p">(</span><span class="n">country</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;ALL countrys&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">country</span><span class="p">,</span>
<span class="w">    </span><span class="k">IF</span><span class="p">(</span><span class="k">GROUPING</span><span class="p">(</span><span class="n">product</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;ALL products&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">product</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">product</span><span class="p">,</span>
<span class="w">    </span><span class="nf">SUM</span><span class="p">(</span><span class="n">profit</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">profit</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">sales</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
<span class="w">    </span><span class="kt">year</span><span class="p">,</span>
<span class="w">    </span><span class="n">country</span><span class="p">,</span>
<span class="w">    </span><span class="n">product</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">ROLLUP</span><span class="p">;</span>
</code></pre></div>
<p>输出结果：</p>
<div class="highlight"><pre><span></span><code><span class="o">+-----------+--------------+--------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">year</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">product</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">profit</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-----------+--------------+--------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">     </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">        </span><span class="o">|</span><span class="w">    </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1600</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="mi">150</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">     </span><span class="o">|</span><span class="w">   </span><span class="mi">1200</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1350</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">     </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1575</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">countrys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">4525</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">        </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">50</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">     </span><span class="o">|</span><span class="w">   </span><span class="mi">2700</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">TV</span><span class="w">           </span><span class="o">|</span><span class="w">    </span><span class="mi">250</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">3000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">countrys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">3010</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">Years</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">countrys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-----------+--------------+--------------+--------+</span>
</code></pre></div>
<h4 id="752having">7.5.2、HAVING 子句<a class="headerlink" href="#752having" title="Permanent link">&para;</a></h4>
<p>增加 <code>HAVING</code> 子句的原因是，<code>WHERE</code> 关键字无法与聚合函数一起使用。</p>
<p><code>HAVING</code> 子句可以筛选分组后的各组数据。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">HAVING</span><span class="w"> </span><span class="o">&lt;</span><span class="n">条件</span><span class="o">&gt;</span>
</code></pre></div>
<p>其中，<code>&lt;条件&gt;</code> 指的是指定的过滤条件。</p>
<p><code>HAVING</code> 子句和 <code>WHERE</code> 子句非常相似，<code>HAVING</code> 子句支持 <code>WHERE</code> 子句中所有的操作符和语法，但是两者存在几点差异：</p>
<ul>
<li><code>WHERE</code> 子句主要用于过滤数据行，而 <code>HAVING</code> 子句主要用于过滤分组，即 <code>HAVING</code> 子句基于分组的聚合值而不是特定行的值来过滤数据。</li>
<li><code>WHERE</code> 子句不可以包含聚合函数，<code>HAVING</code> 子句中的条件可以包含聚合函数。</li>
<li><code>HAVING</code> 子句是在数据分组后进行过滤，<code>WHERE</code> 子句会在数据分组前进行过滤。<code>WHERE</code> 子句排除的行不包含在分组中，可能会影响 <code>HAVING</code> 子句基于这些值过滤掉的分组。</li>
</ul>
<p><strong>实例：</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">goods_price</span><span class="p">,</span><span class="n">goods_name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">sw_goods</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">goods_price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span>

<span class="k">select</span><span class="w"> </span><span class="n">goods_price</span><span class="p">,</span><span class="n">goods_name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">sw_goods</span><span class="w"> </span><span class="k">having</span><span class="w"> </span><span class="n">goods_price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span>
</code></pre></div>
<p>上面的 <code>HAVING</code> 可以用的前提是我已经筛选出了 <code>goods_price</code> 字段，在这种情况下和 <code>WHERE</code> 的效果是等效的，但是如果我没有 <code>select goods_price</code> 就会报错！！因为 <code>HAVING</code> 是从前面筛选的字段再筛选，而 <code>WHERE</code> 是从数据表中的字段直接进行的筛选的。</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">goods_name</span><span class="p">,</span><span class="n">goods_number</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">sw_goods</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">goods_price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span>

<span class="k">select</span><span class="w"> </span><span class="n">goods_name</span><span class="p">,</span><span class="n">goods_number</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">sw_goods</span><span class="w"> </span><span class="k">having</span><span class="w"> </span><span class="n">goods_price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">//</span><span class="n">报错！！！因为前面并没有筛选出</span><span class="w"> </span><span class="n">goods_price</span><span class="w"> </span><span class="n">字段</span>
</code></pre></div>
<h3 id="76">7.6、正则表达式<a class="headerlink" href="#76" title="Permanent link">&para;</a></h3>
<p>MySQL 同样支持其他正则表达式的匹配，MySQL 中使用 <code>REGEXP</code> 或 <code>NOT REGEXP</code>（或 <code>RLIKE</code> 和 <code>NOT RLIKE</code> ）运算符来进行正则表达式匹配</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>^</td>
<td>匹配输入字符串的开始位置</td>
</tr>
<tr>
<td>$</td>
<td>匹配输入字符串的结束位置</td>
</tr>
<tr>
<td>.</td>
<td>匹配除 "\n" 之外的任何单个字符</td>
</tr>
<tr>
<td>[…]</td>
<td>字符集合。匹配所包含的任意一个字符。例如， '[abc]' 可以匹配 "plain" 中的 'a'。</td>
</tr>
<tr>
<td>[^…]</td>
<td>负值字符集合。匹配未包含的任意字符。例如， <code>[^abc]</code> 可以匹配 "plain" 中的'p'。</td>
</tr>
<tr>
<td>字符串</td>
<td>例如 'in' ,可以匹配 'china' , 'chinese'</td>
</tr>
<tr>
<td>p1|p2|p3</td>
<td>匹配 p1或 p2 或 p3。例如，'z|foood' 能匹配 'z' 或 'food'。'(z|f)ood' 则匹配 'zood' 或 'food'</td>
</tr>
<tr>
<td>*</td>
<td>匹配前面的子表达式零次或多次。例如，zo<em> 能匹配 'z' 以及 'zoo'。</em> 等价于{0,}</td>
</tr>
<tr>
<td>+</td>
<td>匹配前面的子表达式一次或多次。例如，'zo+' 能匹配 "zo" 以及 "zoo"，但不能匹配 "z"。+ 等价于 {1,}。</td>
</tr>
<tr>
<td>{n}</td>
<td>n 是一个非负整数。匹配确定的至少n次。例如，'o{2}' 不能匹配 'Bob' 中的 'o'，但是能匹配 "food" 中的两个 o。</td>
</tr>
<tr>
<td>{n,m}</td>
<td>m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。</td>
</tr>
</tbody>
</table>
<p>实例：</p>
<p>查找name字段中以'st'为开头的所有数据：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">person_tbl</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="k">REGEXP</span><span class="w"> </span><span class="s1">&#39;^st&#39;</span><span class="p">;</span>
</code></pre></div>
<p>查找name字段中以'ok'为结尾的所有数据：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">person_tbl</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="k">REGEXP</span><span class="w"> </span><span class="s1">&#39;ok$&#39;</span><span class="p">;</span>
</code></pre></div>
<p>查找name字段中包含'mar'字符串的所有数据：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">person_tbl</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="k">REGEXP</span><span class="w"> </span><span class="s1">&#39;mar&#39;</span><span class="p">;</span>
</code></pre></div>
<p>查找name字段中以元音字符开头或以'ok'字符串结尾的所有数据：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">person_tbl</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="k">REGEXP</span><span class="w"> </span><span class="s1">&#39;^[aeiou]|ok$&#39;</span><span class="p">;</span>
</code></pre></div>
<h3 id="77union">7.7、UNION<a class="headerlink" href="#77union" title="Permanent link">&para;</a></h3>
<p>描述：</p>
<p>UNION操作符用于连接两个以上的SELECT语句的结果组合到一个结果集中，多个SELECT语句会删除重复的数据</p>
<p>注意：UNION内部每个SELECT语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每个SELECT语句中的列的顺序必须相同。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">expression1</span><span class="p">,</span><span class="w"> </span><span class="n">expression2</span><span class="p">,</span><span class="w"> </span><span class="n">…expression_n</span>
<span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span>
<span class="err">[</span><span class="k">WHERE</span><span class="w"> </span><span class="n">conditions</span><span class="err">]</span>
<span class="k">UNION</span><span class="w"> </span><span class="err">[</span><span class="k">ALL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">DISTINCT</span><span class="err">]</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">expression1</span><span class="p">,</span><span class="w"> </span><span class="n">expression2</span><span class="p">,</span><span class="n">…expressoion_n</span>
<span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span>
<span class="err">[</span><span class="k">WHERE</span><span class="w"> </span><span class="n">conditions</span><span class="err">]</span><span class="p">;</span>
</code></pre></div>
<p>参数：</p>
<ul>
<li>expression：要检索的列</li>
<li>WHERE conditions：可选，检索条件</li>
<li>DISTINCT：可选，删除结果集中重复的数据。默认情况下UNION操作符已经删除了重复数据，所以DISTINCT修饰符对结果没啥影响</li>
<li>ALL：可选，返回所有结果集，包含重复数据</li>
</ul>
<h3 id="78null">7.8、NULL 值处理<a class="headerlink" href="#78null" title="Permanent link">&para;</a></h3>
<p>MySQL使用SELECT命令及WHERE子句来读取数据表中的数据，但是当提供的查询条件字段为NULL时，该命令就无法正常工作</p>
<p>为了处理这种情况，MySQL提供了三大运算符：</p>
<ul>
<li>IS NULL：当列的值是NULL，此运算符返回TRUE</li>
<li>IS NOT NULL：当列的值不为NULL，运算符返回TRUE</li>
<li>&lt;=&gt;：比较操作符（不同于=运算符），当比较的两个值为NULL时返回TRUE</li>
</ul>
<p>关于NULL的条件比较运算是比较特殊的。不能使用=NULL或!=NULL在列中查找NULL值。</p>
<p>在MySQL中，NULL值与任何其他值比较（即使是NULL）永远返回false，即NULL=NULL返回FALSE。</p>
<p>实例：</p>
<p><img src="!assets/MySQL/image-20200531163220282.png" alt="image-20200531163220282" style="zoom:80%;" /></p>
<p>当输出列中有NULL值时可以使用函数IFNULL()或COALESCE()</p>
<h3 id="79withcte">7.9、WITH（CTE）<a class="headerlink" href="#79withcte" title="Permanent link">&para;</a></h3>
<p>MySQL 的 CTE 是在 MySQL 8.0 版本开始支持的，公用表表达式 （CTE） 是一个命名的临时结果集，它存在于单个语句的范围内，以后可以在该语句中引用，可能多次引用。</p>
<h4 id="791">7.9.1、公用表表达式<a class="headerlink" href="#791" title="Permanent link">&para;</a></h4>
<p>若要指定公用表表达式，请使用具有一个或多个逗号分隔子句的 <code>WITH</code> 子句。每个子句提供一个子查询，该子查询产生一个结果集，并将名称与子查询相关联。 下面的示例定义名为的 <code>cte1</code> 和 <code>cte2</code> 中 <code>WITH</code> 子句，并在 <code>WITH</code> 子句后面的 <code>SELECT</code> 中引用了它们：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span>
<span class="w">  </span><span class="n">cte1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">table1</span><span class="p">),</span>
<span class="w">  </span><span class="n">cte2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">table2</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte1</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">cte2</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">cte1</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cte2</span><span class="p">.</span><span class="n">c</span><span class="p">;</span>
</code></pre></div>
<p>在包含 <code>WITH</code> 子句的语句中，可以引用每个 CTE 名称来访问相应的 CTE 结果集。</p>
<p>CTE 名称可以在其他 CTE 中引用，从而可以根据其他 CTE 定义 CTE。</p>
<p>CTE 可以引用自身来定义递归 CTE。递归 CTE 的常见应用包括序列生成和层次结构或树结构数据的遍历。</p>
<p>公用表表达式是 DML 语句语法的可选部分。它们是使用 <code>WITH</code> 子句定义的：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="err">[</span><span class="k">RECURSIVE</span><span class="err">]</span>
<span class="w">    </span><span class="n">cte_name</span><span class="w"> </span><span class="err">[</span><span class="p">(</span><span class="n">col_name</span><span class="w"> </span><span class="err">[</span><span class="p">,</span><span class="w"> </span><span class="n">col_name</span><span class="err">]</span><span class="w"> </span><span class="p">...)</span><span class="err">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="n">subquery</span><span class="p">)</span>
<span class="w">    </span><span class="err">[</span><span class="p">,</span><span class="w"> </span><span class="n">cte_name</span><span class="w"> </span><span class="err">[</span><span class="p">(</span><span class="n">col_name</span><span class="w"> </span><span class="err">[</span><span class="p">,</span><span class="w"> </span><span class="n">col_name</span><span class="err">]</span><span class="w"> </span><span class="p">...)</span><span class="err">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="n">subquery</span><span class="p">)</span><span class="err">]</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
<p><em>cte_name</em> 命名单个公共表表达式，并且可以在包含 <code>WITH</code> 子句的语句中用作表引用。</p>
<p><code>AS (subquery)</code> 中的 <em>subquery</em> 被称为 “CTE的子查询”，是产生 CTE 结果集的原因。<code>AS</code> 后面的括号是必需的。</p>
<p>如果公共表表达式的子查询引用自己的名称，则该表达式是递归的。如果 <code>WITH</code> 子句中的任何 CTE 是递归的，则必须包含 <code>RECURSIVE</code> 关键字 。</p>
<p>定义 CTE 的列名有以下情况：</p>
<ul>
<li>
<p>如果 CTE 名称后面有一个带括号的名称列表，这些名称就是列名：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="w"> </span><span class="n">col2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">col1</span><span class="p">,</span><span class="w"> </span><span class="n">col2</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>
</code></pre></div>
<p>列表中的列名数量必须与结果集中的列数量相同。</p>
</li>
<li>
<p>否则，列名来选择列表中第一个 <code>AS (subquery)</code> 部分中第一个 <code>SELECT</code> 的选择列表：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">col1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">col2</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">col1</span><span class="p">,</span><span class="w"> </span><span class="n">col2</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>
</code></pre></div>
</li>
</ul>
<p>在这些情况下，允许使用 <code>WITH</code> 子句：</p>
<ul>
<li>
<p>在 <code>SELECT</code>、<code>UPDATE</code> 和 <code>DELETE</code> 语句的开头。</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="p">...</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
</li>
<li>
<p>在子查询（包括派生表子查询）的开头：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">WITH</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="p">...</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">WITH</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
</li>
<li>
<p>对于包含 <code>SELECT</code> 语句的语句，紧接在 <code>SELECT</code> 之前：</p>
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
<span class="k">REPLACE</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
<span class="k">EXPLAIN</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
</li>
</ul>
<p>同一级别只允许一个 <code>WITH</code> 子句。<code>WITH</code> 后面跟着 <code>WITH</code> 是不允许的，这是非法的：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">cte1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(...)</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">cte2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(...)</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
<p>要使该语句合法，请使用一个 <code>WITH</code> 子句，并用逗号分隔子句：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">cte1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(...),</span><span class="w"> </span><span class="n">cte2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(...)</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
<p>然而，如果多个 <code>WITH</code> 子句出现在不同级别，则语句可以包含多个 <code>WITH</code>子句：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">cte1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">WITH</span><span class="w"> </span><span class="n">cte2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte2</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">cte1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="p">;</span>
</code></pre></div>
<p><code>WITH</code> 子句可以定义一个或多个通用表表达式，但每个 CTE 名称对于该子句必须是唯一的。这是非法的：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">cte1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(...),</span><span class="w"> </span><span class="n">cte1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(...)</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
<p>要使声明合法，请使用唯一名称定义 CTE：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">cte1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(...),</span><span class="w"> </span><span class="n">cte2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(...)</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
<p>一个 CTE 可以引用自己，也可以引用其他 CTE：</p>
<ul>
<li>自引用 CTE 是递归的。</li>
<li>CTE 可以引用前面在同一个 <code>WITH</code> 子句中定义的 CTE，但不能引用后面定义的 CTE。</li>
<li>给定查询块中的 CTE 可以引用在更外部级别的查询块中定义的 CTE，但不能引用在更内部级别的查询块中定义的 CTE。</li>
</ul>
<h4 id="792">7.9.2、递归公用表表达式<a class="headerlink" href="#792" title="Permanent link">&para;</a></h4>
<p>递归常见表表达式是具有引用其自己名称的子查询的表达式。例如：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>
</code></pre></div>
<p>执行时，语句会产生此结果，该结果包含一个简单的线性序列：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w">    </span><span class="o">|</span>
<span class="o">+------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+</span>
</code></pre></div>
<p>递归 CTE 具有以下结构：</p>
<ul>
<li>
<p>如果 <code>WITH</code> 子句中的任何 CTE 指代自己，<code>WITH</code> 子句必须以 <code>WITH RECURSIVE</code> 开始。（如果没有 CTE 指代自己，<code>RECURSIVE</code> 是允许的，但不是必须的。）</p>
<p>如果你忘记了递归 CTE 的 <code>RECURSIVE</code>，则可能会出现以下错误：</p>
<div class="highlight"><pre><span></span><code><span class="k">ERROR</span><span class="w"> </span><span class="mi">1146</span><span class="w"> </span><span class="p">(</span><span class="n">42S02</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="k">Table</span><span class="w"> </span><span class="s1">&#39;cte_name&#39;</span><span class="w"> </span><span class="n">doesn</span><span class="s1">&#39;t exist</span>
</code></pre></div>
</li>
<li>
<p>递归 CTE 子查询有两个部分，用 <code>UNION [ALL]</code> 或 <code>UNION DISTINCT</code> 分开：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w">      </span><span class="c1">-- return initial row set</span>
<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w">      </span><span class="c1">-- return additional row sets</span>
</code></pre></div>
<p>第一个 <code>SELECT</code> 生成 CTE 的初始行或初始行，但不引用 CTE 名称。第二个 <code>SELECT</code> 生成额外的行，并通过在其 <code>FROM</code> 子句中引用 CTE 名称来递归。当此部分不产生新行时，递归结束。因此，递归 CTE 由一个非递归 <code>SELECT</code> 部分和一个递归 <code>SELECT</code> 部分组成。</p>
<p>每个 <code>SELECT</code> 部件本身可以是多个 <code>SELECT</code> 语句的并集。</p>
</li>
<li>
<p>CTE 结果列的类型仅从非递归 <code>SELECT</code> 部分的列类型推断出来，并且所有列都是可为空的。对于类型确定，忽略递归 <code>SELECT</code> 部分。</p>
</li>
<li>
<p>如果非递归部分和递归部分由 <code>UNION DISTINCT</code> 分隔，则消除重复行。这对于执行递归闭合的查询很有用，可以避免无限循环。</p>
</li>
<li>
<p>递归部分的每个迭代只对前一个迭代产生的行进行操作。如果递归部分有多个查询块，每个查询块的迭代将以非指定的顺序调度，每个查询块对其前一次迭代或前一次迭代结束后的其他查询块所产生的行进行操作。</p>
</li>
</ul>
<p>前面显示的递归 CTE 子查询有这个非递归部分，它检索了一条记录来产生初始行集：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>
<p>CTE 子查询还具有此递归部分：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span>
</code></pre></div>
<p>在每个迭代中，<code>SELECT</code> 产生一个新的值，比前一个行集的 <code>n</code> 的值大 <code>1</code>。第一次迭代在初始行集（1）上操作，产生 <code>1+1=2</code>；第二次迭代在第一次迭代的行集（2）上操作，产生 <code>2+1=3</code>；以此类推。这样一直持续到递归结束，当 <code>n</code> 不再小于 <code>5</code> 的时候，递归就结束了。</p>
<p>如果一个 CTE 的递归部分对某一列产生的值比非递归部分更宽，那么可能需要在非递归部分扩大该列，以避免数据被截断。考虑一下这个语句：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;abc&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">str</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nf">CONCAT</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>
</code></pre></div>
<p>在非严格的 SQL 模式下，该语句产生这样的输出：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">str</span><span class="w">  </span><span class="o">|</span>
<span class="o">+------+------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">abc</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">abc</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">abc</span><span class="w">  </span><span class="o">|</span>
<span class="o">+------+------+</span>
</code></pre></div>
<p><code>str</code> 列的值都是 <code>'abc'</code>，因为非递归 <code>SELECT</code> 确定了列的宽度。因此，由递归 <code>SELECT</code>产生的更宽的 <code>str</code> 值被截断了。</p>
<p>在严格 SQL 模式下，该语句会产生错误：</p>
<div class="highlight"><pre><span></span><code><span class="k">ERROR</span><span class="w"> </span><span class="mi">1406</span><span class="w"> </span><span class="p">(</span><span class="mi">22001</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="k">Data</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="s1">&#39;str&#39;</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>
<p>要解决此问题，使语句不会产生截断或错误，请在非递归 <code>SELECT</code> 中使用 <code>CAST()</code>使 <code>str</code> 列变宽：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="nf">CAST</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="kt">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">str</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nf">CONCAT</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>
</code></pre></div>
<p>现在，该语句生成以下结果，没有截断：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------+--------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">str</span><span class="w">          </span><span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">abc</span><span class="w">          </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">abcabc</span><span class="w">       </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">abcabcabcabc</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+--------------+</span>
</code></pre></div>
<p>列是通过名称而不是位置来访问的，这意味着递归部分的列可以访问非递归部分中具有不同位置的列，如这个 CTE 所示：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">q</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>
</code></pre></div>
<p>因为一行的 <code>p</code> 是由前一行的 <code>q</code> 派生出来的，反之亦然，所以正负值在输出的每一行都会交换位置：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">p</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">q</span><span class="w">    </span><span class="o">|</span>
<span class="o">+------+------+------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="o">-</span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="o">-</span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">16</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="o">-</span><span class="mi">16</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+------+------+</span>
</code></pre></div>
<p>一些语法约束适用于递归 CTE 子查询中：</p>
<ul>
<li>
<p>递归 <code>SELECT</code>部分不能包含这些结构：</p>
<ul>
<li>聚合函数，如 <code>SUM()</code></li>
<li>窗口函数</li>
<li><code>GROUP BY</code></li>
<li><code>ORDER BY</code></li>
<li><code>DISTINCT</code></li>
</ul>
<p>在 MySQL 8.0.19 之前，递归 CTE 的递归 <code>SELECT</code> 部分也不能使用 <code>LIMIT</code> 子句。在 MySQL 8.0.19 中取消了这一限制，现在在这种情况下支持 <code>LIMIT</code>，还有一个可选的 <code>OFFSET</code> 子句。对结果集的影响与在最外层的 <code>SELECT</code> 中使用 <code>LIMIT</code> 时相同，但也更有效，因为与递归<code>SELECT</code> 一起使用，一旦产生了所要求的行数，就停止生成行。</p>
<p>这些约束并不适用于递归 CTE 的非递归 <code>SELECT</code> 部分。对 <code>DISTINCT</code> 的禁止只适用于 <code>UNION</code> 成员；<code>UNION DISTINCT</code> 是允许的。</p>
</li>
<li>
<p>递归 <code>SELECT</code> 部分必须只引用一次 CTE，并且只在它的 <code>FROM</code> 子句中，而不是在任何子查询中。它可以引用除 CTE 以外的表，并且用 CTE 连接它们。如果在这样的连接中使用，CTE 不能在 <code>LEFT JOIN</code> 的右边。</p>
</li>
</ul>
<p>对于递归 CTE，递归 <code>SELECT</code> 部分在 <code>EXPLAIN</code> 输出行 <code>Extra</code> 列中显示 <code>Recursive</code>。</p>
<p><code>EXPLAIN</code> 显示的成本估计值代表了每一次迭代的成本，它可能与总成本相差很大。优化器无法预测迭代的次数，因为它无法预测 <code>WHERE</code> 子句在什么时候变成 <code>false</code>。</p>
<p>CTE 的实际成本也可能受到结果集大小的影响。产生许多行的 CTE 可能需要一个足够大的内部临时表来将内存格式转换为磁盘格式，并且可能会损失性能。如果是这样，增加内存中允许的临时表大小可能会提高性能。</p>
<h4 id="793">7.9.3、限制公共表表达式递归<a class="headerlink" href="#793" title="Permanent link">&para;</a></h4>
<p>对于递归 CTE 来说，递归 <code>SELECT</code> 部分包括一个终止递归的条件是很重要的。作为一种防止失控递归 CTE 的开发技术，你可以通过限制执行时间来强制终止:</p>
<ul>
<li><code>cte_max_recursion_depth</code> 系统变量对 CTE 的递归层数进行了限制。如果递归的级别超过此变量的值，服务器将终止任何 CTE 的执行。</li>
<li><code>max_execution_time</code> 系统变量为当前会话中执行的 <code>SELECT</code> 语句强制执行超时。</li>
<li><code>MAX_EXECUTION_TIME</code> 优化器提示对出现在其中的 <code>SELECT</code> 语句强制执行每条查询的超时。</li>
</ul>
<p>假设一个递归 CTE 被错误地写成没有递归执行终止条件：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>
</code></pre></div>
<p>默认情况下，<code>cte_max_recursion_depth</code> 的值为 1000，导致 CTE 在递归超过 <code>1000</code> 个级别时终止。应用程序可以改变会话值来调整他们的需求：</p>
<div class="highlight"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="k">SESSION</span><span class="w"> </span><span class="n">cte_max_recursion_depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">      </span><span class="c1">-- 只允许浅递归</span>
<span class="k">SET</span><span class="w"> </span><span class="k">SESSION</span><span class="w"> </span><span class="n">cte_max_recursion_depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000000</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 允许更深的递归</span>
</code></pre></div>
<p>还可以设置全局 <code>cte_max_recursion_depth</code> 值以影响随后开始的所有会话：</p>
<div class="highlight"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">cte_max_recursion_depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000000</span><span class="p">;</span>
</code></pre></div>
<p>对于执行速度慢的查询，或者在有理由将 <code>cte_max_recursion_depth</code> 值设置得很高的情况下，防止深度递归的另一种方法是设置每个会话超时。要做到这一点，在执行 CTE 语句之前执行类似这样的语句：</p>
<div class="highlight"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="n">max_execution_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 设置一秒超时</span>
</code></pre></div>
<p>或者，在 CTE 语句中包含一个优化提示：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="cs">/*+ </span><span class="cp">SET_VAR</span><span class="cs">(cte_max_recursion_depth = 1M) */</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>

<span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="cs">/*+ </span><span class="cp">MAX_EXECUTION_TIME</span><span class="cs">(1000) */</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>
</code></pre></div>
<p>从 MySQL 8.0.19 开始，可以在递归查询中使用 <code>LIMIT</code> 来设置最外层 <code>SELECT</code> 要返回的最大行数，例如：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10000</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>
</code></pre></div>
<p>你可以设置一个时间限制，也可以不设置时间限制。因此，下面这个 CTE 在返回一万条记录或者运行一秒钟（1000毫秒）后终止，以先发生者为准：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10000</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="cs">/*+ </span><span class="cp">MAX_EXECUTION_TIME</span><span class="cs">(1000) */</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>
</code></pre></div>
<p>如果一个没有执行时间限制的递归查询进入无限循环，你可以使用 <code>KILL QUERY</code> 从另一个会话终止它。在会话本身中，用于运行查询的客户程序可能提供一种方法来终止查询。例如，在 mysql 中，键入 <code>Control+C</code> 可以中断当前语句。</p>
<h4 id="794">7.9.4、递归公共表表达式示例<a class="headerlink" href="#794" title="Permanent link">&para;</a></h4>
<p>如前所述，递归公共表表达式（CTEs）经常被用于序列生成和遍历层次结构或树状结构的数据。本节展示了这些技术的一些简单例子。</p>
<ul>
<li>斐波那契序列生成</li>
<li>日期序列生成</li>
<li>分层数据遍历</li>
</ul>
<h5 id="_14">斐波那契序列生成<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h5>
<p>斐波那契数列以两个数字 <code>0</code> 和 <code>1</code>（或 <code>1</code> 和  <code>1</code>）开始，之后的每个数字都是前两个数字的总和。如果由递归 <code>SELECT</code> 产生的每一行都可以访问系列中的前两个数字，那么递归的普通表表达式就可以生成一个斐波那契数列。下面的 CTE 使用 <code>0</code> 和 <code>1</code> 作为前两个数字，生成了一个 10 数字系列：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">fibonacci</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">fib_n</span><span class="p">,</span><span class="w"> </span><span class="n">next_fib_n</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">next_fib_n</span><span class="p">,</span><span class="w"> </span><span class="n">fib_n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">next_fib_n</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">fibonacci</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">fibonacci</span><span class="p">;</span>
</code></pre></div>
<p>CTE产生以下结果：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------+-------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">fib_n</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">next_fib_n</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+-------+------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">13</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">13</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">21</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">21</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">34</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">34</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">55</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+-------+------------+</span>
</code></pre></div>
<p>CTE的工作原理：</p>
<ul>
<li><code>n</code> 是一个显示列，表示该行包含第 <code>n</code> 个斐波那契数。例如，第 <code>8</code> 个斐波那契数是 <code>13</code>。</li>
<li><code>fib_n</code> 列显示斐波那契数 <code>n</code>。</li>
<li><code>next_fib_n</code> 列显示数字 <code>n</code> 之后的下一个斐波那契数字。该列向下一行提供下一个序列值，以便该行可以生成其 <code>fib_n</code> 列中前两个序列值的和。</li>
<li>当 <code>n</code> 达到 10 时，递归结束。</li>
</ul>
<p>前面的输出显示了整个 CTE 的结果。要想只选择其中的一部分，可以在顶层的 <code>SELECT</code> 中添加一个适当的 <code>WHERE</code> 子句。例如，要选择第 <code>8</code> 个斐波那契数，请这样做：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">fibonacci</span><span class="w"> </span><span class="p">...</span>
<span class="w">       </span><span class="p">...</span>
<span class="w">       </span><span class="k">SELECT</span><span class="w"> </span><span class="n">fib_n</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">fibonacci</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="o">+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">fib_n</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">13</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-------+</span>
</code></pre></div>
<h5 id="_15">日期序列生成<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h5>
<p>公共表表达式可以生成一系列连续的日期，这对于生成包含序列中所有日期行（包括汇总数据中未表示的日期）的摘要非常有用。</p>
<p>假设一个销售数据表包含以下行：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">date</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">;</span>
<span class="o">+------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">date</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="w">  </span><span class="o">|</span>
<span class="o">+------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">100.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">200.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mf">50.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mf">10.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mf">20.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">150.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mf">5.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------------+--------+</span>
</code></pre></div>
<p>这个查询汇总了每天的销售情况：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="kt">date</span><span class="p">,</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sum_price</span>
<span class="w">       </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span>
<span class="w">       </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">date</span>
<span class="w">       </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">date</span><span class="p">;</span>
<span class="o">+------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">date</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">sum_price</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mf">300.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mf">50.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mf">180.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mf">5.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------------+-----------+</span>
</code></pre></div>
<p>然而，该结果包含了表所跨越的日期范围内没有表示的日期的 “空洞”。可以使用递归 CTE 生成表示该范围内所有日期的结果，并使用 <code>LEFT JOIN</code> 将该日期结果集连接到销售数据。</p>
<p>以下是生成日期范围系列的 CTE：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">dates</span><span class="w"> </span><span class="p">(</span><span class="kt">date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MIN</span><span class="p">(</span><span class="kt">date</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="kt">date</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DAY</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">dates</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="kt">date</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DAY</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="kt">date</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">dates</span><span class="p">;</span>
</code></pre></div>
<p>CTE 产生如下结果：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">date</span><span class="w">       </span><span class="o">|</span>
<span class="o">+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------------+</span>
</code></pre></div>
<p>CTE 的工作原理：</p>
<ul>
<li>非递归 <code>SELECT</code> 产生 <code>sales</code> 表所跨越的日期范围内的最低日期。</li>
<li>递归 <code>SELECT</code> 产生的每一条记录都会在前一条记录产生的日期上增加一天。</li>
<li>在日期达到 <code>sales</code> 表所跨越的日期范围中的最高日期后，递归结束。</li>
</ul>
<p>使用 <code>LEFT JOIN</code> 连接 CTE 与 <code>sales</code> 表，产生销售汇总表，在这个范围内的每个日期都有一行：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">dates</span><span class="w"> </span><span class="p">(</span><span class="kt">date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MIN</span><span class="p">(</span><span class="kt">date</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="kt">date</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DAY</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">dates</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="kt">date</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DAY</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="kt">date</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">dates</span><span class="p">.</span><span class="kt">date</span><span class="p">,</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="nf">SUM</span><span class="p">(</span><span class="n">price</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sum_price</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">dates</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">sales</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dates</span><span class="p">.</span><span class="kt">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sales</span><span class="p">.</span><span class="kt">date</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">dates</span><span class="p">.</span><span class="kt">date</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">dates</span><span class="p">.</span><span class="kt">date</span><span class="p">;</span>
</code></pre></div>
<p>输出如下所示：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">date</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">sum_price</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mf">300.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mf">0.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mf">0.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mf">50.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mf">0.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mf">180.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mf">0.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mf">5.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------------+-----------+</span>
</code></pre></div>
<p>需要注意的几点：</p>
<ul>
<li>这些查询是否效率低下，特别是在递归 <code>SELECT</code> 中对每条记录执行 <code>MAX()</code>子查询的查询？<code>EXPLAIN</code> 显示，包含 <code>MAX()</code>的子查询只计算一次，并且结果会被缓存。</li>
<li>使用 <code>COALESCE()</code> 可以避免在销售表中没有销售数据的日子里，<code>sum_price</code> 列显示 <code>NULL</code>。</li>
</ul>
<h5 id="_16">分层数据遍历<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h5>
<p>递归公共表表达式对于遍历形成层次结构的数据很有用。考虑这些语句，创建了一个小的数据集，对于公司的每个员工，显示员工的名字和 ID号，以及员工的经理的 ID。最高级别的员工（CEO），其经理 ID 为 <code>NULL</code>（没有经理）。</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w">         </span><span class="kt">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="k">name</span><span class="w">       </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">manager_id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="k">INDEX</span><span class="w"> </span><span class="p">(</span><span class="n">manager_id</span><span class="p">),</span>
<span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">manager_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">VALUES</span>
<span class="p">(</span><span class="mi">333</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Yasmina&quot;</span><span class="p">,</span><span class="w"> </span><span class="no">NULL</span><span class="p">),</span><span class="w">  </span><span class="c1"># Yasmina is the CEO (manager_id is NULL)</span>
<span class="p">(</span><span class="mi">198</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">333</span><span class="p">),</span><span class="w">      </span><span class="c1"># John has ID 198 and reports to 333 (Yasmina)</span>
<span class="p">(</span><span class="mi">692</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Tarek&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">333</span><span class="p">),</span>
<span class="p">(</span><span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Pedro&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">198</span><span class="p">),</span>
<span class="p">(</span><span class="mi">4610</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Sarah&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="p">),</span>
<span class="p">(</span><span class="mi">72</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Pierre&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="p">),</span>
<span class="p">(</span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Adil&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">692</span><span class="p">);</span>
</code></pre></div>
<p>生成的数据集如下所示：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="o">+------+---------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">name</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+</span>
<span class="o">|</span><span class="w">   </span><span class="mi">29</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Pedro</span><span class="w">   </span><span class="o">|</span><span class="w">        </span><span class="mi">198</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="mi">72</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Pierre</span><span class="w">  </span><span class="o">|</span><span class="w">         </span><span class="mi">29</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">123</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Adil</span><span class="w">    </span><span class="o">|</span><span class="w">        </span><span class="mi">692</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">198</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">John</span><span class="w">    </span><span class="o">|</span><span class="w">        </span><span class="mi">333</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">333</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Yasmina</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">692</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Tarek</span><span class="w">   </span><span class="o">|</span><span class="w">        </span><span class="mi">333</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">4610</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sarah</span><span class="w">   </span><span class="o">|</span><span class="w">         </span><span class="mi">29</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+</span>
</code></pre></div>
<p>为了生成带有每个员工管理链的组织结构图（即从 CEO 到员工的路径），请使用一个递归 CTE：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">employee_paths</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="k">path</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="nf">CAST</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="kt">CHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">manager_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="no">NULL</span>
<span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="nf">CONCAT</span><span class="p">(</span><span class="n">ep</span><span class="p">.</span><span class="k">path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">employee_paths</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ep</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span>
<span class="w">      </span><span class="k">ON</span><span class="w"> </span><span class="n">ep</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">manager_id</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employee_paths</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">path</span><span class="p">;</span>
</code></pre></div>
<p>CTE产生如下输出：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------+---------+-----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">name</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">path</span><span class="w">            </span><span class="o">|</span>
<span class="o">+------+---------+-----------------+</span>
<span class="o">|</span><span class="w">  </span><span class="mi">333</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Yasmina</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">333</span><span class="w">             </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">198</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">John</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">333</span><span class="p">,</span><span class="mi">198</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="mi">29</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Pedro</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">333</span><span class="p">,</span><span class="mi">198</span><span class="p">,</span><span class="mi">29</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">4610</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sarah</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">333</span><span class="p">,</span><span class="mi">198</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">4610</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="mi">72</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Pierre</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">333</span><span class="p">,</span><span class="mi">198</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">72</span><span class="w">   </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">692</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Tarek</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">333</span><span class="p">,</span><span class="mi">692</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">123</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Adil</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">333</span><span class="p">,</span><span class="mi">692</span><span class="p">,</span><span class="mi">123</span><span class="w">     </span><span class="o">|</span>
<span class="o">+------+---------+-----------------+</span>
</code></pre></div>
<p>CTE 的工作原理：</p>
<ul>
<li>
<p>非递归 <code>SELECT</code>生成 CEO 的行（具有 <code>NULL</code> 的 <code>manager_id</code>行）。</p>
<p><code>path</code> 列被扩展为 <code>CHAR(200)</code>，以确保有空间容纳递归 <code>SELECT</code> 产生的更长的 <code>path</code> 值。</p>
</li>
<li>
<p>由递归 <code>SELECT</code> 生成的每一行都会找到所有直接向前一行生成的员工报告的员工。对于每个这样的员工，该行包括员工 ID 和姓名，以及雇员管理链。该链是经理的链，末尾添加了员工 ID。</p>
</li>
<li>
<p>当员工没有其他人向他们报告时，递归结束。</p>
</li>
</ul>
<p>要查找一个或多个特定雇员的路径，请向顶级 <code>SELECT</code> 添加 <code>WHERE</code> 子句。例如，为了显示 <code>Tarek</code> 和 <code>Sarah</code> 的结果，像这样修改 <code>SELECT</code>：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="p">...</span>
<span class="w">       </span><span class="p">...</span>
<span class="w">       </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees_extended</span>
<span class="w">       </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">692</span><span class="p">,</span><span class="w"> </span><span class="mi">4610</span><span class="p">)</span>
<span class="w">       </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">path</span><span class="p">;</span>
<span class="o">+------+-------+-----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">path</span><span class="w">            </span><span class="o">|</span>
<span class="o">+------+-------+-----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">4610</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sarah</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">333</span><span class="p">,</span><span class="mi">198</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">4610</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">692</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Tarek</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">333</span><span class="p">,</span><span class="mi">692</span><span class="w">         </span><span class="o">|</span>
<span class="o">+------+-------+-----------------+</span>
</code></pre></div>
<h4 id="795cte">7.9.5、CTE 和类似结构的比较<a class="headerlink" href="#795cte" title="Permanent link">&para;</a></h4>
<p>公共表表达式（CTE）在某些方面与派生表类似：</p>
<ul>
<li>两个结构都有名称。</li>
<li>这两种结构都存在于单个语句的作用域中。</li>
</ul>
<p>由于这些相似之处，CTE 和派生表经常可以互换使用。作为一个简单的例子，这些语句是等同的：</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="p">;</span>
</code></pre></div>
<p>然而，与派生表相比，CTE 有一些优势：</p>
<ul>
<li>一个派生表在一个查询中只能被引用一次。一个 CTE 可以被多次引用。要使用一个派生表结果的多个实例，你必须多次派生该结果。</li>
<li>CTE 可以是自引用（递归）。</li>
<li>一个 CTE 可以引用另一个 CTE。</li>
<li>如果 CTE 的定义出现在语句的开头，而不是嵌入在语句中，可能会更容易阅读。</li>
</ul>
<p>CTE 类似于用 <code>CREATE [TEMPORARY] TABLE</code> 创建的表，但不需要明确定义或删除。对于 CTE，你不需要任何权限来创建表。</p>
<h2 id="8">8、视图<a class="headerlink" href="#8" title="Permanent link">&para;</a></h2>
<p>视图是可视化的表。</p>
<p>视图隐藏了底层的表结构，简化了数据访问操作，客户端不再需要知道底层表结构及其之间的关系。</p>
<p>视图提供了一个统一访问数据的接口（即可以允许用户通过视图访问数据的安全机制，而不授予用户直接访问底层表的权限）。</p>
<p>从而加强了安全性，使用户只能看到视图所显示的数据。</p>
<p>视图还可以被嵌套，一个视图中可以嵌套另一个视图。</p>
<p>视图提供的是对查询操作的封装，本身不包含数据，所呈现的数据是根据视图定义从基础表中检索出来的，如果基础表的数据新增或删除，视图呈现的也是更新后的数据。视图定义后，编写完所需的查询，可以方便地重用该视图。</p>
<p><strong>创建视图</strong></p>
<p>语法格式如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="o">&lt;</span><span class="n">视图名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">&lt;</span><span class="n">SELECT语句</span><span class="o">&gt;</span>
</code></pre></div>
<p>语法说明如下:</p>
<ul>
<li>&lt;视图名&gt;：指定视图的名称。该名称在数据库中必须是唯一的，不能与其他表或视图同名。</li>
<li><SELECT语句>：指定创建视图的 SELECT 语句，可用于查询多个基础表或源视图。 </li>
</ul>
<p>默认情况下，创建的视图和基本表的字段是一样的，也可以通过指定视图字段的名称来创建视图。</p>
<p><img src="!assets/MySQL/image-20200531164924587.png" alt="image-20200531164924587" style="zoom:80%;" /></p>
<p><strong>查看视图</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">column_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">view_name</span><span class="p">;</span>
</code></pre></div>
<p>或</p>
<div class="highlight"><pre><span></span><code><span class="k">DESCRIBE</span><span class="w"> </span><span class="n">视图名；</span>
</code></pre></div>
<p>注意：DESCRIBE 一般情况下可以简写成 DESC，输入这个命令的执行结果和输入 DESCRIBE 是一样的。</p>
<p><strong>修改视图</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="n">view_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">column_name</span><span class="n">…</span>
<span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">条件</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<p><strong>删除视图</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">view_name</span><span class="p">;</span>
</code></pre></div>
<h2 id="9">9、存储过程<a class="headerlink" href="#9" title="Permanent link">&para;</a></h2>
<p>存储过程（Stored Procedure）是一种在数据库中存储复杂程序，以便外部程序调用的一种数据库对象。</p>
<p>存储过程是为了完成特定功能的SQL语句集，经编译创建并保存在数据库中，用户可通过指定存储过程的名字并给定参数(需要时)来调用执行。</p>
<p>存储过程思想上很简单，就是数据库 SQL 语言层面的代码封装与重用。</p>
<p>优点</p>
<ul>
<li>存储过程可封装，并隐藏复杂的商业逻辑。</li>
<li>存储过程可以回传值，并可以接受参数。</li>
<li>存储过程无法使用 SELECT 指令来运行，因为它是子程序，与查看表，数据表或用户定义函数不同。</li>
<li>存储过程可以用在数据检验，强制实行商业逻辑等。</li>
</ul>
<p>缺点</p>
<ul>
<li>存储过程，往往定制化于特定的数据库上，因为支持的编程语言不同。当切换到其他厂商的数据库系统时，需要重写原有的存储过程。</li>
<li>存储过程的性能调校与撰写，受限于各种数据库系统。</li>
</ul>
<h3 id="91">9.1、存储过程的创建和调用<a class="headerlink" href="#91" title="Permanent link">&para;</a></h3>
<ul>
<li>存储过程就是具有名字的一段代码，用来完成一个特定的功能。</li>
<li>创建的存储过程保存在数据库的数据字典中。</li>
</ul>
<p>语法：</p>
<p><strong>声明语句结束符，可以自定义</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">DELIMITER</span><span class="w"> </span><span class="n">$$</span>
</code></pre></div>
<p>或</p>
<div class="highlight"><pre><span></span><code><span class="n">DELIMITER</span><span class="w"> </span><span class="o">//</span>
</code></pre></div>
<p>当使用 DELIMITER命令时，应该避免使用反斜杠“\”字符，因为它是 MySQL 的转义字符。</p>
<p><strong>声明存储过程</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">p_name</span><span class="p">(</span><span class="err">[</span><span class="k">IN</span><span class="p">,</span><span class="k">OUT</span><span class="p">,</span><span class="k">INOUT</span><span class="err">]</span><span class="w"> </span><span class="n">data_name</span><span class="w"> </span><span class="n">datatype</span><span class="p">)</span>
</code></pre></div>
<p><strong>存储过程开始和结束符号</strong></p>
<p>BEGIN…END</p>
<p><strong>变量赋值</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="nv">@p_in</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>
<p><strong>定义变量</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">DECLARE</span><span class="w"> </span><span class="n">l_INT</span><span class="w"> </span><span class="k">UNSIGNED</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<p>可以使用 <code>SHOW PROCEDURE STATUS</code> 命令查看数据库中存在哪些存储过程，若要查看某个存储过程的具体信息，则可以使用 <code>SHOW CREATE PROCEDURE &lt;存储过程名&gt;</code>。</p>
<p>实例：</p>
<div class="highlight"><pre><span></span><code><span class="n">DELIMITER</span><span class="w"> </span><span class="n">$$</span><span class="w">        </span><span class="c1">#将语句的结束符号从分号;临时改为两个$$(可以是自定义)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">DELETE_matches</span><span class="p">(</span><span class="k">IN</span><span class="w"> </span><span class="n">p_playerno</span><span class="w"> </span><span class="kt">INTEGER</span><span class="p">)</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">matches</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">playerno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_playerno</span><span class="p">;</span>
<span class="k">END</span><span class="n">$$</span>
<span class="n">DELIMITER</span><span class="w"> </span><span class="p">;</span><span class="w"> 　</span><span class="c1">#将语句的结束符号恢复为分号</span>
</code></pre></div>
<p>解析：默认情况下，存储过程和默认数据库相关联，如果想指定存储过程创建在某个特定的数据库下，那么在过程名前面加数据库名做前缀。 在定义过程时，使用 <code>DELIMITER $$</code> 命令将语句的结束符号从分号 <code>;</code>临时改为两个 <code>$$</code>，使得过程体中使用的分号被直接传递到服务器，而不会被客户端（如mysql）解释。</p>
<p><strong>调用存储过程：</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">sp_name</span><span class="p">(</span><span class="n">传参</span><span class="p">);</span>
</code></pre></div>
<p><strong>存储过程体</strong></p>
<p>存储过程体包含了在过程调用时必须执行的语句，例如：DML、DDL语句，IF-THEN-ELSE和WHILE-DO语句、声明变量的DECLARE语句等。</p>
<p><strong>过程体格式</strong>：以BEFIN开始，以END结束(可嵌套)</p>
<div class="highlight"><pre><span></span><code><span class="k">BEGIN</span>
<span class="w">　　</span><span class="k">BEGIN</span>
<span class="w">　　　　</span><span class="k">BEGIN</span>
<span class="w">　　　　　　</span><span class="n">statements</span><span class="p">;</span><span class="w"> </span>
<span class="w">　　　　</span><span class="k">END</span>
<span class="w">　　</span><span class="k">END</span>
<span class="k">END</span>
</code></pre></div>
<p>注意：每个嵌套块及其中的每条语句，必须以分号结束，表示过程体结束的BEGIN-END块(又叫做复合语句compound statement)，则不需要分号。</p>
<p><strong>为语句块贴标签</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="err">[</span><span class="n">begin_label</span><span class="o">:</span><span class="err">]</span><span class="w"> </span><span class="k">BEGIN</span>
<span class="w">　　</span><span class="err">[</span><span class="n">statement_list</span><span class="err">]</span>
<span class="k">END</span><span class="w"> </span><span class="err">[</span><span class="n">end_label</span><span class="err">]</span>
</code></pre></div>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><span class="n">label1</span><span class="o">:</span><span class="w"> </span><span class="k">BEGIN</span>
<span class="w">　　</span><span class="n">label2</span><span class="o">:</span><span class="w"> </span><span class="k">BEGIN</span>
<span class="w">　　　　</span><span class="n">label3</span><span class="o">:</span><span class="w"> </span><span class="k">BEGIN</span>
<span class="w">　　　　　　</span><span class="n">statements</span><span class="p">;</span><span class="w"> </span>
<span class="w">　　　　</span><span class="k">END</span><span class="w"> </span><span class="n">label3</span><span class="w"> </span><span class="p">;</span>
<span class="w">　　</span><span class="k">END</span><span class="w"> </span><span class="n">label2</span><span class="p">;</span>
<span class="k">END</span><span class="w"> </span><span class="n">label1</span>
</code></pre></div>
<p>标签有两个作用：</p>
<ul>
<li>增强代码的可读性</li>
<li>在某些语句(例如:LEAVE和ITERATE语句)，需要用到标签。</li>
</ul>
<h3 id="92">9.2、存储过程的参数<a class="headerlink" href="#92" title="Permanent link">&para;</a></h3>
<p>MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT,形式如：</p>
<div class="highlight"><pre><span></span><code><span class="n">CREATEPROCEDURE</span><span class="w"> </span><span class="n">存储过程名</span><span class="p">(</span><span class="err">[</span><span class="k">IN</span><span class="p">,</span><span class="k">OUT</span><span class="p">,</span><span class="k">INOUT</span><span class="err">]</span><span class="w"> </span><span class="n">参数名</span><span class="w"> </span><span class="n">数据类形</span><span class="p">...)</span>
</code></pre></div>
<ul>
<li>IN 输入参数：表示调用者向过程传入值（传入值可以是字面量或变量）</li>
<li>OUT 输出参数：表示过程向调用者传出值(可以返回多个值)（传出值只能是变量）</li>
<li>INOUT 输入输出参数：既表示调用者向过程传入值，又表示过程向调用者传出值（值只能是变量） </li>
</ul>
<p>注意：</p>
<ul>
<li>
<p>如果过程没有参数，也必须在过程名后面写上小括号
    例：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">sp_name</span><span class="w"> </span><span class="p">(</span><span class="err">[</span><span class="n">proc_parameter</span><span class="err">[</span><span class="p">,...</span><span class="err">]]</span><span class="p">)</span><span class="w"> </span><span class="n">……</span>
</code></pre></div>
</li>
<li>
<p>确保参数的名字不等于列的名字，否则在过程体中，参数名被当做列名来处理。</p>
</li>
</ul>
<p>建议：</p>
<ul>
<li>输入值使用IN参数。</li>
<li>返回值使用OUT参数。</li>
<li>INOUT参数就尽量的少用。</li>
</ul>
<h3 id="93">9.3、变量<a class="headerlink" href="#93" title="Permanent link">&para;</a></h3>
<p>MySQL 变量可分为两大类，即<strong>系统变量</strong>和<strong>用户变量</strong>。</p>
<p>但根据实际应用又被细化为四种类型，即<strong>局部变量</strong>、<strong>用户变量</strong>、<strong>会话变量</strong>和<strong>全局变量</strong>。</p>
<h4 id="931">9.3.1、各种变量的介绍<a class="headerlink" href="#931" title="Permanent link">&para;</a></h4>
<p><strong>局部变量</strong></p>
<p>MySQL 局部变量，只能用在 <code>begin/end</code>语句块中，比如存储过程中的 <code>begin/end</code> 语句块。</p>
<p>其作用域仅限于该语句块。</p>
<p><code>DECLARE</code> 语句专门用于定义局部变量，可以使用 <code>DEFAULT</code> 来说明默认值：</p>
<div class="highlight"><pre><span></span><code><span class="k">DECLARE</span><span class="w"> </span><span class="n">variable_name</span><span class="w"> </span><span class="n">datatype</span><span class="w"> </span><span class="err">[</span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">VALUE</span><span class="err">]</span><span class="p">;</span>
</code></pre></div>
<p>其中，<em>datatype</em> 为 MySQL 的数据类型，如: <code>INT</code>、<code>FLOAT</code>、<code>DATE</code>、<code>VARCHAR(length)</code>。</p>
<p>赋值方式：</p>
<ul>
<li>
<p><code>mysql
    set age=18;</code></p>
</li>
<li>
<p><code>mysql
    select StuAge into age from demo.student where StuNo='A001';</code></p>
</li>
</ul>
<p><strong>用户变量</strong></p>
<p>MySQL 用户变量，MySQL 中用户变量不用提前申明，在用的时候直接用 <code>@变量名</code> 使用就可以了。</p>
<p>其作用域为当前连接。</p>
<p>两种赋值方式：</p>
<ul>
<li>
<p>使用 <code>set</code> 时可以用 <code>=</code> 或 <code>:=</code> 两种赋值符号赋值：</p>
<div class="highlight"><pre><span></span><code><span class="k">set</span><span class="w"> </span><span class="nv">@age</span><span class="o">=</span><span class="mi">19</span><span class="p">;</span>

<span class="k">set</span><span class="w"> </span><span class="nv">@age</span><span class="o">:=</span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>使用 <code>SELECT</code> 时必须用 <code>:=</code> 赋值符号赋值：</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="nv">@age</span><span class="o">:=</span><span class="mi">22</span><span class="p">;</span>

<span class="k">select</span><span class="w"> </span><span class="nv">@age</span><span class="o">:=</span><span class="n">StuAge</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">student</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">StuNo</span><span class="o">=</span><span class="s1">&#39;A001&#39;</span><span class="p">;</span>
</code></pre></div>
</li>
</ul>
<p>在存储过程中使用用户变量：</p>
<p><img src="!assets/MySQL/image-20200531171451044.png" alt="image-20200531171451044" style="zoom:80%;" /></p>
<p>在存储过程间传递全局范围的用户变量：</p>
<p><img src="!assets/MySQL/image-20200531171500385.png" alt="image-20200531171500385" style="zoom:80%;" /></p>
<p>注意:</p>
<ul>
<li>用户变量名一般以 <code>@</code> 开头</li>
<li>滥用用户变量会导致程序难以理解及管理</li>
</ul>
<p><strong>会话变量</strong></p>
<p>MySQL 会话变量，服务器为每个连接的客户端维护一系列会话变量。</p>
<p>其作用域仅限于当前连接，即每个连接中的会话变量是独立的。</p>
<p>显示所有的会话变量：</p>
<div class="highlight"><pre><span></span><code><span class="k">show</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="k">variables</span><span class="p">;</span>
</code></pre></div>
<p>设置会话变量的值的三种方式：</p>
<ul>
<li>
<p><code>mysql
    set session auto_increment_increment=1;</code></p>
</li>
<li>
<p><code>mysql
    set @@session.auto_increment_increment=2;</code></p>
</li>
<li>
<p><code>mysql
    set auto_increment_increment=3;</code></p>
<p>当省略 <code>session</code> 关键字时，默认缺省为 <code>session</code>，即设置会话变量的值。</p>
</li>
</ul>
<p>查询会话变量的值的三种方式：</p>
<ul>
<li>
<p><code>mysql
    select @@auto_increment_increment;</code></p>
</li>
<li>
<p><code>mysql
    select @@session.auto_increment_increment;</code></p>
</li>
<li>
<p><code>mysql
    show session variables like '%auto_increment_increment%';</code></p>
<p><code>session</code> 关键字可省略。</p>
</li>
</ul>
<p>关键字 <code>session</code> 也可用关键字 <code>local</code> 替代：</p>
<div class="highlight"><pre><span></span><code><span class="k">set</span><span class="w"> </span><span class="nv">@@local</span><span class="p">.</span><span class="n">auto_increment_increment</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="k">select</span><span class="w"> </span><span class="nv">@@local</span><span class="p">.</span><span class="n">auto_increment_increment</span><span class="p">;</span>
</code></pre></div>
<p><strong>全局变量</strong></p>
<p>MySQL 全局变量，全局变量影响服务器整体操作，当服务启动时，它将所有全局变量初始化为默认值。要想更改全局变量，必须具有 super 权限。</p>
<p>其作用域为 server 的整个生命周期。</p>
<p>显示所有的全局变量：</p>
<div class="highlight"><pre><span></span><code><span class="k">show</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="k">variables</span><span class="p">;</span>
</code></pre></div>
<p>设置全局变量的值的两种方式：</p>
<ul>
<li>
<p><code>mysql
    set global sql_warnings=ON;</code></p>
<p><code>global</code> 不能省略</p>
</li>
<li>
<p><code>mysql
    set @@global.sql_warnings=OFF;</code></p>
</li>
</ul>
<p>查询全局变量的值的两种方式：</p>
<ul>
<li>
<p><code>mysql
    select @@global.sql_warnings;</code></p>
</li>
<li>
<p><code>mysql
    show global variables like '%sql_warnings%';</code></p>
</li>
</ul>
<h4 id="932">9.3.2、使用变量进行累加计算<a class="headerlink" href="#932" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="o">+---------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">reg_time</span><span class="w">   </span><span class="o">|</span><span class="w"> </span>
<span class="o">+---------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">6</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="w"> </span><span class="o">|</span>
<span class="o">+---------+------------+</span>
</code></pre></div>
<p>假如有上表 user_info，我们很容易根据时间维度统计出每日新增的人数。SQL 如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">reg_time</span><span class="p">,</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="n">daily_quantity</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_info</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">reg_time</span><span class="w"> </span>
</code></pre></div>
<p>通过上面的 SQL 我们很容易得出以下列表：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">reg_time</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">daily_quantity</span><span class="w"> </span><span class="o">|</span><span class="w"> </span>
<span class="o">+------------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">              </span><span class="o">|</span>
<span class="o">+------------+----------------+</span>
</code></pre></div>
<p>如果我们要上一天的总人数加上今天的净增长数，以此类推。也就是我们想要：</p>
<div class="highlight"><pre><span></span><code><span class="o">+------------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">reg_time</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">daily_quantity</span><span class="w"> </span><span class="o">|</span><span class="w"> </span>
<span class="o">+------------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="w">              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">6</span><span class="w">              </span><span class="o">|</span>
<span class="o">+------------+----------------+</span>
</code></pre></div>
<p>当然，如果 MySQL 8.0 以上可以使用窗口函数解决，但是 8.0 以下呢？可以这么写：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">reg_time</span><span class="p">,</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">daily</span><span class="p">,</span>
<span class="w">  </span><span class="nv">@i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nv">@i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">daily</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">daily_quantity</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">      </span><span class="n">reg_time</span><span class="p">,</span><span class="w"> </span>
<span class="w">      </span><span class="nf">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="n">daily</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n n-Quoted">`user`</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">reg_time</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
</code></pre></div>
<h3 id="94">9.4、存储过程的删除<a class="headerlink" href="#94" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="err">}</span><span class="w"> </span><span class="err">[</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="err">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">过程名</span><span class="o">&gt;</span>
</code></pre></div>
<p>注意：存储过程名称后面没有参数列表，也没有括号，在删除之前，必须确认该存储过程没有任何依赖关系，否则会导致其他与之关联的存储过程无法运行。</p>
<p>查看：</p>
<div class="highlight"><pre><span></span><code><span class="n">SHOWCREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">数据库</span><span class="p">.</span><span class="n">存储过程名</span><span class="p">;</span>
</code></pre></div>
<h3 id="95">9.5、存储过程的控制语句<a class="headerlink" href="#95" title="Permanent link">&para;</a></h3>
<h4 id="951">9.5.1、变量作用域<a class="headerlink" href="#951" title="Permanent link">&para;</a></h4>
<p>内部的变量在其作用域范围内享有更高的优先权，当执行到 end。变量时，内部变量消失，此时已经在其作用域外，变量不再可见了，应为在存储过程外再也不能找到这个申明的变量，但是你可以通过 out 参数或者将其值指派给会话变量来保存其值。</p>
<p><img src="!assets/MySQL/image-20200531195043445.png" alt="image-20200531195043445" style="zoom:80%;" /></p>
<h4 id="952">9.5.2、条件语句<a class="headerlink" href="#952" title="Permanent link">&para;</a></h4>
<p><strong>if-then-else</strong></p>
<p><img src="!assets/MySQL/image-20200531195130654.png" alt="image-20200531195130654" style="zoom:80%;" /></p>
<p><strong>case语句</strong></p>
<p><img src="!assets/MySQL/image-20200531195143678.png" alt="image-20200531195143678" style="zoom:80%;" /></p>
<h4 id="953">9.5.3、循环语句<a class="headerlink" href="#953" title="Permanent link">&para;</a></h4>
<p><strong>while ···· end while</strong></p>
<p><img src="!assets/MySQL/image-20200531195208679.png" alt="image-20200531195208679" style="zoom:80%;" /></p>
<p><strong>repeat···· end repea</strong></p>
<p>它在执行操作后检查结果，而 while 则是执行前进行检查。</p>
<p><img src="!assets/MySQL/image-20200531195231262.png" alt="image-20200531195231262" style="zoom:80%;" /></p>
<p><strong>loop ·····endloop</strong></p>
<p>loop 循环不需要初始条件，这点和 while 循环相似，同时和 repeat 循环一样不需要结束条件, leave 语句的意义是离开循环。</p>
<p><img src="!assets/MySQL/image-20200531195245319.png" alt="image-20200531195245319" style="zoom:80%;" /></p>
<p><strong>LABLES 标号</strong></p>
<p>标号可以用在 begin repeat while 或者 loop 语句前，语句标号只能在合法的语句前面使用。可以跳出循环，使运行指令达到复合语句的最后一步。</p>
<h3 id="96iterate">9.6、ITERATE迭代<a class="headerlink" href="#96iterate" title="Permanent link">&para;</a></h3>
<p>ITERATE 通过引用复合语句的标号,来从新开始复合语句:</p>
<p><img src="!assets/MySQL/image-20200531195350919.png" alt="image-20200531195350919" style="zoom:80%;" /></p>
<h2 id="10">10、触发器<a class="headerlink" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="101">10.1、触发器简介<a class="headerlink" href="#101" title="Permanent link">&para;</a></h3>
<p>MySQL 数据库中触发器是一个特殊的存储过程，不同的是执行存储过程要使用 CALL 语句来调用，而触发器的执行不需要使用 CALL 语句来调用，也不需要手工启动，只要一个预定义的事件发生就会被 MySQL自动调用。</p>
<p>引发触发器执行的事件一般如下：</p>
<ul>
<li>增加一条学生记录时，会自动检查年龄是否符合范围要求。</li>
<li>每当删除一条学生信息时，自动删除其成绩表上的对应记录。</li>
<li>每当删除一条数据时，在数据库存档表中保留一个备份副本。</li>
</ul>
<p>触发程序的优点如下：</p>
<ul>
<li>触发程序的执行是自动的，当对触发程序相关表的数据做出相应的修改后立即执行。</li>
<li>触发程序可以通过数据库中相关的表层叠修改另外的表。</li>
<li>触发程序可以实施比 FOREIGN KEY 约束、CHECK 约束更为复杂的检查和操作。 </li>
</ul>
<p>触发器与表关系密切，主要用于保护表中的数据。特别是当有多个表具有一定的相互联系的时候，触发器能够让不同的表保持数据的一致性。</p>
<p>在 MySQL 中，只有执行 INSERT、UPDATE 和 DELETE 操作时才能激活触发器。</p>
<p>在实际使用中，MySQL 所支持的触发器有三种：INSERT 触发器、UPDATE 触发器和 DELETE 触发器。</p>
<p><strong>INSERT 触发器</strong></p>
<p>在 INSERT 语句执行之前或之后响应的触发器。</p>
<p>使用 INSERT 触发器需要注意以下几点：</p>
<ul>
<li>在 INSERT 触发器代码内，可引用一个名为 NEW（不区分大小写）的虚拟表来访问被插入的行。</li>
<li>在 BEFORE INSERT 触发器中，NEW 中的值也可以被更新，即允许更改被插入的值（只要具有对应的操作权限）。</li>
<li>对于 AUTO_INCREMENT 列，NEW 在 INSERT 执行之前包含的值是 0，在 INSERT 执行之后将包含新的自动生成值。</li>
</ul>
<p><strong>UPDATE 触发器</strong></p>
<p>在 UPDATE 语句执行之前或之后响应的触发器。</p>
<p>使用 UPDATE 触发器需要注意以下几点：</p>
<ul>
<li>在 UPDATE 触发器代码内，可引用一个名为 NEW（不区分大小写）的虚拟表来访问更新的值。</li>
<li>在 UPDATE 触发器代码内，可引用一个名为 OLD（不区分大小写）的虚拟表来访问 UPDATE 语句执行前的值。</li>
<li>在 BEFORE UPDATE 触发器中，NEW 中的值可能也被更新，即允许更改将要用于 UPDATE 语句中的值（只要具有对应的操作权限）。</li>
<li>OLD 中的值全部是只读的，不能被更新。</li>
</ul>
<p>注意：当触发器设计对触发表自身的更新操作时，只能使用 BEFORE 类型的触发器，AFTER 类型的触发器将不被允许。</p>
<p><strong>DELETE 触发器</strong></p>
<p>在 DELETE 语句执行之前或之后响应的触发器。</p>
<p>使用 DELETE 触发器需要注意以下几点：</p>
<ul>
<li>在 DELETE 触发器代码内，可以引用一个名为 OLD（不区分大小写）的虚拟表来访问被删除的行。</li>
<li>OLD 中的值全部是只读的，不能被更新。</li>
</ul>
<h3 id="102">10.2、创建触发器<a class="headerlink" href="#102" title="Permanent link">&para;</a></h3>
<p>使用 CREATE TRIGGER 语句创建触发器。</p>
<p>语法格式如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">触发器名</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">BEFORE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">AFTER</span><span class="w"> </span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="k">INSERT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="o">&gt;</span>
<span class="k">ON</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">EACH</span><span class="w"> </span><span class="k">ROW</span><span class="o">&lt;</span><span class="n">触发器主体</span><span class="o">&gt;</span>
</code></pre></div>
<p>语法说明如下。</p>
<ul>
<li>
<p>触发器名
    触发器的名称，触发器在当前数据库中必须具有唯一的名称。如果要在某个特定数据库中创建，名称前面应该加上数据库的名称。</p>
</li>
<li>
<p>INSERT | UPDATE | DELETE
    触发事件，用于指定激活触发器的语句的种类。</p>
<p>注意：三种触发器的执行时间如下。</p>
<ul>
<li>
<p>INSERT：将新行插入表时激活触发器。例如，INSERT 的 BEFORE 触发器不仅能被 MySQL 的 INSERT 语句激活，也能被 LOAD DATA 语句激活。</p>
</li>
<li>
<p>DELETE： 从表中删除某一行数据时激活触发器，例如 DELETE 和 REPLACE 语句。</p>
</li>
<li>
<p>UPDATE：更改表中某一行数据时激活触发器，例如 UPDATE 语句。</p>
</li>
</ul>
</li>
<li>
<p>BEFORE | AFTER
    BEFORE 和 AFTER，触发器被触发的时刻，表示触发器是在激活它的语句之前或之后触发。若希望验证新数据是否满足条件，则使用 BEFORE 选项；若希望在激活触发器的语句执行之后完成几个或更多的改变，则通常使用 AFTER 选项。</p>
</li>
<li>
<p>表名</p>
<p>与触发器相关联的表名，此表必须是永久性表，不能将触发器与临时表或视图关联起来。在该表上触发事件发生时才会激活触发器。同一个表不能拥有两个具有相同触发时刻和事件的触发器。例如，对于一张数据表，不能同时有两个 BEFORE UPDATE 触发器，但可以有一个 BEFORE UPDATE 触发器和一个 BEFORE INSERT 触发器，或一个 BEFORE UPDATE 触发器和一个 AFTER UPDATE 触发器。</p>
</li>
<li>
<p>触发器主体
    触发器动作主体，包含触发器激活时将要执行的 MySQL 语句。如果要执行多个语句，可使用 BEGIN…END 复合语句结构。</p>
</li>
<li>
<p>FOR EACH ROW
    一般是指行级触发，对于受触发事件影响的每一行都要激活触发器的动作。例如，使用 INSERT 语句向某个表中插入多行数据时，触发器会对每一行数据的插入都执行相应的触发器动作。</p>
</li>
</ul>
<p>注意：每个表都支持 INSERT、UPDATE 和 DELETE 的 BEFORE 与 AFTER，因此每个表最多支持 6 个触发器。每个表的每个事件每次只允许有一个触发器。单一触发器不能与多个事件或多个表关联。</p>
<p>另外，在 MySQL 中，若需要查看数据库中已有的触发器，则可以使用 <code>SHOW TRIGGERS</code> 语句。</p>
<h3 id="103">10.3、修改和删除触发器<a class="headerlink" href="#103" title="Permanent link">&para;</a></h3>
<p>与其他 MySQL 数据库对象一样，可以使用 DROP 语句将触发器从数据库中删除。</p>
<p>语法格式如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="err">[</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="n">数据库名</span><span class="err">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">触发器名</span><span class="o">&gt;</span>
</code></pre></div>
<p>语法说明如下：</p>
<ul>
<li>触发器名
    要删除的触发器名称。</li>
<li>数据库名
    可选项。指定触发器所在的数据库的名称。若没有指定，则为当前默认的数据库。</li>
<li>权限
    执行 DROP TRIGGER 语句需要 SUPER 权限。</li>
<li>IF EXISTS
    可选项。避免在没有触发器的情况下删除触发器。</li>
</ul>
<p>注意：删除一个表的同时，也会自动删除该表上的触发器。另外，触发器不能更新或覆盖，为了修改一个触发器，必须先删除它，再重新创建。</p>
<h2 id="11">11、函数<a class="headerlink" href="#11" title="Permanent link">&para;</a></h2>
<h3 id="111">11.1、自定义函数<a class="headerlink" href="#111" title="Permanent link">&para;</a></h3>
<p><strong>创建并使用自定义函数</strong></p>
<p>可以使用 CREATE FUNCTION 语句创建自定义函数。</p>
<p>语法格式如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="o">&lt;</span><span class="n">函数名</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="err">[</span><span class="o">&lt;</span><span class="n">参数1</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">类型1</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">参数2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">类型2</span><span class="o">&gt;</span><span class="err">]</span><span class="w"> </span><span class="n">…</span><span class="w"> </span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="o">&lt;</span><span class="n">类型</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">函数主体</span><span class="o">&gt;</span>
</code></pre></div>
<p>语法说明如下：</p>
<ul>
<li>&lt;函数名&gt;：指定自定义函数的名称。注意，自定义函数不能与存储过程具有相同的名称。</li>
<li>&lt;参数&gt;&lt;类型&gt;：用于指定自定义函数的参数。这里的参数只有名称和类型，不能指定关键字 IN、OUT 和 INOUT。</li>
<li>RETURNS&lt;类型&gt;：用于声明自定义函数返回值的数据类型。其中，&lt;类型&gt;用于指定返回值的数据类型。</li>
<li>&lt;函数主体&gt;：自定义函数的主体部分，也称函数体。所有在存储过程中使用的 SQL 语句在自定义函数中同样适用，包括前面所介绍的局部变量、SET 语句、流程控制语句、游标等。除此之外，自定义函数体还必须包含一个 RETURN&lt;值&gt; 语句，其中&lt;值&gt;用于指定自定义函数的返回值。</li>
</ul>
<p>在 RETURN VALUE 语句中包含 SELECT 语句时，SELECT 语句的返回结果只能是一行且只能有一列值。</p>
<p>若要查看数据库中存在哪些自定义函数，可以使用 SHOW FUNCTION STATUS 语句；若要查看数据库中某个具体的自定义函数，可以使用 SHOW CREATE FUNCTION&lt;函数名&gt; 语句，其中&lt;函数名&gt;用于指定该自定义函数的名称。</p>
<p><img src="!assets/MySQL/image-20200531205053160.png" alt="image-20200531205053160" style="zoom:80%;" /></p>
<p>成功创建自定义函数后，就可以如同调用系统内置函数一样，使用关键字 SELECT 调用用户自定义的函数，语法格式为：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">自定义函数名</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="err">[</span><span class="o">&lt;</span><span class="n">参数</span><span class="o">&gt;</span><span class="w"> </span><span class="err">[</span><span class="p">,...</span><span class="err">]]</span><span class="p">)</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>在 MySQL 中创建自定义函数报错信息如下：</p>
<div class="highlight"><pre><span></span><code>ERROR 1418 (HY000): This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled (you *might* want to use the less safe log_bin_trust_function_creators variable)
</code></pre></div>
<p>解决方法：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="k">set</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="n">log_bin_trust_function_creators</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
</div>
<p><strong>修改自定义函数</strong></p>
<p>可以使用 ALTER FUNCTION 语句来修改自定义函数的某些相关特征。若要修改自定义函数的内容，则需要先删除该自定义函数，然后重新创建。</p>
<p><strong>删除自定义函数</strong></p>
<p>自定义函数被创建后，一直保存在数据库服务器上以供使用，直至被删除。删除自定义函数的方法与删除存储过程的方法基本一样，可以使用 DROP FUNCTION 语句来实现。</p>
<p>语法格式如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="err">[</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="err">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">自定义函数名</span><span class="o">&gt;</span>
</code></pre></div>
<p>语法说明如下:</p>
<ul>
<li>&lt;自定义函数名&gt;：指定要删除的自定义函数的名称。</li>
<li>IF EXISTS：指定关键字，用于防止因误删除不存在的自定义函数而引发错误。</li>
</ul>
<h3 id="112">11.2、窗口函数<a class="headerlink" href="#112" title="Permanent link">&para;</a></h3>
<p>MySQL 支持窗口函数，对于查询中的每一行，使用与该行相关的行执行计算。下面几节讨论如何使用窗口函数，包括对 <code>OVER</code> 和 <code>WINDOW</code> 子句的介绍。</p>
<h4 id="1121">11.2.1、窗口函数的概念和语法<a class="headerlink" href="#1121" title="Permanent link">&para;</a></h4>
<p>本节介绍如何使用窗口函数。</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="kt">year</span><span class="p">,</span><span class="w"> </span><span class="n">product</span><span class="p">;</span>
<span class="o">+------+---------+------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">profit</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1200</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">50</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1200</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">TV</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="mi">150</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">TV</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+</span>
</code></pre></div>
<p>窗口函数在一组查询行上执行类似于聚合的操作。然而，聚合操作将查询行组合成一个单一的结果行，而窗口函数为每一个查询行产生一个结果。</p>
<ul>
<li>对其进行函数求值的行称为当前行。</li>
<li>与发生函数计算的当前行相关的查询行组成当前行的窗口。</li>
</ul>
<p>例如，使用销售信息表，这两个查询执行聚合操作，为作为一个组的所有行生成一个全局总和，并对每个国家进行分组：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">profit</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_profit</span>
<span class="w">       </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span><span class="p">;</span>
<span class="o">+--------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">total_profit</span><span class="w"> </span><span class="o">|</span>
<span class="o">+--------------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span>
<span class="o">+--------------+</span>
<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="nf">SUM</span><span class="p">(</span><span class="n">profit</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">country_profit</span>
<span class="w">       </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span>
<span class="w">       </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span>
<span class="w">       </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">;</span>
<span class="o">+---------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country_profit</span><span class="w"> </span><span class="o">|</span>
<span class="o">+---------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">1610</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w">           </span><span class="mi">1350</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w">           </span><span class="mi">4575</span><span class="w"> </span><span class="o">|</span>
<span class="o">+---------+----------------+</span>
</code></pre></div>
<p>相比之下，窗口函数不会将一组查询行折叠为单个输出行。相反，它们为每行产生一个结果。和前面的查询一样，下面的查询使用了 <code>SUM()</code>，但这次是作为一个窗口函数：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span>
<span class="w">         </span><span class="kt">year</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">profit</span><span class="p">,</span>
<span class="w">         </span><span class="nf">SUM</span><span class="p">(</span><span class="n">profit</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_profit</span><span class="p">,</span>
<span class="w">         </span><span class="nf">SUM</span><span class="p">(</span><span class="n">profit</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="p">(</span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">country_profit</span>
<span class="w">       </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span>
<span class="w">       </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="kt">year</span><span class="p">,</span><span class="w"> </span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">profit</span><span class="p">;</span>
<span class="o">+------+---------+------------+--------+--------------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">profit</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">total_profit</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country_profit</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+--------------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">1610</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">1610</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">1610</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">1350</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">1350</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1200</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">1350</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">4575</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">4575</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">50</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">4575</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1200</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">4575</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">4575</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">TV</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">4575</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">TV</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="mi">150</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">7535</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">4575</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+--------------+----------------+</span>
</code></pre></div>
<p>查询中的每个窗口操作都包含一个 <code>OVER</code> 子句，指定如何将查询行划分为一组，以便由窗口函数处理。</p>
<ul>
<li>第一个 <code>OVER</code> 子句是空的，它将整个查询行集作为一个单一的分区。因此，窗口函数产生一个全局性的和，但对每一行都是如此。</li>
<li>第二个 <code>OVER</code> 子句按国家划分行，产生每个分区（每个国家）的总和。该函数对每个分区的行产生这个总和。</li>
</ul>
<p>窗口函数只允许在选择列表和 <code>ORDER BY</code> 子句中使用。查询结果行由 <code>FORM</code> 子句确定，在 <code>WHERE</code>、<code>GROUP BY</code> 和 <code>HAVING</code> 处理之后，窗口执行发生在 <code>ORDER BY</code>、<code>LIMIT</code> 和 <code>SELECT DISTINCT</code> 之前。</p>
<div class="admonition tip">
<p class="admonition-title">Important</p>
<p>如果在使用 <code>GROUP BY</code> 之后使用窗口函数，窗口函数只能处理分组后的结果，而不是原始的表数据。</p>
</div>
<p><code>OVER</code> 子句被允许用于许多聚合函数，因此可以作为窗口函数或非窗口函数使用，这取决于 <code>OVER</code> 子句是存在还是不存在：</p>
<div class="highlight"><pre><span></span><code>AVG()
BIT_AND()
BIT_OR()
BIT_XOR()
COUNT()
JSON_ARRAYAGG()
JSON_OBJECTAGG()
MAX()
MIN()
STDDEV_POP(), STDDEV(), STD()
STDDEV_SAMP()
SUM()
VAR_POP(), VARIANCE()
VAR_SAMP()
</code></pre></div>
<p>MySQL 还支持仅作为窗口函数使用的非聚合函数。对于这些，<code>OVER</code> 子句是强制性的：</p>
<div class="highlight"><pre><span></span><code>CUME_DIST()
DENSE_RANK()
FIRST_VALUE()
LAG()
LAST_VALUE()
LEAD()
NTH_VALUE()
NTILE()
PERCENT_RANK()
RANK()
ROW_NUMBER()
</code></pre></div>
<p>作为这些非聚合窗口函数中的一个例子，这个查询使用 <code>ROW_NUMBER()</code>，产生其分区中每一行的行号。在这种情况下，行是按国家编号的。默认情况下，分区的行是无序的，行的编号是不确定的。要对分区行进行排序，请在窗口定义中包含一个 <code>ORDER BY</code> 子句。这个查询使用无序分区和有序分区（<code>row_num1</code> 和 <code>row_num2</code> 列）来说明省略和包含 <code>ORDER BY</code> 的区别：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span>
<span class="w">         </span><span class="kt">year</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">profit</span><span class="p">,</span>
<span class="w">         </span><span class="k">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="p">(</span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">row_num1</span><span class="p">,</span>
<span class="w">         </span><span class="k">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="p">(</span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">year</span><span class="p">,</span><span class="w"> </span><span class="n">product</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">row_num2</span>
<span class="w">       </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span><span class="p">;</span>
<span class="o">+------+---------+------------+--------+----------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">profit</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">row_num1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">row_num2</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+----------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Finland</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Phone</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">India</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1200</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Calculator</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">50</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1500</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Computer</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1200</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">TV</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="mi">150</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">USA</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">TV</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+------------+--------+----------+----------+</span>
</code></pre></div>
<p>如前所述，要使用窗口函数（或将聚合函数视为窗口函数），请在函数调用后包含一个 <code>OVER</code> 子句。<code>OVER</code> 子句有两种形式：</p>
<div class="highlight"><pre><span></span><code><span class="n">over_clause</span><span class="o">:</span>
<span class="w">    </span><span class="err">{</span><span class="k">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">window_spec</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">window_name</span><span class="err">}</span>
</code></pre></div>
<p>这两种形式都定义了窗口函数应该如何处理查询行。它们的区别在于窗口是直接在 <code>OVER</code> 子句中定义，还是通过对查询中其他地方定义的命名窗口的引用来提供：</p>
<ul>
<li>在第一种情况下，窗口规范直接出现在 <code>OVER</code>  子句中，在括号之间。</li>
<li>在第二种情况下，<em>window_name</em> 是由查询中其他地方的 <code>WINDOW</code> 子句定义的窗口规范的名称。</li>
</ul>
<p>对于 <code>OVER (window_spec)</code>语法，窗口规范有几个部分，都是可选的：</p>
<div class="highlight"><pre><span></span><code><span class="n">window_spec</span><span class="o">:</span>
<span class="w">    </span><span class="err">[</span><span class="n">window_name</span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="n">partition_clause</span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="n">order_clause</span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="n">frame_clause</span><span class="err">]</span>
</code></pre></div>
<p>如果 <code>OVER()</code> 为空，则窗口由所有查询行组成，窗口函数使用所有行计算结果。否则，括号内的子句决定了哪些查询行被用来计算函数结果，以及如何对它们进行分区和排序：</p>
<ul>
<li>
<p><em>window_name</em>：由查询中其他地方的 <code>WINDOW</code> 子句定义的窗口名称。如果 <em>window_name</em> 本身出现在 <code>OVER</code> 子句中，它就完全定义了这个窗口。如果还给出了分区、排序或者框架子句，那么它们会修改对命名的窗口的解释。</p>
</li>
<li>
<p><em>partition_clause</em>：<code>PARTITION BY</code> 子句表示如何将查询行分成组，可以理解为 <code>GROUP BY</code>。如果忽略 <code>PARTITION BY</code>，则只有一个由所有查询行组成的分区。</p>
<p><em>partition_clause</em> 具有以下语法：</p>
<div class="highlight"><pre><span></span><code><span class="n">partition_clause</span><span class="o">:</span>
<span class="w">    </span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="err">[</span><span class="p">,</span><span class="w"> </span><span class="n">expr</span><span class="err">]</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
<p>标准 SQL 要求 <code>PARTITION BY</code> 后面只跟列名。MySQL 扩展允许表达式，而不仅仅是列名。例如，如果一个表包含一个名为 <code>ts</code> 的 <code>TIMESTAMP</code> 列，标准 SQL 允许 <code>PARTITION BY ts</code>，但不允许 <code>PARTITION BY HOUR(ts)</code>，而 MySQL 允许两者。</p>
</li>
<li>
<p><em>order_clause</em>：<code>ORDER BY</code> 子句表明如何对每个分区的行进行排序。根据 <code>ORDER BY</code> 子句相等的分区行被认为是对等的。如果省略了 <code>ORDER BY</code>，分区行是无序的，不隐含处理顺序，所有的分区行都是对等的。</p>
<p><em>order_clause</em> 具有以下语法：</p>
<div class="highlight"><pre><span></span><code><span class="n">order_clause</span><span class="o">:</span>
<span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="err">[</span><span class="k">ASC</span><span class="o">|</span><span class="k">DESC</span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="p">,</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="err">[</span><span class="k">ASC</span><span class="o">|</span><span class="k">DESC</span><span class="err">]]</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
<p>每个 <code>ORDER BY</code> 表达式后面可以选择 <code>ASC</code> 或 <code>DESC</code> 来表示排序方向。如果没有指定方向，默认是 <code>ASC</code>。对于升序排序，<code>NULL</code> 值优先排序，对于降序排序，最后排序。</p>
<p>窗口定义中的 <code>ORDER BY</code> 适用于各个分区。要将结果集作为一个整体进行排序，请在查询的顶层包含一个 <code>ORDER BY</code>。</p>
</li>
<li>
<p><em>frame_clause</em>：框架是当前分区的一个子集，<em>frame_clause</em> 指定了如何定义这个子集。<em>frame_clause</em> 有很多自己的子句。详见下一节。</p>
</li>
</ul>
<h4 id="1122">11.2.2、窗口功能框架规范<a class="headerlink" href="#1122" title="Permanent link">&para;</a></h4>
<p>与窗口函数一起使用的窗口的定义可以包括一个框架子句。框架是当前分区的一个子集，框架子句指定了如何定义这个子集。</p>
<p>框架是相对于当前行确定的，这使得框架可以根据当前行在其分区中的位置在分区中移动。例子：</p>
<ul>
<li>通过将一个框架定义为从分区开始到当前行的所有行，你可以计算每行的累加值。</li>
<li>通过将一个框架定义为在当前行的两侧延伸 N 行，你可以计算滚动平均值。</li>
</ul>
<p>下面的查询演示了使用移动框架来计算每组按时间顺序排列的 <code>val</code> 的累加值，以及从当前行及其前后的行中计算的滚动平均值：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span>
<span class="w">         </span><span class="kt">time</span><span class="p">,</span><span class="w"> </span><span class="k">subject</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">,</span>
<span class="w">         </span><span class="nf">SUM</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">subject</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">time</span>
<span class="w">                        </span><span class="k">ROWS</span><span class="w"> </span><span class="k">UNBOUNDED</span><span class="w"> </span><span class="k">PRECEDING</span><span class="p">)</span>
<span class="w">           </span><span class="k">AS</span><span class="w"> </span><span class="n">running_total</span><span class="p">,</span>
<span class="w">         </span><span class="k">AVG</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">subject</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">time</span>
<span class="w">                        </span><span class="k">ROWS</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FOLLOWING</span><span class="p">)</span>
<span class="w">           </span><span class="k">AS</span><span class="w"> </span><span class="n">running_average</span>
<span class="w">       </span><span class="k">FROM</span><span class="w"> </span><span class="n">observations</span><span class="p">;</span>
<span class="o">+----------+---------+------+---------------+-----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">time</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">subject</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">val</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">running_total</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">running_average</span><span class="w"> </span><span class="o">|</span>
<span class="o">+----------+---------+------+---------------+-----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mf">9.5000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">19</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mf">14.6667</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">44</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mf">18.0000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">20</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">64</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mf">22.5000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mf">5.0000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mf">5.0000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">15</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mf">15.0000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">30</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">45</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mf">20.0000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">70</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mf">27.5000</span><span class="w"> </span><span class="o">|</span>
<span class="o">+----------+---------+------+---------------+-----------------+</span>
</code></pre></div>
<p>对于 <code>running_average</code> 列，在第一行之前和最后一行之后都没有框架行。在这些情况下，<code>AVG()</code> 计算的是现有行的平均值。</p>
<p>作为窗口函数的聚合函数对当前行框架中的行进行操作，这些非聚合窗口函数也是如此。</p>
<div class="highlight"><pre><span></span><code>FIRST_VALUE()
LAST_VALUE()
NTH_VALUE()
</code></pre></div>
<p>标准 SQL 规定，对整个分区进行操作的窗口函数不应该有框架子句。MySQL 允许这类函数有一个框架子句，但会忽略它。即使指定了一个框架，这些函数也会使用整个分区：</p>
<div class="highlight"><pre><span></span><code>CUME_DIST()
DENSE_RANK()
LAG()
LEAD()
NTILE()
PERCENT_RANK()
RANK()
ROW_NUMBER()
</code></pre></div>
<p>如果给出框架子句，其语法是这样的：</p>
<div class="highlight"><pre><span></span><code>frame_clause:
    frame_units frame_extent

frame_units:
    {ROWS | RANGE}
</code></pre></div>
<p>在没有框架子句的情况下，默认的框架取决于是否存在 <code>ORDER BY</code> 子句，后面会讲。</p>
<p><em>frame_units</em> 值表示当前行与框架行之间的关系类型：</p>
<ul>
<li><code>ROWS</code>：框架由开始和结束行位置定义。偏移量是行号与当前行号之间的差异。</li>
<li><code>RANGE</code>：框架是由数值范围内的行定义的。偏移量是行值与当前行值的差异。</li>
</ul>
<p><em>frame_extent</em> 值表示框架的开始和结束点。你可以只指定框架的起点（在这种情况下，当前行是隐含的终点），或者使用 <code>BETWEEN</code> 来指定两个框架的端点：</p>
<div class="highlight"><pre><span></span><code>frame_extent:
    {frame_start | frame_between}

frame_between:
    BETWEEN frame_start AND frame_end

frame_start, frame_end: {
    CURRENT ROW
  | UNBOUNDED PRECEDING
  | UNBOUNDED FOLLOWING
  | expr PRECEDING
  | expr FOLLOWING
}
</code></pre></div>
<p>对于 <code>BETWEEN</code> 语法，<em>frame_start</em> 不能出现在 <em>frame_end</em> 之后。</p>
<p>允许的 <em>frame_start</em> 和 <em>frame_end</em> 值有这些含义：</p>
<ul>
<li>
<p><code>CURRENT ROW</code>：对于 <code>ROWS</code>，边界是当前行。对于 <code>RANGE</code>，边界是当前行的同级。</p>
</li>
<li>
<p><code>UNBOUNDED PRECEDING</code>：边界是第一个分区行。</p>
</li>
<li>
<p><code>UNBOUNDED FOLLOWING</code>：边界是最后一个分区行。</p>
</li>
<li>
<p><code>expr PRECEDING</code>：对于 <code>ROWS</code>，边界是当前行之前的 <em>expr</em> 行。对于 <code>RANGE</code>，边界是值等于当前行值减去 <em>expr</em> 的行；如果当前行值是<code>NULL</code>，边界是该行的同级。</p>
</li>
<li>
<p><code>expr FOLLOWING</code>：对于 <code>ROWS</code> 来说，边界是当前行之后的 <em>expr</em> 行。对于 <code>RANGE</code>，边界是值等于当前行值加上 <em>expr</em> 的行；如果当前行值是 <code>NULL</code>，边界是该行的同级。</p>
<p>对于 <code>expr PRECEDING</code>（和 <code>expr FOLLOWING</code>），<em>expr</em> 可以是一个 ? 参数标记（在准备好的语句中使用），一个非负数的数字字头，或者一个 <code>INTERVAL val unit</code> 形式的时间间隔。对于 <code>INTERVAL</code> 表达式，<em>val</em> 指定了非负的间隔值，<em>unit</em> 是一个关键字，表示该值应该被解释的单位。</p>
<p>数字或时间 <em>expr</em> 上的 <code>RANGE</code> 分别要求数字或时间表达式上的 <code>ORDER BY</code>。</p>
<p>有效的 <code>expr PRECEDING</code> 和 <code>expr FOLLOWING</code> 指标的例子：</p>
<div class="highlight"><pre><span></span><code><span class="mi">10</span><span class="w"> </span><span class="k">PRECEDING</span>
<span class="k">INTERVAL</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">DAY</span><span class="w"> </span><span class="k">PRECEDING</span>
<span class="mi">5</span><span class="w"> </span><span class="k">FOLLOWING</span>
<span class="k">INTERVAL</span><span class="w"> </span><span class="s1">&#39;2:30&#39;</span><span class="w"> </span><span class="k">MINUTE_SECOND</span><span class="w"> </span><span class="k">FOLLOWING</span>
</code></pre></div>
</li>
</ul>
<p>下面的查询演示了 <code>FIRST_VALUE()</code>、<code>LAST_VALUE()</code>  和 <code>NTH_VALUE()</code> 的两个实例：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span>
<span class="w">         </span><span class="kt">time</span><span class="p">,</span><span class="w"> </span><span class="k">subject</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">,</span>
<span class="w">         </span><span class="k">FIRST_VALUE</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w">  </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;first&#39;</span><span class="p">,</span>
<span class="w">         </span><span class="k">LAST_VALUE</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w">   </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;last&#39;</span><span class="p">,</span>
<span class="w">         </span><span class="k">NTH_VALUE</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;second&#39;</span><span class="p">,</span>
<span class="w">         </span><span class="k">NTH_VALUE</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;fourth&#39;</span>
<span class="w">       </span><span class="k">FROM</span><span class="w"> </span><span class="n">observations</span>
<span class="w">       </span><span class="k">WINDOW</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">subject</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">time</span>
<span class="w">                    </span><span class="k">ROWS</span><span class="w"> </span><span class="k">UNBOUNDED</span><span class="w"> </span><span class="k">PRECEDING</span><span class="p">);</span>
<span class="o">+----------+---------+------+-------+------+--------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">time</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">subject</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">val</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">last</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">second</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">fourth</span><span class="w"> </span><span class="o">|</span>
<span class="o">+----------+---------+------+-------+------+--------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">20</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">20</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">20</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">30</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">30</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">30</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">30</span><span class="w"> </span><span class="o">|</span>
<span class="o">+----------+---------+------+-------+------+--------+--------+</span>
</code></pre></div>
<p>每个函数都使用当前框架中的行，根据所示的窗口定义，从第一个分区行延伸到当前框架。对于 <code>NTH_VALUE()</code> 的调用，当前框架并不总是包括所请求的行；在这种情况下，返回值是 <code>NULL</code>。</p>
<p>在没有框架子句的情况下，默认框架取决于是否存在 <code>ORDER BY</code> 子句：</p>
<ul>
<li>
<p>有 <code>ORDER BY</code>：默认的框架包括从分区开始到当前行的记录，包括当前行的所有同级别的记录（根据 <code>ORDER BY</code> 子句，等于当前行的记录）。默认情况下等同于这个框架规范：</p>
<div class="highlight"><pre><span></span><code><span class="k">RANGE</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">UNBOUNDED</span><span class="w"> </span><span class="k">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span>
</code></pre></div>
</li>
<li>
<p>没有 <code>ORDER BY</code>：默认的框架包括所有分区行（因为在没有 <code>ORDER BY</code>的情况下，所有分区行都是同行）。默认情况等同于这个框架规范：</p>
<div class="highlight"><pre><span></span><code><span class="k">RANGE</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">UNBOUNDED</span><span class="w"> </span><span class="k">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">UNBOUNDED</span><span class="w"> </span><span class="k">FOLLOWING</span>
</code></pre></div>
</li>
</ul>
<p>因为默认的框架因 <code>ORDER BY</code> 的存在与否而不同，在查询中加入 <code>ORDER BY</code> 以获得确定的结果可能会改变结果。（例如，由 <code>SUM()</code> 产生的值可能会改变）。为了获得相同的结果，但按 <code>ORDER BY</code> 排序，请提供一个明确的框架规范，无论 <code>ORDER BY</code> 是否存在都要使用。</p>
<p>当当前行值为 <code>NULL</code> 时，框架规范的含义可能是不明显的。假设是这种情况，这些例子说明了各种框架规范的应用：</p>
<ul>
<li>
<p><code>mysql
    ORDER BY X ASC RANGE BETWEEN 10 FOLLOWING AND 15 FOLLOWING</code></p>
<p>这个框架从 <code>NULL</code> 开始，到 <code>NULL</code> 结束，因此只包括数值为 <code>NULL</code> 的记录。</p>
</li>
<li>
<p><code>mysql
    ORDER BY X ASC RANGE BETWEEN 10 FOLLOWING AND UNBOUNDED FOLLOWING</code></p>
<p>这个框架从 <code>NULL</code> 开始，到分区的末尾为止。因为 <code>ASC</code> 排序将 <code>NULL</code> 值放在前面，所以框架是整个分区。</p>
</li>
<li>
<p><code>mysql
    ORDER BY X DESC RANGE BETWEEN 10 FOLLOWING AND UNBOUNDED FOLLOWING</code></p>
<p>这个框架从 <code>NULL</code> 开始，在分区的末端停止。因为 <code>DESC</code> 排序将 <code>NULL</code> 值放在最后，所以框架中只有 <code>NULL</code> 值。</p>
</li>
<li>
<p><code>mysql
    ORDER BY X ASC RANGE BETWEEN 10 PRECEDING AND UNBOUNDED FOLLOWING</code></p>
<p>这个框架从 <code>NULL</code> 开始，到分区的末尾为止。因为 <code>ASC</code> 排序将 <code>NULL</code> 值放在前面，所以框架是整个分区。</p>
</li>
<li>
<p><code>mysql
    ORDER BY X ASC RANGE BETWEEN 10 PRECEDING AND 10 FOLLOWING</code></p>
<p>这个框架从 <code>NULL</code> 开始，到 <code>NULL</code> 结束，因此只包括数值为 <code>NULL</code> 的记录。</p>
</li>
<li>
<p><code>mysql
    ORDER BY X ASC RANGE BETWEEN 10 PRECEDING AND 1 PRECEDING</code></p>
<p>这个框架从 <code>NULL</code> 开始，到 <code>NULL</code> 结束，因此只包括数值为 <code>NULL</code> 的记录。</p>
</li>
<li>
<p><code>mysql
    ORDER BY X ASC RANGE BETWEEN UNBOUNDED PRECEDING AND 10 FOLLOWING</code></p>
<p>这个框架从分区的开始开始，到数值为 <code>NULL</code> 的行为止。因为 <code>ASC</code> 排序将 <code>NULL</code> 值放在首位，所以框架中只有 <code>NULL</code> 值。</p>
</li>
</ul>
<h4 id="1123">11.2.3、窗口的命名<a class="headerlink" href="#1123" title="Permanent link">&para;</a></h4>
<p>在 <code>OVER</code> 子句中，可以定义窗口并赋予其名称，以便对其进行引用。要做到这一点，需要使用 <code>WINDOW</code> 子句。如果在查询中出现，<code>WINDOW</code> 子句会在 <code>HAVING</code> 子句和 <code>ORDER BY</code> 子句的位置之间，并且有这样的语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">WINDOW</span><span class="w"> </span><span class="n">window_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="n">window_spec</span><span class="p">)</span>
<span class="w">        </span><span class="err">[</span><span class="p">,</span><span class="w"> </span><span class="n">window_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="n">window_spec</span><span class="p">)</span><span class="err">]</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
<p>对于每个窗口定义，<em>window_name</em> 是窗口名称，而 <em>window_spec</em> 是在 <code>OVER</code> 子句的括号中给出的相同类型的窗口规范：</p>
<div class="highlight"><pre><span></span><code><span class="n">window_spec</span><span class="o">:</span>
<span class="w">        </span><span class="err">[</span><span class="n">window_name</span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="n">partition_clause</span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="n">order_clause</span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="n">frame_clause</span><span class="err">]</span>
</code></pre></div>
<p><code>WINDOW</code> 子句在查询中非常有用，否则多个 <code>OVER</code> 子句会定义同一个窗口。相反，你可以只定义一次窗口，给它一个名字，然后在 <code>OVER</code> 子句中引用这个名字。考虑一下这个查询，它多次定义了同一个窗口：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">val</span><span class="p">,</span>
<span class="w">    </span><span class="k">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;row_number&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="k">RANK</span><span class="p">()</span><span class="w">       </span><span class="k">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;rank&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="k">DENSE_RANK</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;dense_rank&#39;</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span><span class="p">;</span>
</code></pre></div>
<p>通过使用 <code>WINDOW</code> 来定义一次窗口，并在 <code>OVER</code> 子句中用名称来引用窗口，可以更简单地编写查询：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">val</span><span class="p">,</span>
<span class="w">    </span><span class="k">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;row_number&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="k">RANK</span><span class="p">()</span><span class="w">       </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;rank&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="k">DENSE_RANK</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;dense_rank&#39;</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span>
<span class="k">WINDOW</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
</code></pre></div>
<p>命名窗口还可以更容易地试验窗口定义，以查看对查询结果的影响。只需要修改 <code>window</code> 子句中的窗口定义，而不需要修改多个 <code>OVER</code> 子句定义。</p>
<p>如果 <code>OVER</code> 子句使用 <code>OVER(window_name ...)</code> 而不是 <code>OVER window_name</code> ，那么可以通过增加其他子句来修改命名的窗口。例如，这个查询定义了一个包括分区的窗口，并在 <code>OVER</code> 子句中使用 <code>ORDER BY</code> 以不同的方式修改该窗口：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="k">DISTINCT</span><span class="w"> </span><span class="kt">year</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span>
<span class="w">    </span><span class="k">FIRST_VALUE</span><span class="p">(</span><span class="kt">year</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">year</span><span class="w"> </span><span class="k">ASC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">first</span><span class="p">,</span>
<span class="w">    </span><span class="k">FIRST_VALUE</span><span class="p">(</span><span class="kt">year</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">year</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">last</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">sales</span>
<span class="k">WINDOW</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">);</span>
</code></pre></div>
<p><code>OVER</code> 子句只能向命名的窗口添加属性，不能修改它们。如果命名的窗口定义包括分区、排序或框架属性，那么引用窗口名称的 <code>OVER</code> 子句也不能包括同种属性，否则会发生错误：</p>
<ul>
<li>
<p>这个结构是允许的，因为窗口定义和引用的 <code>OVER</code> 子句不包含同种属性：</p>
<div class="highlight"><pre><span></span><code><span class="k">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">)</span>
<span class="p">...</span><span class="w"> </span><span class="k">WINDOW</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>这个结构是不允许的，因为 <code>OVER</code> 子句为一个已经有 <code>PARTITION BY</code> 的命名窗口指定了 <code>PARTITION BY</code>：</p>
<div class="highlight"><pre><span></span><code><span class="k">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">year</span><span class="p">)</span>
<span class="p">...</span><span class="w"> </span><span class="k">WINDOW</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">)</span>
</code></pre></div>
</li>
</ul>
<p>一个命名的窗口的定义本身可以以 <em>window_name</em> 开始。在这种情况下，允许向前和向后引用，但不允许循环：</p>
<ul>
<li>
<p>这是被允许的；它包含向前和向后的引用，但没有循环：</p>
<div class="highlight"><pre><span></span><code><span class="k">WINDOW</span><span class="w"> </span><span class="n">w1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="n">w2</span><span class="p">),</span><span class="w"> </span><span class="n">w2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="n">w3</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>这是不允许的，因为它包含一个循环：</p>
<div class="highlight"><pre><span></span><code><span class="k">WINDOW</span><span class="w"> </span><span class="n">w1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="n">w2</span><span class="p">),</span><span class="w"> </span><span class="n">w2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="n">w3</span><span class="p">),</span><span class="w"> </span><span class="n">w3</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</code></pre></div>
</li>
</ul>
<h4 id="1124">11.2.4、窗口函数介绍<a class="headerlink" href="#1124" title="Permanent link">&para;</a></h4>
<p>本节描述非聚合窗口函数，对于查询中的每一行，使用与该行相关的行执行计算。大多数聚合函数也可以用作窗口函数。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CUME_DIST()</code></td>
<td>累计分布值</td>
</tr>
<tr>
<td><code>DENSE_RANK()</code></td>
<td>当前行在其分区内的排名，没有间隙</td>
</tr>
<tr>
<td><code>FIRST_VALUE()</code></td>
<td>窗口框架第一行的参数值</td>
</tr>
<tr>
<td><code>LAG()</code></td>
<td>分区内滞后于当前行的参数值</td>
</tr>
<tr>
<td><code>LAST_VALUE()</code></td>
<td>窗口框架最后一行的参数值</td>
</tr>
<tr>
<td><code>LEAD()</code></td>
<td>分区内领先于当前行的参数值</td>
</tr>
<tr>
<td><code>NTH_VALUE()</code></td>
<td>窗口框架第 N 行的参数值</td>
</tr>
<tr>
<td><code>NTILE()</code></td>
<td>当前行在其分区中的桶号</td>
</tr>
<tr>
<td><code>PERCENT_RANK()</code></td>
<td>百分比排名值</td>
</tr>
<tr>
<td><code>RANK()</code></td>
<td>当前行在其分区中的排名，有空隙</td>
</tr>
<tr>
<td><code>ROW_NUMBER()</code></td>
<td>当前行在其分区中的编号</td>
</tr>
</tbody>
</table>
<p>在下面的函数描述中，<em>over_clause</em> 代表 <code>OVER</code> 子句。一些窗口函数允许使用 <em>null_treatment</em> 子句来指定在计算结果时如何处理 NULL 值。这个子句是可选的。它是 SQL 标准的一部分，但 MySQL 的实现只允许 <code>RESPECT NULLS</code>（这也是默认的）。这意味着在计算结果时会考虑空值。会解析 <code>IGNORE NULLS</code>，但会产生错误。</p>
<h5 id="cume_dist">CUME_DIST()<a class="headerlink" href="#cume_dist" title="Permanent link">&para;</a></h5>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">CUME_DIST</span><span class="p">()</span><span class="w"> </span><span class="n">over_clause</span>
</code></pre></div>
<p>返回一组数值中的累积分布；也就是说，分区值小于或等于当前行的值的百分比。这表示在窗口分区的窗口排序中，在当前行之前或同级的行数除以窗口分区的总行数。返回值的范围从 0 到 1。</p>
<p>这个函数应该与 <code>ORDER BY</code> 一起使用，以按照所需的顺序对分区行进行排序。如果没有 <code>ORDER BY</code>，所有行都是对等的，值为 <code>N/N = 1</code>，其中N 是分区大小。</p>
<p>下面的查询显示：对于 <code>val</code> 列中的一组数值、每一行的 <code>CUME_DIST()</code> 值以及由类似的 <code>PERCENT_RANK()</code> 函数返回的百分比排名值。作为参考，该查询还使用 <code>ROW_NUMBER()</code> 显示行号：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span>
<span class="w">                </span><span class="n">val</span><span class="p">,</span>
<span class="w">                </span><span class="k">ROW_NUMBER</span><span class="p">()</span><span class="w">   </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;row_number&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="k">CUME_DIST</span><span class="p">()</span><span class="w">    </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;cume_dist&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="k">PERCENT_RANK</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;percent_rank&#39;</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span>
<span class="w">            </span><span class="k">WINDOW</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="o">+------+------------+--------------------+--------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">val</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">row_number</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">cume_dist</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">percent_rank</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+------------+--------------------+--------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">0.2222222222222222</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">0.2222222222222222</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">0.3333333333333333</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mf">0.25</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">0.6666666666666666</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mf">0.375</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">0.6666666666666666</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mf">0.375</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">0.6666666666666666</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mf">0.375</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">0.8888888888888888</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mf">0.75</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">0.8888888888888888</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mf">0.75</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">                  </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+------------+--------------------+--------------+</span>
</code></pre></div>
<p>在此示例中，<code>val</code> 按从 1 到 5 的升序排序。</p>
<p>对于第一行，函数查找结果集中的行数，其值小于或等于 1 。结果为 2。然后 <code>CUME_DIST()</code> 函数将 2 除以总行数 9：2/9。结果是 0.2222222222222222。相同的逻辑应用于第二行。</p>
<p>对于第三行，函数查找值小于或等于 2 的行数。有 3 行。然后 <code>CUME_DIST()</code> 函数的结果是：3/9 = 0.3333333333333333。</p>
<p>相同的计算逻辑应用于其余行。</p>
<h5 id="dense_rank">DENSE_RANK()<a class="headerlink" href="#dense_rank" title="Permanent link">&para;</a></h5>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">DENSE_RANK</span><span class="p">()</span><span class="w"> </span><span class="n">over_clause</span>
</code></pre></div>
<p>返回当前行在其分区中的排名，没有空隙。同行被认为是并列的，获得相同的排名。这个函数将连续的排名分配给同级组；结果是大小大于 1 的组不会产生非连续的等级数字。</p>
<p>这个函数应该和 <code>ORDER BY</code> 一起使用，将分区行排序到所需的顺序。没有 <code>ORDER BY</code>，所有的行都是同行。</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="k">SELECT</span>
<span class="w">                </span><span class="n">val</span><span class="p">,</span>
<span class="w">                </span><span class="k">DENSE_RANK</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="p">(</span>
<span class="w">                        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">val</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="n">my_rank</span>
<span class="w">            </span><span class="k">FROM</span>
<span class="w">                </span><span class="n">rankDemo</span><span class="p">;</span><span class="w"> </span>
<span class="o">+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">val</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">my_rank</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+---------+</span>
</code></pre></div>
<h5 id="first_value">FIRST_VALUE()<a class="headerlink" href="#first_value" title="Permanent link">&para;</a></h5>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">FIRST_VALUE</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span><span class="w"> </span><span class="err">[</span><span class="n">null_treatment</span><span class="err">]</span><span class="w"> </span><span class="n">over_clause</span>
</code></pre></div>
<p>从窗口框架的第一行返回 <em>expr</em> 的值。</p>
<p>下面的查询演示了 <code>FIRST_VALUE()</code>、<code>LAST_VALUE()</code> 和两个 <code>NTH_VALUE()</code> 实例：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span>
<span class="w">                </span><span class="kt">time</span><span class="p">,</span><span class="w"> </span><span class="k">subject</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">,</span>
<span class="w">                </span><span class="k">FIRST_VALUE</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w">  </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;first&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="k">LAST_VALUE</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w">   </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;last&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="k">NTH_VALUE</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;second&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="k">NTH_VALUE</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;fourth&#39;</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">observations</span>
<span class="w">            </span><span class="k">WINDOW</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">subject</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="kt">time</span>
<span class="w">                                        </span><span class="k">ROWS</span><span class="w"> </span><span class="k">UNBOUNDED</span><span class="w"> </span><span class="k">PRECEDING</span><span class="p">);</span>
<span class="o">+----------+---------+------+-------+------+--------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="kt">time</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">subject</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">val</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">last</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">second</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">fourth</span><span class="w"> </span><span class="o">|</span>
<span class="o">+----------+---------+------+-------+------+--------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">st113</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">20</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">20</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">20</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">07</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">30</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">30</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">30</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xh458</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">30</span><span class="w"> </span><span class="o">|</span>
<span class="o">+----------+---------+------+-------+------+--------+--------+</span>
</code></pre></div>
<p>每个函数都使用当前框架中的行，根据所示的窗口定义，从第一个分区行延伸到当前行。对于 <code>NTH_VALUE()</code> 的调用，当前框架并不总是包括所请求的行；在这种情况下，返回值是 <code>NULL</code>。</p>
<h5 id="lag">LAG()<a class="headerlink" href="#lag" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="k">LAG</span><span class="p">(</span><span class="n">expr</span><span class="w"> </span><span class="err">[</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="err">[</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="err">]]</span><span class="p">)</span><span class="w"> </span><span class="err">[</span><span class="n">null_treatment</span><span class="err">]</span><span class="w"> </span><span class="n">over_clause</span>
</code></pre></div>
<p>返回 <em>expr</em> 的值，该值来自于在其分区内滞后于（先于）当前行的 <em>N</em> 行的行。如果没有这样的行，返回值为 <em>default</em>。例如，如果 <em>N</em> 是 3，返回的 <em>default</em> 值为前两行。如果缺少 <em>N</em> 或 <em>default</em>，默认值分别为 1 和 <code>NULL</code>。</p>
<p><em>N</em> 必须是一个文本非负整数。如果 <em>N</em> 为 0，<em>expr</em> 将被评估为当前行。</p>
<p>从 MySQL 8.0.22 开始，<em>N</em> 不能是 <code>NULL</code>。此外，它现在必须是 1 到 2^63^ 范围内的一个整数，包括以下任何一种形式：</p>
<ul>
<li>无符号整数常量文字</li>
<li>位置参数标记（?）</li>
<li>用户定义的变量</li>
<li>存储例程中的局部变量</li>
</ul>
<p><code>LAG()</code>（和类似的 <code>LEAD()</code> 函数）经常被用来计算行之间的差异。下面的查询显示了一组按时间顺序排列的观测值，对于每一个观测值，都显示了相邻行的 <code>LAG()</code>和 <code>LEAD()</code> 值，以及当前行和相邻行的差异：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span>
<span class="w">                </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">,</span>
<span class="w">                </span><span class="k">LAG</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w">        </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;lag&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="k">LEAD</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w">       </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;lead&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="n">val</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">LAG</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w">  </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;lag diff&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="n">val</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">LEAD</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;lead diff&#39;</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">series</span>
<span class="w">            </span><span class="k">WINDOW</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="o">+----------+------+------+------+----------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">t</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">val</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">lag</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">lead</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">lag</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">lead</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">|</span>
<span class="o">+----------+------+------+------+----------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">12</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">125</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="o">-</span><span class="mi">25</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">13</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">125</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">132</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="o">-</span><span class="mi">7</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">14</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">132</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">125</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">145</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="o">-</span><span class="mi">13</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">15</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">145</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">132</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">13</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">16</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">145</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">150</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="o">-</span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="o">-</span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">17</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">150</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">200</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="o">-</span><span class="mi">50</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">18</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">200</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">150</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">50</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="no">NULL</span><span class="w"> </span><span class="o">|</span>
<span class="o">+----------+------+------+------+----------+-----------+</span>
</code></pre></div>
<p>在本例中，<code>LAG()</code> 和 <code>LEAD()</code> 调用的是默认的 <em>N</em> 和 <em>default</em>，值为 1 和 <code>NULL</code>。</p>
<p>第一行显示了当没有 <code>LAG()</code> 的前一行时会发生什么:函数返回默认值（在本例中为 <code>NULL</code>）。当 <code>LEAD()</code> 没有下一行时，最后一行显示了相同的内容。</p>
<p><code>LAG()</code> 和 <code>LEAD()</code> 也是为了计算总和而不是差异。考虑这个数据集，它包含斐波那契数列的前几个数字：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="o">+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w">    </span><span class="o">|</span>
<span class="o">+------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+</span>
</code></pre></div>
<p>下面的查询显示了与当前行相邻的行的 <code>LAG()</code> 和 <code>LEAD()</code> 值。它还使用这些函数将前面和后面的行的值添加到当前行的值中。其效果是生成斐波那契数列中的下一个数字，以及其后的数字：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span>
<span class="w">                </span><span class="n">n</span><span class="p">,</span>
<span class="w">                </span><span class="k">LAG</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">      </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;lag&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="k">LEAD</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">     </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;lead&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">LAG</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;next_n&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">LEAD</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;next_next_n&#39;</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">fib</span>
<span class="w">            </span><span class="k">WINDOW</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<span class="o">+------+------+------+--------+-------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">lag</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">lead</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">next_n</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">next_next_n</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+------+------+--------+-------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">13</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">13</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+------+------+--------+-------------+</span>
</code></pre></div>
<p>生成斐波那契数字初始集的一种方法是使用递归公共表表达式。</p>
<p>从 MySQL 8.0.22 开始，你不能为这个函数的行参数使用一个负值。</p>
<h5 id="last-value">LAST VALUE()<a class="headerlink" href="#last-value" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="k">LAST_VALUE</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span><span class="w"> </span><span class="err">[</span><span class="n">null_treatment</span><span class="err">]</span><span class="w"> </span><span class="n">over_clause</span>
</code></pre></div>
<p>返回窗口框架最后一行中 <em>expr</em> 的值。</p>
<p>例子见 <code>FIRST_VALUE()</code> 函数描述。</p>
<h5 id="lead">LEAD()<a class="headerlink" href="#lead" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="k">LEAD</span><span class="p">(</span><span class="n">expr</span><span class="w"> </span><span class="err">[</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="err">[</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="err">]]</span><span class="p">)</span><span class="w"> </span><span class="err">[</span><span class="n">null_treatment</span><span class="err">]</span><span class="w"> </span><span class="n">over_clause</span>
</code></pre></div>
<p>返回 <em>expr</em> 的值，该值来自于在其分区中领先（跟随）当前行 <em>N</em> 行的行。如果没有这样的行，返回值为 <em>defalut</em>。例如，如果 <em>N</em> 是 3，那么返回的 <em>default</em> 值为后两行。如果缺少 <em>N</em> 或 <em>default</em>，默认值分别为 1 和 <code>NULL</code>。</p>
<p><em>N</em> 必须是一个文本非负整数。如果 <em>N</em> 是 0，<em>expr</em> 将被评估为当前行。</p>
<p>从 MySQL 8.0.22 开始，<em>N</em> 不能是 <code>NULL</code>。此外，它现在必须是 1 到 2^63^ 范围内的一个整数，包括以下任何一种形式：</p>
<ul>
<li>无符号整数常量文字</li>
<li>位置参数标记（?）</li>
<li>用户定义的变量</li>
<li>存储例程中的局部变量</li>
</ul>
<p>有关示例，请参阅 <code>LAG()</code> 函数描述。</p>
<p>从 MySQL 8.0.22 开始，你不能为这个函数的行参数使用一个负值。</p>
<h5 id="nth_value">NTH_VALUE()<a class="headerlink" href="#nth_value" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="k">NTH_VALUE</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="err">[</span><span class="n">from_first_last</span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="n">null_treatment</span><span class="err">]</span><span class="w"> </span><span class="n">over_clause</span>
</code></pre></div>
<p>从窗口框架的第 <em>N</em> 行返回 <em>expr</em> 的值。如果没有这样的行，则返回值为空。</p>
<p><em>N</em> 必须是一个文本正整数。</p>
<p><em>from_first_last</em> 是 SQL 标准的一部分，但 MySQL 的实现只允许 <code>FROM FIRST</code>（这也是默认的）。这意味着计算从窗口的第一行开始。<code>FROM LAST</code> 会被解析，但会产生错误。为了获得与 <code>FROM LAST</code> 相同的效果（从窗口的最后一行开始计算），使用 <code>ORDER BY</code> 以相反的顺序排序。</p>
<p>有关示例，请参见 <code>FIRST_VALUE()</code> 函数描述。</p>
<p>在 MySQL 8.0.22 及以后的版本中，你不能为这个函数的行参数使用 <code>NULL</code>。</p>
<h5 id="ntile">NTILE()<a class="headerlink" href="#ntile" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="k">NTILE</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="n">over_clause</span>
</code></pre></div>
<p>将一个分区划分为 <em>N</em> 个组（桶），为分区中的每一行分配其桶号，并返回其分区中当前行的桶号。例如，如果 <em>N</em> 是4，<code>NTILE()</code> 将行分成四个桶。如果 <em>N</em> 是100，<code>NTILE()</code> 将行分成 100 个桶。</p>
<p><em>N</em> 必须是一个文本正整数。桶号返回值的范围是 1 到 <em>N</em>。</p>
<p>从 MySQL 8.0.22 开始，<em>N</em> 不能是 <code>NULL</code>。此外，它现在必须是 1 到 2^63^ 范围内的一个整数，包括以下任何一种形式：</p>
<ul>
<li>无符号整数常量文字</li>
<li>位置参数标记（?）</li>
<li>用户定义的变量</li>
<li>存储例程中的局部变量</li>
</ul>
<p>这个函数应该与 <code>ORDER BY</code> 一起使用，以按照所需的顺序对分区行进行排序。</p>
<p>下面的查询显示，对于 <code>val</code> 列中的一组数值，将行分为两组或四组后得到的百分位数值。作为参考，该查询也使用 <code>ROW_NUMBER()</code> 显示行数：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span>
<span class="w">                </span><span class="n">val</span><span class="p">,</span>
<span class="w">                </span><span class="k">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;row_number&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="k">NTILE</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">     </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;ntile2&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="k">NTILE</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">     </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;ntile4&#39;</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span>
<span class="w">            </span><span class="k">WINDOW</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="o">+------+------------+--------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">val</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">row_number</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ntile2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ntile4</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+------------+--------+--------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+------------+--------+--------+</span>
</code></pre></div>
<p>从 MySQL 8.0.22 开始，<code>NTILE(NULL)</code> 结构不再被允许。</p>
<h5 id="percent_rank">PERCENT_RANK()<a class="headerlink" href="#percent_rank" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="k">PERCENT_RANK</span><span class="p">()</span><span class="w"> </span><span class="n">over_clause</span>
</code></pre></div>
<p>返回小于当前行中值的分区值的百分比，不包括最高值。返回值的范围是 0 到 1，代表行的相对等级，计算的结果是这个公式，其中 <em>rank</em> 是行的等级（<code>RANK()</code> 函数的返回值），<em>rows</em> 是分区行的数量：</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">rank</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="k">rows</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>这个函数应该与 <code>ORDER BY</code> 一起使用，以按照所需的顺序对分区行进行排序。如果没有 <code>ORDER BY</code>，所有行都是对等的。</p>
<p>有关示例，请参见 <code>CUME_DIST()</code> 函数说明。</p>
<h5 id="rank">RANK()<a class="headerlink" href="#rank" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="k">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">over_clause</span>
</code></pre></div>
<p>返回当前行在其分区中的排名，有空隙。同行被认为是并列的，获得相同的排名。如果存在大小大于 1 的组，这个函数不会给同级组分配连续的排名；结果是不连续的等级数字。</p>
<p>这个函数应该和 <code>ORDER BY</code> 一起使用，将分区行排序到所需的顺序。没有 <code>ORDER BY</code>，所有的行都是同行。</p>
<p>下面的查询显示了 <code>RANK()</code> 和 <code>DENSE_RANK()</code> 之间的区别，前者产生有间隙的排名，后者产生没有间隙的排名。该查询显示了 <code>val</code> 列中一组数值的每个成员的排名值，其中包含一些重复的数值，该查询还使用 <code>ROW_NUMBER()</code> 显示行数：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span>
<span class="w">                </span><span class="n">val</span><span class="p">,</span>
<span class="w">                </span><span class="k">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;row_number&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="k">RANK</span><span class="p">()</span><span class="w">       </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;rank&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="k">DENSE_RANK</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;dense_rank&#39;</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span>
<span class="w">            </span><span class="k">WINDOW</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="o">+------+------------+------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">val</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">row_number</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rank</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">dense_rank</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+------------+------+------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+------------+------+------------+</span>
</code></pre></div>
<h5 id="row_number">ROW_NUMBER()<a class="headerlink" href="#row_number" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="k">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">over_clause</span>
</code></pre></div>
<p>返回其分区中当前行的编号。行号的范围从 1 到分区行数。</p>
<p><code>ORDER BY</code> 影响行编号的顺序。如果没有 <code>ORDER BY</code>，行编号是不确定性的。</p>
<p><code>ROW_NUMBER()</code> 给同行分配不同的行号。要给同行分配相同的值，请使用 <code>RANK()</code> 或 <code>DENSE_RANK()</code> 。有关例子，请参见 <code>RANK()</code> 函数描述。</p>
<h3 id="113">11.3、时间日期相关<a class="headerlink" href="#113" title="Permanent link">&para;</a></h3>
<h4 id="1131">11.3.1、时间差<a class="headerlink" href="#1131" title="Permanent link">&para;</a></h4>
<h5 id="period_diff">PERIOD_DIFF()<a class="headerlink" href="#period_diff" title="Permanent link">&para;</a></h5>
<p><code>PERIOD_DIFF()</code> 函数返回两个日期之间的月份差。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="n">PERIOD_DIFF</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span><span class="n">endDate</span><span class="p">)</span>
</code></pre></div>
<p><em>startDate</em> 和 <em>endDate</em> 参数是合法的日期或日期/时间表达式。</p>
<p><strong>示例</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">PERIOD_DIFF</span><span class="p">(</span><span class="mi">201710</span><span class="p">,</span><span class="w"> </span><span class="mi">201703</span><span class="p">);</span>
</code></pre></div>
<p><img src="!assets/MySQL/12312312.png" alt="img" style="" /></p>
<p>如果小月份放前面，那么返回负数 -1。</p>
<h5 id="datediff">DATEDIFF()<a class="headerlink" href="#datediff" title="Permanent link">&para;</a></h5>
<p><code>DATEDIFF()</code> 函数返回两个日期之间的天数。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="nf">DATEDIFF</span><span class="p">(</span><span class="n">date1</span><span class="p">,</span><span class="n">date2</span><span class="p">)</span>
</code></pre></div>
<p><em>date1</em> 和 <em>date2</em> 参数是合法的日期或日期/时间表达式。</p>
<p><strong>示例</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="nf">DATEDIFF</span><span class="p">(</span><span class="nf">DATE_FORMAT</span><span class="p">(</span><span class="nf">NOW</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">),</span><span class="nf">DATE_FORMAT</span><span class="p">(</span><span class="s1">&#39;2018-09-10&#39;</span><span class="p">,</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">))</span>
</code></pre></div>
<p>结果：</p>
<p><img src="!assets/MySQL/20180917110456408370.png" alt="技术分享图片" style="" /></p>
<h5 id="timestampdiff">TIMESTAMPDIFF()<a class="headerlink" href="#timestampdiff" title="Permanent link">&para;</a></h5>
<p>根据单位返回时间差，对于传入的 <em>begin</em> 和 <em>end</em> 不需要相同的数据结构，可以存在一个为 Date 一个 DateTime。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">TIMESTAMPDIFF</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span><span class="w"> </span><span class="k">begin</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="p">);</span>
</code></pre></div>
<p><em>unit</em> 参数是确定 (<em>end</em>-<em>begin</em>) 的结果的单位，表示为整数。 以下是有效单位：</p>
<ul>
<li>MICROSECOND  微秒</li>
<li>SECOND  秒 </li>
<li>MINUTE  分钟 </li>
<li>HOUR  小时 </li>
<li>DAY  天 </li>
<li>WEEK  周 </li>
<li>MONTH  月份 </li>
<li>QUARTER  </li>
<li>YEAR  年份</li>
</ul>
<p><strong>示例</strong></p>
<p>2017-05-01 距现在多少天：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">TIMESTAMPDIFF</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="s1">&#39;2017-05-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="nf">DATE_FORMAT</span><span class="p">(</span><span class="nf">NOW</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">))</span>
</code></pre></div>
<p><img src="!assets/MySQL/20180917110456532385.png" alt="技术分享图片" style="zoom:80%;FLOAT:LEFT" /></p>
<p>2017-05-01 距现在多少年：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">TIMESTAMPDIFF</span><span class="p">(</span><span class="kt">YEAR</span><span class="p">,</span><span class="s1">&#39;2017-05-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="nf">DATE_FORMAT</span><span class="p">(</span><span class="nf">NOW</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">))</span>
</code></pre></div>
<p><img src="!assets/MySQL/99f5964ea791f1ca0521e3fb4bc1ab96.png" alt="img" style="zoom:80%;FLOAT:LEFT" /></p>
<p>2017-05-01 距现在多少月：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">TIMESTAMPDIFF</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="s1">&#39;2017-05-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="nf">DATE_FORMAT</span><span class="p">(</span><span class="nf">NOW</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">))</span>
</code></pre></div>
<p><img src="!assets/MySQL/20180917110456254083.png" alt="技术分享图片" style="zoom:80%;FLOAT:LEFT" /></p>
<h4 id="1132">11.3.2、当前日期<a class="headerlink" href="#1132" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="nf">NOW</span><span class="p">(),</span><span class="nf">CURDATE</span><span class="p">(),</span><span class="nf">CURTIME</span><span class="p">();</span>
</code></pre></div>
<p>结果类似：</p>
<p><img src="!assets/MySQL/755765-20190227093739650-528895218.png" alt="img" style="zoom:80%;float:left" /></p>
<h4 id="1133">11.3.3、求几天前几天后<a class="headerlink" href="#1133" title="Permanent link">&para;</a></h4>
<p><code>DATE_SUB()</code> 函数从日期减去指定的时间间隔。</p>
<blockquote>
<p><code>DATE_ADD()</code> 函数向日期添加指定的时间间隔。两种方法使用方式相同。</p>
</blockquote>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="nf">DATE_SUB</span><span class="p">(</span><span class="kt">date</span><span class="p">,</span><span class="k">INTERVAL</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="k">type</span><span class="p">)</span>
</code></pre></div>
<p><em>date</em> 参数是合法的日期表达式。<em>expr</em> 参数是您希望添加的时间间隔。<em>type</em> 参数可以是下列值：</p>
<ul>
<li>MICROSECOND</li>
<li>SECOND</li>
<li>MINUTE</li>
<li>HOUR</li>
<li>DAY</li>
<li>WEEK</li>
<li>MONTH</li>
<li>QUARTER</li>
<li>YEAR</li>
</ul>
<p><strong>实例</strong></p>
<p>获取前一天</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="nf">DATE_SUB</span><span class="p">(</span><span class="nf">CURDATE</span><span class="p">(),</span><span class="k">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DAY</span><span class="p">);</span>
</code></pre></div>
<p>当前日期 2018-09-17，结果：</p>
<p><img src="!assets/MySQL/20180917110455670136.png" alt="技术分享图片" style="zoom:80%;float:left" /></p>
<p>获取后一天</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="nf">DATE_SUB</span><span class="p">(</span><span class="nf">CURDATE</span><span class="p">(),</span><span class="k">INTERVAL</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">DAY</span><span class="p">);</span>
</code></pre></div>
<p>当前日期 2018-09-17，结果：</p>
<p><img src="!assets/MySQL/20180917110455998240.png" alt="技术分享图片" style="zoom:80%;float:left" /></p>
<h4 id="1134">11.3.4、倒数第几天<a class="headerlink" href="#1134" title="Permanent link">&para;</a></h4>
<p><code>LAST_DAY()</code> 返回某月最后一天</p>
<div class="highlight"><pre><span></span><code><span class="nf">LAST_DAY</span><span class="p">(</span><span class="o">&lt;</span><span class="n">日期</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="c1">#最后一天</span>
<span class="nf">LAST_DAY</span><span class="p">(</span><span class="o">&lt;</span><span class="n">日期</span><span class="o">&gt;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="c1">#倒数第二天</span>
<span class="nf">LAST_DAY</span><span class="p">(</span><span class="o">&lt;</span><span class="n">日期</span><span class="o">&gt;</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="c1">#倒数第三天</span>
</code></pre></div>
<h4 id="1135">11.3.5、提取年月日<a class="headerlink" href="#1135" title="Permanent link">&para;</a></h4>
<p><code>EXTRACT()</code> 函数用于返回日期/时间的单独部分，比如年、月、日、小时、分钟等等。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="nf">EXTRACT</span><span class="p">(</span><span class="n">unit</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">日期</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div>
<p><em>date</em> 参数是合法的日期表达式。<em>unit</em> 参数可以是下列的值：</p>
<ul>
<li>MICROSECOND（微秒：一百万分之一秒）</li>
<li>SECOND</li>
<li>MINUTE</li>
<li>HOUR</li>
<li>DAY</li>
<li>WEEK</li>
<li>MONTH</li>
<li>QUARTER</li>
<li>YEAR</li>
<li>SECOND_MICROSECOND</li>
<li>MINUTE_MIRCROSECOND</li>
<li>MINUTE_SECOND</li>
<li>HOUR_MICROSECOND</li>
<li>HOUR_SECOND</li>
<li>HOUR_MINUTE</li>
</ul>
<h4 id="1136">11.3.6、日期转换<a class="headerlink" href="#1136" title="Permanent link">&para;</a></h4>
<h5 id="date_format">DATE_FORMAT()<a class="headerlink" href="#date_format" title="Permanent link">&para;</a></h5>
<p>MySQL 使用 <code>DATE_FORMAT()</code> 函数实现日期格式的转换，即日期类型转字符串类型，<code>DATE_FORMAT(date,format)</code> 函数按照表达式 <em>format</em> 的要求显示日期 <em>date</em>，其语法格式如下：</p>
<div class="highlight"><pre><span></span><code><span class="n">DATE_FORMAT</span><span class="p">(</span><span class="nb">date</span><span class="p">,</span><span class="n">format</span><span class="p">)</span>
</code></pre></div>
<p><em>date</em> 为合法的日期；<em>format</em> 为规定日期/时间的输出格式。</p>
<p>可以使用的格式有：</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>%a</code></td>
<td>缩写星期名</td>
</tr>
<tr>
<td><code>%b</code></td>
<td>缩写月名</td>
</tr>
<tr>
<td><code>%c</code></td>
<td>月，数值</td>
</tr>
<tr>
<td><code>%D</code></td>
<td>带有英文前缀的月中的天</td>
</tr>
<tr>
<td><code>%d</code></td>
<td>月的天，数值(00-31)</td>
</tr>
<tr>
<td><code>%e</code></td>
<td>月的天，数值(0-31)</td>
</tr>
<tr>
<td><code>%f</code></td>
<td>微秒</td>
</tr>
<tr>
<td><code>%H</code></td>
<td>小时 (00-23)</td>
</tr>
<tr>
<td><code>%h</code></td>
<td>小时 (01-12)</td>
</tr>
<tr>
<td><code>%I</code></td>
<td>小时 (01-12)</td>
</tr>
<tr>
<td><code>%i</code></td>
<td>分钟，数值 (00-59)</td>
</tr>
<tr>
<td><code>%j</code></td>
<td>年的天 (001-366)</td>
</tr>
<tr>
<td><code>%k</code></td>
<td>小时 (0-23)</td>
</tr>
<tr>
<td><code>%M</code></td>
<td>月名</td>
</tr>
<tr>
<td><code>%m</code></td>
<td>月，数值 (00-12)</td>
</tr>
<tr>
<td><code>%p</code></td>
<td>AM 或 PM</td>
</tr>
<tr>
<td><code>%r</code></td>
<td>时间，12-小时（hh<img alt="🇲🇲" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/1f1f2-1f1f2.svg" title=":mm:" />ss AM 或 PM）</td>
</tr>
<tr>
<td><code>%S</code></td>
<td>秒 (00-59)</td>
</tr>
<tr>
<td><code>%s</code></td>
<td>秒 (00-59)</td>
</tr>
<tr>
<td><code>%T</code></td>
<td>时间, 24-小时 (hh<img alt="🇲🇲" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/1f1f2-1f1f2.svg" title=":mm:" />ss)</td>
</tr>
<tr>
<td><code>%U</code></td>
<td>周 (00-53) 星期日是一周的第一天</td>
</tr>
<tr>
<td><code>%u</code></td>
<td>周 (00-53) 星期一是一周的第一天</td>
</tr>
<tr>
<td><code>%V</code></td>
<td>周 (01-53) 星期日是一周的第一天，与 %X 使用</td>
</tr>
<tr>
<td><code>%v</code></td>
<td>周 (01-53) 星期一是一周的第一天，与 %x 使用</td>
</tr>
<tr>
<td><code>%W</code></td>
<td>星期名</td>
</tr>
<tr>
<td><code>%w</code></td>
<td>周的天 （0=星期日, 6=星期六）</td>
</tr>
<tr>
<td><code>%X</code></td>
<td>年，其中的星期日是周的第一天，4 位，与 %V 使用</td>
</tr>
<tr>
<td><code>%x</code></td>
<td>年，其中的星期一是周的第一天，4 位，与 %v 使用</td>
</tr>
<tr>
<td><code>%Y</code></td>
<td>年，4 位</td>
</tr>
<tr>
<td><code>%y</code></td>
<td>年，2 位</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<p>使用 <code>DATE_FORMAT()</code> 函数实现日期格式的转换。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="nf">DATE_FORMAT</span><span class="p">(</span><span class="nf">NOW</span><span class="p">(),</span><span class="s1">&#39;%Y年%m月%d日 %H时%i分%s秒&#39;</span><span class="p">);</span>
</code></pre></div>
<p>执行结果：</p>
<div class="highlight"><pre><span></span><code>2019年01月17日 19时05分05秒
</code></pre></div>
<h5 id="str_to_date">STR_TO_DATE()<a class="headerlink" href="#str_to_date" title="Permanent link">&para;</a></h5>
<p>使用 <code>STR_TO_DATE()</code> 函数实现字符串转换日期类型，<code>STR_TO_DATE(str,format)</code> 函数是将时间格式的字符串 <em>str</em>，按照所提供的显示格式 <em>format</em> 转换为 DATETIME 类型的值。</p>
<p><strong>示例</strong></p>
<p>使用 <code>STR_TO_DATE()</code> 函数，将上面示例的结果（字符串类型）转换回日期类型。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="nf">STR_TO_DATE</span><span class="p">(</span><span class="s1">&#39;2019年01月17日 19时05分05秒&#39;</span><span class="p">,</span><span class="s1">&#39;%Y年%m月%d日 %H时%i分%s秒&#39;</span><span class="p">);</span>
</code></pre></div>
<p>执行结果：</p>
<div class="highlight"><pre><span></span><code>2019-01-17 19:05:05
</code></pre></div>
<h3 id="114">11.4、字符串相关<a class="headerlink" href="#114" title="Permanent link">&para;</a></h3>
<h4 id="1141">11.4.1、拆分<a class="headerlink" href="#1141" title="Permanent link">&para;</a></h4>
<h5 id="substring">SUBSTRING()<a class="headerlink" href="#substring" title="Permanent link">&para;</a></h5>
<p><code>SUBSTRING()</code> 函数从特定位置开始的字符串返回一个给定长度的子字符串。 MySQL 提供了各种形式的子串功能。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="nf">SUBSTRING</span><span class="p">(</span><span class="k">string</span><span class="p">,</span><span class="n">position</span><span class="p">,</span><span class="n">length</span><span class="p">);</span>
<span class="nf">SUBSTRING</span><span class="p">(</span><span class="k">string</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
</code></pre></div>
<p>参数：</p>
<ul>
<li><em>string</em>：要提取的字符串</li>
<li><em>position</em>：起始下标，可以是负数</li>
<li><em>length</em>：长度</li>
</ul>
<blockquote>
<p>在 MySQL 中，下标索引是从 1 开始的，而不是像 Java 中从 0 开始。</p>
</blockquote>
<h4 id="1142">11.4.2、拼接<a class="headerlink" href="#1142" title="Permanent link">&para;</a></h4>
<h5 id="concat">CONCAT()<a class="headerlink" href="#concat" title="Permanent link">&para;</a></h5>
<p>返回连接参数产生的字符串，一个或多个待拼接的内容，任意一个为 <code>NULL</code> 则返回值为 <code>NULL</code>。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="nf">CONCAT</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span><span class="w"> </span><span class="n">str2</span><span class="p">,</span><span class="w"> </span><span class="n">…</span><span class="p">)</span>
</code></pre></div>
<h5 id="concat_ws">CONCAT_WS()<a class="headerlink" href="#concat_ws" title="Permanent link">&para;</a></h5>
<p><code>CONCAT_WS()</code> 代表 CONCAT With Separator ，是 <code>CONCAT()</code> 的特殊形式。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="nf">CONCAT_WS</span><span class="p">(</span><span class="k">separator</span><span class="p">,</span><span class="w"> </span><span class="n">str1</span><span class="p">,</span><span class="w"> </span><span class="n">str2</span><span class="p">,</span><span class="w"> </span><span class="n">…</span><span class="p">)</span>
</code></pre></div>
<p>参数：</p>
<ul>
<li><em>separator</em>：其它参数的分隔符。分隔符的位置放在要连接的两个字符串之间。分隔符可以是一个字符串，也可以是其它参数。如果分隔符为 <code>NULL</code>，则结果为 <code>NULL</code>。</li>
</ul>
<p>函数会忽略任何分隔符参数后的 <code>NULL</code> 值。</p>
<h5 id="group_concat">GROUP_CONCAT()<a class="headerlink" href="#group_concat" title="Permanent link">&para;</a></h5>
<p>MySQL <code>GROUP_CONCAT()</code> 函数将组中的字符串连接成为具有各种选项的单个字符串。</p>
<p>下面说明了<code>GROUP_CONCAT()</code>函数的语法：</p>
<div class="highlight"><pre><span></span><code><span class="nf">GROUP_CONCAT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">expression</span>
<span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">expression</span>
<span class="w">        </span><span class="k">SEPARATOR</span><span class="w"> </span><span class="n">sep</span><span class="p">);</span>
</code></pre></div>
<p><code>DISTINCT</code> 子句用于在连接分组之前消除组中的重复值。</p>
<p><code>ORDER BY</code> 子句允许在连接之前按升序或降序排序值。 默认情况下按升序排序值，如果要按降序对值进行排序，则需要明确指定 <code>DESC</code> 选项。</p>
<p><code>SEPARATOR</code> 指定在组中的值之间插入的文字值。如果不指定分隔符，则 <code>GROUP_CONCAT()</code> 函数使用逗号 <code>,</code> 作为默认分隔符。</p>
<p><code>GROUP_CONCAT()</code> 函数忽略 <code>NULL</code> 值，如果找不到匹配的行，或者所有参数都为 <code>NULL</code> 值，则返回 <code>NULL</code>。</p>
<p><code>GROUP_CONCAT()</code> 函数返回二进制或非二进制字符串，这取决于参数。 默认情况下，返回字符串的最大长度为 1024。如果您需要更多的长度，可以通过在 SESSION 或 GLOBAL 级别设置 <code>group_concat_max_len</code> 系统变量来扩展最大长度。</p>
<p>以下是演示 <code>GROUP_CONCAT()</code> 函数如何工作的一个示例：</p>
<div class="highlight"><pre><span></span><code><span class="k">USE</span><span class="w"> </span><span class="n">testdb</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">v</span><span class="w"> </span><span class="kt">CHAR</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">),(</span><span class="s1">&#39;B&#39;</span><span class="p">),(</span><span class="s1">&#39;C&#39;</span><span class="p">),(</span><span class="s1">&#39;B&#39;</span><span class="p">);</span>

<span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="nf">GROUP_CONCAT</span><span class="p">(</span>
<span class="w">                </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">v</span>
<span class="w">                </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">ASC</span>
<span class="w">                </span><span class="k">SEPARATOR</span><span class="w"> </span><span class="s1">&#39;;&#39;</span>
<span class="w">        </span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">        </span><span class="n">t</span><span class="p">;</span>
</code></pre></div>
<p>执行上面查询语句，得到以下结果：</p>
<div class="highlight"><pre><span></span><code><span class="o">+---------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="nf">GROUP_CONCAT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">ASC</span><span class="w"> </span><span class="k">SEPARATOR</span><span class="w"> </span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="w">               </span><span class="o">|</span>
<span class="o">+---------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">A</span><span class="p">;</span><span class="n">B</span><span class="p">;</span><span class="n">C</span><span class="w">                                                               </span><span class="o">|</span>
<span class="o">+---------------------------------------------------------------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span>
</code></pre></div>
<blockquote>
<p>注：上面语句类似于把 <code>SELECT v FROM t GROUP BY v;</code> 语句的结果串接起来。</p>
</blockquote>
<h4 id="1143">11.4.3、字符串转数字<a class="headerlink" href="#1143" title="Permanent link">&para;</a></h4>
<h5 id="cast">CAST()<a class="headerlink" href="#cast" title="Permanent link">&para;</a></h5>
<p><code>CAST()</code> 函数将任何类型的值转换为具有指定类型的值。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="nf">CAST</span><span class="p">(</span><span class="n">expression</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">type</span><span class="p">)</span>
</code></pre></div>
<p>参数：</p>
<ul>
<li><em>expression</em>：要转换的字符串</li>
<li><em>type</em>：目标类型，可以是以下类型之一：<code>BINARY</code>、<code>CHAR</code>、<code>DATE</code>、<code>DATETIME</code>、<code>TIME</code>、<code>DECIMAL</code>、<code>SIGNED</code>、<code>UNSIGNED</code>。</li>
</ul>
<h5 id="convert">CONVERT()<a class="headerlink" href="#convert" title="Permanent link">&para;</a></h5>
<p><code>CONVERT()</code> 函数将值转换为指定的数据类型或字符集。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="k">CONVERT</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="k">type</span><span class="p">);</span>
<span class="k">CONVERT</span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="k">charset</span><span class="p">);</span>
</code></pre></div>
<p>参数：</p>
<ul>
<li><em>value</em>：要转换的值</li>
<li><em>type</em>：目标类型，可以是以下类型之一：<code>BINARY</code>、<code>CHAR</code>、<code>DATE</code>、<code>DATETIME</code>、<code>TIME</code>、<code>SIGNED</code>、<code>UNSIGNED</code>。</li>
<li><em>charset</em>：要转换为的字符集</li>
</ul>
<h4 id="1144">11.4.4、填充<a class="headerlink" href="#1144" title="Permanent link">&para;</a></h4>
<p>填充某个字段的查询结果，<code>lpad()</code> 在左侧填充，<code>rpad()</code> 填充在右侧。</p>
<p>语法：</p>
<div class="highlight"><pre><span></span><code><span class="nf">lpad</span><span class="p">(</span><span class="n">srouce_string</span><span class="p">,</span><span class="w"> </span><span class="n">padded_length</span><span class="p">,</span><span class="w"> </span><span class="err">[</span><span class="n">pad_string</span><span class="err">]</span><span class="p">)</span>
<span class="nf">rpad</span><span class="p">(</span><span class="n">srouce_string</span><span class="p">,</span><span class="w"> </span><span class="n">padded_length</span><span class="p">,</span><span class="w"> </span><span class="err">[</span><span class="n">pad_string</span><span class="err">]</span><span class="p">)</span>
</code></pre></div>
<p>参数： </p>
<ul>
<li><em>srouce_string</em>：源字符串。</li>
<li><em>padding_length</em>：最后字符串的长度，如果 <em>padding_length</em> 小于原始字符串长度，会被截断。</li>
<li><em>pad_string</em>：填充的内容。</li>
</ul>
<blockquote>
<p>[!TIP]</p>
<p>截断行为是对原始字符串进行的，始终是从右边截断，即右边多余的字符串都将丢弃。</p>
</blockquote>
<p><strong>示例</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="nf">lpad</span><span class="p">(</span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">dual</span>
<span class="c1">-- 结果为 12</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="nf">lpad</span><span class="p">(</span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">dual</span>
<span class="c1">-- 结果为 0123456</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="nf">rpad</span><span class="p">(</span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">dual</span>
<span class="c1">-- 结果为 12</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="nf">rpad</span><span class="p">(</span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">dual</span>
<span class="c1">-- 结果为 1234560</span>
</code></pre></div>
<h3 id="115">11.5、数字相关<a class="headerlink" href="#115" title="Permanent link">&para;</a></h3>
<h4 id="1151">11.5.1、保留两位小数<a class="headerlink" href="#1151" title="Permanent link">&para;</a></h4>
<p><code>ROUND(x,d)</code>，四舍五入。<code>ROUND(x)</code> ，其实就是 <code>ROUND(x,0)</code>，也就是默认 <em>d</em> 为0。</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="mi">110</span><span class="p">.</span><span class="mi">35</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="o">##</span><span class="w"> </span><span class="mi">110</span><span class="p">.</span><span class="mi">4</span>
</code></pre></div>
<p><code>TRUNCATE(x,d)</code>，直接截取需要保留的小数位 。</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">TRUNCATE</span><span class="p">(</span><span class="mi">110</span><span class="p">.</span><span class="mi">35</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="o">##</span><span class="w"> </span><span class="mi">110</span><span class="p">.</span><span class="mi">3</span>
</code></pre></div>
<p><code>FORMAT(x,d)</code>，四舍五入，保留 <em>d</em> 位小数，返回 string 类型 </p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">110</span><span class="p">.</span><span class="mi">35</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="o">##</span><span class="w"> </span><span class="mi">110</span><span class="p">.</span><span class="mi">4</span>
</code></pre></div>
<h2 id="12">12、事务<a class="headerlink" href="#12" title="Permanent link">&para;</a></h2>
<p>MySQL事务主要用于处理操作量大，复杂度高的数据。比如说，在人员管理系统中，你删除一个人员，需要删除人员的基本资料，也要删除该人员相关的信息，比如信息，文章等等，这样，这些数据库操作就构成一个事务！</p>
<ul>
<li>在MySQL中只有使用了InnoDb数据库引擎的数据库或表才支持事务</li>
<li>事务处理可以用来维护数据库的完整性，保证成批的SQL语句要么全部执行，要么全部不执行</li>
<li>事务用来管理INSERT，UPDATE，DELETE语句</li>
</ul>
<p>事务控制语句：</p>
<ul>
<li>BEGIN或START TRANSACTION显示地开启一个事务</li>
<li>COMMIT也可以使用COMMIT WORD，不过二者是等价的。COMMIT会提交事务，并使已对数据库进行的所有修改成为永久性的</li>
<li>ROLLBACK也可以使用ROLLBACK WORK，不过二者是等价的。回滚会结束用户的事务，并撤销正在进行的所有未提交的修改</li>
<li>SAVEPOINT identifier，SAVEPOINT允许在事务中创建一个保存点，一个事务中可以有多个SAVEPOINT </li>
<li>RELEASE SAVEPOINT identifier 删除一个事务的保存点，当没有指定的保存点时，执行该语句会抛出一个异常</li>
<li>ROLLBACK TO identifier把事务回滚到标记点</li>
<li>SET TRANSACTION用来设置事务的隔离级别。InnoDB存储引擎提供事务的隔离级别有read uncommitted、read committed、repeatalbe read和serializable</li>
</ul>
<p>MYSQL事务处理主要有两种方法：</p>
<ol>
<li>用BEGIN，ROLLBACK，COMMIT来实现</li>
<li>BEGIN开始一个事务</li>
<li>ROLLBACK事务回滚</li>
<li>COMMIT事务确认</li>
<li>直接用SET来改变MySQL的自动提交模式</li>
<li>SET AUTOCOMMIT=0禁止自动提交</li>
<li>SET AUTOCOMMIT=1开始自动提交</li>
</ol>
<p>实例：</p>
<p><img src="!assets/MySQL/image-20200531205816289.png" alt="image-20200531205816289" style="zoom:80%;" /></p>
<h3 id="121acid">12.1、事务的四大特性（ACID）<a class="headerlink" href="#121acid" title="Permanent link">&para;</a></h3>
<p>一般来说，事务必须满足4个条件：原子性（或称不可分割性）、一致性、隔离性（又称独立性）、持久性</p>
<ul>
<li><strong>原子性（Atomicity）</strong>：一个事物中所有的操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚到事务开始前的状态，就像这个事务从来没有执行过一样</li>
<li><strong>一致性（Consistency）</strong>：在事务开始之前和事务结束之后，数据库的完整性没有被破坏。这表示写入的资料必须符合所有的预设规则，这包含资料的的精确度、串联性以及后续数据库可以自发性地完成预定的工作</li>
<li><strong>隔离性（Isolation）</strong>：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交、读已提交、可重复读和串行化</li>
<li><strong>持久性（Durability）</strong>：事务处理结束后，对数据的修改就是永久的，即使系统故障也不会丢失</li>
</ul>
<h3 id="122">12.2、事务的隔离级别<a class="headerlink" href="#122" title="Permanent link">&para;</a></h3>
<p>多个线程开启各自事务操作数据库中数据时，数据库系统要负责隔离操作，以保证各个线程在获取数据时的准确性。</p>
<p>如果不考虑隔离性，可能会引发如下问题：</p>
<ul>
<li>脏读：一个事务读取了另一个未提交的并行事务写的数据。 </li>
<li>不可重复读：一个事务重新读取前面读取过的数据， 发现该数据已经被另一个已提交的事务修改过。</li>
<li>虚读（幻读）：一个事务重新执行一个查询，返回一套符合查询条件的行， 发现这些行因为其他最近提交的事务而发生了改变。</li>
</ul>
<p><strong>脏读</strong></p>
<p>指一个事务读取了另外一个事务未提交的数据。</p>
<p>这是非常危险的，假设Ａ向Ｂ转帐１００元，对应sql语句如下所示</p>
<div class="highlight"><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="k">account</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">money</span><span class="o">=</span><span class="n">money</span><span class="o">+</span><span class="mi">100</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="k">name</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">;</span><span class="w"> </span>
<span class="k">update</span><span class="w"> </span><span class="k">account</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">money</span><span class="o">=</span><span class="n">money</span><span class="o">-</span><span class="mi">100</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="k">name</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">;</span>
</code></pre></div>
<p>当第1条sql执行完，第2条还没执行(A未提交时)，如果此时Ｂ查询自己的帐户，就会发现自己多了100元钱。如果A等B走后再回滚，B就会损失100元。</p>
<p><strong>不可重复读</strong></p>
<p>在一个事务内读取表中的某一行数据，多次读取结果不同。</p>
<p>例如银行想查询A帐户余额，第一次查询A帐户为200元，此时A向帐户存了100元并提交了，银行接着又进行了一次查询，此时A帐户为300元了。银行两次查询不一致，可能就会很困惑，不知道哪次查询是准的。</p>
<p>和脏读的区别是，脏读是读取前一事务未提交的脏数据，不可重复读是重新读取了前一事务已提交的数据。</p>
<p>很多人认为这种情况就对了，无须困惑，当然是后面的为准。我们可以考虑这样一种情况，比如银行程序需要将查询结果分别输出到电脑屏幕和写到文件中，结果在一个事务中针对输出的目的地，进行的两次查询不一致，导致文件和屏幕中的结果不一致，银行工作人员就不知道以哪个为准了。</p>
<p><strong>虚读(幻读)</strong></p>
<p>是指在一个事务内读取到了别的事务插入的数据，导致前后读取不一致。
事务A开启并读取到只有一条记录，还未提交，此时事务B开启事务，添加一条记录并提交，事务A再次读取发现有两条记录了，仿佛产生幻觉，这就是幻读。</p>
<blockquote>
<p>这里注意：不可重复读针对的是修改操作，幻读针对的是新增记录的操作</p>
</blockquote>
<p><strong>事务隔离性的设置</strong></p>
<p>数据库共定义了四种隔离级别：</p>
<ul>
<li>serializable：可避免脏读、不可重复读、虚读情况的发生。（串行化）</li>
<li>repeatable read：可避免脏读、不可重复读情况的发生。（可重复读）不可以避免虚读</li>
<li>read committed：可避免脏读情况发生（读已提交）</li>
<li>read uncommitted：最低级别，以上情况均无法保证。(读未提交)</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">set</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="k">transaction</span><span class="w"> </span><span class="k">isolation</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="n">XXX</span><span class="w"> </span><span class="c1">#（XXX代表隔离级别）设置事务隔离级别</span>
<span class="k">select</span><span class="w"> </span><span class="nv">@@transaction_isolation</span><span class="p">;</span><span class="w">  </span><span class="c1">#查询当前事务隔离级别</span>
</code></pre></div>
<p><strong>演示脏读</strong></p>
<ol>
<li>
<p>同时开启两个窗口，A和B。A代表左窗口，B代表右窗口。</p>
</li>
<li>
<p>先登陆MySLQ服务器，分别查看当前窗口的隔离级别：发现两个窗口的隔离级别都是： REPEATABLE-READ</p>
</li>
<li>
<p>设置A窗口的隔离级别为：read uncommitted （有脏读发生的可能）</p>
<div class="highlight"><pre><span></span><code><span class="k">set</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="k">transaction</span><span class="w"> </span><span class="k">isolation</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="k">uncommitted</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在A和B窗口中都开启事物。</p>
<div class="highlight"><pre><span></span><code><span class="k">start</span><span class="w"> </span><span class="k">transaction</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在B窗口中完成转账的操作，但是没有提交事物。</p>
<div class="highlight"><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;张三&#39;</span><span class="p">;</span>
<span class="k">update</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;赵四&#39;</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在A窗口中查询账户的余额。</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">user</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在B窗口中回滚数据</p>
<div class="highlight"><pre><span></span><code><span class="k">rollback</span><span class="p">;</span>
</code></pre></div>
</li>
</ol>
<p><strong>演示不可重复读（避免脏读）</strong></p>
<ol>
<li>
<p>设置A窗口的隔离级别为：read committed （避免脏读，不可重复读会发生）</p>
<div class="highlight"><pre><span></span><code><span class="k">set</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="k">transaction</span><span class="w"> </span><span class="k">isolation</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="k">committed</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在A和B窗口中都开启事物。</p>
<div class="highlight"><pre><span></span><code><span class="k">start</span><span class="w"> </span><span class="k">transaction</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在B窗口中完成转账的操作，但是没有提交事物。</p>
<div class="highlight"><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;张三&#39;</span><span class="p">;</span>
<span class="k">update</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;赵四&#39;</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在A窗口中查询账户的余额，查询的结果没有变化，说明已经避免了脏读。</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">user</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在B窗口中提交数据数据</p>
<div class="highlight"><pre><span></span><code><span class="k">commit</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>B窗口的数据已经提交了，在A窗口中查询数据，发现两次查询的结果发生了变化，这就导致了不可重复读的发生。</p>
</li>
</ol>
<p><strong>避免不可重复读</strong></p>
<ol>
<li>
<p>设置A窗口的隔离级别为： repeatable read   （避免脏读和不可重复读，但是虚读有可能发生）</p>
<div class="highlight"><pre><span></span><code><span class="k">set</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="k">transaction</span><span class="w"> </span><span class="k">isolation</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="k">repeatable</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在A和B窗口中都开启事物。</p>
<div class="highlight"><pre><span></span><code><span class="k">start</span><span class="w"> </span><span class="k">transaction</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在B窗口中完成转账的操作，但是没有提交事物。</p>
<div class="highlight"><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;张三&#39;</span><span class="p">;</span>
<span class="k">update</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">money</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;赵四&#39;</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在A窗口中查询账户的余额，查询的结果没有变化，说明已经避免了脏读。</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">user</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在B窗口中提交数据数据</p>
<div class="highlight"><pre><span></span><code><span class="k">commit</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>B窗口的数据已经提交了，在A窗口中查询数据，发现两次查询的结果一致，说明已经避免了不可重复读的发生。</p>
</li>
</ol>
<p><strong>避免虚读</strong></p>
<ol>
<li>
<p>设置A窗口的隔离级别serializable </p>
<div class="highlight"><pre><span></span><code><span class="k">set</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="k">transaction</span><span class="w"> </span><span class="k">isolation</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="k">serializable</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在A和B窗口中都开启事物。</p>
<div class="highlight"><pre><span></span><code><span class="k">start</span><span class="w"> </span><span class="k">transaction</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>在B窗口中插入一条数据（没有提交）</p>
<div class="highlight"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="no">null</span><span class="p">,</span><span class="s1">&#39;小凤&#39;</span><span class="p">,</span><span class="mi">10000</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>在A窗口查询数据，如果B窗口没有提交或者回滚，在A窗口是 不能查询到结果的。</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">user</span><span class="p">;</span>
</code></pre></div>
</li>
</ol>
<h2 id="13">13、索引<a class="headerlink" href="#13" title="Permanent link">&para;</a></h2>
<p>为什么要使用索引？</p>
<p>索引是 MySQL 中一种十分重要的数据库对象。它是数据库性能调优技术的基础，常用于实现数据的快速检索。</p>
<p>索引就是根据表中的一列或若干列按照一定顺序建立的列值与记录行之间的对应关系表，实质上是一张描述索引列的列值与原表中记录行之间一一对应关系的有序表。</p>
<p>在 MySQL 中，通常有以下两种方式访问数据库表的行数据：</p>
<ul>
<li>
<p>顺序访问
  顺序访问是在表中实行全表扫描，从头到尾逐行遍历，直到在无序的行数据中找到符合条件的目标数据。这种方式实现比较简单，但是当表中有大量数据的时候，效率非常低下。例如，在几千万条数据中查找少量的数据时，使用顺序访问方式将会遍历所有的数据，花费大量的时间，显然会影响数据库的处理性能。</p>
</li>
<li>
<p>索引访问</p>
</li>
</ul>
<p>索引访问是通过遍历索引来直接访问表中记录行的方式。使用这种方式的前提是对表建立一个索引，在列上创建了索引之后，查找数据时可以直接根据该列上的索引找到对应记录行的位置，从而快捷地查找到数据。索引存储了指定列数据值的指针，根据指定的排序顺序对这些指针排序。</p>
<p>例如，在学生基本信息表 students 中，如果基于 student_id 建立了索引，系统就建立了一张索引列到实际记录的映射表，当用户需要查找 student_id 为 12022 的数据的时候，系统先在 student_id 索引上找到该记录，然后通过映射表直接找到数据行，并且返回该行数据。因为扫描索引的速度一般远远大于扫描实际数据行的速度，所以采用索引的方式可以大大提高数据库的工作效率。</p>
<p><strong>创建索引</strong></p>
<p>可以使用专门用于创建索引的 CREATE INDEX 语句在一个已有的表上创建索引，但该语句不能创建主键。</p>
<p>语法格式：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">索引名</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">列名</span><span class="o">&gt;</span><span class="w"> </span><span class="err">[</span><span class="o">&lt;</span><span class="n">长度</span><span class="o">&gt;</span><span class="err">]</span><span class="w"> </span><span class="err">[</span><span class="w"> </span><span class="k">ASC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">DESC</span><span class="err">]</span><span class="p">)</span>
</code></pre></div>
<p>语法说明如下：</p>
<ul>
<li>&lt;索引名&gt;：指定索引名。一个表可以创建多个索引，但每个索引在该表中的名称是唯一的。</li>
<li>&lt;表名&gt;：指定要创建索引的表名。</li>
<li>&lt;列名&gt;：指定要创建索引的列名。通常可以考虑将查询语句中在 JOIN 子句和 WHERE 子句里经常出现的列作为索引列。</li>
<li>&lt;长度&gt;：可选项。指定使用列前的 length 个字符来创建索引。使用列的一部分创建索引有利于减小索引文件的大小，节省索引列所占的空间。在某些情况下，只能对列的前缀进行索引。索引列的长度有一个最大上限 255 个字节（MyISAM 和 InnoDB 表的最大上限为 1000 个字节），如果索引列的长度超过了这个上限，就只能用列的前缀进行索引。另外，BLOB 或 TEXT 类型的列也必须使用前缀索引。</li>
<li>ASC|DESC：可选项。ASC指定索引按照升序来排列，DESC指定索引按照降序来排列，默认为ASC。</li>
</ul>
<p><strong>删除索引</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">TABLE_name</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">index_name</span><span class="p">;</span>
</code></pre></div>
<p><strong>显示索引信息</strong></p>
<p>可以使用show index命令来列出表中的相关的索引信息，可以添加\G来格式化输出信息</p>
<div class="highlight"><pre><span></span><code><span class="k">SHOW</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">表名</span><span class="o">&gt;</span><span class="w"> </span><span class="err">[</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">数据库名</span><span class="o">&gt;</span><span class="err">]</span><span class="p">;</span><span class="err">\</span><span class="n">G</span>
</code></pre></div>
<p>语法说明如下：</p>
<ul>
<li>&lt;表名&gt;：要显示索引的表。</li>
<li>&lt;数据库名&gt;：要显示的表所在的数据库。</li>
</ul>
<p>该语句会返回一张结果表，该表有如下几个字段，每个字段所显示的内容说明如下:</p>
<ul>
<li>Table：表的名称。</li>
<li>Non_UNIQUE：用于显示该索引是否是唯一索引。若不是唯一索引，则该列的值显示为 1；若是唯一索引，则该列的值显示为 0。</li>
<li>Key_name：索引的名称。</li>
<li>Seq_in_index：索引中的列序列号，从 1 开始计数。</li>
<li>Column_name：列名称。</li>
<li>Collation：显示列以何种顺序存储在索引中。在 MySQL 中，升序显示值“A”（升序），若显示为 NULL，则表示无分类。</li>
<li>Cardinality：显示索引中唯一值数目的估计值。基数根据被存储为整数的统计数据计数，所以即使对于小型表，该值也没有必要是精确的。基数越大，当进行联合时，MySQL 使用该索引的机会就越大。</li>
<li>Sub_part：若列只是被部分编入索引，则为被编入索引的字符的数目。若整列被编入索引，则为 NULL。</li>
<li>Packed：指示关键字如何被压缩。若没有被压缩，则为 NULL。</li>
<li>Null：用于显示索引列中是否包含 NULL。若列含有 NULL，则显示为 YES。若没有，则该列显示为 NO。</li>
<li>Index_type：显示索引使用的类型和方法（BTREE、FULLTEXT、HASH、RTREE）。</li>
<li>Comment：显示评注。</li>
</ul>
<h2 id="14">14、临时表<a class="headerlink" href="#14" title="Permanent link">&para;</a></h2>
<p>MySQL临时表在需要保存一些临时数据时是非常有用的。临时表只在当前连接可见，当关闭连接时，MySQL会自动删除表并释放所有空间。</p>
<p>实例：</p>
<p><img src="!assets/MySQL/image-20200531210628430.png" alt="image-20200531210628430" style="zoom:80%;" /></p>
<p>当使用SHOW TABLES命令显示数据表列表时，将无法看到SalesSummary表。</p>
<p>如果退出当前MySQL会话，再使用SELECT命令来读取原先创建的临时表数据，将会发现数据库中没有该表的存在，因为在退出时该临时表已经被销毁了</p>
<p><strong>删除MySQL临时表</strong></p>
<p>默认情况下，在断开与数据库的连接后，临时表就会自动销毁，当然也可以在当前MySQL会话使用DROP TABLE命令来手动删除临时表。</p>
<p><img src="!assets/MySQL/image-20200531210706162.png" alt="image-20200531210706162" style="zoom:80%;" /></p>
<h2 id="15">15、备份<a class="headerlink" href="#15" title="Permanent link">&para;</a></h2>
<h3 id="151">15.1、数据库备份<a class="headerlink" href="#151" title="Permanent link">&para;</a></h3>
<p>数据库的主要作用就是对数据进行保存和维护，所以备份数据是数据库管理中最常用的操作。为了防止数据库意外崩溃或硬件损伤而导致的数据丢失，数据库系统提供了备份和恢复策略。</p>
<p>保证数据安全的最重要的一个措施就是定期的对数据库进行备份。这样即使发生了意外，也会把损失降到最低。</p>
<p>数据库备份是指通过导出数据或者复制表文件的方式来制作数据库的副本。当数据库出现故障或遭到破坏时，将备份的数据库加载到系统，从而使数据库从错误状态恢复到备份时的正确状态。</p>
<p>MySQL 中提供了两种备份方式，即 <code>mysqldump</code> 命令以及 mysqlhotcopy 脚本。由于 mysqlhotcopy 只能用于 MyISAM 表，所以 MySQL 5.7 移除了 mysqlhotcopy 脚本。</p>
<h4 id="1511mysqldump">15.1.1、mysqldump<a class="headerlink" href="#1511mysqldump" title="Permanent link">&para;</a></h4>
<p><code>mysqldump</code> 命令可以将数据库中的数据备份成一个文本文件。表的结构和表中的数据将存储在生成的文本文件中。</p>
<p><strong>备份指定的数据库</strong></p>
<p><code>mysqldump</code> 基本语法：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="n">dbname</span><span class="w"> </span><span class="err">[</span><span class="n">tbname</span><span class="w"> </span><span class="p">...</span><span class="err">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">filename</span><span class="p">.</span><span class="k">sql</span>
</code></pre></div>
<p>对上述语法参数说明如下：</p>
<ul>
<li><em>username</em>：表示用户名称；</li>
<li><em>dbname</em>：表示需要备份的数据库名称；</li>
<li><em>tbname</em>：表示数据库中需要备份的数据表，可以指定多个数据表。省略该参数时，会备份整个数据库；</li>
<li>右箭头 <code>&gt;</code>：用来告诉 <code>mysqldump</code> 将备份数据表的定义和数据写入备份文件；</li>
<li><em>filename.sql</em>：表示备份文件的名称，文件名前面可以加绝对路径。通常将数据库备份成一个后缀名为 <code>.sql</code> 的文件。</li>
</ul>
<blockquote>
<p>注意：<code>mysqldump</code> 命令备份的文件并非一定要求后缀名为 <code>.sql</code>，备份成其他格式的文件也是可以的。例如，后缀名为 <code>.txt</code> 的文件。通常情况下，建议备份成后缀名为 <code>.sql</code> 的文件。因为，后缀名为 <code>.sql</code> 的文件给人第一感觉就是与数据库有关的文件。</p>
</blockquote>
<p>下面使用 root 用户备份 test 数据库下的 student 表。打开命令行（cmd）窗口，输入备份命令和密码，运行过程如下：</p>
<div class="highlight"><pre><span></span><code>C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;mysqldump<span class="w"> </span>-uroot<span class="w"> </span>-p<span class="w"> </span><span class="nb">test</span><span class="w"> </span>student&gt;C:<span class="se">\s</span>tudent.sql
Enter<span class="w"> </span>password:<span class="w"> </span>****
</code></pre></div>
<blockquote>
<p>注意：<code>mysqldump</code> 命令必须在 cmd 窗口下执行，不能登录到 MySQL 服务中执行。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1">-- MySQL dump 10.13  Distrib 5.7.29, for Win64 (x86_64)</span>
<span class="c1">--</span>
<span class="c1">-- Host: localhost    Database: test</span>
<span class="c1">-- ------------------------------------------------------</span>
<span class="c1">-- Server version 5.7.29-log</span>

<span class="cm">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span class="p">;</span>
<span class="cm">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span><span class="p">;</span>
<span class="o">--</span><span class="n">此处删除了部分内容</span>
<span class="c1">--</span>
<span class="c1">-- Table structure for table `student`</span>
<span class="c1">--</span>

<span class="c1">DROP TABLE IF EXISTS `student`;</span>
<span class="cm">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = utf8 */</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n n-Quoted">`student`</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n n-Quoted">`name`</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n n-Quoted">`stuno`</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n n-Quoted">`age`</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">ENGINE</span><span class="o">=</span><span class="n">MyISAM</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CHARSET</span><span class="o">=</span><span class="n">latin1</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Dumping data for table `student`</span>
<span class="c1">--</span>

<span class="c1">LOCK TABLES `student` WRITE;</span>
<span class="cm">/*!40000 ALTER TABLE `student` DISABLE KEYS */</span><span class="p">;</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n n-Quoted">`student`</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;zhangsan&#39;</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">18</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;lisi&#39;</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">19</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;wangwu&#39;</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">18</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;zhaoliu&#39;</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">18</span><span class="p">);</span>
<span class="cm">/*!40000 ALTER TABLE `student` ENABLE KEYS */</span><span class="p">;</span>
<span class="k">UNLOCK</span><span class="w"> </span><span class="k">TABLES</span><span class="p">;</span>
<span class="cm">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span><span class="p">;</span>
<span class="p">......</span>
<span class="c1">-- Dump completed on 2019-03-09 13:03:15</span>
</code></pre></div>
<p>student.sql 文件开头记录了 MySQL 的版本、备份的主机名和数据库名。</p>
<p>文件中，以 <code>--</code> 开头的都是 SQL 语言的注释。以 <code>/*!40101</code> 等形式开头的是与 MySQL 有关的注释。<code>40101</code> 是 MySQL 数据库的版本号，这里就表示 MySQL 4.1.1。如果恢复数据时，MySQL 的版本比 4.1.1 高，<code>/*!40101</code> 和 <code>*/</code> 之间的内容被当作 SQL 命令来执行。如果比 4.1.1 低，<code>/*!40101</code> 和 <code>*/</code> 之间的内容被当作注释。<code>/*!</code> 和 <code>*/</code> 中的内容在其它数据库中将被作为注释忽略，这可以提高数据库的可移植性。</p>
<blockquote>
<p>注意：上面 student.sql 文件中没有创建数据库的语句，因此，student.sql 文件中的所有表和记录必须恢复到一个已经存在的数据库中。恢复数据时，<code>CREATE TABLE</code> 语句会在数据库中创建表，然后执行 <code>INSERT</code> 语句向表中插入记录。</p>
</blockquote>
<p><strong>备份多个数据库</strong></p>
<p>如果要使用 <code>mysqldump</code> 命令备份多个数据库，需要使用 <code>--databases</code> 参数。备份多个数据库的语法格式如下：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">-</span><span class="n">P</span><span class="w"> </span><span class="o">--</span><span class="k">databases</span><span class="w"> </span><span class="n">dbname1</span><span class="w"> </span><span class="n">dbname2</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">filename</span><span class="p">.</span><span class="k">sql</span>
</code></pre></div>
<p>加上 <code>--databases</code> 参数后，必须指定至少一个数据库名称，多个数据库名称之间用空格隔开。</p>
<p><strong>备份所有数据库</strong></p>
<p><code>mysqldump</code> 命令备份所有数据库的语法格式如下：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">-</span><span class="n">P</span><span class="w"> </span><span class="o">--</span><span class="k">all</span><span class="o">-</span><span class="k">databases</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">filename</span><span class="p">.</span><span class="k">sql</span>
</code></pre></div>
<p>使用 <code>--all-databases</code> 参数时，不需要指定数据库名称。</p>
<h3 id="152">15.2、自动备份<a class="headerlink" href="#152" title="Permanent link">&para;</a></h3>
<h3 id="153">15.3、数据恢复<a class="headerlink" href="#153" title="Permanent link">&para;</a></h3>
<h4 id="1531ibd">15.3.1、.ibd 文件恢复<a class="headerlink" href="#1531ibd" title="Permanent link">&para;</a></h4>
<p>不小心删除了 MySQL 数据目录，但还剩个 <code>.ibd</code> 文件在，没得备份，没得 binlog，要恢复这个 ibd 文件里面的数据。</p>
<p>MySQL 8.0 的 ibd 文件也包含元数据信息，所以可以先恢复表结构，再恢复数据。</p>
<p><strong>恢复表结构</strong></p>
<p>如果开发有相关的 DDL 更好，没得的话就需要自己解析。</p>
<p>MySQL 8.0 的 ibd 文件存在 sdi page 记录元数据信息的，压缩的 JSON 格式。我们可以使用官方自带的 ibd2sdi 解析出来这个 json 信息：</p>
<div class="highlight"><pre><span></span><code>ibd2sdi<span class="w"> </span>/data/mysql_3314/mysqldata/ibd2sql/ddcw_alltype_table.ibd
</code></pre></div>
<p><img src="!assets/MySQL/6fa8ab849cd67b4f748116b8ce5ac36c.png" alt="img" style="" /></p>
<p>但还要自己去拼接 DDL，太麻烦了，可以使用其他工具来提取 DDL，比如 <a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fgithub.com%2Fddcw%2Fibd2sql&amp;source=article&amp;objectId=2407144">ibd2sql</a>：</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>main.py<span class="w"> </span>/tmp/ddcw_alltype_table.ibd<span class="w"> </span>--ddl
</code></pre></div>
<p><img src="!assets/MySQL/23677b4c2fc40b54f4e139d3ccc77cc8.png" alt="img" style="" /></p>
<p>现在 DDL 已经提取出来了，先创建个测试环境，创建相同的库，再使用上面的 DDL 去恢复相关的表结构。</p>
<p><strong>恢复数据</strong></p>
<p>MySQL 可以使用 <code>discard table</code> 来删除表空间，然后使用 <code>import tablespace</code> 来导入表空间。</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- 移除表空间</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">ddcw_alltype_table</span><span class="w"> </span><span class="k">discard</span><span class="w"> </span><span class="k">tablespace</span><span class="p">;</span>

<span class="c1">-- 拷贝要恢复的表空间</span>
<span class="k">system</span><span class="w"> </span><span class="n">cp</span><span class="w"> </span><span class="o">-</span><span class="n">ra</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ddcw_alltype_table</span><span class="p">.</span><span class="n">ibd</span><span class="w"> </span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">mysql_3314</span><span class="o">/</span><span class="n">mysqldata</span><span class="o">/</span><span class="n">ibd2sql</span>

<span class="c1">-- 导入要恢复的表空间</span>
<span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">ddcw_alltype_table</span><span class="w"> </span><span class="k">import</span><span class="w"> </span><span class="k">tablespace</span><span class="p">;</span>

<span class="c1">-- 验证数据</span>
<span class="k">select</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">ddcw_alltype_table</span><span class="p">;</span>
</code></pre></div>
<p>这种方法非常简单方便，推荐使用。</p>
<p>如果无法导入表空间的话,  还可以解析这个 ibd 文件得到相关的数据，这里还是使用 <a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fgithub.com%2Fddcw%2Fibd2sql&amp;source=article&amp;objectId=2407144">ibd2sql</a>：</p>
<div class="highlight"><pre><span></span><code><span class="n">python3</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ddcw_alltype_table</span><span class="p">.</span><span class="n">ibd</span><span class="w"> </span><span class="o">--</span><span class="k">sql</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ddcw_alltype_table</span><span class="p">.</span><span class="k">sql</span>
</code></pre></div>
<p><img src="!assets/MySQL/c3a1b8d6e500c855572725723c067148.png" alt="img" style="" /></p>
<p>然后就可以把解析出来的sql导入数据库了，当然也可以解析的时候直接通过管道写入数据库：</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="w"> </span><span class="o">-</span><span class="n">h127</span><span class="mf">.0.0.1</span><span class="w"> </span><span class="o">-</span><span class="n">P3314</span><span class="w"> </span><span class="o">-</span><span class="n">p123456</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ddcw_alltype_table</span><span class="p">.</span><span class="k">sql</span>
</code></pre></div>
<p><img src="!assets/MySQL/52252cd6745895d4fe42664c897c767e.png" alt="img" style="" /></p>
<h2 id="17jdbc">17、JDBC<a class="headerlink" href="#17jdbc" title="Permanent link">&para;</a></h2>
<h3 id="171jdbc">17.1、JDBC 简介<a class="headerlink" href="#171jdbc" title="Permanent link">&para;</a></h3>
<p>JDBC 全称为：Java DataBase Connectivity（java数据库连接）。</p>
<p>SUN 公司为了简化、统一对数据库的操作，定义了一套 Java 操作数据库的规范，称之为 JDBC。</p>
<p><strong>实例</strong></p>
<p>从 user 表中读取数据，并打印在命令行窗口中。</p>
<ol>
<li>
<p>搭建实验环境 ：</p>
</li>
<li>
<p>在mysql中创建一个库，并创建user表和插入表的数据。</p>
</li>
<li>
<p>新建一个Java工程，并导入数据驱动。</p>
</li>
<li>
<p>编写程序，在程序中加载数据库驱动</p>
<div class="highlight"><pre><span></span><code><span class="n">DriverManager</span><span class="p">.</span><span class="na">registerDriver</span><span class="p">(</span><span class="n">Driver</span><span class="w"> </span><span class="n">driver</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>建立连接(Connection)</p>
<div class="highlight"><pre><span></span><code><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">pass</span><span class="p">);</span><span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>创建用于向数据库发送SQL的Statement对象，并发送</p>
<div class="highlight"><pre><span></span><code><span class="n">Statement</span><span class="w"> </span><span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>
<span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>从代表结果集的ResultSet中取出数据，打印到命令行窗口</p>
</li>
<li>
<p>断开与数据库的连接，并释放相关资源Jdbc程序</p>
</li>
</ol>
<p>运行完后，切记要释放程序在运行过程中，创建的那些与数据库进行交互的对象，这些对象通常是ResultSet, Statement和Connection对象。</p>
<p>特别是Connection对象，它是非常稀有的资源，用完后必须马上释放，如果Connection不能及时、正确的关闭，极易导致系统宕机。Connection的使用原则是尽量晚创建，尽量早的释放。</p>
<p>为确保资源释放代码能运行，资源释放代码也一定要放在finally语句中</p>
<h4 id="1811drivermanager">18.1.1、DriverManager<a class="headerlink" href="#1811drivermanager" title="Permanent link">&para;</a></h4>
<p>DriverManager类的是管理一组 JDBC 驱动程序的基本服务。作用有两个，如下：</p>
<ol>
<li>
<p>注册驱动</p>
<p>static void registerDriver(Driver driver)方法进行注册驱动
但是这种方式不是很好，原因如下：</p>
<p>让应用程序依赖具体的驱动包，如果是切换数据库还需要修改源代码才能完成。调用该方法导致驱动被注册两次，通过查看驱动的源代码能发现次问题。所以在实际开发中不会这么做。</p>
<p>具体做法如下：</p>
<div class="highlight"><pre><span></span><code><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;com.mysql.jdbc.Driver&quot;</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>获取链接对象</p>
</li>
</ol>
<p>数据库URL</p>
<p>URL用于标识数据库的位置，程序员通过URL地址告诉JDBC程序连接哪个数据库，URL的写法为：</p>
<p><img src="!assets/MySQL/image-20200603120231842.png" alt="image-20200603120231842" style="zoom:80%;" /></p>
<h4 id="1812connection">18.1.2、Connection<a class="headerlink" href="#1812connection" title="Permanent link">&para;</a></h4>
<p>Jdbc程序中的Connection，它用于代表数据库的链接，Collection是数据库编程中最重要的一个对象，客户端与数据库所有交互都是通过connection对象完成的，</p>
<p>有两个作用：</p>
<ol>
<li>创建执行SQL语句的对象：<ul>
<li>createStatement()：创建向数据库发送sql的statement对象</li>
<li>prepareStatement(sql) ：创建向数据库发送预编译sql的PreparedSatement对象</li>
<li>prepareCall(sql)：创建执行存储过程的CallableStatement对象。</li>
</ul>
</li>
<li>管理事物：<ul>
<li>setAutoCommit(boolean autoCommit)：设置事务是否自动提交。</li>
<li>commit() ：在链接上提交事务。 ---与事务相关！！</li>
<li>rollback() ：在此链接上回滚事务。</li>
</ul>
</li>
</ol>
<h4 id="1813statement">18.1.3、Statement<a class="headerlink" href="#1813statement" title="Permanent link">&para;</a></h4>
<p>Jdbc程序中的Statement对象用于向数据库发送SQL语句， Statement对象常用方法：</p>
<ol>
<li>执行SQL语句<ul>
<li>executeQuery(String sql) ：用于向数据发送查询语句。</li>
<li>executeUpdate(String sql)：用于向数据库发送insert、update或delete语句</li>
<li>execute(String sql)：用于向数据库发送任意sql语句</li>
</ul>
</li>
<li>执行批处理<ul>
<li>addBatch(String sql) ：把多条sql语句放到一个批处理中。</li>
<li>executeBatch()：向数据库发送一批sql语句执行。</li>
</ul>
</li>
</ol>
<p><strong>PreparedStatement</strong></p>
<p>PreparedStatement是Statement的子接口，它的实例对象可以通过调用Connection.preparedStatement(sql)方法获得，相对于Statement对象而言：</p>
<ul>
<li>PreperedStatement可以避免SQL注入的问题。</li>
<li>Statement会使数据库频繁编译SQL，可能造成数据库缓冲区溢出。PreparedStatement 可对SQL进行预编译，从而提高数据库的执行效率。</li>
<li>并且PreperedStatement对于sql中的参数，允许使用占位符的形式进行替换，简化sql语句的编写。</li>
</ul>
<h4 id="1814resultset">18.1.4、ResultSet<a class="headerlink" href="#1814resultset" title="Permanent link">&para;</a></h4>
<p>Jdbc程序中的ResultSet用于代表Sql语句的执行结果。Resultset封装执行结果时，采用的类似于表格的方式。ResultSet 对象维护了一个指向表格数据行的游标cursor，初始的时候，游标在第一行之前，调用ResultSet.next() 方法，可以使游标指向具体的数据行，进而调用方法获取该行的数据。</p>
<p>ResultSet既然用于封装执行结果的，所以该对象提供的大部分方法都是用于获取数据的get方法：</p>
<ol>
<li>获取任意类型的数据<ul>
<li>getObject(int index)</li>
<li>getObject(string columnName)</li>
</ul>
</li>
<li>获取指定类型的数据<ul>
<li>getString(int index)</li>
<li>getString(String columnName)</li>
</ul>
</li>
</ol>
<p><strong>ResultSet滚动结果集</strong></p>
<p>使用<code>createStatement(int resultSetType, int resultSetConcurrency);</code>可以设置滚动结果集的策略：</p>
<ul>
<li>resultSetType   ：代表滚动结果集的类型</li>
<li>resultSetConcurrency ：代表结果集的并发策略</li>
</ul>
<p>常用的结果集类型</p>
<ul>
<li>TYPE_FORWARD_ONLY   ：结果集只能向下</li>
<li>TYPE_SCROLL_INSENSITIVE  ：可以滚动，不能修改记录</li>
<li>TYPE_SCROLL_SENSITIVE  ：可以滚动，可以修改记录</li>
</ul>
<p>常用的并发策略</p>
<ul>
<li>CONCUR_READ_ONLY    ：只读的，不能修改</li>
<li>CONCUR_UPDATABLE   ：结果集可以修改</li>
</ul>
<p>ResultSet 滚动结果集方法</p>
<ul>
<li>next()：移动到下一行</li>
<li>previous()：移动到前一行</li>
<li>absolute(int row)：移动到指定行</li>
<li>beforeFirst()：移动resultSet的最前面</li>
<li>afterLast() ：移动到resultSet的最后面</li>
<li>updateRow() ：更新行数据</li>
</ul>
<h3 id="172jdbc-crud">17.2、JDBC 进行 CRUD<a class="headerlink" href="#172jdbc-crud" title="Permanent link">&para;</a></h3>
<p>Jdbc中的statement对象用于向数据库发送SQL语句，想完成对数据库的增删改查，只需要通过这个对象向数据库发送增删改查语句即可。</p>
<p>Statement对象的executeUpdate方法，用于向数据库发送增、删、改的sql语句，executeUpdate执行完后，将会返回一个整数(即增删改语句导致了数据库几行数据发生了变化)。</p>
<p>Statement.executeQuery方法用于向数据库发送查询语句，executeQuery方法返回代表查询结果的ResultSet对象。</p>
<p><strong>CRUD操作-create</strong></p>
<p>使用executeUpdate(String sql)方法完成数据添加操作，示例操作：</p>
<div class="highlight"><pre><span></span><code><span class="n">Statement</span><span class="w"> </span><span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>
<span class="n">String</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;insert into user(...) values(...)&quot;</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">num</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;插入成功！&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>CRUD操作-updata</strong></p>
<p>使用executeUpdate(String sql)方法完成数据修改操作，示例操作：</p>
<div class="highlight"><pre><span></span><code><span class="n">Statement</span><span class="w"> </span><span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>
<span class="n">String</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;update user set name=&#39;&#39; where name=&#39;&#39;&quot;</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">num</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;修改成功！&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>CRUD操作-delete</strong></p>
<p>使用executeUpdate(String sql)方法完成数据删除操作，示例操作：</p>
<div class="highlight"><pre><span></span><code><span class="n">Statement</span><span class="w"> </span><span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>
<span class="n">String</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;delete from user where id=1&quot;</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">num</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;删除成功！&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>CRUD操作-Retrieve/Read</strong></p>
<p>使用executeQuery(String sql)方法完成数据查询操作，示例操作：</p>
<div class="highlight"><pre><span></span><code><span class="n">Statement</span><span class="w"> </span><span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>
<span class="n">String</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;select * from user where id=1&quot;</span><span class="p">;</span>
<span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 根据获取列的数据类型，分别调用ts的响应方法</span>
<span class="w">        </span><span class="c1">// 映射到java对象中</span>
<span class="p">}</span>
</code></pre></div>
<p>使用JDBC完成数据的CURD操作具有很多重复性的代码，像驱动加载、获取链接、释放资源等，所以可以封装成工具类方便使用。</p>
<h3 id="173jdbc">17.3、JDBC 处理大数据<a class="headerlink" href="#173jdbc" title="Permanent link">&para;</a></h3>
<p>在实际开发中，程序需要把大文本 TEXT 或二进制数据 BLOB保存到数据库。TEXT是mysql叫法，Oracle中叫CLOB</p>
<p>基本概念：大数据也称之为LOB(Large Objects)，LOB又分为：CLOB和BLOB</p>
<ul>
<li>CLOB用于存储大文本。</li>
<li>BLOB用于存储二进制数据，例如图像、声音、二进制文等。</li>
</ul>
<p>对MySQL而言只有BLOB，而没有CLOB，MySQL存储大文本采用的是TEXT，Text和BLOB分别又分为：</p>
<ul>
<li>TINYTEXT(255)、TEXT(64k)、MEDIUMTEXT(16M)和LONGTEXT(4G)</li>
<li>TINYBLOB(255)、BLOB(64k)、MEDIUMBLOB(16M)和LONGBLOB(4G)</li>
</ul>
<p>对于MySQL中的Text类型，可调用如下方法设置：</p>
<div class="highlight"><pre><span></span><code><span class="n">PreparedStatement</span><span class="p">.</span><span class="na">setCharacterStream</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
<span class="c1">// 注意length长度需设置，并且设置为int型</span>
<span class="c1">// 当包过大时修改配置：[mysqld] max_allowed_packet-64M</span>
</code></pre></div>
<p>对MySQL中的Text类型，可调用如下方法获取：</p>
<div class="highlight"><pre><span></span><code><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resultSet</span><span class="p">.</span><span class="na">getCharacterStream</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="c1">// 等价于</span>
<span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resultSet</span><span class="p">.</span><span class="na">getClob</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="na">getCharacterStream</span><span class="p">();</span>
</code></pre></div>
<p>对于MySQL中的BLOB类型，可调用如下方法设置：</p>
<div class="highlight"><pre><span></span><code><span class="n">PreparedStatement</span><span class="p">.</span><span class="na">setBinaryStream</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">inputStream</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
</code></pre></div>
<p>对MySQL中的BLOB类型，可调用如下方法获取：</p>
<div class="highlight"><pre><span></span><code><span class="n">InputStream</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resultSet</span><span class="p">.</span><span class="na">getBinaryStream</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="n">InputStream</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resultSet</span><span class="p">.</span><span class="na">getBlob</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="na">getBinaryStream</span><span class="p">();</span>
</code></pre></div>
<p><strong>使用JDBC进行批处理</strong></p>
<p>业务场景：当需要向数据库发送一批SQL语句执行时，应避免向数据库一条条的发送执行，而应采用JDBC的批处理机制，以提升执行效率。</p>
<ul>
<li>Statement.addBatch(sql) ：添加批处理命令</li>
<li>executeBatch()方法：执行批处理命令</li>
<li>clearBatch()方法：清除批处理命令</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jdbcUtil</span><span class="p">.</span><span class="na">getConnection</span><span class="p">();</span>
<span class="n">String</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;insert into person(name,password,email,birthday) values(?,?,?,?,?)&quot;</span><span class="p">;</span>
<span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">50000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">st</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aaa&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="n">st</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;123&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="n">st</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aaa&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;@sina.com&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">st</span><span class="p">.</span><span class="na">setDate</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">));</span>

<span class="w">        </span><span class="n">st</span><span class="p">.</span><span class="na">addBatch</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">st</span><span class="p">.</span><span class="na">executeBatch</span><span class="p">();</span>
<span class="w">                </span><span class="n">st</span><span class="p">.</span><span class="na">clearBatch</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">st</span><span class="p">.</span><span class="na">executeBatch</span><span class="p">();</span>
</code></pre></div>
<h3 id="174jdbc">17.4、JDBC 事务控制管理<a class="headerlink" href="#174jdbc" title="Permanent link">&para;</a></h3>
<p>当Jdbc程序向数据库获得一个Connection对象时，默认情况下这个Connection对象会自动向数据库提交在它上面发送的SQL语句。若想关闭这种默认提交方式，让多条SQL在一个事务中执行，可使用下列语句：</p>
<div class="highlight"><pre><span></span><code><span class="n">Connection</span><span class="p">.</span><span class="na">setAutoCommit</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"> </span><span class="c1">//  相当于start transaction</span>
<span class="n">Connection</span><span class="p">.</span><span class="na">rollback</span><span class="p">();</span><span class="w">          </span><span class="c1">//  rollback</span>
<span class="n">Connection</span><span class="p">.</span><span class="na">commit</span><span class="p">();</span><span class="w">            </span><span class="c1">//  commit</span>
</code></pre></div>
<p><strong>JDBC中设置事务的隔离级别</strong></p>
<p>Connection接口中定义事务隔离级别四个常量：</p>
<ul>
<li>
<p>static int TRANSACTION_READ_COMMITTED 
  指示不可以发生脏读的常量；不可重复读和虚读可以发生。 </p>
</li>
<li>
<p>static int TRANSACTION_READ_UNCOMMITTED 
  指示可以发生脏读 (dirty read)、不可重复读和虚读 (phantom read) 的常量。 </p>
</li>
<li>
<p>static int TRANSACTION_REPEATABLE_READ 
  指示不可以发生脏读和不可重复读的常量；虚读可以发生。 </p>
</li>
<li>
<p>static int TRANSACTION_SERIALIZABLE </p>
</li>
</ul>
<p>指示不可以发生脏读、不可重复读和虚读的常量。</p>
<p>通过 void setTransactionIsolation(int level) 设置数据库隔离级别</p>
<h3 id="175jdbc">17.5、JDBC 连接报错<a class="headerlink" href="#175jdbc" title="Permanent link">&para;</a></h3>
<p>在使用 JDBC 连接 MySQL 8.0 时，可能会出现 “Public Key Retrieval is not allowed” 的错误：</p>
<div class="highlight"><pre><span></span><code>com.mysql.jdbc.exceptions.jdbc4.MySQLNonTransientConnectionException: Public Key Retrieval is not allowed
</code></pre></div>
<p>首先需要了解 MySQL 配置的密码认证插件为如下两种：</p>
<ul>
<li>sha256_password</li>
<li>caching_sha2_password</li>
</ul>
<p>值得注意的是，如果使用 “mysql_native_password” 密码认证插件，不会出现 “Public Key Retrieval is not allowed”。MySQL 配置的密码认证方式可以通过如下命令进行查看：</p>
<div class="highlight"><pre><span></span><code><span class="k">show</span><span class="w"> </span><span class="k">variables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%authentication%&#39;</span><span class="p">;</span>
</code></pre></div>
<p>接着来详细分析 “Public Key Retrieval is not allowed” 错误产生的原因：MySQL 8.0 默认推荐使用 “sha256_password” 和 “caching_sha2_password” 这两种认证插件。只有较老的 MySQL 版本仍然会使用 “mysql_native_password”。</p>
<p>根据 MySQL 提供的<a href="https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html">官方文档</a>，这两种插件都是使用 SHA256 算法来对密码进行保护。这些插件的具体执行流程如下：</p>
<ol>
<li>检查客户端是否禁用 SSL/TLS 加密传输；</li>
<li>如果客户端未禁用 SSL/TLS 加密传输，则客户端在进行认证时的认证报文（传输用户名和密码的报文）是使用 TLS 进行传输的，两种插件认为认证报文传输安全，不进行任何其他操作；</li>
<li>如果客户端禁用 SSL/TLS 加密传输，则客户端在进行认证时的认证报文（传输用户名和密码的报文）是使用明文进行传输的，两种插件认为认证报文传输不安全，会单独对明文报文中的密码使用 RSA 加密方式进行加密。</li>
</ol>
<p>根据前面的分析，导致 “Public Key Retrieval is not allowed” 主要是由于当禁用 SSL/TLS 协议传输后，客户端会使用服务器的公钥进行传输，默认情况下客户端不会主动去找服务器拿公钥，此时就会出现上述错误。</p>
<p>经过查阅官方文档，出现 Public Key Retrieval 的场景可以概括为在禁用 SSL/TLS 协议传输切当前用户在服务器端没有登录缓存的情况下，客户端没有办法拿到服务器的公钥。具体的场景如下：</p>
<ol>
<li>新建数据库用户，首次登录；</li>
<li>数据库的用户名、密码发生改变后登录；</li>
<li>服务器端调用 <code>FLUSH PRIVELEGES</code> 指令刷新服务器缓存。</li>
</ol>
<p>针对上述错误，有如下的解决方案：</p>
<ol>
<li>在条件允许的情况下，不要禁用 SSL/TLS 协议，即不要在 CLI 客户端使用 <code>--ssl-mode=disabled</code>，或不要在 JDBC 连接串中加入 <code>useSSL=false</code></li>
<li>如果必须禁用 SSL/TLS 协议，则可以尝试使用 CLI 客户端登录一次 MySQL 数据库制造登录缓存</li>
<li>如果必须禁用 SSL/TLS 协议，则可以通过增加如下参数允许客户端获得服务器的公钥：</li>
<li>在 JDBC 连接串中加入 <code>allowPublicKeyRetrieval=true</code> 参数</li>
<li>在 CLI 客户端连接时加入 <code>--get-server-public-key</code> 参数</li>
<li>在 CLI 客户端连接时加入 <code>--server-public-key-path=file_name</code> 参数，指定存放在本地的公钥文件</li>
</ol>
<h2 id="18">18、服务管理<a class="headerlink" href="#18" title="Permanent link">&para;</a></h2>
<h3 id="181sql">18.1、SQL 模式<a class="headerlink" href="#181sql" title="Permanent link">&para;</a></h3>
<p>MySQL 服务可以在不同的 SQL 模式下运行，并且可以根据 <code>sql_mode</code> 系统变量的值将这些模式应用于不同的客户端。DBA 可以设置全局 SQL 模式以匹配站点服务器的操作要求，并且每个应用程序可以根据自己的要求设置其会话 SQL 模式。</p>
<p>模式会影响 MySQL 支持的 SQL 语法及其执行的数据验证检查。这使得在不同的环境中使用 MySQL 以及将 MySQL 与其他数据库服务器一起使用更容易。</p>
<blockquote>
<p>当使用 InnoDB 表时，还要考虑 <code>innodb_strict_mode</code> 系统变量。它为 InnoDB 表启用了额外的错误检查。</p>
</blockquote>
<h4 id="1811-sql">18.1.1、设置 SQL 模式<a class="headerlink" href="#1811-sql" title="Permanent link">&para;</a></h4>
<p>SQL 模式在不同的版本有不同的默认值：</p>
<ul>
<li>MySQL 5.6 版本默认为 NO_ENGINE_SUBSTITUTION。</li>
<li>MySQL 5.7 版本中默认为 ONLY_FULL_GROUP_BY、STRICT_TRANS_TABLES、NO_ZERO_IN_DATE、NO_ZERO_DATE、ERROR_FOR_DIVISION_BY_ZERO、NO_AUTO_CREATE_USER 和 NO_ENGINE_SUBSTITUTION。</li>
<li>MySQL 8.0 版本中默认为：ONLY_FULL_GROUP _BY、STRICT_TRANS_TABLES、NO_ZERO_in_DATE、NO_ZERO_DATE、ERROR_FOR_DIVISION_BY_ZERO 和 NO_ENGINE_SUBSTITION。</li>
</ul>
<p>要在服务启动时设置 SQL 模式，请在命令行中使用 <code>--sql-mode="modes"</code> 选项，或在选项文件（如 my.cnf（Unix 操作系统）或 my.ini（Windows））中使用 <code>--sql-mode="modes"</code> 。<em>modes</em> 是用逗号分隔的不同模式的列表。要明确清除 SQL 模式，请在命令行中使用 <code>--sql-mode=""</code> 或在选项文件中使用 <code>--sql-mode=""</code> 将其设置为空字符串。</p>
<blockquote>
<p>MySQL 安装程序可能会在安装过程中配置 SQL 模式。 如果 SQL 模式与默认值或您期望的不同，请检查服务器在启动时读取的选项文件中的设置。</p>
</blockquote>
<p>要在运行时更改 SQL 模式，请使用 <code>SET</code> 语句设置全局或会话 <code>sql_mode</code> 系统变量：</p>
<div class="highlight"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">sql_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;modes&#39;</span><span class="p">;</span>
<span class="k">SET</span><span class="w"> </span><span class="k">SESSION</span><span class="w"> </span><span class="n">sql_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;modes&#39;</span><span class="p">;</span>
</code></pre></div>
<p>设置全局变量需要 SYSTEM_VARIABLES_ADMIN 权限（或不推荐使用的 SUPER 权限），并且会影响从那时起连接的所有客户端的操作。设置会话变量仅影响当前客户端。每个客户端都可以随时更改其会话 <code>sql_mode</code> 值。</p>
<p>要确定当前全局或会话 <code>sql_mode</code> 设置，请 <code>SELECT</code> 其值：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="nv">@@GLOBAL.sql_mode</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="nv">@@SESSION.sql_mode</span><span class="p">;</span>
</code></pre></div>
<h4 id="1812sql">18.1.2、SQL 模式列表<a class="headerlink" href="#1812sql" title="Permanent link">&para;</a></h4>
<p>以下列表介绍了所有支持的 SQL 模式：</p>
<ul>
<li>ALLOW_INVALID_DATES</li>
<li>ANSI_QUOTES</li>
<li>ERROR_FOR_DIVISION_BY_ZERO</li>
<li>HIGH_NOT_PRECEDENCE</li>
<li>IGNORE_SPACE</li>
<li>NO_AUTO_VALUE_ON_ZERO</li>
<li>NO_BACKSLASH_ESCAPES</li>
<li>NO_DIR_IN_CREATE</li>
<li>NO_ENGINE_SUBSTITUTION</li>
<li>NO_UNSIGNED_SUBTRACTION</li>
<li>NO_ZERO_DATE</li>
<li>NO_ZERO_IN_DATE</li>
<li>ONLY_FULL_GROUP_BY</li>
<li>PAD_CHAR_TO_FULL_LENGTH</li>
<li>PIPES_AS_CONCAT</li>
<li>REAL_AS_FLOAT</li>
<li>STRICT_ALL_TABLES</li>
<li>STRICT_TRANS_TABLES</li>
<li>TIME_TRUNCATE_FRACTIONAL</li>
</ul>
<h5 id="no_zero_date">NO_ZERO_DATE<a class="headerlink" href="#no_zero_date" title="Permanent link">&para;</a></h5>
<p>该模式下不允许 "0000-00-00" 作为有效日期，插入会产生警告，通常和严格模式一同使用。</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t_date</span><span class="p">(</span><span class="n">c1</span><span class="w"> </span><span class="kt">date</span><span class="p">);</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.05</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;no_zero_date&quot;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t_date</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="s2">&quot;0000-00-00&quot;</span><span class="p">);</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="p">(</span><span class="mf">0.01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">warnings</span><span class="p">;</span>
<span class="o">+---------+------+---------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">Level</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Code</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Message</span><span class="w">                                     </span><span class="o">|</span>
<span class="o">+---------+------+---------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Warning</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1264</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Out</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="s1">&#39;c1&#39;</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">+---------+------+---------------------------------------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mf">0.01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">-------------</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t_date</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="s2">&quot;0000-00-00&quot;</span><span class="p">);</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<h5 id="no_zero_in_date">NO_ZERO_IN_DATE<a class="headerlink" href="#no_zero_in_date" title="Permanent link">&para;</a></h5>
<p>该模式下不允许月或者日部分出现 0 的日期，插入会转换成 "0000-00-00" 并产生警告，通常和严格模式一起使用。</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;no_zero_in_date&quot;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t_date</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="s2">&quot;2021-00-11&quot;</span><span class="p">);</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="p">(</span><span class="mf">0.01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t_date</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="s2">&quot;2021-11-00&quot;</span><span class="p">);</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t_date</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="s2">&quot;2021-00-00&quot;</span><span class="p">);</span><span class="w">  </span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_date</span><span class="p">;</span>
<span class="o">+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">c1</span><span class="w">         </span><span class="o">|</span>
<span class="o">+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">0000</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">0000</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">0000</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------------+</span>
<span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<h5 id="only_full_group_by">ONLY_FULL_GROUP_BY<a class="headerlink" href="#only_full_group_by" title="Permanent link">&para;</a></h5>
<p>该模式下当 <code>SELECT</code>、<code>HAVING</code> 和 <code>ORDER BY</code> 的字段使用了非聚合列，如果既不在 <code>GROUP BY</code> 子句中引用或命名，也不是一个聚合函数时将会拒绝执行。</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;only_full_group_by&quot;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_mode_t</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">c2</span><span class="p">;</span>
<span class="k">ERROR</span><span class="w"> </span><span class="mi">1055</span><span class="w"> </span><span class="p">(</span><span class="mi">42000</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Expression</span><span class="w"> </span><span class="c1">#1 of SELECT list is not in GROUP BY clause and contains nonaggregated column &#39;ymh.t_mode_t.c1&#39; which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by</span>

<span class="o">---------------</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_mode_t</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">c2</span><span class="p">;</span>
<span class="o">+------+-----+</span>
<span class="o">|</span><span class="w"> </span><span class="n">c1</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">c2</span><span class="w">  </span><span class="o">|</span>
<span class="o">+------+-----+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ccc</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="o">|</span>
<span class="o">+------+-----+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<h5 id="pad_char_to_full_length">PAD_CHAR_TO_FULL_LENGTH<a class="headerlink" href="#pad_char_to_full_length" title="Permanent link">&para;</a></h5>
<p>该模式下 <code>CHAR(N)</code> 字段类型将会在尾部填充空格到其全长；</p>
<blockquote>
<p>注意：禁用该模式将会裁剪 <code>CHAR</code> 字段的尾部空格；</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t_char</span><span class="p">(</span><span class="n">c1</span><span class="w"> </span><span class="kt">char</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">c2</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.28</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s1">&#39;PAD_CHAR_TO_FULL_LENGTH&#39;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t_char</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;a &#39;</span><span class="p">,</span><span class="s1">&#39;a &#39;</span><span class="p">);</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="nf">char_length</span><span class="p">(</span><span class="n">c1</span><span class="p">),</span><span class="nf">char_length</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_char</span><span class="p">;</span>
<span class="o">+-----------------+-----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="nf">char_length</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">char_length</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-----------------+-----------------+</span>
<span class="o">|</span><span class="w">              </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-----------------+-----------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mf">0.01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">truncate</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t_char</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.06</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span>
<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t_char</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;a &#39;</span><span class="p">,</span><span class="s1">&#39;a &#39;</span><span class="p">);</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="nf">char_length</span><span class="p">(</span><span class="n">c1</span><span class="p">),</span><span class="nf">char_length</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_char</span><span class="p">;</span>
<span class="o">+-----------------+-----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="nf">char_length</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">char_length</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-----------------+-----------------+</span>
<span class="o">|</span><span class="w">               </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-----------------+-----------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mf">0.01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<h5 id="pipes_as_concat">PIPES_AS_CONCAT<a class="headerlink" href="#pipes_as_concat" title="Permanent link">&para;</a></h5>
<p>该模式下将 <code>||</code> 作为字符串连接运算符（和 <code>CONCAT()</code> 函数相同），而不是作为 <code>OR</code> 的同义词。</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;pipes_as_concat&quot;</span><span class="p">;</span><span class="w"> </span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span>
<span class="o">+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="o">||</span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="w">   </span><span class="o">|</span>
<span class="o">+------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span>
<span class="o">+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="o">||</span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">+------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<h5 id="real_as_float">REAL_AS_FLOAT<a class="headerlink" href="#real_as_float" title="Permanent link">&para;</a></h5>
<p>该模式将 <code>REAL</code> 作为 <code>FLOAT</code> 的同义词；禁用该模式 MySQL 将 <code>REAL</code> 作为 <code>DOUBLE</code> 的同义词。</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;real_as_float&quot;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t_real</span><span class="p">(</span><span class="n">c1</span><span class="w"> </span><span class="kt">real</span><span class="p">);</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.05</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">desc</span><span class="w"> </span><span class="n">t_real</span><span class="p">;</span>
<span class="o">+-------+-------+------+-----+---------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Field</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="no">Null</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Key</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Default</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-------+-------+------+-----+---------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">c1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">YES</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">    </span><span class="o">|</span><span class="w">       </span><span class="o">|</span>
<span class="o">+-------+-------+------+-----+---------+-------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mf">0.04</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t_real_1</span><span class="p">(</span><span class="n">c1</span><span class="w"> </span><span class="kt">real</span><span class="p">);</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.05</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">desc</span><span class="w"> </span><span class="n">t_real_1</span><span class="p">;</span>
<span class="o">+-------+--------+------+-----+---------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Field</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="no">Null</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Key</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Default</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-------+--------+------+-----+---------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">c1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">YES</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="no">NULL</span><span class="w">    </span><span class="o">|</span><span class="w">       </span><span class="o">|</span>
<span class="o">+-------+--------+------+-----+---------+-------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mf">0.01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<h5 id="time_truncate_fractional">TIME_TRUNCATE_FRACTIONAL<a class="headerlink" href="#time_truncate_fractional" title="Permanent link">&para;</a></h5>
<p>控制对 <code>DATE</code>、<code>DATETIME</code>、<code>TIMESTAMP</code> 类型的带小数部分的秒的处理，该模式下会根据精度截断。默认会做四舍五入。</p>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t_time_fractional</span><span class="p">(</span><span class="n">c1</span><span class="w"> </span><span class="kt">time</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">c2</span><span class="w"> </span><span class="kt">datetime</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">c3</span><span class="w"> </span><span class="kt">timestamp</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.06</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;time_truncate_fractional&quot;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t_time_fractional</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mf">10.999</span><span class="p">,</span><span class="s2">&quot;2021-08-08 08:08:08.999&quot;</span><span class="p">,</span><span class="s2">&quot;2021-08-08 08:08:08.999&quot;</span><span class="p">);</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_time_fractional</span><span class="p">;</span>
<span class="o">+-------------+------------------------+------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">c1</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">c2</span><span class="w">                     </span><span class="o">|</span><span class="w"> </span><span class="n">c3</span><span class="w">                     </span><span class="o">|</span>
<span class="o">+-------------+------------------------+------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mf">10.99</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2021</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mi">08</span><span class="o">:</span><span class="mf">08.99</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2021</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mi">08</span><span class="o">:</span><span class="mf">08.99</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-------------+------------------------+------------------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">------------------</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">truncate</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t_time_fractional</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.06</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">------------------</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t_time_fractional</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mf">10.999</span><span class="p">,</span><span class="s2">&quot;2021-08-08 08:08:08.999&quot;</span><span class="p">,</span><span class="s2">&quot;2021-08-08 08:08:08.999&quot;</span><span class="p">);</span>
<span class="k">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mf">0.01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_time_fractional</span><span class="p">;</span><span class="w"> </span>
<span class="o">+-------------+------------------------+------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">c1</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">c2</span><span class="w">                     </span><span class="o">|</span><span class="w"> </span><span class="n">c3</span><span class="w">                     </span><span class="o">|</span>
<span class="o">+-------------+------------------------+------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mf">11.00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2021</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mi">08</span><span class="o">:</span><span class="mf">09.00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2021</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mi">08</span><span class="o">:</span><span class="mf">09.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">+-------------+------------------------+------------------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mf">0.00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<h4 id="1813-sql">18.1.3、组合 SQL 模式<a class="headerlink" href="#1813-sql" title="Permanent link">&para;</a></h4>
<p>以下特殊模式是前面列表中模式值组合的简写：</p>
<ul>
<li>ANSI</li>
</ul>
<p>此模式会更改语法和行为，以更接近标准 SQL。</p>
<p>等效于 REAL_AS_FLOAT、PIPES_AS_CONCAT、ANSI_QUOTES、IGNORE_SPACE 和 ONLY_FULL_GROUP _BY。</p>
<ul>
<li>TRADITIONAL</li>
</ul>
<p>设置 TRADITIONAL 模式使得 MySQL 使用起来表现的像一个 “传统” 数据库。简单来说在 TRADITIONAL 模式下插入不正确的值时会导致错误而不是返回 warning。</p>
<p>TRADITIONA L等效于 STRICT_TRANS_TABLES、STRICT_ALL_TABLES，NO_ZERO_IN_DATE、NO_ZERO_DATE、ERROR_FOR_DIVISION_BY_ZERO 和 NO_ENGINE_SUBSTITION。</p>
<blockquote>
<p>启用 TRADITIONAL 模式后，一旦出现错误，<code>INSERT</code> 或 <code>UPDATE</code> 就会中止。如果您使用的是非事务存储引擎，这可能不是您想要的，因为在发生错误之前所做的数据更改可能不会回滚，从而导致 “部分完成” 更新。</p>
</blockquote>
<h3 id="182">18.2、集群<a class="headerlink" href="#182" title="Permanent link">&para;</a></h3>
<p>所谓集群，就是多台服务器之间共享数据，从而实现系统的高可用。节点之间的数据是实时同步的，采用的是同步复制机制。除了有多个主节点外，这些主节点还有多个从节点，当在主节点上进行写操作时，这些写操作会立即被复制到其他节点。因此，所有节点上的数据都是同步的，可以保持一致性。</p>
<p>其特点是高可伸缩性和高可用性，但其缺点也不言而喻，可能会出现数据不一致情况，也会耗费大量的资源。</p>
<h4 id="1821">18.2.1、主从复制<a class="headerlink" href="#1821" title="Permanent link">&para;</a></h4>
<p>有一个主数据库（Master）和一个或多个从数据库（Slave）。主数据库负责处理事务操作（INSERT、UPDATE、DELETE），并将这些操作的日志（binlog）传送给从数据库。从数据库通过解析主数据库的日志并执行相同的操作，在从库上实现数据的同步。其作用是可以实现读写分离（主节点负责读和写，从节点只负责读），也可以在发生故障时进行数据的恢复（从数据库相当于是主数据库的备份）。</p>
<p>其形式有以下几种：</p>
<p><img src="./!assets/MySQL/1746338-20231126174307485-252845782.png" alt="img" style="zoom: 33%;" /></p>
<p><strong>主从复制的原理</strong></p>
<p>在主库中，如果有数据更新，则主库会将数据的事务操作 DML 记录到 binlog（二进制日志）中（在配置文件中 log-bin 指定的文件就是日志文件），binlog 是主从同步的源头，记录的是SQL语句或行级变化。这就是为什么主库的 binlog 日志一定要开启的原因。</p>
<p>MySQL 的主从复制中主要有三个线程：master（binlog dump thread）、slave（I/O thread 、SQL thread），Master 一条线程和 Slave 中的两条线程：</p>
<ul>
<li>I/O thread 线程在 Slave 中创建，该线程用于请求 Master，Master 会返回 binlog 的名称以及当前数据更新的位置、binlog 文件位置的副本。</li>
</ul>
<p>然后，将 binlog 保存在 relay log（中继日志）中，relay log 也是记录数据更新的信息。</p>
<ul>
<li>
<p>Master 的 binlog dump 线程负责把 binlog 的内容发送给从库，拥有多个从库的主库会为每一个连接到主库的从库创建一个 binlog dump 线程。</p>
</li>
<li>
<p>SQL thread 也是在 Slave 中创建的，当 Slave 检测到中继日志有更新，就会将更新的内容同步到 Slave 数据库中，这样就保证了主从的数据的同步。</p>
</li>
</ul>
<h5 id="_17">搭建主从复制<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h5>
<p>这里搭建最简单的一主一从形式，服务器信息如下：</p>
<table>
<thead>
<tr>
<th>IP</th>
<th>端口</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.13.18.187</td>
<td>3306</td>
<td>主节点</td>
</tr>
<tr>
<td>10.13.18.199</td>
<td>3306</td>
<td>从节点</td>
</tr>
</tbody>
</table>
<p><strong>10.13.18.187 主机配置 Master</strong></p>
<ol>
<li>
<p>修改配置文件<code>my.cnf</code>：</p>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/my.cnf
</code></pre></div>
<p>在最后添加以下内容：</p>
<div class="highlight"><pre><span></span><code># 指定server_id
server_id=1
# 定义日志名
log-bin=master.bin
</code></pre></div>
</li>
<li>
<p>重启服务生效配置：</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>mysqld
</code></pre></div>
</li>
<li>
<p>连接数据库，创建一个用户用于数据的同步：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;replica_user&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">mysql_native_password</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;Replica#user1&#39;</span><span class="p">;</span>
</code></pre></div>
<p>用户授权：</p>
<div class="highlight"><pre><span></span><code><span class="k">GRANT</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="n">SLAVE</span><span class="p">,</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="n">CLIENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;replica_user&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>
</code></pre></div>
<p>刷新授权信息：</p>
<div class="highlight"><pre><span></span><code><span class="n">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span>
</code></pre></div>
<p>查看用户信息：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">host</span><span class="p">,</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">mysql</span><span class="p">.</span><span class="k">user</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;replica_user&#39;</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>使用 <code>SHOW MASTER STATUS;</code> 查看 Master 信息，目的是查看 <code>File</code> 和 <code>Position</code> 的值：</p>
<div class="highlight"><pre><span></span><code>mysql&gt; SHOW MASTER STATUS;
+---------------+----------+--------------+------------------+-------------------+
| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+---------------+----------+--------------+------------------+-------------------+
| master.000001 |      719 |              |                  |                   |
+---------------+----------+--------------+------------------+-------------------+
1 row in set (0.00 sec)
</code></pre></div>
</li>
</ol>
<p><strong>10.13.18.199 主机配置 Slave</strong></p>
<ol>
<li>
<p>修改配置文件<code>my.cnf</code>：</p>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/my.cnf
</code></pre></div>
<p>在最后添加以下内容：</p>
<div class="highlight"><pre><span></span><code># 执行server_id
server-id=2
</code></pre></div>
</li>
<li>
<p>重启服务生效配置：</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>mysqld
</code></pre></div>
</li>
<li>
<p>连接数据库，指定主服务器信息：</p>
<div class="highlight"><pre><span></span><code><span class="n">CHANGE</span><span class="w"> </span><span class="n">MASTER</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">master_host</span><span class="o">=</span><span class="ss">&quot;10.13.18.187&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">master_user</span><span class="o">=</span><span class="ss">&quot;replica_user&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">master_password</span><span class="o">=</span><span class="ss">&quot;Replica#user1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">master_log_file</span><span class="o">=</span><span class="ss">&quot;master.000001&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">master_log_pos</span><span class="o">=</span><span class="mi">719</span><span class="p">;</span>
</code></pre></div>
<ul>
<li><em>master_host</em>：主服务器 IP 地址</li>
<li><em>master_user</em>：主服务器添加用户名。</li>
<li><em>master_password</em>：用户密码。</li>
<li><em>master_log_file</em>：主服务器 binlog 日志名。</li>
<li><em>master_log_pos</em>：偏移量。</li>
</ul>
</li>
<li>
<p>启动 Slave进程：</p>
<p>```sql
START SLAVE;</p>
</li>
<li>
<p>查看状态信息（<code>Slave_IO_Running</code> 和 <code>Slave_SQL_Running</code> 必须同时是 YES 状态）：</p>
<div class="highlight"><pre><span></span><code><span class="k">SHOW</span><span class="w"> </span><span class="n">SLAVE</span><span class="w"> </span><span class="n">STATUS</span><span class="w"> </span><span class="err">\</span><span class="k">G</span>
</code></pre></div>
</li>
</ol>
<h5 id="_18">测试主从复制<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h5>
<p>Master 中新建一个数据库，去 Slave 上查看数据库，看到数据库已同步。</p>
<h5 id="_19">可能出现的问题<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h5>
<p>出现问题先确定 <code>Slave_IO_Running</code> 和 <code>Slave_SQL_Running</code> 的状态（必须同时是 YES 状态），如果不为 YES 可以使用 <code>SHOW SLAVE STATUS \G</code> 查看 <code>Last_IO_Errno</code>、<code>Last_IO_Error</code> 和 <code>Last_SQL_Errno</code>、<code>Last_SQL_Error</code> 的信息定位问题。</p>
<p><strong>Last_IO_Errno: 2003</strong></p>
<div class="highlight"><pre><span></span><code>Last_IO_Errno: 2003
Last_IO_Error: Error connecting to source &#39;replica_user@10.13.18.187:3306&#39;. This was attempt 10/86400, with a delay of 60 seconds between attempts. Message: Can&#39;t connect to MySQL server on &#39;10.13.18.187:3306&#39; (113)
</code></pre></div>
<p>这种情况是连接不上主库，可以排查下两个主机之间是否能 <code>ping</code> 通，不通则可能是两个主机之间的网络问题，如果可以通则 <code>telnet</code> 看看端口是否有反应，如果不通可能是防火墙问题：</p>
<div class="highlight"><pre><span></span><code><span class="c1">## 查看防火墙状态</span>
firewall-cmd<span class="w"> </span>--state

<span class="c1">## 查看防火墙开放端口</span>
firewall-cmd<span class="w"> </span>--list-ports

<span class="c1">## 防火墙开放3306端口</span>
firewall-cmd<span class="w"> </span>--permanent<span class="w"> </span>--add-port<span class="o">=</span><span class="m">3306</span>/tcp

<span class="c1">## 重新加载防火墙</span>
firewall-cmd<span class="w"> </span>--reload
</code></pre></div>
<p><strong>Last_IO_Errno: 2061</strong></p>
<div class="highlight"><pre><span></span><code>Last_IO_Errno: 2061
Last_IO_Error: Error connecting to source &#39;replica_user@10.13.18.187:3306&#39;. This was attempt 1/86400, with a delay of 60 seconds between attempts. Message: Authentication plugin &#39;caching_sha2_password&#39; reported error: Authentication requires secure connection.
</code></pre></div>
<p>因为当前使用的身份验证插件是：caching_sha2_password（MySQL 8.0 的默认插件），而 MySQL 主从复制默认是走非加密连接，这就触发了："Authentication requires secure connection" 错误。</p>
<p>重新创建复制用户，指定使用 mysql_native_password 插件：</p>
<div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;replica_user&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;replica_user&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">mysql_native_password</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;xxxxxxxx&#39;</span><span class="p">;</span>

<span class="k">GRANT</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="n">SLAVE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;replica_user&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>

<span class="n">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span>
</code></pre></div>
<p>执行完成之后，从库重新配置 Slave：</p>
<div class="highlight"><pre><span></span><code><span class="n">STOP</span><span class="w"> </span><span class="n">SLAVE</span><span class="p">;</span>

<span class="n">CHANGE</span><span class="w"> </span><span class="n">MASTER</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">master_host</span><span class="o">=</span><span class="ss">&quot;10.13.18.187&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">master_user</span><span class="o">=</span><span class="ss">&quot;replica_user&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">master_password</span><span class="o">=</span><span class="ss">&quot;Replica#user1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">master_log_file</span><span class="o">=</span><span class="ss">&quot;master.000001&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">master_log_pos</span><span class="o">=</span><span class="mi">719</span><span class="p">;</span>

<span class="k">START</span><span class="w"> </span><span class="n">SLAVE</span><span class="p">;</span>
</code></pre></div>
<p><strong>Last_IO_Errno: 13117</strong></p>
<div class="highlight"><pre><span></span><code>Last_IO_Errno: 13117
Last_IO_Error: Fatal error: The replica I/O thread stops because source and replica have equal MySQL server ids; these ids must be different for replication to work (or the --replicate-same-server-id option must be used on replica but this does not always make sense; please check the manual before using it).
</code></pre></div>
<p>可能是不注意将 <code>CHANGE MASTER</code> 命令执行到 Master 机器上了。</p>
<ol>
<li>
<p>先停止 Slave：</p>
<div class="highlight"><pre><span></span><code><span class="n">STOP</span><span class="w"> </span><span class="n">SLAVE</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>重置 Slave：</p>
<div class="highlight"><pre><span></span><code><span class="k">RESET</span><span class="w"> </span><span class="n">SLAVE</span><span class="w"> </span><span class="k">ALL</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>之后可以再执行：</p>
<div class="highlight"><pre><span></span><code><span class="k">SHOW</span><span class="w"> </span><span class="n">SLAVE</span><span class="w"> </span><span class="n">STATUS</span><span class="err">\</span><span class="k">G</span>
</code></pre></div>
<p>确认是空的状态即可。</p>
</li>
</ol>
<h3 id="183">18.3、配置不区分大小写<a class="headerlink" href="#183" title="Permanent link">&para;</a></h3>
<p>在默认情况下，Linux 系统上 MySQL 是大小写敏感的。这意味着在查询表名、列名或关键字时，必须精确匹配大小写。然而，在某些情况下，我们可能希望数据库忽略大小写，以便更方便地进行操作。</p>
<p><strong>查看当前设置</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">show</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;lower_case_table_names&#39;</span><span class="p">;</span>
</code></pre></div>
<p><code>lower_case_table_names</code> 参数说明：</p>
<ul>
<li><code>0</code>：表名和列名是大小写敏感的。</li>
<li><code>1</code>：表名和列名是大小写不敏感的。</li>
<li><code>2</code>：表名和列名是大小写敏感的，但 MySQL 会自动将大写字母转换为小写字母存储。</li>
</ul>
<p><strong>临时修改设置</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">lower_case_table_names</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>这种配置方式，只对当前会话有效。当 MySQL 重启时，配置将修改为默认值。 </p>
</div>
<p><strong>永久修改设置</strong></p>
<p>这种方式是，修改 MySQL 的配置文件。一般在 <code>/etc/my.cnf</code> 文件中，在后面追加如下内容：</p>
<div class="highlight"><pre><span></span><code>lower_case_table_names=1
</code></pre></div>
<p>修改后，保存。然后重启 MySQL 服务器。</p>
<div class="admonition warning">
<p class="admonition-title">Caution</p>
<p>MySQL 8.0 要求我们不能在 initialize 之后再更改 <code>lower_case_table_names</code> 的值，也就是说，已经初始化后的数据库再通过更改 my.cnf 文件是不管用的，只能重装数据库。</p>
<p>强行修改重启服务会：
<div class="highlight"><pre><span></span><code>Job for mysqld.service failed because the control process exited with
error code. See &quot;systemctl status mysqld.service&quot; and &quot;journalctl -xe&quot; 
for details.
</code></pre></div></p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.top", "navigation.indexes", "navigation.tracking"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../_javascripts/auto_title.js"></script>
      
    
  </body>
</html>