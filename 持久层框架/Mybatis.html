<!DOCTYPE html><html lang="zh" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://0richalcos.github.io/Note/%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/Mybatis.html"><link rel="prev" href="MyBatis-Plus.html"><link rel="next" href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/SSO.html"><link rel="icon" href="../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Mybatis - éšä¾¿è®°è®°</title><link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css"><link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel="stylesheet" href="../_stylesheets/extra.css"><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal"> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a href="#1å…¥é—¨" class="md-skip"> è·³è½¬è‡³ </a> </div> <div data-md-component="announce"> </div> <header class="md-header md-header--shadow" data-md-component="header"> <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰"> <a href="../index.html" title="éšä¾¿è®°è®°" class="md-header__button md-logo" aria-label="éšä¾¿è®°è®°" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> <label class="md-header__button md-icon" for="__drawer"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> éšä¾¿è®°è®° </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> Mybatis </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input class="md-option" data-md-color-media data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal" aria-label="åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼" type="radio" name="__palette" id="__palette_0"> <label class="md-header__button md-icon" title="åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼" for="__palette_1" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> <input class="md-option" data-md-color-media data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal" aria-label="åˆ‡æ¢åˆ°äº®è‰²æ¨¡å¼" type="radio" name="__palette" id="__palette_1"> <label class="md-header__button md-icon" title="åˆ‡æ¢åˆ°äº®è‰²æ¨¡å¼" for="__palette_0" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for="__search"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required> <label class="md-search__icon md-icon" for="__search"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class="md-search__options" aria-label="æŸ¥æ‰¾"> <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“ </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <div class="md-header__source"> <a href="https://github.com/0richalcos/Note" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class="md-source__repository"> GitHub </div> </a> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav class="md-nav md-nav--primary" aria-label="å¯¼èˆªæ " data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a href="../index.html" title="éšä¾¿è®°è®°" class="md-nav__button md-logo" aria-label="éšä¾¿è®°è®°" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> éšä¾¿è®°è®° </label> <div class="md-nav__source"> <a href="https://github.com/0richalcos/Note" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class="md-source__repository"> GitHub </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../index.html" class="md-nav__link"> <span class="md-ellipsis"> ğŸ  é¦–é¡µ </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2"> <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0"> <span class="md-ellipsis"> â™¨ï¸ Java </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> â™¨ï¸ Java </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../Java/Java.html" class="md-nav__link"> <span class="md-ellipsis"> Java </span> </a> </li> <li class="md-nav__item"> <a href="../Java/Java8.html" class="md-nav__link"> <span class="md-ellipsis"> Java 8 </span> </a> </li> <li class="md-nav__item"> <a href="../Java/JavaBasics.html" class="md-nav__link"> <span class="md-ellipsis"> Java åŸºç¡€ </span> </a> </li> <li class="md-nav__item"> <a href="../Java/JavaCollection.html" class="md-nav__link"> <span class="md-ellipsis"> Java é›†åˆ </span> </a> </li> <li class="md-nav__item"> <a href="../Java/JavaObject.html" class="md-nav__link"> <span class="md-ellipsis"> Java ç±»å’Œå¯¹è±¡ </span> </a> </li> <li class="md-nav__item"> <a href="../Java/JavaWeb.html" class="md-nav__link"> <span class="md-ellipsis"> JavaWeb </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3"> <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0"> <span class="md-ellipsis"> ğŸ§® æ•°æ®ç»“æ„åŠç®—æ³• </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_3"> <span class="md-nav__icon md-icon"></span> ğŸ§® æ•°æ®ç»“æ„åŠç®—æ³• </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E7%AE%97%E6%B3%95/Algorithm.html" class="md-nav__link"> <span class="md-ellipsis"> Algorithm </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E7%AE%97%E6%B3%95/DesignPattern.html" class="md-nav__link"> <span class="md-ellipsis"> DesignPattern </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4"> <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0"> <span class="md-ellipsis"> ğŸƒ Spring </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> ğŸƒ Spring </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../Spring/Spring.html" class="md-nav__link"> <span class="md-ellipsis"> Spring </span> </a> </li> <li class="md-nav__item"> <a href="../Spring/SpringBoot.html" class="md-nav__link"> <span class="md-ellipsis"> SpringBoot </span> </a> </li> <li class="md-nav__item"> <a href="../Spring/SpringCloud.html" class="md-nav__link"> <span class="md-ellipsis"> SpringCloud </span> </a> </li> <li class="md-nav__item"> <a href="../Spring/SpringMVC.html" class="md-nav__link"> <span class="md-ellipsis"> SpringMVC </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked> <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0"> <span class="md-ellipsis"> ğŸ’¾ æŒä¹…å±‚æ¡†æ¶ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true"> <label class="md-nav__title" for="__nav_5"> <span class="md-nav__icon md-icon"></span> ğŸ’¾ æŒä¹…å±‚æ¡†æ¶ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="MyBatis-Plus.html" class="md-nav__link"> <span class="md-ellipsis"> MyBatis-Plus </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc"> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> Mybatis </span> <span class="md-nav__icon md-icon"></span> </label> <a href="Mybatis.html" class="md-nav__link md-nav__link--active"> <span class="md-ellipsis"> Mybatis </span> </a> <nav class="md-nav md-nav--secondary" aria-label="ç›®å½•"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> ç›®å½• </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix> <li class="md-nav__item"> <a href="#1å…¥é—¨" class="md-nav__link"> <span class="md-ellipsis"> 1ã€å…¥é—¨ </span> </a> <nav class="md-nav" aria-label="1ã€å…¥é—¨"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#11ä»€ä¹ˆæ˜¯-mybatis" class="md-nav__link"> <span class="md-ellipsis"> 1.1ã€ä»€ä¹ˆæ˜¯ MyBatisï¼Ÿ </span> </a> </li> <li class="md-nav__item"> <a href="#12å®‰è£…" class="md-nav__link"> <span class="md-ellipsis"> 1.2ã€å®‰è£… </span> </a> </li> <li class="md-nav__item"> <a href="#13sqlsessionfactory" class="md-nav__link"> <span class="md-ellipsis"> 1.3ã€SqlSessionFactory </span> </a> </li> <li class="md-nav__item"> <a href="#14sqlsession" class="md-nav__link"> <span class="md-ellipsis"> 1.4ã€SqlSession </span> </a> </li> <li class="md-nav__item"> <a href="#15æ¢ç©¶å·²æ˜ å°„çš„-sql-è¯­å¥" class="md-nav__link"> <span class="md-ellipsis"> 1.5ã€æ¢ç©¶å·²æ˜ å°„çš„ SQL è¯­å¥ </span> </a> </li> <li class="md-nav__item"> <a href="#16ä½œç”¨åŸŸscopeå’Œç”Ÿå‘½å‘¨æœŸ" class="md-nav__link"> <span class="md-ellipsis"> 1.6ã€ä½œç”¨åŸŸï¼ˆScopeï¼‰å’Œç”Ÿå‘½å‘¨æœŸ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#2xmlé…ç½®" class="md-nav__link"> <span class="md-ellipsis"> 2ã€XMLé…ç½® </span> </a> <nav class="md-nav" aria-label="2ã€XMLé…ç½®"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#21å±æ€§properties" class="md-nav__link"> <span class="md-ellipsis"> 2.1ã€å±æ€§ï¼ˆpropertiesï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#22è®¾ç½®settings" class="md-nav__link"> <span class="md-ellipsis"> 2.2ã€è®¾ç½®ï¼ˆsettingsï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#23ç±»å‹åˆ«åtypealiases" class="md-nav__link"> <span class="md-ellipsis"> 2.3ã€ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#24ç¯å¢ƒé…ç½®environments" class="md-nav__link"> <span class="md-ellipsis"> 2.4ã€ç¯å¢ƒé…ç½®ï¼ˆenvironmentsï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#25æ˜ å°„å™¨mappers" class="md-nav__link"> <span class="md-ellipsis"> 2.5ã€æ˜ å°„å™¨ï¼ˆmappersï¼‰ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#3xmlæ˜ å°„æ–‡ä»¶" class="md-nav__link"> <span class="md-ellipsis"> 3ã€XMLæ˜ å°„æ–‡ä»¶ </span> </a> <nav class="md-nav" aria-label="3ã€XMLæ˜ å°„æ–‡ä»¶"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#31select" class="md-nav__link"> <span class="md-ellipsis"> 3.1ã€select </span> </a> </li> <li class="md-nav__item"> <a href="#32insertupdatedelete" class="md-nav__link"> <span class="md-ellipsis"> 3.2ã€insertã€updateã€delete </span> </a> </li> <li class="md-nav__item"> <a href="#33å‚æ•°" class="md-nav__link"> <span class="md-ellipsis"> 3.3ã€å‚æ•° </span> </a> </li> <li class="md-nav__item"> <a href="#34ç»“æœæ˜ å°„" class="md-nav__link"> <span class="md-ellipsis"> 3.4ã€ç»“æœæ˜ å°„ </span> </a> <nav class="md-nav" aria-label="3.4ã€ç»“æœæ˜ å°„"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#341é«˜çº§ç»“æœæ˜ å°„" class="md-nav__link"> <span class="md-ellipsis"> 3.4.1ã€é«˜çº§ç»“æœæ˜ å°„ </span> </a> </li> <li class="md-nav__item"> <a href="#342id--result" class="md-nav__link"> <span class="md-ellipsis"> 3.4.2ã€id &amp; result </span> </a> </li> <li class="md-nav__item"> <a href="#343æ„é€ æ–¹æ³•" class="md-nav__link"> <span class="md-ellipsis"> 3.4.3ã€æ„é€ æ–¹æ³• </span> </a> </li> <li class="md-nav__item"> <a href="#344å…³è”" class="md-nav__link"> <span class="md-ellipsis"> 3.4.4ã€å…³è” </span> </a> <nav class="md-nav" aria-label="3.4.4ã€å…³è”"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#åµŒå¥—-select-æŸ¥è¯¢" class="md-nav__link"> <span class="md-ellipsis"> åµŒå¥— Select æŸ¥è¯¢ </span> </a> </li> <li class="md-nav__item"> <a href="#åµŒå¥—ç»“æœæ˜ å°„" class="md-nav__link"> <span class="md-ellipsis"> åµŒå¥—ç»“æœæ˜ å°„ </span> </a> </li> <li class="md-nav__item"> <a href="#å¤šç»“æœé›†resultset" class="md-nav__link"> <span class="md-ellipsis"> å¤šç»“æœé›†ï¼ˆResultSetï¼‰ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#345é›†åˆ" class="md-nav__link"> <span class="md-ellipsis"> 3.4.5ã€é›†åˆ </span> </a> <nav class="md-nav" aria-label="3.4.5ã€é›†åˆ"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#åµŒå¥—-select-æŸ¥è¯¢_1" class="md-nav__link"> <span class="md-ellipsis"> åµŒå¥— Select æŸ¥è¯¢ </span> </a> </li> <li class="md-nav__item"> <a href="#åµŒå¥—ç»“æœæ˜ å°„_1" class="md-nav__link"> <span class="md-ellipsis"> åµŒå¥—ç»“æœæ˜ å°„ </span> </a> </li> <li class="md-nav__item"> <a href="#å¤šç»“æœé›†resultset_1" class="md-nav__link"> <span class="md-ellipsis"> å¤šç»“æœé›†ï¼ˆResultSetï¼‰ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#346é‰´åˆ«å™¨" class="md-nav__link"> <span class="md-ellipsis"> 3.4.6ã€é‰´åˆ«å™¨ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#35è‡ªåŠ¨æ˜ å°„" class="md-nav__link"> <span class="md-ellipsis"> 3.5ã€è‡ªåŠ¨æ˜ å°„ </span> </a> </li> <li class="md-nav__item"> <a href="#36ç¼“å­˜" class="md-nav__link"> <span class="md-ellipsis"> 3.6ã€ç¼“å­˜ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#4åŠ¨æ€sql" class="md-nav__link"> <span class="md-ellipsis"> 4ã€åŠ¨æ€SQL </span> </a> <nav class="md-nav" aria-label="4ã€åŠ¨æ€SQL"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#41if" class="md-nav__link"> <span class="md-ellipsis"> 4.1ã€If </span> </a> </li> <li class="md-nav__item"> <a href="#42choosewhenotherwise" class="md-nav__link"> <span class="md-ellipsis"> 4.2ã€chooseã€whenã€otherwise </span> </a> </li> <li class="md-nav__item"> <a href="#43trimwhereset" class="md-nav__link"> <span class="md-ellipsis"> 4.3ã€trimã€whereã€set </span> </a> </li> <li class="md-nav__item"> <a href="#44foreach" class="md-nav__link"> <span class="md-ellipsis"> 4.4ã€foreach </span> </a> </li> <li class="md-nav__item"> <a href="#45ognl-è¡¨è¾¾å¼" class="md-nav__link"> <span class="md-ellipsis"> 4.5ã€OGNL è¡¨è¾¾å¼ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#5java-api" class="md-nav__link"> <span class="md-ellipsis"> 5ã€Java API </span> </a> <nav class="md-nav" aria-label="5ã€Java API"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#51sqlsessionfactory" class="md-nav__link"> <span class="md-ellipsis"> 5.1ã€SqlSessionFactory </span> </a> </li> <li class="md-nav__item"> <a href="#52sqlsession" class="md-nav__link"> <span class="md-ellipsis"> 5.2ã€SqlSession </span> </a> </li> <li class="md-nav__item"> <a href="#53è¯­å¥æ‰§è¡Œæ–¹æ³•" class="md-nav__link"> <span class="md-ellipsis"> 5.3ã€è¯­å¥æ‰§è¡Œæ–¹æ³• </span> </a> </li> <li class="md-nav__item"> <a href="#54ä½¿ç”¨æ˜ å°„å™¨" class="md-nav__link"> <span class="md-ellipsis"> 5.4ã€ä½¿ç”¨æ˜ å°„å™¨ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#6sql-è¯­å¥æ„å»ºå™¨" class="md-nav__link"> <span class="md-ellipsis"> 6ã€SQL è¯­å¥æ„å»ºå™¨ </span> </a> <nav class="md-nav" aria-label="6ã€SQL è¯­å¥æ„å»ºå™¨"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#sql-ç±»" class="md-nav__link"> <span class="md-ellipsis"> SQL ç±» </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#7æ—¥å¿—" class="md-nav__link"> <span class="md-ellipsis"> 7ã€æ—¥å¿— </span> </a> </li> <li class="md-nav__item"> <a href="#8springboot-é›†æˆ" class="md-nav__link"> <span class="md-ellipsis"> 8ã€SpringBoot é›†æˆ </span> </a> <nav class="md-nav" aria-label="8ã€SpringBoot é›†æˆ"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#81æ³¨è§£ç‰ˆ" class="md-nav__link"> <span class="md-ellipsis"> 8.1ã€æ³¨è§£ç‰ˆ </span> </a> </li> <li class="md-nav__item"> <a href="#82xml-é…ç½®ç‰ˆ" class="md-nav__link"> <span class="md-ellipsis"> 8.2ã€XML é…ç½®ç‰ˆ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#9å¼‚å¸¸" class="md-nav__link"> <span class="md-ellipsis"> 9ã€å¼‚å¸¸ </span> </a> <nav class="md-nav" aria-label="9ã€å¼‚å¸¸"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#91netsfjsqlparserparserparseexception" class="md-nav__link"> <span class="md-ellipsis"> 9.1ã€net.sf.jsqlparser.parser.ParseException </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6"> <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0"> <span class="md-ellipsis"> ğŸ” è®¤è¯ä¸æˆæƒ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_6"> <span class="md-nav__icon md-icon"></span> ğŸ” è®¤è¯ä¸æˆæƒ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/SSO.html" class="md-nav__link"> <span class="md-ellipsis"> SSO </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/Sa-Token.html" class="md-nav__link"> <span class="md-ellipsis"> Sa-Token </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/Shiro.html" class="md-nav__link"> <span class="md-ellipsis"> Shiro </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7"> <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0"> <span class="md-ellipsis"> ğŸŒ å‰ç«¯ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7"> <span class="md-nav__icon md-icon"></span> ğŸŒ å‰ç«¯ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/CSS.html" class="md-nav__link"> <span class="md-ellipsis"> CSS </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/JavaScript.html" class="md-nav__link"> <span class="md-ellipsis"> JavaScript </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/Vue.html" class="md-nav__link"> <span class="md-ellipsis"> Vue </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/jQuery.html" class="md-nav__link"> <span class="md-ellipsis"> jQuery </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5"> <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0"> <span class="md-ellipsis"> æ¨¡æ¿å¼•æ“ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_5"> <span class="md-nav__icon md-icon"></span> æ¨¡æ¿å¼•æ“ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/Thymeleaf.html" class="md-nav__link"> <span class="md-ellipsis"> Thymeleaf </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6"> <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0"> <span class="md-ellipsis"> ç»„ä»¶åº“ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_6"> <span class="md-nav__icon md-icon"></span> ç»„ä»¶åº“ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/AntV-X6.html" class="md-nav__link"> <span class="md-ellipsis"> AntV-X6 </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/ApacheECharts.html" class="md-nav__link"> <span class="md-ellipsis"> ApacheECharts </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/Axios.html" class="md-nav__link"> <span class="md-ellipsis"> Axios </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/BootstrapTable.html" class="md-nav__link"> <span class="md-ellipsis"> BootstrapTable </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/DHTMLXGantt.html" class="md-nav__link"> <span class="md-ellipsis"> DHTMLXGantt </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/Element.html" class="md-nav__link"> <span class="md-ellipsis"> Element </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/FullCalendar.html" class="md-nav__link"> <span class="md-ellipsis"> FullCalendar </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/X-editable.html" class="md-nav__link"> <span class="md-ellipsis"> X-editable </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8"> <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0"> <span class="md-ellipsis"> ğŸ“Š æ•°æ®åº“ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_8"> <span class="md-nav__icon md-icon"></span> ğŸ“Š æ•°æ®åº“ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Dameng.html" class="md-nav__link"> <span class="md-ellipsis"> Dameng </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html" class="md-nav__link"> <span class="md-ellipsis"> MySQL </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/MySQLQuery.html" class="md-nav__link"> <span class="md-ellipsis"> MySQLQuery </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/OceanBase.html" class="md-nav__link"> <span class="md-ellipsis"> OceanBase </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle.html" class="md-nav__link"> <span class="md-ellipsis"> Oracle </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html" class="md-nav__link"> <span class="md-ellipsis"> Redis </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Vastbase.html" class="md-nav__link"> <span class="md-ellipsis"> Vastbase </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9"> <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0"> <span class="md-ellipsis"> ğŸ” æœç´¢å¼•æ“ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_9"> <span class="md-nav__icon md-icon"></span> ğŸ” æœç´¢å¼•æ“ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/Elasticsearch.html" class="md-nav__link"> <span class="md-ellipsis"> Elasticsearch </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10"> <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0"> <span class="md-ellipsis"> ğŸ“‡ åˆ†å¸ƒå¼å­˜å‚¨ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_10"> <span class="md-nav__icon md-icon"></span> ğŸ“‡ åˆ†å¸ƒå¼å­˜å‚¨ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/FastDFS.html" class="md-nav__link"> <span class="md-ellipsis"> FastDFS </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/MinIO.html" class="md-nav__link"> <span class="md-ellipsis"> MinIO </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11"> <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0"> <span class="md-ellipsis"> ğŸ›°ï¸ ç½‘ç»œé€šä¿¡ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_11"> <span class="md-nav__icon md-icon"></span> ğŸ›°ï¸ ç½‘ç»œé€šä¿¡ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/Encryption.html" class="md-nav__link"> <span class="md-ellipsis"> Encryption </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/HTTP.html" class="md-nav__link"> <span class="md-ellipsis"> HTTP </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/OpenVPN.html" class="md-nav__link"> <span class="md-ellipsis"> OpenVPN </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/VNC.html" class="md-nav__link"> <span class="md-ellipsis"> VNC </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/WebSocket.html" class="md-nav__link"> <span class="md-ellipsis"> WebSocket </span> </a> </li> <li class="md-nav__item"> <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/frp.html" class="md-nav__link"> <span class="md-ellipsis"> frp </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12"> <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0"> <span class="md-ellipsis"> ğŸ—ƒï¸ æ–‡ä»¶å¤„ç† </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12"> <span class="md-nav__icon md-icon"></span> ğŸ—ƒï¸ æ–‡ä»¶å¤„ç† </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_1"> <label class="md-nav__link" for="__nav_12_1" id="__nav_12_1_label" tabindex="0"> <span class="md-ellipsis"> Office </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_1_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12_1"> <span class="md-nav__icon md-icon"></span> Office </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/ApachePOI.html" class="md-nav__link"> <span class="md-ellipsis"> ApachePOI </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/EasyExcel.html" class="md-nav__link"> <span class="md-ellipsis"> EasyExcel </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/OnlyOffice.html" class="md-nav__link"> <span class="md-ellipsis"> OnlyOffice </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/Poi-tl.html" class="md-nav__link"> <span class="md-ellipsis"> Poi-tl </span> </a> </li> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/Spire.OfficeForJava.html" class="md-nav__link"> <span class="md-ellipsis"> Spire.OfficeForJava </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_2"> <label class="md-nav__link" for="__nav_12_2" id="__nav_12_2_label" tabindex="0"> <span class="md-ellipsis"> PDF </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_2_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12_2"> <span class="md-nav__icon md-icon"></span> PDF </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/PDF/ApachePDFBox.html" class="md-nav__link"> <span class="md-ellipsis"> ApachePDFBox </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_3"> <label class="md-nav__link" for="__nav_12_3" id="__nav_12_3_label" tabindex="0"> <span class="md-ellipsis"> XML </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_3_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12_3"> <span class="md-nav__icon md-icon"></span> XML </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/XML/XMLParse.html" class="md-nav__link"> <span class="md-ellipsis"> XMLParse </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_4"> <label class="md-nav__link" for="__nav_12_4" id="__nav_12_4_label" tabindex="0"> <span class="md-ellipsis"> ZIP </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_4_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_12_4"> <span class="md-nav__icon md-icon"></span> ZIP </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/ZIP/Zip4j.html" class="md-nav__link"> <span class="md-ellipsis"> Zip4j </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13"> <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0"> <span class="md-ellipsis"> âŒ› å®šæ—¶ä»»åŠ¡ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_13"> <span class="md-nav__icon md-icon"></span> âŒ› å®šæ—¶ä»»åŠ¡ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/XXL-JOB.html" class="md-nav__link"> <span class="md-ellipsis"> XXL-JOB </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14"> <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0"> <span class="md-ellipsis"> ğŸ§‘â€ğŸ”§ è¿ç»´ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_14"> <span class="md-nav__icon md-icon"></span> ğŸ§‘â€ğŸ”§ è¿ç»´ </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/Docker.html" class="md-nav__link"> <span class="md-ellipsis"> Docker </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/Linux.html" class="md-nav__link"> <span class="md-ellipsis"> Linux </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/NSSM.html" class="md-nav__link"> <span class="md-ellipsis"> NSSM </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/Nginx.html" class="md-nav__link"> <span class="md-ellipsis"> Nginx </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/Tomcat.html" class="md-nav__link"> <span class="md-ellipsis"> Tomcat </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/TongWeb.html" class="md-nav__link"> <span class="md-ellipsis"> TongWeb </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/WSL.html" class="md-nav__link"> <span class="md-ellipsis"> WSL </span> </a> </li> <li class="md-nav__item"> <a href="../%E8%BF%90%E7%BB%B4/WebLogic.html" class="md-nav__link"> <span class="md-ellipsis"> WebLogic </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15"> <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0"> <span class="md-ellipsis"> ğŸ› ï¸ å¼€å‘å·¥å…· </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_15"> <span class="md-nav__icon md-icon"></span> ğŸ› ï¸ å¼€å‘å·¥å…· </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Git.html" class="md-nav__link"> <span class="md-ellipsis"> Git </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Maven.html" class="md-nav__link"> <span class="md-ellipsis"> Maven </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Node.js.html" class="md-nav__link"> <span class="md-ellipsis"> Node.js </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Swagger.html" class="md-nav__link"> <span class="md-ellipsis"> Swagger </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16"> <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0"> <span class="md-ellipsis"> ğŸ‘» å…¶ä»– </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_16"> <span class="md-nav__icon md-icon"></span> ğŸ‘» å…¶ä»– </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../%E5%85%B6%E4%BB%96/Settings.html" class="md-nav__link"> <span class="md-ellipsis"> Settings </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%85%B6%E4%BB%96/Solutions.html" class="md-nav__link"> <span class="md-ellipsis"> Solutions </span> </a> </li> <li class="md-nav__item"> <a href="../%E5%85%B6%E4%BB%96/Weasel.html" class="md-nav__link"> <span class="md-ellipsis"> Weasel </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav class="md-nav md-nav--secondary" aria-label="ç›®å½•"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> ç›®å½• </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix> <li class="md-nav__item"> <a href="#1å…¥é—¨" class="md-nav__link"> <span class="md-ellipsis"> 1ã€å…¥é—¨ </span> </a> <nav class="md-nav" aria-label="1ã€å…¥é—¨"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#11ä»€ä¹ˆæ˜¯-mybatis" class="md-nav__link"> <span class="md-ellipsis"> 1.1ã€ä»€ä¹ˆæ˜¯ MyBatisï¼Ÿ </span> </a> </li> <li class="md-nav__item"> <a href="#12å®‰è£…" class="md-nav__link"> <span class="md-ellipsis"> 1.2ã€å®‰è£… </span> </a> </li> <li class="md-nav__item"> <a href="#13sqlsessionfactory" class="md-nav__link"> <span class="md-ellipsis"> 1.3ã€SqlSessionFactory </span> </a> </li> <li class="md-nav__item"> <a href="#14sqlsession" class="md-nav__link"> <span class="md-ellipsis"> 1.4ã€SqlSession </span> </a> </li> <li class="md-nav__item"> <a href="#15æ¢ç©¶å·²æ˜ å°„çš„-sql-è¯­å¥" class="md-nav__link"> <span class="md-ellipsis"> 1.5ã€æ¢ç©¶å·²æ˜ å°„çš„ SQL è¯­å¥ </span> </a> </li> <li class="md-nav__item"> <a href="#16ä½œç”¨åŸŸscopeå’Œç”Ÿå‘½å‘¨æœŸ" class="md-nav__link"> <span class="md-ellipsis"> 1.6ã€ä½œç”¨åŸŸï¼ˆScopeï¼‰å’Œç”Ÿå‘½å‘¨æœŸ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#2xmlé…ç½®" class="md-nav__link"> <span class="md-ellipsis"> 2ã€XMLé…ç½® </span> </a> <nav class="md-nav" aria-label="2ã€XMLé…ç½®"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#21å±æ€§properties" class="md-nav__link"> <span class="md-ellipsis"> 2.1ã€å±æ€§ï¼ˆpropertiesï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#22è®¾ç½®settings" class="md-nav__link"> <span class="md-ellipsis"> 2.2ã€è®¾ç½®ï¼ˆsettingsï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#23ç±»å‹åˆ«åtypealiases" class="md-nav__link"> <span class="md-ellipsis"> 2.3ã€ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#24ç¯å¢ƒé…ç½®environments" class="md-nav__link"> <span class="md-ellipsis"> 2.4ã€ç¯å¢ƒé…ç½®ï¼ˆenvironmentsï¼‰ </span> </a> </li> <li class="md-nav__item"> <a href="#25æ˜ å°„å™¨mappers" class="md-nav__link"> <span class="md-ellipsis"> 2.5ã€æ˜ å°„å™¨ï¼ˆmappersï¼‰ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#3xmlæ˜ å°„æ–‡ä»¶" class="md-nav__link"> <span class="md-ellipsis"> 3ã€XMLæ˜ å°„æ–‡ä»¶ </span> </a> <nav class="md-nav" aria-label="3ã€XMLæ˜ å°„æ–‡ä»¶"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#31select" class="md-nav__link"> <span class="md-ellipsis"> 3.1ã€select </span> </a> </li> <li class="md-nav__item"> <a href="#32insertupdatedelete" class="md-nav__link"> <span class="md-ellipsis"> 3.2ã€insertã€updateã€delete </span> </a> </li> <li class="md-nav__item"> <a href="#33å‚æ•°" class="md-nav__link"> <span class="md-ellipsis"> 3.3ã€å‚æ•° </span> </a> </li> <li class="md-nav__item"> <a href="#34ç»“æœæ˜ å°„" class="md-nav__link"> <span class="md-ellipsis"> 3.4ã€ç»“æœæ˜ å°„ </span> </a> <nav class="md-nav" aria-label="3.4ã€ç»“æœæ˜ å°„"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#341é«˜çº§ç»“æœæ˜ å°„" class="md-nav__link"> <span class="md-ellipsis"> 3.4.1ã€é«˜çº§ç»“æœæ˜ å°„ </span> </a> </li> <li class="md-nav__item"> <a href="#342id--result" class="md-nav__link"> <span class="md-ellipsis"> 3.4.2ã€id &amp; result </span> </a> </li> <li class="md-nav__item"> <a href="#343æ„é€ æ–¹æ³•" class="md-nav__link"> <span class="md-ellipsis"> 3.4.3ã€æ„é€ æ–¹æ³• </span> </a> </li> <li class="md-nav__item"> <a href="#344å…³è”" class="md-nav__link"> <span class="md-ellipsis"> 3.4.4ã€å…³è” </span> </a> <nav class="md-nav" aria-label="3.4.4ã€å…³è”"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#åµŒå¥—-select-æŸ¥è¯¢" class="md-nav__link"> <span class="md-ellipsis"> åµŒå¥— Select æŸ¥è¯¢ </span> </a> </li> <li class="md-nav__item"> <a href="#åµŒå¥—ç»“æœæ˜ å°„" class="md-nav__link"> <span class="md-ellipsis"> åµŒå¥—ç»“æœæ˜ å°„ </span> </a> </li> <li class="md-nav__item"> <a href="#å¤šç»“æœé›†resultset" class="md-nav__link"> <span class="md-ellipsis"> å¤šç»“æœé›†ï¼ˆResultSetï¼‰ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#345é›†åˆ" class="md-nav__link"> <span class="md-ellipsis"> 3.4.5ã€é›†åˆ </span> </a> <nav class="md-nav" aria-label="3.4.5ã€é›†åˆ"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#åµŒå¥—-select-æŸ¥è¯¢_1" class="md-nav__link"> <span class="md-ellipsis"> åµŒå¥— Select æŸ¥è¯¢ </span> </a> </li> <li class="md-nav__item"> <a href="#åµŒå¥—ç»“æœæ˜ å°„_1" class="md-nav__link"> <span class="md-ellipsis"> åµŒå¥—ç»“æœæ˜ å°„ </span> </a> </li> <li class="md-nav__item"> <a href="#å¤šç»“æœé›†resultset_1" class="md-nav__link"> <span class="md-ellipsis"> å¤šç»“æœé›†ï¼ˆResultSetï¼‰ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#346é‰´åˆ«å™¨" class="md-nav__link"> <span class="md-ellipsis"> 3.4.6ã€é‰´åˆ«å™¨ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#35è‡ªåŠ¨æ˜ å°„" class="md-nav__link"> <span class="md-ellipsis"> 3.5ã€è‡ªåŠ¨æ˜ å°„ </span> </a> </li> <li class="md-nav__item"> <a href="#36ç¼“å­˜" class="md-nav__link"> <span class="md-ellipsis"> 3.6ã€ç¼“å­˜ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#4åŠ¨æ€sql" class="md-nav__link"> <span class="md-ellipsis"> 4ã€åŠ¨æ€SQL </span> </a> <nav class="md-nav" aria-label="4ã€åŠ¨æ€SQL"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#41if" class="md-nav__link"> <span class="md-ellipsis"> 4.1ã€If </span> </a> </li> <li class="md-nav__item"> <a href="#42choosewhenotherwise" class="md-nav__link"> <span class="md-ellipsis"> 4.2ã€chooseã€whenã€otherwise </span> </a> </li> <li class="md-nav__item"> <a href="#43trimwhereset" class="md-nav__link"> <span class="md-ellipsis"> 4.3ã€trimã€whereã€set </span> </a> </li> <li class="md-nav__item"> <a href="#44foreach" class="md-nav__link"> <span class="md-ellipsis"> 4.4ã€foreach </span> </a> </li> <li class="md-nav__item"> <a href="#45ognl-è¡¨è¾¾å¼" class="md-nav__link"> <span class="md-ellipsis"> 4.5ã€OGNL è¡¨è¾¾å¼ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#5java-api" class="md-nav__link"> <span class="md-ellipsis"> 5ã€Java API </span> </a> <nav class="md-nav" aria-label="5ã€Java API"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#51sqlsessionfactory" class="md-nav__link"> <span class="md-ellipsis"> 5.1ã€SqlSessionFactory </span> </a> </li> <li class="md-nav__item"> <a href="#52sqlsession" class="md-nav__link"> <span class="md-ellipsis"> 5.2ã€SqlSession </span> </a> </li> <li class="md-nav__item"> <a href="#53è¯­å¥æ‰§è¡Œæ–¹æ³•" class="md-nav__link"> <span class="md-ellipsis"> 5.3ã€è¯­å¥æ‰§è¡Œæ–¹æ³• </span> </a> </li> <li class="md-nav__item"> <a href="#54ä½¿ç”¨æ˜ å°„å™¨" class="md-nav__link"> <span class="md-ellipsis"> 5.4ã€ä½¿ç”¨æ˜ å°„å™¨ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#6sql-è¯­å¥æ„å»ºå™¨" class="md-nav__link"> <span class="md-ellipsis"> 6ã€SQL è¯­å¥æ„å»ºå™¨ </span> </a> <nav class="md-nav" aria-label="6ã€SQL è¯­å¥æ„å»ºå™¨"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#sql-ç±»" class="md-nav__link"> <span class="md-ellipsis"> SQL ç±» </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#7æ—¥å¿—" class="md-nav__link"> <span class="md-ellipsis"> 7ã€æ—¥å¿— </span> </a> </li> <li class="md-nav__item"> <a href="#8springboot-é›†æˆ" class="md-nav__link"> <span class="md-ellipsis"> 8ã€SpringBoot é›†æˆ </span> </a> <nav class="md-nav" aria-label="8ã€SpringBoot é›†æˆ"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#81æ³¨è§£ç‰ˆ" class="md-nav__link"> <span class="md-ellipsis"> 8.1ã€æ³¨è§£ç‰ˆ </span> </a> </li> <li class="md-nav__item"> <a href="#82xml-é…ç½®ç‰ˆ" class="md-nav__link"> <span class="md-ellipsis"> 8.2ã€XML é…ç½®ç‰ˆ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#9å¼‚å¸¸" class="md-nav__link"> <span class="md-ellipsis"> 9ã€å¼‚å¸¸ </span> </a> <nav class="md-nav" aria-label="9ã€å¼‚å¸¸"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#91netsfjsqlparserparserparseexception" class="md-nav__link"> <span class="md-ellipsis"> 9.1ã€net.sf.jsqlparser.parser.ParseException </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <nav class="md-path" aria-label="å¯¼èˆªæ "> <ol class="md-path__list"> <li class="md-path__item"> <a href="../index.html" class="md-path__link"> <span class="md-ellipsis"> ğŸ  é¦–é¡µ </span> </a> </li> <li class="md-path__item"> <a href="MyBatis-Plus.html" class="md-path__link"> <span class="md-ellipsis"> ğŸ’¾ æŒä¹…å±‚æ¡†æ¶ </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1 id="mybatis">Mybatis<a class="headerlink" href="#mybatis" title="é”šç‚¹é“¾æ¥">Â¶</a></h1> <h2 id="1å…¥é—¨">1ã€å…¥é—¨<a class="headerlink" href="#1å…¥é—¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <h3 id="11ä»€ä¹ˆæ˜¯-mybatis">1.1ã€ä»€ä¹ˆæ˜¯ MyBatisï¼Ÿ<a class="headerlink" href="#11ä»€ä¹ˆæ˜¯-mybatis" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒè‡ªå®šä¹‰ SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis å…é™¤äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç ä»¥åŠè®¾ç½®å‚æ•°å’Œè·å–ç»“æœé›†çš„å·¥ä½œã€‚MyBatis å¯ä»¥é€šè¿‡ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸå§‹ç±»å‹ã€æ¥å£å’Œ Java POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“ä¸­çš„è®°å½•ã€‚</p> <h3 id="12å®‰è£…">1.2ã€å®‰è£…<a class="headerlink" href="#12å®‰è£…" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>è¦ä½¿ç”¨ MyBatisï¼Œ åªéœ€å°† <a href="https://github.com/mybatis/mybatis-3/releases">mybatis-x.x.x.jar</a> æ–‡ä»¶ç½®äºç±»è·¯å¾„ï¼ˆclasspathï¼‰ä¸­å³å¯ã€‚</p> <p>å¦‚æœä½¿ç”¨ Maven æ¥æ„å»ºé¡¹ç›®ï¼Œåˆ™éœ€å°†ä¸‹é¢çš„ä¾èµ–ä»£ç ç½®äº pom.xml æ–‡ä»¶ä¸­ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>mybatis<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">&lt;version&gt;</span>x.x.x<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div> <h3 id="13sqlsessionfactory">1.3ã€SqlSessionFactory<a class="headerlink" href="#13sqlsessionfactory" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æ¯ä¸ªåŸºäº MyBatis çš„åº”ç”¨éƒ½æ˜¯ä»¥ä¸€ä¸ª SqlSessionFactory çš„å®ä¾‹ä¸ºæ ¸å¿ƒçš„ã€‚SqlSessionFactory çš„å®ä¾‹å¯ä»¥é€šè¿‡ SqlSessionFactoryBuilder è·å¾—ã€‚è€Œ SqlSessionFactoryBuilder åˆ™å¯ä»¥ä» XML é…ç½®æ–‡ä»¶æˆ–ä¸€ä¸ªé¢„å…ˆé…ç½®çš„ Configuration å®ä¾‹æ¥æ„å»ºå‡º SqlSessionFactory å®ä¾‹ã€‚</p> <p><strong>ä» XML ä¸­æ„å»º SqlSessionFactory</strong></p> <p>ä» XML æ–‡ä»¶ä¸­æ„å»º SqlSessionFactory çš„å®ä¾‹éå¸¸ç®€å•ï¼Œå»ºè®®ä½¿ç”¨ç±»è·¯å¾„ä¸‹çš„èµ„æºæ–‡ä»¶è¿›è¡Œé…ç½®ã€‚ ä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»æ„çš„è¾“å…¥æµï¼ˆInputStreamï¼‰å®ä¾‹ï¼Œæ¯”å¦‚ç”¨æ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²æˆ– <code>file:// URL</code> æ„é€ çš„è¾“å…¥æµã€‚MyBatis åŒ…å«ä¸€ä¸ªåå« Resources çš„å·¥å…·ç±»ï¼Œå®ƒåŒ…å«ä¸€äº›å®ç”¨æ–¹æ³•ï¼Œä½¿å¾—ä»ç±»è·¯å¾„æˆ–å…¶å®ƒä½ç½®åŠ è½½èµ„æºæ–‡ä»¶æ›´åŠ å®¹æ˜“ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"org/mybatis/example/mybatis-config.xml"</span><span class="p">;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">InputStream</span><span class="w"> </span><span class="n">inputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Resources</span><span class="p">.</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="n">sqlSessionFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBuilder</span><span class="p">().</span><span class="na">build</span><span class="p">(</span><span class="n">inputStream</span><span class="p">);</span>
</span></code></pre></div> <p>XML é…ç½®æ–‡ä»¶ä¸­åŒ…å«äº†å¯¹ MyBatis ç³»ç»Ÿçš„æ ¸å¿ƒè®¾ç½®ï¼ŒåŒ…æ‹¬è·å–æ•°æ®åº“è¿æ¥å®ä¾‹çš„æ•°æ®æºï¼ˆDataSourceï¼‰ä»¥åŠå†³å®šäº‹åŠ¡ä½œç”¨åŸŸå’Œæ§åˆ¶æ–¹å¼çš„äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTransactionManagerï¼‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="cp">&lt;!DOCTYPE configuration</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="cp">  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="cp">  "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="nt">&lt;configuration&gt;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="nt">&lt;environments</span><span class="w"> </span><span class="na">default=</span><span class="s">"development"</span><span class="nt">&gt;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="nt">&lt;environment</span><span class="w"> </span><span class="na">id=</span><span class="s">"development"</span><span class="nt">&gt;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">      </span><span class="nt">&lt;transactionManager</span><span class="w"> </span><span class="na">type=</span><span class="s">"JDBC"</span><span class="nt">/&gt;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">      </span><span class="nt">&lt;dataSource</span><span class="w"> </span><span class="na">type=</span><span class="s">"POOLED"</span><span class="nt">&gt;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"driver"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${driver}"</span><span class="nt">/&gt;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"url"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${url}"</span><span class="nt">/&gt;</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"username"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${username}"</span><span class="nt">/&gt;</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"password"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${password}"</span><span class="nt">/&gt;</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">      </span><span class="nt">&lt;/dataSource&gt;</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="nt">&lt;/environment&gt;</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">  </span><span class="nt">&lt;/environments&gt;</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">  </span><span class="nt">&lt;mappers&gt;</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">    </span><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">resource=</span><span class="s">"org/mybatis/example/BlogMapper.xml"</span><span class="nt">/&gt;</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">  </span><span class="nt">&lt;/mappers&gt;</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></div> <p>å½“ç„¶ï¼Œè¿˜æœ‰å¾ˆå¤šå¯ä»¥åœ¨ XML æ–‡ä»¶ä¸­é…ç½®çš„é€‰é¡¹ï¼Œä¸Šé¢çš„ç¤ºä¾‹ä»…ç½—åˆ—äº†æœ€å…³é”®çš„éƒ¨åˆ†ã€‚ æ³¨æ„ XML å¤´éƒ¨çš„å£°æ˜ï¼Œå®ƒç”¨æ¥éªŒè¯ XML æ–‡æ¡£çš„æ­£ç¡®æ€§ã€‚environment å…ƒç´ ä½“ä¸­åŒ…å«äº†äº‹åŠ¡ç®¡ç†å’Œè¿æ¥æ± çš„é…ç½®ã€‚mappers å…ƒç´ åˆ™åŒ…å«äº†ä¸€ç»„æ˜ å°„å™¨ï¼ˆmapperï¼‰ï¼Œè¿™äº›æ˜ å°„å™¨çš„ XML æ˜ å°„æ–‡ä»¶åŒ…å«äº† SQL ä»£ç å’Œæ˜ å°„å®šä¹‰ä¿¡æ¯ã€‚</p> <p><strong>ä¸ä½¿ç”¨ XML æ„å»º SqlSessionFactory</strong></p> <p>å¦‚æœæƒ³ç›´æ¥ä» Java ä»£ç è€Œä¸æ˜¯ XML æ–‡ä»¶ä¸­åˆ›å»ºé…ç½®ï¼Œæˆ–è€…æƒ³è¦åˆ›å»ºä½ è‡ªå·±çš„é…ç½®å»ºé€ å™¨ï¼ŒMyBatis ä¹Ÿæä¾›äº†å®Œæ•´çš„é…ç½®ç±»ï¼Œæä¾›äº†æ‰€æœ‰ä¸ XML æ–‡ä»¶ç­‰ä»·çš„é…ç½®é¡¹ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">Properties</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">properties</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">"driver"</span><span class="p">,</span><span class="w"> </span><span class="s">"com.mysql.cj.jdbc.Driver"</span><span class="p">);</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">properties</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">"url"</span><span class="p">,</span><span class="w"> </span><span class="s">"jdbc:mysql://127.0.0.1:3306/mybatis"</span><span class="p">);</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">properties</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">"username"</span><span class="p">,</span><span class="w"> </span><span class="s">"root"</span><span class="p">);</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">properties</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">"password"</span><span class="p">,</span><span class="w"> </span><span class="s">"root"</span><span class="p">);</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="n">PooledDataSourceFactory</span><span class="w"> </span><span class="n">pooledDataSourceFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PooledDataSourceFactory</span><span class="p">();</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="n">pooledDataSourceFactory</span><span class="p">.</span><span class="na">setProperties</span><span class="p">(</span><span class="n">properties</span><span class="p">);</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="n">DataSource</span><span class="w">&nbsp;</span><span class="n">dataSource</span><span class="w">&nbsp;</span><span class="o">=</span><span class="w">&nbsp;</span><span class="n">pooledDataSourceFactory</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="n">TransactionFactory</span><span class="w"> </span><span class="n">transactionFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JdbcTransactionFactory</span><span class="p">();</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="n">Environment</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Environment</span><span class="p">(</span><span class="s">"development"</span><span class="p">,</span><span class="w"> </span><span class="n">transactionFactory</span><span class="p">,</span><span class="w"> </span><span class="n">dataSource</span><span class="p">);</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="n">Configuration</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Configuration</span><span class="p">(</span><span class="n">environment</span><span class="p">);</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="n">configuration</span><span class="p">.</span><span class="na">addMapper</span><span class="p">(</span><span class="n">BlogMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="n">sqlSessionFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBuilder</span><span class="p">().</span><span class="na">build</span><span class="p">(</span><span class="n">configuration</span><span class="p">);</span>
</span></code></pre></div> <p>æ³¨æ„è¯¥ä¾‹ä¸­ï¼Œconfiguration æ·»åŠ äº†ä¸€ä¸ªæ˜ å°„å™¨ç±»ï¼ˆmapper classï¼‰ã€‚æ˜ å°„å™¨ç±»æ˜¯ Java ç±»ï¼Œå®ƒä»¬åŒ…å« SQL æ˜ å°„æ³¨è§£ä»è€Œé¿å…ä¾èµ– XML æ–‡ä»¶ã€‚ä¸è¿‡ï¼Œç”±äº Java æ³¨è§£çš„ä¸€äº›é™åˆ¶ä»¥åŠæŸäº› MyBatis æ˜ å°„çš„å¤æ‚æ€§ï¼Œè¦ä½¿ç”¨å¤§å¤šæ•°é«˜çº§æ˜ å°„ï¼ˆæ¯”å¦‚ï¼šåµŒå¥—è”åˆæ˜ å°„ï¼‰ï¼Œä»ç„¶éœ€è¦ä½¿ç”¨ XML é…ç½®ã€‚æœ‰é‰´äºæ­¤ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªåŒå XML é…ç½®æ–‡ä»¶ï¼ŒMyBatis ä¼šè‡ªåŠ¨æŸ¥æ‰¾å¹¶åŠ è½½å®ƒï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŸºäºç±»è·¯å¾„å’Œ BlogMapper.class çš„ç±»åï¼Œä¼šåŠ è½½ BlogMapper.xmlï¼‰ã€‚</p> <h3 id="14sqlsession">1.4ã€SqlSession<a class="headerlink" href="#14sqlsession" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æ—¢ç„¶æœ‰äº† SqlSessionFactoryï¼Œé¡¾åæ€ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸­è·å¾— SqlSession çš„å®ä¾‹ã€‚SqlSession æä¾›äº†åœ¨æ•°æ®åº“æ‰§è¡Œ SQL å‘½ä»¤æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³•ã€‚ä½ å¯ä»¥é€šè¿‡ SqlSession å®ä¾‹æ¥ç›´æ¥æ‰§è¡Œå·²æ˜ å°„çš„ SQL è¯­å¥ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">SqlSession</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqlSessionFactory</span><span class="p">.</span><span class="na">openSession</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="n">Blog</span><span class="w"> </span><span class="n">blog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">selectOne</span><span class="p">(</span><span class="s">"org.mybatis.example.BlogMapper.selectBlog"</span><span class="p">,</span><span class="w"> </span><span class="mi">101</span><span class="p">);</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="p">}</span>
</span></code></pre></div> <p>è¯šç„¶ï¼Œè¿™ç§æ–¹å¼èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚ä½†ç°åœ¨æœ‰äº†ä¸€ç§æ›´ç®€æ´çš„æ–¹å¼â€”â€”ä½¿ç”¨å’ŒæŒ‡å®šè¯­å¥çš„å‚æ•°å’Œè¿”å›å€¼ç›¸åŒ¹é…çš„æ¥å£ï¼ˆæ¯”å¦‚ BlogMapper.classï¼‰ï¼Œç°åœ¨ä½ çš„ä»£ç ä¸ä»…æ›´æ¸…æ™°ï¼Œæ›´åŠ ç±»å‹å®‰å…¨ï¼Œè¿˜ä¸ç”¨æ‹…å¿ƒå¯èƒ½å‡ºé”™çš„å­—ç¬¦ä¸²å­—é¢å€¼ä»¥åŠå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p> <p>ä¾‹å¦‚ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">SqlSession</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqlSessionFactory</span><span class="p">.</span><span class="na">openSession</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="n">BlogMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">getMapper</span><span class="p">(</span><span class="n">BlogMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="n">Blog</span><span class="w"> </span><span class="n">blog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">selectBlog</span><span class="p">(</span><span class="mi">101</span><span class="p">);</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">}</span>
</span></code></pre></div> <p>ç°åœ¨æˆ‘ä»¬æ¥æ¢ç©¶ä¸€ä¸‹è¿™æ®µä»£ç ç©¶ç«Ÿåšäº†äº›ä»€ä¹ˆã€‚</p> <h3 id="15æ¢ç©¶å·²æ˜ å°„çš„-sql-è¯­å¥">1.5ã€æ¢ç©¶å·²æ˜ å°„çš„ SQL è¯­å¥<a class="headerlink" href="#15æ¢ç©¶å·²æ˜ å°„çš„-sql-è¯­å¥" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>åœ¨ä¸Šé¢æåˆ°çš„ä¾‹å­ä¸­ï¼Œä¸€ä¸ªè¯­å¥æ—¢å¯ä»¥é€šè¿‡ XML å®šä¹‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ³¨è§£å®šä¹‰ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹ XML å®šä¹‰è¯­å¥çš„æ–¹å¼ï¼Œäº‹å®ä¸Š MyBatis æä¾›çš„æ‰€æœ‰ç‰¹æ€§éƒ½å¯ä»¥åˆ©ç”¨åŸºäº XML çš„æ˜ å°„è¯­è¨€æ¥å®ç°ï¼Œè¿™ä½¿å¾— MyBatis åœ¨è¿‡å»çš„æ•°å¹´é—´å¾—ä»¥æµè¡Œã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªåŸºäº XML æ˜ å°„è¯­å¥çš„ç¤ºä¾‹ï¼Œå®ƒåº”è¯¥å¯ä»¥æ»¡è¶³ä¸Šä¸ªç¤ºä¾‹ä¸­ SqlSession çš„è°ƒç”¨ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="cp">&lt;!DOCTYPE mapper</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="cp">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="cp">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">"org.mybatis.example.BlogMapper"</span><span class="nt">&gt;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectBlog"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span>select<span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>Blog<span class="w"> </span>where<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">  </span><span class="nt">&lt;/select&gt;</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="nt">&lt;/mapper&gt;</span>
</span></code></pre></div> <p>åœ¨ä¸€ä¸ª XML æ˜ å°„æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å®šä¹‰æ— æ•°ä¸ªæ˜ å°„è¯­å¥ã€‚æ–‡æ¡£çš„å…¶å®ƒéƒ¨åˆ†å¾ˆç›´ç™½ï¼Œå®¹æ˜“ç†è§£ã€‚ å®ƒåœ¨å‘½åç©ºé—´ â€œorg.mybatis.example.BlogMapperâ€ ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º â€œselectBlogâ€ çš„æ˜ å°„è¯­å¥ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç”¨å…¨é™å®šå â€œorg.mybatis.example.BlogMapper.selectBlogâ€ æ¥è°ƒç”¨æ˜ å°„è¯­å¥äº†ï¼Œå°±åƒä¸Šé¢ä¾‹å­ä¸­é‚£æ ·ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">Blog</span><span class="w"> </span><span class="n">blog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">selectOne</span><span class="p">(</span><span class="s">"org.mybatis.example.BlogMapper.selectBlog"</span><span class="p">,</span><span class="w"> </span><span class="mi">101</span><span class="p">);</span>
</span></code></pre></div> <p>è¿™ç§æ–¹å¼å’Œç”¨å…¨é™å®šåè°ƒç”¨ Java å¯¹è±¡çš„æ–¹æ³•ç±»ä¼¼ã€‚è¿™æ ·ï¼Œè¯¥å‘½åå°±å¯ä»¥ç›´æ¥æ˜ å°„åˆ°åœ¨å‘½åç©ºé—´ä¸­åŒåçš„æ˜ å°„å™¨ç±»ï¼Œå¹¶å°†å·²æ˜ å°„çš„ select è¯­å¥åŒ¹é…åˆ°å¯¹åº”åç§°ã€å‚æ•°å’Œè¿”å›ç±»å‹çš„æ–¹æ³•ã€‚å› æ­¤ä½ å°±å¯ä»¥åƒä¸Šé¢é‚£æ ·ï¼Œä¸è´¹å¹ç°ä¹‹åŠ›åœ°åœ¨å¯¹åº”çš„æ˜ å°„å™¨æ¥å£è°ƒç”¨æ–¹æ³•ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">BlogMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">getMapper</span><span class="p">(</span><span class="n">BlogMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">Blog</span><span class="w"> </span><span class="n">blog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">selectBlog</span><span class="p">(</span><span class="mi">101</span><span class="p">);</span>
</span></code></pre></div> <p>ç¬¬äºŒç§æ–¹æ³•æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œé¦–å…ˆå®ƒä¸ä¾èµ–äºå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œä¼šæ›´å®‰å…¨ä¸€ç‚¹ï¼›å…¶æ¬¡ï¼Œå¦‚æœä½ çš„ IDE æœ‰ä»£ç è¡¥å…¨åŠŸèƒ½ï¼Œé‚£ä¹ˆä»£ç è¡¥å…¨å¯ä»¥å¸®ä½ å¿«é€Ÿé€‰æ‹©åˆ°æ˜ å°„å¥½çš„ SQL è¯­å¥ã€‚</p> <p><strong>å¯¹å‘½åç©ºé—´çš„ä¸€ç‚¹è¡¥å……</strong>:</p> <p>åœ¨ä¹‹å‰ç‰ˆæœ¬çš„ MyBatis ä¸­ï¼Œ<strong>å‘½åç©ºé—´ï¼ˆNamespacesï¼‰</strong>çš„ä½œç”¨å¹¶ä¸å¤§ï¼Œæ˜¯å¯é€‰çš„ã€‚ ä½†ç°åœ¨ï¼Œéšç€å‘½åç©ºé—´è¶Šå‘é‡è¦ï¼Œä½ å¿…é¡»æŒ‡å®šå‘½åç©ºé—´ã€‚</p> <p>å‘½åç©ºé—´çš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯åˆ©ç”¨æ›´é•¿çš„å…¨é™å®šåæ¥å°†ä¸åŒçš„è¯­å¥éš”ç¦»å¼€æ¥ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†ä½ ä¸Šé¢è§åˆ°çš„æ¥å£ç»‘å®šã€‚å°±ç®—ä½ è§‰å¾—æš‚æ—¶ç”¨ä¸åˆ°æ¥å£ç»‘å®šï¼Œä½ ä¹Ÿåº”è¯¥éµå¾ªè¿™é‡Œçš„è§„å®šï¼Œä»¥é˜²å“ªå¤©ä½ æ”¹å˜äº†ä¸»æ„ã€‚ é•¿è¿œæ¥çœ‹ï¼Œåªè¦å°†å‘½åç©ºé—´ç½®äºåˆé€‚çš„ Java åŒ…å‘½åç©ºé—´ä¹‹ä¸­ï¼Œä½ çš„ä»£ç ä¼šå˜å¾—æ›´åŠ æ•´æ´ï¼Œä¹Ÿæœ‰åˆ©äºä½ æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ MyBatisã€‚</p> <p><strong>å‘½åè§£æï¼š</strong>ä¸ºäº†å‡å°‘è¾“å…¥é‡ï¼ŒMyBatis å¯¹æ‰€æœ‰å…·æœ‰åç§°çš„é…ç½®å…ƒç´ ï¼ˆåŒ…æ‹¬è¯­å¥ï¼Œç»“æœæ˜ å°„ï¼Œç¼“å­˜ç­‰ï¼‰ä½¿ç”¨äº†å¦‚ä¸‹çš„å‘½åè§£æè§„åˆ™ã€‚</p> <ul> <li>å…¨é™å®šåï¼ˆæ¯”å¦‚ â€œcom.mypackage.MyMapper.selectAllThingsï¼‰å°†è¢«ç›´æ¥ç”¨äºæŸ¥æ‰¾åŠä½¿ç”¨ã€‚</li> <li>çŸ­åç§°ï¼ˆæ¯”å¦‚ â€œselectAllThingsâ€ï¼‰å¦‚æœå…¨å±€å”¯ä¸€ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å¼•ç”¨ã€‚ å¦‚æœä¸å”¯ä¸€ï¼Œæœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ç›¸åŒåç§°ï¼ˆæ¯”å¦‚ â€œcom.foo.selectAllThingsâ€ å’Œ â€œcom.bar.selectAllThingsâ€ï¼‰ï¼Œé‚£ä¹ˆä½¿ç”¨æ—¶å°±ä¼šäº§ç”Ÿâ€œçŸ­åç§°ä¸å”¯ä¸€â€çš„é”™è¯¯ï¼Œè¿™ç§æƒ…å†µä¸‹å°±å¿…é¡»ä½¿ç”¨å…¨é™å®šåã€‚</li> </ul> <p>å¯¹äºåƒ BlogMapper è¿™æ ·çš„æ˜ å°„å™¨ç±»æ¥è¯´ï¼Œè¿˜æœ‰å¦ä¸€ç§æ–¹æ³•æ¥å®Œæˆè¯­å¥æ˜ å°„ã€‚ å®ƒä»¬æ˜ å°„çš„è¯­å¥å¯ä»¥ä¸ç”¨ XML æ¥é…ç½®ï¼Œè€Œå¯ä»¥ä½¿ç”¨ Java æ³¨è§£æ¥é…ç½®ã€‚æ¯”å¦‚ï¼Œä¸Šé¢çš„ XML ç¤ºä¾‹å¯ä»¥è¢«æ›¿æ¢æˆå¦‚ä¸‹çš„é…ç½®ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">org.mybatis.example</span><span class="p">;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BlogMapper</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="nd">@Select</span><span class="p">(</span><span class="s">"SELECT * FROM blog WHERE id = #{id}"</span><span class="p">)</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="n">Blog</span><span class="w"> </span><span class="nf">selectBlog</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">}</span>
</span></code></pre></div> <p>ä½¿ç”¨æ³¨è§£æ¥æ˜ å°„ç®€å•è¯­å¥ä¼šä½¿ä»£ç æ˜¾å¾—æ›´åŠ ç®€æ´ï¼Œä½†å¯¹äºç¨å¾®å¤æ‚ä¸€ç‚¹çš„è¯­å¥ï¼ŒJava æ³¨è§£ä¸ä»…åŠ›ä¸ä»å¿ƒï¼Œè¿˜ä¼šè®©ä½ æœ¬å°±å¤æ‚çš„ SQL è¯­å¥æ›´åŠ æ··ä¹±ä¸å ªã€‚ å› æ­¤ï¼Œå¦‚æœä½ éœ€è¦åšä¸€äº›å¾ˆå¤æ‚çš„æ“ä½œï¼Œæœ€å¥½ç”¨ XML æ¥æ˜ å°„è¯­å¥ã€‚</p> <p>é€‰æ‹©ä½•ç§æ–¹å¼æ¥é…ç½®æ˜ å°„ï¼Œä»¥åŠè®¤ä¸ºæ˜¯å¦åº”è¯¥è¦ç»Ÿä¸€æ˜ å°„è¯­å¥å®šä¹‰çš„å½¢å¼ï¼Œå®Œå…¨å–å†³äºä½ å’Œä½ çš„å›¢é˜Ÿã€‚ æ¢å¥è¯è¯´ï¼Œæ°¸è¿œä¸è¦æ‹˜æ³¥äºä¸€ç§æ–¹å¼ï¼Œä½ å¯ä»¥å¾ˆè½»æ¾çš„åœ¨åŸºäºæ³¨è§£å’Œ XML çš„è¯­å¥æ˜ å°„æ–¹å¼é—´è‡ªç”±ç§»æ¤å’Œåˆ‡æ¢ã€‚</p> <h3 id="16ä½œç”¨åŸŸscopeå’Œç”Ÿå‘½å‘¨æœŸ">1.6ã€ä½œç”¨åŸŸï¼ˆScopeï¼‰å’Œç”Ÿå‘½å‘¨æœŸ<a class="headerlink" href="#16ä½œç”¨åŸŸscopeå’Œç”Ÿå‘½å‘¨æœŸ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><strong>SqlSessionFactoryBuilder</strong></p> <p>è¿™ä¸ªç±»å¯ä»¥è¢«å®ä¾‹åŒ–ã€ä½¿ç”¨å’Œä¸¢å¼ƒï¼Œä¸€æ—¦åˆ›å»ºäº† SqlSessionFactoryï¼Œå°±ä¸å†éœ€è¦å®ƒäº†ã€‚ å› æ­¤ SqlSessionFactoryBuilder å®ä¾‹çš„æœ€ä½³ä½œç”¨åŸŸæ˜¯æ–¹æ³•ä½œç”¨åŸŸï¼ˆä¹Ÿå°±æ˜¯å±€éƒ¨æ–¹æ³•å˜é‡ï¼‰ã€‚ ä½ å¯ä»¥é‡ç”¨ SqlSessionFactoryBuilder æ¥åˆ›å»ºå¤šä¸ª SqlSessionFactory å®ä¾‹ï¼Œä½†æœ€å¥½è¿˜æ˜¯ä¸è¦ä¸€ç›´ä¿ç•™ç€å®ƒï¼Œä»¥ä¿è¯æ‰€æœ‰çš„ XML è§£æèµ„æºå¯ä»¥è¢«é‡Šæ”¾ç»™æ›´é‡è¦çš„äº‹æƒ…ã€‚</p> <p><strong>SqlSessionFactory</strong></p> <p>SqlSessionFactory ä¸€æ—¦è¢«åˆ›å»ºå°±åº”è¯¥åœ¨åº”ç”¨çš„è¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œæ²¡æœ‰ä»»ä½•ç†ç”±ä¸¢å¼ƒå®ƒæˆ–é‡æ–°åˆ›å»ºå¦ä¸€ä¸ªå®ä¾‹ã€‚ ä½¿ç”¨ SqlSessionFactory çš„æœ€ä½³å®è·µæ˜¯åœ¨åº”ç”¨è¿è¡ŒæœŸé—´ä¸è¦é‡å¤åˆ›å»ºå¤šæ¬¡ï¼Œå¤šæ¬¡é‡å»º SqlSessionFactory è¢«è§†ä¸ºä¸€ç§ä»£ç â€œåä¹ æƒ¯â€ã€‚å› æ­¤ SqlSessionFactory çš„æœ€ä½³ä½œç”¨åŸŸæ˜¯åº”ç”¨ä½œç”¨åŸŸã€‚ æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥åšåˆ°ï¼Œæœ€ç®€å•çš„å°±æ˜¯ä½¿ç”¨å•ä¾‹æ¨¡å¼æˆ–è€…é™æ€å•ä¾‹æ¨¡å¼ã€‚</p> <p><strong>SqlSession</strong></p> <p>æ¯ä¸ªçº¿ç¨‹éƒ½åº”è¯¥æœ‰å®ƒè‡ªå·±çš„ SqlSession å®ä¾‹ã€‚SqlSession çš„å®ä¾‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤æ˜¯ä¸èƒ½è¢«å…±äº«çš„ï¼Œæ‰€ä»¥å®ƒçš„æœ€ä½³çš„ä½œç”¨åŸŸæ˜¯è¯·æ±‚æˆ–æ–¹æ³•ä½œç”¨åŸŸã€‚ ç»å¯¹ä¸èƒ½å°† SqlSession å®ä¾‹çš„å¼•ç”¨æ”¾åœ¨ä¸€ä¸ªç±»çš„é™æ€åŸŸï¼Œç”šè‡³ä¸€ä¸ªç±»çš„å®ä¾‹å˜é‡ä¹Ÿä¸è¡Œã€‚ ä¹Ÿç»ä¸èƒ½å°† SqlSession å®ä¾‹çš„å¼•ç”¨æ”¾åœ¨ä»»ä½•ç±»å‹çš„æ‰˜ç®¡ä½œç”¨åŸŸä¸­ï¼Œæ¯”å¦‚ Servlet æ¡†æ¶ä¸­çš„ HttpSessionã€‚ å¦‚æœä½ ç°åœ¨æ­£åœ¨ä½¿ç”¨ä¸€ç§ Web æ¡†æ¶ï¼Œè€ƒè™‘å°† SqlSession æ”¾åœ¨ä¸€ä¸ªå’Œ HTTP è¯·æ±‚ç›¸ä¼¼çš„ä½œç”¨åŸŸä¸­ã€‚ æ¢å¥è¯è¯´ï¼Œæ¯æ¬¡æ”¶åˆ° HTTP è¯·æ±‚ï¼Œå°±å¯ä»¥æ‰“å¼€ä¸€ä¸ª SqlSessionï¼Œè¿”å›ä¸€ä¸ªå“åº”åï¼Œå°±å…³é—­å®ƒã€‚ è¿™ä¸ªå…³é—­æ“ä½œå¾ˆé‡è¦ï¼Œä¸ºäº†ç¡®ä¿æ¯æ¬¡éƒ½èƒ½æ‰§è¡Œå…³é—­æ“ä½œï¼Œä½ åº”è¯¥æŠŠè¿™ä¸ªå…³é—­æ“ä½œæ”¾åˆ° finally å—ä¸­ã€‚ ä¸‹é¢çš„ç¤ºä¾‹å°±æ˜¯ä¸€ä¸ªç¡®ä¿ SqlSession å…³é—­çš„æ ‡å‡†æ¨¡å¼ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">SqlSession</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqlSessionFactory</span><span class="p">.</span><span class="na">openSession</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="c1">// ä½ çš„åº”ç”¨é€»è¾‘ä»£ç </span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="p">}</span>
</span></code></pre></div> <p>åœ¨æ‰€æœ‰ä»£ç ä¸­éƒ½éµå¾ªè¿™ç§ä½¿ç”¨æ¨¡å¼ï¼Œå¯ä»¥ä¿è¯æ‰€æœ‰æ•°æ®åº“èµ„æºéƒ½èƒ½è¢«æ­£ç¡®åœ°å…³é—­ã€‚</p> <p><strong>æ˜ å°„å™¨å®ä¾‹</strong></p> <p>æ˜ å°„å™¨æ˜¯ä¸€äº›ç»‘å®šæ˜ å°„è¯­å¥çš„æ¥å£ã€‚æ˜ å°„å™¨æ¥å£çš„å®ä¾‹æ˜¯ä» SqlSession ä¸­è·å¾—çš„ã€‚è™½ç„¶ä»æŠ€æœ¯å±‚é¢ä¸Šæ¥è®²ï¼Œä»»ä½•æ˜ å°„å™¨å®ä¾‹çš„æœ€å¤§ä½œç”¨åŸŸä¸è¯·æ±‚å®ƒä»¬çš„ SqlSession ç›¸åŒã€‚ä½†æ–¹æ³•ä½œç”¨åŸŸæ‰æ˜¯æ˜ å°„å™¨å®ä¾‹çš„æœ€åˆé€‚çš„ä½œç”¨åŸŸã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜ å°„å™¨å®ä¾‹åº”è¯¥åœ¨è°ƒç”¨å®ƒä»¬çš„æ–¹æ³•ä¸­è¢«è·å–ï¼Œä½¿ç”¨å®Œæ¯•ä¹‹åå³å¯ä¸¢å¼ƒã€‚ æ˜ å°„å™¨å®ä¾‹å¹¶ä¸éœ€è¦è¢«æ˜¾å¼åœ°å…³é—­ã€‚å°½ç®¡åœ¨æ•´ä¸ªè¯·æ±‚ä½œç”¨åŸŸä¿ç•™æ˜ å°„å™¨å®ä¾‹ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ä½ å¾ˆå¿«ä¼šå‘ç°ï¼Œåœ¨è¿™ä¸ªä½œç”¨åŸŸä¸Šç®¡ç†å¤ªå¤šåƒ SqlSession çš„èµ„æºä¼šè®©ä½ å¿™ä¸è¿‡æ¥ã€‚ å› æ­¤ï¼Œæœ€å¥½å°†æ˜ å°„å™¨æ”¾åœ¨æ–¹æ³•ä½œç”¨åŸŸå†…ã€‚å°±åƒä¸‹é¢çš„ä¾‹å­ä¸€æ ·ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">SqlSession</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqlSessionFactory</span><span class="p">.</span><span class="na">openSession</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="n">BlogMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">getMapper</span><span class="p">(</span><span class="n">BlogMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="c1">// ä½ çš„åº”ç”¨é€»è¾‘ä»£ç </span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="p">}</span>
</span></code></pre></div> <h2 id="2xmlé…ç½®">2ã€XMLé…ç½®<a class="headerlink" href="#2xmlé…ç½®" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>MyBatis çš„é…ç½®æ–‡ä»¶åŒ…å«äº†ä¼šæ·±æ·±å½±å“ MyBatis è¡Œä¸ºçš„è®¾ç½®å’Œå±æ€§ä¿¡æ¯ã€‚ é…ç½®æ–‡æ¡£çš„é¡¶å±‚ç»“æ„å¦‚ä¸‹ï¼š</p> <ul> <li>configurationï¼ˆé…ç½®ï¼‰<ul> <li>propertiesï¼ˆå±æ€§ï¼‰</li> <li>settingsï¼ˆè®¾ç½®ï¼‰</li> <li>typeAliasesï¼ˆç±»å‹åˆ«åï¼‰</li> <li>typeHandlersï¼ˆç±»å‹å¤„ç†å™¨ï¼‰</li> <li>objectFactoryï¼ˆå¯¹è±¡å·¥å‚ï¼‰</li> <li>pluginsï¼ˆæ’ä»¶ï¼‰</li> <li>environmentsï¼ˆç¯å¢ƒé…ç½®ï¼‰<ul> <li>environmentï¼ˆç¯å¢ƒå˜é‡ï¼‰<ul> <li>transactionManagerï¼ˆäº‹åŠ¡ç®¡ç†å™¨ï¼‰</li> <li>dataSourceï¼ˆæ•°æ®æºï¼‰</li> </ul> </li> </ul> </li> <li>databaseIdProviderï¼ˆæ•°æ®åº“å‚å•†æ ‡è¯†ï¼‰</li> <li>mappersï¼ˆæ˜ å°„å™¨ï¼‰</li> </ul> </li> </ul> <h3 id="21å±æ€§properties">2.1ã€å±æ€§ï¼ˆpropertiesï¼‰<a class="headerlink" href="#21å±æ€§properties" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>è¿™äº›å±æ€§å¯ä»¥åœ¨å¤–éƒ¨è¿›è¡Œé…ç½®ï¼Œå¹¶å¯ä»¥è¿›è¡ŒåŠ¨æ€æ›¿æ¢ã€‚ä½ æ—¢å¯ä»¥åœ¨å…¸å‹çš„ Java å±æ€§æ–‡ä»¶ä¸­é…ç½®è¿™äº›å±æ€§ï¼Œä¹Ÿå¯ä»¥åœ¨ properties å…ƒç´ çš„å­å…ƒç´ ä¸­è®¾ç½®ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nt">&lt;properties</span><span class="w"> </span><span class="na">resource=</span><span class="s">"org/mybatis/example/config.properties"</span><span class="nt">&gt;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"username"</span><span class="w"> </span><span class="na">value=</span><span class="s">"dev_user"</span><span class="nt">/&gt;</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"password"</span><span class="w"> </span><span class="na">value=</span><span class="s">"F2Fa3!33TYyg"</span><span class="nt">/&gt;</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="nt">&lt;/properties&gt;</span>
</span></code></pre></div> <p>è®¾ç½®å¥½çš„å±æ€§å¯ä»¥åœ¨æ•´ä¸ªé…ç½®æ–‡ä»¶ä¸­ç”¨æ¥æ›¿æ¢éœ€è¦åŠ¨æ€é…ç½®çš„å±æ€§å€¼ã€‚æ¯”å¦‚:</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nt">&lt;dataSource</span><span class="w"> </span><span class="na">type=</span><span class="s">"POOLED"</span><span class="nt">&gt;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"driver"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${driver}"</span><span class="nt">/&gt;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"url"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${url}"</span><span class="nt">/&gt;</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"username"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${username}"</span><span class="nt">/&gt;</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"password"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${password}"</span><span class="nt">/&gt;</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="nt">&lt;/dataSource&gt;</span>
</span></code></pre></div> <p>è¿™ä¸ªä¾‹å­ä¸­çš„ username å’Œ password å°†ä¼šç”± properties å…ƒç´ ä¸­è®¾ç½®çš„ç›¸åº”å€¼æ¥æ›¿æ¢ã€‚ driver å’Œ url å±æ€§å°†ä¼šç”± config.properties æ–‡ä»¶ä¸­å¯¹åº”çš„å€¼æ¥æ›¿æ¢ã€‚è¿™æ ·å°±ä¸ºé…ç½®æä¾›äº†è¯¸å¤šçµæ´»é€‰æ‹©ã€‚ä¹Ÿå¯ä»¥åœ¨ SqlSessionFactoryBuilder.build() æ–¹æ³•ä¸­ä¼ å…¥å±æ€§å€¼ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBuilder</span><span class="p">().</span><span class="na">build</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">props</span><span class="p">);</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c1">// ... æˆ–è€… ...</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBuilder</span><span class="p">().</span><span class="na">build</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">props</span><span class="p">);</span>
</span></code></pre></div> <p>å¦‚æœä¸€ä¸ªå±æ€§åœ¨ä¸åªä¸€ä¸ªåœ°æ–¹è¿›è¡Œäº†é…ç½®ï¼Œé‚£ä¹ˆï¼ŒMyBatis å°†æŒ‰ç…§ä¸‹é¢çš„é¡ºåºæ¥åŠ è½½ï¼š</p> <ul> <li>é¦–å…ˆè¯»å–åœ¨ properties å…ƒç´ ä½“å†…æŒ‡å®šçš„å±æ€§ã€‚</li> <li>ç„¶åæ ¹æ® properties å…ƒç´ ä¸­çš„ resource å±æ€§è¯»å–ç±»è·¯å¾„ä¸‹å±æ€§æ–‡ä»¶ï¼Œæˆ–æ ¹æ® url å±æ€§æŒ‡å®šçš„è·¯å¾„è¯»å–å±æ€§æ–‡ä»¶ï¼Œå¹¶è¦†ç›–ä¹‹å‰è¯»å–è¿‡çš„åŒåå±æ€§ã€‚</li> <li>æœ€åè¯»å–ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’çš„å±æ€§ï¼Œå¹¶è¦†ç›–ä¹‹å‰è¯»å–è¿‡çš„åŒåå±æ€§ã€‚</li> </ul> <p>å› æ­¤ï¼Œé€šè¿‡æ–¹æ³•å‚æ•°ä¼ é€’çš„å±æ€§å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ï¼Œresource/url å±æ€§ä¸­æŒ‡å®šçš„é…ç½®æ–‡ä»¶æ¬¡ä¹‹ï¼Œæœ€ä½ä¼˜å…ˆçº§çš„åˆ™æ˜¯ properties å…ƒç´ ä¸­æŒ‡å®šçš„å±æ€§ã€‚</p> <p>ä» MyBatis 3.4.2 å¼€å§‹ï¼Œä½ å¯ä»¥ä¸ºå ä½ç¬¦æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nt">&lt;dataSource</span><span class="w"> </span><span class="na">type=</span><span class="s">"POOLED"</span><span class="nt">&gt;</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"username"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${username:ut_user}"</span><span class="nt">/&gt;</span><span class="w"> </span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">  </span><span class="cm">&lt;!-- å¦‚æœå±æ€§ 'username' æ²¡æœ‰è¢«é…ç½®ï¼Œ'username' å±æ€§çš„å€¼å°†ä¸º 'ut_user' --&gt;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="nt">&lt;/dataSource&gt;</span>
</span></code></pre></div> <p>è¿™ä¸ªç‰¹æ€§é»˜è®¤æ˜¯å…³é—­çš„ã€‚è¦å¯ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªç‰¹å®šçš„å±æ€§æ¥å¼€å¯è¿™ä¸ªç‰¹æ€§ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nt">&lt;properties</span><span class="w"> </span><span class="na">resource=</span><span class="s">"org/mybatis/example/config.properties"</span><span class="nt">&gt;</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"org.apache.ibatis.parsing.PropertyParser.enable-default-value"</span><span class="w"> </span><span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span><span class="w"> </span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span><span class="cm">&lt;!-- å¯ç”¨é»˜è®¤å€¼ç‰¹æ€§ --&gt;</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="nt">&lt;/properties&gt;</span>
</span></code></pre></div> <p>å¦‚æœä½ åœ¨å±æ€§åä¸­ä½¿ç”¨äº† <code>:</code> å­—ç¬¦ï¼ˆå¦‚ï¼š<code>db:username</code>ï¼‰ï¼Œæˆ–è€…åœ¨ SQL æ˜ å°„ä¸­ä½¿ç”¨äº† OGNL è¡¨è¾¾å¼çš„ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆå¦‚ï¼š <code>${tableName != null ? tableName : 'global_constants'}</code>ï¼‰ï¼Œå°±éœ€è¦è®¾ç½®ç‰¹å®šçš„å±æ€§æ¥ä¿®æ”¹åˆ†éš”å±æ€§åå’Œé»˜è®¤å€¼çš„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nt">&lt;properties</span><span class="w"> </span><span class="na">resource=</span><span class="s">"org/mybatis/example/config.properties"</span><span class="nt">&gt;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"org.apache.ibatis.parsing.PropertyParser.default-value-separator"</span><span class="w"> </span><span class="na">value=</span><span class="s">"?:"</span><span class="nt">/&gt;</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="cm">&lt;!-- ä¿®æ”¹é»˜è®¤å€¼çš„åˆ†éš”ç¬¦ --&gt;</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="nt">&lt;/properties&gt;</span>
</span></code></pre></div> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nt">&lt;dataSource</span><span class="w"> </span><span class="na">type=</span><span class="s">"POOLED"</span><span class="nt">&gt;</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"username"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${db:username?:ut_user}"</span><span class="nt">/&gt;</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="nt">&lt;/dataSource&gt;</span>
</span></code></pre></div> <h3 id="22è®¾ç½®settings">2.2ã€è®¾ç½®ï¼ˆsettingsï¼‰<a class="headerlink" href="#22è®¾ç½®settings" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>è¿™æ˜¯ MyBatis ä¸­æä¸ºé‡è¦çš„è°ƒæ•´è®¾ç½®ï¼Œå®ƒä»¬ä¼šæ”¹å˜ MyBatis çš„è¿è¡Œæ—¶è¡Œä¸ºã€‚ ä¸‹è¡¨æè¿°äº†è®¾ç½®ä¸­å„é¡¹è®¾ç½®çš„å«ä¹‰ã€é»˜è®¤å€¼ç­‰ã€‚</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Mybatis/20200605012013.png" data-desc-position="bottom"><img src="!assets/Mybatis/20200605012013.png" alt="20200605012013" style></a></p> <p>ä¸€ä¸ªé…ç½®å®Œæ•´çš„ settings å…ƒç´ çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nt">&lt;settings&gt;</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"cacheEnabled"</span><span class="w"> </span><span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"lazyLoadingEnabled"</span><span class="w"> </span><span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"multipleResultSetsEnabled"</span><span class="w"> </span><span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"useColumnLabel"</span><span class="w"> </span><span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"useGeneratedKeys"</span><span class="w"> </span><span class="na">value=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"autoMappingBehavior"</span><span class="w"> </span><span class="na">value=</span><span class="s">"PARTIAL"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"autoMappingUnknownColumnBehavior"</span><span class="w"> </span><span class="na">value=</span><span class="s">"WARNING"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"defaultExecutorType"</span><span class="w"> </span><span class="na">value=</span><span class="s">"SIMPLE"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"defaultStatementTimeout"</span><span class="w"> </span><span class="na">value=</span><span class="s">"25"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"defaultFetchSize"</span><span class="w"> </span><span class="na">value=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"safeRowBoundsEnabled"</span><span class="w"> </span><span class="na">value=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"mapUnderscoreToCamelCase"</span><span class="w"> </span><span class="na">value=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"localCacheScope"</span><span class="w"> </span><span class="na">value=</span><span class="s">"SESSION"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"jdbcTypeForNull"</span><span class="w"> </span><span class="na">value=</span><span class="s">"OTHER"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">  </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"lazyLoadTriggerMethods"</span><span class="w"> </span><span class="na">value=</span><span class="s">"equals,clone,hashCode,toString"</span><span class="nt">/&gt;</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="nt">&lt;/settings&gt;</span>
</span></code></pre></div> <h3 id="23ç±»å‹åˆ«åtypealiases">2.3ã€ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰<a class="headerlink" href="#23ç±»å‹åˆ«åtypealiases" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ç±»å‹åˆ«åå¯ä¸º Java ç±»å‹è®¾ç½®ä¸€ä¸ªç¼©å†™åå­—ã€‚ å®ƒä»…ç”¨äº XML é…ç½®ï¼Œæ„åœ¨é™ä½å†—ä½™çš„å…¨é™å®šç±»åä¹¦å†™ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nt">&lt;typeAliases&gt;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">  </span><span class="nt">&lt;typeAlias</span><span class="w"> </span><span class="na">alias=</span><span class="s">"Author"</span><span class="w"> </span><span class="na">type=</span><span class="s">"domain.blog.Author"</span><span class="nt">/&gt;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">  </span><span class="nt">&lt;typeAlias</span><span class="w"> </span><span class="na">alias=</span><span class="s">"Blog"</span><span class="w"> </span><span class="na">type=</span><span class="s">"domain.blog.Blog"</span><span class="nt">/&gt;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">  </span><span class="nt">&lt;typeAlias</span><span class="w"> </span><span class="na">alias=</span><span class="s">"Comment"</span><span class="w"> </span><span class="na">type=</span><span class="s">"domain.blog.Comment"</span><span class="nt">/&gt;</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">  </span><span class="nt">&lt;typeAlias</span><span class="w"> </span><span class="na">alias=</span><span class="s">"Post"</span><span class="w"> </span><span class="na">type=</span><span class="s">"domain.blog.Post"</span><span class="nt">/&gt;</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">  </span><span class="nt">&lt;typeAlias</span><span class="w"> </span><span class="na">alias=</span><span class="s">"Section"</span><span class="w"> </span><span class="na">type=</span><span class="s">"domain.blog.Section"</span><span class="nt">/&gt;</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">  </span><span class="nt">&lt;typeAlias</span><span class="w"> </span><span class="na">alias=</span><span class="s">"Tag"</span><span class="w"> </span><span class="na">type=</span><span class="s">"domain.blog.Tag"</span><span class="nt">/&gt;</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="nt">&lt;/typeAliases&gt;</span>
</span></code></pre></div> <p>å½“è¿™æ ·é…ç½®æ—¶ï¼Œ<code>Blog</code> å¯ä»¥ç”¨åœ¨ä»»ä½•ä½¿ç”¨ <code>domain.blog.Blog</code> çš„åœ°æ–¹ã€‚</p> <p>ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªåŒ…åï¼ŒMyBatis ä¼šåœ¨åŒ…åä¸‹é¢æœç´¢éœ€è¦çš„ Java Beanï¼Œæ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nt">&lt;typeAliases&gt;</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">  </span><span class="nt">&lt;package</span><span class="w"> </span><span class="na">name=</span><span class="s">"domain.blog"</span><span class="nt">/&gt;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="nt">&lt;/typeAliases&gt;</span>
</span></code></pre></div> <p>æ¯ä¸€ä¸ªåœ¨åŒ… <code>domain.blog</code> ä¸­çš„ Java Beanï¼Œåœ¨æ²¡æœ‰æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ Bean çš„é¦–å­—æ¯å°å†™çš„éé™å®šç±»åæ¥ä½œä¸ºå®ƒçš„åˆ«åã€‚ æ¯”å¦‚ <code>domain.blog.Author</code> çš„åˆ«åä¸º <code>author</code>ï¼›è‹¥æœ‰æ³¨è§£ï¼Œåˆ™åˆ«åä¸ºå…¶æ³¨è§£å€¼ã€‚è§ä¸‹é¢çš„ä¾‹å­ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nd">@Alias</span><span class="p">(</span><span class="s">"author"</span><span class="p">)</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Author</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="p">...</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸‹é¢æ˜¯ä¸€äº›ä¸ºå¸¸è§çš„ Java ç±»å‹å†…å»ºçš„ç±»å‹åˆ«åã€‚å®ƒä»¬éƒ½æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œæ³¨æ„ï¼Œä¸ºäº†åº”å¯¹åŸå§‹ç±»å‹çš„å‘½åé‡å¤ï¼Œé‡‡å–äº†ç‰¹æ®Šçš„å‘½åé£æ ¼ã€‚</p> <table> <thead> <tr> <th style="text-align: center;">åˆ«å</th> <th style="text-align: center;">æ˜ å°„çš„ç±»å‹</th> </tr> </thead> <tbody> <tr> <td style="text-align: center;">_byte</td> <td style="text-align: center;">byte</td> </tr> <tr> <td style="text-align: center;">_long</td> <td style="text-align: center;">long</td> </tr> <tr> <td style="text-align: center;">_short</td> <td style="text-align: center;">short</td> </tr> <tr> <td style="text-align: center;">_int</td> <td style="text-align: center;">int</td> </tr> <tr> <td style="text-align: center;">_integer</td> <td style="text-align: center;">int</td> </tr> <tr> <td style="text-align: center;">_double</td> <td style="text-align: center;">double</td> </tr> <tr> <td style="text-align: center;">_float</td> <td style="text-align: center;">float</td> </tr> <tr> <td style="text-align: center;">_boolean</td> <td style="text-align: center;">boolean</td> </tr> <tr> <td style="text-align: center;">string</td> <td style="text-align: center;">String</td> </tr> <tr> <td style="text-align: center;">byte</td> <td style="text-align: center;">Byte</td> </tr> <tr> <td style="text-align: center;">long</td> <td style="text-align: center;">Long</td> </tr> <tr> <td style="text-align: center;">short</td> <td style="text-align: center;">Short</td> </tr> <tr> <td style="text-align: center;">int</td> <td style="text-align: center;">Integer</td> </tr> <tr> <td style="text-align: center;">integer</td> <td style="text-align: center;">Integer</td> </tr> <tr> <td style="text-align: center;">double</td> <td style="text-align: center;">Double</td> </tr> <tr> <td style="text-align: center;">float</td> <td style="text-align: center;">Float</td> </tr> <tr> <td style="text-align: center;">boolean</td> <td style="text-align: center;">Boolean</td> </tr> <tr> <td style="text-align: center;">date</td> <td style="text-align: center;">Date</td> </tr> <tr> <td style="text-align: center;">decimal</td> <td style="text-align: center;">BigDecimal</td> </tr> <tr> <td style="text-align: center;">bigdecimal</td> <td style="text-align: center;">BigDecimal</td> </tr> <tr> <td style="text-align: center;">object</td> <td style="text-align: center;">Object</td> </tr> <tr> <td style="text-align: center;">map</td> <td style="text-align: center;">Map</td> </tr> <tr> <td style="text-align: center;">hashmap</td> <td style="text-align: center;">HashMap</td> </tr> <tr> <td style="text-align: center;">list</td> <td style="text-align: center;">List</td> </tr> <tr> <td style="text-align: center;">arraylist</td> <td style="text-align: center;">ArrayList</td> </tr> <tr> <td style="text-align: center;">collection</td> <td style="text-align: center;">Collection</td> </tr> <tr> <td style="text-align: center;">iterator</td> <td style="text-align: center;">Iterator</td> </tr> </tbody> </table> <h3 id="24ç¯å¢ƒé…ç½®environments">2.4ã€ç¯å¢ƒé…ç½®ï¼ˆenvironmentsï¼‰<a class="headerlink" href="#24ç¯å¢ƒé…ç½®environments" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>MyBatis å¯ä»¥é…ç½®æˆé€‚åº”å¤šç§ç¯å¢ƒï¼Œè¿™ç§æœºåˆ¶æœ‰åŠ©äºå°† SQL æ˜ å°„åº”ç”¨äºå¤šç§æ•°æ®åº“ä¹‹ä¸­ï¼Œ ç°å®æƒ…å†µä¸‹æœ‰å¤šç§ç†ç”±éœ€è¦è¿™ä¹ˆåšã€‚ä¾‹å¦‚ï¼Œå¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒéœ€è¦æœ‰ä¸åŒçš„é…ç½®ï¼›æˆ–è€…æƒ³åœ¨å…·æœ‰ç›¸åŒ Schema çš„å¤šä¸ªç”Ÿäº§æ•°æ®åº“ä¸­ä½¿ç”¨ç›¸åŒçš„ SQL æ˜ å°„ã€‚è¿˜æœ‰è®¸å¤šç±»ä¼¼çš„ä½¿ç”¨åœºæ™¯ã€‚</p> <p><mark>ä¸è¿‡è¦è®°ä½ï¼šå°½ç®¡å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒï¼Œä½†æ¯ä¸ª SqlSessionFactory å®ä¾‹åªèƒ½é€‰æ‹©ä¸€ç§ç¯å¢ƒã€‚</mark></p> <p>æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³è¿æ¥ä¸¤ä¸ªæ•°æ®åº“ï¼Œå°±éœ€è¦åˆ›å»ºä¸¤ä¸ª SqlSessionFactory å®ä¾‹ï¼Œæ¯ä¸ªæ•°æ®åº“å¯¹åº”ä¸€ä¸ªã€‚è€Œå¦‚æœæ˜¯ä¸‰ä¸ªæ•°æ®åº“ï¼Œå°±éœ€è¦ä¸‰ä¸ªå®ä¾‹ï¼Œä¾æ­¤ç±»æ¨ï¼Œè®°èµ·æ¥å¾ˆç®€å•ï¼š<strong>æ¯ä¸ªæ•°æ®åº“å¯¹åº”ä¸€ä¸ª SqlSessionFactory å®ä¾‹</strong></p> <p>ä¸ºäº†æŒ‡å®šåˆ›å»ºå“ªç§ç¯å¢ƒï¼Œåªè¦å°†å®ƒä½œä¸ºå¯é€‰çš„å‚æ•°ä¼ é€’ç»™ SqlSessionFactoryBuilder å³å¯ã€‚å¯ä»¥æ¥å—ç¯å¢ƒé…ç½®çš„ä¸¤ä¸ªæ–¹æ³•ç­¾åæ˜¯ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBuilder</span><span class="p">().</span><span class="na">build</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">);</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBuilder</span><span class="p">().</span><span class="na">build</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">);</span>
</span></code></pre></div> <p>å¦‚æœå¿½ç•¥äº†ç¯å¢ƒå‚æ•°ï¼Œé‚£ä¹ˆå°†ä¼šåŠ è½½é»˜è®¤ç¯å¢ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBuilder</span><span class="p">().</span><span class="na">build</span><span class="p">(</span><span class="n">reader</span><span class="p">);</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBuilder</span><span class="p">().</span><span class="na">build</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">);</span>
</span></code></pre></div> <p>environments å…ƒç´ å®šä¹‰äº†å¦‚ä½•é…ç½®ç¯å¢ƒã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nt">&lt;environments</span><span class="w"> </span><span class="na">default=</span><span class="s">"development"</span><span class="nt">&gt;</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="nt">&lt;environment</span><span class="w"> </span><span class="na">id=</span><span class="s">"development"</span><span class="nt">&gt;</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="nt">&lt;transactionManager</span><span class="w"> </span><span class="na">type=</span><span class="s">"JDBC"</span><span class="nt">&gt;</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">      </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"..."</span><span class="w"> </span><span class="na">value=</span><span class="s">"..."</span><span class="nt">/&gt;</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="nt">&lt;/transactionManager&gt;</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">    </span><span class="nt">&lt;dataSource</span><span class="w"> </span><span class="na">type=</span><span class="s">"POOLED"</span><span class="nt">&gt;</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">      </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"driver"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${driver}"</span><span class="nt">/&gt;</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">      </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"url"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${url}"</span><span class="nt">/&gt;</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">      </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"username"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${username}"</span><span class="nt">/&gt;</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">      </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"password"</span><span class="w"> </span><span class="na">value=</span><span class="s">"${password}"</span><span class="nt">/&gt;</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">    </span><span class="nt">&lt;/dataSource&gt;</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">  </span><span class="nt">&lt;/environment&gt;</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="nt">&lt;/environments&gt;</span>
</span></code></pre></div> <p>æ³¨æ„ä¸€äº›å…³é”®ç‚¹:</p> <ul> <li>é»˜è®¤ä½¿ç”¨çš„ç¯å¢ƒ IDï¼ˆæ¯”å¦‚ï¼šdefault="development"ï¼‰ã€‚</li> <li>æ¯ä¸ª environment å…ƒç´ å®šä¹‰çš„ç¯å¢ƒ IDï¼ˆæ¯”å¦‚ï¼šid="development"ï¼‰ã€‚</li> <li>äº‹åŠ¡ç®¡ç†å™¨çš„é…ç½®ï¼ˆæ¯”å¦‚ï¼štype="JDBC"ï¼‰ã€‚</li> <li>æ•°æ®æºçš„é…ç½®ï¼ˆæ¯”å¦‚ï¼štype="POOLED"ï¼‰ã€‚</li> </ul> <p>é»˜è®¤ç¯å¢ƒå’Œç¯å¢ƒ ID é¡¾åæ€ä¹‰ã€‚ ç¯å¢ƒå¯ä»¥éšæ„å‘½åï¼Œä½†åŠ¡å¿…ä¿è¯é»˜è®¤çš„ç¯å¢ƒ ID è¦åŒ¹é…å…¶ä¸­ä¸€ä¸ªç¯å¢ƒ IDã€‚</p> <p><strong>äº‹åŠ¡ç®¡ç†å™¨ï¼ˆtransactionManagerï¼‰</strong></p> <p>åœ¨ MyBatis ä¸­æœ‰ä¸¤ç§ç±»å‹çš„äº‹åŠ¡ç®¡ç†å™¨ï¼ˆä¹Ÿå°±æ˜¯ type="[JDBC|MANAGED]"ï¼‰ï¼š</p> <ul> <li> <p>JDBC â€“ è¿™ä¸ªé…ç½®ç›´æ¥ä½¿ç”¨äº† JDBC çš„æäº¤å’Œå›æ»šè®¾æ–½ï¼Œå®ƒä¾èµ–ä»æ•°æ®æºè·å¾—çš„è¿æ¥æ¥ç®¡ç†äº‹åŠ¡ä½œç”¨åŸŸã€‚</p> </li> <li> <p>MANAGED â€“ è¿™ä¸ªé…ç½®å‡ ä¹æ²¡åšä»€ä¹ˆã€‚å®ƒä»ä¸æäº¤æˆ–å›æ»šä¸€ä¸ªè¿æ¥ï¼Œè€Œæ˜¯è®©å®¹å™¨æ¥ç®¡ç†äº‹åŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ˆæ¯”å¦‚ JEE åº”ç”¨æœåŠ¡å™¨çš„ä¸Šä¸‹æ–‡ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹å®ƒä¼šå…³é—­è¿æ¥ã€‚ç„¶è€Œä¸€äº›å®¹å™¨å¹¶ä¸å¸Œæœ›è¿æ¥è¢«å…³é—­ï¼Œå› æ­¤éœ€è¦å°† closeConnection å±æ€§è®¾ç½®ä¸º false æ¥é˜»æ­¢é»˜è®¤çš„å…³é—­è¡Œä¸ºã€‚ä¾‹å¦‚:</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nt">&lt;transactionManager</span><span class="w"> </span><span class="na">type=</span><span class="s">"MANAGED"</span><span class="nt">&gt;</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"closeConnection"</span><span class="w"> </span><span class="na">value=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="nt">&lt;/transactionManager&gt;</span>
</span></code></pre></div> </li> </ul> <p><strong>æç¤º</strong> å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Spring + MyBatisï¼Œåˆ™æ²¡æœ‰å¿…è¦é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼Œå› ä¸º Spring æ¨¡å—ä¼šä½¿ç”¨è‡ªå¸¦çš„ç®¡ç†å™¨æ¥è¦†ç›–å‰é¢çš„é…ç½®ã€‚</p> <p>è¿™ä¸¤ç§äº‹åŠ¡ç®¡ç†å™¨ç±»å‹éƒ½ä¸éœ€è¦è®¾ç½®ä»»ä½•å±æ€§ã€‚å®ƒä»¬å…¶å®æ˜¯ç±»å‹åˆ«åï¼Œæ¢å¥è¯è¯´ï¼Œä½ å¯ä»¥ç”¨ TransactionFactory æ¥å£å®ç°ç±»çš„å…¨é™å®šåæˆ–ç±»å‹åˆ«åä»£æ›¿å®ƒä»¬ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TransactionFactory</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setProperties</span><span class="p">(</span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// ä» 3.5.2 å¼€å§‹ï¼Œè¯¥æ–¹æ³•ä¸ºé»˜è®¤æ–¹æ³•</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="c1">// ç©ºå®ç°</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">  </span><span class="n">Transaction</span><span class="w"> </span><span class="nf">newTransaction</span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="p">);</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">  </span><span class="n">Transaction</span><span class="w"> </span><span class="nf">newTransaction</span><span class="p">(</span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">TransactionIsolationLevel</span><span class="w"> </span><span class="n">level</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">autoCommit</span><span class="p">);</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="p">}</span>
</span></code></pre></div> <p>åœ¨äº‹åŠ¡ç®¡ç†å™¨å®ä¾‹åŒ–åï¼Œæ‰€æœ‰åœ¨ XML ä¸­é…ç½®çš„å±æ€§å°†ä¼šè¢«ä¼ é€’ç»™ setProperties() æ–¹æ³•ã€‚ä½ çš„å®ç°è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª Transaction æ¥å£çš„å®ç°ç±»ï¼Œè¿™ä¸ªæ¥å£ä¹Ÿå¾ˆç®€å•ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Transaction</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">  </span><span class="n">Connection</span><span class="w"> </span><span class="nf">getConnection</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="p">;</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">commit</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="p">;</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">rollback</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="p">;</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="p">;</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">  </span><span class="n">Integer</span><span class="w"> </span><span class="nf">getTimeout</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="p">;</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="p">}</span>
</span></code></pre></div> <p>ä½¿ç”¨è¿™ä¸¤ä¸ªæ¥å£ï¼Œä½ å¯ä»¥å®Œå…¨è‡ªå®šä¹‰ MyBatis å¯¹äº‹åŠ¡çš„å¤„ç†ã€‚</p> <p><strong>æ•°æ®æºï¼ˆdataSourceï¼‰</strong></p> <p>dataSource å…ƒç´ ä½¿ç”¨æ ‡å‡†çš„ JDBC æ•°æ®æºæ¥å£æ¥é…ç½® JDBC è¿æ¥å¯¹è±¡çš„èµ„æºã€‚å¤§å¤šæ•° MyBatis åº”ç”¨ç¨‹åºä¼šæŒ‰ç¤ºä¾‹ä¸­çš„ä¾‹å­æ¥é…ç½®æ•°æ®æºã€‚è™½ç„¶æ•°æ®æºé…ç½®æ˜¯å¯é€‰çš„ï¼Œä½†å¦‚æœè¦å¯ç”¨å»¶è¿ŸåŠ è½½ç‰¹æ€§ï¼Œå°±å¿…é¡»é…ç½®æ•°æ®æºã€‚</p> <p>æœ‰ä¸‰ç§å†…å»ºçš„æ•°æ®æºç±»å‹ï¼ˆä¹Ÿå°±æ˜¯ type="[UNPOOLED|POOLED|JNDI]"ï¼‰ï¼š</p> <ol> <li> <p><strong>UNPOOLED</strong>â€“ è¿™ä¸ªæ•°æ®æºçš„å®ç°ä¼šæ¯æ¬¡è¯·æ±‚æ—¶æ‰“å¼€å’Œå…³é—­è¿æ¥ã€‚è™½ç„¶æœ‰ç‚¹æ…¢ï¼Œä½†å¯¹é‚£äº›æ•°æ®åº“è¿æ¥å¯ç”¨æ€§è¦æ±‚ä¸é«˜çš„ç®€å•åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ æ€§èƒ½è¡¨ç°åˆ™ä¾èµ–äºä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¯¹æŸäº›æ•°æ®åº“æ¥è¯´ï¼Œä½¿ç”¨è¿æ¥æ± å¹¶ä¸é‡è¦ï¼Œè¿™ä¸ªé…ç½®å°±å¾ˆé€‚åˆè¿™ç§æƒ…å½¢ã€‚UNPOOLED ç±»å‹çš„æ•°æ®æºä»…ä»…éœ€è¦é…ç½®ä»¥ä¸‹ 5 ç§å±æ€§ï¼š</p> <ul> <li><code>driver</code> â€“ è¿™æ˜¯ JDBC é©±åŠ¨çš„ Java ç±»å…¨é™å®šåï¼ˆå¹¶ä¸æ˜¯ JDBC é©±åŠ¨ä¸­å¯èƒ½åŒ…å«çš„æ•°æ®æºç±»ï¼‰ã€‚</li> <li><code>url</code> â€“ è¿™æ˜¯æ•°æ®åº“çš„ JDBC URL åœ°å€ã€‚</li> <li><code>username</code> â€“ ç™»å½•æ•°æ®åº“çš„ç”¨æˆ·åã€‚</li> <li><code>password</code> â€“ ç™»å½•æ•°æ®åº“çš„å¯†ç ã€‚</li> <li><code>defaultTransactionIsolationLevel</code> â€“ é»˜è®¤çš„è¿æ¥äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</li> <li><code>defaultNetworkTimeout</code> â€“ ç­‰å¾…æ•°æ®åº“æ“ä½œå®Œæˆçš„é»˜è®¤ç½‘ç»œè¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ã€‚</li> </ul> <p>ä½œä¸ºå¯é€‰é¡¹ï¼Œä½ ä¹Ÿå¯ä»¥ä¼ é€’å±æ€§ç»™æ•°æ®åº“é©±åŠ¨ã€‚åªéœ€åœ¨å±æ€§ååŠ ä¸Šâ€œdriver.â€å‰ç¼€å³å¯ï¼Œä¾‹å¦‚ï¼š</p> <ul> <li><code>driver.encoding=UTF8</code></li> </ul> <p>è¿™å°†é€šè¿‡ DriverManager.getConnection(url, driverProperties) æ–¹æ³•ä¼ é€’å€¼ä¸º <code>UTF8</code> çš„ <code>encoding</code> å±æ€§ç»™æ•°æ®åº“é©±åŠ¨ã€‚</p> </li> <li> <p><strong>POOLED</strong>â€“ è¿™ç§æ•°æ®æºçš„å®ç°åˆ©ç”¨â€œæ± â€çš„æ¦‚å¿µå°† JDBC è¿æ¥å¯¹è±¡ç»„ç»‡èµ·æ¥ï¼Œé¿å…äº†åˆ›å»ºæ–°çš„è¿æ¥å®ä¾‹æ—¶æ‰€å¿…éœ€çš„åˆå§‹åŒ–å’Œè®¤è¯æ—¶é—´ã€‚ è¿™ç§å¤„ç†æ–¹å¼å¾ˆæµè¡Œï¼Œèƒ½ä½¿å¹¶å‘ Web åº”ç”¨å¿«é€Ÿå“åº”è¯·æ±‚ã€‚</p> <p>é™¤äº†ä¸Šè¿°æåˆ° UNPOOLED ä¸‹çš„å±æ€§å¤–ï¼Œè¿˜æœ‰æ›´å¤šå±æ€§ç”¨æ¥é…ç½® POOLED çš„æ•°æ®æºï¼š</p> <ul> <li><code>poolMaximumActiveConnections</code> â€“ åœ¨ä»»æ„æ—¶é—´å¯å­˜åœ¨çš„æ´»åŠ¨ï¼ˆæ­£åœ¨ä½¿ç”¨ï¼‰è¿æ¥æ•°é‡ï¼Œé»˜è®¤å€¼ï¼š10</li> <li><code>poolMaximumIdleConnections</code> â€“ ä»»æ„æ—¶é—´å¯èƒ½å­˜åœ¨çš„ç©ºé—²è¿æ¥æ•°ã€‚</li> <li><code>poolMaximumCheckoutTime</code> â€“ åœ¨è¢«å¼ºåˆ¶è¿”å›ä¹‹å‰ï¼Œæ± ä¸­è¿æ¥è¢«æ£€å‡ºï¼ˆchecked outï¼‰æ—¶é—´ï¼Œé»˜è®¤å€¼ï¼š20000 æ¯«ç§’ï¼ˆå³ 20 ç§’ï¼‰</li> <li><code>poolTimeToWait</code> â€“ è¿™æ˜¯ä¸€ä¸ªåº•å±‚è®¾ç½®ï¼Œå¦‚æœè·å–è¿æ¥èŠ±è´¹äº†ç›¸å½“é•¿çš„æ—¶é—´ï¼Œè¿æ¥æ± ä¼šæ‰“å°çŠ¶æ€æ—¥å¿—å¹¶é‡æ–°å°è¯•è·å–ä¸€ä¸ªè¿æ¥ï¼ˆé¿å…åœ¨è¯¯é…ç½®çš„æƒ…å†µä¸‹ä¸€ç›´å¤±è´¥ä¸”ä¸æ‰“å°æ—¥å¿—ï¼‰ï¼Œé»˜è®¤å€¼ï¼š20000 æ¯«ç§’ï¼ˆå³ 20 ç§’ï¼‰ã€‚</li> <li><code>poolMaximumLocalBadConnectionTolerance</code> â€“ è¿™æ˜¯ä¸€ä¸ªå…³äºåè¿æ¥å®¹å¿åº¦çš„åº•å±‚è®¾ç½®ï¼Œ ä½œç”¨äºæ¯ä¸€ä¸ªå°è¯•ä»ç¼“å­˜æ± è·å–è¿æ¥çš„çº¿ç¨‹ã€‚ å¦‚æœè¿™ä¸ªçº¿ç¨‹è·å–åˆ°çš„æ˜¯ä¸€ä¸ªåçš„è¿æ¥ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®æºå…è®¸è¿™ä¸ªçº¿ç¨‹å°è¯•é‡æ–°è·å–ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œä½†æ˜¯è¿™ä¸ªé‡æ–°å°è¯•çš„æ¬¡æ•°ä¸åº”è¯¥è¶…è¿‡ <code>poolMaximumIdleConnections</code> ä¸ <code>poolMaximumLocalBadConnectionTolerance</code> ä¹‹å’Œã€‚ é»˜è®¤å€¼ï¼š3ï¼ˆæ–°å¢äº 3.4.5ï¼‰</li> <li><code>poolPingQuery</code> â€“ å‘é€åˆ°æ•°æ®åº“çš„ä¾¦æµ‹æŸ¥è¯¢ï¼Œç”¨æ¥æ£€éªŒè¿æ¥æ˜¯å¦æ­£å¸¸å·¥ä½œå¹¶å‡†å¤‡æ¥å—è¯·æ±‚ã€‚é»˜è®¤æ˜¯â€œNO PING QUERY SETâ€ï¼Œè¿™ä¼šå¯¼è‡´å¤šæ•°æ•°æ®åº“é©±åŠ¨å‡ºé”™æ—¶è¿”å›æ°å½“çš„é”™è¯¯æ¶ˆæ¯ã€‚</li> <li><code>poolPingEnabled</code> â€“ æ˜¯å¦å¯ç”¨ä¾¦æµ‹æŸ¥è¯¢ã€‚è‹¥å¼€å¯ï¼Œéœ€è¦è®¾ç½® <code>poolPingQuery</code> å±æ€§ä¸ºä¸€ä¸ªå¯æ‰§è¡Œçš„ SQL è¯­å¥ï¼ˆæœ€å¥½æ˜¯ä¸€ä¸ªé€Ÿåº¦éå¸¸å¿«çš„ SQL è¯­å¥ï¼‰ï¼Œé»˜è®¤å€¼ï¼šfalseã€‚</li> <li><code>poolPingConnectionsNotUsedFor</code> â€“ é…ç½® poolPingQuery çš„é¢‘ç‡ã€‚å¯ä»¥è¢«è®¾ç½®ä¸ºå’Œæ•°æ®åº“è¿æ¥è¶…æ—¶æ—¶é—´ä¸€æ ·ï¼Œæ¥é¿å…ä¸å¿…è¦çš„ä¾¦æµ‹ï¼Œé»˜è®¤å€¼ï¼š0ï¼ˆå³æ‰€æœ‰è¿æ¥æ¯ä¸€æ—¶åˆ»éƒ½è¢«ä¾¦æµ‹ â€” å½“ç„¶ä»…å½“ poolPingEnabled ä¸º true æ—¶é€‚ç”¨ï¼‰ã€‚</li> </ul> </li> <li> <p><strong>JNDI</strong> â€“ è¿™ä¸ªæ•°æ®æºå®ç°æ˜¯ä¸ºäº†èƒ½åœ¨å¦‚ EJB æˆ–åº”ç”¨æœåŠ¡å™¨è¿™ç±»å®¹å™¨ä¸­ä½¿ç”¨ï¼Œå®¹å™¨å¯ä»¥é›†ä¸­æˆ–åœ¨å¤–éƒ¨é…ç½®æ•°æ®æºï¼Œç„¶åæ”¾ç½®ä¸€ä¸ª JNDI ä¸Šä¸‹æ–‡çš„æ•°æ®æºå¼•ç”¨ã€‚è¿™ç§æ•°æ®æºé…ç½®åªéœ€è¦ä¸¤ä¸ªå±æ€§ï¼š</p> <ul> <li><code>initial_context</code> â€“ è¿™ä¸ªå±æ€§ç”¨æ¥åœ¨ InitialContext ä¸­å¯»æ‰¾ä¸Šä¸‹æ–‡ï¼ˆå³ï¼ŒinitialContext.lookup(initial_context)ï¼‰ã€‚è¿™æ˜¯ä¸ªå¯é€‰å±æ€§ï¼Œå¦‚æœå¿½ç•¥ï¼Œé‚£ä¹ˆå°†ä¼šç›´æ¥ä» InitialContext ä¸­å¯»æ‰¾ data_source å±æ€§ã€‚</li> <li><code>data_source</code> â€“ è¿™æ˜¯å¼•ç”¨æ•°æ®æºå®ä¾‹ä½ç½®çš„ä¸Šä¸‹æ–‡è·¯å¾„ã€‚æä¾›äº† initial_context é…ç½®æ—¶ä¼šåœ¨å…¶è¿”å›çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ²¡æœ‰æä¾›æ—¶åˆ™ç›´æ¥åœ¨ InitialContext ä¸­æŸ¥æ‰¾ã€‚</li> </ul> <p>å’Œå…¶ä»–æ•°æ®æºé…ç½®ç±»ä¼¼ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ å‰ç¼€â€œenv.â€ç›´æ¥æŠŠå±æ€§ä¼ é€’ç»™ InitialContextã€‚æ¯”å¦‚ï¼š</p> <ul> <li><code>env.encoding=UTF8</code></li> </ul> <p>è¿™å°±ä¼šåœ¨ InitialContext å®ä¾‹åŒ–æ—¶å¾€å®ƒçš„æ„é€ æ–¹æ³•ä¼ é€’å€¼ä¸º <code>UTF8</code> çš„ <code>encoding</code> å±æ€§ã€‚</p> </li> </ol> <p>ä½ å¯ä»¥é€šè¿‡å®ç°æ¥å£ <code>org.apache.ibatis.datasource.DataSourceFactory</code> æ¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æ•°æ®æºå®ç°ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">DataSourceFactory</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">setProperties</span><span class="p">(</span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="p">);</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">  </span><span class="n">DataSource</span><span class="w"> </span><span class="nf">getDataSource</span><span class="p">();</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="p">}</span>
</span></code></pre></div> <p><code>org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory</code> å¯è¢«ç”¨ä½œçˆ¶ç±»æ¥æ„å»ºæ–°çš„æ•°æ®æºé€‚é…å™¨ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µæ’å…¥ C3P0 æ•°æ®æºæ‰€å¿…éœ€çš„ä»£ç ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory</span><span class="p">;</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.mchange.v2.c3p0.ComboPooledDataSource</span><span class="p">;</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">C3P0DataSourceFactory</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">UnpooledDataSourceFactory</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">C3P0DataSourceFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ComboPooledDataSource</span><span class="p">();</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸ºäº†ä»¤å…¶å·¥ä½œï¼Œè®°å¾—åœ¨é…ç½®æ–‡ä»¶ä¸­ä¸ºæ¯ä¸ªå¸Œæœ› MyBatis è°ƒç”¨çš„ setter æ–¹æ³•å¢åŠ å¯¹åº”çš„å±æ€§ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå¯ä»¥è¿æ¥è‡³ PostgreSQL æ•°æ®åº“çš„ä¾‹å­ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nt">&lt;dataSource</span><span class="w"> </span><span class="na">type=</span><span class="s">"org.myproject.C3P0DataSourceFactory"</span><span class="nt">&gt;</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"driver"</span><span class="w"> </span><span class="na">value=</span><span class="s">"org.postgresql.Driver"</span><span class="nt">/&gt;</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"url"</span><span class="w"> </span><span class="na">value=</span><span class="s">"jdbc:postgresql:mydb"</span><span class="nt">/&gt;</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"username"</span><span class="w"> </span><span class="na">value=</span><span class="s">"postgres"</span><span class="nt">/&gt;</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"password"</span><span class="w"> </span><span class="na">value=</span><span class="s">"root"</span><span class="nt">/&gt;</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="nt">&lt;/dataSource&gt;</span>
</span></code></pre></div> <h3 id="25æ˜ å°„å™¨mappers">2.5ã€æ˜ å°„å™¨ï¼ˆmappersï¼‰<a class="headerlink" href="#25æ˜ å°„å™¨mappers" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æ—¢ç„¶ MyBatis çš„è¡Œä¸ºå·²ç»ç”±ä¸Šè¿°å…ƒç´ é…ç½®å®Œäº†ï¼Œæˆ‘ä»¬ç°åœ¨å°±è¦æ¥å®šä¹‰ SQL æ˜ å°„è¯­å¥äº†ã€‚ ä½†é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ MyBatis åˆ°å“ªé‡Œå»æ‰¾åˆ°è¿™äº›è¯­å¥ã€‚ åœ¨è‡ªåŠ¨æŸ¥æ‰¾èµ„æºæ–¹é¢ï¼ŒJava å¹¶æ²¡æœ‰æä¾›ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥æœ€å¥½çš„åŠæ³•æ˜¯ç›´æ¥å‘Šè¯‰ MyBatis åˆ°å“ªé‡Œå»æ‰¾æ˜ å°„æ–‡ä»¶ã€‚ ä½ å¯ä»¥ä½¿ç”¨ç›¸å¯¹äºç±»è·¯å¾„çš„èµ„æºå¼•ç”¨ï¼Œæˆ–å®Œå…¨é™å®šèµ„æºå®šä½ç¬¦ï¼ˆåŒ…æ‹¬ <code>file:///</code> å½¢å¼çš„ URLï¼‰ï¼Œæˆ–ç±»åå’ŒåŒ…åç­‰ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="cm">&lt;!-- ä½¿ç”¨ç›¸å¯¹äºç±»è·¯å¾„çš„èµ„æºå¼•ç”¨ --&gt;</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="nt">&lt;mappers&gt;</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">  </span><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">resource=</span><span class="s">"org/mybatis/builder/AuthorMapper.xml"</span><span class="nt">/&gt;</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">  </span><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">resource=</span><span class="s">"org/mybatis/builder/BlogMapper.xml"</span><span class="nt">/&gt;</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">  </span><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">resource=</span><span class="s">"org/mybatis/builder/PostMapper.xml"</span><span class="nt">/&gt;</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="nt">&lt;/mappers&gt;</span>
</span></code></pre></div> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="cm">&lt;!-- ä½¿ç”¨å®Œå…¨é™å®šèµ„æºå®šä½ç¬¦ï¼ˆURLï¼‰ --&gt;</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="nt">&lt;mappers&gt;</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">  </span><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">url=</span><span class="s">"file:///var/mappers/AuthorMapper.xml"</span><span class="nt">/&gt;</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">  </span><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">url=</span><span class="s">"file:///var/mappers/BlogMapper.xml"</span><span class="nt">/&gt;</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">  </span><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">url=</span><span class="s">"file:///var/mappers/PostMapper.xml"</span><span class="nt">/&gt;</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="nt">&lt;/mappers&gt;</span>
</span></code></pre></div> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="cm">&lt;!-- ä½¿ç”¨æ˜ å°„å™¨æ¥å£å®ç°ç±»çš„å®Œå…¨é™å®šç±»å --&gt;</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="nt">&lt;mappers&gt;</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">  </span><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">class=</span><span class="s">"org.mybatis.builder.AuthorMapper"</span><span class="nt">/&gt;</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">  </span><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">class=</span><span class="s">"org.mybatis.builder.BlogMapper"</span><span class="nt">/&gt;</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">  </span><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">class=</span><span class="s">"org.mybatis.builder.PostMapper"</span><span class="nt">/&gt;</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="nt">&lt;/mappers&gt;</span>
</span></code></pre></div> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="cm">&lt;!-- å°†åŒ…å†…çš„æ˜ å°„å™¨æ¥å£å®ç°å…¨éƒ¨æ³¨å†Œä¸ºæ˜ å°„å™¨ --&gt;</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="nt">&lt;mappers&gt;</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">  </span><span class="nt">&lt;package</span><span class="w"> </span><span class="na">name=</span><span class="s">"org.mybatis.builder"</span><span class="nt">/&gt;</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="nt">&lt;/mappers&gt;</span>
</span></code></pre></div> <p>è¿™äº›é…ç½®ä¼šå‘Šè¯‰ MyBatis å»å“ªé‡Œæ‰¾æ˜ å°„æ–‡ä»¶ï¼Œå‰©ä¸‹çš„ç»†èŠ‚å°±åº”è¯¥æ˜¯æ¯ä¸ª SQL æ˜ å°„æ–‡ä»¶äº†ã€‚</p> <h2 id="3xmlæ˜ å°„æ–‡ä»¶">3ã€XMLæ˜ å°„æ–‡ä»¶<a class="headerlink" href="#3xmlæ˜ å°„æ–‡ä»¶" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>SQL æ˜ å°„æ–‡ä»¶åªæœ‰å¾ˆå°‘çš„å‡ ä¸ªé¡¶çº§å…ƒç´ ï¼ˆæŒ‰ç…§åº”è¢«å®šä¹‰çš„é¡ºåºåˆ—å‡ºï¼‰ï¼š</p> <ul> <li><code>cache</code> â€“ è¯¥å‘½åç©ºé—´çš„ç¼“å­˜é…ç½®ã€‚</li> <li><code>cache-ref</code> â€“ å¼•ç”¨å…¶å®ƒå‘½åç©ºé—´çš„ç¼“å­˜é…ç½®ã€‚</li> <li><code>resultMap</code> â€“ æè¿°å¦‚ä½•ä»æ•°æ®åº“ç»“æœé›†ä¸­åŠ è½½å¯¹è±¡ï¼Œæ˜¯æœ€å¤æ‚ä¹Ÿæ˜¯æœ€å¼ºå¤§çš„å…ƒç´ ã€‚</li> <li><del><code>parameterMap</code> â€“ è€å¼é£æ ¼çš„å‚æ•°æ˜ å°„ã€‚æ­¤å…ƒç´ å·²è¢«åºŸå¼ƒï¼Œå¹¶å¯èƒ½åœ¨å°†æ¥è¢«ç§»é™¤ï¼</del></li> <li><code>sql</code> â€“ å¯è¢«å…¶å®ƒè¯­å¥å¼•ç”¨çš„å¯é‡ç”¨è¯­å¥å—ã€‚</li> <li><code>insert</code> â€“ æ˜ å°„æ’å…¥è¯­å¥ã€‚</li> <li><code>update</code> â€“ æ˜ å°„æ›´æ–°è¯­å¥ã€‚</li> <li><code>delete</code> â€“ æ˜ å°„åˆ é™¤è¯­å¥ã€‚</li> <li><code>select</code> â€“ æ˜ å°„æŸ¥è¯¢è¯­å¥ã€‚</li> </ul> <h3 id="31select">3.1ã€select<a class="headerlink" href="#31select" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æŸ¥è¯¢è¯­å¥æ˜¯ MyBatis ä¸­æœ€å¸¸ç”¨çš„å…ƒç´ ä¹‹ä¸€â€”â€”å…‰èƒ½æŠŠæ•°æ®å­˜åˆ°æ•°æ®åº“ä¸­ä»·å€¼å¹¶ä¸å¤§ï¼Œè¿˜è¦èƒ½é‡æ–°å–å‡ºæ¥æ‰æœ‰ç”¨ï¼Œå¤šæ•°åº”ç”¨ä¹Ÿéƒ½æ˜¯æŸ¥è¯¢æ¯”ä¿®æ”¹è¦é¢‘ç¹ã€‚ MyBatis çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€æ˜¯ï¼šåœ¨æ¯ä¸ªæ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤æ“ä½œä¹‹é—´ï¼Œé€šå¸¸ä¼šæ‰§è¡Œå¤šä¸ªæŸ¥è¯¢æ“ä½œã€‚å› æ­¤ï¼ŒMyBatis åœ¨æŸ¥è¯¢å’Œç»“æœæ˜ å°„åšäº†ç›¸å½“å¤šçš„æ”¹è¿›ã€‚ä¸€ä¸ªç®€å•æŸ¥è¯¢çš„ select å…ƒç´ æ˜¯éå¸¸ç®€å•çš„ã€‚æ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectPerson"</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">"int"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"hashmap"</span><span class="nt">&gt;</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">  </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>PERSON<span class="w"> </span>WHERE<span class="w"> </span>ID<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>è¿™ä¸ªè¯­å¥åä¸º selectPersonï¼Œæ¥å—ä¸€ä¸ª intï¼ˆæˆ– Integerï¼‰ç±»å‹çš„å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª HashMap ç±»å‹çš„å¯¹è±¡ï¼Œå…¶ä¸­çš„é”®æ˜¯åˆ—åï¼Œå€¼ä¾¿æ˜¯ç»“æœè¡Œä¸­çš„å¯¹åº”å€¼ã€‚</p> <p>æ³¨æ„å‚æ•°ç¬¦å·ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>#{id}
</span></code></pre></div> <p>è¿™å°±å‘Šè¯‰ MyBatis åˆ›å»ºä¸€ä¸ªé¢„å¤„ç†è¯­å¥ï¼ˆPreparedStatementï¼‰å‚æ•°ï¼Œåœ¨ JDBC ä¸­ï¼Œè¿™æ ·çš„ä¸€ä¸ªå‚æ•°åœ¨ SQL ä¸­ä¼šç”±ä¸€ä¸ªâ€œ?â€æ¥æ ‡è¯†ï¼Œå¹¶è¢«ä¼ é€’åˆ°ä¸€ä¸ªæ–°çš„é¢„å¤„ç†è¯­å¥ä¸­ï¼Œå°±åƒè¿™æ ·ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1">// è¿‘ä¼¼çš„ JDBC ä»£ç ï¼Œé MyBatis ä»£ç ...</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">String</span><span class="w"> </span><span class="n">selectPerson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"SELECT * FROM PERSON WHERE ID=?"</span><span class="p">;</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">selectPerson</span><span class="p">);</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="n">ps</span><span class="p">.</span><span class="na">setInt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">id</span><span class="p">);</span>
</span></code></pre></div> <p>å½“ç„¶ï¼Œä½¿ç”¨ JDBC å°±æ„å‘³ç€ä½¿ç”¨æ›´å¤šçš„ä»£ç ï¼Œä»¥ä¾¿æå–ç»“æœå¹¶å°†å®ƒä»¬æ˜ å°„åˆ°å¯¹è±¡å®ä¾‹ä¸­ï¼Œè€Œè¿™å°±æ˜¯ MyBatis çš„æ‹¿æ‰‹å¥½æˆã€‚</p> <p>select å…ƒç´ å…è®¸ä½ é…ç½®å¾ˆå¤šå±æ€§æ¥é…ç½®æ¯æ¡è¯­å¥çš„è¡Œä¸ºç»†èŠ‚ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nt">&lt;select</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">  </span><span class="na">id=</span><span class="s">"selectPerson"</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">  </span><span class="na">parameterType=</span><span class="s">"int"</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">  </span><span class="na">parameterMap=</span><span class="s">"deprecated"</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">  </span><span class="na">resultType=</span><span class="s">"hashmap"</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">  </span><span class="na">resultMap=</span><span class="s">"personResultMap"</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">  </span><span class="na">flushCache=</span><span class="s">"false"</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">  </span><span class="na">useCache=</span><span class="s">"true"</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">  </span><span class="na">timeout=</span><span class="s">"10"</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">  </span><span class="na">fetchSize=</span><span class="s">"256"</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">  </span><span class="na">statementType=</span><span class="s">"PREPARED"</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="w">  </span><span class="na">resultSetType=</span><span class="s">"FORWARD_ONLY"</span><span class="nt">&gt;</span>
</span></code></pre></div> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Mybatis/image-20200614172418322.png" data-desc-position="bottom"><img src="!assets/Mybatis/image-20200614172418322.png" alt="image-20200614172418322" style></a></p> <h3 id="32insertupdatedelete">3.2ã€insertã€updateã€delete<a class="headerlink" href="#32insertupdatedelete" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æ•°æ®å˜æ›´è¯­å¥ insertï¼Œupdate å’Œ delete çš„å®ç°éå¸¸æ¥è¿‘ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nt">&lt;insert</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span><span class="na">id=</span><span class="s">"insertAuthor"</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">  </span><span class="na">parameterType=</span><span class="s">"domain.blog.Author"</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">  </span><span class="na">flushCache=</span><span class="s">"true"</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">  </span><span class="na">statementType=</span><span class="s">"PREPARED"</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">  </span><span class="na">keyProperty=</span><span class="s">""</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">  </span><span class="na">keyColumn=</span><span class="s">""</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="w">  </span><span class="na">useGeneratedKeys=</span><span class="s">""</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">  </span><span class="na">timeout=</span><span class="s">"20"</span><span class="nt">&gt;</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="nt">&lt;update</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">  </span><span class="na">id=</span><span class="s">"updateAuthor"</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">  </span><span class="na">parameterType=</span><span class="s">"domain.blog.Author"</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">  </span><span class="na">flushCache=</span><span class="s">"true"</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="w">  </span><span class="na">statementType=</span><span class="s">"PREPARED"</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="w">  </span><span class="na">timeout=</span><span class="s">"20"</span><span class="nt">&gt;</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="nt">&lt;delete</span>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="w">  </span><span class="na">id=</span><span class="s">"deleteAuthor"</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a><span class="w">  </span><span class="na">parameterType=</span><span class="s">"domain.blog.Author"</span>
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a><span class="w">  </span><span class="na">flushCache=</span><span class="s">"true"</span>
</span><span id="__span-40-22"><a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a><span class="w">  </span><span class="na">statementType=</span><span class="s">"PREPARED"</span>
</span><span id="__span-40-23"><a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a><span class="w">  </span><span class="na">timeout=</span><span class="s">"20"</span><span class="nt">&gt;</span>
</span></code></pre></div> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Mybatis/image-20200614172730202.png" data-desc-position="bottom"><img src="!assets/Mybatis/image-20200614172730202.png" alt="image-20200614172730202" style></a></p> <p>ä¸‹é¢æ˜¯ insertã€updateã€delete è¯­å¥çš„ç¤ºä¾‹ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">"insertAuthor"</span><span class="nt">&gt;</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">  </span>insert<span class="w"> </span>into<span class="w"> </span>Author<span class="w"> </span>(id,username,password,email,bio)
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">  </span>values<span class="w"> </span>(#{id},#{username},#{password},#{email},#{bio})
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="nt">&lt;/insert&gt;</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">"updateAuthor"</span><span class="nt">&gt;</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">  </span>update<span class="w"> </span>Author<span class="w"> </span>set
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">    </span>username<span class="w"> </span>=<span class="w"> </span>#{username},
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">    </span>password<span class="w"> </span>=<span class="w"> </span>#{password},
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">    </span>email<span class="w"> </span>=<span class="w"> </span>#{email},
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">    </span>bio<span class="w"> </span>=<span class="w"> </span>#{bio}
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">  </span>where<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="nt">&lt;/update&gt;</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">"deleteAuthor"</span><span class="nt">&gt;</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w">  </span>delete<span class="w"> </span>from<span class="w"> </span>Author<span class="w"> </span>where<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="nt">&lt;/delete&gt;</span>
</span></code></pre></div> <p>å¦‚å‰æ‰€è¿°ï¼Œæ’å…¥è¯­å¥çš„é…ç½®è§„åˆ™æ›´åŠ ä¸°å¯Œï¼Œåœ¨æ’å…¥è¯­å¥é‡Œé¢æœ‰ä¸€äº›é¢å¤–çš„å±æ€§å’Œå­å…ƒç´ ç”¨æ¥å¤„ç†ä¸»é”®çš„ç”Ÿæˆï¼Œå¹¶ä¸”æä¾›äº†å¤šç§ç”Ÿæˆæ–¹å¼ã€‚</p> <p>é¦–å…ˆï¼Œå¦‚æœä½ çš„æ•°æ®åº“æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®çš„å­—æ®µï¼ˆæ¯”å¦‚ MySQL å’Œ SQL Serverï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥è®¾ç½® useGeneratedKeys=â€trueâ€ï¼Œç„¶åå†æŠŠ keyProperty è®¾ç½®ä¸ºç›®æ ‡å±æ€§å°± OK äº†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸Šé¢çš„ Author è¡¨å·²ç»åœ¨ id åˆ—ä¸Šä½¿ç”¨äº†è‡ªåŠ¨ç”Ÿæˆï¼Œé‚£ä¹ˆè¯­å¥å¯ä»¥ä¿®æ”¹ä¸ºï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">"insertAuthor"</span><span class="w"> </span><span class="na">useGeneratedKeys=</span><span class="s">"true"</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">    </span><span class="na">keyProperty=</span><span class="s">"id"</span><span class="nt">&gt;</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">  </span>insert<span class="w"> </span>into<span class="w"> </span>Author<span class="w"> </span>(username,password,email,bio)
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">  </span>values<span class="w"> </span>(#{username},#{password},#{email},#{bio})
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="nt">&lt;/insert&gt;</span>
</span></code></pre></div> <p>å¦‚æœä½ çš„æ•°æ®åº“è¿˜æ”¯æŒå¤šè¡Œæ’å…¥, ä½ ä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ª <code>Author</code> æ•°ç»„æˆ–é›†åˆï¼Œå¹¶è¿”å›è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">"insertAuthor"</span><span class="w"> </span><span class="na">useGeneratedKeys=</span><span class="s">"true"</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">    </span><span class="na">keyProperty=</span><span class="s">"id"</span><span class="nt">&gt;</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">  </span>insert<span class="w"> </span>into<span class="w"> </span>Author<span class="w"> </span>(username,<span class="w"> </span>password,<span class="w"> </span>email,<span class="w"> </span>bio)<span class="w"> </span>values
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">  </span><span class="nt">&lt;foreach</span><span class="w"> </span><span class="na">item=</span><span class="s">"item"</span><span class="w"> </span><span class="na">collection=</span><span class="s">"list"</span><span class="w"> </span><span class="na">separator=</span><span class="s">","</span><span class="nt">&gt;</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">    </span>(#{item.username},<span class="w"> </span>#{item.password},<span class="w"> </span>#{item.email},<span class="w"> </span>#{item.bio})
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">  </span><span class="nt">&lt;/foreach&gt;</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="nt">&lt;/insert&gt;</span>
</span></code></pre></div> <p>å¯¹äºä¸æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®åˆ—çš„æ•°æ®åº“å’Œå¯èƒ½ä¸æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®çš„ JDBC é©±åŠ¨ï¼ŒMyBatis æœ‰å¦å¤–ä¸€ç§æ–¹æ³•æ¥ç”Ÿæˆä¸»é”®ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">"insertAuthor"</span><span class="nt">&gt;</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">  </span><span class="nt">&lt;selectKey</span><span class="w"> </span><span class="na">keyProperty=</span><span class="s">"id"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"int"</span><span class="w"> </span><span class="na">order=</span><span class="s">"BEFORE"</span><span class="nt">&gt;</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">    </span>select<span class="w"> </span>CAST(RANDOM()*1000000<span class="w"> </span>as<span class="w"> </span>INTEGER)<span class="w"> </span>a<span class="w"> </span>from<span class="w"> </span>SYSIBM.SYSDUMMY1
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">  </span><span class="nt">&lt;/selectKey&gt;</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">  </span>insert<span class="w"> </span>into<span class="w"> </span>Author
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">    </span>(id,<span class="w"> </span>username,<span class="w"> </span>password,<span class="w"> </span>email,bio,<span class="w"> </span>favourite_section)
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">  </span>values
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">    </span>(#{id},<span class="w"> </span>#{username},<span class="w"> </span>#{password},<span class="w"> </span>#{email},<span class="w"> </span>#{bio},<span class="w"> </span>#{favouriteSection,jdbcType=VARCHAR})
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="nt">&lt;/insert&gt;</span>
</span></code></pre></div> <p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆä¼šè¿è¡Œ selectKey å…ƒç´ ä¸­çš„è¯­å¥ï¼Œå¹¶è®¾ç½® Author çš„ idï¼Œç„¶åæ‰ä¼šè°ƒç”¨æ’å…¥è¯­å¥ã€‚è¿™æ ·å°±å®ç°äº†æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆä¸»é”®ç±»ä¼¼çš„è¡Œä¸ºï¼ŒåŒæ—¶ä¿æŒäº† Java ä»£ç çš„ç®€æ´ã€‚</p> <p>selectKey å…ƒç´ æè¿°å¦‚ä¸‹ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nt">&lt;selectKey</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">  </span><span class="na">keyProperty=</span><span class="s">"id"</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">  </span><span class="na">resultType=</span><span class="s">"int"</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">  </span><span class="na">order=</span><span class="s">"BEFORE"</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">  </span><span class="na">statementType=</span><span class="s">"PREPARED"</span><span class="nt">&gt;</span>
</span></code></pre></div> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Mybatis/image-20200614175334779.png" data-desc-position="bottom"><img src="!assets/Mybatis/image-20200614175334779.png" alt="image-20200614175334779" style></a></p> <p><strong>SQL</strong></p> <p>è¿™ä¸ªå…ƒç´ å¯ä»¥ç”¨æ¥å®šä¹‰å¯é‡ç”¨çš„ SQL ä»£ç ç‰‡æ®µï¼Œä»¥ä¾¿åœ¨å…¶å®ƒè¯­å¥ä¸­ä½¿ç”¨ã€‚ å‚æ•°å¯ä»¥é™æ€åœ°ï¼ˆåœ¨åŠ è½½çš„æ—¶å€™ï¼‰ç¡®å®šä¸‹æ¥ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„ include å…ƒç´ ä¸­å®šä¹‰ä¸åŒçš„å‚æ•°å€¼ã€‚æ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="nt">&lt;sql</span><span class="w"> </span><span class="na">id=</span><span class="s">"userColumns"</span><span class="nt">&gt;</span><span class="w"> </span>${alias}.id,${alias}.username,${alias}.password<span class="w"> </span><span class="nt">&lt;/sql&gt;</span>
</span></code></pre></div> <p>è¿™ä¸ª SQL ç‰‡æ®µå¯ä»¥åœ¨å…¶å®ƒè¯­å¥ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectUsers"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"map"</span><span class="nt">&gt;</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">  </span>select
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">    </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">refid=</span><span class="s">"userColumns"</span><span class="nt">&gt;&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"alias"</span><span class="w"> </span><span class="na">value=</span><span class="s">"t1"</span><span class="nt">/&gt;&lt;/include&gt;</span>,
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">    </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">refid=</span><span class="s">"userColumns"</span><span class="nt">&gt;&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"alias"</span><span class="w"> </span><span class="na">value=</span><span class="s">"t2"</span><span class="nt">/&gt;&lt;/include&gt;</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">  </span>from<span class="w"> </span>some_table<span class="w"> </span>t1
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">    </span>cross<span class="w"> </span>join<span class="w"> </span>some_table<span class="w"> </span>t2
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>ä¹Ÿå¯ä»¥åœ¨ include å…ƒç´ çš„ refid å±æ€§æˆ–å†…éƒ¨è¯­å¥ä¸­ä½¿ç”¨å±æ€§å€¼ï¼Œä¾‹å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nt">&lt;sql</span><span class="w"> </span><span class="na">id=</span><span class="s">"sometable"</span><span class="nt">&gt;</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">  </span>${prefix}Table
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="nt">&lt;/sql&gt;</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="nt">&lt;sql</span><span class="w"> </span><span class="na">id=</span><span class="s">"someinclude"</span><span class="nt">&gt;</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">  </span>from
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w">    </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">refid=</span><span class="s">"${include_target}"</span><span class="nt">/&gt;</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="nt">&lt;/sql&gt;</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"select"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"map"</span><span class="nt">&gt;</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="w">  </span>select
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="w">    </span>field1,<span class="w"> </span>field2,<span class="w"> </span>field3
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">  </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">refid=</span><span class="s">"someinclude"</span><span class="nt">&gt;</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"prefix"</span><span class="w"> </span><span class="na">value=</span><span class="s">"Some"</span><span class="nt">/&gt;</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"include_target"</span><span class="w"> </span><span class="na">value=</span><span class="s">"sometable"</span><span class="nt">/&gt;</span>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="w">  </span><span class="nt">&lt;/include&gt;</span>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <h3 id="33å‚æ•°">3.3ã€å‚æ•°<a class="headerlink" href="#33å‚æ•°" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ä¹‹å‰è§åˆ°çš„æ‰€æœ‰è¯­å¥éƒ½ä½¿ç”¨äº†ç®€å•çš„å‚æ•°å½¢å¼ã€‚ä½†å®é™…ä¸Šï¼Œå‚æ•°æ˜¯ MyBatis éå¸¸å¼ºå¤§çš„å…ƒç´ ã€‚å¯¹äºå¤§å¤šæ•°ç®€å•çš„ä½¿ç”¨åœºæ™¯ï¼Œä½ éƒ½ä¸éœ€è¦ä½¿ç”¨å¤æ‚çš„å‚æ•°ï¼Œæ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectUsers"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"User"</span><span class="nt">&gt;</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="w">  </span>select<span class="w"> </span>id,<span class="w"> </span>username,<span class="w"> </span>password
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w">  </span>from<span class="w"> </span>users
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">  </span>where<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>ä¸Šé¢çš„è¿™ä¸ªç¤ºä¾‹è¯´æ˜äº†ä¸€ä¸ªéå¸¸ç®€å•çš„å‘½åå‚æ•°æ˜ å°„ã€‚é‰´äºå‚æ•°ç±»å‹ï¼ˆparameterTypeï¼‰ä¼šè¢«è‡ªåŠ¨è®¾ç½®ä¸º <code>int</code>ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥éšæ„å‘½åã€‚åŸå§‹ç±»å‹æˆ–ç®€å•æ•°æ®ç±»å‹ï¼ˆæ¯”å¦‚ <code>Integer</code> å’Œ <code>String</code>ï¼‰å› ä¸ºæ²¡æœ‰å…¶å®ƒå±æ€§ï¼Œä¼šç”¨å®ƒä»¬çš„å€¼æ¥ä½œä¸ºå‚æ•°ã€‚ ç„¶è€Œï¼Œå¦‚æœä¼ å…¥ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ï¼Œè¡Œä¸ºå°±ä¼šæœ‰ç‚¹ä¸ä¸€æ ·äº†ã€‚æ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">"insertUser"</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">"User"</span><span class="nt">&gt;</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">  </span>insert<span class="w"> </span>into<span class="w"> </span>users<span class="w"> </span>(id,<span class="w"> </span>username,<span class="w"> </span>password)
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">  </span>values<span class="w"> </span>(#{id},<span class="w"> </span>#{username},<span class="w"> </span>#{password})
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="nt">&lt;/insert&gt;</span>
</span></code></pre></div> <p>å¦‚æœ User ç±»å‹çš„å‚æ•°å¯¹è±¡ä¼ é€’åˆ°äº†è¯­å¥ä¸­ï¼Œä¼šæŸ¥æ‰¾ idã€username å’Œ password å±æ€§ï¼Œç„¶åå°†å®ƒä»¬çš„å€¼ä¼ å…¥é¢„å¤„ç†è¯­å¥çš„å‚æ•°ä¸­ã€‚</p> <p>å¯¹ä¼ é€’è¯­å¥å‚æ•°æ¥è¯´ï¼Œè¿™ç§æ–¹å¼çœŸæ˜¯å¹²è„†åˆ©è½ã€‚ä¸è¿‡å‚æ•°æ˜ å°„çš„åŠŸèƒ½è¿œä¸æ­¢äºæ­¤ã€‚</p> <p>é¦–å…ˆï¼Œå’Œ MyBatis çš„å…¶å®ƒéƒ¨åˆ†ä¸€æ ·ï¼Œå‚æ•°ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®ç±»å‹ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>#{property,javaType=int,jdbcType=NUMERIC}
</span></code></pre></div> <p>å’Œ MyBatis çš„å…¶å®ƒéƒ¨åˆ†ä¸€æ ·ï¼Œå‡ ä¹æ€»æ˜¯å¯ä»¥æ ¹æ®å‚æ•°å¯¹è±¡çš„ç±»å‹ç¡®å®š javaTypeï¼Œé™¤éè¯¥å¯¹è±¡æ˜¯ä¸€ä¸ª <code>HashMap</code>ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½ éœ€è¦æ˜¾å¼æŒ‡å®š <code>javaType</code> æ¥ç¡®ä¿æ­£ç¡®çš„ç±»å‹å¤„ç†å™¨ï¼ˆ<code>TypeHandler</code>ï¼‰è¢«ä½¿ç”¨ã€‚</p> <p><strong>æç¤º</strong> JDBC è¦æ±‚ï¼Œå¦‚æœä¸€ä¸ªåˆ—å…è®¸ä½¿ç”¨ null å€¼ï¼Œå¹¶ä¸”ä¼šä½¿ç”¨å€¼ä¸º null çš„å‚æ•°ï¼Œå°±å¿…é¡»è¦æŒ‡å®š JDBC ç±»å‹ï¼ˆjdbcTypeï¼‰ã€‚</p> <p>è¦æ›´è¿›ä¸€æ­¥åœ°è‡ªå®šä¹‰ç±»å‹å¤„ç†æ–¹å¼ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹å¤„ç†å™¨ç±»ï¼ˆæˆ–åˆ«åï¼‰ï¼Œæ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>#{age,javaType=int,jdbcType=NUMERIC,typeHandler=MyTypeHandler}
</span></code></pre></div> <p>å‚æ•°çš„é…ç½®å¥½åƒè¶Šæ¥è¶Šç¹çäº†ï¼Œä½†å®é™…ä¸Šï¼Œå¾ˆå°‘éœ€è¦å¦‚æ­¤ç¹ççš„é…ç½®ã€‚</p> <p>å¯¹äºæ•°å€¼ç±»å‹ï¼Œè¿˜å¯ä»¥è®¾ç½® <code>numericScale</code> æŒ‡å®šå°æ•°ç‚¹åä¿ç•™çš„ä½æ•°ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>#{height,javaType=double,jdbcType=NUMERIC,numericScale=2}
</span></code></pre></div> <p>æœ€åï¼Œmode å±æ€§å…è®¸ä½ æŒ‡å®š <code>IN</code>ï¼Œ<code>OUT</code> æˆ– <code>INOUT</code> å‚æ•°ã€‚å¦‚æœå‚æ•°çš„ <code>mode</code> ä¸º <code>OUT</code> æˆ– <code>INOUT</code>ï¼Œå°†ä¼šä¿®æ”¹å‚æ•°å¯¹è±¡çš„å±æ€§å€¼ï¼Œä»¥ä¾¿ä½œä¸ºè¾“å‡ºå‚æ•°è¿”å›ã€‚ å¦‚æœ <code>mode</code> ä¸º <code>OUT</code>ï¼ˆæˆ– <code>INOUT</code>ï¼‰ï¼Œè€Œä¸” <code>jdbcType</code> ä¸º <code>CURSOR</code>ï¼ˆä¹Ÿå°±æ˜¯ Oracle çš„ REFCURSORï¼‰ï¼Œä½ å¿…é¡»æŒ‡å®šä¸€ä¸ª <code>resultMap</code> å¼•ç”¨æ¥å°†ç»“æœé›† <code>ResultMap</code> æ˜ å°„åˆ°å‚æ•°çš„ç±»å‹ä¸Šã€‚è¦æ³¨æ„è¿™é‡Œçš„ <code>javaType</code> å±æ€§æ˜¯å¯é€‰çš„ï¼Œå¦‚æœç•™ç©ºå¹¶ä¸” jdbcType æ˜¯ <code>CURSOR</code>ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨åœ°è¢«è®¾ä¸º <code>ResultMap</code>ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>#{department,<span class="w"> </span>mode=OUT,<span class="w"> </span>jdbcType=CURSOR,<span class="w"> </span>javaType=ResultSet,<span class="w"> </span>resultMap=departmentResultMap}
</span></code></pre></div> <p>MyBatis ä¹Ÿæ”¯æŒå¾ˆå¤šé«˜çº§çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ç»“æ„ä½“ï¼ˆstructsï¼‰ï¼Œä½†æ˜¯å½“ä½¿ç”¨ out å‚æ•°æ—¶ï¼Œä½ å¿…é¡»æ˜¾å¼è®¾ç½®ç±»å‹çš„åç§°ã€‚æ¯”å¦‚ï¼ˆå†æ¬¡æç¤ºï¼Œåœ¨å®é™…ä¸­è¦åƒè¿™æ ·ä¸èƒ½æ¢è¡Œï¼‰ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>#{middleInitial,<span class="w"> </span>mode=OUT,<span class="w"> </span>jdbcType=STRUCT,<span class="w"> </span>jdbcTypeName=MY_TYPE,<span class="w"> </span>resultMap=departmentResultMap}
</span></code></pre></div> <p>å°½ç®¡ä¸Šé¢è¿™äº›é€‰é¡¹å¾ˆå¼ºå¤§ï¼Œä½†å¤§å¤šæ—¶å€™ï¼Œä½ åªé¡»ç®€å•æŒ‡å®šå±æ€§åï¼Œé¡¶å¤šè¦ä¸ºå¯èƒ½ä¸ºç©ºçš„åˆ—æŒ‡å®š <code>jdbcType</code>ï¼Œå…¶ä»–çš„äº‹æƒ…äº¤ç»™ MyBatis è‡ªå·±å»æ¨æ–­å°±è¡Œäº†ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>#{firstName}
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>#{middleInitial,jdbcType=VARCHAR}
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>#{lastName}
</span></code></pre></div> <p><strong>å­—ç¬¦ä¸²æ›¿æ¢</strong></p> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>#{}</code> å‚æ•°è¯­æ³•æ—¶ï¼ŒMyBatis ä¼šåˆ›å»º <code>PreparedStatement</code> å‚æ•°å ä½ç¬¦ï¼Œå¹¶é€šè¿‡å ä½ç¬¦å®‰å…¨åœ°è®¾ç½®å‚æ•°ï¼ˆå°±åƒä½¿ç”¨ ? ä¸€æ ·ï¼‰ã€‚ è¿™æ ·åšæ›´å®‰å…¨ï¼Œæ›´è¿…é€Ÿï¼Œé€šå¸¸ä¹Ÿæ˜¯é¦–é€‰åšæ³•ï¼Œä¸è¿‡æœ‰æ—¶ä½ å°±æ˜¯æƒ³ç›´æ¥åœ¨ SQL è¯­å¥ä¸­ç›´æ¥æ’å…¥ä¸€ä¸ªä¸è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚ æ¯”å¦‚ ORDER BY å­å¥ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥ï¼š</p> <div class="language-mysql highlight"><span class="filename">MySQL</span><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">$</span><span class="err">{</span><span class="n">columnName</span><span class="err">}</span>
</span></code></pre></div> <p>è¿™æ ·ï¼ŒMyBatis å°±ä¸ä¼šä¿®æ”¹æˆ–è½¬ä¹‰è¯¥å­—ç¬¦ä¸²äº†ã€‚</p> <p>å½“ SQL è¯­å¥ä¸­çš„å…ƒæ•°æ®ï¼ˆå¦‚è¡¨åæˆ–åˆ—åï¼‰æ˜¯åŠ¨æ€ç”Ÿæˆçš„æ—¶å€™ï¼Œå­—ç¬¦ä¸²æ›¿æ¢å°†ä¼šéå¸¸æœ‰ç”¨ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ æƒ³ <code>select</code> ä¸€ä¸ªè¡¨ä»»æ„ä¸€åˆ—çš„æ•°æ®æ—¶ï¼Œä¸éœ€è¦è¿™æ ·å†™ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nd">@Select</span><span class="p">(</span><span class="s">"select * from user where id = #{id}"</span><span class="p">)</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="n">User</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="nd">@Select</span><span class="p">(</span><span class="s">"select * from user where name = #{name}"</span><span class="p">)</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="n">User</span><span class="w"> </span><span class="nf">findByName</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="nd">@Select</span><span class="p">(</span><span class="s">"select * from user where email = #{email}"</span><span class="p">)</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="n">User</span><span class="w"> </span><span class="nf">findByEmail</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">"email"</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">);</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="c1">// å…¶å®ƒçš„ "findByXxx" æ–¹æ³•</span>
</span></code></pre></div> <p>è€Œæ˜¯å¯ä»¥åªå†™è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="nd">@Select</span><span class="p">(</span><span class="s">"select * from user where ${column} = #{value}"</span><span class="p">)</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="n">User</span><span class="w"> </span><span class="nf">findByColumn</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">"column"</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">column</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">"value"</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
</span></code></pre></div> <p>å…¶ä¸­ <code>${column}</code> ä¼šè¢«ç›´æ¥æ›¿æ¢ï¼Œè€Œ <code>#{value}</code> ä¼šä½¿ç”¨ <code>?</code> é¢„å¤„ç†ã€‚ è¿™æ ·ï¼Œå°±èƒ½å®ŒæˆåŒæ ·çš„ä»»åŠ¡ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">User</span><span class="w"> </span><span class="n">userOfId1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userMapper</span><span class="p">.</span><span class="na">findByColumn</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span><span class="w"> </span><span class="mi">1L</span><span class="p">);</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="n">User</span><span class="w"> </span><span class="n">userOfNameKid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userMapper</span><span class="p">.</span><span class="na">findByColumn</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span><span class="w"> </span><span class="s">"kid"</span><span class="p">);</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="n">User</span><span class="w"> </span><span class="n">userOfEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userMapper</span><span class="p">.</span><span class="na">findByColumn</span><span class="p">(</span><span class="s">"email"</span><span class="p">,</span><span class="w"> </span><span class="s">"noone@nowhere.com"</span><span class="p">);</span>
</span></code></pre></div> <p>è¿™ç§æ–¹å¼ä¹ŸåŒæ ·é€‚ç”¨äºæ›¿æ¢è¡¨åçš„æƒ…å†µã€‚</p> <p><strong>æç¤º</strong> ç”¨è¿™ç§æ–¹å¼æ¥å—ç”¨æˆ·çš„è¾“å…¥ï¼Œå¹¶ç”¨ä½œè¯­å¥å‚æ•°æ˜¯ä¸å®‰å…¨çš„ï¼Œä¼šå¯¼è‡´æ½œåœ¨çš„ SQL æ³¨å…¥æ”»å‡»ã€‚å› æ­¤ï¼Œè¦ä¹ˆä¸å…è®¸ç”¨æˆ·è¾“å…¥è¿™äº›å­—æ®µï¼Œè¦ä¹ˆè‡ªè¡Œè½¬ä¹‰å¹¶æ£€éªŒè¿™äº›å‚æ•°ã€‚</p> <h3 id="34ç»“æœæ˜ å°„">3.4ã€ç»“æœæ˜ å°„<a class="headerlink" href="#34ç»“æœæ˜ å°„" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p><code>resultMap</code> å…ƒç´ æ˜¯ MyBatis ä¸­æœ€é‡è¦æœ€å¼ºå¤§çš„å…ƒç´ ã€‚ResultMap çš„è®¾è®¡æ€æƒ³æ˜¯ï¼Œå¯¹ç®€å•çš„è¯­å¥åšåˆ°é›¶é…ç½®ï¼Œå¯¹äºå¤æ‚ä¸€ç‚¹çš„è¯­å¥ï¼Œåªéœ€è¦æè¿°è¯­å¥ä¹‹é—´çš„å…³ç³»å°±è¡Œäº†ã€‚</p> <p>ä¹‹å‰å·²ç»è§è¿‡ç®€å•æ˜ å°„è¯­å¥çš„ç¤ºä¾‹ï¼Œå®ƒä»¬æ²¡æœ‰æ˜¾å¼æŒ‡å®š <code>resultMap</code>ã€‚æ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectUsers"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"map"</span><span class="nt">&gt;</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="w">  </span>select<span class="w"> </span>id,<span class="w"> </span>username,<span class="w"> </span>hashedPassword
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="w">  </span>from<span class="w"> </span>some_table
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="w">  </span>where<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>ä¸Šè¿°è¯­å¥åªæ˜¯ç®€å•åœ°å°†æ‰€æœ‰çš„åˆ—æ˜ å°„åˆ° <code>HashMap</code> çš„é”®ä¸Šï¼Œè¿™ç”± <code>resultType</code> å±æ€§æŒ‡å®šã€‚è™½ç„¶åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½å¤Ÿç”¨ï¼Œä½†æ˜¯ç¨‹åºæ›´å¯èƒ½ä¼šä½¿ç”¨ JavaBean æˆ– POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä½œä¸ºé¢†åŸŸæ¨¡å‹ã€‚MyBatis å¯¹ä¸¤è€…éƒ½æä¾›äº†æ”¯æŒã€‚çœ‹çœ‹ä¸‹é¢è¿™ä¸ª JavaBeanï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.someapp.model</span><span class="p">;</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">User</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">hashedPassword</span><span class="p">;</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">  </span><span class="c1">// get,set...</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="p">}</span>
</span></code></pre></div> <p>åŸºäº JavaBean çš„è§„èŒƒï¼Œä¸Šé¢è¿™ä¸ªç±»æœ‰ 3 ä¸ªå±æ€§ï¼šidã€username å’Œ hashedPasswordã€‚è¿™äº›å±æ€§ä¼šå¯¹åº”åˆ° <code>SELECT</code> è¯­å¥ä¸­çš„åˆ—åã€‚</p> <p>è¿™æ ·çš„ä¸€ä¸ª JavaBean å¯ä»¥è¢«æ˜ å°„åˆ° <code>ResultSet</code>ï¼Œå°±åƒæ˜ å°„åˆ° <code>HashMap</code> ä¸€æ ·ç®€å•ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectUsers"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"com.someapp.model.User"</span><span class="nt">&gt;</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="w">  </span>select<span class="w"> </span>id,<span class="w"> </span>username,<span class="w"> </span>hashedPassword
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="w">  </span>from<span class="w"> </span>some_table
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">  </span>where<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>ä½¿ç”¨ç±»å‹åˆ«åå°±å¯ä»¥ä¸ç”¨è¾“å…¥ç±»çš„å…¨é™å®šåäº†ã€‚æ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="cm">&lt;!-- mybatis-config.xml ä¸­ --&gt;</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="nt">&lt;typeAlias</span><span class="w"> </span><span class="na">type=</span><span class="s">"com.someapp.model.User"</span><span class="w"> </span><span class="na">alias=</span><span class="s">"User"</span><span class="nt">/&gt;</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="cm">&lt;!-- SQL æ˜ å°„ XML ä¸­ --&gt;</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectUsers"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"User"</span><span class="nt">&gt;</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w">  </span>select<span class="w"> </span>id,<span class="w"> </span>username,<span class="w"> </span>hashedPassword
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="w">  </span>from<span class="w"> </span>some_table
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="w">  </span>where<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒMyBatis ä¼šåœ¨å¹•åè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª <code>ResultMap</code>ï¼Œå†æ ¹æ®å±æ€§åæ¥æ˜ å°„åˆ—åˆ° JavaBean çš„å±æ€§ä¸Šã€‚å¦‚æœåˆ—åå’Œå±æ€§åä¸èƒ½åŒ¹é…ä¸Šï¼Œå¯ä»¥åœ¨ <code>SELECT</code> è¯­å¥ä¸­è®¾ç½®åˆ—åˆ«åï¼ˆè¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ SQL ç‰¹æ€§ï¼‰æ¥å®ŒæˆåŒ¹é…ã€‚æ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectUsers"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"User"</span><span class="nt">&gt;</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="w">  </span>select
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="w">    </span>user_id<span class="w">             </span>as<span class="w"> </span>"id",
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="w">    </span>user_name<span class="w">           </span>as<span class="w"> </span>"userName",
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="w">    </span>hashed_password<span class="w">     </span>as<span class="w"> </span>"hashedPassword"
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="w">  </span>from<span class="w"> </span>some_table
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="w">  </span>where<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>ä¸Šé¢çš„ä¾‹å­æ²¡æœ‰ä¸€ä¸ªéœ€è¦æ˜¾å¼é…ç½® <code>ResultMap</code>ï¼Œè¿™å°±æ˜¯ <code>ResultMap</code> çš„ä¼˜ç§€ä¹‹å¤„ï¼šå®Œå…¨å¯ä»¥ä¸ç”¨æ˜¾å¼åœ°é…ç½®å®ƒä»¬ã€‚ åœ¨åˆšåˆšçš„ç¤ºä¾‹ä¸­ï¼Œè§£å†³åˆ—åä¸åŒ¹é…çš„å¦å¤–ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯æ˜¾å¼ä½¿ç”¨å¤–éƒ¨çš„ <code>resultMap</code>ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"userResultMap"</span><span class="w"> </span><span class="na">type=</span><span class="s">"User"</span><span class="nt">&gt;</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"user_id"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"username"</span><span class="w"> </span><span class="na">column=</span><span class="s">"user_name"</span><span class="nt">/&gt;</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"password"</span><span class="w"> </span><span class="na">column=</span><span class="s">"hashed_password"</span><span class="nt">/&gt;</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <p>ç„¶ååœ¨å¼•ç”¨å®ƒçš„è¯­å¥ä¸­è®¾ç½® <code>resultMap</code> å±æ€§å°±è¡Œäº†ï¼ˆæ³¨æ„å»æ‰äº† <code>resultType</code> å±æ€§ï¼‰ã€‚æ¯”å¦‚:</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectUsers"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"userResultMap"</span><span class="nt">&gt;</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="w">  </span>select<span class="w"> </span>user_id,<span class="w"> </span>user_name,<span class="w"> </span>hashed_password
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="w">  </span>from<span class="w"> </span>some_table
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="w">  </span>where<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <h4 id="341é«˜çº§ç»“æœæ˜ å°„">3.4.1ã€é«˜çº§ç»“æœæ˜ å°„<a class="headerlink" href="#341é«˜çº§ç»“æœæ˜ å°„" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>é‚£ä¹ˆå¦‚ä½•æ˜ å°„ä¸‹é¢è¿™ä¸ªéå¸¸å¤æ‚çš„è¯­å¥ï¼Ÿ</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="cm">&lt;!-- éå¸¸å¤æ‚çš„è¯­å¥ --&gt;</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectBlogDetails"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"detailedBlogResultMap"</span><span class="nt">&gt;</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="w">  </span>select
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">       </span>B.id<span class="w"> </span>as<span class="w"> </span>blog_id,
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="w">       </span>B.title<span class="w"> </span>as<span class="w"> </span>blog_title,
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="w">       </span>B.author_id<span class="w"> </span>as<span class="w"> </span>blog_author_id,
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="w">       </span>A.id<span class="w"> </span>as<span class="w"> </span>author_id,
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="w">       </span>A.username<span class="w"> </span>as<span class="w"> </span>author_username,
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="w">       </span>A.password<span class="w"> </span>as<span class="w"> </span>author_password,
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a><span class="w">       </span>A.email<span class="w"> </span>as<span class="w"> </span>author_email,
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a><span class="w">       </span>A.bio<span class="w"> </span>as<span class="w"> </span>author_bio,
</span><span id="__span-68-12"><a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a><span class="w">       </span>A.favourite_section<span class="w"> </span>as<span class="w"> </span>author_favourite_section,
</span><span id="__span-68-13"><a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a><span class="w">       </span>P.id<span class="w"> </span>as<span class="w"> </span>post_id,
</span><span id="__span-68-14"><a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="w">       </span>P.blog_id<span class="w"> </span>as<span class="w"> </span>post_blog_id,
</span><span id="__span-68-15"><a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a><span class="w">       </span>P.author_id<span class="w"> </span>as<span class="w"> </span>post_author_id,
</span><span id="__span-68-16"><a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a><span class="w">       </span>P.created_on<span class="w"> </span>as<span class="w"> </span>post_created_on,
</span><span id="__span-68-17"><a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a><span class="w">       </span>P.section<span class="w"> </span>as<span class="w"> </span>post_section,
</span><span id="__span-68-18"><a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a><span class="w">       </span>P.subject<span class="w"> </span>as<span class="w"> </span>post_subject,
</span><span id="__span-68-19"><a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a><span class="w">       </span>P.draft<span class="w"> </span>as<span class="w"> </span>draft,
</span><span id="__span-68-20"><a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a><span class="w">       </span>P.body<span class="w"> </span>as<span class="w"> </span>post_body,
</span><span id="__span-68-21"><a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a><span class="w">       </span>C.id<span class="w"> </span>as<span class="w"> </span>comment_id,
</span><span id="__span-68-22"><a id="__codelineno-68-22" name="__codelineno-68-22" href="#__codelineno-68-22"></a><span class="w">       </span>C.post_id<span class="w"> </span>as<span class="w"> </span>comment_post_id,
</span><span id="__span-68-23"><a id="__codelineno-68-23" name="__codelineno-68-23" href="#__codelineno-68-23"></a><span class="w">       </span>C.name<span class="w"> </span>as<span class="w"> </span>comment_name,
</span><span id="__span-68-24"><a id="__codelineno-68-24" name="__codelineno-68-24" href="#__codelineno-68-24"></a><span class="w">       </span>C.comment<span class="w"> </span>as<span class="w"> </span>comment_text,
</span><span id="__span-68-25"><a id="__codelineno-68-25" name="__codelineno-68-25" href="#__codelineno-68-25"></a><span class="w">       </span>T.id<span class="w"> </span>as<span class="w"> </span>tag_id,
</span><span id="__span-68-26"><a id="__codelineno-68-26" name="__codelineno-68-26" href="#__codelineno-68-26"></a><span class="w">       </span>T.name<span class="w"> </span>as<span class="w"> </span>tag_name
</span><span id="__span-68-27"><a id="__codelineno-68-27" name="__codelineno-68-27" href="#__codelineno-68-27"></a><span class="w">  </span>from<span class="w"> </span>Blog<span class="w"> </span>B
</span><span id="__span-68-28"><a id="__codelineno-68-28" name="__codelineno-68-28" href="#__codelineno-68-28"></a><span class="w">       </span>left<span class="w"> </span>outer<span class="w"> </span>join<span class="w"> </span>Author<span class="w"> </span>A<span class="w"> </span>on<span class="w"> </span>B.author_id<span class="w"> </span>=<span class="w"> </span>A.id
</span><span id="__span-68-29"><a id="__codelineno-68-29" name="__codelineno-68-29" href="#__codelineno-68-29"></a><span class="w">       </span>left<span class="w"> </span>outer<span class="w"> </span>join<span class="w"> </span>Post<span class="w"> </span>P<span class="w"> </span>on<span class="w"> </span>B.id<span class="w"> </span>=<span class="w"> </span>P.blog_id
</span><span id="__span-68-30"><a id="__codelineno-68-30" name="__codelineno-68-30" href="#__codelineno-68-30"></a><span class="w">       </span>left<span class="w"> </span>outer<span class="w"> </span>join<span class="w"> </span>Comment<span class="w"> </span>C<span class="w"> </span>on<span class="w"> </span>P.id<span class="w"> </span>=<span class="w"> </span>C.post_id
</span><span id="__span-68-31"><a id="__codelineno-68-31" name="__codelineno-68-31" href="#__codelineno-68-31"></a><span class="w">       </span>left<span class="w"> </span>outer<span class="w"> </span>join<span class="w"> </span>Post_Tag<span class="w"> </span>PT<span class="w"> </span>on<span class="w"> </span>PT.post_id<span class="w"> </span>=<span class="w"> </span>P.id
</span><span id="__span-68-32"><a id="__codelineno-68-32" name="__codelineno-68-32" href="#__codelineno-68-32"></a><span class="w">       </span>left<span class="w"> </span>outer<span class="w"> </span>join<span class="w"> </span>Tag<span class="w"> </span>T<span class="w"> </span>on<span class="w"> </span>PT.tag_id<span class="w"> </span>=<span class="w"> </span>T.id
</span><span id="__span-68-33"><a id="__codelineno-68-33" name="__codelineno-68-33" href="#__codelineno-68-33"></a><span class="w">  </span>where<span class="w"> </span>B.id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-68-34"><a id="__codelineno-68-34" name="__codelineno-68-34" href="#__codelineno-68-34"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>å¯ä»¥æŠŠå®ƒæ˜ å°„åˆ°ä¸€ä¸ªæ™ºèƒ½çš„å¯¹è±¡æ¨¡å‹ï¼Œè¿™ä¸ªå¯¹è±¡è¡¨ç¤ºäº†ä¸€ç¯‡åšå®¢ï¼Œå®ƒç”±æŸä½ä½œè€…æ‰€å†™ï¼Œæœ‰å¾ˆå¤šçš„åšæ–‡ï¼Œæ¯ç¯‡åšæ–‡æœ‰é›¶æˆ–å¤šæ¡çš„è¯„è®ºå’Œæ ‡ç­¾ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="cm">&lt;!-- éå¸¸å¤æ‚çš„ç»“æœæ˜ å°„ --&gt;</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"detailedBlogResultMap"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="w">  </span><span class="nt">&lt;constructor&gt;</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="w">    </span><span class="nt">&lt;idArg</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_id"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"int"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="w">  </span><span class="nt">&lt;/constructor&gt;</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"title"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_title"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="w">  </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">"author"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"Author"</span><span class="nt">&gt;</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="w">    </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"username"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_username"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"password"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_password"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"email"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_email"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"bio"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_bio"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-13"><a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"favouriteSection"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_favourite_section"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-14"><a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a><span class="w">  </span><span class="nt">&lt;/association&gt;</span>
</span><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a><span class="w">  </span><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">"posts"</span><span class="w"> </span><span class="na">ofType=</span><span class="s">"Post"</span><span class="nt">&gt;</span>
</span><span id="__span-69-16"><a id="__codelineno-69-16" name="__codelineno-69-16" href="#__codelineno-69-16"></a><span class="w">    </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"post_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-17"><a id="__codelineno-69-17" name="__codelineno-69-17" href="#__codelineno-69-17"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"subject"</span><span class="w"> </span><span class="na">column=</span><span class="s">"post_subject"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-18"><a id="__codelineno-69-18" name="__codelineno-69-18" href="#__codelineno-69-18"></a><span class="w">    </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">"author"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"Author"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-19"><a id="__codelineno-69-19" name="__codelineno-69-19" href="#__codelineno-69-19"></a><span class="w">    </span><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">"comments"</span><span class="w"> </span><span class="na">ofType=</span><span class="s">"Comment"</span><span class="nt">&gt;</span>
</span><span id="__span-69-20"><a id="__codelineno-69-20" name="__codelineno-69-20" href="#__codelineno-69-20"></a><span class="w">      </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"comment_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-21"><a id="__codelineno-69-21" name="__codelineno-69-21" href="#__codelineno-69-21"></a><span class="w">    </span><span class="nt">&lt;/collection&gt;</span>
</span><span id="__span-69-22"><a id="__codelineno-69-22" name="__codelineno-69-22" href="#__codelineno-69-22"></a><span class="w">    </span><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">"tags"</span><span class="w"> </span><span class="na">ofType=</span><span class="s">"Tag"</span><span class="w"> </span><span class="nt">&gt;</span>
</span><span id="__span-69-23"><a id="__codelineno-69-23" name="__codelineno-69-23" href="#__codelineno-69-23"></a><span class="w">      </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"tag_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-24"><a id="__codelineno-69-24" name="__codelineno-69-24" href="#__codelineno-69-24"></a><span class="w">    </span><span class="nt">&lt;/collection&gt;</span>
</span><span id="__span-69-25"><a id="__codelineno-69-25" name="__codelineno-69-25" href="#__codelineno-69-25"></a><span class="w">    </span><span class="nt">&lt;discriminator</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"int"</span><span class="w"> </span><span class="na">column=</span><span class="s">"draft"</span><span class="nt">&gt;</span>
</span><span id="__span-69-26"><a id="__codelineno-69-26" name="__codelineno-69-26" href="#__codelineno-69-26"></a><span class="w">      </span><span class="nt">&lt;case</span><span class="w"> </span><span class="na">value=</span><span class="s">"1"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"DraftPost"</span><span class="nt">/&gt;</span>
</span><span id="__span-69-27"><a id="__codelineno-69-27" name="__codelineno-69-27" href="#__codelineno-69-27"></a><span class="w">    </span><span class="nt">&lt;/discriminator&gt;</span>
</span><span id="__span-69-28"><a id="__codelineno-69-28" name="__codelineno-69-28" href="#__codelineno-69-28"></a><span class="w">  </span><span class="nt">&lt;/collection&gt;</span>
</span><span id="__span-69-29"><a id="__codelineno-69-29" name="__codelineno-69-29" href="#__codelineno-69-29"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <p><code>resultMap</code> å…ƒç´ æœ‰å¾ˆå¤šå­å…ƒç´ å’Œä¸€ä¸ªå€¼å¾—æ·±å…¥æ¢è®¨çš„ç»“æ„ã€‚ </p> <p>ä¸‹é¢æ˜¯ <code>resultMap</code> å…ƒç´ çš„æ¦‚å¿µè§†å›¾ï¼š</p> <ul> <li><code>constructor</code>ï¼šç”¨äºåœ¨å®ä¾‹åŒ–ç±»æ—¶ï¼Œæ³¨å…¥ç»“æœåˆ°æ„é€ æ–¹æ³•ä¸­ã€‚<ul> <li><code>idArg</code>ï¼šID å‚æ•°ï¼›æ ‡è®°å‡ºä½œä¸º ID çš„ç»“æœå¯ä»¥å¸®åŠ©æé«˜æ•´ä½“æ€§èƒ½ã€‚</li> <li><code>arg</code>ï¼šå°†è¢«æ³¨å…¥åˆ°æ„é€ æ–¹æ³•çš„ä¸€ä¸ªæ™®é€šç»“æœã€‚</li> </ul> </li> <li><code>id</code>ï¼šä¸€ä¸ª ID ç»“æœï¼›æ ‡è®°å‡ºä½œä¸º ID çš„ç»“æœå¯ä»¥å¸®åŠ©æé«˜æ•´ä½“æ€§èƒ½ã€‚</li> <li><code>result</code>ï¼šæ³¨å…¥åˆ°å­—æ®µæˆ– JavaBean å±æ€§çš„æ™®é€šç»“æœã€‚</li> <li><code>association</code>ï¼šä¸€ä¸ªå¤æ‚ç±»å‹çš„å…³è”ï¼›è®¸å¤šç»“æœå°†åŒ…è£…æˆè¿™ç§ç±»å‹ã€‚</li> <li><code>collection</code>ï¼šä¸€ä¸ªå¤æ‚ç±»å‹çš„é›†åˆã€‚</li> <li><code>discriminator</code>ï¼šä½¿ç”¨ç»“æœå€¼æ¥å†³å®šä½¿ç”¨å“ªä¸ª <code>resultMap</code>ã€‚<ul> <li><code>case</code>ï¼šåŸºäºæŸäº›å€¼çš„ç»“æœæ˜ å°„ã€‚</li> </ul> </li> </ul> <p>ResultMap çš„å±æ€§åˆ—è¡¨ï¼š</p> <table> <thead> <tr> <th>å±æ€§</th> <th>æè¿°</th> </tr> </thead> <tbody> <tr> <td><code>id</code></td> <td>å½“å‰å‘½åç©ºé—´ä¸­çš„ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œç”¨äºæ ‡è¯†ä¸€ä¸ªç»“æœæ˜ å°„ã€‚</td> </tr> <tr> <td><code>type</code></td> <td>ç±»çš„å®Œå…¨é™å®šå, æˆ–è€…ä¸€ä¸ªç±»å‹åˆ«åï¼ˆå…³äºå†…ç½®çš„ç±»å‹åˆ«åï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„è¡¨æ ¼ï¼‰ã€‚</td> </tr> <tr> <td><code>autoMapping</code></td> <td>å¦‚æœè®¾ç½®è¿™ä¸ªå±æ€§ï¼ŒMyBatis å°†ä¼šä¸ºæœ¬ç»“æœæ˜ å°„å¼€å¯æˆ–è€…å…³é—­è‡ªåŠ¨æ˜ å°„ã€‚ è¿™ä¸ªå±æ€§ä¼šè¦†ç›–å…¨å±€çš„å±æ€§ <code>autoMappingBehavior</code>ã€‚é»˜è®¤å€¼ï¼šæœªè®¾ç½®ï¼ˆ<code>unset</code>ï¼‰ã€‚</td> </tr> </tbody> </table> <h4 id="342id--result">3.4.2ã€id &amp; result<a class="headerlink" href="#342id--result" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"post_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"subject"</span><span class="w"> </span><span class="na">column=</span><span class="s">"post_subject"</span><span class="nt">/&gt;</span>
</span></code></pre></div> <p>è¿™äº›å…ƒç´ æ˜¯ç»“æœæ˜ å°„çš„åŸºç¡€ã€‚<code>id</code> å’Œ <code>result</code> å…ƒç´ éƒ½å°†ä¸€ä¸ªåˆ—çš„å€¼æ˜ å°„åˆ°ä¸€ä¸ªç®€å•æ•°æ®ç±»å‹ï¼ˆStringã€intã€doubleã€Date ç­‰ï¼‰çš„å±æ€§æˆ–å­—æ®µã€‚</p> <p>è¿™ä¸¤è€…ä¹‹é—´çš„å”¯ä¸€ä¸åŒæ˜¯ï¼Œ<code>id</code> å…ƒç´ å¯¹åº”çš„å±æ€§ä¼šè¢«æ ‡è®°ä¸ºå¯¹è±¡çš„æ ‡è¯†ç¬¦ï¼Œåœ¨æ¯”è¾ƒå¯¹è±¡å®ä¾‹æ—¶ä½¿ç”¨ã€‚ è¿™æ ·å¯ä»¥æé«˜æ•´ä½“çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯è¿›è¡Œç¼“å­˜å’ŒåµŒå¥—ç»“æœæ˜ å°„ï¼ˆä¹Ÿå°±æ˜¯è¿æ¥æ˜ å°„ï¼‰çš„æ—¶å€™ã€‚</p> <p>ä¸¤ä¸ªå…ƒç´ éƒ½æœ‰ä¸€äº›å±æ€§ï¼š</p> <table> <thead> <tr> <th>å±æ€§</th> <th>æè¿°</th> </tr> </thead> <tbody> <tr> <td><code>property</code></td> <td>æ˜ å°„åˆ°åˆ—ç»“æœçš„å­—æ®µæˆ–å±æ€§ã€‚å¦‚æœ JavaBean æœ‰è¿™ä¸ªåå­—çš„å±æ€§ï¼ˆpropertyï¼‰ï¼Œä¼šå…ˆä½¿ç”¨è¯¥å±æ€§ã€‚å¦åˆ™ MyBatis å°†ä¼šå¯»æ‰¾ç»™å®šåç§°çš„å­—æ®µï¼ˆfieldï¼‰ã€‚ æ— è®ºæ˜¯å“ªä¸€ç§æƒ…å½¢ï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨å¸¸è§çš„ç‚¹å¼åˆ†éš”å½¢å¼è¿›è¡Œå¤æ‚å±æ€§å¯¼èˆªã€‚ æ¯”å¦‚ï¼Œä½ å¯ä»¥è¿™æ ·æ˜ å°„ä¸€äº›ç®€å•çš„ä¸œè¥¿ï¼šâ€œusernameâ€ï¼Œæˆ–è€…æ˜ å°„åˆ°ä¸€äº›å¤æ‚çš„ä¸œè¥¿ä¸Šï¼šâ€œaddress.street.numberâ€ã€‚</td> </tr> <tr> <td><code>column</code></td> <td>æ•°æ®åº“ä¸­çš„åˆ—åï¼Œæˆ–è€…æ˜¯åˆ—çš„åˆ«åã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™å’Œä¼ é€’ç»™ <code>resultSet.getString(columnName)</code> æ–¹æ³•çš„å‚æ•°ä¸€æ ·ã€‚</td> </tr> <tr> <td><code>javaType</code></td> <td>ä¸€ä¸ª Java ç±»çš„å…¨é™å®šåï¼Œæˆ–ä¸€ä¸ªç±»å‹åˆ«åï¼ˆå…³äºå†…ç½®çš„ç±»å‹åˆ«åï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„è¡¨æ ¼ï¼‰ã€‚ å¦‚æœä½ æ˜ å°„åˆ°ä¸€ä¸ª JavaBeanï¼ŒMyBatis é€šå¸¸å¯ä»¥æ¨æ–­ç±»å‹ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ˜ å°„åˆ°çš„æ˜¯ HashMapï¼Œé‚£ä¹ˆä½ åº”è¯¥æ˜ç¡®åœ°æŒ‡å®š javaType æ¥ä¿è¯è¡Œä¸ºä¸æœŸæœ›çš„ç›¸ä¸€è‡´ã€‚</td> </tr> <tr> <td><code>jdbcType</code></td> <td>JDBC ç±»å‹ï¼Œæ‰€æ”¯æŒçš„ JDBC ç±»å‹å‚è§è¿™ä¸ªè¡¨æ ¼ä¹‹åçš„ â€œæ”¯æŒçš„ JDBC ç±»å‹â€ã€‚ åªéœ€è¦åœ¨å¯èƒ½æ‰§è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤çš„ä¸”å…è®¸ç©ºå€¼çš„åˆ—ä¸ŠæŒ‡å®š JDBC ç±»å‹ã€‚è¿™æ˜¯ JDBC çš„è¦æ±‚è€Œé MyBatis çš„è¦æ±‚ã€‚å¦‚æœä½ ç›´æ¥é¢å‘ JDBC ç¼–ç¨‹ï¼Œä½ éœ€è¦å¯¹å¯ä»¥ä¸ºç©ºå€¼çš„åˆ—æŒ‡å®šè¿™ä¸ªç±»å‹ã€‚</td> </tr> <tr> <td><code>typeHandler</code></td> <td>æˆ‘ä»¬åœ¨å‰é¢è®¨è®ºè¿‡é»˜è®¤çš„ç±»å‹å¤„ç†å™¨ã€‚ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œä½ å¯ä»¥è¦†ç›–é»˜è®¤çš„ç±»å‹å¤„ç†å™¨ã€‚ è¿™ä¸ªå±æ€§å€¼æ˜¯ä¸€ä¸ªç±»å‹å¤„ç†å™¨å®ç°ç±»çš„å…¨é™å®šåï¼Œæˆ–è€…æ˜¯ç±»å‹åˆ«åã€‚</td> </tr> </tbody> </table> <p><strong>æ”¯æŒçš„ JDBC ç±»å‹</strong></p> <p>MyBatis é€šè¿‡å†…ç½®çš„ jdbcType æšä¸¾ç±»å‹æ”¯æŒä¸‹é¢çš„ JDBC ç±»å‹ï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="image-20250724223129075.png" data-desc-position="bottom"><img alt="image-20250724223129075" src="image-20250724223129075.png"></a></p> <h4 id="343æ„é€ æ–¹æ³•">3.4.3ã€æ„é€ æ–¹æ³•<a class="headerlink" href="#343æ„é€ æ–¹æ³•" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>é€šè¿‡æ— å‚æ„é€ å‡½æ•° + setter æ–¹å¼ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°çš„æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆData Transfer Object, DTOï¼‰ä»¥åŠç»å¤§éƒ¨åˆ†é¢†åŸŸæ¨¡å‹çš„è¦æ±‚ã€‚ä½†æœ‰äº›æƒ…å†µä¸‹ä½ æƒ³ä½¿ç”¨ä¸å¯å˜ç±»ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œå¾ˆå°‘æ”¹å˜æˆ–åŸºæœ¬ä¸å˜çš„åŒ…å«å¼•ç”¨æˆ–æ•°æ®çš„è¡¨ï¼Œå¾ˆé€‚åˆä½¿ç”¨ä¸å¯å˜ç±»ã€‚ </p> <p>æ„é€ å‡½æ•°æ–¹å¼æ³¨å…¥å…è®¸ä½ åœ¨åˆå§‹åŒ–æ—¶ä¸ºç±»è®¾ç½®å±æ€§çš„å€¼ï¼Œè€Œä¸ç”¨æš´éœ²å‡ºå…¬æœ‰æ–¹æ³•ã€‚MyBatis ä¹Ÿæ”¯æŒç§æœ‰å±æ€§å’Œç§æœ‰ JavaBean å±æ€§æ¥å®Œæˆæ³¨å…¥ï¼Œä½†æœ‰ä¸€äº›äººæ›´é’çäºé€šè¿‡æ„é€ å‡½æ•°è¿›è¡Œæ³¨å…¥ã€‚ <code>constructor</code> å…ƒç´ å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿçš„ã€‚</p> <p>çœ‹çœ‹ä¸‹é¢è¿™ä¸ª Java ç±»:</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">User</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">User</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="w">    </span><span class="c1">// æ²¡æœ‰setteræ–¹æ³•</span>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸ºäº†å°†ç»“æœæ³¨å…¥æ„é€ æ–¹æ³•ï¼ŒMyBatis éœ€è¦é€šè¿‡æŸç§æ–¹å¼å®šä½ç›¸åº”çš„æ„é€ æ–¹æ³•ã€‚ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒMyBatis æœç´¢ä¸€ä¸ªå£°æ˜äº†ä¸‰ä¸ªå½¢å‚çš„æ„é€ æ–¹æ³•ï¼Œå‚æ•°ç±»å‹ä»¥ <code>java.lang.Integer</code>ã€<code>java.lang.String</code> å’Œ <code>int</code> çš„é¡ºåºç»™å‡ºï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="nt">&lt;constructor&gt;</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">   </span><span class="nt">&lt;idArg</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"int"</span><span class="nt">/&gt;</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">   </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">column=</span><span class="s">"username"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"String"</span><span class="nt">/&gt;</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="w">   </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">column=</span><span class="s">"age"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"_int"</span><span class="nt">/&gt;</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="nt">&lt;/constructor&gt;</span>
</span></code></pre></div> <p>å½“ä½ åœ¨å¤„ç†ä¸€ä¸ªå¸¦æœ‰å¤šä¸ªå½¢å‚çš„æ„é€ æ–¹æ³•æ—¶ï¼Œå¾ˆå®¹æ˜“æä¹± arg å…ƒç´ çš„é¡ºåºã€‚ ä»ç‰ˆæœ¬ 3.4.3 å¼€å§‹ï¼Œå¯ä»¥åœ¨æŒ‡å®šå‚æ•°åç§°çš„å‰æä¸‹ï¼Œä»¥ä»»æ„é¡ºåºç¼–å†™ arg å…ƒç´ ã€‚ ä¸ºäº†é€šè¿‡åç§°æ¥å¼•ç”¨æ„é€ æ–¹æ³•å‚æ•°ï¼Œä½ å¯ä»¥æ·»åŠ  <code>@Param</code> æ³¨è§£ï¼Œæˆ–è€…ä½¿ç”¨ <code>-parameters</code> ç¼–è¯‘é€‰é¡¹å¹¶å¯ç”¨ <code>useActualParamName</code> é€‰é¡¹ï¼ˆé»˜è®¤å¼€å¯ï¼‰æ¥ç¼–è¯‘é¡¹ç›®ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç­‰ä»·çš„ä¾‹å­ï¼Œå°½ç®¡å‡½æ•°ç­¾åä¸­ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå½¢å‚çš„é¡ºåºä¸ <code>constructor</code> å…ƒç´ ä¸­å‚æ•°å£°æ˜çš„é¡ºåºä¸åŒ¹é…ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="nt">&lt;constructor&gt;</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">   </span><span class="nt">&lt;idArg</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"int"</span><span class="w"> </span><span class="na">name=</span><span class="s">"id"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="w">   </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">column=</span><span class="s">"age"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"_int"</span><span class="w"> </span><span class="na">name=</span><span class="s">"age"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="w">   </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">column=</span><span class="s">"username"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"String"</span><span class="w"> </span><span class="na">name=</span><span class="s">"username"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="nt">&lt;/constructor&gt;</span>
</span></code></pre></div> <p>å¦‚æœå­˜åœ¨åç§°å’Œç±»å‹ç›¸åŒçš„å±æ€§ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥ <code>javaType</code> ã€‚</p> <p>å‰©ä½™çš„å±æ€§å’Œè§„åˆ™å’Œæ™®é€šçš„ <code>id</code> å’Œ <code>result</code> å…ƒç´ æ˜¯ä¸€æ ·çš„ï¼š</p> <table> <thead> <tr> <th>å±æ€§</th> <th>æè¿°</th> </tr> </thead> <tbody> <tr> <td><code>column</code></td> <td>æ•°æ®åº“ä¸­çš„åˆ—åï¼Œæˆ–è€…æ˜¯åˆ—çš„åˆ«åã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™å’Œä¼ é€’ç»™ <code>resultSet.getString(columnName)</code> æ–¹æ³•çš„å‚æ•°ä¸€æ ·ã€‚</td> </tr> <tr> <td><code>javaType</code></td> <td>ä¸€ä¸ª Java ç±»çš„å®Œå…¨é™å®šåï¼Œæˆ–ä¸€ä¸ªç±»å‹åˆ«åï¼ˆå…³äºå†…ç½®çš„ç±»å‹åˆ«åï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„è¡¨æ ¼ï¼‰ã€‚ å¦‚æœä½ æ˜ å°„åˆ°ä¸€ä¸ª JavaBeanï¼ŒMyBatis é€šå¸¸å¯ä»¥æ¨æ–­ç±»å‹ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ˜ å°„åˆ°çš„æ˜¯ HashMapï¼Œé‚£ä¹ˆä½ åº”è¯¥æ˜ç¡®åœ°æŒ‡å®š javaType æ¥ä¿è¯è¡Œä¸ºä¸æœŸæœ›çš„ç›¸ä¸€è‡´ã€‚</td> </tr> <tr> <td><code>jdbcType</code></td> <td>JDBC ç±»å‹ï¼Œæ‰€æ”¯æŒçš„ JDBC ç±»å‹å‚è§è¿™ä¸ªè¡¨æ ¼ä¹‹å‰çš„â€œæ”¯æŒçš„ JDBC ç±»å‹â€ã€‚ åªéœ€è¦åœ¨å¯èƒ½æ‰§è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤çš„ä¸”å…è®¸ç©ºå€¼çš„åˆ—ä¸ŠæŒ‡å®š JDBC ç±»å‹ã€‚è¿™æ˜¯ JDBC çš„è¦æ±‚è€Œé MyBatis çš„è¦æ±‚ã€‚å¦‚æœä½ ç›´æ¥é¢å‘ JDBC ç¼–ç¨‹ï¼Œä½ éœ€è¦å¯¹å¯èƒ½å­˜åœ¨ç©ºå€¼çš„åˆ—æŒ‡å®šè¿™ä¸ªç±»å‹ã€‚</td> </tr> <tr> <td><code>typeHandler</code></td> <td>æˆ‘ä»¬åœ¨å‰é¢è®¨è®ºè¿‡é»˜è®¤çš„ç±»å‹å¤„ç†å™¨ã€‚ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œä½ å¯ä»¥è¦†ç›–é»˜è®¤çš„ç±»å‹å¤„ç†å™¨ã€‚ è¿™ä¸ªå±æ€§å€¼æ˜¯ä¸€ä¸ªç±»å‹å¤„ç†å™¨å®ç°ç±»çš„å®Œå…¨é™å®šåï¼Œæˆ–è€…æ˜¯ç±»å‹åˆ«åã€‚</td> </tr> <tr> <td><code>select</code></td> <td>ç”¨äºåŠ è½½å¤æ‚ç±»å‹å±æ€§çš„æ˜ å°„è¯­å¥çš„ IDï¼Œå®ƒä¼šä» <code>column</code> å±æ€§ä¸­æŒ‡å®šçš„åˆ—æ£€ç´¢æ•°æ®ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™æ­¤ <code>SELECT</code> è¯­å¥ã€‚å…·ä½“è¯·å‚è€ƒå…³è”å…ƒç´ ã€‚</td> </tr> <tr> <td><code>resultMap</code></td> <td>ç»“æœæ˜ å°„çš„ IDï¼Œå¯ä»¥å°†åµŒå¥—çš„ç»“æœé›†æ˜ å°„åˆ°ä¸€ä¸ªåˆé€‚çš„å¯¹è±¡æ ‘ä¸­ã€‚ å®ƒå¯ä»¥ä½œä¸ºä½¿ç”¨é¢å¤– select è¯­å¥çš„æ›¿ä»£æ–¹æ¡ˆã€‚å®ƒå¯ä»¥å°†å¤šè¡¨è¿æ¥æ“ä½œçš„ç»“æœæ˜ å°„æˆä¸€ä¸ªå•ä¸€çš„ <code>ResultSet</code>ã€‚è¿™æ ·çš„ <code>ResultSet</code> å°†ä¼šå°†åŒ…å«é‡å¤æˆ–éƒ¨åˆ†æ•°æ®é‡å¤çš„ç»“æœé›†ã€‚ä¸ºäº†å°†ç»“æœé›†æ­£ç¡®åœ°æ˜ å°„åˆ°åµŒå¥—çš„å¯¹è±¡æ ‘ä¸­ï¼ŒMyBatis å…è®¸ä½  â€œä¸²è”â€ç»“æœæ˜ å°„ï¼Œä»¥ä¾¿è§£å†³åµŒå¥—ç»“æœé›†çš„é—®é¢˜ã€‚æƒ³äº†è§£æ›´å¤šå†…å®¹ï¼Œè¯·å‚è€ƒä¸‹é¢çš„å…³è”å…ƒç´ ã€‚</td> </tr> <tr> <td><code>name</code></td> <td>æ„é€ æ–¹æ³•å½¢å‚çš„åå­—ã€‚ä» 3.4.3 ç‰ˆæœ¬å¼€å§‹ï¼Œé€šè¿‡æŒ‡å®šå…·ä½“çš„å‚æ•°åï¼Œä½ å¯ä»¥ä»¥ä»»æ„é¡ºåºå†™å…¥ <code>arg</code> å…ƒç´ ã€‚</td> </tr> </tbody> </table> <h4 id="344å…³è”">3.4.4ã€å…³è”<a class="headerlink" href="#344å…³è”" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">"author"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_author_id"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"Author"</span><span class="nt">&gt;</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"username"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_username"</span><span class="nt">/&gt;</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="nt">&lt;/association&gt;</span>
</span></code></pre></div> <p>å…³è”ï¼ˆassociationï¼‰å…ƒç´ å¤„ç† â€œæœ‰ä¸€ä¸ªâ€ ç±»å‹çš„å…³ç³»ã€‚ æ¯”å¦‚åœ¨ç¤ºä¾‹ä¸­ï¼Œä¸€ä¸ªåšå®¢æœ‰ä¸€ä¸ªç”¨æˆ·ã€‚å…³è”ç»“æœæ˜ å°„å’Œå…¶å®ƒç±»å‹çš„æ˜ å°„å·¥ä½œæ–¹å¼å·®ä¸å¤šã€‚ ä½ éœ€è¦æŒ‡å®šç›®æ ‡å±æ€§åä»¥åŠå±æ€§çš„<code>javaType</code>ï¼ˆå¾ˆå¤šæ—¶å€™ MyBatis å¯ä»¥è‡ªå·±æ¨æ–­å‡ºæ¥ï¼‰ï¼Œåœ¨å¿…è¦çš„æƒ…å†µä¸‹ä½ è¿˜å¯ä»¥è®¾ç½® JDBC ç±»å‹ï¼Œå¦‚æœä½ æƒ³è¦†ç›–è·å–ç»“æœå€¼çš„è¿‡ç¨‹ï¼Œè¿˜å¯ä»¥è®¾ç½®ç±»å‹å¤„ç†å™¨ã€‚</p> <p>å…³è”çš„ä¸åŒä¹‹å¤„æ˜¯ï¼Œä½ éœ€è¦å‘Šè¯‰ MyBatis å¦‚ä½•åŠ è½½å…³è”ã€‚MyBatis æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼åŠ è½½å…³è”ï¼š</p> <ul> <li>åµŒå¥— Select æŸ¥è¯¢ï¼šé€šè¿‡æ‰§è¡Œå¦å¤–ä¸€ä¸ª SQL æ˜ å°„è¯­å¥æ¥åŠ è½½æœŸæœ›çš„å¤æ‚ç±»å‹ã€‚</li> <li>åµŒå¥—ç»“æœæ˜ å°„ï¼šä½¿ç”¨åµŒå¥—çš„ç»“æœæ˜ å°„æ¥å¤„ç†è¿æ¥ç»“æœçš„é‡å¤å­é›†ã€‚</li> </ul> <p><code>association</code> å…ƒç´ çš„åŸºæœ¬å±æ€§å’Œæ™®é€šçš„ç»“æœæ˜ å°„ç›¸æ¯”ï¼Œå®ƒåªåœ¨ <code>select</code> å’Œ <code>resultMap</code> å±æ€§ä¸Šæœ‰æ‰€ä¸åŒï¼š</p> <table> <thead> <tr> <th>å±æ€§</th> <th>æè¿°</th> </tr> </thead> <tbody> <tr> <td><code>property</code></td> <td>æ˜ å°„åˆ°åˆ—ç»“æœçš„å­—æ®µæˆ–å±æ€§ã€‚å¦‚æœç”¨æ¥åŒ¹é…çš„ JavaBean å­˜åœ¨ç»™å®šåå­—çš„å±æ€§ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šè¢«ä½¿ç”¨ã€‚å¦åˆ™ MyBatis å°†ä¼šå¯»æ‰¾ç»™å®šåç§°çš„å­—æ®µã€‚ æ— è®ºæ˜¯å“ªä¸€ç§æƒ…å½¢ï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨é€šå¸¸çš„ç‚¹å¼åˆ†éš”å½¢å¼è¿›è¡Œå¤æ‚å±æ€§å¯¼èˆªã€‚ æ¯”å¦‚ï¼Œä½ å¯ä»¥è¿™æ ·æ˜ å°„ä¸€äº›ç®€å•çš„ä¸œè¥¿ï¼šâ€œusernameâ€ï¼Œæˆ–è€…æ˜ å°„åˆ°ä¸€äº›å¤æ‚çš„ä¸œè¥¿ä¸Šï¼šâ€œaddress.street.numberâ€ã€‚</td> </tr> <tr> <td><code>javaType</code></td> <td>ä¸€ä¸ª Java ç±»çš„å®Œå…¨é™å®šåï¼Œæˆ–ä¸€ä¸ªç±»å‹åˆ«åï¼ˆå…³äºå†…ç½®çš„ç±»å‹åˆ«åï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„è¡¨æ ¼ï¼‰ã€‚ å¦‚æœä½ æ˜ å°„åˆ°ä¸€ä¸ª JavaBeanï¼ŒMyBatis é€šå¸¸å¯ä»¥æ¨æ–­ç±»å‹ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ˜ å°„åˆ°çš„æ˜¯ HashMapï¼Œé‚£ä¹ˆä½ åº”è¯¥æ˜ç¡®åœ°æŒ‡å®š javaType æ¥ä¿è¯è¡Œä¸ºä¸æœŸæœ›çš„ç›¸ä¸€è‡´ã€‚</td> </tr> <tr> <td><code>jdbcType</code></td> <td>JDBC ç±»å‹ï¼Œæ‰€æ”¯æŒçš„ JDBC ç±»å‹å‚è§è¿™ä¸ªè¡¨æ ¼ä¹‹å‰çš„â€œæ”¯æŒçš„ JDBC ç±»å‹â€ã€‚ åªéœ€è¦åœ¨å¯èƒ½æ‰§è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤çš„ä¸”å…è®¸ç©ºå€¼çš„åˆ—ä¸ŠæŒ‡å®š JDBC ç±»å‹ã€‚è¿™æ˜¯ JDBC çš„è¦æ±‚è€Œé MyBatis çš„è¦æ±‚ã€‚å¦‚æœä½ ç›´æ¥é¢å‘ JDBC ç¼–ç¨‹ï¼Œä½ éœ€è¦å¯¹å¯èƒ½å­˜åœ¨ç©ºå€¼çš„åˆ—æŒ‡å®šè¿™ä¸ªç±»å‹ã€‚</td> </tr> <tr> <td><code>typeHandler</code></td> <td>æˆ‘ä»¬åœ¨å‰é¢è®¨è®ºè¿‡é»˜è®¤çš„ç±»å‹å¤„ç†å™¨ã€‚ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œä½ å¯ä»¥è¦†ç›–é»˜è®¤çš„ç±»å‹å¤„ç†å™¨ã€‚ è¿™ä¸ªå±æ€§å€¼æ˜¯ä¸€ä¸ªç±»å‹å¤„ç†å™¨å®ç°ç±»çš„å®Œå…¨é™å®šåï¼Œæˆ–è€…æ˜¯ç±»å‹åˆ«åã€‚</td> </tr> </tbody> </table> <h5 id="åµŒå¥—-select-æŸ¥è¯¢">åµŒå¥— Select æŸ¥è¯¢<a class="headerlink" href="#åµŒå¥—-select-æŸ¥è¯¢" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <table> <thead> <tr> <th>å±æ€§</th> <th>æè¿°</th> </tr> </thead> <tbody> <tr> <td><code>column</code></td> <td>æ•°æ®åº“ä¸­çš„åˆ—åï¼Œæˆ–è€…æ˜¯åˆ—çš„åˆ«åã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™å’Œä¼ é€’ç»™ <code>resultSet.getString(columnName)</code> æ–¹æ³•çš„å‚æ•°ä¸€æ ·ã€‚ æ³¨æ„ï¼šåœ¨ä½¿ç”¨å¤åˆä¸»é”®çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>column="{prop1=col1,prop2=col2}"</code> è¿™æ ·çš„è¯­æ³•æ¥æŒ‡å®šå¤šä¸ªä¼ é€’ç»™åµŒå¥— Select æŸ¥è¯¢è¯­å¥çš„åˆ—åã€‚è¿™ä¼šä½¿å¾— <code>prop1</code> å’Œ <code>prop2</code> ä½œä¸ºå‚æ•°å¯¹è±¡ï¼Œè¢«è®¾ç½®ä¸ºå¯¹åº”åµŒå¥— Select è¯­å¥çš„å‚æ•°ã€‚</td> </tr> <tr> <td><code>select</code></td> <td>ç”¨äºåŠ è½½å¤æ‚ç±»å‹å±æ€§çš„æ˜ å°„è¯­å¥çš„ IDï¼Œå®ƒä¼šä» column å±æ€§æŒ‡å®šçš„åˆ—ä¸­æ£€ç´¢æ•°æ®ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™ç›®æ ‡ select è¯­å¥ã€‚ å…·ä½“è¯·å‚è€ƒä¸‹é¢çš„ä¾‹å­ã€‚æ³¨æ„ï¼šåœ¨ä½¿ç”¨å¤åˆä¸»é”®çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>column="{prop1=col1,prop2=col2}"</code> è¿™æ ·çš„è¯­æ³•æ¥æŒ‡å®šå¤šä¸ªä¼ é€’ç»™åµŒå¥— Select æŸ¥è¯¢è¯­å¥çš„åˆ—åã€‚è¿™ä¼šä½¿å¾— <code>prop1</code> å’Œ <code>prop2</code> ä½œä¸ºå‚æ•°å¯¹è±¡ï¼Œè¢«è®¾ç½®ä¸ºå¯¹åº”åµŒå¥— Select è¯­å¥çš„å‚æ•°ã€‚</td> </tr> <tr> <td><code>fetchType</code></td> <td>å¯é€‰çš„ã€‚æœ‰æ•ˆå€¼ä¸º <code>lazy</code> å’Œ <code>eager</code>ã€‚ æŒ‡å®šå±æ€§åï¼Œå°†åœ¨æ˜ å°„ä¸­å¿½ç•¥å…¨å±€é…ç½®å‚æ•° <code>lazyLoadingEnabled</code>ï¼Œä½¿ç”¨å±æ€§çš„å€¼ã€‚</td> </tr> </tbody> </table> <p>ç¤ºä¾‹ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"blogResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="w">  </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">"author"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_id"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"Author"</span><span class="w"> </span><span class="na">select=</span><span class="s">"selectAuthor"</span><span class="nt">/&gt;</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="nt">&lt;/resultMap&gt;</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectBlog"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"blogResult"</span><span class="nt">&gt;</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">  </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>BLOG<span class="w"> </span>WHERE<span class="w"> </span>ID<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="nt">&lt;/select&gt;</span>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectAuthor"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"Author"</span><span class="nt">&gt;</span>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="w">  </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>AUTHOR<span class="w"> </span>WHERE<span class="w"> </span>ID<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>æœ‰ä¸¤ä¸ª select æŸ¥è¯¢è¯­å¥ï¼šä¸€ä¸ªç”¨æ¥åŠ è½½åšå®¢ï¼ˆBlogï¼‰ï¼Œå¦å¤–ä¸€ä¸ªç”¨æ¥åŠ è½½ä½œè€…ï¼ˆAuthorï¼‰ï¼Œè€Œä¸”åšå®¢çš„ç»“æœæ˜ å°„æè¿°äº†åº”è¯¥ä½¿ç”¨ <code>selectAuthor</code> è¯­å¥åŠ è½½å®ƒçš„ <code>author</code> å±æ€§ã€‚</p> <p>å…¶å®ƒæ‰€æœ‰çš„å±æ€§å°†ä¼šè¢«è‡ªåŠ¨åŠ è½½ï¼Œåªè¦å®ƒä»¬çš„åˆ—åå’Œå±æ€§åç›¸åŒ¹é…ã€‚</p> <p>è¿™ç§æ–¹å¼è™½ç„¶å¾ˆç®€å•ï¼Œä½†åœ¨å¤§å‹æ•°æ®é›†æˆ–å¤§å‹æ•°æ®è¡¨ä¸Šè¡¨ç°ä¸ä½³ã€‚è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸º â€œN+1 æŸ¥è¯¢é—®é¢˜â€ã€‚ æ¦‚æ‹¬åœ°è®²ï¼ŒN+1 æŸ¥è¯¢é—®é¢˜æ˜¯è¿™æ ·å­çš„ï¼š</p> <ul> <li>ä½ æ‰§è¡Œäº†ä¸€ä¸ªå•ç‹¬çš„ SQL è¯­å¥æ¥è·å–ç»“æœçš„ä¸€ä¸ªåˆ—è¡¨ï¼ˆå°±æ˜¯â€œ+1â€ï¼‰ã€‚</li> <li>å¯¹åˆ—è¡¨è¿”å›çš„æ¯æ¡è®°å½•ï¼Œä½ æ‰§è¡Œä¸€ä¸ª select æŸ¥è¯¢è¯­å¥æ¥ä¸ºæ¯æ¡è®°å½•åŠ è½½è¯¦ç»†ä¿¡æ¯ï¼ˆå°±æ˜¯â€œNâ€ï¼‰ã€‚</li> </ul> <p>è¿™ä¸ªé—®é¢˜ä¼šå¯¼è‡´æˆç™¾ä¸Šåƒçš„ SQL è¯­å¥è¢«æ‰§è¡Œã€‚å¥½æ¶ˆæ¯æ˜¯ï¼ŒMyBatis èƒ½å¤Ÿå¯¹è¿™æ ·çš„æŸ¥è¯¢è¿›è¡Œå»¶è¿ŸåŠ è½½ï¼Œå› æ­¤å¯ä»¥å°†å¤§é‡è¯­å¥åŒæ—¶è¿è¡Œçš„å¼€é”€åˆ†æ•£å¼€æ¥ã€‚ ç„¶è€Œï¼Œå¦‚æœä½ åŠ è½½è®°å½•åˆ—è¡¨ä¹‹åç«‹åˆ»å°±éå†åˆ—è¡¨ä»¥è·å–åµŒå¥—çš„æ•°æ®ï¼Œå°±ä¼šè§¦å‘æ‰€æœ‰çš„å»¶è¿ŸåŠ è½½æŸ¥è¯¢ï¼Œæ€§èƒ½å¯èƒ½ä¼šå˜å¾—å¾ˆç³Ÿç³•ã€‚</p> <h5 id="åµŒå¥—ç»“æœæ˜ å°„">åµŒå¥—ç»“æœæ˜ å°„<a class="headerlink" href="#åµŒå¥—ç»“æœæ˜ å°„" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <table> <thead> <tr> <th>å±æ€§</th> <th>æè¿°</th> </tr> </thead> <tbody> <tr> <td><code>resultMap</code></td> <td>ç»“æœæ˜ å°„çš„ IDï¼Œå¯ä»¥å°†æ­¤å…³è”çš„åµŒå¥—ç»“æœé›†æ˜ å°„åˆ°ä¸€ä¸ªåˆé€‚çš„å¯¹è±¡æ ‘ä¸­ã€‚ å®ƒå¯ä»¥ä½œä¸ºä½¿ç”¨é¢å¤– select è¯­å¥çš„æ›¿ä»£æ–¹æ¡ˆã€‚å®ƒå¯ä»¥å°†å¤šè¡¨è¿æ¥æ“ä½œçš„ç»“æœæ˜ å°„æˆä¸€ä¸ªå•ä¸€çš„ <code>ResultSet</code>ã€‚è¿™æ ·çš„ <code>ResultSet</code> æœ‰éƒ¨åˆ†æ•°æ®æ˜¯é‡å¤çš„ã€‚ ä¸ºäº†å°†ç»“æœé›†æ­£ç¡®åœ°æ˜ å°„åˆ°åµŒå¥—çš„å¯¹è±¡æ ‘ä¸­, MyBatis å…è®¸ä½  â€œä¸²è”â€ ç»“æœæ˜ å°„ï¼Œä»¥ä¾¿è§£å†³åµŒå¥—ç»“æœé›†çš„é—®é¢˜ã€‚ä½¿ç”¨åµŒå¥—ç»“æœæ˜ å°„çš„ä¸€ä¸ªä¾‹å­åœ¨è¡¨æ ¼ä»¥åã€‚</td> </tr> <tr> <td><code>columnPrefix</code></td> <td>å½“è¿æ¥å¤šä¸ªè¡¨æ—¶ï¼Œä½ å¯èƒ½ä¼šä¸å¾—ä¸ä½¿ç”¨åˆ—åˆ«åæ¥é¿å…åœ¨ <code>ResultSet</code> ä¸­äº§ç”Ÿé‡å¤çš„åˆ—åã€‚æŒ‡å®š <code>columnPrefix</code> åˆ—åå‰ç¼€å…è®¸ä½ å°†å¸¦æœ‰è¿™äº›å‰ç¼€çš„åˆ—æ˜ å°„åˆ°ä¸€ä¸ªå¤–éƒ¨çš„ç»“æœæ˜ å°„ä¸­ã€‚ è¯¦ç»†è¯´æ˜è¯·å‚è€ƒåé¢çš„ä¾‹å­ã€‚</td> </tr> <tr> <td><code>notNullColumn</code></td> <td>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨è‡³å°‘ä¸€ä¸ªè¢«æ˜ å°„åˆ°å±æ€§çš„åˆ—ä¸ä¸ºç©ºæ—¶ï¼Œå­å¯¹è±¡æ‰ä¼šè¢«åˆ›å»ºã€‚ ä½ å¯ä»¥åœ¨è¿™ä¸ªå±æ€§ä¸ŠæŒ‡å®šéç©ºçš„åˆ—æ¥æ”¹å˜é»˜è®¤è¡Œä¸ºï¼ŒæŒ‡å®šåï¼ŒMybatis å°†åªåœ¨è¿™äº›åˆ—ä¸­ä»»æ„ä¸€åˆ—éç©ºæ—¶æ‰åˆ›å»ºä¸€ä¸ªå­å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”æ¥æŒ‡å®šå¤šä¸ªåˆ—ã€‚é»˜è®¤å€¼ï¼šæœªè®¾ç½®ï¼ˆ<code>unset</code>ï¼‰ã€‚</td> </tr> <tr> <td><code>autoMapping</code></td> <td>å¦‚æœè®¾ç½®è¿™ä¸ªå±æ€§ï¼ŒMyBatis å°†ä¼šä¸ºæœ¬ç»“æœæ˜ å°„å¼€å¯æˆ–è€…å…³é—­è‡ªåŠ¨æ˜ å°„ã€‚ è¿™ä¸ªå±æ€§ä¼šè¦†ç›–å…¨å±€çš„å±æ€§ <code>autoMappingBehavior</code>ã€‚æ³¨æ„ï¼Œæœ¬å±æ€§å¯¹å¤–éƒ¨çš„ç»“æœæ˜ å°„æ— æ•ˆï¼Œæ‰€ä»¥ä¸èƒ½æ­é… <code>select</code> æˆ– <code>resultMap</code> å…ƒç´ ä½¿ç”¨ã€‚é»˜è®¤å€¼ï¼šæœªè®¾ç½®ï¼ˆ<code>unset</code>ï¼‰ã€‚</td> </tr> </tbody> </table> <p>ç°åœ¨å°†åšå®¢è¡¨å’Œä½œè€…è¡¨è¿æ¥åœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯æ‰§è¡Œä¸€ä¸ªç‹¬ç«‹çš„æŸ¥è¯¢è¯­å¥ï¼Œå°±åƒè¿™æ ·ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectBlog"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"blogResult"</span><span class="nt">&gt;</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="w">  </span>select
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="w">    </span>B.id<span class="w">            </span>as<span class="w"> </span>blog_id,
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="w">    </span>B.title<span class="w">         </span>as<span class="w"> </span>blog_title,
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="w">    </span>B.author_id<span class="w">     </span>as<span class="w"> </span>blog_author_id,
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="w">    </span>A.id<span class="w">            </span>as<span class="w"> </span>author_id,
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="w">    </span>A.username<span class="w">      </span>as<span class="w"> </span>author_username,
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="w">    </span>A.password<span class="w">      </span>as<span class="w"> </span>author_password,
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="w">    </span>A.email<span class="w">         </span>as<span class="w"> </span>author_email,
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="w">    </span>A.bio<span class="w">           </span>as<span class="w"> </span>author_bio
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="w">  </span>from<span class="w"> </span>Blog<span class="w"> </span>B<span class="w"> </span>left<span class="w"> </span>outer<span class="w"> </span>join<span class="w"> </span>Author<span class="w"> </span>A<span class="w"> </span>on<span class="w"> </span>B.author_id<span class="w"> </span>=<span class="w"> </span>A.id
</span><span id="__span-76-12"><a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a><span class="w">  </span>where<span class="w"> </span>B.id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-76-13"><a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>å¯ä»¥æ˜ å°„è¿™ä¸ªç»“æœï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"blogResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_id"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"title"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_title"</span><span class="nt">/&gt;</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="w">  </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">"author"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_author_id"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"Author"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"authorResult"</span><span class="nt">/&gt;</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="nt">&lt;/resultMap&gt;</span>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"authorResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Author"</span><span class="nt">&gt;</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"username"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_username"</span><span class="nt">/&gt;</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"password"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_password"</span><span class="nt">/&gt;</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"email"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_email"</span><span class="nt">/&gt;</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"bio"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_bio"</span><span class="nt">/&gt;</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåšå®¢ï¼ˆBlogï¼‰ä½œè€…ï¼ˆauthorï¼‰çš„å…³è”å…ƒç´ å§”æ‰˜åä¸º â€œauthorResultâ€ çš„ç»“æœæ˜ å°„æ¥åŠ è½½ä½œè€…å¯¹è±¡çš„å®ä¾‹ã€‚</p> <div class="admonition tip"> <p class="admonition-title">Important</p> <p><code>id</code> å…ƒç´ åœ¨åµŒå¥—ç»“æœæ˜ å°„ä¸­æ‰®æ¼”ç€éå¸¸é‡è¦çš„è§’è‰²ã€‚ä½ åº”è¯¥æ€»æ˜¯æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†ç»“æœçš„å±æ€§ã€‚ è™½ç„¶ï¼Œå³ä½¿ä¸æŒ‡å®šè¿™ä¸ªå±æ€§ï¼ŒMyBatis ä»ç„¶å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯ä¼šäº§ç”Ÿä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚ åªéœ€è¦æŒ‡å®šå¯ä»¥å”¯ä¸€æ ‡è¯†ç»“æœçš„æœ€å°‘å±æ€§ã€‚æ˜¾ç„¶ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸»é”®ï¼ˆå¤åˆä¸»é”®ä¹Ÿå¯ä»¥ï¼‰ã€‚</p> </div> <p>ç°åœ¨ï¼Œä¸Šé¢çš„ç¤ºä¾‹ä½¿ç”¨äº†å¤–éƒ¨çš„ç»“æœæ˜ å°„å…ƒç´ æ¥æ˜ å°„å…³è”ã€‚è¿™ä½¿å¾— Author çš„ç»“æœæ˜ å°„å¯ä»¥è¢«é‡ç”¨ã€‚ å¦‚æœä¸æ‰“ç®—é‡ç”¨å®ƒï¼Œæˆ–è€…ä½ æ›´å–œæ¬¢å°†ä½ æ‰€æœ‰çš„ç»“æœæ˜ å°„æ”¾åœ¨ä¸€ä¸ªå…·æœ‰æè¿°æ€§çš„ç»“æœæ˜ å°„å…ƒç´ ä¸­ï¼Œå¯ä»¥ç›´æ¥å°†ç»“æœæ˜ å°„ä½œä¸ºå­å…ƒç´ åµŒå¥—åœ¨å†…ã€‚è¿™é‡Œç»™å‡ºä½¿ç”¨è¿™ç§æ–¹å¼çš„ç­‰æ•ˆä¾‹å­ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"blogResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_id"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"title"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_title"</span><span class="nt">/&gt;</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="w">  </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">"author"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"Author"</span><span class="nt">&gt;</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="w">    </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"username"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_username"</span><span class="nt">/&gt;</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"password"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_password"</span><span class="nt">/&gt;</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"email"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_email"</span><span class="nt">/&gt;</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"bio"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_bio"</span><span class="nt">/&gt;</span>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">  </span><span class="nt">&lt;/association&gt;</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <p>é‚£å¦‚æœåšå®¢ï¼ˆblogï¼‰æœ‰ä¸€ä¸ªå…±åŒä½œè€…ï¼ˆco-authorï¼‰è¯¥æ€ä¹ˆåŠï¼Ÿselect è¯­å¥çœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·çš„ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectBlog"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"blogResult"</span><span class="nt">&gt;</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="w">  </span>select
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="w">    </span>B.id<span class="w">            </span>as<span class="w"> </span>blog_id,
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="w">    </span>B.title<span class="w">         </span>as<span class="w"> </span>blog_title,
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="w">    </span>A.id<span class="w">            </span>as<span class="w"> </span>author_id,
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="w">    </span>A.username<span class="w">      </span>as<span class="w"> </span>author_username,
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="w">    </span>A.password<span class="w">      </span>as<span class="w"> </span>author_password,
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="w">    </span>A.email<span class="w">         </span>as<span class="w"> </span>author_email,
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="w">    </span>A.bio<span class="w">           </span>as<span class="w"> </span>author_bio,
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="w">    </span>CA.id<span class="w">           </span>as<span class="w"> </span>co_author_id,
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="w">    </span>CA.username<span class="w">     </span>as<span class="w"> </span>co_author_username,
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="w">    </span>CA.password<span class="w">     </span>as<span class="w"> </span>co_author_password,
</span><span id="__span-79-13"><a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="w">    </span>CA.email<span class="w">        </span>as<span class="w"> </span>co_author_email,
</span><span id="__span-79-14"><a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a><span class="w">    </span>CA.bio<span class="w">          </span>as<span class="w"> </span>co_author_bio
</span><span id="__span-79-15"><a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="w">  </span>from<span class="w"> </span>Blog<span class="w"> </span>B
</span><span id="__span-79-16"><a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a><span class="w">  </span>left<span class="w"> </span>outer<span class="w"> </span>join<span class="w"> </span>Author<span class="w"> </span>A<span class="w"> </span>on<span class="w"> </span>B.author_id<span class="w"> </span>=<span class="w"> </span>A.id
</span><span id="__span-79-17"><a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a><span class="w">  </span>left<span class="w"> </span>outer<span class="w"> </span>join<span class="w"> </span>Author<span class="w"> </span>CA<span class="w"> </span>on<span class="w"> </span>B.co_author_id<span class="w"> </span>=<span class="w"> </span>CA.id
</span><span id="__span-79-18"><a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a><span class="w">  </span>where<span class="w"> </span>B.id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-79-19"><a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>å›å¿†ä¸€ä¸‹ï¼ŒAuthor çš„ç»“æœæ˜ å°„å®šä¹‰å¦‚ä¸‹ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"authorResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Author"</span><span class="nt">&gt;</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"username"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_username"</span><span class="nt">/&gt;</span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"password"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_password"</span><span class="nt">/&gt;</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"email"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_email"</span><span class="nt">/&gt;</span>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"bio"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_bio"</span><span class="nt">/&gt;</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <p>ç”±äºç»“æœä¸­çš„åˆ—åä¸ç»“æœæ˜ å°„ä¸­çš„åˆ—åä¸åŒï¼Œéœ€è¦æŒ‡å®š <code>columnPrefix</code> ä»¥ä¾¿é‡å¤ä½¿ç”¨è¯¥ç»“æœæ˜ å°„æ¥æ˜ å°„ co-author çš„ç»“æœï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"blogResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_id"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"title"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_title"</span><span class="nt">/&gt;</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="w">  </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">"author"</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="w">    </span><span class="na">resultMap=</span><span class="s">"authorResult"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="w">  </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">"coAuthor"</span>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="w">    </span><span class="na">resultMap=</span><span class="s">"authorResult"</span>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="w">    </span><span class="na">columnPrefix=</span><span class="s">"co_"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <h5 id="å¤šç»“æœé›†resultset">å¤šç»“æœé›†ï¼ˆResultSetï¼‰<a class="headerlink" href="#å¤šç»“æœé›†resultset" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <table> <thead> <tr> <th>å±æ€§</th> <th>æè¿°</th> </tr> </thead> <tbody> <tr> <td><code>column</code></td> <td>å½“ä½¿ç”¨å¤šä¸ªç»“æœé›†æ—¶ï¼Œè¯¥å±æ€§æŒ‡å®šç»“æœé›†ä¸­ç”¨äºä¸ <code>foreignColumn</code> åŒ¹é…çš„åˆ—ï¼ˆå¤šä¸ªåˆ—åä»¥é€—å·éš”å¼€ï¼‰ï¼Œä»¥è¯†åˆ«å…³ç³»ä¸­çš„çˆ¶ç±»å‹ä¸å­ç±»å‹ã€‚</td> </tr> <tr> <td><code>foreignColumn</code></td> <td>æŒ‡å®šå¤–é”®å¯¹åº”çš„åˆ—åï¼ŒæŒ‡å®šçš„åˆ—å°†ä¸çˆ¶ç±»å‹ä¸­ <code>column</code> çš„ç»™å‡ºçš„åˆ—è¿›è¡ŒåŒ¹é…ã€‚</td> </tr> <tr> <td><code>resultSet</code></td> <td>æŒ‡å®šç”¨äºåŠ è½½å¤æ‚ç±»å‹çš„ç»“æœé›†åå­—ã€‚</td> </tr> </tbody> </table> <p>ä»ç‰ˆæœ¬ 3.2.3 å¼€å§‹ï¼ŒMyBatis æä¾›äº†å¦ä¸€ç§è§£å†³ N+1 æŸ¥è¯¢é—®é¢˜çš„æ–¹æ³•ã€‚</p> <p>æŸäº›æ•°æ®åº“å…è®¸å­˜å‚¨è¿‡ç¨‹è¿”å›å¤šä¸ªç»“æœé›†ï¼Œæˆ–ä¸€æ¬¡æ€§æ‰§è¡Œå¤šä¸ªè¯­å¥ï¼Œæ¯ä¸ªè¯­å¥è¿”å›ä¸€ä¸ªç»“æœé›†ã€‚ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œåœ¨ä¸ä½¿ç”¨è¿æ¥çš„æƒ…å†µä¸‹ï¼Œåªè®¿é—®æ•°æ®åº“ä¸€æ¬¡å°±èƒ½è·å¾—ç›¸å…³æ•°æ®ã€‚</p> <p>åœ¨ä¾‹å­ä¸­ï¼Œå­˜å‚¨è¿‡ç¨‹æ‰§è¡Œä¸‹é¢çš„æŸ¥è¯¢å¹¶è¿”å›ä¸¤ä¸ªç»“æœé›†ã€‚ç¬¬ä¸€ä¸ªç»“æœé›†ä¼šè¿”å›åšå®¢ï¼ˆBlogï¼‰çš„ç»“æœï¼Œç¬¬äºŒä¸ªåˆ™è¿”å›ä½œè€…ï¼ˆAuthorï¼‰çš„ç»“æœï¼š</p> <div class="language-mysql highlight"><span class="filename">MySQL</span><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">BLOG</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">#{id}</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">AUTHOR</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">#{id}</span>
</span></code></pre></div> <p>åœ¨æ˜ å°„è¯­å¥ä¸­ï¼Œå¿…é¡»é€šè¿‡ <code>resultSets</code> å±æ€§ä¸ºæ¯ä¸ªç»“æœé›†æŒ‡å®šä¸€ä¸ªåå­—ï¼Œå¤šä¸ªåå­—ä½¿ç”¨é€—å·éš”å¼€ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectBlog"</span><span class="w"> </span><span class="na">resultSets=</span><span class="s">"blogs,authors"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"blogResult"</span><span class="w"> </span><span class="na">statementType=</span><span class="s">"CALLABLE"</span><span class="nt">&gt;</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="w">  </span>{call<span class="w"> </span>getBlogsAndAuthors(#{id,jdbcType=INTEGER,mode=IN})}
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>ç°åœ¨å¯ä»¥æŒ‡å®šä½¿ç”¨ â€œauthorsâ€ ç»“æœé›†çš„æ•°æ®æ¥å¡«å…… â€œauthorâ€ å…³è”ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"blogResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"title"</span><span class="w"> </span><span class="na">column=</span><span class="s">"title"</span><span class="nt">/&gt;</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="w">  </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">"author"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"Author"</span><span class="w"> </span><span class="na">resultSet=</span><span class="s">"authors"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_id"</span><span class="w"> </span><span class="na">foreignColumn=</span><span class="s">"id"</span><span class="nt">&gt;</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="w">    </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="nt">/&gt;</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"username"</span><span class="w"> </span><span class="na">column=</span><span class="s">"username"</span><span class="nt">/&gt;</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"password"</span><span class="w"> </span><span class="na">column=</span><span class="s">"password"</span><span class="nt">/&gt;</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"email"</span><span class="w"> </span><span class="na">column=</span><span class="s">"email"</span><span class="nt">/&gt;</span>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"bio"</span><span class="w"> </span><span class="na">column=</span><span class="s">"bio"</span><span class="nt">/&gt;</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="w">  </span><span class="nt">&lt;/association&gt;</span>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <h4 id="345é›†åˆ">3.4.5ã€é›†åˆ<a class="headerlink" href="#345é›†åˆ" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">"posts"</span><span class="w"> </span><span class="na">ofType=</span><span class="s">"domain.blog.Post"</span><span class="nt">&gt;</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"post_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"subject"</span><span class="w"> </span><span class="na">column=</span><span class="s">"post_subject"</span><span class="nt">/&gt;</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"body"</span><span class="w"> </span><span class="na">column=</span><span class="s">"post_body"</span><span class="nt">/&gt;</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="nt">&lt;/collection&gt;</span>
</span></code></pre></div> <p>é›†åˆå…ƒç´ å’Œå…³è”å…ƒç´ å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚</p> <p>ç»§ç»­ä¸Šé¢çš„ç¤ºä¾‹ï¼Œä¸€ä¸ªåšå®¢ï¼ˆBlogï¼‰åªæœ‰ä¸€ä¸ªä½œè€…ï¼ˆAuthor)ã€‚ä½†ä¸€ä¸ªåšå®¢æœ‰å¾ˆå¤šæ–‡ç« ï¼ˆPost)ã€‚ åœ¨åšå®¢ç±»ä¸­ï¼Œè¿™å¯ä»¥ç”¨ä¸‹é¢çš„å†™æ³•æ¥è¡¨ç¤ºï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;</span><span class="w"> </span><span class="n">posts</span><span class="p">;</span>
</span></code></pre></div> <p>è¦åƒä¸Šé¢è¿™æ ·ï¼Œæ˜ å°„åµŒå¥—ç»“æœé›†åˆåˆ°ä¸€ä¸ª List ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é›†åˆå…ƒç´ ã€‚ å’Œå…³è”å…ƒç´ ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨åµŒå¥— Select æŸ¥è¯¢ï¼Œæˆ–åŸºäºè¿æ¥çš„åµŒå¥—ç»“æœæ˜ å°„é›†åˆã€‚</p> <h5 id="åµŒå¥—-select-æŸ¥è¯¢_1">åµŒå¥— Select æŸ¥è¯¢<a class="headerlink" href="#åµŒå¥—-select-æŸ¥è¯¢_1" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <p>ä½¿ç”¨åµŒå¥— Select æŸ¥è¯¢æ¥ä¸ºåšå®¢åŠ è½½æ–‡ç« ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"blogResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="w">  </span><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">"posts"</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"ArrayList"</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="w"> </span><span class="na">ofType=</span><span class="s">"Post"</span><span class="w"> </span><span class="na">select=</span><span class="s">"selectPostsForBlog"</span><span class="nt">/&gt;</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="nt">&lt;/resultMap&gt;</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectBlog"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"blogResult"</span><span class="nt">&gt;</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">  </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>BLOG<span class="w"> </span>WHERE<span class="w"> </span>ID<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="nt">&lt;/select&gt;</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectPostsForBlog"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"Post"</span><span class="nt">&gt;</span>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w">  </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>POST<span class="w"> </span>WHERE<span class="w"> </span>BLOG_ID<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>å¤§éƒ¨åˆ†éƒ½å’Œä¸Šé¢çš„å…³è”å…ƒç´ éå¸¸ç›¸ä¼¼ï¼Œé›†åˆæœ‰ä¸€ä¸ªæ–°çš„ <code>ofType</code> å±æ€§ï¼Œè¿™ä¸ªå±æ€§éå¸¸é‡è¦ï¼Œå®ƒç”¨æ¥å°† JavaBeanï¼ˆæˆ–å­—æ®µï¼‰å±æ€§çš„ç±»å‹å’Œé›†åˆå­˜å‚¨çš„ç±»å‹åŒºåˆ†å¼€æ¥ã€‚ æ‰€ä»¥å¯ä»¥æŒ‰ç…§ä¸‹é¢è¿™æ ·æ¥é˜…è¯»æ˜ å°„ï¼š â€œposts æ˜¯ä¸€ä¸ªå­˜å‚¨ Post çš„ ArrayList é›†åˆâ€ã€‚</p> <p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒMyBatis å¯ä»¥æ¨æ–­ <code>javaType</code> å±æ€§ï¼Œå› æ­¤å¹¶ä¸éœ€è¦å¡«å†™ã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™å¯ä»¥ç®€ç•¥æˆï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">"posts"</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="w"> </span><span class="na">ofType=</span><span class="s">"Post"</span><span class="w"> </span><span class="na">select=</span><span class="s">"selectPostsForBlog"</span><span class="nt">/&gt;</span>
</span></code></pre></div> <h5 id="åµŒå¥—ç»“æœæ˜ å°„_1">åµŒå¥—ç»“æœæ˜ å°„<a class="headerlink" href="#åµŒå¥—ç»“æœæ˜ å°„_1" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <p>é›†åˆçš„åµŒå¥—ç»“æœæ˜ å°„é™¤äº†æ–°å¢çš„ <code>ofType</code> å±æ€§ï¼Œå…¶ä»–å’Œå…³è”çš„å®Œå…¨ç›¸åŒã€‚</p> <p>å¯¹åº”çš„ SQL è¯­å¥ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectBlog"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"blogResult"</span><span class="nt">&gt;</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="w">  </span>select
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="w">  </span>B.id<span class="w"> </span>as<span class="w"> </span>blog_id,
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="w">  </span>B.title<span class="w"> </span>as<span class="w"> </span>blog_title,
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="w">  </span>B.author_id<span class="w"> </span>as<span class="w"> </span>blog_author_id,
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="w">  </span>P.id<span class="w"> </span>as<span class="w"> </span>post_id,
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="w">  </span>P.subject<span class="w"> </span>as<span class="w"> </span>post_subject,
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="w">  </span>P.body<span class="w"> </span>as<span class="w"> </span>post_body,
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="w">  </span>from<span class="w"> </span>Blog<span class="w"> </span>B
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="w">  </span>left<span class="w"> </span>outer<span class="w"> </span>join<span class="w"> </span>Post<span class="w"> </span>P<span class="w"> </span>on<span class="w"> </span>B.id<span class="w"> </span>=<span class="w"> </span>P.blog_id
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="w">  </span>where<span class="w"> </span>B.id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>è¦æ˜ å°„åšå®¢é‡Œé¢çš„æ–‡ç« é›†åˆï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"blogResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_id"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"title"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_title"</span><span class="nt">/&gt;</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="w">  </span><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">"posts"</span><span class="w"> </span><span class="na">ofType=</span><span class="s">"Post"</span><span class="nt">&gt;</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="w">    </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"post_id"</span><span class="nt">/&gt;</span>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"subject"</span><span class="w"> </span><span class="na">column=</span><span class="s">"post_subject"</span><span class="nt">/&gt;</span>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"body"</span><span class="w"> </span><span class="na">column=</span><span class="s">"post_body"</span><span class="nt">/&gt;</span>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="w">  </span><span class="nt">&lt;/collection&gt;</span>
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <p>å¦‚æœä½ å–œæ¬¢æ›´è¯¦ç•¥çš„ã€å¯é‡ç”¨çš„ç»“æœæ˜ å°„ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç­‰ä»·å½¢å¼ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"blogResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_id"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"title"</span><span class="w"> </span><span class="na">column=</span><span class="s">"blog_title"</span><span class="nt">/&gt;</span>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="w">  </span><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">"posts"</span><span class="w"> </span><span class="na">ofType=</span><span class="s">"Post"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"blogPostResult"</span><span class="w"> </span><span class="na">columnPrefix=</span><span class="s">"post_"</span><span class="nt">/&gt;</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="nt">&lt;/resultMap&gt;</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"blogPostResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Post"</span><span class="nt">&gt;</span>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="nt">/&gt;</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"subject"</span><span class="w"> </span><span class="na">column=</span><span class="s">"subject"</span><span class="nt">/&gt;</span>
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"body"</span><span class="w"> </span><span class="na">column=</span><span class="s">"body"</span><span class="nt">/&gt;</span>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <h5 id="å¤šç»“æœé›†resultset_1">å¤šç»“æœé›†ï¼ˆResultSetï¼‰<a class="headerlink" href="#å¤šç»“æœé›†resultset_1" title="é”šç‚¹é“¾æ¥">Â¶</a></h5> <p>åƒå…³è”å…ƒç´ é‚£æ ·å¯ä»¥é€šè¿‡æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹å®ç°ï¼Œå®ƒä¼šæ‰§è¡Œä¸¤ä¸ªæŸ¥è¯¢å¹¶è¿”å›ä¸¤ä¸ªç»“æœé›†ï¼Œä¸€ä¸ªæ˜¯åšå®¢çš„ç»“æœé›†ï¼Œå¦ä¸€ä¸ªæ˜¯æ–‡ç« çš„ç»“æœé›†ï¼š</p> <div class="language-mysql highlight"><span class="filename">MySQL</span><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">BLOG</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">#{id}</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">BLOG_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">#{id}</span>
</span></code></pre></div> <p>åœ¨æ˜ å°„è¯­å¥ä¸­ï¼Œå¿…é¡»é€šè¿‡ <code>resultSets</code> å±æ€§ä¸ºæ¯ä¸ªç»“æœé›†æŒ‡å®šä¸€ä¸ªåå­—ï¼Œå¤šä¸ªåå­—ä½¿ç”¨é€—å·éš”å¼€ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectBlog"</span><span class="w"> </span><span class="na">resultSets=</span><span class="s">"blogs,posts"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"blogResult"</span><span class="nt">&gt;</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="w">  </span>{call<span class="w"> </span>getBlogsAndPosts(#{id,jdbcType=INTEGER,mode=IN})}
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>æŒ‡å®š â€œpostsâ€ é›†åˆå°†ä¼šä½¿ç”¨å­˜å‚¨åœ¨ â€œpostsâ€ ç»“æœé›†ä¸­çš„æ•°æ®è¿›è¡Œå¡«å……ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"blogResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"title"</span><span class="w"> </span><span class="na">column=</span><span class="s">"title"</span><span class="nt">/&gt;</span>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="w">  </span><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">"posts"</span><span class="w"> </span><span class="na">ofType=</span><span class="s">"Post"</span><span class="w"> </span><span class="na">resultSet=</span><span class="s">"posts"</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="w"> </span><span class="na">foreignColumn=</span><span class="s">"blog_id"</span><span class="nt">&gt;</span>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="w">    </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="nt">/&gt;</span>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"subject"</span><span class="w"> </span><span class="na">column=</span><span class="s">"subject"</span><span class="nt">/&gt;</span>
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="w">    </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"body"</span><span class="w"> </span><span class="na">column=</span><span class="s">"body"</span><span class="nt">/&gt;</span>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="w">  </span><span class="nt">&lt;/collection&gt;</span>
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <h4 id="346é‰´åˆ«å™¨">3.4.6ã€é‰´åˆ«å™¨<a class="headerlink" href="#346é‰´åˆ«å™¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="nt">&lt;discriminator</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"int"</span><span class="w"> </span><span class="na">column=</span><span class="s">"draft"</span><span class="nt">&gt;</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">  </span><span class="nt">&lt;case</span><span class="w"> </span><span class="na">value=</span><span class="s">"1"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"DraftPost"</span><span class="nt">/&gt;</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="nt">&lt;/discriminator&gt;</span>
</span></code></pre></div> <p>æœ‰æ—¶å€™ï¼Œä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢å¯èƒ½ä¼šè¿”å›å¤šä¸ªä¸åŒçš„ç»“æœé›†ï¼ˆä½†æ€»ä½“ä¸Šè¿˜æ˜¯æœ‰ä¸€å®šçš„è”ç³»çš„ï¼‰ã€‚ é‰´åˆ«å™¨ï¼ˆdiscriminatorï¼‰å…ƒç´ å°±æ˜¯è¢«è®¾è®¡æ¥åº”å¯¹è¿™ç§æƒ…å†µçš„ï¼Œå¦å¤–ä¹Ÿèƒ½å¤„ç†å…¶å®ƒæƒ…å†µï¼Œä¾‹å¦‚ç±»çš„ç»§æ‰¿å±‚æ¬¡ç»“æ„ã€‚ é‰´åˆ«å™¨çš„æ¦‚å¿µå¾ˆå¥½ç†è§£â€”â€”å®ƒå¾ˆåƒ Java è¯­è¨€ä¸­çš„ switch è¯­å¥ã€‚</p> <p>ä¸€ä¸ªé‰´åˆ«å™¨çš„å®šä¹‰éœ€è¦æŒ‡å®š column å’Œ javaType å±æ€§ã€‚column æŒ‡å®šäº† MyBatis æŸ¥è¯¢è¢«æ¯”è¾ƒå€¼çš„åœ°æ–¹ã€‚ è€Œ javaType ç”¨æ¥ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç›¸ç­‰æµ‹è¯•ï¼ˆè™½ç„¶å¾ˆå¤šæƒ…å†µä¸‹å­—ç¬¦ä¸²çš„ç›¸ç­‰æµ‹è¯•éƒ½å¯ä»¥å·¥ä½œï¼‰ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"vehicleResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Vehicle"</span><span class="nt">&gt;</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"vin"</span><span class="w"> </span><span class="na">column=</span><span class="s">"vin"</span><span class="nt">/&gt;</span>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"year"</span><span class="w"> </span><span class="na">column=</span><span class="s">"year"</span><span class="nt">/&gt;</span>
</span><span id="__span-96-5"><a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"make"</span><span class="w"> </span><span class="na">column=</span><span class="s">"make"</span><span class="nt">/&gt;</span>
</span><span id="__span-96-6"><a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"model"</span><span class="w"> </span><span class="na">column=</span><span class="s">"model"</span><span class="nt">/&gt;</span>
</span><span id="__span-96-7"><a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"color"</span><span class="w"> </span><span class="na">column=</span><span class="s">"color"</span><span class="nt">/&gt;</span>
</span><span id="__span-96-8"><a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a><span class="w">  </span><span class="nt">&lt;discriminator</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"int"</span><span class="w"> </span><span class="na">column=</span><span class="s">"vehicle_type"</span><span class="nt">&gt;</span>
</span><span id="__span-96-9"><a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a><span class="w">    </span><span class="nt">&lt;case</span><span class="w"> </span><span class="na">value=</span><span class="s">"1"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"carResult"</span><span class="nt">/&gt;</span>
</span><span id="__span-96-10"><a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="w">    </span><span class="nt">&lt;case</span><span class="w"> </span><span class="na">value=</span><span class="s">"2"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"truckResult"</span><span class="nt">/&gt;</span>
</span><span id="__span-96-11"><a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a><span class="w">    </span><span class="nt">&lt;case</span><span class="w"> </span><span class="na">value=</span><span class="s">"3"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"vanResult"</span><span class="nt">/&gt;</span>
</span><span id="__span-96-12"><a id="__codelineno-96-12" name="__codelineno-96-12" href="#__codelineno-96-12"></a><span class="w">    </span><span class="nt">&lt;case</span><span class="w"> </span><span class="na">value=</span><span class="s">"4"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"suvResult"</span><span class="nt">/&gt;</span>
</span><span id="__span-96-13"><a id="__codelineno-96-13" name="__codelineno-96-13" href="#__codelineno-96-13"></a><span class="w">  </span><span class="nt">&lt;/discriminator&gt;</span>
</span><span id="__span-96-14"><a id="__codelineno-96-14" name="__codelineno-96-14" href="#__codelineno-96-14"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒMyBatis ä¼šä»ç»“æœé›†ä¸­å¾—åˆ°æ¯æ¡è®°å½•ï¼Œç„¶åæ¯”è¾ƒå®ƒçš„ vehicle type å€¼ã€‚ å¦‚æœå®ƒåŒ¹é…ä»»æ„ä¸€ä¸ªé‰´åˆ«å™¨çš„ caseï¼Œå°±ä¼šä½¿ç”¨è¿™ä¸ª case æŒ‡å®šçš„ç»“æœæ˜ å°„ã€‚ è¿™ä¸ªè¿‡ç¨‹æ˜¯äº’æ–¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‰©ä½™çš„ç»“æœæ˜ å°„å°†è¢«å¿½ç•¥ï¼ˆé™¤éå®ƒæ˜¯æ‰©å±•çš„ï¼Œæˆ‘ä»¬å°†åœ¨ç¨åè®¨è®ºå®ƒï¼‰ã€‚ å¦‚æœä¸èƒ½åŒ¹é…ä»»ä½•ä¸€ä¸ª caseï¼ŒMyBatis å°±åªä¼šä½¿ç”¨é‰´åˆ«å™¨å—å¤–å®šä¹‰çš„ç»“æœæ˜ å°„ã€‚ æ‰€ä»¥ï¼Œå¦‚æœ carResult çš„å£°æ˜å¦‚ä¸‹ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"carResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Car"</span><span class="nt">&gt;</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"doorCount"</span><span class="w"> </span><span class="na">column=</span><span class="s">"door_count"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <p>é‚£ä¹ˆåªæœ‰ doorCount å±æ€§ä¼šè¢«åŠ è½½ã€‚è¿™æ˜¯ä¸ºäº†å³ä½¿é‰´åˆ«å™¨çš„ case ä¹‹é—´éƒ½èƒ½åˆ†ä¸ºå®Œå…¨ç‹¬ç«‹çš„ä¸€ç»„ï¼Œå°½ç®¡å’Œçˆ¶ç»“æœæ˜ å°„å¯èƒ½æ²¡æœ‰ä»€ä¹ˆå…³ç³»ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å½“ç„¶çŸ¥é“ cars å’Œ vehicles ä¹‹é—´æœ‰å…³ç³»ï¼Œä¹Ÿå°±æ˜¯ Car æ˜¯ä¸€ä¸ª Vehicleã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›å‰©ä½™çš„å±æ€§ä¹Ÿèƒ½è¢«åŠ è½½ã€‚è€Œè¿™åªéœ€è¦ä¸€ä¸ªå°ä¿®æ”¹ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"carResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Car"</span><span class="w"> </span><span class="na">extends=</span><span class="s">"vehicleResult"</span><span class="nt">&gt;</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"doorCount"</span><span class="w"> </span><span class="na">column=</span><span class="s">"door_count"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <p>ç°åœ¨ vehicleResult å’Œ carResult çš„å±æ€§éƒ½ä¼šè¢«åŠ è½½äº†ã€‚</p> <p>å¯èƒ½æœ‰äººåˆä¼šè§‰å¾—æ˜ å°„çš„å¤–éƒ¨å®šä¹‰æœ‰ç‚¹å¤ªå†—é•¿äº†ã€‚ å› æ­¤ï¼Œå¯¹äºé‚£äº›æ›´å–œæ¬¢ç®€æ´çš„æ˜ å°„é£æ ¼çš„äººæ¥è¯´ï¼Œè¿˜æœ‰å¦ä¸€ç§è¯­æ³•å¯ä»¥é€‰æ‹©ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"vehicleResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Vehicle"</span><span class="nt">&gt;</span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="w">  </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">"id"</span><span class="w"> </span><span class="na">column=</span><span class="s">"id"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"vin"</span><span class="w"> </span><span class="na">column=</span><span class="s">"vin"</span><span class="nt">/&gt;</span>
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"year"</span><span class="w"> </span><span class="na">column=</span><span class="s">"year"</span><span class="nt">/&gt;</span>
</span><span id="__span-99-5"><a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"make"</span><span class="w"> </span><span class="na">column=</span><span class="s">"make"</span><span class="nt">/&gt;</span>
</span><span id="__span-99-6"><a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"model"</span><span class="w"> </span><span class="na">column=</span><span class="s">"model"</span><span class="nt">/&gt;</span>
</span><span id="__span-99-7"><a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"color"</span><span class="w"> </span><span class="na">column=</span><span class="s">"color"</span><span class="nt">/&gt;</span>
</span><span id="__span-99-8"><a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a><span class="w">  </span><span class="nt">&lt;discriminator</span><span class="w"> </span><span class="na">javaType=</span><span class="s">"int"</span><span class="w"> </span><span class="na">column=</span><span class="s">"vehicle_type"</span><span class="nt">&gt;</span>
</span><span id="__span-99-9"><a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a><span class="w">    </span><span class="nt">&lt;case</span><span class="w"> </span><span class="na">value=</span><span class="s">"1"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"carResult"</span><span class="nt">&gt;</span>
</span><span id="__span-99-10"><a id="__codelineno-99-10" name="__codelineno-99-10" href="#__codelineno-99-10"></a><span class="w">      </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"doorCount"</span><span class="w"> </span><span class="na">column=</span><span class="s">"door_count"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-99-11"><a id="__codelineno-99-11" name="__codelineno-99-11" href="#__codelineno-99-11"></a><span class="w">    </span><span class="nt">&lt;/case&gt;</span>
</span><span id="__span-99-12"><a id="__codelineno-99-12" name="__codelineno-99-12" href="#__codelineno-99-12"></a><span class="w">    </span><span class="nt">&lt;case</span><span class="w"> </span><span class="na">value=</span><span class="s">"2"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"truckResult"</span><span class="nt">&gt;</span>
</span><span id="__span-99-13"><a id="__codelineno-99-13" name="__codelineno-99-13" href="#__codelineno-99-13"></a><span class="w">      </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"boxSize"</span><span class="w"> </span><span class="na">column=</span><span class="s">"box_size"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-99-14"><a id="__codelineno-99-14" name="__codelineno-99-14" href="#__codelineno-99-14"></a><span class="w">      </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"extendedCab"</span><span class="w"> </span><span class="na">column=</span><span class="s">"extended_cab"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-99-15"><a id="__codelineno-99-15" name="__codelineno-99-15" href="#__codelineno-99-15"></a><span class="w">    </span><span class="nt">&lt;/case&gt;</span>
</span><span id="__span-99-16"><a id="__codelineno-99-16" name="__codelineno-99-16" href="#__codelineno-99-16"></a><span class="w">    </span><span class="nt">&lt;case</span><span class="w"> </span><span class="na">value=</span><span class="s">"3"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"vanResult"</span><span class="nt">&gt;</span>
</span><span id="__span-99-17"><a id="__codelineno-99-17" name="__codelineno-99-17" href="#__codelineno-99-17"></a><span class="w">      </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"powerSlidingDoor"</span><span class="w"> </span><span class="na">column=</span><span class="s">"power_sliding_door"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-99-18"><a id="__codelineno-99-18" name="__codelineno-99-18" href="#__codelineno-99-18"></a><span class="w">    </span><span class="nt">&lt;/case&gt;</span>
</span><span id="__span-99-19"><a id="__codelineno-99-19" name="__codelineno-99-19" href="#__codelineno-99-19"></a><span class="w">    </span><span class="nt">&lt;case</span><span class="w"> </span><span class="na">value=</span><span class="s">"4"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"suvResult"</span><span class="nt">&gt;</span>
</span><span id="__span-99-20"><a id="__codelineno-99-20" name="__codelineno-99-20" href="#__codelineno-99-20"></a><span class="w">      </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"allWheelDrive"</span><span class="w"> </span><span class="na">column=</span><span class="s">"all_wheel_drive"</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-99-21"><a id="__codelineno-99-21" name="__codelineno-99-21" href="#__codelineno-99-21"></a><span class="w">    </span><span class="nt">&lt;/case&gt;</span>
</span><span id="__span-99-22"><a id="__codelineno-99-22" name="__codelineno-99-22" href="#__codelineno-99-22"></a><span class="w">  </span><span class="nt">&lt;/discriminator&gt;</span>
</span><span id="__span-99-23"><a id="__codelineno-99-23" name="__codelineno-99-23" href="#__codelineno-99-23"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <h3 id="35è‡ªåŠ¨æ˜ å°„">3.5ã€è‡ªåŠ¨æ˜ å°„<a class="headerlink" href="#35è‡ªåŠ¨æ˜ å°„" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æ­£å¦‚ä½ åœ¨å‰é¢ä¸€èŠ‚çœ‹åˆ°çš„ï¼Œåœ¨ç®€å•çš„åœºæ™¯ä¸‹ï¼ŒMyBatis å¯ä»¥ä¸ºä½ è‡ªåŠ¨æ˜ å°„æŸ¥è¯¢ç»“æœã€‚ä½†å¦‚æœé‡åˆ°å¤æ‚çš„åœºæ™¯ï¼Œä½ éœ€è¦æ„å»ºä¸€ä¸ªç»“æœæ˜ å°„ã€‚ ä½†æ˜¯åœ¨æœ¬èŠ‚ä¸­ï¼Œä½ å°†çœ‹åˆ°ï¼Œä½ å¯ä»¥æ··åˆä½¿ç”¨è¿™ä¸¤ç§ç­–ç•¥ã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹è‡ªåŠ¨æ˜ å°„æ˜¯æ€æ ·å·¥ä½œçš„ã€‚</p> <p>å½“è‡ªåŠ¨æ˜ å°„æŸ¥è¯¢ç»“æœæ—¶ï¼ŒMyBatis ä¼šè·å–ç»“æœä¸­è¿”å›çš„åˆ—åå¹¶åœ¨ Java ç±»ä¸­æŸ¥æ‰¾ç›¸åŒåå­—çš„å±æ€§ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰ã€‚ è¿™æ„å‘³ç€å¦‚æœå‘ç°äº† <em>ID</em> åˆ—å’Œ <em>id</em> å±æ€§ï¼ŒMyBatis ä¼šå°†åˆ— <em>ID</em> çš„å€¼èµ‹ç»™ <em>id</em> å±æ€§ã€‚</p> <p>é€šå¸¸æ•°æ®åº“åˆ—ä½¿ç”¨å¤§å†™å­—æ¯ç»„æˆçš„å•è¯å‘½åï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼›è€Œ Java å±æ€§ä¸€èˆ¬éµå¾ªé©¼å³°å‘½åæ³•çº¦å®šã€‚ä¸ºäº†åœ¨è¿™ä¸¤ç§å‘½åæ–¹å¼ä¹‹é—´å¯ç”¨è‡ªåŠ¨æ˜ å°„ï¼Œéœ€è¦å°† <code>mapUnderscoreToCamelCase</code> è®¾ç½®ä¸º trueã€‚</p> <p>ç”šè‡³åœ¨æä¾›äº†ç»“æœæ˜ å°„åï¼Œè‡ªåŠ¨æ˜ å°„ä¹Ÿèƒ½å·¥ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºæ¯ä¸€ä¸ªç»“æœæ˜ å°„ï¼Œåœ¨ ResultSet å‡ºç°çš„åˆ—ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®æ‰‹åŠ¨æ˜ å°„ï¼Œå°†è¢«è‡ªåŠ¨æ˜ å°„ã€‚åœ¨è‡ªåŠ¨æ˜ å°„å¤„ç†å®Œæ¯•åï¼Œå†å¤„ç†æ‰‹åŠ¨æ˜ å°„ã€‚ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ<em>id</em> å’Œ <em>userName</em> åˆ—å°†è¢«è‡ªåŠ¨æ˜ å°„ï¼Œ<em>hashed_password</em> åˆ—å°†æ ¹æ®é…ç½®è¿›è¡Œæ˜ å°„ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectUsers"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"userResultMap"</span><span class="nt">&gt;</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="w">  </span>select
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="w">    </span>user_id<span class="w">             </span>as<span class="w"> </span>"id",
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="w">    </span>user_name<span class="w">           </span>as<span class="w"> </span>"userName",
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="w">    </span>hashed_password
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="w">  </span>from<span class="w"> </span>some_table
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="w">  </span>where<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-100-8"><a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"userResultMap"</span><span class="w"> </span><span class="na">type=</span><span class="s">"User"</span><span class="nt">&gt;</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"password"</span><span class="w"> </span><span class="na">column=</span><span class="s">"hashed_password"</span><span class="nt">/&gt;</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <p>æœ‰ä¸‰ç§è‡ªåŠ¨æ˜ å°„ç­‰çº§ï¼š</p> <ul> <li><code>NONE</code> - ç¦ç”¨è‡ªåŠ¨æ˜ å°„ã€‚ä»…å¯¹æ‰‹åŠ¨æ˜ å°„çš„å±æ€§è¿›è¡Œæ˜ å°„ã€‚</li> <li><code>PARTIAL</code> - å¯¹é™¤åœ¨å†…éƒ¨å®šä¹‰äº†åµŒå¥—ç»“æœæ˜ å°„ï¼ˆä¹Ÿå°±æ˜¯è¿æ¥çš„å±æ€§ï¼‰ä»¥å¤–çš„å±æ€§è¿›è¡Œæ˜ å°„</li> <li><code>FULL</code> - è‡ªåŠ¨æ˜ å°„æ‰€æœ‰å±æ€§ã€‚</li> </ul> <p>é»˜è®¤å€¼æ˜¯ <code>PARTIAL</code>ï¼Œè¿™æ˜¯æœ‰åŸå› çš„ã€‚å½“å¯¹è¿æ¥æŸ¥è¯¢çš„ç»“æœä½¿ç”¨ <code>FULL</code> æ—¶ï¼Œè¿æ¥æŸ¥è¯¢ä¼šåœ¨åŒä¸€è¡Œä¸­è·å–å¤šä¸ªä¸åŒå®ä½“çš„æ•°æ®ï¼Œå› æ­¤å¯èƒ½å¯¼è‡´éé¢„æœŸçš„æ˜ å°„ã€‚ ä¸‹é¢çš„ä¾‹å­å°†å±•ç¤ºè¿™ç§é£é™©ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectBlog"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"blogResult"</span><span class="nt">&gt;</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="w">  </span>select
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="w">    </span>B.id,
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="w">    </span>B.title,
</span><span id="__span-102-5"><a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a><span class="w">    </span>A.username,
</span><span id="__span-102-6"><a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="w">  </span>from<span class="w"> </span>Blog<span class="w"> </span>B<span class="w"> </span>left<span class="w"> </span>outer<span class="w"> </span>join<span class="w"> </span>Author<span class="w"> </span>A<span class="w"> </span>on<span class="w"> </span>B.author_id<span class="w"> </span>=<span class="w"> </span>A.id
</span><span id="__span-102-7"><a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a><span class="w">  </span>where<span class="w"> </span>B.id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-102-8"><a id="__codelineno-102-8" name="__codelineno-102-8" href="#__codelineno-102-8"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"blogResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="w">  </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">"author"</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">"authorResult"</span><span class="nt">/&gt;</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="nt">&lt;/resultMap&gt;</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a>
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"authorResult"</span><span class="w"> </span><span class="na">type=</span><span class="s">"Author"</span><span class="nt">&gt;</span>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"username"</span><span class="w"> </span><span class="na">column=</span><span class="s">"author_username"</span><span class="nt">/&gt;</span>
</span><span id="__span-103-7"><a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="nt">&lt;/resultMap&gt;</span>
</span></code></pre></div> <p>åœ¨è¯¥ç»“æœæ˜ å°„ä¸­ï¼Œ<em>Blog</em> å’Œ <em>Author</em> å‡å°†è¢«è‡ªåŠ¨æ˜ å°„ã€‚ä½†æ˜¯æ³¨æ„ <em>Author</em> æœ‰ä¸€ä¸ª <em>id</em> å±æ€§ï¼Œåœ¨ ResultSet ä¸­ä¹Ÿæœ‰ä¸€ä¸ªåä¸º <em>id</em> çš„åˆ—ï¼Œæ‰€ä»¥ Author çš„ id å°†å¡«å…¥ Blog çš„ idï¼Œè¿™å¯ä¸æ˜¯ä½ æœŸæœ›çš„è¡Œä¸ºã€‚ æ‰€ä»¥ï¼Œè¦è°¨æ…ä½¿ç”¨ <code>FULL</code>ã€‚</p> <p>æ— è®ºè®¾ç½®çš„è‡ªåŠ¨æ˜ å°„ç­‰çº§æ˜¯å“ªç§ï¼Œä½ éƒ½å¯ä»¥é€šè¿‡åœ¨ç»“æœæ˜ å°„ä¸Šè®¾ç½® <code>autoMapping</code> å±æ€§æ¥ä¸ºæŒ‡å®šçš„ç»“æœæ˜ å°„è®¾ç½®å¯ç”¨/ç¦ç”¨è‡ªåŠ¨æ˜ å°„ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">"userResultMap"</span><span class="w"> </span><span class="na">type=</span><span class="s">"User"</span><span class="w"> </span><span class="na">autoMapping=</span><span class="s">"false"</span><span class="nt">&gt;</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="w">  </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">"password"</span><span class="w"> </span><span class="na">column=</span><span class="s">"hashed_password"</span><span class="nt">/&gt;</span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="nt">&lt;/resultMp&gt;</span>
</span></code></pre></div> <h3 id="36ç¼“å­˜">3.6ã€ç¼“å­˜<a class="headerlink" href="#36ç¼“å­˜" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>MyBatis å†…ç½®äº†ä¸€ä¸ªå¼ºå¤§çš„äº‹åŠ¡æ€§æŸ¥è¯¢ç¼“å­˜æœºåˆ¶ï¼Œå®ƒå¯ä»¥éå¸¸æ–¹ä¾¿åœ°é…ç½®å’Œå®šåˆ¶ã€‚ ä¸ºäº†ä½¿å®ƒæ›´åŠ å¼ºå¤§è€Œä¸”æ˜“äºé…ç½®ï¼Œæˆ‘ä»¬å¯¹ MyBatis 3 ä¸­çš„ç¼“å­˜å®ç°è¿›è¡Œäº†è®¸å¤šæ”¹è¿›ã€‚</p> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªå¯ç”¨äº†æœ¬åœ°çš„ä¼šè¯ç¼“å­˜ï¼Œå®ƒä»…ä»…å¯¹ä¸€ä¸ªä¼šè¯ä¸­çš„æ•°æ®è¿›è¡Œç¼“å­˜ã€‚ è¦å¯ç”¨å…¨å±€çš„äºŒçº§ç¼“å­˜ï¼Œåªéœ€è¦åœ¨ä½ çš„ SQL æ˜ å°„æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="nt">&lt;cache/&gt;</span>
</span></code></pre></div> <p>åŸºæœ¬ä¸Šå°±æ˜¯è¿™æ ·ã€‚è¿™ä¸ªç®€å•è¯­å¥çš„æ•ˆæœå¦‚ä¸‹:</p> <ul> <li>æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰ select è¯­å¥çš„ç»“æœå°†ä¼šè¢«ç¼“å­˜ã€‚</li> <li>æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰ insertã€update å’Œ delete è¯­å¥ä¼šåˆ·æ–°ç¼“å­˜ã€‚</li> <li>ç¼“å­˜ä¼šä½¿ç”¨æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼ˆLRU, Least Recently Usedï¼‰ç®—æ³•æ¥æ¸…é™¤ä¸éœ€è¦çš„ç¼“å­˜ã€‚</li> <li>ç¼“å­˜ä¸ä¼šå®šæ—¶è¿›è¡Œåˆ·æ–°ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰åˆ·æ–°é—´éš”ï¼‰ã€‚</li> <li>ç¼“å­˜ä¼šä¿å­˜åˆ—è¡¨æˆ–å¯¹è±¡ï¼ˆæ— è®ºæŸ¥è¯¢æ–¹æ³•è¿”å›å“ªç§ï¼‰çš„ 1024 ä¸ªå¼•ç”¨ã€‚</li> <li>ç¼“å­˜ä¼šè¢«è§†ä¸ºè¯»/å†™ç¼“å­˜ï¼Œè¿™æ„å‘³ç€è·å–åˆ°çš„å¯¹è±¡å¹¶ä¸æ˜¯å…±äº«çš„ï¼Œå¯ä»¥å®‰å…¨åœ°è¢«è°ƒç”¨è€…ä¿®æ”¹ï¼Œè€Œä¸å¹²æ‰°å…¶ä»–è°ƒç”¨è€…æˆ–çº¿ç¨‹æ‰€åšçš„æ½œåœ¨ä¿®æ”¹ã€‚</li> </ul> <p><strong>æç¤º</strong> ç¼“å­˜åªä½œç”¨äº cache æ ‡ç­¾æ‰€åœ¨çš„æ˜ å°„æ–‡ä»¶ä¸­çš„è¯­å¥ã€‚å¦‚æœä½ æ··åˆä½¿ç”¨ Java API å’Œ XML æ˜ å°„æ–‡ä»¶ï¼Œåœ¨å…±ç”¨æ¥å£ä¸­çš„è¯­å¥å°†ä¸ä¼šè¢«é»˜è®¤ç¼“å­˜ã€‚ä½ éœ€è¦ä½¿ç”¨ @CacheNamespaceRef æ³¨è§£æŒ‡å®šç¼“å­˜ä½œç”¨åŸŸã€‚</p> <p>è¿™äº›å±æ€§å¯ä»¥é€šè¿‡ cache å…ƒç´ çš„å±æ€§æ¥ä¿®æ”¹ã€‚æ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="nt">&lt;cache</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="w">  </span><span class="na">eviction=</span><span class="s">"FIFO"</span>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="w">  </span><span class="na">flushInterval=</span><span class="s">"60000"</span>
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="w">  </span><span class="na">size=</span><span class="s">"512"</span>
</span><span id="__span-106-5"><a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="w">  </span><span class="na">readOnly=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
</span></code></pre></div> <p>è¿™ä¸ªæ›´é«˜çº§çš„é…ç½®åˆ›å»ºäº†ä¸€ä¸ª FIFO ç¼“å­˜ï¼Œæ¯éš” 60 ç§’åˆ·æ–°ï¼Œæœ€å¤šå¯ä»¥å­˜å‚¨ç»“æœå¯¹è±¡æˆ–åˆ—è¡¨çš„ 512 ä¸ªå¼•ç”¨ï¼Œè€Œä¸”è¿”å›çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯åªè¯»çš„ï¼Œå› æ­¤å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹å¯èƒ½ä¼šåœ¨ä¸åŒçº¿ç¨‹ä¸­çš„è°ƒç”¨è€…äº§ç”Ÿå†²çªã€‚</p> <p>å¯ç”¨çš„æ¸…é™¤ç­–ç•¥æœ‰ï¼š</p> <ul> <li><code>LRU</code> â€“ æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼šç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚</li> <li><code>FIFO</code> â€“ å…ˆè¿›å…ˆå‡ºï¼šæŒ‰å¯¹è±¡è¿›å…¥ç¼“å­˜çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬ã€‚</li> <li><code>SOFT</code> â€“ è½¯å¼•ç”¨ï¼šåŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚</li> <li><code>WEAK</code> â€“ å¼±å¼•ç”¨ï¼šæ›´ç§¯æåœ°åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚</li> </ul> <p>é»˜è®¤çš„æ¸…é™¤ç­–ç•¥æ˜¯ LRUã€‚</p> <p>flushIntervalï¼ˆåˆ·æ–°é—´éš”ï¼‰å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸ºä»»æ„çš„æ­£æ•´æ•°ï¼Œè®¾ç½®çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªä»¥æ¯«ç§’ä¸ºå•ä½çš„åˆç†æ—¶é—´é‡ã€‚ é»˜è®¤æƒ…å†µæ˜¯ä¸è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åˆ·æ–°é—´éš”ï¼Œç¼“å­˜ä»…ä»…ä¼šåœ¨è°ƒç”¨è¯­å¥æ—¶åˆ·æ–°ã€‚</p> <p>sizeï¼ˆå¼•ç”¨æ•°ç›®ï¼‰å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸ºä»»æ„æ­£æ•´æ•°ï¼Œè¦æ³¨æ„æ¬²ç¼“å­˜å¯¹è±¡çš„å¤§å°å’Œè¿è¡Œç¯å¢ƒä¸­å¯ç”¨çš„å†…å­˜èµ„æºã€‚é»˜è®¤å€¼æ˜¯ 1024ã€‚</p> <p>readOnlyï¼ˆåªè¯»ï¼‰å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸º true æˆ– falseã€‚åªè¯»çš„ç¼“å­˜ä¼šç»™æ‰€æœ‰è°ƒç”¨è€…è¿”å›ç¼“å­˜å¯¹è±¡çš„ç›¸åŒå®ä¾‹ã€‚ å› æ­¤è¿™äº›å¯¹è±¡ä¸èƒ½è¢«ä¿®æ”¹ã€‚è¿™å°±æä¾›äº†å¯è§‚çš„æ€§èƒ½æå‡ã€‚è€Œå¯è¯»å†™çš„ç¼“å­˜ä¼šï¼ˆé€šè¿‡åºåˆ—åŒ–ï¼‰è¿”å›ç¼“å­˜å¯¹è±¡çš„æ‹·è´ã€‚ é€Ÿåº¦ä¸Šä¼šæ…¢ä¸€äº›ï¼Œä½†æ˜¯æ›´å®‰å…¨ï¼Œå› æ­¤é»˜è®¤å€¼æ˜¯ falseã€‚</p> <p><strong>æç¤º</strong> äºŒçº§ç¼“å­˜æ˜¯äº‹åŠ¡æ€§çš„ã€‚è¿™æ„å‘³ç€ï¼Œå½“ SqlSession å®Œæˆå¹¶æäº¤æ—¶ï¼Œæˆ–æ˜¯å®Œæˆå¹¶å›æ»šï¼Œä½†æ²¡æœ‰æ‰§è¡Œ flushCache=true çš„ insert/delete/update è¯­å¥æ—¶ï¼Œç¼“å­˜ä¼šè·å¾—æ›´æ–°ã€‚</p> <p><strong>ä½¿ç”¨è‡ªå®šä¹‰ç¼“å­˜</strong></p> <p>é™¤äº†ä¸Šè¿°è‡ªå®šä¹‰ç¼“å­˜çš„æ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡å®ç°ä½ è‡ªå·±çš„ç¼“å­˜ï¼Œæˆ–ä¸ºå…¶ä»–ç¬¬ä¸‰æ–¹ç¼“å­˜æ–¹æ¡ˆåˆ›å»ºé€‚é…å™¨ï¼Œæ¥å®Œå…¨è¦†ç›–ç¼“å­˜è¡Œä¸ºã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="nt">&lt;cache</span><span class="w"> </span><span class="na">type=</span><span class="s">"com.domain.something.MyCustomCache"</span><span class="nt">/&gt;</span>
</span></code></pre></div> <p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„ç¼“å­˜å®ç°ã€‚type å±æ€§æŒ‡å®šçš„ç±»å¿…é¡»å®ç° org.apache.ibatis.cache.Cache æ¥å£ï¼Œä¸”æä¾›ä¸€ä¸ªæ¥å— String å‚æ•°ä½œä¸º id çš„æ„é€ å™¨ã€‚ è¿™ä¸ªæ¥å£æ˜¯ MyBatis æ¡†æ¶ä¸­è®¸å¤šå¤æ‚çš„æ¥å£ä¹‹ä¸€ï¼Œä½†æ˜¯è¡Œä¸ºå´éå¸¸ç®€å•ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Cache</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="nf">getId</span><span class="p">();</span>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">getSize</span><span class="p">();</span>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">putObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
</span><span id="__span-108-5"><a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="w">  </span><span class="n">Object</span><span class="w"> </span><span class="nf">getObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
</span><span id="__span-108-6"><a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a><span class="w">  </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">hasKey</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
</span><span id="__span-108-7"><a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a><span class="w">  </span><span class="n">Object</span><span class="w"> </span><span class="nf">removeObject</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
</span><span id="__span-108-8"><a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">clear</span><span class="p">();</span>
</span><span id="__span-108-9"><a id="__codelineno-108-9" name="__codelineno-108-9" href="#__codelineno-108-9"></a><span class="p">}</span>
</span></code></pre></div> <p>ä¸ºäº†å¯¹ä½ çš„ç¼“å­˜è¿›è¡Œé…ç½®ï¼Œåªéœ€è¦ç®€å•åœ°åœ¨ä½ çš„ç¼“å­˜å®ç°ä¸­æ·»åŠ å…¬æœ‰çš„ JavaBean å±æ€§ï¼Œç„¶åé€šè¿‡ cache å…ƒç´ ä¼ é€’å±æ€§å€¼ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢çš„ä¾‹å­å°†åœ¨ä½ çš„ç¼“å­˜å®ç°ä¸Šè°ƒç”¨ä¸€ä¸ªåä¸º <code>setCacheFile(String file)</code> çš„æ–¹æ³•ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="nt">&lt;cache</span><span class="w"> </span><span class="na">type=</span><span class="s">"com.domain.something.MyCustomCache"</span><span class="nt">&gt;</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"cacheFile"</span><span class="w"> </span><span class="na">value=</span><span class="s">"/tmp/my-custom-cache.tmp"</span><span class="nt">/&gt;</span>
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="nt">&lt;/cache&gt;</span>
</span></code></pre></div> <p>ä½ å¯ä»¥ä½¿ç”¨æ‰€æœ‰ç®€å•ç±»å‹ä½œä¸º JavaBean å±æ€§çš„ç±»å‹ï¼ŒMyBatis ä¼šè¿›è¡Œè½¬æ¢ã€‚ ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å ä½ç¬¦ï¼ˆå¦‚ <code>${cache.file}</code>ï¼‰ï¼Œä»¥ä¾¿æ›¿æ¢æˆåœ¨é…ç½®æ–‡ä»¶å±æ€§ä¸­å®šä¹‰çš„å€¼ã€‚</p> <p>ä»ç‰ˆæœ¬ 3.4.2 å¼€å§‹ï¼ŒMyBatis å·²ç»æ”¯æŒåœ¨æ‰€æœ‰å±æ€§è®¾ç½®å®Œæ¯•ä¹‹åï¼Œè°ƒç”¨ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ã€‚ å¦‚æœæƒ³è¦ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œè¯·åœ¨ä½ çš„è‡ªå®šä¹‰ç¼“å­˜ç±»é‡Œå®ç° <code>org.apache.ibatis.builder.InitializingObject</code> æ¥å£ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">InitializingObject</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">initialize</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span>
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="p">}</span>
</span></code></pre></div> <p><strong>æç¤º</strong> ä¸Šä¸€èŠ‚ä¸­å¯¹ç¼“å­˜çš„é…ç½®ï¼ˆå¦‚æ¸…é™¤ç­–ç•¥ã€å¯è¯»æˆ–å¯è¯»å†™ç­‰ï¼‰ï¼Œä¸èƒ½åº”ç”¨äºè‡ªå®šä¹‰ç¼“å­˜ã€‚</p> <p>è¯·æ³¨æ„ï¼Œç¼“å­˜çš„é…ç½®å’Œç¼“å­˜å®ä¾‹ä¼šè¢«ç»‘å®šåˆ° SQL æ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´ä¸­ã€‚ å› æ­¤ï¼ŒåŒä¸€å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰è¯­å¥å’Œç¼“å­˜å°†é€šè¿‡å‘½åç©ºé—´ç»‘å®šåœ¨ä¸€èµ·ã€‚ æ¯æ¡è¯­å¥å¯ä»¥è‡ªå®šä¹‰ä¸ç¼“å­˜äº¤äº’çš„æ–¹å¼ï¼Œæˆ–å°†å®ƒä»¬å®Œå…¨æ’é™¤äºç¼“å­˜ä¹‹å¤–ï¼Œè¿™å¯ä»¥é€šè¿‡åœ¨æ¯æ¡è¯­å¥ä¸Šä½¿ç”¨ä¸¤ä¸ªç®€å•å±æ€§æ¥è¾¾æˆã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯­å¥ä¼šè¿™æ ·æ¥é…ç½®ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="na">flushCache=</span><span class="s">"false"</span><span class="w"> </span><span class="na">useCache=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="nt">&lt;insert</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="na">flushCache=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="nt">&lt;update</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="na">flushCache=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="nt">&lt;delete</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="na">flushCache=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
</span></code></pre></div> <p>é‰´äºè¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ˜¾ç„¶ä½ æ°¸è¿œä¸åº”è¯¥ä»¥è¿™æ ·çš„æ–¹å¼æ˜¾å¼é…ç½®ä¸€æ¡è¯­å¥ã€‚ä½†å¦‚æœä½ æƒ³æ”¹å˜é»˜è®¤çš„è¡Œä¸ºï¼Œåªéœ€è¦è®¾ç½® flushCache å’Œ useCache å±æ€§ã€‚æ¯”å¦‚ï¼ŒæŸäº›æƒ…å†µä¸‹ä½ å¯èƒ½å¸Œæœ›ç‰¹å®š select è¯­å¥çš„ç»“æœæ’é™¤äºç¼“å­˜ä¹‹å¤–ï¼Œæˆ–å¸Œæœ›ä¸€æ¡ select è¯­å¥æ¸…ç©ºç¼“å­˜ã€‚ç±»ä¼¼åœ°ï¼Œä½ å¯èƒ½å¸Œæœ›æŸäº› update è¯­å¥æ‰§è¡Œæ—¶ä¸è¦åˆ·æ–°ç¼“å­˜ã€‚</p> <p><strong>cache-ref</strong></p> <p>å›æƒ³ä¸€ä¸‹ä¸Šä¸€èŠ‚çš„å†…å®¹ï¼Œå¯¹æŸä¸€å‘½åç©ºé—´çš„è¯­å¥ï¼Œåªä¼šä½¿ç”¨è¯¥å‘½åç©ºé—´çš„ç¼“å­˜è¿›è¡Œç¼“å­˜æˆ–åˆ·æ–°ã€‚ ä½†ä½ å¯èƒ½ä¼šæƒ³è¦åœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­å…±äº«ç›¸åŒçš„ç¼“å­˜é…ç½®å’Œå®ä¾‹ã€‚è¦å®ç°è¿™ç§éœ€æ±‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ cache-ref å…ƒç´ æ¥å¼•ç”¨å¦ä¸€ä¸ªç¼“å­˜ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="nt">&lt;cache-ref</span><span class="w"> </span><span class="na">namespace=</span><span class="s">"com.someone.application.data.SomeMapper"</span><span class="nt">/&gt;</span>
</span></code></pre></div> <p><strong>ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜</strong></p> <p>ä¸€çº§ç¼“å­˜æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œä½œç”¨åŸŸæ˜¯sessionçº§åˆ«çš„ï¼Œåœ¨commitä¹‹å‰ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢ç»“æœæ¢ä»¥key valueçš„å½¢å¼å­˜èµ·æ¥ï¼Œå¦‚æœæœ‰ç›¸åŒçš„keyè¿›æ¥ï¼Œç›´æ¥è¿”å›valueï¼Œè¿™æ ·æœ‰åŠ©äºå‡è½»æ•°æ®çš„å‹åŠ›ã€‚å½“commitæˆ–è€…rollbackçš„æ—¶å€™ä¼šæ¸…é™¤ç¼“å­˜ï¼Œå¹¶ä¸”æ‰§è¡Œinsertã€updateã€deleteçš„æ—¶å€™ä¹Ÿä¼šæ¸…é™¤ç¼“å­˜ã€‚</p> <p>äºŒçº§ç¼“å­˜æ˜¯æ‰‹åŠ¨å¼€å¯çš„ï¼Œä½œç”¨åŸŸä¸ºsessionfactoryï¼ˆä¹Ÿå¯ä»¥è¯´MapperStatementçº§ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªnamespaceå°±ä¼šæœ‰ä¸€ä¸ªç¼“å­˜ï¼‰ï¼Œå› ä¸ºäºŒçº§ç¼“å­˜çš„æ•°æ®ä¸ä¸€å®šéƒ½æ˜¯å­˜å‚¨åˆ°å†…å­˜ä¸­ï¼Œå®ƒçš„å­˜å‚¨ä»‹è´¨å¤šç§å¤šæ ·ï¼Œå®ç°äºŒçº§ç¼“å­˜çš„æ—¶å€™ï¼ŒMyBatisè¦æ±‚è¿”å›çš„POJOå¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚å®ç°Serializableæ¥å£ï¼Œå¦‚æœå­˜å‚¨åœ¨å†…å­˜ä¸­çš„è¯ï¼Œå®æµ‹ä¸åºåˆ—åŒ–ä¹Ÿå¯ä»¥çš„ã€‚</p> <h2 id="4åŠ¨æ€sql">4ã€åŠ¨æ€SQL<a class="headerlink" href="#4åŠ¨æ€sql" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>åŠ¨æ€ SQL æ˜¯ MyBatis çš„å¼ºå¤§ç‰¹æ€§ä¹‹ä¸€ã€‚å¦‚æœä½ ä½¿ç”¨è¿‡ JDBC æˆ–å…¶å®ƒç±»ä¼¼çš„æ¡†æ¶ï¼Œä½ åº”è¯¥èƒ½ç†è§£æ ¹æ®ä¸åŒæ¡ä»¶æ‹¼æ¥ SQL è¯­å¥æœ‰å¤šç—›è‹¦ï¼Œä¾‹å¦‚æ‹¼æ¥æ—¶è¦ç¡®ä¿ä¸èƒ½å¿˜è®°æ·»åŠ å¿…è¦çš„ç©ºæ ¼ï¼Œè¿˜è¦æ³¨æ„å»æ‰åˆ—è¡¨æœ€åä¸€ä¸ªåˆ—åçš„é€—å·ã€‚åˆ©ç”¨åŠ¨æ€ SQLï¼Œå¯ä»¥å½»åº•æ‘†è„±è¿™ç§ç—›è‹¦ã€‚</p> <p>ä½¿ç”¨åŠ¨æ€ SQL å¹¶éä¸€ä»¶æ˜“äº‹ï¼Œä½†å€ŸåŠ©å¯ç”¨äºä»»ä½• SQL æ˜ å°„è¯­å¥ä¸­çš„å¼ºå¤§çš„åŠ¨æ€ SQL è¯­è¨€ï¼ŒMyBatis æ˜¾è‘—åœ°æå‡äº†è¿™ä¸€ç‰¹æ€§çš„æ˜“ç”¨æ€§ã€‚</p> <p>å¦‚æœä½ ä¹‹å‰ç”¨è¿‡ JSTL æˆ–ä»»ä½•åŸºäºç±» XML è¯­è¨€çš„æ–‡æœ¬å¤„ç†å™¨ï¼Œä½ å¯¹åŠ¨æ€ SQL å…ƒç´ å¯èƒ½ä¼šæ„Ÿè§‰ä¼¼æ›¾ç›¸è¯†ã€‚åœ¨ MyBatis ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œéœ€è¦èŠ±æ—¶é—´äº†è§£å¤§é‡çš„å…ƒç´ ã€‚å€ŸåŠ©åŠŸèƒ½å¼ºå¤§çš„åŸºäº OGNL çš„è¡¨è¾¾å¼ï¼ŒMyBatis 3 æ›¿æ¢äº†ä¹‹å‰çš„å¤§éƒ¨åˆ†å…ƒç´ ï¼Œå¤§å¤§ç²¾ç®€äº†å…ƒç´ ç§ç±»ï¼Œç°åœ¨è¦å­¦ä¹ çš„å…ƒç´ ç§ç±»æ¯”åŸæ¥çš„ä¸€åŠè¿˜è¦å°‘ã€‚</p> <ul> <li>if</li> <li>choose (when, otherwise)</li> <li>trim (where, set)</li> <li>foreach</li> </ul> <h3 id="41if">4.1ã€If<a class="headerlink" href="#41if" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>ä½¿ç”¨åŠ¨æ€ SQL æœ€å¸¸è§æƒ…æ™¯æ˜¯æ ¹æ®æ¡ä»¶åŒ…å« where å­å¥çš„ä¸€éƒ¨åˆ†ã€‚æ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"findActiveBlogWithTitleLike"</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="w">     </span><span class="na">resultType=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="w">  </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>BLOG
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="w">  </span>WHERE<span class="w"> </span>state<span class="w"> </span>=<span class="w"> </span>â€˜ACTIVEâ€™
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="w">  </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"title != null"</span><span class="nt">&gt;</span>
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a><span class="w">    </span>AND<span class="w"> </span>title<span class="w"> </span>like<span class="w"> </span>#{title}
</span><span id="__span-113-7"><a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="w">  </span><span class="nt">&lt;/if&gt;</span>
</span><span id="__span-113-8"><a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>è¿™æ¡è¯­å¥æä¾›äº†å¯é€‰çš„æŸ¥æ‰¾æ–‡æœ¬åŠŸèƒ½ã€‚å¦‚æœä¸ä¼ å…¥ â€œtitleâ€ï¼Œé‚£ä¹ˆæ‰€æœ‰å¤„äº â€œACTIVEâ€ çŠ¶æ€çš„ BLOG éƒ½ä¼šè¿”å›ï¼›å¦‚æœä¼ å…¥äº† â€œtitleâ€ å‚æ•°ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹ â€œtitleâ€ ä¸€åˆ—è¿›è¡Œæ¨¡ç³ŠæŸ¥æ‰¾å¹¶è¿”å›å¯¹åº”çš„ BLOG ç»“æœï¼ˆç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šå‘ç°ï¼Œâ€œtitleâ€ çš„å‚æ•°å€¼éœ€è¦åŒ…å«æŸ¥æ‰¾æ©ç æˆ–é€šé…ç¬¦å­—ç¬¦ï¼‰ã€‚</p> <p>å¦‚æœå¸Œæœ›é€šè¿‡ â€œtitleâ€ å’Œ â€œauthorâ€ ä¸¤ä¸ªå‚æ•°è¿›è¡Œå¯é€‰æœç´¢è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿé¦–å…ˆï¼Œæˆ‘æƒ³å…ˆå°†è¯­å¥åç§°ä¿®æ”¹æˆæ›´åå‰¯å…¶å®çš„åç§°ï¼›æ¥ä¸‹æ¥ï¼Œåªéœ€è¦åŠ å…¥å¦ä¸€ä¸ªæ¡ä»¶å³å¯ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"findActiveBlogLike"</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="w">     </span><span class="na">resultType=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a><span class="w">  </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>BLOG<span class="w"> </span>WHERE<span class="w"> </span>state<span class="w"> </span>=<span class="w"> </span>â€˜ACTIVEâ€™
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="w">  </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"title != null"</span><span class="nt">&gt;</span>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="w">    </span>AND<span class="w"> </span>title<span class="w"> </span>like<span class="w"> </span>#{title}
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="w">  </span><span class="nt">&lt;/if&gt;</span>
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a><span class="w">  </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"author != null and author.name != null"</span><span class="nt">&gt;</span>
</span><span id="__span-114-8"><a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a><span class="w">    </span>AND<span class="w"> </span>author_name<span class="w"> </span>like<span class="w"> </span>#{author.name}
</span><span id="__span-114-9"><a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="w">  </span><span class="nt">&lt;/if&gt;</span>
</span><span id="__span-114-10"><a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p><strong>åˆ¤æ–­ç­‰äºä¸€ä¸ªå­—ç¬¦ä¸²</strong></p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">'type=="y"'</span><span class="nt">&gt;</span><span class="w">  </span>//æ³¨æ„æ˜¯åŒå¼•å·ï¼Œä¸æ˜¯å•å¼•å·ï¼ï¼ï¼
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="w">    </span>and<span class="w"> </span>status<span class="w"> </span>=<span class="w"> </span>0<span class="w">   </span>
</span><span id="__span-115-3"><a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="nt">&lt;/if&gt;</span><span class="w"> </span>
</span></code></pre></div> <p>æˆ–è€…</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"type=='y'.toString()"</span><span class="nt">&gt;</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="w">    </span>and<span class="w"> </span>status<span class="w"> </span>=<span class="w"> </span>0<span class="w">   </span>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="nt">&lt;/if&gt;</span><span class="w"> </span>
</span></code></pre></div> <blockquote> <p>åœ¨ xml é…ç½®æ–‡ä»¶ä¸­å¤§äºå°äºç¬¦å·å¯èƒ½ä¼šè¢«è®¤å®šä¸ºæ ‡ç­¾çš„<code>&lt;</code>ã€<code>&gt;</code>ã€‚</p> </blockquote> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a>ç¬¬ä¸€ç§å†™æ³•ï¼ˆ1ï¼‰ï¼š
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a>
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a>åŸç¬¦å·       &lt;        &lt;=      &gt;       &gt;=       &amp;        '        "
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a>æ›¿æ¢ç¬¦å·    &amp;lt;     &amp;lt;=   &amp;gt;    &amp;gt;=    &amp;amp;   &amp;apos;  &amp;quot;
</span><span id="__span-117-5"><a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a>ä¾‹å¦‚ï¼šsqlå¦‚ä¸‹ï¼š
</span><span id="__span-117-6"><a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a>create_date_time &amp;gt;= #{startTime} and  create_date_time &amp;lt;= #{endTime}
</span><span id="__span-117-7"><a id="__codelineno-117-7" name="__codelineno-117-7" href="#__codelineno-117-7"></a>
</span><span id="__span-117-8"><a id="__codelineno-117-8" name="__codelineno-117-8" href="#__codelineno-117-8"></a>ç¬¬äºŒç§å†™æ³•ï¼ˆ2ï¼‰ï¼š
</span><span id="__span-117-9"><a id="__codelineno-117-9" name="__codelineno-117-9" href="#__codelineno-117-9"></a>å¤§äºç­‰äº
</span><span id="__span-117-10"><a id="__codelineno-117-10" name="__codelineno-117-10" href="#__codelineno-117-10"></a>&lt;![CDATA[ &gt;= ]]&gt;
</span><span id="__span-117-11"><a id="__codelineno-117-11" name="__codelineno-117-11" href="#__codelineno-117-11"></a>å°äºç­‰äº
</span><span id="__span-117-12"><a id="__codelineno-117-12" name="__codelineno-117-12" href="#__codelineno-117-12"></a>&lt;![CDATA[ &lt;= ]]&gt;
</span><span id="__span-117-13"><a id="__codelineno-117-13" name="__codelineno-117-13" href="#__codelineno-117-13"></a>ä¾‹å¦‚ï¼šsqlå¦‚ä¸‹ï¼š
</span><span id="__span-117-14"><a id="__codelineno-117-14" name="__codelineno-117-14" href="#__codelineno-117-14"></a>create_date_time &lt;![CDATA[ &gt;= ]]&gt; #{startTime} and  create_date_time &lt;![CDATA[ &lt;= ]]&gt; #{endTime}
</span></code></pre></div> <h3 id="42choosewhenotherwise">4.2ã€chooseã€whenã€otherwise<a class="headerlink" href="#42choosewhenotherwise" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¸æƒ³ä½¿ç”¨æ‰€æœ‰çš„æ¡ä»¶ï¼Œè€Œåªæ˜¯æƒ³ä»å¤šä¸ªæ¡ä»¶ä¸­é€‰æ‹©ä¸€ä¸ªä½¿ç”¨ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒMyBatis æä¾›äº† choose å…ƒç´ ï¼Œå®ƒæœ‰ç‚¹åƒ Java ä¸­çš„ switch è¯­å¥ã€‚</p> <p>è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œä½†æ˜¯ç­–ç•¥å˜ä¸ºï¼šä¼ å…¥äº† â€œtitleâ€ å°±æŒ‰ â€œtitleâ€ æŸ¥æ‰¾ï¼Œä¼ å…¥äº† â€œauthorâ€ å°±æŒ‰ â€œauthorâ€ æŸ¥æ‰¾çš„æƒ…å½¢ã€‚è‹¥ä¸¤è€…éƒ½æ²¡æœ‰ä¼ å…¥ï¼Œå°±è¿”å›æ ‡è®°ä¸º featured çš„ BLOGï¼ˆè¿™å¯èƒ½æ˜¯ç®¡ç†å‘˜è®¤ä¸ºï¼Œä¸å…¶è¿”å›å¤§é‡çš„æ— æ„ä¹‰éšæœº Blogï¼Œè¿˜ä¸å¦‚è¿”å›ä¸€äº›ç”±ç®¡ç†å‘˜æŒ‘é€‰çš„ Blogï¼‰ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"findActiveBlogLike"</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="w">     </span><span class="na">resultType=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="w">  </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>BLOG<span class="w"> </span>WHERE<span class="w"> </span>state<span class="w"> </span>=<span class="w"> </span>â€˜ACTIVEâ€™
</span><span id="__span-118-4"><a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a><span class="w">  </span><span class="nt">&lt;choose&gt;</span>
</span><span id="__span-118-5"><a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a><span class="w">    </span><span class="nt">&lt;when</span><span class="w"> </span><span class="na">test=</span><span class="s">"title != null"</span><span class="nt">&gt;</span>
</span><span id="__span-118-6"><a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a><span class="w">      </span>AND<span class="w"> </span>title<span class="w"> </span>like<span class="w"> </span>#{title}
</span><span id="__span-118-7"><a id="__codelineno-118-7" name="__codelineno-118-7" href="#__codelineno-118-7"></a><span class="w">    </span><span class="nt">&lt;/when&gt;</span>
</span><span id="__span-118-8"><a id="__codelineno-118-8" name="__codelineno-118-8" href="#__codelineno-118-8"></a><span class="w">    </span><span class="nt">&lt;when</span><span class="w"> </span><span class="na">test=</span><span class="s">"author != null and author.name != null"</span><span class="nt">&gt;</span>
</span><span id="__span-118-9"><a id="__codelineno-118-9" name="__codelineno-118-9" href="#__codelineno-118-9"></a><span class="w">      </span>AND<span class="w"> </span>author_name<span class="w"> </span>like<span class="w"> </span>#{author.name}
</span><span id="__span-118-10"><a id="__codelineno-118-10" name="__codelineno-118-10" href="#__codelineno-118-10"></a><span class="w">    </span><span class="nt">&lt;/when&gt;</span>
</span><span id="__span-118-11"><a id="__codelineno-118-11" name="__codelineno-118-11" href="#__codelineno-118-11"></a><span class="w">    </span><span class="nt">&lt;otherwise&gt;</span>
</span><span id="__span-118-12"><a id="__codelineno-118-12" name="__codelineno-118-12" href="#__codelineno-118-12"></a><span class="w">      </span>AND<span class="w"> </span>featured<span class="w"> </span>=<span class="w"> </span>1
</span><span id="__span-118-13"><a id="__codelineno-118-13" name="__codelineno-118-13" href="#__codelineno-118-13"></a><span class="w">    </span><span class="nt">&lt;/otherwise&gt;</span>
</span><span id="__span-118-14"><a id="__codelineno-118-14" name="__codelineno-118-14" href="#__codelineno-118-14"></a><span class="w">  </span><span class="nt">&lt;/choose&gt;</span>
</span><span id="__span-118-15"><a id="__codelineno-118-15" name="__codelineno-118-15" href="#__codelineno-118-15"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <h3 id="43trimwhereset">4.3ã€trimã€whereã€set<a class="headerlink" href="#43trimwhereset" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>å‰é¢å‡ ä¸ªä¾‹å­å·²ç»åˆå®œåœ°è§£å†³äº†ä¸€ä¸ªè‡­åæ˜­è‘—çš„åŠ¨æ€ SQL é—®é¢˜ã€‚ç°åœ¨å›åˆ°ä¹‹å‰çš„ â€œifâ€ ç¤ºä¾‹ï¼Œè¿™æ¬¡æˆ‘ä»¬å°† â€œstate = â€˜ACTIVEâ€™â€ è®¾ç½®æˆåŠ¨æ€æ¡ä»¶ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"findActiveBlogLike"</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a><span class="w">     </span><span class="na">resultType=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a><span class="w">  </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>BLOG
</span><span id="__span-119-4"><a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a><span class="w">  </span>WHERE
</span><span id="__span-119-5"><a id="__codelineno-119-5" name="__codelineno-119-5" href="#__codelineno-119-5"></a><span class="w">  </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"state != null"</span><span class="nt">&gt;</span>
</span><span id="__span-119-6"><a id="__codelineno-119-6" name="__codelineno-119-6" href="#__codelineno-119-6"></a><span class="w">    </span>state<span class="w"> </span>=<span class="w"> </span>#{state}
</span><span id="__span-119-7"><a id="__codelineno-119-7" name="__codelineno-119-7" href="#__codelineno-119-7"></a><span class="w">  </span><span class="nt">&lt;/if&gt;</span>
</span><span id="__span-119-8"><a id="__codelineno-119-8" name="__codelineno-119-8" href="#__codelineno-119-8"></a><span class="w">  </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"title != null"</span><span class="nt">&gt;</span>
</span><span id="__span-119-9"><a id="__codelineno-119-9" name="__codelineno-119-9" href="#__codelineno-119-9"></a><span class="w">    </span>AND<span class="w"> </span>title<span class="w"> </span>like<span class="w"> </span>#{title}
</span><span id="__span-119-10"><a id="__codelineno-119-10" name="__codelineno-119-10" href="#__codelineno-119-10"></a><span class="w">  </span><span class="nt">&lt;/if&gt;</span>
</span><span id="__span-119-11"><a id="__codelineno-119-11" name="__codelineno-119-11" href="#__codelineno-119-11"></a><span class="w">  </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"author != null and author.name != null"</span><span class="nt">&gt;</span>
</span><span id="__span-119-12"><a id="__codelineno-119-12" name="__codelineno-119-12" href="#__codelineno-119-12"></a><span class="w">    </span>AND<span class="w"> </span>author_name<span class="w"> </span>like<span class="w"> </span>#{author.name}
</span><span id="__span-119-13"><a id="__codelineno-119-13" name="__codelineno-119-13" href="#__codelineno-119-13"></a><span class="w">  </span><span class="nt">&lt;/if&gt;</span>
</span><span id="__span-119-14"><a id="__codelineno-119-14" name="__codelineno-119-14" href="#__codelineno-119-14"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p>å¦‚æœæ²¡æœ‰åŒ¹é…çš„æ¡ä»¶ä¼šæ€ä¹ˆæ ·ï¼Ÿæœ€ç»ˆè¿™æ¡ SQL ä¼šå˜æˆè¿™æ ·ï¼š</p> <div class="language-mysql highlight"><span class="filename">MySQL</span><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">BLOG</span>
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="k">WHERE</span>
</span></code></pre></div> <p>è¿™ä¼šå¯¼è‡´æŸ¥è¯¢å¤±è´¥ã€‚å¦‚æœåŒ¹é…çš„åªæ˜¯ç¬¬äºŒä¸ªæ¡ä»¶åˆä¼šæ€æ ·ï¼Ÿè¿™æ¡ SQL ä¼šæ˜¯è¿™æ ·:</p> <div class="language-mysql highlight"><span class="filename">MySQL</span><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">BLOG</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="k">WHERE</span>
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="k">AND</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="n">â€˜someTitleâ€™</span>
</span></code></pre></div> <p>è¿™ä¸ªæŸ¥è¯¢ä¹Ÿä¼šå¤±è´¥ã€‚è¿™ä¸ªé—®é¢˜ä¸èƒ½ç®€å•åœ°ç”¨æ¡ä»¶å…ƒç´ æ¥è§£å†³ã€‚è¿™ä¸ªé—®é¢˜æ˜¯å¦‚æ­¤çš„éš¾ä»¥è§£å†³ï¼Œä»¥è‡³äºè§£å†³è¿‡çš„äººä¸ä¼šå†æƒ³ç¢°åˆ°è¿™ç§é—®é¢˜ã€‚</p> <p>MyBatis æœ‰ä¸€ä¸ªç®€å•ä¸”é€‚åˆå¤§å¤šæ•°åœºæ™¯çš„è§£å†³åŠæ³•ã€‚è€Œåœ¨å…¶ä»–åœºæ™¯ä¸­ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ä»¥ç¬¦åˆéœ€æ±‚ã€‚è€Œè¿™ï¼Œåªéœ€è¦ä¸€å¤„ç®€å•çš„æ”¹åŠ¨ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"findActiveBlogLike"</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="w">     </span><span class="na">resultType=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="w">  </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>BLOG
</span><span id="__span-122-4"><a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="w">  </span><span class="nt">&lt;where&gt;</span>
</span><span id="__span-122-5"><a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="w">    </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"state != null"</span><span class="nt">&gt;</span>
</span><span id="__span-122-6"><a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="w">         </span>state<span class="w"> </span>=<span class="w"> </span>#{state}
</span><span id="__span-122-7"><a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="w">    </span><span class="nt">&lt;/if&gt;</span>
</span><span id="__span-122-8"><a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a><span class="w">    </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"title != null"</span><span class="nt">&gt;</span>
</span><span id="__span-122-9"><a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="w">        </span>AND<span class="w"> </span>title<span class="w"> </span>like<span class="w"> </span>#{title}
</span><span id="__span-122-10"><a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a><span class="w">    </span><span class="nt">&lt;/if&gt;</span>
</span><span id="__span-122-11"><a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="w">    </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"author != null and author.name != null"</span><span class="nt">&gt;</span>
</span><span id="__span-122-12"><a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a><span class="w">        </span>AND<span class="w"> </span>author_name<span class="w"> </span>like<span class="w"> </span>#{author.name}
</span><span id="__span-122-13"><a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a><span class="w">    </span><span class="nt">&lt;/if&gt;</span>
</span><span id="__span-122-14"><a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a><span class="w">  </span><span class="nt">&lt;/where&gt;</span>
</span><span id="__span-122-15"><a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p><em>where</em> å…ƒç´ åªä¼šåœ¨å­å…ƒç´ è¿”å›ä»»ä½•å†…å®¹çš„æƒ…å†µä¸‹æ‰æ’å…¥ â€œWHEREâ€ å­å¥ã€‚è€Œä¸”ï¼Œè‹¥å­å¥çš„å¼€å¤´ä¸º â€œANDâ€ æˆ– â€œORâ€ï¼Œ<em>where</em> å…ƒç´ ä¹Ÿä¼šå°†å®ƒä»¬å»é™¤ã€‚</p> <p>å¦‚æœ <em>where</em> å…ƒç´ ä¸ä½ æœŸæœ›çš„ä¸å¤ªä¸€æ ·ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ trim å…ƒç´ æ¥å®šåˆ¶ <em>where</em> å…ƒç´ çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œå’Œ <em>where</em> å…ƒç´ ç­‰ä»·çš„è‡ªå®šä¹‰ trim å…ƒç´ ä¸ºï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="nt">&lt;trim</span><span class="w"> </span><span class="na">prefix=</span><span class="s">"WHERE"</span><span class="w"> </span><span class="na">prefixOverrides=</span><span class="s">"AND |OR "</span><span class="nt">&gt;</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="w">  </span>...
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="nt">&lt;/trim&gt;</span>
</span></code></pre></div> <p><em>prefixOverrides</em> å±æ€§ä¼šå¿½ç•¥é€šè¿‡ç®¡é“ç¬¦åˆ†éš”çš„æ–‡æœ¬åºåˆ—ï¼ˆæ³¨æ„æ­¤ä¾‹ä¸­çš„ç©ºæ ¼æ˜¯å¿…è¦çš„ï¼‰ã€‚ä¸Šè¿°ä¾‹å­ä¼šç§»é™¤æ‰€æœ‰ <em>prefixOverrides</em> å±æ€§ä¸­æŒ‡å®šçš„å†…å®¹ï¼Œå¹¶ä¸”æ’å…¥ <em>prefix</em> å±æ€§ä¸­æŒ‡å®šçš„å†…å®¹ã€‚</p> <p>ç”¨äºåŠ¨æ€æ›´æ–°è¯­å¥çš„ç±»ä¼¼è§£å†³æ–¹æ¡ˆå«åš <em>set</em>ã€‚<em>set</em> å…ƒç´ å¯ä»¥ç”¨äºåŠ¨æ€åŒ…å«éœ€è¦æ›´æ–°çš„åˆ—ï¼Œå¿½ç•¥å…¶å®ƒä¸æ›´æ–°çš„åˆ—ã€‚æ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">"updateAuthorIfNecessary"</span><span class="nt">&gt;</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="w">  </span>update<span class="w"> </span>Author
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="w">    </span><span class="nt">&lt;set&gt;</span>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="w">      </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"username != null"</span><span class="nt">&gt;</span>username=#{username},<span class="nt">&lt;/if&gt;</span>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="w">      </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"password != null"</span><span class="nt">&gt;</span>password=#{password},<span class="nt">&lt;/if&gt;</span>
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a><span class="w">      </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"email != null"</span><span class="nt">&gt;</span>email=#{email},<span class="nt">&lt;/if&gt;</span>
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a><span class="w">      </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"bio != null"</span><span class="nt">&gt;</span>bio=#{bio}<span class="nt">&lt;/if&gt;</span>
</span><span id="__span-124-8"><a id="__codelineno-124-8" name="__codelineno-124-8" href="#__codelineno-124-8"></a><span class="w">    </span><span class="nt">&lt;/set&gt;</span>
</span><span id="__span-124-9"><a id="__codelineno-124-9" name="__codelineno-124-9" href="#__codelineno-124-9"></a><span class="w">  </span>where<span class="w"> </span>id=#{id}
</span><span id="__span-124-10"><a id="__codelineno-124-10" name="__codelineno-124-10" href="#__codelineno-124-10"></a><span class="nt">&lt;/update&gt;</span>
</span></code></pre></div> <p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<em>set</em> å…ƒç´ ä¼šåŠ¨æ€åœ°åœ¨è¡Œé¦–æ’å…¥ SET å…³é”®å­—ï¼Œå¹¶ä¼šåˆ æ‰é¢å¤–çš„é€—å·ï¼ˆè¿™äº›é€—å·æ˜¯åœ¨ä½¿ç”¨æ¡ä»¶è¯­å¥ç»™åˆ—èµ‹å€¼æ—¶å¼•å…¥çš„ï¼‰ã€‚</p> <p>æ¥çœ‹çœ‹ä¸ <em>set</em> å…ƒç´ ç­‰ä»·çš„è‡ªå®šä¹‰ <em>trim</em> å…ƒç´ å§ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="nt">&lt;trim</span><span class="w"> </span><span class="na">prefix=</span><span class="s">"SET"</span><span class="w"> </span><span class="na">suffixOverrides=</span><span class="s">","</span><span class="nt">&gt;</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="w">  </span>...
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="nt">&lt;/trim&gt;</span>
</span></code></pre></div> <p>æ³¨æ„ï¼Œæˆ‘ä»¬è¦†ç›–äº†åç¼€å€¼è®¾ç½®ï¼Œå¹¶ä¸”è‡ªå®šä¹‰äº†å‰ç¼€å€¼ã€‚</p> <h3 id="44foreach">4.4ã€foreach<a class="headerlink" href="#44foreach" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>åŠ¨æ€ SQL çš„å¦ä¸€ä¸ªå¸¸è§ä½¿ç”¨åœºæ™¯æ˜¯å¯¹é›†åˆè¿›è¡Œéå†ï¼ˆå°¤å…¶æ˜¯åœ¨æ„å»º IN æ¡ä»¶è¯­å¥çš„æ—¶å€™ï¼‰ã€‚æ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectPostIn"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"domain.blog.Post"</span><span class="nt">&gt;</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="w">  </span>SELECT<span class="w"> </span>*
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a><span class="w">  </span>FROM<span class="w"> </span>POST<span class="w"> </span>P
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="w">  </span>WHERE<span class="w"> </span>ID<span class="w"> </span>in
</span><span id="__span-126-5"><a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a><span class="w">  </span><span class="nt">&lt;foreach</span><span class="w"> </span><span class="na">item=</span><span class="s">"item"</span><span class="w"> </span><span class="na">index=</span><span class="s">"index"</span><span class="w"> </span><span class="na">collection=</span><span class="s">"list"</span>
</span><span id="__span-126-6"><a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a><span class="w">      </span><span class="na">open=</span><span class="s">"("</span><span class="w"> </span><span class="na">separator=</span><span class="s">","</span><span class="w"> </span><span class="na">close=</span><span class="s">")"</span><span class="nt">&gt;</span>
</span><span id="__span-126-7"><a id="__codelineno-126-7" name="__codelineno-126-7" href="#__codelineno-126-7"></a><span class="w">        </span>#{item}
</span><span id="__span-126-8"><a id="__codelineno-126-8" name="__codelineno-126-8" href="#__codelineno-126-8"></a><span class="w">  </span><span class="nt">&lt;/foreach&gt;</span>
</span><span id="__span-126-9"><a id="__codelineno-126-9" name="__codelineno-126-9" href="#__codelineno-126-9"></a><span class="nt">&lt;/select&gt;</span>
</span></code></pre></div> <p><em>foreach</em> å…ƒç´ çš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ªé›†åˆï¼Œå£°æ˜å¯ä»¥åœ¨å…ƒç´ ä½“å†…ä½¿ç”¨çš„é›†åˆé¡¹ï¼ˆitemï¼‰å’Œç´¢å¼•ï¼ˆindexï¼‰å˜é‡ã€‚å®ƒä¹Ÿå…è®¸ä½ æŒ‡å®šå¼€å¤´ä¸ç»“å°¾çš„å­—ç¬¦ä¸²ä»¥åŠé›†åˆé¡¹è¿­ä»£ä¹‹é—´çš„åˆ†éš”ç¬¦ã€‚è¿™ä¸ªå…ƒç´ ä¹Ÿä¸ä¼šé”™è¯¯åœ°æ·»åŠ å¤šä½™çš„åˆ†éš”ç¬¦ï¼Œçœ‹å®ƒå¤šæ™ºèƒ½ï¼</p> <p><strong>æç¤º</strong> ä½ å¯ä»¥å°†ä»»ä½•å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚ Listã€Set ç­‰ï¼‰ã€Map å¯¹è±¡æˆ–è€…æ•°ç»„å¯¹è±¡ä½œä¸ºé›†åˆå‚æ•°ä¼ é€’ç»™ <em>foreach</em>ã€‚å½“ä½¿ç”¨å¯è¿­ä»£å¯¹è±¡æˆ–è€…æ•°ç»„æ—¶ï¼Œindex æ˜¯å½“å‰è¿­ä»£çš„åºå·ï¼Œitem çš„å€¼æ˜¯æœ¬æ¬¡è¿­ä»£è·å–åˆ°çš„å…ƒç´ ã€‚å½“ä½¿ç”¨ Map å¯¹è±¡ï¼ˆæˆ–è€… Map.Entry å¯¹è±¡çš„é›†åˆï¼‰æ—¶ï¼Œindex æ˜¯é”®ï¼Œitem æ˜¯å€¼ã€‚</p> <p><strong>foreachè¿˜èƒ½å¯¹å­—ç¬¦ä¸²è¿›è¡Œè¿­ä»£</strong></p> <p>æ¯”å¦‚å­—ç¬¦ä¸² <code>departIds="1,2,3,4,5,6"</code> ï¼Œåœ¨ç”¨ foreach è¿­ä»£çš„æ—¶å€™ï¼Œå°±å¯ä»¥è¿™æ ·å†™ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="nt">&lt;foreach</span><span class="w"> </span><span class="na">collection=</span><span class="s">"departIds.split(',')"</span><span class="w"> </span><span class="na">item=</span><span class="s">"id"</span><span class="w"> </span><span class="na">open=</span><span class="s">"("</span><span class="w"> </span><span class="na">separator=</span><span class="s">","</span><span class="w"> </span><span class="na">close=</span><span class="s">")"</span><span class="nt">&gt;</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="w">ã€€ã€€</span>#{id}
</span><span id="__span-127-3"><a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="nt">&lt;/foreach&gt;</span>
</span></code></pre></div> <h3 id="45ognl-è¡¨è¾¾å¼">4.5ã€OGNL è¡¨è¾¾å¼<a class="headerlink" href="#45ognl-è¡¨è¾¾å¼" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>MyBatis çš„åŠ¨æ€ SQL å¹¿æ³›åº”ç”¨åˆ°äº†OGNL è¡¨è¾¾å¼ï¼ŒOGNL è¡¨è¾¾å¼å¯ä»¥çµæ´»çš„ç»„è£… SQL è¯­å¥ï¼Œä»è€Œå®Œæˆæ›´å¤šçš„åŠŸèƒ½ã€‚</p> <blockquote> <p>OGNL å…¨ç§° Object-Graph Navigation Languageï¼Œæ˜¯ Java ä¸­çš„ä¸€ä¸ªå¼€æºçš„è¡¨è¾¾å¼è¯­è¨€ï¼Œç”¨äºè®¿é—®å¯¹è±¡æ•°æ®ã€‚</p> </blockquote> <p>OGNL æœ€å¸¸ç”¨äº if æ ‡ç­¾ä¸­ï¼Œç”¨äºåˆ¤æ–­æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œå¦‚ä¸‹ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">"age != null"</span><span class="nt">&gt;</span>
</span><span id="__span-128-2"><a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="w">  </span>AND<span class="w"> </span>age<span class="w"> </span>=<span class="w"> </span>#{age}
</span><span id="__span-128-3"><a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="nt">&lt;/if&gt;</span>
</span></code></pre></div> <p>if æ ‡ç­¾çš„ test å±æ€§å°±æ˜¯ä¸ªå…¸å‹çš„ OGNL è¡¨è¾¾å¼ã€‚<code>age != null</code>è¡¨ç¤ºå½“ age ä¸ä¸º null çš„æ—¶å€™ if æˆç«‹ï¼Œåˆ™åŠ¨æ€çš„å‘ SQL ä¸­æ’å…¥æ ‡ç­¾å†…çš„ SQL ä»£ç æ®µã€‚</p> <p><strong>å¸¸è§çš„ OGNL è¡¨è¾¾å¼</strong></p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a>e1 or e2ï¼šæˆ–å…³ç³»
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a>e1 and e2ï¼šä¸å…³ç³»
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a>e1 == e2 æˆ–è€… e1 eq e2ï¼šç›¸ç­‰
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a>e1 != e2 æˆ–è€… e1 neq e2ï¼šä¸ç­‰
</span><span id="__span-129-5"><a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a>e1 lt e2 ï¼›e1 &lt; e2ï¼›e1 gt e2ï¼›e1 &gt; e2ï¼›e1 lte e2ï¼›e1 &lt;= e2ï¼›e1 gte e2ï¼›e1 &gt;= e2ï¼šæ¯”è¾ƒå…³ç³»
</span><span id="__span-129-6"><a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a>e1 + e2ï¼›e1 â€“ e2ï¼›e1 * e2ï¼›e1 / e2ï¼›e1 % e2ï¼šè¿ç®—å…³ç³»
</span><span id="__span-129-7"><a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a>!e æˆ–è€… not eï¼šéï¼Œå–å
</span><span id="__span-129-8"><a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a>e.method(args)ï¼šè°ƒç”¨å¯¹è±¡æ–¹æ³•
</span><span id="__span-129-9"><a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a>e.propertyï¼šè®¿é—®å±æ€§å€¼
</span><span id="__span-129-10"><a id="__codelineno-129-10" name="__codelineno-129-10" href="#__codelineno-129-10"></a>e1[e2]ï¼šè®¿é—®æ•°ç»„ã€é“¾è¡¨ï¼ˆe2 ä¸ºåºå·ï¼‰æˆ–è€… Mapï¼ˆe2 ä¸ºé”®å€¼ï¼‰
</span></code></pre></div> <p>å…¶ä¸­ 1ï½4 ä»¥åŠ 9ï½10 éƒ½æ˜¯ç‰¹åˆ«å¸¸ç”¨çš„å‡ ç§æƒ…å†µï¼Œè€Œå…¶å®ƒçš„æƒ…å†µä¸åˆ©äº SQL çš„ç»´æŠ¤ï¼Œå› æ­¤å¹¶ä¸å¸¸è§ã€‚</p> <p><strong>ç¤ºä¾‹ï¼š</strong></p> <p>æœ‰ä¸€ä¸ªåä¸º pedro çš„ User å¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="n">User</span><span class="w"> </span><span class="n">pedro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">();</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="n">pedro</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">"pedro"</span><span class="p">);</span>
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="n">pedro</span><span class="p">.</span><span class="na">setTags</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">"admin"</span><span class="p">,</span><span class="w"> </span><span class="s">"man"</span><span class="p">));</span>
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="n">pedro</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="mi">23</span><span class="p">);</span>
</span></code></pre></div> <p>è®¿é—®ç”¨æˆ·çš„ username å±æ€§ï¼ŒOGNL è¡¨è¾¾å¼ä¸º<code>pedro.username</code>ï¼Œç»“æœä¸ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a>## pedro.username
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a>pedro
</span></code></pre></div> <p>è®¿é—®ç”¨æˆ·çš„ç¬¬ä¸€ä¸ªæ ‡ç­¾ï¼ŒOGNL è¡¨è¾¾å¼ä¸º<code>pedro.tags[0]</code>ï¼Œç»“æœä¸ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a>## pedro.tags[0]
</span><span id="__span-132-2"><a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a>admin
</span></code></pre></div> <p>æ¯”è¾ƒç”¨æˆ·æ ‡ç­¾é•¿åº¦æ˜¯å¦å¤§äº 1ï¼ŒOGNL è¡¨è¾¾å¼ä¸º<code>pedro.tags[0]</code>ï¼Œç»“æœä¸ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a>## pedro.tags.size &gt; 1
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a>true
</span></code></pre></div> <p>ç”¨æˆ·å¹´é¾„åŠ ä¸Šä¸€ä¸ªæ•´æ•° 22ï¼ŒOGNL è¡¨è¾¾å¼ä¸º<code>pedro.age + 22</code>ï¼Œç»“æœä¸ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a>## pedro.age + 22
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a>45
</span></code></pre></div> <p>å°†ç”¨æˆ·å¹´é¾„å…¨éƒ¨å¤§å†™ï¼ŒOGNL è¡¨è¾¾å¼ä¸º<code>pedro.username.toUpperCase</code>ï¼Œç»“æœä¸ºï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a>## pedro.username.toUpperCase
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a>PEDRO
</span></code></pre></div> <h2 id="5java-api">5ã€Java API<a class="headerlink" href="#5java-api" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>æ—¢ç„¶ä½ å·²ç»çŸ¥é“å¦‚ä½•é…ç½® MyBatis ä»¥åŠå¦‚ä½•åˆ›å»ºæ˜ å°„ï¼Œæ˜¯æ—¶å€™æ¥å°ç‚¹ç”œå¤´äº†ã€‚MyBatis çš„ Java API å°±æ˜¯è¿™ä¸ªç”œå¤´ã€‚ç¨åä½ å°†çœ‹åˆ°ï¼Œå’Œ JDBC ç›¸æ¯”ï¼ŒMyBatis å¤§å¹…ç®€åŒ–ä½ çš„ä»£ç å¹¶åŠ›å›¾ä¿æŒå…¶ç®€æ´ã€å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚ä¸ºäº†ä½¿å¾— SQL æ˜ å°„æ›´åŠ ä¼˜ç§€ï¼ŒMyBatis 3 å¼•å…¥äº†è®¸å¤šé‡è¦çš„æ”¹è¿›ã€‚</p> <p>ä½¿ç”¨ MyBatis çš„ä¸»è¦ Java æ¥å£å°±æ˜¯ SqlSessionã€‚ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£æ¥æ‰§è¡Œå‘½ä»¤ï¼Œè·å–æ˜ å°„å™¨ç¤ºä¾‹å’Œç®¡ç†äº‹åŠ¡ã€‚åœ¨ä»‹ç» SqlSession æ¥å£ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£å¦‚ä½•è·å–ä¸€ä¸ª SqlSession å®ä¾‹ã€‚SqlSessions æ˜¯ç”± SqlSessionFactory å®ä¾‹åˆ›å»ºçš„ã€‚SqlSessionFactory å¯¹è±¡åŒ…å«åˆ›å»º SqlSession å®ä¾‹çš„å„ç§æ–¹æ³•ã€‚è€Œ SqlSessionFactory æœ¬èº«æ˜¯ç”± SqlSessionFactoryBuilder åˆ›å»ºçš„ï¼Œå®ƒå¯ä»¥ä» XMLã€æ³¨è§£æˆ– Java é…ç½®ä»£ç æ¥åˆ›å»º SqlSessionFactoryã€‚</p> <p><strong>æç¤º</strong> å½“ Mybatis ä¸ä¸€äº›ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ˆå¦‚ Spring æˆ–è€… Guiceï¼‰æ­é…ä½¿ç”¨æ—¶ï¼ŒSqlSession å°†è¢«ä¾èµ–æ³¨å…¥æ¡†æ¶åˆ›å»ºå¹¶æ³¨å…¥ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦ä½¿ç”¨ SqlSessionFactoryBuilder æˆ–è€… SqlSessionFactoryã€‚</p> <h3 id="51sqlsessionfactory">5.1ã€SqlSessionFactory<a class="headerlink" href="#51sqlsessionfactory" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>SqlSessionFactoryBuilder æœ‰äº”ä¸ª build() æ–¹æ³•ï¼Œæ¯ä¸€ç§éƒ½å…è®¸ä½ ä»ä¸åŒçš„èµ„æºä¸­åˆ›å»ºä¸€ä¸ª SqlSessionFactory å®ä¾‹ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">inputStream</span><span class="p">)</span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">inputStream</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">environment</span><span class="p">)</span>
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">inputStream</span><span class="p">,</span><span class="w"> </span><span class="n">Properties</span><span class="w"> </span><span class="n">properties</span><span class="p">)</span>
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">inputStream</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="p">)</span>
</span><span id="__span-136-5"><a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="n">Configuration</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
</span></code></pre></div> <p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯æœ€å¸¸ç”¨çš„ï¼Œå®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘ XML æ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯ä¹‹å‰è®¨è®ºçš„ mybatis-config.xml æ–‡ä»¶ï¼‰çš„ InputStream å®ä¾‹ã€‚å¯é€‰çš„å‚æ•°æ˜¯ environment å’Œ propertiesã€‚environment å†³å®šåŠ è½½å“ªç§ç¯å¢ƒï¼ŒåŒ…æ‹¬æ•°æ®æºå’Œäº‹åŠ¡ç®¡ç†å™¨ã€‚æ¯”å¦‚ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="nt">&lt;environments</span><span class="w"> </span><span class="na">default=</span><span class="s">"development"</span><span class="nt">&gt;</span>
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a><span class="w">  </span><span class="nt">&lt;environment</span><span class="w"> </span><span class="na">id=</span><span class="s">"development"</span><span class="nt">&gt;</span>
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a><span class="w">    </span><span class="nt">&lt;transactionManager</span><span class="w"> </span><span class="na">type=</span><span class="s">"JDBC"</span><span class="nt">&gt;</span>
</span><span id="__span-137-4"><a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="w">        </span>...
</span><span id="__span-137-5"><a id="__codelineno-137-5" name="__codelineno-137-5" href="#__codelineno-137-5"></a><span class="w">    </span><span class="nt">&lt;dataSource</span><span class="w"> </span><span class="na">type=</span><span class="s">"POOLED"</span><span class="nt">&gt;</span>
</span><span id="__span-137-6"><a id="__codelineno-137-6" name="__codelineno-137-6" href="#__codelineno-137-6"></a><span class="w">        </span>...
</span><span id="__span-137-7"><a id="__codelineno-137-7" name="__codelineno-137-7" href="#__codelineno-137-7"></a><span class="w">  </span><span class="nt">&lt;/environment&gt;</span>
</span><span id="__span-137-8"><a id="__codelineno-137-8" name="__codelineno-137-8" href="#__codelineno-137-8"></a><span class="w">  </span><span class="nt">&lt;environment</span><span class="w"> </span><span class="na">id=</span><span class="s">"production"</span><span class="nt">&gt;</span>
</span><span id="__span-137-9"><a id="__codelineno-137-9" name="__codelineno-137-9" href="#__codelineno-137-9"></a><span class="w">    </span><span class="nt">&lt;transactionManager</span><span class="w"> </span><span class="na">type=</span><span class="s">"MANAGED"</span><span class="nt">&gt;</span>
</span><span id="__span-137-10"><a id="__codelineno-137-10" name="__codelineno-137-10" href="#__codelineno-137-10"></a><span class="w">        </span>...
</span><span id="__span-137-11"><a id="__codelineno-137-11" name="__codelineno-137-11" href="#__codelineno-137-11"></a><span class="w">    </span><span class="nt">&lt;dataSource</span><span class="w"> </span><span class="na">type=</span><span class="s">"JNDI"</span><span class="nt">&gt;</span>
</span><span id="__span-137-12"><a id="__codelineno-137-12" name="__codelineno-137-12" href="#__codelineno-137-12"></a><span class="w">        </span>...
</span><span id="__span-137-13"><a id="__codelineno-137-13" name="__codelineno-137-13" href="#__codelineno-137-13"></a><span class="w">  </span><span class="nt">&lt;/environment&gt;</span>
</span><span id="__span-137-14"><a id="__codelineno-137-14" name="__codelineno-137-14" href="#__codelineno-137-14"></a><span class="nt">&lt;/environments&gt;</span>
</span></code></pre></div> <p>å¦‚æœä½ è°ƒç”¨äº†å¸¦ environment å‚æ•°çš„ build æ–¹æ³•ï¼Œé‚£ä¹ˆ MyBatis å°†ä½¿ç”¨è¯¥ç¯å¢ƒå¯¹åº”çš„é…ç½®ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æŒ‡å®šäº†ä¸€ä¸ªæ— æ•ˆçš„ç¯å¢ƒï¼Œä¼šæ”¶åˆ°é”™è¯¯ã€‚å¦‚æœä½ è°ƒç”¨äº†ä¸å¸¦ environment å‚æ•°çš„ build æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨é»˜è®¤çš„ç¯å¢ƒé…ç½®ï¼ˆåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡ default="development" æŒ‡å®šäº†é»˜è®¤ç¯å¢ƒï¼‰ã€‚</p> <p>å¦‚æœä½ è°ƒç”¨äº†æ¥å— properties å®ä¾‹çš„æ–¹æ³•ï¼Œé‚£ä¹ˆ MyBatis å°±ä¼šåŠ è½½è¿™äº›å±æ€§ï¼Œå¹¶åœ¨é…ç½®ä¸­æä¾›ä½¿ç”¨ã€‚ç»å¤§å¤šæ•°åœºåˆä¸‹ï¼Œå¯ä»¥ç”¨ ${propName} å½¢å¼å¼•ç”¨è¿™äº›é…ç½®å€¼ã€‚</p> <p>å‰å››ä¸ªæ–¹æ³•å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç›¸åŒçš„ï¼Œä½†æä¾›äº†ä¸åŒçš„è¦†ç›–é€‰é¡¹ï¼Œå…è®¸ä½ å¯é€‰åœ°æŒ‡å®š environment å’Œ/æˆ– propertiesã€‚ä»¥ä¸‹ç»™å‡ºä¸€ä¸ªä» mybatis-config.xml æ–‡ä»¶åˆ›å»º SqlSessionFactory çš„ç¤ºä¾‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"org/mybatis/builder/mybatis-config.xml"</span><span class="p">;</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="n">InputStream</span><span class="w"> </span><span class="n">inputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Resources</span><span class="p">.</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span>
</span><span id="__span-138-3"><a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a><span class="n">SqlSessionFactoryBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBuilder</span><span class="p">();</span>
</span><span id="__span-138-4"><a id="__codelineno-138-4" name="__codelineno-138-4" href="#__codelineno-138-4"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">(</span><span class="n">inputStream</span><span class="p">);</span>
</span></code></pre></div> <p>æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† Resources å·¥å…·ç±»ï¼Œè¿™ä¸ªç±»åœ¨ org.apache.ibatis.io åŒ…ä¸­ã€‚Resources ç±»æ­£å¦‚å…¶åï¼Œä¼šå¸®åŠ©ä½ ä»ç±»è·¯å¾„ä¸‹ã€æ–‡ä»¶ç³»ç»Ÿæˆ–ä¸€ä¸ª web URL ä¸­åŠ è½½èµ„æºæ–‡ä»¶ã€‚åœ¨ç•¥è¯»è¯¥ç±»çš„æºä»£ç æˆ–ç”¨ IDE æŸ¥çœ‹è¯¥ç±»ä¿¡æ¯åï¼Œä½ ä¼šå‘ç°ä¸€æ•´å¥—ç›¸å½“å®ç”¨çš„æ–¹æ³•ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªç®€è¡¨ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="n">URL</span><span class="w"> </span><span class="nf">getResourceURL</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="p">)</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="n">URL</span><span class="w"> </span><span class="nf">getResourceURL</span><span class="p">(</span><span class="n">ClassLoader</span><span class="w"> </span><span class="n">loader</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="p">)</span>
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="n">InputStream</span><span class="w"> </span><span class="nf">getResourceAsStream</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="p">)</span>
</span><span id="__span-139-4"><a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="n">InputStream</span><span class="w"> </span><span class="nf">getResourceAsStream</span><span class="p">(</span><span class="n">ClassLoader</span><span class="w"> </span><span class="n">loader</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="p">)</span>
</span><span id="__span-139-5"><a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a><span class="n">Properties</span><span class="w"> </span><span class="nf">getResourceAsProperties</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="p">)</span>
</span><span id="__span-139-6"><a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a><span class="n">Properties</span><span class="w"> </span><span class="nf">getResourceAsProperties</span><span class="p">(</span><span class="n">ClassLoader</span><span class="w"> </span><span class="n">loader</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="p">)</span>
</span><span id="__span-139-7"><a id="__codelineno-139-7" name="__codelineno-139-7" href="#__codelineno-139-7"></a><span class="n">Reader</span><span class="w"> </span><span class="nf">getResourceAsReader</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="p">)</span>
</span><span id="__span-139-8"><a id="__codelineno-139-8" name="__codelineno-139-8" href="#__codelineno-139-8"></a><span class="n">Reader</span><span class="w"> </span><span class="nf">getResourceAsReader</span><span class="p">(</span><span class="n">ClassLoader</span><span class="w"> </span><span class="n">loader</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="p">)</span>
</span><span id="__span-139-9"><a id="__codelineno-139-9" name="__codelineno-139-9" href="#__codelineno-139-9"></a><span class="n">File</span><span class="w"> </span><span class="nf">getResourceAsFile</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="p">)</span>
</span><span id="__span-139-10"><a id="__codelineno-139-10" name="__codelineno-139-10" href="#__codelineno-139-10"></a><span class="n">File</span><span class="w"> </span><span class="nf">getResourceAsFile</span><span class="p">(</span><span class="n">ClassLoader</span><span class="w"> </span><span class="n">loader</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">resource</span><span class="p">)</span>
</span><span id="__span-139-11"><a id="__codelineno-139-11" name="__codelineno-139-11" href="#__codelineno-139-11"></a><span class="n">InputStream</span><span class="w"> </span><span class="nf">getUrlAsStream</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">urlString</span><span class="p">)</span>
</span><span id="__span-139-12"><a id="__codelineno-139-12" name="__codelineno-139-12" href="#__codelineno-139-12"></a><span class="n">Reader</span><span class="w"> </span><span class="nf">getUrlAsReader</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">urlString</span><span class="p">)</span>
</span><span id="__span-139-13"><a id="__codelineno-139-13" name="__codelineno-139-13" href="#__codelineno-139-13"></a><span class="n">Properties</span><span class="w"> </span><span class="nf">getUrlAsProperties</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">urlString</span><span class="p">)</span>
</span><span id="__span-139-14"><a id="__codelineno-139-14" name="__codelineno-139-14" href="#__codelineno-139-14"></a><span class="n">Class</span><span class="w"> </span><span class="nf">classForName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">className</span><span class="p">)</span>
</span></code></pre></div> <p>æœ€åä¸€ä¸ª build æ–¹æ³•æ¥å—ä¸€ä¸ª Configuration å®ä¾‹ã€‚Configuration ç±»åŒ…å«äº†å¯¹ä¸€ä¸ª SqlSessionFactory å®ä¾‹ä½ å¯èƒ½å…³å¿ƒçš„æ‰€æœ‰å†…å®¹ã€‚åœ¨æ£€æŸ¥é…ç½®æ—¶ï¼ŒConfiguration ç±»å¾ˆæœ‰ç”¨ï¼Œå®ƒå…è®¸ä½ æŸ¥æ‰¾å’Œæ“çºµ SQL æ˜ å°„ï¼ˆä½†å½“åº”ç”¨å¼€å§‹æ¥æ”¶è¯·æ±‚æ—¶ä¸æ¨èä½¿ç”¨ï¼‰ã€‚ä½ ä¹‹å‰å­¦ä¹ è¿‡çš„æ‰€æœ‰é…ç½®å¼€å…³éƒ½å­˜åœ¨äº Configuration ç±»ï¼Œåªä¸è¿‡å®ƒä»¬æ˜¯ä»¥ Java API å½¢å¼æš´éœ²çš„ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•æ‰‹åŠ¨é…ç½® Configuration å®ä¾‹ï¼Œç„¶åå°†å®ƒä¼ é€’ç»™ build() æ–¹æ³•æ¥åˆ›å»º SqlSessionFactoryã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BaseDataTest</span><span class="p">.</span><span class="na">createBlogDataSource</span><span class="p">();</span>
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a><span class="n">TransactionFactory</span><span class="w"> </span><span class="n">transactionFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JdbcTransactionFactory</span><span class="p">();</span>
</span><span id="__span-140-3"><a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a>
</span><span id="__span-140-4"><a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="n">Environment</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Environment</span><span class="p">(</span><span class="s">"development"</span><span class="p">,</span><span class="w"> </span><span class="n">transactionFactory</span><span class="p">,</span><span class="w"> </span><span class="n">dataSource</span><span class="p">);</span>
</span><span id="__span-140-5"><a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a>
</span><span id="__span-140-6"><a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a><span class="n">Configuration</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Configuration</span><span class="p">(</span><span class="n">environment</span><span class="p">);</span>
</span><span id="__span-140-7"><a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a><span class="n">configuration</span><span class="p">.</span><span class="na">setLazyLoadingEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span id="__span-140-8"><a id="__codelineno-140-8" name="__codelineno-140-8" href="#__codelineno-140-8"></a><span class="n">configuration</span><span class="p">.</span><span class="na">setEnhancementEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span id="__span-140-9"><a id="__codelineno-140-9" name="__codelineno-140-9" href="#__codelineno-140-9"></a><span class="n">configuration</span><span class="p">.</span><span class="na">getTypeAliasRegistry</span><span class="p">().</span><span class="na">registerAlias</span><span class="p">(</span><span class="n">Blog</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-140-10"><a id="__codelineno-140-10" name="__codelineno-140-10" href="#__codelineno-140-10"></a><span class="n">configuration</span><span class="p">.</span><span class="na">getTypeAliasRegistry</span><span class="p">().</span><span class="na">registerAlias</span><span class="p">(</span><span class="n">Post</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-140-11"><a id="__codelineno-140-11" name="__codelineno-140-11" href="#__codelineno-140-11"></a><span class="n">configuration</span><span class="p">.</span><span class="na">getTypeAliasRegistry</span><span class="p">().</span><span class="na">registerAlias</span><span class="p">(</span><span class="n">Author</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-140-12"><a id="__codelineno-140-12" name="__codelineno-140-12" href="#__codelineno-140-12"></a><span class="n">configuration</span><span class="p">.</span><span class="na">addMapper</span><span class="p">(</span><span class="n">BoundBlogMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-140-13"><a id="__codelineno-140-13" name="__codelineno-140-13" href="#__codelineno-140-13"></a><span class="n">configuration</span><span class="p">.</span><span class="na">addMapper</span><span class="p">(</span><span class="n">BoundAuthorMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-140-14"><a id="__codelineno-140-14" name="__codelineno-140-14" href="#__codelineno-140-14"></a>
</span><span id="__span-140-15"><a id="__codelineno-140-15" name="__codelineno-140-15" href="#__codelineno-140-15"></a><span class="n">SqlSessionFactoryBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBuilder</span><span class="p">();</span>
</span><span id="__span-140-16"><a id="__codelineno-140-16" name="__codelineno-140-16" href="#__codelineno-140-16"></a><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">(</span><span class="n">configuration</span><span class="p">);</span>
</span></code></pre></div> <p>ç°åœ¨ä½ å°±è·å¾—ä¸€ä¸ªå¯ä»¥ç”¨æ¥åˆ›å»º SqlSession å®ä¾‹çš„ SqlSessionFactory äº†ã€‚</p> <h3 id="52sqlsession">5.2ã€SqlSession<a class="headerlink" href="#52sqlsession" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>SqlSessionFactory æœ‰å…­ä¸ªæ–¹æ³•åˆ›å»º SqlSession å®ä¾‹ã€‚é€šå¸¸æ¥è¯´ï¼Œå½“ä½ é€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œä½ éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š</p> <ul> <li><strong>äº‹åŠ¡å¤„ç†</strong>ï¼šä½ å¸Œæœ›åœ¨ session ä½œç”¨åŸŸä¸­ä½¿ç”¨äº‹åŠ¡ä½œç”¨åŸŸï¼Œè¿˜æ˜¯ä½¿ç”¨è‡ªåŠ¨æäº¤ï¼ˆauto-commitï¼‰ï¼Ÿï¼ˆå¯¹å¾ˆå¤šæ•°æ®åº“å’Œ/æˆ– JDBC é©±åŠ¨æ¥è¯´ï¼Œç­‰åŒäºå…³é—­äº‹åŠ¡æ”¯æŒï¼‰</li> <li><strong>æ•°æ®åº“è¿æ¥</strong>ï¼šä½ å¸Œæœ› MyBatis å¸®ä½ ä»å·²é…ç½®çš„æ•°æ®æºè·å–è¿æ¥ï¼Œè¿˜æ˜¯ä½¿ç”¨è‡ªå·±æä¾›çš„è¿æ¥ï¼Ÿ</li> <li><strong>è¯­å¥æ‰§è¡Œ</strong>ï¼šä½ å¸Œæœ› MyBatis å¤ç”¨ PreparedStatement å’Œ/æˆ–æ‰¹é‡æ›´æ–°è¯­å¥ï¼ˆåŒ…æ‹¬æ’å…¥è¯­å¥å’Œåˆ é™¤è¯­å¥ï¼‰å—ï¼Ÿ</li> </ul> <p>åŸºäºä»¥ä¸Šéœ€æ±‚ï¼Œæœ‰ä¸‹åˆ—å·²é‡è½½çš„å¤šä¸ª openSession() æ–¹æ³•ä¾›ä½¿ç”¨ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="n">SqlSession</span><span class="w"> </span><span class="nf">openSession</span><span class="p">()</span>
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a><span class="n">SqlSession</span><span class="w"> </span><span class="nf">openSession</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">autoCommit</span><span class="p">)</span>
</span><span id="__span-141-3"><a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a><span class="n">SqlSession</span><span class="w"> </span><span class="nf">openSession</span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">connection</span><span class="p">)</span>
</span><span id="__span-141-4"><a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a><span class="n">SqlSession</span><span class="w"> </span><span class="nf">openSession</span><span class="p">(</span><span class="n">TransactionIsolationLevel</span><span class="w"> </span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-141-5"><a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a><span class="n">SqlSession</span><span class="w"> </span><span class="nf">openSession</span><span class="p">(</span><span class="n">ExecutorType</span><span class="w"> </span><span class="n">execType</span><span class="p">,</span><span class="w"> </span><span class="n">TransactionIsolationLevel</span><span class="w"> </span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-141-6"><a id="__codelineno-141-6" name="__codelineno-141-6" href="#__codelineno-141-6"></a><span class="n">SqlSession</span><span class="w"> </span><span class="nf">openSession</span><span class="p">(</span><span class="n">ExecutorType</span><span class="w"> </span><span class="n">execType</span><span class="p">)</span>
</span><span id="__span-141-7"><a id="__codelineno-141-7" name="__codelineno-141-7" href="#__codelineno-141-7"></a><span class="n">SqlSession</span><span class="w"> </span><span class="nf">openSession</span><span class="p">(</span><span class="n">ExecutorType</span><span class="w"> </span><span class="n">execType</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">autoCommit</span><span class="p">)</span>
</span><span id="__span-141-8"><a id="__codelineno-141-8" name="__codelineno-141-8" href="#__codelineno-141-8"></a><span class="n">SqlSession</span><span class="w"> </span><span class="nf">openSession</span><span class="p">(</span><span class="n">ExecutorType</span><span class="w"> </span><span class="n">execType</span><span class="p">,</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="n">connection</span><span class="p">)</span>
</span><span id="__span-141-9"><a id="__codelineno-141-9" name="__codelineno-141-9" href="#__codelineno-141-9"></a><span class="n">Configuration</span><span class="w"> </span><span class="nf">getConfiguration</span><span class="p">();</span>
</span></code></pre></div> <p>é»˜è®¤çš„ openSession() æ–¹æ³•æ²¡æœ‰å‚æ•°ï¼Œå®ƒä¼šåˆ›å»ºå…·å¤‡å¦‚ä¸‹ç‰¹æ€§çš„ SqlSessionï¼š</p> <ul> <li>äº‹åŠ¡ä½œç”¨åŸŸå°†ä¼šå¼€å¯ï¼ˆä¹Ÿå°±æ˜¯ä¸è‡ªåŠ¨æäº¤ï¼‰ã€‚</li> <li>å°†ç”±å½“å‰ç¯å¢ƒé…ç½®çš„ DataSource å®ä¾‹ä¸­è·å– Connection å¯¹è±¡ã€‚</li> <li>äº‹åŠ¡éš”ç¦»çº§åˆ«å°†ä¼šä½¿ç”¨é©±åŠ¨æˆ–æ•°æ®æºçš„é»˜è®¤è®¾ç½®ã€‚</li> <li>é¢„å¤„ç†è¯­å¥ä¸ä¼šè¢«å¤ç”¨ï¼Œä¹Ÿä¸ä¼šæ‰¹é‡å¤„ç†æ›´æ–°ã€‚</li> </ul> <p>ç›¸ä¿¡ä½ å·²ç»èƒ½ä»æ–¹æ³•ç­¾åä¸­çŸ¥é“è¿™äº›æ–¹æ³•çš„åŒºåˆ«ã€‚å‘ <code>autoCommit</code> å¯é€‰å‚æ•°ä¼ é€’ <code>true</code> å€¼å³å¯å¼€å¯è‡ªåŠ¨æäº¤åŠŸèƒ½ã€‚è‹¥è¦ä½¿ç”¨è‡ªå·±çš„ <code>Connection</code> å®ä¾‹ï¼Œä¼ é€’ä¸€ä¸ª <code>Connection</code> å®ä¾‹ç»™ <code>connection</code> å‚æ•°å³å¯ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰æä¾›åŒæ—¶è®¾ç½® <code>Connection</code> å’Œ <code>autoCommit</code> çš„æ–¹æ³•ï¼Œè¿™æ˜¯å› ä¸º MyBatis ä¼šä¾æ®ä¼ å…¥çš„ Connection æ¥å†³å®šæ˜¯å¦å¯ç”¨ autoCommitã€‚å¯¹äºäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ŒMyBatis ä½¿ç”¨äº†ä¸€ä¸ª Java æšä¸¾åŒ…è£…å™¨æ¥è¡¨ç¤ºï¼Œç§°ä¸º <code>TransactionIsolationLevel</code>ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«æ”¯æŒ JDBC çš„äº”ä¸ªéš”ç¦»çº§åˆ«ï¼ˆ<code>NONE</code>ã€<code>READ_UNCOMMITTED</code>ã€<code>READ_COMMITTED</code>ã€<code>REPEATABLE_READ</code> å’Œ <code>SERIALIZABLE</code>ï¼‰ï¼Œå¹¶ä¸”ä¸é¢„æœŸçš„è¡Œä¸ºä¸€è‡´ã€‚</p> <p>ä½ å¯èƒ½å¯¹ <code>ExecutorType</code> å‚æ•°æ„Ÿåˆ°é™Œç”Ÿã€‚è¿™ä¸ªæšä¸¾ç±»å‹å®šä¹‰äº†ä¸‰ä¸ªå€¼:</p> <ul> <li><code>ExecutorType.SIMPLE</code>ï¼šè¯¥ç±»å‹çš„æ‰§è¡Œå™¨æ²¡æœ‰ç‰¹åˆ«çš„è¡Œä¸ºã€‚å®ƒä¸ºæ¯ä¸ªè¯­å¥çš„æ‰§è¡Œåˆ›å»ºä¸€ä¸ªæ–°çš„é¢„å¤„ç†è¯­å¥ã€‚</li> <li><code>ExecutorType.REUSE</code>ï¼šè¯¥ç±»å‹çš„æ‰§è¡Œå™¨ä¼šå¤ç”¨é¢„å¤„ç†è¯­å¥ã€‚</li> <li><code>ExecutorType.BATCH</code>ï¼šè¯¥ç±»å‹çš„æ‰§è¡Œå™¨ä¼šæ‰¹é‡æ‰§è¡Œæ‰€æœ‰æ›´æ–°è¯­å¥ï¼Œå¦‚æœ SELECT åœ¨å¤šä¸ªæ›´æ–°ä¸­é—´æ‰§è¡Œï¼Œå°†åœ¨å¿…è¦æ—¶å°†å¤šæ¡æ›´æ–°è¯­å¥åˆ†éš”å¼€æ¥ï¼Œä»¥æ–¹ä¾¿ç†è§£ã€‚</li> </ul> <p><strong>æç¤º</strong> åœ¨ SqlSessionFactory ä¸­è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æˆ‘ä»¬æ²¡æœ‰æåŠï¼Œå°±æ˜¯ getConfiguration()ã€‚è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Configuration å®ä¾‹ï¼Œä½ å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨å®ƒæ¥æ£€æŸ¥ MyBatis çš„é…ç½®ã€‚</p> <p>SqlSession ç±»çš„æ–¹æ³•è¶…è¿‡äº† 20 ä¸ªï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å°†å®ƒä»¬åˆ†æˆå‡ ç§ç»„åˆ«ã€‚</p> <h3 id="53è¯­å¥æ‰§è¡Œæ–¹æ³•">5.3ã€è¯­å¥æ‰§è¡Œæ–¹æ³•<a class="headerlink" href="#53è¯­å¥æ‰§è¡Œæ–¹æ³•" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>è¿™äº›æ–¹æ³•è¢«ç”¨æ¥æ‰§è¡Œå®šä¹‰åœ¨ SQL æ˜ å°„ XML æ–‡ä»¶ä¸­çš„ SELECTã€INSERTã€UPDATE å’Œ DELETE è¯­å¥ã€‚ä½ å¯ä»¥é€šè¿‡åå­—å¿«é€Ÿäº†è§£å®ƒä»¬çš„ä½œç”¨ï¼Œæ¯ä¸€æ–¹æ³•éƒ½æ¥å—è¯­å¥çš„ ID ä»¥åŠå‚æ•°å¯¹è±¡ï¼Œå‚æ•°å¯ä»¥æ˜¯åŸå§‹ç±»å‹ï¼ˆæ”¯æŒè‡ªåŠ¨è£…ç®±æˆ–åŒ…è£…ç±»ï¼‰ã€JavaBeanã€POJO æˆ– Mapã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">selectOne</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">)</span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">selectList</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">)</span>
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Cursor</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">selectCursor</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">)</span>
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">selectMap</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">mapKey</span><span class="p">)</span>
</span><span id="__span-142-5"><a id="__codelineno-142-5" name="__codelineno-142-5" href="#__codelineno-142-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">)</span>
</span><span id="__span-142-6"><a id="__codelineno-142-6" name="__codelineno-142-6" href="#__codelineno-142-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">)</span>
</span><span id="__span-142-7"><a id="__codelineno-142-7" name="__codelineno-142-7" href="#__codelineno-142-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">)</span>
</span></code></pre></div> <p>selectOne å’Œ selectList çš„ä¸åŒä»…ä»…æ˜¯ selectOne å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡æˆ– null å€¼ã€‚å¦‚æœè¿”å›å€¼å¤šäºä¸€ä¸ªï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœä½ ä¸çŸ¥é“è¿”å›å¯¹è±¡ä¼šæœ‰å¤šå°‘ï¼Œè¯·ä½¿ç”¨ selectListã€‚å¦‚æœéœ€è¦æŸ¥çœ‹æŸä¸ªå¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯æŸ¥è¯¢ä¸€ä¸ª count å€¼ï¼ˆ0 æˆ– 1ï¼‰ã€‚selectMap ç¨å¾®ç‰¹æ®Šä¸€ç‚¹ï¼Œå®ƒä¼šå°†è¿”å›å¯¹è±¡çš„å…¶ä¸­ä¸€ä¸ªå±æ€§ä½œä¸º key å€¼ï¼Œå°†å¯¹è±¡ä½œä¸º value å€¼ï¼Œä»è€Œå°†å¤šä¸ªç»“æœé›†è½¬ä¸º Map ç±»å‹å€¼ã€‚ç”±äºå¹¶ä¸æ˜¯æ‰€æœ‰è¯­å¥éƒ½éœ€è¦å‚æ•°ï¼Œæ‰€ä»¥è¿™äº›æ–¹æ³•éƒ½å…·æœ‰ä¸€ä¸ªä¸éœ€è¦å‚æ•°çš„é‡è½½å½¢å¼ã€‚</p> <p>æ¸¸æ ‡ï¼ˆCursorï¼‰ä¸åˆ—è¡¨ï¼ˆListï¼‰è¿”å›çš„ç»“æœç›¸åŒï¼Œä¸åŒçš„æ˜¯ï¼Œæ¸¸æ ‡å€ŸåŠ©è¿­ä»£å™¨å®ç°äº†æ•°æ®çš„æƒ°æ€§åŠ è½½ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">Cursor</span><span class="o">&lt;</span><span class="n">MyEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">selectCursor</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">param</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a><span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">MyEntity</span><span class="w"> </span><span class="n">entity</span><span class="p">:</span><span class="n">entities</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-143-3"><a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a><span class="w">      </span><span class="c1">// å¤„ç†å•ä¸ªå®ä½“</span>
</span><span id="__span-143-4"><a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a><span class="w">   </span><span class="p">}</span>
</span><span id="__span-143-5"><a id="__codelineno-143-5" name="__codelineno-143-5" href="#__codelineno-143-5"></a><span class="p">}</span>
</span></code></pre></div> <p>insertã€update ä»¥åŠ delete æ–¹æ³•è¿”å›çš„å€¼è¡¨ç¤ºå—è¯¥è¯­å¥å½±å“çš„è¡Œæ•°ã€‚</p> <p>æœ€åï¼Œè¿˜æœ‰ select æ–¹æ³•çš„ä¸‰ä¸ªé«˜çº§ç‰ˆæœ¬ï¼Œå®ƒä»¬å…è®¸ä½ é™åˆ¶è¿”å›è¡Œæ•°çš„èŒƒå›´ï¼Œæˆ–æ˜¯æä¾›è‡ªå®šä¹‰ç»“æœå¤„ç†é€»è¾‘ï¼Œé€šå¸¸åœ¨æ•°æ®é›†éå¸¸åºå¤§çš„æƒ…å½¢ä¸‹ä½¿ç”¨ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">selectList</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">,</span><span class="w"> </span><span class="n">RowBounds</span><span class="w"> </span><span class="n">rowBounds</span><span class="p">)</span>
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Cursor</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">selectCursor</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">,</span><span class="w"> </span><span class="n">RowBounds</span><span class="w"> </span><span class="n">rowBounds</span><span class="p">)</span>
</span><span id="__span-144-3"><a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">selectMap</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">mapKey</span><span class="p">,</span><span class="w"> </span><span class="n">RowBounds</span><span class="w"> </span><span class="n">rowbounds</span><span class="p">)</span>
</span><span id="__span-144-4"><a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">select</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">,</span><span class="w"> </span><span class="n">ResultHandler</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span>
</span><span id="__span-144-5"><a id="__codelineno-144-5" name="__codelineno-144-5" href="#__codelineno-144-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">select</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="p">,</span><span class="w"> </span><span class="n">RowBounds</span><span class="w"> </span><span class="n">rowBounds</span><span class="p">,</span><span class="w"> </span><span class="n">ResultHandler</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span>
</span></code></pre></div> <p>RowBounds å‚æ•°ä¼šå‘Šè¯‰ MyBatis ç•¥è¿‡æŒ‡å®šæ•°é‡çš„è®°å½•ï¼Œå¹¶é™åˆ¶è¿”å›ç»“æœçš„æ•°é‡ã€‚RowBounds ç±»çš„ offset å’Œ limit å€¼åªæœ‰åœ¨æ„é€ å‡½æ•°æ—¶æ‰èƒ½ä¼ å…¥ï¼Œå…¶å®ƒæ—¶å€™æ˜¯ä¸èƒ½ä¿®æ”¹çš„ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</span><span id="__span-145-2"><a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span>
</span><span id="__span-145-3"><a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a><span class="n">RowBounds</span><span class="w"> </span><span class="n">rowBounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RowBounds</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="p">);</span>
</span></code></pre></div> <p>æ•°æ®åº“é©±åŠ¨å†³å®šäº†ç•¥è¿‡è®°å½•æ—¶çš„æŸ¥è¯¢æ•ˆç‡ã€‚ä¸ºäº†è·å¾—æœ€ä½³çš„æ€§èƒ½ï¼Œå»ºè®®å°† ResultSet ç±»å‹è®¾ç½®ä¸º SCROLL_SENSITIVE æˆ– SCROLL_INSENSITIVEï¼ˆæ¢å¥è¯è¯´ï¼šä¸è¦ä½¿ç”¨ FORWARD_ONLYï¼‰ã€‚</p> <p>ResultHandler å‚æ•°å…è®¸è‡ªå®šä¹‰æ¯è¡Œç»“æœçš„å¤„ç†è¿‡ç¨‹ã€‚ä½ å¯ä»¥å°†å®ƒæ·»åŠ åˆ° List ä¸­ã€åˆ›å»º Map å’Œ Setï¼Œç”šè‡³ä¸¢å¼ƒæ¯ä¸ªè¿”å›å€¼ï¼Œåªä¿ç•™è®¡ç®—åçš„ç»Ÿè®¡ç»“æœã€‚ä½ å¯ä»¥ä½¿ç”¨ ResultHandler åšå¾ˆå¤šäº‹ï¼Œè¿™å…¶å®å°±æ˜¯ MyBatis æ„å»º ç»“æœåˆ—è¡¨çš„å†…éƒ¨å®ç°åŠæ³•ã€‚</p> <p>ä»ç‰ˆæœ¬ 3.4.6 å¼€å§‹ï¼Œ<code>ResultHandler</code> ä¼šåœ¨å­˜å‚¨è¿‡ç¨‹çš„ REFCURSOR è¾“å‡ºå‚æ•°ä¸­ä¼ é€’ä½¿ç”¨çš„ <code>CALLABLE</code> è¯­å¥ã€‚</p> <p>å®ƒçš„æ¥å£å¾ˆç®€å•ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">org.apache.ibatis.session</span><span class="p">;</span>
</span><span id="__span-146-2"><a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ResultHandler</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-146-3"><a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleResult</span><span class="p">(</span><span class="n">ResultContext</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">);</span>
</span><span id="__span-146-4"><a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a><span class="p">}</span>
</span></code></pre></div> <p>ResultContext å‚æ•°å…è®¸ä½ è®¿é—®ç»“æœå¯¹è±¡å’Œå½“å‰å·²è¢«åˆ›å»ºçš„å¯¹è±¡æ•°ç›®ï¼Œå¦å¤–è¿˜æä¾›äº†ä¸€ä¸ªè¿”å›å€¼ä¸º Boolean çš„ stop æ–¹æ³•ï¼Œä½ å¯ä»¥ä½¿ç”¨æ­¤ stop æ–¹æ³•æ¥åœæ­¢ MyBatis åŠ è½½æ›´å¤šçš„ç»“æœã€‚</p> <p>ä½¿ç”¨ ResultHandler çš„æ—¶å€™éœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ä¸ªé™åˆ¶ï¼š</p> <ul> <li>ä½¿ç”¨å¸¦ ResultHandler å‚æ•°çš„æ–¹æ³•æ—¶ï¼Œæ”¶åˆ°çš„æ•°æ®ä¸ä¼šè¢«ç¼“å­˜ã€‚</li> <li>å½“ä½¿ç”¨é«˜çº§çš„ç»“æœæ˜ å°„é›†ï¼ˆresultMapï¼‰æ—¶ï¼ŒMyBatis å¾ˆå¯èƒ½éœ€è¦æ•°è¡Œç»“æœæ¥æ„é€ ä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœä½ ä½¿ç”¨äº† ResultHandlerï¼Œä½ å¯èƒ½ä¼šæ¥æ”¶åˆ°å…³è”ï¼ˆassociationï¼‰æˆ–è€…é›†åˆï¼ˆcollectionï¼‰ä¸­å°šæœªè¢«å®Œæ•´å¡«å……çš„å¯¹è±¡ã€‚</li> </ul> <p><strong>ç«‹å³æ‰¹é‡æ›´æ–°æ–¹æ³•</strong></p> <p>å½“ä½ å°† <code>ExecutorType</code> è®¾ç½®ä¸º <code>ExecutorType.BATCH</code> æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¸…é™¤ï¼ˆæ‰§è¡Œï¼‰ç¼“å­˜åœ¨ JDBC é©±åŠ¨ç±»ä¸­çš„æ‰¹é‡æ›´æ–°è¯­å¥ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">BatchResult</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">flushStatements</span><span class="p">()</span>
</span></code></pre></div> <p><strong>äº‹åŠ¡æ§åˆ¶æ–¹æ³•</strong></p> <p>æœ‰å››ä¸ªæ–¹æ³•ç”¨æ¥æ§åˆ¶äº‹åŠ¡ä½œç”¨åŸŸã€‚å½“ç„¶ï¼Œå¦‚æœä½ å·²ç»è®¾ç½®äº†è‡ªåŠ¨æäº¤æˆ–ä½ ä½¿ç”¨äº†å¤–éƒ¨äº‹åŠ¡ç®¡ç†å™¨ï¼Œè¿™äº›æ–¹æ³•å°±æ²¡ä»€ä¹ˆä½œç”¨äº†ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ç”± Connection å®ä¾‹æ§åˆ¶çš„ JDBC äº‹åŠ¡ç®¡ç†å™¨ï¼Œé‚£ä¹ˆè¿™å››ä¸ªæ–¹æ³•å°±ä¼šæ´¾ä¸Šç”¨åœºï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">commit</span><span class="p">()</span>
</span><span id="__span-148-2"><a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">commit</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">force</span><span class="p">)</span>
</span><span id="__span-148-3"><a id="__codelineno-148-3" name="__codelineno-148-3" href="#__codelineno-148-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">rollback</span><span class="p">()</span>
</span><span id="__span-148-4"><a id="__codelineno-148-4" name="__codelineno-148-4" href="#__codelineno-148-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">rollback</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">force</span><span class="p">)</span>
</span></code></pre></div> <p>é»˜è®¤æƒ…å†µä¸‹ MyBatis ä¸ä¼šè‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œé™¤éå®ƒä¾¦æµ‹åˆ°è°ƒç”¨äº†æ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤æ–¹æ³•æ”¹å˜äº†æ•°æ®åº“ã€‚å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨è¿™äº›æ–¹æ³•æäº¤ä¿®æ”¹ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨ commit å’Œ rollback æ–¹æ³•å‚æ•°ä¸­ä¼ å…¥ true å€¼ï¼Œæ¥ä¿è¯äº‹åŠ¡è¢«æ­£å¸¸æäº¤ï¼ˆæ³¨æ„ï¼Œåœ¨è‡ªåŠ¨æäº¤æ¨¡å¼æˆ–è€…ä½¿ç”¨äº†å¤–éƒ¨äº‹åŠ¡ç®¡ç†å™¨çš„æƒ…å†µä¸‹ï¼Œè®¾ç½® force å€¼å¯¹ session æ— æ•ˆï¼‰ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½ æ— éœ€è°ƒç”¨ rollback()ï¼Œå› ä¸º MyBatis ä¼šåœ¨ä½ æ²¡æœ‰è°ƒç”¨ commit æ—¶æ›¿ä½ å®Œæˆå›æ»šæ“ä½œã€‚ä¸è¿‡ï¼Œå½“ä½ è¦åœ¨ä¸€ä¸ªå¯èƒ½å¤šæ¬¡æäº¤æˆ–å›æ»šçš„ session ä¸­è¯¦ç»†æ§åˆ¶äº‹åŠ¡ï¼Œå›æ»šæ“ä½œå°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p> <p><strong>æç¤º</strong> MyBatis-Spring å’Œ MyBatis-Guice æä¾›äº†å£°æ˜å¼äº‹åŠ¡å¤„ç†ï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨ä½¿ç”¨ Mybatis çš„åŒæ—¶ä½¿ç”¨äº† Spring æˆ–è€… Guiceï¼Œè¯·å‚è€ƒå®ƒä»¬çš„æ‰‹å†Œä»¥è·å–æ›´å¤šçš„å†…å®¹ã€‚</p> <p><strong>æœ¬åœ°ç¼“å­˜</strong></p> <p>Mybatis ä½¿ç”¨åˆ°äº†ä¸¤ç§ç¼“å­˜ï¼šæœ¬åœ°ç¼“å­˜ï¼ˆlocal cacheï¼‰å’ŒäºŒçº§ç¼“å­˜ï¼ˆsecond level cacheï¼‰ã€‚</p> <p>æ¯å½“ä¸€ä¸ªæ–° session è¢«åˆ›å»ºï¼ŒMyBatis å°±ä¼šåˆ›å»ºä¸€ä¸ªä¸ä¹‹ç›¸å…³è”çš„æœ¬åœ°ç¼“å­˜ã€‚ä»»ä½•åœ¨ session æ‰§è¡Œè¿‡çš„æŸ¥è¯¢ç»“æœéƒ½ä¼šè¢«ä¿å­˜åœ¨æœ¬åœ°ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥ï¼Œå½“å†æ¬¡æ‰§è¡Œå‚æ•°ç›¸åŒçš„ç›¸åŒæŸ¥è¯¢æ—¶ï¼Œå°±ä¸éœ€è¦å®é™…æŸ¥è¯¢æ•°æ®åº“äº†ã€‚æœ¬åœ°ç¼“å­˜å°†ä¼šåœ¨åšå‡ºä¿®æ”¹ã€äº‹åŠ¡æäº¤æˆ–å›æ»šï¼Œä»¥åŠå…³é—­ session æ—¶æ¸…ç©ºã€‚</p> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ¬åœ°ç¼“å­˜æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸç­‰åŒäºæ•´ä¸ª session çš„å‘¨æœŸã€‚ç”±äºç¼“å­˜ä¼šè¢«ç”¨æ¥è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜å’ŒåŠ å¿«é‡å¤åµŒå¥—æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œæ‰€ä»¥æ— æ³•å°†å…¶å®Œå…¨ç¦ç”¨ã€‚ä½†æ˜¯ä½ å¯ä»¥é€šè¿‡è®¾ç½® localCacheScope=STATEMENT æ¥åªåœ¨è¯­å¥æ‰§è¡Œæ—¶ä½¿ç”¨ç¼“å­˜ã€‚</p> <p>æ³¨æ„ï¼Œå¦‚æœ localCacheScope è¢«è®¾ç½®ä¸º SESSIONï¼Œå¯¹äºæŸä¸ªå¯¹è±¡ï¼ŒMyBatis å°†è¿”å›åœ¨æœ¬åœ°ç¼“å­˜ä¸­å”¯ä¸€å¯¹è±¡çš„å¼•ç”¨ã€‚å¯¹è¿”å›çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ listï¼‰åšå‡ºçš„ä»»ä½•ä¿®æ”¹å°†ä¼šå½±å“æœ¬åœ°ç¼“å­˜çš„å†…å®¹ï¼Œè¿›è€Œå°†ä¼šå½±å“åˆ°åœ¨æœ¬æ¬¡ session ä¸­ä»ç¼“å­˜è¿”å›çš„å€¼ã€‚å› æ­¤ï¼Œä¸è¦å¯¹ MyBatis æ‰€è¿”å›çš„å¯¹è±¡ä½œå‡ºæ›´æ”¹ï¼Œä»¥é˜²åæ‚£ã€‚</p> <p>ä½ å¯ä»¥éšæ—¶è°ƒç”¨ä»¥ä¸‹æ–¹æ³•æ¥æ¸…ç©ºæœ¬åœ°ç¼“å­˜ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">clearCache</span><span class="p">()</span>
</span></code></pre></div> <p><strong>æç¤º</strong> å’Œ SqlSessionFactory ä¸€æ ·ï¼Œä½ å¯ä»¥è°ƒç”¨å½“å‰ä½¿ç”¨çš„ SqlSession çš„ getConfiguration æ–¹æ³•æ¥è·å¾— Configuration å®ä¾‹ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="n">Configuration</span><span class="w"> </span><span class="nf">getConfiguration</span><span class="p">()</span>
</span></code></pre></div> <h3 id="54ä½¿ç”¨æ˜ å°„å™¨">5.4ã€ä½¿ç”¨æ˜ å°„å™¨<a class="headerlink" href="#54ä½¿ç”¨æ˜ å°„å™¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">getMapper</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
</span></code></pre></div> <p>ä¸Šè¿°çš„å„ä¸ª insertã€updateã€delete å’Œ select æ–¹æ³•éƒ½å¾ˆå¼ºå¤§ï¼Œä½†ä¹Ÿæœ‰äº›ç¹çï¼Œå®ƒä»¬å¹¶ä¸ç¬¦åˆç±»å‹å®‰å…¨ï¼Œå¯¹ä½ çš„ IDE å’Œå•å…ƒæµ‹è¯•ä¹Ÿä¸æ˜¯é‚£ä¹ˆå‹å¥½ã€‚å› æ­¤ï¼Œä½¿ç”¨æ˜ å°„å™¨ç±»æ¥æ‰§è¡Œæ˜ å°„è¯­å¥æ˜¯æ›´å¸¸è§çš„åšæ³•ã€‚</p> <p>æˆ‘ä»¬å·²ç»åœ¨ä¹‹å‰çš„å…¥é—¨ç« èŠ‚ä¸­è§åˆ°è¿‡ä¸€ä¸ªä½¿ç”¨æ˜ å°„å™¨çš„ç¤ºä¾‹ã€‚ä¸€ä¸ªæ˜ å°„å™¨ç±»å°±æ˜¯ä¸€ä¸ªä»…éœ€å£°æ˜ä¸ SqlSession æ–¹æ³•ç›¸åŒ¹é…æ–¹æ³•çš„æ¥å£ã€‚ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†ä¸€äº›æ–¹æ³•ç­¾åä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•æ˜ å°„åˆ° SqlSession ä¸Šçš„ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AuthorMapper</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a><span class="w">  </span><span class="c1">// (Author) selectOne("selectAuthor",5);</span>
</span><span id="__span-152-3"><a id="__codelineno-152-3" name="__codelineno-152-3" href="#__codelineno-152-3"></a><span class="w">  </span><span class="n">Author</span><span class="w"> </span><span class="nf">selectAuthor</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-152-4"><a id="__codelineno-152-4" name="__codelineno-152-4" href="#__codelineno-152-4"></a><span class="w">  </span><span class="c1">// (List&lt;Author&gt;) selectList(â€œselectAuthorsâ€)</span>
</span><span id="__span-152-5"><a id="__codelineno-152-5" name="__codelineno-152-5" href="#__codelineno-152-5"></a><span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Author</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">selectAuthors</span><span class="p">();</span>
</span><span id="__span-152-6"><a id="__codelineno-152-6" name="__codelineno-152-6" href="#__codelineno-152-6"></a><span class="w">  </span><span class="c1">// (Map&lt;Integer,Author&gt;) selectMap("selectAuthors", "id")</span>
</span><span id="__span-152-7"><a id="__codelineno-152-7" name="__codelineno-152-7" href="#__codelineno-152-7"></a><span class="w">  </span><span class="nd">@MapKey</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>
</span><span id="__span-152-8"><a id="__codelineno-152-8" name="__codelineno-152-8" href="#__codelineno-152-8"></a><span class="w">  </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">Author</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">selectAuthors</span><span class="p">();</span>
</span><span id="__span-152-9"><a id="__codelineno-152-9" name="__codelineno-152-9" href="#__codelineno-152-9"></a><span class="w">  </span><span class="c1">// insert("insertAuthor", author)</span>
</span><span id="__span-152-10"><a id="__codelineno-152-10" name="__codelineno-152-10" href="#__codelineno-152-10"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">insertAuthor</span><span class="p">(</span><span class="n">Author</span><span class="w"> </span><span class="n">author</span><span class="p">);</span>
</span><span id="__span-152-11"><a id="__codelineno-152-11" name="__codelineno-152-11" href="#__codelineno-152-11"></a><span class="w">  </span><span class="c1">// updateAuthor("updateAuthor", author)</span>
</span><span id="__span-152-12"><a id="__codelineno-152-12" name="__codelineno-152-12" href="#__codelineno-152-12"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">updateAuthor</span><span class="p">(</span><span class="n">Author</span><span class="w"> </span><span class="n">author</span><span class="p">);</span>
</span><span id="__span-152-13"><a id="__codelineno-152-13" name="__codelineno-152-13" href="#__codelineno-152-13"></a><span class="w">  </span><span class="c1">// delete("deleteAuthor",5)</span>
</span><span id="__span-152-14"><a id="__codelineno-152-14" name="__codelineno-152-14" href="#__codelineno-152-14"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">deleteAuthor</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-152-15"><a id="__codelineno-152-15" name="__codelineno-152-15" href="#__codelineno-152-15"></a><span class="p">}</span>
</span></code></pre></div> <p>æ€»ä¹‹ï¼Œæ¯ä¸ªæ˜ å°„å™¨æ–¹æ³•ç­¾ååº”è¯¥åŒ¹é…ç›¸å…³è”çš„ SqlSession æ–¹æ³•ï¼Œå­—ç¬¦ä¸²å‚æ•° ID æ— éœ€åŒ¹é…ã€‚è€Œæ˜¯ç”±æ–¹æ³•ååŒ¹é…æ˜ å°„è¯­å¥çš„ IDã€‚</p> <p>æ­¤å¤–ï¼Œè¿”å›ç±»å‹å¿…é¡»åŒ¹é…æœŸæœ›çš„ç»“æœç±»å‹ï¼Œè¿”å›å•ä¸ªå€¼æ—¶ï¼Œè¿”å›ç±»å‹åº”è¯¥æ˜¯è¿”å›å€¼çš„ç±»ï¼Œè¿”å›å¤šä¸ªå€¼æ—¶ï¼Œåˆ™ä¸ºæ•°ç»„æˆ–é›†åˆç±»ï¼Œå¦å¤–ä¹Ÿå¯ä»¥æ˜¯æ¸¸æ ‡ï¼ˆCursorï¼‰ã€‚æ‰€æœ‰å¸¸ç”¨çš„ç±»å‹éƒ½æ˜¯æ”¯æŒçš„ï¼ŒåŒ…æ‹¬ï¼šåŸå§‹ç±»å‹ã€Mapã€POJO å’Œ JavaBeanã€‚</p> <p><strong>æç¤º</strong> æ˜ å°„å™¨æ¥å£ä¸éœ€è¦å»å®ç°ä»»ä½•æ¥å£æˆ–ç»§æ‰¿è‡ªä»»ä½•ç±»ã€‚åªè¦æ–¹æ³•ç­¾åå¯ä»¥è¢«ç”¨æ¥å”¯ä¸€è¯†åˆ«å¯¹åº”çš„æ˜ å°„è¯­å¥å°±å¯ä»¥äº†ã€‚</p> <p><strong>æç¤º</strong> æ˜ å°„å™¨æ¥å£å¯ä»¥ç»§æ‰¿è‡ªå…¶ä»–æ¥å£ã€‚åœ¨ä½¿ç”¨ XML æ¥ç»‘å®šæ˜ å°„å™¨æ¥å£æ—¶ï¼Œä¿è¯è¯­å¥å¤„äºåˆé€‚çš„å‘½åç©ºé—´ä¸­å³å¯ã€‚å”¯ä¸€çš„é™åˆ¶æ˜¯ï¼Œä¸èƒ½åœ¨ä¸¤ä¸ªå…·æœ‰ç»§æ‰¿å…³ç³»çš„æ¥å£ä¸­æ‹¥æœ‰ç›¸åŒçš„æ–¹æ³•ç­¾åï¼ˆè¿™æ˜¯æ½œåœ¨çš„å±é™©åšæ³•ï¼Œä¸å¯å–ï¼‰ã€‚</p> <p>ä½ å¯ä»¥ä¼ é€’å¤šä¸ªå‚æ•°ç»™ä¸€ä¸ªæ˜ å°„å™¨æ–¹æ³•ã€‚åœ¨å¤šä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤å®ƒä»¬å°†ä¼šä»¥ param åŠ ä¸Šå®ƒä»¬åœ¨å‚æ•°åˆ—è¡¨ä¸­çš„ä½ç½®æ¥å‘½åï¼Œæ¯”å¦‚ï¼š#{param1}ã€#{param2}ç­‰ã€‚å¦‚æœä½ æƒ³ï¼ˆåœ¨æœ‰å¤šä¸ªå‚æ•°æ—¶ï¼‰è‡ªå®šä¹‰å‚æ•°çš„åç§°ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨å‚æ•°ä¸Šä½¿ç”¨ @Param("paramName") æ³¨è§£ã€‚</p> <p>ä½ ä¹Ÿå¯ä»¥ç»™æ–¹æ³•ä¼ é€’ä¸€ä¸ª RowBounds å®ä¾‹æ¥é™åˆ¶æŸ¥è¯¢ç»“æœã€‚</p> <p><strong>æ˜ å°„å™¨æ³¨è§£</strong></p> <p>è®¾è®¡åˆæœŸçš„ MyBatis æ˜¯ä¸€ä¸ª XML é©±åŠ¨çš„æ¡†æ¶ã€‚é…ç½®ä¿¡æ¯æ˜¯åŸºäº XML çš„ï¼Œæ˜ å°„è¯­å¥ä¹Ÿæ˜¯å®šä¹‰åœ¨ XML ä¸­çš„ã€‚è€Œåœ¨ MyBatis 3 ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†å…¶å®ƒçš„é…ç½®æ–¹å¼ã€‚MyBatis 3 æ„å»ºåœ¨å…¨é¢ä¸”å¼ºå¤§çš„åŸºäº Java è¯­è¨€çš„é…ç½® API ä¹‹ä¸Šã€‚å®ƒæ˜¯ XML å’Œæ³¨è§£é…ç½®çš„åŸºç¡€ã€‚æ³¨è§£æä¾›äº†ä¸€ç§ç®€å•ä¸”ä½æˆæœ¬çš„æ–¹å¼æ¥å®ç°ç®€å•çš„æ˜ å°„è¯­å¥ã€‚</p> <p><strong>æç¤º</strong> ä¸å¹¸çš„æ˜¯ï¼ŒJava æ³¨è§£çš„è¡¨è¾¾èƒ½åŠ›å’Œçµæ´»æ€§ååˆ†æœ‰é™ã€‚å°½ç®¡æˆ‘ä»¬èŠ±äº†å¾ˆå¤šæ—¶é—´åœ¨è°ƒæŸ¥ã€è®¾è®¡å’Œè¯•éªŒä¸Šï¼Œä½†æœ€å¼ºå¤§çš„ MyBatis æ˜ å°„å¹¶ä¸èƒ½ç”¨æ³¨è§£æ¥æ„å»ºâ€”â€”æˆ‘ä»¬çœŸæ²¡å¼€ç©ç¬‘ã€‚è€Œ C# å±æ€§å°±æ²¡æœ‰è¿™äº›é™åˆ¶ï¼Œå› æ­¤ MyBatis.NET çš„é…ç½®ä¼šæ¯” XML æœ‰æ›´å¤§çš„é€‰æ‹©ä½™åœ°ã€‚è™½è¯´å¦‚æ­¤ï¼ŒåŸºäº Java æ³¨è§£çš„é…ç½®è¿˜æ˜¯æœ‰å®ƒçš„å¥½å¤„çš„ã€‚</p> <p>æ³¨è§£å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Mybatis/image-20200616093839656.png" data-desc-position="bottom"><img src="!assets/Mybatis/image-20200616093839656.png" alt="image-20200616093839656" style></a></p> <p><strong>æ˜ å°„æ³¨è§£ç¤ºä¾‹</strong></p> <p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ @SelectKey æ³¨è§£æ¥åœ¨æ’å…¥å‰è¯»å–æ•°æ®åº“åºåˆ—çš„å€¼ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="nd">@Insert</span><span class="p">(</span><span class="s">"insert into table3 (id, name) values(#{nameId}, #{name})"</span><span class="p">)</span>
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="nd">@SelectKey</span><span class="p">(</span><span class="n">statement</span><span class="o">=</span><span class="s">"call next value for TestSequence"</span><span class="p">,</span><span class="w"> </span><span class="n">keyProperty</span><span class="o">=</span><span class="s">"nameId"</span><span class="p">,</span><span class="w"> </span><span class="n">before</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">resultType</span><span class="o">=</span><span class="kt">int</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-153-3"><a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">insertTable3</span><span class="p">(</span><span class="n">Name</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
</span></code></pre></div> <p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ @SelectKey æ³¨è§£æ¥åœ¨æ’å…¥åè¯»å–æ•°æ®åº“è‡ªå¢åˆ—çš„å€¼ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="nd">@Insert</span><span class="p">(</span><span class="s">"insert into table2 (name) values(#{name})"</span><span class="p">)</span>
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a><span class="nd">@SelectKey</span><span class="p">(</span><span class="n">statement</span><span class="o">=</span><span class="s">"call identity()"</span><span class="p">,</span><span class="w"> </span><span class="n">keyProperty</span><span class="o">=</span><span class="s">"nameId"</span><span class="p">,</span><span class="w"> </span><span class="n">before</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">resultType</span><span class="o">=</span><span class="kt">int</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-154-3"><a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">insertTable2</span><span class="p">(</span><span class="n">Name</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
</span></code></pre></div> <p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>@Flush</code> æ³¨è§£æ¥è°ƒç”¨ <code>SqlSession#flushStatements()</code>ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="nd">@Flush</span>
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">BatchResult</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">flush</span><span class="p">();</span>
</span></code></pre></div> <p>è¿™äº›ä¾‹å­å±•ç¤ºäº†å¦‚ä½•é€šè¿‡æŒ‡å®š @Result çš„ id å±æ€§æ¥å‘½åç»“æœé›†ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="nd">@Results</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"userResult"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a><span class="w">  </span><span class="nd">@Result</span><span class="p">(</span><span class="n">property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"id"</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"uid"</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-156-3"><a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a><span class="w">  </span><span class="nd">@Result</span><span class="p">(</span><span class="n">property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"firstName"</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"first_name"</span><span class="p">),</span>
</span><span id="__span-156-4"><a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a><span class="w">  </span><span class="nd">@Result</span><span class="p">(</span><span class="n">property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"lastName"</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"last_name"</span><span class="p">)</span>
</span><span id="__span-156-5"><a id="__codelineno-156-5" name="__codelineno-156-5" href="#__codelineno-156-5"></a><span class="p">})</span>
</span><span id="__span-156-6"><a id="__codelineno-156-6" name="__codelineno-156-6" href="#__codelineno-156-6"></a><span class="nd">@Select</span><span class="p">(</span><span class="s">"select * from users where id = #{id}"</span><span class="p">)</span>
</span><span id="__span-156-7"><a id="__codelineno-156-7" name="__codelineno-156-7" href="#__codelineno-156-7"></a><span class="n">User</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-156-8"><a id="__codelineno-156-8" name="__codelineno-156-8" href="#__codelineno-156-8"></a>
</span><span id="__span-156-9"><a id="__codelineno-156-9" name="__codelineno-156-9" href="#__codelineno-156-9"></a><span class="nd">@Results</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"companyResults"</span><span class="p">)</span>
</span><span id="__span-156-10"><a id="__codelineno-156-10" name="__codelineno-156-10" href="#__codelineno-156-10"></a><span class="nd">@ConstructorArgs</span><span class="p">({</span>
</span><span id="__span-156-11"><a id="__codelineno-156-11" name="__codelineno-156-11" href="#__codelineno-156-11"></a><span class="w">  </span><span class="nd">@Arg</span><span class="p">(</span><span class="n">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"cid"</span><span class="p">,</span><span class="w"> </span><span class="n">javaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-156-12"><a id="__codelineno-156-12" name="__codelineno-156-12" href="#__codelineno-156-12"></a><span class="w">  </span><span class="nd">@Arg</span><span class="p">(</span><span class="n">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"name"</span><span class="p">,</span><span class="w"> </span><span class="n">javaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-156-13"><a id="__codelineno-156-13" name="__codelineno-156-13" href="#__codelineno-156-13"></a><span class="p">})</span>
</span><span id="__span-156-14"><a id="__codelineno-156-14" name="__codelineno-156-14" href="#__codelineno-156-14"></a><span class="nd">@Select</span><span class="p">(</span><span class="s">"select * from company where id = #{id}"</span><span class="p">)</span>
</span><span id="__span-156-15"><a id="__codelineno-156-15" name="__codelineno-156-15" href="#__codelineno-156-15"></a><span class="n">Company</span><span class="w"> </span><span class="nf">getCompanyById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span></code></pre></div> <p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å•ä¸ªå‚æ•°çš„ @SqlProvider æ³¨è§£ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="nd">@SelectProvider</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserSqlBuilder</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"buildGetUsersByName"</span><span class="p">)</span>
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getUsersByName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-157-3"><a id="__codelineno-157-3" name="__codelineno-157-3" href="#__codelineno-157-3"></a>
</span><span id="__span-157-4"><a id="__codelineno-157-4" name="__codelineno-157-4" href="#__codelineno-157-4"></a><span class="kd">class</span> <span class="nc">UserSqlBuilder</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-5"><a id="__codelineno-157-5" name="__codelineno-157-5" href="#__codelineno-157-5"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">buildGetUsersByName</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-6"><a id="__codelineno-157-6" name="__codelineno-157-6" href="#__codelineno-157-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">(){{</span>
</span><span id="__span-157-7"><a id="__codelineno-157-7" name="__codelineno-157-7" href="#__codelineno-157-7"></a><span class="w">      </span><span class="n">SELECT</span><span class="p">(</span><span class="s">"*"</span><span class="p">);</span>
</span><span id="__span-157-8"><a id="__codelineno-157-8" name="__codelineno-157-8" href="#__codelineno-157-8"></a><span class="w">      </span><span class="n">FROM</span><span class="p">(</span><span class="s">"users"</span><span class="p">);</span>
</span><span id="__span-157-9"><a id="__codelineno-157-9" name="__codelineno-157-9" href="#__codelineno-157-9"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-10"><a id="__codelineno-157-10" name="__codelineno-157-10" href="#__codelineno-157-10"></a><span class="w">        </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"name like #{value} || '%'"</span><span class="p">);</span>
</span><span id="__span-157-11"><a id="__codelineno-157-11" name="__codelineno-157-11" href="#__codelineno-157-11"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-157-12"><a id="__codelineno-157-12" name="__codelineno-157-12" href="#__codelineno-157-12"></a><span class="w">      </span><span class="n">ORDER_BY</span><span class="p">(</span><span class="s">"id"</span><span class="p">);</span>
</span><span id="__span-157-13"><a id="__codelineno-157-13" name="__codelineno-157-13" href="#__codelineno-157-13"></a><span class="w">    </span><span class="p">}}.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-157-14"><a id="__codelineno-157-14" name="__codelineno-157-14" href="#__codelineno-157-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-157-15"><a id="__codelineno-157-15" name="__codelineno-157-15" href="#__codelineno-157-15"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å¤šä¸ªå‚æ•°çš„ @SqlProvider æ³¨è§£ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="nd">@SelectProvider</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserSqlBuilder</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"buildGetUsersByName"</span><span class="p">)</span>
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getUsersByName</span><span class="p">(</span>
</span><span id="__span-158-3"><a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="w">    </span><span class="nd">@Param</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">"orderByColumn"</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderByColumn</span><span class="p">);</span>
</span><span id="__span-158-4"><a id="__codelineno-158-4" name="__codelineno-158-4" href="#__codelineno-158-4"></a>
</span><span id="__span-158-5"><a id="__codelineno-158-5" name="__codelineno-158-5" href="#__codelineno-158-5"></a><span class="kd">class</span> <span class="nc">UserSqlBuilder</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-6"><a id="__codelineno-158-6" name="__codelineno-158-6" href="#__codelineno-158-6"></a>
</span><span id="__span-158-7"><a id="__codelineno-158-7" name="__codelineno-158-7" href="#__codelineno-158-7"></a><span class="w">  </span><span class="c1">// å¦‚æœä¸ä½¿ç”¨ @Paramï¼Œå°±åº”è¯¥å®šä¹‰ä¸ mapper æ–¹æ³•ç›¸åŒçš„å‚æ•°</span>
</span><span id="__span-158-8"><a id="__codelineno-158-8" name="__codelineno-158-8" href="#__codelineno-158-8"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">buildGetUsersByName</span><span class="p">(</span>
</span><span id="__span-158-9"><a id="__codelineno-158-9" name="__codelineno-158-9" href="#__codelineno-158-9"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderByColumn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-10"><a id="__codelineno-158-10" name="__codelineno-158-10" href="#__codelineno-158-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">(){{</span>
</span><span id="__span-158-11"><a id="__codelineno-158-11" name="__codelineno-158-11" href="#__codelineno-158-11"></a><span class="w">      </span><span class="n">SELECT</span><span class="p">(</span><span class="s">"*"</span><span class="p">);</span>
</span><span id="__span-158-12"><a id="__codelineno-158-12" name="__codelineno-158-12" href="#__codelineno-158-12"></a><span class="w">      </span><span class="n">FROM</span><span class="p">(</span><span class="s">"users"</span><span class="p">);</span>
</span><span id="__span-158-13"><a id="__codelineno-158-13" name="__codelineno-158-13" href="#__codelineno-158-13"></a><span class="w">      </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"name like #{name} || '%'"</span><span class="p">);</span>
</span><span id="__span-158-14"><a id="__codelineno-158-14" name="__codelineno-158-14" href="#__codelineno-158-14"></a><span class="w">      </span><span class="n">ORDER_BY</span><span class="p">(</span><span class="n">orderByColumn</span><span class="p">);</span>
</span><span id="__span-158-15"><a id="__codelineno-158-15" name="__codelineno-158-15" href="#__codelineno-158-15"></a><span class="w">    </span><span class="p">}}.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-158-16"><a id="__codelineno-158-16" name="__codelineno-158-16" href="#__codelineno-158-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-158-17"><a id="__codelineno-158-17" name="__codelineno-158-17" href="#__codelineno-158-17"></a>
</span><span id="__span-158-18"><a id="__codelineno-158-18" name="__codelineno-158-18" href="#__codelineno-158-18"></a><span class="w">  </span><span class="c1">// å¦‚æœä½¿ç”¨ @Paramï¼Œå°±å¯ä»¥åªå®šä¹‰éœ€è¦ä½¿ç”¨çš„å‚æ•°</span>
</span><span id="__span-158-19"><a id="__codelineno-158-19" name="__codelineno-158-19" href="#__codelineno-158-19"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">buildGetUsersByName</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">"orderByColumn"</span><span class="p">)</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderByColumn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-20"><a id="__codelineno-158-20" name="__codelineno-158-20" href="#__codelineno-158-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">(){{</span>
</span><span id="__span-158-21"><a id="__codelineno-158-21" name="__codelineno-158-21" href="#__codelineno-158-21"></a><span class="w">      </span><span class="n">SELECT</span><span class="p">(</span><span class="s">"*"</span><span class="p">);</span>
</span><span id="__span-158-22"><a id="__codelineno-158-22" name="__codelineno-158-22" href="#__codelineno-158-22"></a><span class="w">      </span><span class="n">FROM</span><span class="p">(</span><span class="s">"users"</span><span class="p">);</span>
</span><span id="__span-158-23"><a id="__codelineno-158-23" name="__codelineno-158-23" href="#__codelineno-158-23"></a><span class="w">      </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"name like #{name} || '%'"</span><span class="p">);</span>
</span><span id="__span-158-24"><a id="__codelineno-158-24" name="__codelineno-158-24" href="#__codelineno-158-24"></a><span class="w">      </span><span class="n">ORDER_BY</span><span class="p">(</span><span class="n">orderByColumn</span><span class="p">);</span>
</span><span id="__span-158-25"><a id="__codelineno-158-25" name="__codelineno-158-25" href="#__codelineno-158-25"></a><span class="w">    </span><span class="p">}}.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-158-26"><a id="__codelineno-158-26" name="__codelineno-158-26" href="#__codelineno-158-26"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-158-27"><a id="__codelineno-158-27" name="__codelineno-158-27" href="#__codelineno-158-27"></a><span class="p">}</span>
</span></code></pre></div> <p>ä»¥ä¸‹ä¾‹å­å±•ç¤ºäº† <code>ProviderMethodResolver</code>ï¼ˆ3.5.1 åå¯ç”¨ï¼‰çš„é»˜è®¤å®ç°ä½¿ç”¨æ–¹æ³•ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a><span class="nd">@SelectProvider</span><span class="p">(</span><span class="n">UserSqlProvider</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-159-2"><a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getUsersByName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-159-3"><a id="__codelineno-159-3" name="__codelineno-159-3" href="#__codelineno-159-3"></a>
</span><span id="__span-159-4"><a id="__codelineno-159-4" name="__codelineno-159-4" href="#__codelineno-159-4"></a><span class="c1">// åœ¨ä½ çš„ provider ç±»ä¸­å®ç° ProviderMethodResolver æ¥å£</span>
</span><span id="__span-159-5"><a id="__codelineno-159-5" name="__codelineno-159-5" href="#__codelineno-159-5"></a><span class="kd">class</span> <span class="nc">UserSqlProvider</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ProviderMethodResolver</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-159-6"><a id="__codelineno-159-6" name="__codelineno-159-6" href="#__codelineno-159-6"></a><span class="w">  </span><span class="c1">// é»˜è®¤å®ç°ä¸­ï¼Œä¼šå°†æ˜ å°„å™¨æ–¹æ³•çš„è°ƒç”¨è§£æåˆ°å®ç°çš„åŒåæ–¹æ³•ä¸Š</span>
</span><span id="__span-159-7"><a id="__codelineno-159-7" name="__codelineno-159-7" href="#__codelineno-159-7"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getUsersByName</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-159-8"><a id="__codelineno-159-8" name="__codelineno-159-8" href="#__codelineno-159-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">(){{</span>
</span><span id="__span-159-9"><a id="__codelineno-159-9" name="__codelineno-159-9" href="#__codelineno-159-9"></a><span class="w">      </span><span class="n">SELECT</span><span class="p">(</span><span class="s">"*"</span><span class="p">);</span>
</span><span id="__span-159-10"><a id="__codelineno-159-10" name="__codelineno-159-10" href="#__codelineno-159-10"></a><span class="w">      </span><span class="n">FROM</span><span class="p">(</span><span class="s">"users"</span><span class="p">);</span>
</span><span id="__span-159-11"><a id="__codelineno-159-11" name="__codelineno-159-11" href="#__codelineno-159-11"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-159-12"><a id="__codelineno-159-12" name="__codelineno-159-12" href="#__codelineno-159-12"></a><span class="w">        </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"name like #{value} || '%'"</span><span class="p">);</span>
</span><span id="__span-159-13"><a id="__codelineno-159-13" name="__codelineno-159-13" href="#__codelineno-159-13"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-159-14"><a id="__codelineno-159-14" name="__codelineno-159-14" href="#__codelineno-159-14"></a><span class="w">      </span><span class="n">ORDER_BY</span><span class="p">(</span><span class="s">"id"</span><span class="p">);</span>
</span><span id="__span-159-15"><a id="__codelineno-159-15" name="__codelineno-159-15" href="#__codelineno-159-15"></a><span class="w">    </span><span class="p">}}.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-159-16"><a id="__codelineno-159-16" name="__codelineno-159-16" href="#__codelineno-159-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-159-17"><a id="__codelineno-159-17" name="__codelineno-159-17" href="#__codelineno-159-17"></a><span class="p">}</span>
</span></code></pre></div> <h2 id="6sql-è¯­å¥æ„å»ºå™¨">6ã€SQL è¯­å¥æ„å»ºå™¨<a class="headerlink" href="#6sql-è¯­å¥æ„å»ºå™¨" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>Java ç¨‹åºå‘˜é¢å¯¹çš„æœ€ç—›è‹¦çš„äº‹æƒ…ä¹‹ä¸€å°±æ˜¯åœ¨ Java ä»£ç ä¸­åµŒå…¥ SQL è¯­å¥ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºéœ€è¦åŠ¨æ€ç”Ÿæˆ SQL è¯­å¥ï¼Œä¸ç„¶æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬æ”¾åˆ°å¤–éƒ¨æ–‡ä»¶æˆ–è€…å­˜å‚¨è¿‡ç¨‹ä¸­ã€‚å¦‚ä½ æ‰€è§ï¼ŒMyBatis åœ¨ XML æ˜ å°„ä¸­å…·å¤‡å¼ºå¤§çš„ SQL åŠ¨æ€ç”Ÿæˆèƒ½åŠ›ã€‚ä½†æœ‰æ—¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦åœ¨ Java ä»£ç é‡Œæ„å»º SQL è¯­å¥ã€‚æ­¤æ—¶ï¼ŒMyBatis æœ‰å¦å¤–ä¸€ä¸ªç‰¹æ€§å¯ä»¥å¸®åˆ°ä½ ï¼Œè®©ä½ ä»å¤„ç†å…¸å‹é—®é¢˜ä¸­è§£æ”¾å‡ºæ¥ï¼Œæ¯”å¦‚åŠ å·ã€å¼•å·ã€æ¢è¡Œã€æ ¼å¼åŒ–é—®é¢˜ã€åµŒå…¥æ¡ä»¶çš„é€—å·ç®¡ç†åŠ AND è¿æ¥ã€‚ç¡®å®ï¼Œåœ¨ Java ä»£ç ä¸­åŠ¨æ€ç”Ÿæˆ SQL ä»£ç çœŸçš„å°±æ˜¯ä¸€åœºå™©æ¢¦ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="n">String</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"SELECT P.ID, P.USERNAME, P.PASSWORD, P.FULL_NAME, "</span>
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a><span class="s">"P.LAST_NAME,P.CREATED_ON, P.UPDATED_ON "</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a><span class="s">"FROM PERSON P, ACCOUNT A "</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a><span class="s">"INNER JOIN DEPARTMENT D on D.ID = P.DEPARTMENT_ID "</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-160-5"><a id="__codelineno-160-5" name="__codelineno-160-5" href="#__codelineno-160-5"></a><span class="s">"INNER JOIN COMPANY C on D.COMPANY_ID = C.ID "</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-160-6"><a id="__codelineno-160-6" name="__codelineno-160-6" href="#__codelineno-160-6"></a><span class="s">"WHERE (P.ID = A.ID AND P.FIRST_NAME like ?) "</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-160-7"><a id="__codelineno-160-7" name="__codelineno-160-7" href="#__codelineno-160-7"></a><span class="s">"OR (P.LAST_NAME like ?) "</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-160-8"><a id="__codelineno-160-8" name="__codelineno-160-8" href="#__codelineno-160-8"></a><span class="s">"GROUP BY P.ID "</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-160-9"><a id="__codelineno-160-9" name="__codelineno-160-9" href="#__codelineno-160-9"></a><span class="s">"HAVING (P.LAST_NAME like ?) "</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-160-10"><a id="__codelineno-160-10" name="__codelineno-160-10" href="#__codelineno-160-10"></a><span class="s">"OR (P.FIRST_NAME like ?) "</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-160-11"><a id="__codelineno-160-11" name="__codelineno-160-11" href="#__codelineno-160-11"></a><span class="s">"ORDER BY P.ID, P.FULL_NAME"</span><span class="p">;</span>
</span></code></pre></div> <p><strong>è§£å†³æ–¹æ¡ˆ</strong></p> <p>MyBatis 3 æä¾›äº†æ–¹ä¾¿çš„å·¥å…·ç±»æ¥å¸®åŠ©è§£å†³æ­¤é—®é¢˜ã€‚å€ŸåŠ© SQL ç±»ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•åœ°åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå¹¶è°ƒç”¨å®ƒçš„æ–¹æ³•å³å¯ç”Ÿæˆ SQL è¯­å¥ã€‚è®©æˆ‘ä»¬æ¥ç”¨ SQL ç±»é‡å†™ä¸Šé¢çš„ä¾‹å­ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">selectPersonSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-161-2"><a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span><span class="w"> </span><span class="p">{{</span>
</span><span id="__span-161-3"><a id="__codelineno-161-3" name="__codelineno-161-3" href="#__codelineno-161-3"></a><span class="w">    </span><span class="n">SELECT</span><span class="p">(</span><span class="s">"P.ID, P.USERNAME, P.PASSWORD, P.FULL_NAME"</span><span class="p">);</span>
</span><span id="__span-161-4"><a id="__codelineno-161-4" name="__codelineno-161-4" href="#__codelineno-161-4"></a><span class="w">    </span><span class="n">SELECT</span><span class="p">(</span><span class="s">"P.LAST_NAME, P.CREATED_ON, P.UPDATED_ON"</span><span class="p">);</span>
</span><span id="__span-161-5"><a id="__codelineno-161-5" name="__codelineno-161-5" href="#__codelineno-161-5"></a><span class="w">    </span><span class="n">FROM</span><span class="p">(</span><span class="s">"PERSON P"</span><span class="p">);</span>
</span><span id="__span-161-6"><a id="__codelineno-161-6" name="__codelineno-161-6" href="#__codelineno-161-6"></a><span class="w">    </span><span class="n">FROM</span><span class="p">(</span><span class="s">"ACCOUNT A"</span><span class="p">);</span>
</span><span id="__span-161-7"><a id="__codelineno-161-7" name="__codelineno-161-7" href="#__codelineno-161-7"></a><span class="w">    </span><span class="n">INNER_JOIN</span><span class="p">(</span><span class="s">"DEPARTMENT D on D.ID = P.DEPARTMENT_ID"</span><span class="p">);</span>
</span><span id="__span-161-8"><a id="__codelineno-161-8" name="__codelineno-161-8" href="#__codelineno-161-8"></a><span class="w">    </span><span class="n">INNER_JOIN</span><span class="p">(</span><span class="s">"COMPANY C on D.COMPANY_ID = C.ID"</span><span class="p">);</span>
</span><span id="__span-161-9"><a id="__codelineno-161-9" name="__codelineno-161-9" href="#__codelineno-161-9"></a><span class="w">    </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"P.ID = A.ID"</span><span class="p">);</span>
</span><span id="__span-161-10"><a id="__codelineno-161-10" name="__codelineno-161-10" href="#__codelineno-161-10"></a><span class="w">    </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"P.FIRST_NAME like ?"</span><span class="p">);</span>
</span><span id="__span-161-11"><a id="__codelineno-161-11" name="__codelineno-161-11" href="#__codelineno-161-11"></a><span class="w">    </span><span class="n">OR</span><span class="p">();</span>
</span><span id="__span-161-12"><a id="__codelineno-161-12" name="__codelineno-161-12" href="#__codelineno-161-12"></a><span class="w">    </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"P.LAST_NAME like ?"</span><span class="p">);</span>
</span><span id="__span-161-13"><a id="__codelineno-161-13" name="__codelineno-161-13" href="#__codelineno-161-13"></a><span class="w">    </span><span class="n">GROUP_BY</span><span class="p">(</span><span class="s">"P.ID"</span><span class="p">);</span>
</span><span id="__span-161-14"><a id="__codelineno-161-14" name="__codelineno-161-14" href="#__codelineno-161-14"></a><span class="w">    </span><span class="n">HAVING</span><span class="p">(</span><span class="s">"P.LAST_NAME like ?"</span><span class="p">);</span>
</span><span id="__span-161-15"><a id="__codelineno-161-15" name="__codelineno-161-15" href="#__codelineno-161-15"></a><span class="w">    </span><span class="n">OR</span><span class="p">();</span>
</span><span id="__span-161-16"><a id="__codelineno-161-16" name="__codelineno-161-16" href="#__codelineno-161-16"></a><span class="w">    </span><span class="n">HAVING</span><span class="p">(</span><span class="s">"P.FIRST_NAME like ?"</span><span class="p">);</span>
</span><span id="__span-161-17"><a id="__codelineno-161-17" name="__codelineno-161-17" href="#__codelineno-161-17"></a><span class="w">    </span><span class="n">ORDER_BY</span><span class="p">(</span><span class="s">"P.ID"</span><span class="p">);</span>
</span><span id="__span-161-18"><a id="__codelineno-161-18" name="__codelineno-161-18" href="#__codelineno-161-18"></a><span class="w">    </span><span class="n">ORDER_BY</span><span class="p">(</span><span class="s">"P.FULL_NAME"</span><span class="p">);</span>
</span><span id="__span-161-19"><a id="__codelineno-161-19" name="__codelineno-161-19" href="#__codelineno-161-19"></a><span class="w">  </span><span class="p">}}.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-161-20"><a id="__codelineno-161-20" name="__codelineno-161-20" href="#__codelineno-161-20"></a><span class="p">}</span>
</span></code></pre></div> <p>è¿™ä¸ªä¾‹å­æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„å—ï¼Ÿä»”ç»†çœ‹ä¸€ä¸‹ä½ ä¼šå‘ç°ï¼Œä½ ä¸ç”¨æ‹…å¿ƒå¯èƒ½ä¼šé‡å¤å‡ºç°çš„ "AND" å…³é”®å­—ï¼Œæˆ–è€…è¦åšå‡ºç”¨ "WHERE" æ‹¼æ¥è¿˜æ˜¯ "AND" æ‹¼æ¥è¿˜æ˜¯ä¸ç”¨æ‹¼æ¥çš„é€‰æ‹©ã€‚SQL ç±»å·²ç»ä¸ºä½ å¤„ç†äº†å“ªé‡Œåº”è¯¥æ’å…¥ "WHERE"ã€å“ªé‡Œåº”è¯¥ä½¿ç”¨ "AND" çš„é—®é¢˜ï¼Œå¹¶å¸®ä½ å®Œæˆæ‰€æœ‰çš„å­—ç¬¦ä¸²æ‹¼æ¥å·¥ä½œã€‚</p> <h4 id="sql-ç±»">SQL ç±»<a class="headerlink" href="#sql-ç±»" title="é”šç‚¹é“¾æ¥">Â¶</a></h4> <p>è¿™é‡Œæœ‰ä¸€äº›ç¤ºä¾‹ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="c1">// åŒ¿åå†…éƒ¨ç±»é£æ ¼</span>
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">deletePersonSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span><span class="w"> </span><span class="p">{{</span>
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4" href="#__codelineno-162-4"></a><span class="w">    </span><span class="n">DELETE_FROM</span><span class="p">(</span><span class="s">"PERSON"</span><span class="p">);</span>
</span><span id="__span-162-5"><a id="__codelineno-162-5" name="__codelineno-162-5" href="#__codelineno-162-5"></a><span class="w">    </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"ID = #{id}"</span><span class="p">);</span>
</span><span id="__span-162-6"><a id="__codelineno-162-6" name="__codelineno-162-6" href="#__codelineno-162-6"></a><span class="w">  </span><span class="p">}}.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-162-7"><a id="__codelineno-162-7" name="__codelineno-162-7" href="#__codelineno-162-7"></a><span class="p">}</span>
</span><span id="__span-162-8"><a id="__codelineno-162-8" name="__codelineno-162-8" href="#__codelineno-162-8"></a>
</span><span id="__span-162-9"><a id="__codelineno-162-9" name="__codelineno-162-9" href="#__codelineno-162-9"></a><span class="c1">// Builder / Fluent é£æ ¼</span>
</span><span id="__span-162-10"><a id="__codelineno-162-10" name="__codelineno-162-10" href="#__codelineno-162-10"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">insertPersonSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-11"><a id="__codelineno-162-11" name="__codelineno-162-11" href="#__codelineno-162-11"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span>
</span><span id="__span-162-12"><a id="__codelineno-162-12" name="__codelineno-162-12" href="#__codelineno-162-12"></a><span class="w">    </span><span class="p">.</span><span class="na">INSERT_INTO</span><span class="p">(</span><span class="s">"PERSON"</span><span class="p">)</span>
</span><span id="__span-162-13"><a id="__codelineno-162-13" name="__codelineno-162-13" href="#__codelineno-162-13"></a><span class="w">    </span><span class="p">.</span><span class="na">VALUES</span><span class="p">(</span><span class="s">"ID, FIRST_NAME"</span><span class="p">,</span><span class="w"> </span><span class="s">"#{id}, #{firstName}"</span><span class="p">)</span>
</span><span id="__span-162-14"><a id="__codelineno-162-14" name="__codelineno-162-14" href="#__codelineno-162-14"></a><span class="w">    </span><span class="p">.</span><span class="na">VALUES</span><span class="p">(</span><span class="s">"LAST_NAME"</span><span class="p">,</span><span class="w"> </span><span class="s">"#{lastName}"</span><span class="p">)</span>
</span><span id="__span-162-15"><a id="__codelineno-162-15" name="__codelineno-162-15" href="#__codelineno-162-15"></a><span class="w">    </span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-162-16"><a id="__codelineno-162-16" name="__codelineno-162-16" href="#__codelineno-162-16"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">sql</span><span class="p">;</span>
</span><span id="__span-162-17"><a id="__codelineno-162-17" name="__codelineno-162-17" href="#__codelineno-162-17"></a><span class="p">}</span>
</span><span id="__span-162-18"><a id="__codelineno-162-18" name="__codelineno-162-18" href="#__codelineno-162-18"></a>
</span><span id="__span-162-19"><a id="__codelineno-162-19" name="__codelineno-162-19" href="#__codelineno-162-19"></a><span class="c1">// åŠ¨æ€æ¡ä»¶ï¼ˆæ³¨æ„å‚æ•°éœ€è¦ä½¿ç”¨ final ä¿®é¥°ï¼Œä»¥ä¾¿åŒ¿åå†…éƒ¨ç±»å¯¹å®ƒä»¬è¿›è¡Œè®¿é—®ï¼‰</span>
</span><span id="__span-162-20"><a id="__codelineno-162-20" name="__codelineno-162-20" href="#__codelineno-162-20"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">selectPersonLike</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">firstName</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-21"><a id="__codelineno-162-21" name="__codelineno-162-21" href="#__codelineno-162-21"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span><span class="w"> </span><span class="p">{{</span>
</span><span id="__span-162-22"><a id="__codelineno-162-22" name="__codelineno-162-22" href="#__codelineno-162-22"></a><span class="w">    </span><span class="n">SELECT</span><span class="p">(</span><span class="s">"P.ID, P.USERNAME, P.PASSWORD, P.FIRST_NAME, P.LAST_NAME"</span><span class="p">);</span>
</span><span id="__span-162-23"><a id="__codelineno-162-23" name="__codelineno-162-23" href="#__codelineno-162-23"></a><span class="w">    </span><span class="n">FROM</span><span class="p">(</span><span class="s">"PERSON P"</span><span class="p">);</span>
</span><span id="__span-162-24"><a id="__codelineno-162-24" name="__codelineno-162-24" href="#__codelineno-162-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-25"><a id="__codelineno-162-25" name="__codelineno-162-25" href="#__codelineno-162-25"></a><span class="w">      </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"P.ID like #{id}"</span><span class="p">);</span>
</span><span id="__span-162-26"><a id="__codelineno-162-26" name="__codelineno-162-26" href="#__codelineno-162-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-162-27"><a id="__codelineno-162-27" name="__codelineno-162-27" href="#__codelineno-162-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">firstName</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-28"><a id="__codelineno-162-28" name="__codelineno-162-28" href="#__codelineno-162-28"></a><span class="w">      </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"P.FIRST_NAME like #{firstName}"</span><span class="p">);</span>
</span><span id="__span-162-29"><a id="__codelineno-162-29" name="__codelineno-162-29" href="#__codelineno-162-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-162-30"><a id="__codelineno-162-30" name="__codelineno-162-30" href="#__codelineno-162-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lastName</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-31"><a id="__codelineno-162-31" name="__codelineno-162-31" href="#__codelineno-162-31"></a><span class="w">      </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"P.LAST_NAME like #{lastName}"</span><span class="p">);</span>
</span><span id="__span-162-32"><a id="__codelineno-162-32" name="__codelineno-162-32" href="#__codelineno-162-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-162-33"><a id="__codelineno-162-33" name="__codelineno-162-33" href="#__codelineno-162-33"></a><span class="w">    </span><span class="n">ORDER_BY</span><span class="p">(</span><span class="s">"P.LAST_NAME"</span><span class="p">);</span>
</span><span id="__span-162-34"><a id="__codelineno-162-34" name="__codelineno-162-34" href="#__codelineno-162-34"></a><span class="w">  </span><span class="p">}}.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-162-35"><a id="__codelineno-162-35" name="__codelineno-162-35" href="#__codelineno-162-35"></a><span class="p">}</span>
</span><span id="__span-162-36"><a id="__codelineno-162-36" name="__codelineno-162-36" href="#__codelineno-162-36"></a>
</span><span id="__span-162-37"><a id="__codelineno-162-37" name="__codelineno-162-37" href="#__codelineno-162-37"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">deletePersonSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-38"><a id="__codelineno-162-38" name="__codelineno-162-38" href="#__codelineno-162-38"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span><span class="w"> </span><span class="p">{{</span>
</span><span id="__span-162-39"><a id="__codelineno-162-39" name="__codelineno-162-39" href="#__codelineno-162-39"></a><span class="w">    </span><span class="n">DELETE_FROM</span><span class="p">(</span><span class="s">"PERSON"</span><span class="p">);</span>
</span><span id="__span-162-40"><a id="__codelineno-162-40" name="__codelineno-162-40" href="#__codelineno-162-40"></a><span class="w">    </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"ID = #{id}"</span><span class="p">);</span>
</span><span id="__span-162-41"><a id="__codelineno-162-41" name="__codelineno-162-41" href="#__codelineno-162-41"></a><span class="w">  </span><span class="p">}}.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-162-42"><a id="__codelineno-162-42" name="__codelineno-162-42" href="#__codelineno-162-42"></a><span class="p">}</span>
</span><span id="__span-162-43"><a id="__codelineno-162-43" name="__codelineno-162-43" href="#__codelineno-162-43"></a>
</span><span id="__span-162-44"><a id="__codelineno-162-44" name="__codelineno-162-44" href="#__codelineno-162-44"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">insertPersonSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-45"><a id="__codelineno-162-45" name="__codelineno-162-45" href="#__codelineno-162-45"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span><span class="w"> </span><span class="p">{{</span>
</span><span id="__span-162-46"><a id="__codelineno-162-46" name="__codelineno-162-46" href="#__codelineno-162-46"></a><span class="w">    </span><span class="n">INSERT_INTO</span><span class="p">(</span><span class="s">"PERSON"</span><span class="p">);</span>
</span><span id="__span-162-47"><a id="__codelineno-162-47" name="__codelineno-162-47" href="#__codelineno-162-47"></a><span class="w">    </span><span class="n">VALUES</span><span class="p">(</span><span class="s">"ID, FIRST_NAME"</span><span class="p">,</span><span class="w"> </span><span class="s">"#{id}, #{firstName}"</span><span class="p">);</span>
</span><span id="__span-162-48"><a id="__codelineno-162-48" name="__codelineno-162-48" href="#__codelineno-162-48"></a><span class="w">    </span><span class="n">VALUES</span><span class="p">(</span><span class="s">"LAST_NAME"</span><span class="p">,</span><span class="w"> </span><span class="s">"#{lastName}"</span><span class="p">);</span>
</span><span id="__span-162-49"><a id="__codelineno-162-49" name="__codelineno-162-49" href="#__codelineno-162-49"></a><span class="w">  </span><span class="p">}}.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-162-50"><a id="__codelineno-162-50" name="__codelineno-162-50" href="#__codelineno-162-50"></a><span class="p">}</span>
</span><span id="__span-162-51"><a id="__codelineno-162-51" name="__codelineno-162-51" href="#__codelineno-162-51"></a>
</span><span id="__span-162-52"><a id="__codelineno-162-52" name="__codelineno-162-52" href="#__codelineno-162-52"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">updatePersonSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-162-53"><a id="__codelineno-162-53" name="__codelineno-162-53" href="#__codelineno-162-53"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span><span class="w"> </span><span class="p">{{</span>
</span><span id="__span-162-54"><a id="__codelineno-162-54" name="__codelineno-162-54" href="#__codelineno-162-54"></a><span class="w">    </span><span class="n">UPDATE</span><span class="p">(</span><span class="s">"PERSON"</span><span class="p">);</span>
</span><span id="__span-162-55"><a id="__codelineno-162-55" name="__codelineno-162-55" href="#__codelineno-162-55"></a><span class="w">    </span><span class="n">SET</span><span class="p">(</span><span class="s">"FIRST_NAME = #{firstName}"</span><span class="p">);</span>
</span><span id="__span-162-56"><a id="__codelineno-162-56" name="__codelineno-162-56" href="#__codelineno-162-56"></a><span class="w">    </span><span class="n">WHERE</span><span class="p">(</span><span class="s">"ID = #{id}"</span><span class="p">);</span>
</span><span id="__span-162-57"><a id="__codelineno-162-57" name="__codelineno-162-57" href="#__codelineno-162-57"></a><span class="w">  </span><span class="p">}}.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-162-58"><a id="__codelineno-162-58" name="__codelineno-162-58" href="#__codelineno-162-58"></a><span class="p">}</span>
</span></code></pre></div> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="!assets/Mybatis/QQæˆªå›¾20200616101536.png" data-desc-position="bottom"><img src="!assets/Mybatis/QQæˆªå›¾20200616101536.png" alt style></a></p> <p><strong>æç¤º</strong> æ³¨æ„ï¼ŒSQL ç±»å°†åŸæ ·æ’å…¥ <code>LIMIT</code>ã€<code>OFFSET</code>ã€<code>OFFSET n ROWS</code> ä»¥åŠ <code>FETCH FIRST n ROWS ONLY</code> å­å¥ã€‚æ¢å¥è¯è¯´ï¼Œç±»åº“ä¸ä¼šä¸ºä¸æ”¯æŒè¿™äº›å­å¥çš„æ•°æ®åº“æ‰§è¡Œä»»ä½•è½¬æ¢ã€‚ å› æ­¤ï¼Œç”¨æˆ·åº”è¯¥è¦äº†è§£ç›®æ ‡æ•°æ®åº“æ˜¯å¦æ”¯æŒè¿™äº›å­å¥ã€‚å¦‚æœç›®æ ‡æ•°æ®åº“ä¸æ”¯æŒè¿™äº›å­å¥ï¼Œäº§ç”Ÿçš„ SQL å¯èƒ½ä¼šå¼•èµ·è¿è¡Œé”™è¯¯ã€‚</p> <p>ä»ç‰ˆæœ¬ 3.4.2 å¼€å§‹ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨å¯å˜é•¿åº¦å‚æ•°ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">selectPersonSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-163-2"><a id="__codelineno-163-2" name="__codelineno-163-2" href="#__codelineno-163-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span>
</span><span id="__span-163-3"><a id="__codelineno-163-3" name="__codelineno-163-3" href="#__codelineno-163-3"></a><span class="w">    </span><span class="p">.</span><span class="na">SELECT</span><span class="p">(</span><span class="s">"P.ID"</span><span class="p">,</span><span class="w"> </span><span class="s">"A.USERNAME"</span><span class="p">,</span><span class="w"> </span><span class="s">"A.PASSWORD"</span><span class="p">,</span><span class="w"> </span><span class="s">"P.FULL_NAME"</span><span class="p">,</span><span class="w"> </span><span class="s">"D.DEPARTMENT_NAME"</span><span class="p">,</span><span class="w"> </span><span class="s">"C.COMPANY_NAME"</span><span class="p">)</span>
</span><span id="__span-163-4"><a id="__codelineno-163-4" name="__codelineno-163-4" href="#__codelineno-163-4"></a><span class="w">    </span><span class="p">.</span><span class="na">FROM</span><span class="p">(</span><span class="s">"PERSON P"</span><span class="p">,</span><span class="w"> </span><span class="s">"ACCOUNT A"</span><span class="p">)</span>
</span><span id="__span-163-5"><a id="__codelineno-163-5" name="__codelineno-163-5" href="#__codelineno-163-5"></a><span class="w">    </span><span class="p">.</span><span class="na">INNER_JOIN</span><span class="p">(</span><span class="s">"DEPARTMENT D on D.ID = P.DEPARTMENT_ID"</span><span class="p">,</span><span class="w"> </span><span class="s">"COMPANY C on D.COMPANY_ID = C.ID"</span><span class="p">)</span>
</span><span id="__span-163-6"><a id="__codelineno-163-6" name="__codelineno-163-6" href="#__codelineno-163-6"></a><span class="w">    </span><span class="p">.</span><span class="na">WHERE</span><span class="p">(</span><span class="s">"P.ID = A.ID"</span><span class="p">,</span><span class="w"> </span><span class="s">"P.FULL_NAME like #{name}"</span><span class="p">)</span>
</span><span id="__span-163-7"><a id="__codelineno-163-7" name="__codelineno-163-7" href="#__codelineno-163-7"></a><span class="w">    </span><span class="p">.</span><span class="na">ORDER_BY</span><span class="p">(</span><span class="s">"P.ID"</span><span class="p">,</span><span class="w"> </span><span class="s">"P.FULL_NAME"</span><span class="p">)</span>
</span><span id="__span-163-8"><a id="__codelineno-163-8" name="__codelineno-163-8" href="#__codelineno-163-8"></a><span class="w">    </span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-163-9"><a id="__codelineno-163-9" name="__codelineno-163-9" href="#__codelineno-163-9"></a><span class="p">}</span>
</span><span id="__span-163-10"><a id="__codelineno-163-10" name="__codelineno-163-10" href="#__codelineno-163-10"></a>
</span><span id="__span-163-11"><a id="__codelineno-163-11" name="__codelineno-163-11" href="#__codelineno-163-11"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">insertPersonSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-163-12"><a id="__codelineno-163-12" name="__codelineno-163-12" href="#__codelineno-163-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span>
</span><span id="__span-163-13"><a id="__codelineno-163-13" name="__codelineno-163-13" href="#__codelineno-163-13"></a><span class="w">    </span><span class="p">.</span><span class="na">INSERT_INTO</span><span class="p">(</span><span class="s">"PERSON"</span><span class="p">)</span>
</span><span id="__span-163-14"><a id="__codelineno-163-14" name="__codelineno-163-14" href="#__codelineno-163-14"></a><span class="w">    </span><span class="p">.</span><span class="na">INTO_COLUMNS</span><span class="p">(</span><span class="s">"ID"</span><span class="p">,</span><span class="w"> </span><span class="s">"FULL_NAME"</span><span class="p">)</span>
</span><span id="__span-163-15"><a id="__codelineno-163-15" name="__codelineno-163-15" href="#__codelineno-163-15"></a><span class="w">    </span><span class="p">.</span><span class="na">INTO_VALUES</span><span class="p">(</span><span class="s">"#{id}"</span><span class="p">,</span><span class="w"> </span><span class="s">"#{fullName}"</span><span class="p">)</span>
</span><span id="__span-163-16"><a id="__codelineno-163-16" name="__codelineno-163-16" href="#__codelineno-163-16"></a><span class="w">    </span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-163-17"><a id="__codelineno-163-17" name="__codelineno-163-17" href="#__codelineno-163-17"></a><span class="p">}</span>
</span><span id="__span-163-18"><a id="__codelineno-163-18" name="__codelineno-163-18" href="#__codelineno-163-18"></a>
</span><span id="__span-163-19"><a id="__codelineno-163-19" name="__codelineno-163-19" href="#__codelineno-163-19"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">updatePersonSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-163-20"><a id="__codelineno-163-20" name="__codelineno-163-20" href="#__codelineno-163-20"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span>
</span><span id="__span-163-21"><a id="__codelineno-163-21" name="__codelineno-163-21" href="#__codelineno-163-21"></a><span class="w">    </span><span class="p">.</span><span class="na">UPDATE</span><span class="p">(</span><span class="s">"PERSON"</span><span class="p">)</span>
</span><span id="__span-163-22"><a id="__codelineno-163-22" name="__codelineno-163-22" href="#__codelineno-163-22"></a><span class="w">    </span><span class="p">.</span><span class="na">SET</span><span class="p">(</span><span class="s">"FULL_NAME = #{fullName}"</span><span class="p">,</span><span class="w"> </span><span class="s">"DATE_OF_BIRTH = #{dateOfBirth}"</span><span class="p">)</span>
</span><span id="__span-163-23"><a id="__codelineno-163-23" name="__codelineno-163-23" href="#__codelineno-163-23"></a><span class="w">    </span><span class="p">.</span><span class="na">WHERE</span><span class="p">(</span><span class="s">"ID = #{id}"</span><span class="p">)</span>
</span><span id="__span-163-24"><a id="__codelineno-163-24" name="__codelineno-163-24" href="#__codelineno-163-24"></a><span class="w">    </span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-163-25"><a id="__codelineno-163-25" name="__codelineno-163-25" href="#__codelineno-163-25"></a><span class="p">}</span>
</span></code></pre></div> <p>ä»ç‰ˆæœ¬ 3.5.2 å¼€å§‹ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·æ„å»ºæ‰¹é‡æ’å…¥è¯­å¥ï¼š</p> <div class="language-Java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">insertPersonsSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-2"><a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a><span class="w">  </span><span class="c1">// INSERT INTO PERSON (ID, FULL_NAME)</span>
</span><span id="__span-164-3"><a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a><span class="w">  </span><span class="c1">//     VALUES (#{mainPerson.id}, #{mainPerson.fullName}) , (#{subPerson.id}, #{subPerson.fullName})</span>
</span><span id="__span-164-4"><a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span>
</span><span id="__span-164-5"><a id="__codelineno-164-5" name="__codelineno-164-5" href="#__codelineno-164-5"></a><span class="w">    </span><span class="p">.</span><span class="na">INSERT_INTO</span><span class="p">(</span><span class="s">"PERSON"</span><span class="p">)</span>
</span><span id="__span-164-6"><a id="__codelineno-164-6" name="__codelineno-164-6" href="#__codelineno-164-6"></a><span class="w">    </span><span class="p">.</span><span class="na">INTO_COLUMNS</span><span class="p">(</span><span class="s">"ID"</span><span class="p">,</span><span class="w"> </span><span class="s">"FULL_NAME"</span><span class="p">)</span>
</span><span id="__span-164-7"><a id="__codelineno-164-7" name="__codelineno-164-7" href="#__codelineno-164-7"></a><span class="w">    </span><span class="p">.</span><span class="na">INTO_VALUES</span><span class="p">(</span><span class="s">"#{mainPerson.id}"</span><span class="p">,</span><span class="w"> </span><span class="s">"#{mainPerson.fullName}"</span><span class="p">)</span>
</span><span id="__span-164-8"><a id="__codelineno-164-8" name="__codelineno-164-8" href="#__codelineno-164-8"></a><span class="w">    </span><span class="p">.</span><span class="na">ADD_ROW</span><span class="p">()</span>
</span><span id="__span-164-9"><a id="__codelineno-164-9" name="__codelineno-164-9" href="#__codelineno-164-9"></a><span class="w">    </span><span class="p">.</span><span class="na">INTO_VALUES</span><span class="p">(</span><span class="s">"#{subPerson.id}"</span><span class="p">,</span><span class="w"> </span><span class="s">"#{subPerson.fullName}"</span><span class="p">)</span>
</span><span id="__span-164-10"><a id="__codelineno-164-10" name="__codelineno-164-10" href="#__codelineno-164-10"></a><span class="w">    </span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-164-11"><a id="__codelineno-164-11" name="__codelineno-164-11" href="#__codelineno-164-11"></a><span class="p">}</span>
</span></code></pre></div> <p>ä»ç‰ˆæœ¬ 3.5.2 å¼€å§‹ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·æ„å»ºé™åˆ¶è¿”å›ç»“æœæ•°çš„ SELECT è¯­å¥,ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">selectPersonsWithOffsetLimitSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-165-2"><a id="__codelineno-165-2" name="__codelineno-165-2" href="#__codelineno-165-2"></a><span class="w">  </span><span class="c1">// SELECT id, name FROM PERSON</span>
</span><span id="__span-165-3"><a id="__codelineno-165-3" name="__codelineno-165-3" href="#__codelineno-165-3"></a><span class="w">  </span><span class="c1">//     LIMIT #{limit} OFFSET #{offset}</span>
</span><span id="__span-165-4"><a id="__codelineno-165-4" name="__codelineno-165-4" href="#__codelineno-165-4"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span>
</span><span id="__span-165-5"><a id="__codelineno-165-5" name="__codelineno-165-5" href="#__codelineno-165-5"></a><span class="w">    </span><span class="p">.</span><span class="na">SELECT</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span><span class="w"> </span><span class="s">"name"</span><span class="p">)</span>
</span><span id="__span-165-6"><a id="__codelineno-165-6" name="__codelineno-165-6" href="#__codelineno-165-6"></a><span class="w">    </span><span class="p">.</span><span class="na">FROM</span><span class="p">(</span><span class="s">"PERSON"</span><span class="p">)</span>
</span><span id="__span-165-7"><a id="__codelineno-165-7" name="__codelineno-165-7" href="#__codelineno-165-7"></a><span class="w">    </span><span class="p">.</span><span class="na">LIMIT</span><span class="p">(</span><span class="s">"#{limit}"</span><span class="p">)</span>
</span><span id="__span-165-8"><a id="__codelineno-165-8" name="__codelineno-165-8" href="#__codelineno-165-8"></a><span class="w">    </span><span class="p">.</span><span class="na">OFFSET</span><span class="p">(</span><span class="s">"#{offset}"</span><span class="p">)</span>
</span><span id="__span-165-9"><a id="__codelineno-165-9" name="__codelineno-165-9" href="#__codelineno-165-9"></a><span class="w">    </span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-165-10"><a id="__codelineno-165-10" name="__codelineno-165-10" href="#__codelineno-165-10"></a><span class="p">}</span>
</span><span id="__span-165-11"><a id="__codelineno-165-11" name="__codelineno-165-11" href="#__codelineno-165-11"></a>
</span><span id="__span-165-12"><a id="__codelineno-165-12" name="__codelineno-165-12" href="#__codelineno-165-12"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">selectPersonsWithFetchFirstSql</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-165-13"><a id="__codelineno-165-13" name="__codelineno-165-13" href="#__codelineno-165-13"></a><span class="w">  </span><span class="c1">// SELECT id, name FROM PERSON</span>
</span><span id="__span-165-14"><a id="__codelineno-165-14" name="__codelineno-165-14" href="#__codelineno-165-14"></a><span class="w">  </span><span class="c1">//     OFFSET #{offset} ROWS FETCH FIRST #{limit} ROWS ONLY</span>
</span><span id="__span-165-15"><a id="__codelineno-165-15" name="__codelineno-165-15" href="#__codelineno-165-15"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQL</span><span class="p">()</span>
</span><span id="__span-165-16"><a id="__codelineno-165-16" name="__codelineno-165-16" href="#__codelineno-165-16"></a><span class="w">    </span><span class="p">.</span><span class="na">SELECT</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span><span class="w"> </span><span class="s">"name"</span><span class="p">)</span>
</span><span id="__span-165-17"><a id="__codelineno-165-17" name="__codelineno-165-17" href="#__codelineno-165-17"></a><span class="w">    </span><span class="p">.</span><span class="na">FROM</span><span class="p">(</span><span class="s">"PERSON"</span><span class="p">)</span>
</span><span id="__span-165-18"><a id="__codelineno-165-18" name="__codelineno-165-18" href="#__codelineno-165-18"></a><span class="w">    </span><span class="p">.</span><span class="na">OFFSET_ROWS</span><span class="p">(</span><span class="s">"#{offset}"</span><span class="p">)</span>
</span><span id="__span-165-19"><a id="__codelineno-165-19" name="__codelineno-165-19" href="#__codelineno-165-19"></a><span class="w">    </span><span class="p">.</span><span class="na">FETCH_FIRST_ROWS_ONLY</span><span class="p">(</span><span class="s">"#{limit}"</span><span class="p">)</span>
</span><span id="__span-165-20"><a id="__codelineno-165-20" name="__codelineno-165-20" href="#__codelineno-165-20"></a><span class="w">    </span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
</span><span id="__span-165-21"><a id="__codelineno-165-21" name="__codelineno-165-21" href="#__codelineno-165-21"></a><span class="p">}</span>
</span></code></pre></div> <h2 id="7æ—¥å¿—">7ã€æ—¥å¿—<a class="headerlink" href="#7æ—¥å¿—" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>Mybatis é€šè¿‡ä½¿ç”¨å†…ç½®çš„æ—¥å¿—å·¥å‚æä¾›æ—¥å¿—åŠŸèƒ½ã€‚å†…ç½®æ—¥å¿—å·¥å‚å°†ä¼šæŠŠæ—¥å¿—å·¥ä½œå§”æ‰˜ç»™ä¸‹é¢çš„å®ç°ä¹‹ä¸€ï¼š</p> <ul> <li>SLF4J</li> <li>Apache Commons Logging</li> <li>Log4j 2</li> <li>Log4j</li> <li>JDK logging</li> </ul> <p>MyBatis å†…ç½®æ—¥å¿—å·¥å‚ä¼šåŸºäºè¿è¡Œæ—¶æ£€æµ‹ä¿¡æ¯é€‰æ‹©æ—¥å¿—å§”æ‰˜å®ç°ã€‚å®ƒä¼šï¼ˆæŒ‰ä¸Šé¢ç½—åˆ—çš„é¡ºåºï¼‰ä½¿ç”¨ç¬¬ä¸€ä¸ªæŸ¥æ‰¾åˆ°çš„å®ç°ã€‚å½“æ²¡æœ‰æ‰¾åˆ°è¿™äº›å®ç°æ—¶ï¼Œå°†ä¼šç¦ç”¨æ—¥å¿—åŠŸèƒ½ã€‚</p> <p>ä¸å°‘åº”ç”¨æœåŠ¡å™¨ï¼ˆå¦‚ Tomcat å’Œ WebShpereï¼‰çš„ç±»è·¯å¾„ä¸­å·²ç»åŒ…å« Commons Loggingã€‚æ³¨æ„ï¼Œåœ¨è¿™ç§é…ç½®ç¯å¢ƒä¸‹ï¼ŒMyBatis ä¼šæŠŠ Commons Logging ä½œä¸ºæ—¥å¿—å·¥å…·ã€‚è¿™å°±æ„å‘³ç€åœ¨è¯¸å¦‚ WebSphere çš„ç¯å¢ƒä¸­ï¼Œç”±äºæä¾›äº† Commons Logging çš„ç§æœ‰å®ç°ï¼Œä½ çš„ Log4J é…ç½®å°†è¢«å¿½ç•¥ã€‚è¿™ä¸ªæ—¶å€™ä½ å°±ä¼šæ„Ÿè§‰å¾ˆéƒé—·ï¼šçœ‹èµ·æ¥ MyBatis å°†ä½ çš„ Log4J é…ç½®å¿½ç•¥æ‰äº†ï¼ˆå…¶å®æ˜¯å› ä¸ºåœ¨è¿™ç§é…ç½®ç¯å¢ƒä¸‹ï¼ŒMyBatis ä½¿ç”¨äº† Commons Logging ä½œä¸ºæ—¥å¿—å®ç°ï¼‰ã€‚å¦‚æœä½ çš„åº”ç”¨éƒ¨ç½²åœ¨ä¸€ä¸ªç±»è·¯å¾„å·²ç»åŒ…å« Commons Logging çš„ç¯å¢ƒä¸­ï¼Œè€Œä½ åˆæƒ³ä½¿ç”¨å…¶å®ƒæ—¥å¿—å®ç°ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ MyBatis é…ç½®æ–‡ä»¶ mybatis-config.xml é‡Œé¢æ·»åŠ ä¸€é¡¹ setting æ¥é€‰æ‹©å…¶å®ƒæ—¥å¿—å®ç°ã€‚</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a><span class="nt">&lt;configuration&gt;</span>
</span><span id="__span-166-2"><a id="__codelineno-166-2" name="__codelineno-166-2" href="#__codelineno-166-2"></a><span class="w">  </span><span class="nt">&lt;settings&gt;</span>
</span><span id="__span-166-3"><a id="__codelineno-166-3" name="__codelineno-166-3" href="#__codelineno-166-3"></a><span class="w">    </span>...
</span><span id="__span-166-4"><a id="__codelineno-166-4" name="__codelineno-166-4" href="#__codelineno-166-4"></a><span class="w">    </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">"logImpl"</span><span class="w"> </span><span class="na">value=</span><span class="s">"LOG4J"</span><span class="nt">/&gt;</span>
</span><span id="__span-166-5"><a id="__codelineno-166-5" name="__codelineno-166-5" href="#__codelineno-166-5"></a><span class="w">    </span>...
</span><span id="__span-166-6"><a id="__codelineno-166-6" name="__codelineno-166-6" href="#__codelineno-166-6"></a><span class="w">  </span><span class="nt">&lt;/settings&gt;</span>
</span><span id="__span-166-7"><a id="__codelineno-166-7" name="__codelineno-166-7" href="#__codelineno-166-7"></a><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></div> <p>å¯é€‰çš„å€¼æœ‰ï¼šSLF4Jã€LOG4Jã€LOG4J2ã€JDK_LOGGINGã€COMMONS_LOGGINGã€STDOUT_LOGGINGã€NO_LOGGINGï¼Œæˆ–è€…æ˜¯å®ç°äº† <code>org.apache.ibatis.logging.Log</code> æ¥å£ï¼Œä¸”æ„é€ æ–¹æ³•ä»¥å­—ç¬¦ä¸²ä¸ºå‚æ•°çš„ç±»å®Œå…¨é™å®šåã€‚</p> <p>ä½ ä¹Ÿå¯ä»¥è°ƒç”¨ä»¥ä¸‹ä»»ä¸€æ–¹æ³•æ¥é€‰æ‹©æ—¥å¿—å®ç°ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">ibatis</span><span class="p">.</span><span class="na">logging</span><span class="p">.</span><span class="na">LogFactory</span><span class="p">.</span><span class="na">useSlf4jLogging</span><span class="p">();</span>
</span><span id="__span-167-2"><a id="__codelineno-167-2" name="__codelineno-167-2" href="#__codelineno-167-2"></a><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">ibatis</span><span class="p">.</span><span class="na">logging</span><span class="p">.</span><span class="na">LogFactory</span><span class="p">.</span><span class="na">useLog4JLogging</span><span class="p">();</span>
</span><span id="__span-167-3"><a id="__codelineno-167-3" name="__codelineno-167-3" href="#__codelineno-167-3"></a><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">ibatis</span><span class="p">.</span><span class="na">logging</span><span class="p">.</span><span class="na">LogFactory</span><span class="p">.</span><span class="na">useJdkLogging</span><span class="p">();</span>
</span><span id="__span-167-4"><a id="__codelineno-167-4" name="__codelineno-167-4" href="#__codelineno-167-4"></a><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">ibatis</span><span class="p">.</span><span class="na">logging</span><span class="p">.</span><span class="na">LogFactory</span><span class="p">.</span><span class="na">useCommonsLogging</span><span class="p">();</span>
</span><span id="__span-167-5"><a id="__codelineno-167-5" name="__codelineno-167-5" href="#__codelineno-167-5"></a><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">ibatis</span><span class="p">.</span><span class="na">logging</span><span class="p">.</span><span class="na">LogFactory</span><span class="p">.</span><span class="na">useStdOutLogging</span><span class="p">();</span>
</span></code></pre></div> <p>ä½ åº”è¯¥åœ¨è°ƒç”¨å…¶å®ƒ MyBatis æ–¹æ³•ä¹‹å‰è°ƒç”¨ä»¥ä¸Šçš„æŸä¸ªæ–¹æ³•ã€‚å¦å¤–ï¼Œä»…å½“è¿è¡Œæ—¶ç±»è·¯å¾„ä¸­å­˜åœ¨è¯¥æ—¥å¿—å®ç°æ—¶ï¼Œæ—¥å¿—å®ç°çš„åˆ‡æ¢æ‰ä¼šç”Ÿæ•ˆã€‚å¦‚æœä½ çš„ç¯å¢ƒä¸­å¹¶ä¸å­˜åœ¨ Log4Jï¼Œä½ å´è¯•å›¾è°ƒç”¨äº†ç›¸åº”çš„æ–¹æ³•ï¼ŒMyBatis å°±ä¼šå¿½ç•¥è¿™ä¸€åˆ‡æ¢è¯·æ±‚ï¼Œå¹¶å°†ä»¥é»˜è®¤çš„æŸ¥æ‰¾é¡ºåºå†³å®šä½¿ç”¨çš„æ—¥å¿—å®ç°ã€‚</p> <p><strong>æ—¥å¿—é…ç½®</strong></p> <p>ä½ å¯ä»¥é€šè¿‡åœ¨åŒ…ã€æ˜ å°„ç±»çš„å…¨é™å®šåã€å‘½åç©ºé—´æˆ–å…¨é™å®šè¯­å¥åä¸Šå¼€å¯æ—¥å¿—åŠŸèƒ½ï¼Œæ¥æŸ¥çœ‹ MyBatis çš„æ—¥å¿—è¯­å¥ã€‚</p> <p>å†æ¬¡æé†’ï¼Œå…·ä½“é…ç½®æ­¥éª¤å–å†³äºæ—¥å¿—å®ç°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä»¥ Log4J ä½œä¸ºç¤ºèŒƒã€‚é…ç½®æ—¥å¿—åŠŸèƒ½éå¸¸ç®€å•ï¼šæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªé…ç½®æ–‡ä»¶ï¼ˆå¦‚ log4j.propertiesï¼‰ï¼Œæœ‰æ—¶è¿˜éœ€è¦æ·»åŠ  jar åŒ…ï¼ˆå¦‚ log4j.jarï¼‰ã€‚ä¸‹é¢çš„ä¾‹å­å°†ä½¿ç”¨ Log4J æ¥é…ç½®å®Œæ•´çš„æ—¥å¿—æœåŠ¡ã€‚ä¸€å…±ä¸¤ä¸ªæ­¥éª¤ï¼š</p> <ol> <li> <p>æ·»åŠ Log4Jçš„jaråŒ…</p> <p>ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Log4Jï¼Œæˆ‘ä»¬è¦ç¡®ä¿å®ƒçš„ jar åŒ…å¯ä»¥è¢«åº”ç”¨ä½¿ç”¨ã€‚ä¸ºæ­¤ï¼Œéœ€è¦å°† jar åŒ…æ·»åŠ åˆ°åº”ç”¨çš„ç±»è·¯å¾„ä¸­ã€‚Log4J çš„ jar åŒ…å¯ä»¥åœ¨ä¸Šé¢çš„é“¾æ¥ä¸­ä¸‹è½½ã€‚</p> <p>å¯¹äº web åº”ç”¨æˆ–ä¼ä¸šçº§åº”ç”¨ï¼Œä½ å¯ä»¥å°† <code>log4j.jar</code> æ·»åŠ åˆ° <code>WEB-INF/lib</code> ç›®å½•ä¸‹ï¼›å¯¹äºç‹¬ç«‹åº”ç”¨ï¼Œå¯ä»¥å°†å®ƒæ·»åŠ åˆ° JVM çš„ <code>-classpath</code> å¯åŠ¨å‚æ•°ä¸­ã€‚</p> </li> <li> <p>é…ç½®Log4J</p> <p>é…ç½® Log4J æ¯”è¾ƒç®€å•ã€‚å‡è®¾ä½ éœ€è¦è®°å½•è¿™ä¸ªæ˜ å°„å™¨çš„æ—¥å¿—ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">org.mybatis.example</span><span class="p">;</span>
</span><span id="__span-168-2"><a id="__codelineno-168-2" name="__codelineno-168-2" href="#__codelineno-168-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">BlogMapper</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-168-3"><a id="__codelineno-168-3" name="__codelineno-168-3" href="#__codelineno-168-3"></a><span class="w">  </span><span class="nd">@Select</span><span class="p">(</span><span class="s">"SELECT * FROM blog WHERE id = #{id}"</span><span class="p">)</span>
</span><span id="__span-168-4"><a id="__codelineno-168-4" name="__codelineno-168-4" href="#__codelineno-168-4"></a><span class="w">  </span><span class="n">Blog</span><span class="w"> </span><span class="nf">selectBlog</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-168-5"><a id="__codelineno-168-5" name="__codelineno-168-5" href="#__codelineno-168-5"></a><span class="p">}</span>
</span></code></pre></div> <p>åœ¨åº”ç”¨çš„ç±»è·¯å¾„ä¸­åˆ›å»ºä¸€ä¸ªåä¸º <code>log4j.properties</code> çš„æ–‡ä»¶ï¼Œæ–‡ä»¶çš„å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p> <div class="language-properties highlight"><span class="filename">Properties</span><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a><span class="c1"># å…¨å±€æ—¥å¿—é…ç½®</span>
</span><span id="__span-169-2"><a id="__codelineno-169-2" name="__codelineno-169-2" href="#__codelineno-169-2"></a><span class="na">log4j.rootLogger</span><span class="o">=</span><span class="s">ERROR, stdout</span>
</span><span id="__span-169-3"><a id="__codelineno-169-3" name="__codelineno-169-3" href="#__codelineno-169-3"></a><span class="c1"># MyBatis æ—¥å¿—é…ç½®</span>
</span><span id="__span-169-4"><a id="__codelineno-169-4" name="__codelineno-169-4" href="#__codelineno-169-4"></a><span class="na">log4j.logger.org.mybatis.example.BlogMapper</span><span class="o">=</span><span class="s">TRACE</span>
</span><span id="__span-169-5"><a id="__codelineno-169-5" name="__codelineno-169-5" href="#__codelineno-169-5"></a><span class="c1"># æ§åˆ¶å°è¾“å‡º</span>
</span><span id="__span-169-6"><a id="__codelineno-169-6" name="__codelineno-169-6" href="#__codelineno-169-6"></a><span class="na">log4j.appender.stdout</span><span class="o">=</span><span class="s">org.apache.log4j.ConsoleAppender</span>
</span><span id="__span-169-7"><a id="__codelineno-169-7" name="__codelineno-169-7" href="#__codelineno-169-7"></a><span class="na">log4j.appender.stdout.layout</span><span class="o">=</span><span class="s">org.apache.log4j.PatternLayout</span>
</span><span id="__span-169-8"><a id="__codelineno-169-8" name="__codelineno-169-8" href="#__codelineno-169-8"></a><span class="na">log4j.appender.stdout.layout.ConversionPattern</span><span class="o">=</span><span class="s">%5p [%t] - %m%n</span>
</span></code></pre></div> <p>ä¸Šè¿°é…ç½®å°†ä½¿ Log4J è¯¦ç»†æ‰“å° <code>org.mybatis.example.BlogMapper</code> çš„æ—¥å¿—ï¼Œå¯¹äºåº”ç”¨çš„å…¶å®ƒéƒ¨åˆ†ï¼Œåªæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚</p> <p>ä¸ºäº†å®ç°æ›´ç»†ç²’åº¦çš„æ—¥å¿—è¾“å‡ºï¼Œä½ ä¹Ÿå¯ä»¥åªæ‰“å°ç‰¹å®šè¯­å¥çš„æ—¥å¿—ã€‚ä»¥ä¸‹é…ç½®å°†åªæ‰“å°è¯­å¥ <code>selectBlog</code> çš„æ—¥å¿—ï¼š</p> <div class="language-properties highlight"><span class="filename">Properties</span><pre><span></span><code><span id="__span-170-1"><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a><span class="na">log4j.logger.org.mybatis.example.BlogMapper.selectBlog</span><span class="o">=</span><span class="s">TRACE</span>
</span></code></pre></div> <p>æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥æ‰“å°ä¸€ç»„æ˜ å°„å™¨çš„æ—¥å¿—ï¼Œåªéœ€è¦æ‰“å¼€æ˜ å°„å™¨æ‰€åœ¨çš„åŒ…çš„æ—¥å¿—åŠŸèƒ½å³å¯ï¼š</p> <div class="language-properties highlight"><span class="filename">Properties</span><pre><span></span><code><span id="__span-171-1"><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a><span class="na">log4j.logger.org.mybatis.example</span><span class="o">=</span><span class="s">TRACE</span>
</span></code></pre></div> <p>æŸäº›æŸ¥è¯¢å¯èƒ½ä¼šè¿”å›åºå¤§çš„ç»“æœé›†ã€‚è¿™æ—¶ï¼Œä½ å¯èƒ½åªæƒ³æŸ¥çœ‹ SQL è¯­å¥ï¼Œè€Œå¿½ç•¥è¿”å›çš„ç»“æœé›†ã€‚ä¸ºæ­¤ï¼ŒSQL è¯­å¥å°†ä¼šåœ¨ DEBUG æ—¥å¿—çº§åˆ«ä¸‹è®°å½•ï¼ˆJDK æ—¥å¿—åˆ™ä¸º FINEï¼‰ã€‚è¿”å›çš„ç»“æœé›†åˆ™ä¼šåœ¨ TRACE æ—¥å¿—çº§åˆ«ä¸‹è®°å½•ï¼ˆJDK æ—¥å¿—åˆ™ä¸º FINER)ã€‚å› æ­¤ï¼Œåªè¦å°†æ—¥å¿—çº§åˆ«è°ƒæ•´ä¸º DEBUG å³å¯ï¼š</p> <div class="language-properties highlight"><span class="filename">Properties</span><pre><span></span><code><span id="__span-172-1"><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a><span class="na">log4j.logger.org.mybatis.example</span><span class="o">=</span><span class="s">DEBUG</span>
</span></code></pre></div> <p>ä½†å¦‚æœä½ è¦ä¸ºä¸‹é¢çš„æ˜ å°„å™¨ XML æ–‡ä»¶æ‰“å°æ—¥å¿—ï¼Œåˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-173-1"><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
</span><span id="__span-173-2"><a id="__codelineno-173-2" name="__codelineno-173-2" href="#__codelineno-173-2"></a><span class="cp">&lt;!DOCTYPE mapper</span>
</span><span id="__span-173-3"><a id="__codelineno-173-3" name="__codelineno-173-3" href="#__codelineno-173-3"></a><span class="cp">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span>
</span><span id="__span-173-4"><a id="__codelineno-173-4" name="__codelineno-173-4" href="#__codelineno-173-4"></a><span class="cp">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>
</span><span id="__span-173-5"><a id="__codelineno-173-5" name="__codelineno-173-5" href="#__codelineno-173-5"></a><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">"org.mybatis.example.BlogMapper"</span><span class="nt">&gt;</span>
</span><span id="__span-173-6"><a id="__codelineno-173-6" name="__codelineno-173-6" href="#__codelineno-173-6"></a><span class="w">  </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"selectBlog"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"Blog"</span><span class="nt">&gt;</span>
</span><span id="__span-173-7"><a id="__codelineno-173-7" name="__codelineno-173-7" href="#__codelineno-173-7"></a><span class="w">    </span>select<span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>Blog<span class="w"> </span>where<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
</span><span id="__span-173-8"><a id="__codelineno-173-8" name="__codelineno-173-8" href="#__codelineno-173-8"></a><span class="w">  </span><span class="nt">&lt;/select&gt;</span>
</span><span id="__span-173-9"><a id="__codelineno-173-9" name="__codelineno-173-9" href="#__codelineno-173-9"></a><span class="nt">&lt;/mapper&gt;</span>
</span></code></pre></div> <p>è¿™æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡æ‰“å¼€å‘½åç©ºé—´çš„æ—¥å¿—åŠŸèƒ½æ¥å¯¹æ•´ä¸ª XML è®°å½•æ—¥å¿—ï¼š</p> <div class="language-properties highlight"><span class="filename">Properties</span><pre><span></span><code><span id="__span-174-1"><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a><span class="na">log4j.logger.org.mybatis.example.BlogMapper</span><span class="o">=</span><span class="s">TRACE</span>
</span></code></pre></div> <p>è€Œè¦è®°å½•å…·ä½“è¯­å¥çš„æ—¥å¿—ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p> <div class="language-properties highlight"><span class="filename">Properties</span><pre><span></span><code><span id="__span-175-1"><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a><span class="na">log4j.logger.org.mybatis.example.BlogMapper.selectBlog</span><span class="o">=</span><span class="s">TRACE</span>
</span></code></pre></div> <p>ä½ åº”è¯¥ä¼šå‘ç°ï¼Œä¸ºæ˜ å°„å™¨å’Œ XML æ–‡ä»¶æ‰“å¼€æ—¥å¿—åŠŸèƒ½çš„è¯­å¥æ¯«æ— å·®åˆ«ã€‚</p> <p><strong>æç¤º</strong> å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ SLF4J æˆ– Log4j 2ï¼ŒMyBatis ä¼šè®¾ç½® tag ä¸º MYBATISã€‚</p> </li> </ol> <h2 id="8springboot-é›†æˆ">8ã€SpringBoot é›†æˆ<a class="headerlink" href="#8springboot-é›†æˆ" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <ol> <li> <p><strong>å»ºè¡¨</strong></p> <p>åœ¨ MySQL æ•°æ®åº“ä¸­çš„ test æ•°æ®åº“ä¸‹æ–°å»º person è¡¨ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p> <div class="language-mysql highlight"><span class="filename">MySQL</span><pre><span></span><code><span id="__span-176-1"><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a><span class="c1">-- æ–°å¢ person è¡¨</span>
</span><span id="__span-176-2"><a id="__codelineno-176-2" name="__codelineno-176-2" href="#__codelineno-176-2"></a><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">person</span><span class="p">;</span>
</span><span id="__span-176-3"><a id="__codelineno-176-3" name="__codelineno-176-3" href="#__codelineno-176-3"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-176-4"><a id="__codelineno-176-4" name="__codelineno-176-4" href="#__codelineno-176-4"></a><span class="w">  </span><span class="n">pId</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="p">,</span>
</span><span id="__span-176-5"><a id="__codelineno-176-5" name="__codelineno-176-5" href="#__codelineno-176-5"></a><span class="w">  </span><span class="n">pName</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
</span><span id="__span-176-6"><a id="__codelineno-176-6" name="__codelineno-176-6" href="#__codelineno-176-6"></a><span class="w">  </span><span class="n">birthday</span><span class="w"> </span><span class="kt">date</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
</span><span id="__span-176-7"><a id="__codelineno-176-7" name="__codelineno-176-7" href="#__codelineno-176-7"></a><span class="w">  </span><span class="n">salary</span><span class="w"> </span><span class="kt">float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
</span><span id="__span-176-8"><a id="__codelineno-176-8" name="__codelineno-176-8" href="#__codelineno-176-8"></a><span class="w">  </span><span class="n">summary</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
</span><span id="__span-176-9"><a id="__codelineno-176-9" name="__codelineno-176-9" href="#__codelineno-176-9"></a><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">pId</span><span class="p">)</span>
</span><span id="__span-176-10"><a id="__codelineno-176-10" name="__codelineno-176-10" href="#__codelineno-176-10"></a><span class="p">)</span><span class="w"> </span><span class="k">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</span><span id="__span-176-11"><a id="__codelineno-176-11" name="__codelineno-176-11" href="#__codelineno-176-11"></a>
</span><span id="__span-176-12"><a id="__codelineno-176-12" name="__codelineno-176-12" href="#__codelineno-176-12"></a><span class="c1">-- ----------------------------</span>
</span><span id="__span-176-13"><a id="__codelineno-176-13" name="__codelineno-176-13" href="#__codelineno-176-13"></a><span class="c1">-- Records of person</span>
</span><span id="__span-176-14"><a id="__codelineno-176-14" name="__codelineno-176-14" href="#__codelineno-176-14"></a><span class="c1">-- ----------------------------</span>
</span><span id="__span-176-15"><a id="__codelineno-176-15" name="__codelineno-176-15" href="#__codelineno-176-15"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'1'</span><span class="p">,</span><span class="w"> </span><span class="s1">'å¼ ä¸‰'</span><span class="p">,</span><span class="w"> </span><span class="s1">'2021-03-21'</span><span class="p">,</span><span class="w"> </span><span class="s1">'7867.00'</span><span class="p">,</span><span class="w"> </span><span class="s1">'é‡è¦äººç‰©'</span><span class="p">);</span>
</span><span id="__span-176-16"><a id="__codelineno-176-16" name="__codelineno-176-16" href="#__codelineno-176-16"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'2'</span><span class="p">,</span><span class="w"> </span><span class="s1">'æå››'</span><span class="p">,</span><span class="w"> </span><span class="s1">'2010-05-17'</span><span class="p">,</span><span class="w"> </span><span class="s1">'6878.00'</span><span class="p">,</span><span class="w"> </span><span class="s1">'é‡è¦äººç‰©'</span><span class="p">);</span>
</span><span id="__span-176-17"><a id="__codelineno-176-17" name="__codelineno-176-17" href="#__codelineno-176-17"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'3'</span><span class="p">,</span><span class="w"> </span><span class="s1">'ç‹äº”'</span><span class="p">,</span><span class="w"> </span><span class="s1">'2020-02-09'</span><span class="p">,</span><span class="w"> </span><span class="s1">'99.00'</span><span class="p">,</span><span class="w"> </span><span class="s1">'é‡è¦äººç‰©'</span><span class="p">);</span>
</span><span id="__span-176-18"><a id="__codelineno-176-18" name="__codelineno-176-18" href="#__codelineno-176-18"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'4'</span><span class="p">,</span><span class="w"> </span><span class="s1">'é©¬å…­'</span><span class="p">,</span><span class="w"> </span><span class="s1">'2016-07-22'</span><span class="p">,</span><span class="w"> </span><span class="s1">'8897.00'</span><span class="p">,</span><span class="w"> </span><span class="s1">'ç™½é¢†'</span><span class="p">);</span>
</span></code></pre></div> </li> <li> <p><strong>å¯¼å…¥ Maven ä¾èµ–</strong></p> <p>å…¶ä¸­ MyBatis å®˜æ–¹æä¾›çš„é€‚é… Spring Boot çš„ä¾èµ–å¦‚ä¸‹ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-177-1"><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a><span class="cm">&lt;!-- å¼•å…¥ myBatisï¼Œè¿™æ˜¯ MyBatiså®˜æ–¹æä¾›çš„é€‚é… Spring Boot çš„ï¼Œè€Œä¸æ˜¯Spring Bootè‡ªå·±çš„--&gt;</span>
</span><span id="__span-177-2"><a id="__codelineno-177-2" name="__codelineno-177-2" href="#__codelineno-177-2"></a><span class="cm">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter --&gt;</span>
</span><span id="__span-177-3"><a id="__codelineno-177-3" name="__codelineno-177-3" href="#__codelineno-177-3"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-177-4"><a id="__codelineno-177-4" name="__codelineno-177-4" href="#__codelineno-177-4"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-177-5"><a id="__codelineno-177-5" name="__codelineno-177-5" href="#__codelineno-177-5"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-177-6"><a id="__codelineno-177-6" name="__codelineno-177-6" href="#__codelineno-177-6"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>2.1.2<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-177-7"><a id="__codelineno-177-7" name="__codelineno-177-7" href="#__codelineno-177-7"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div> </li> <li> <p><strong>å…¨å±€é…ç½®æ–‡ä»¶</strong></p> <div class="language-yaml highlight"><span class="filename">YAML</span><pre><span></span><code><span id="__span-178-1"><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a><span class="c1">#é¡µé¢æ—¥æœŸä¼ å…¥åå°æ—¶ï¼ŒæŒ‡å®šæ ¼å¼åŒ–</span>
</span><span id="__span-178-2"><a id="__codelineno-178-2" name="__codelineno-178-2" href="#__codelineno-178-2"></a><span class="nt">spring</span><span class="p">:</span>
</span><span id="__span-178-3"><a id="__codelineno-178-3" name="__codelineno-178-3" href="#__codelineno-178-3"></a><span class="w">  </span><span class="nt">mvc</span><span class="p">:</span>
</span><span id="__span-178-4"><a id="__codelineno-178-4" name="__codelineno-178-4" href="#__codelineno-178-4"></a><span class="w">    </span><span class="nt">date-format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yyyy-MM-dd HH:mm:ss</span>
</span><span id="__span-178-5"><a id="__codelineno-178-5" name="__codelineno-178-5" href="#__codelineno-178-5"></a>
</span><span id="__span-178-6"><a id="__codelineno-178-6" name="__codelineno-178-6" href="#__codelineno-178-6"></a><span class="w">  </span><span class="c1">#æ•°æ®åº“é…ç½®</span>
</span><span id="__span-178-7"><a id="__codelineno-178-7" name="__codelineno-178-7" href="#__codelineno-178-7"></a><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span>
</span><span id="__span-178-8"><a id="__codelineno-178-8" name="__codelineno-178-8" href="#__codelineno-178-8"></a><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-178-9"><a id="__codelineno-178-9" name="__codelineno-178-9" href="#__codelineno-178-9"></a><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-178-10"><a id="__codelineno-178-10" name="__codelineno-178-10" href="#__codelineno-178-10"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jdbc:mysql://localhost:3306/test?characterEncoding=UTF-8&amp;serverTimezone=UTC</span>
</span><span id="__span-178-11"><a id="__codelineno-178-11" name="__codelineno-178-11" href="#__codelineno-178-11"></a><span class="w">    </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">com.mysql.cj.jdbc.Driver</span>
</span></code></pre></div> <blockquote> <p>é«˜ç‰ˆæœ¬çš„ MySQL é©±åŠ¨ï¼ˆå¦‚ mysql-connector-java:8.0.16ï¼‰çš„ <code>driver-class-name</code> å€¼ä¸­é—´å¸¦ <code>cj</code>ã€<code>url</code> å€¼å¿…é¡»å¸¦æ—¶åŒº <code>serverTimezone</code></p> </blockquote> </li> <li> <p><strong>æ•°æ®æºæµ‹è¯•</strong></p> <p>å› ä¸º Spring Boot å·²ç»é…ç½®äº†é»˜è®¤çš„æ•°æ®æº HikariDataSource ï¼Œæ‰€ä»¥æ­¤æ—¶å°±å¯ä»¥æµ‹è¯•ä¸€ä¸‹è·å–æ•°æ®æºï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-179-1"><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-179-2"><a id="__codelineno-179-2" name="__codelineno-179-2" href="#__codelineno-179-2"></a><span class="nd">@SpringBootTest</span>
</span><span id="__span-179-3"><a id="__codelineno-179-3" name="__codelineno-179-3" href="#__codelineno-179-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ThymeleafappApplicationTests</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-179-4"><a id="__codelineno-179-4" name="__codelineno-179-4" href="#__codelineno-179-4"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-179-5"><a id="__codelineno-179-5" name="__codelineno-179-5" href="#__codelineno-179-5"></a><span class="cm">     * Spring Boot é»˜è®¤å·²ç»é…ç½®å¥½äº†æ•°æ®æºï¼Œç¨‹åºå‘˜å¯ä»¥ç›´æ¥ DI æ³¨å…¥ç„¶åä½¿ç”¨å³å¯</span>
</span><span id="__span-179-6"><a id="__codelineno-179-6" name="__codelineno-179-6" href="#__codelineno-179-6"></a><span class="cm">     * æ•°æ®æºè·å–æ­£å¸¸ï¼Œèƒ½æ­£å¸¸æ‹¿åˆ°æ•°æ®åº“è¿æ¥ï¼Œåˆ™è¯´æ˜æ•°æ®åº“è¿æ¥æˆåŠŸ</span>
</span><span id="__span-179-7"><a id="__codelineno-179-7" name="__codelineno-179-7" href="#__codelineno-179-7"></a><span class="cm">     */</span>
</span><span id="__span-179-8"><a id="__codelineno-179-8" name="__codelineno-179-8" href="#__codelineno-179-8"></a><span class="w">    </span><span class="nd">@Resource</span>
</span><span id="__span-179-9"><a id="__codelineno-179-9" name="__codelineno-179-9" href="#__codelineno-179-9"></a><span class="w">    </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">;</span>
</span><span id="__span-179-10"><a id="__codelineno-179-10" name="__codelineno-179-10" href="#__codelineno-179-10"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-179-11"><a id="__codelineno-179-11" name="__codelineno-179-11" href="#__codelineno-179-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">contextLoads</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-179-12"><a id="__codelineno-179-12" name="__codelineno-179-12" href="#__codelineno-179-12"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"æ•°æ®æº&gt;&gt;&gt;&gt;&gt;&gt;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dataSource</span><span class="p">.</span><span class="na">getClass</span><span class="p">());</span>
</span><span id="__span-179-13"><a id="__codelineno-179-13" name="__codelineno-179-13" href="#__codelineno-179-13"></a><span class="w">        </span><span class="n">Connection</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">();</span>
</span><span id="__span-179-14"><a id="__codelineno-179-14" name="__codelineno-179-14" href="#__codelineno-179-14"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¿æ¥&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">connection</span><span class="p">);</span>
</span><span id="__span-179-15"><a id="__codelineno-179-15" name="__codelineno-179-15" href="#__codelineno-179-15"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"è¿æ¥åœ°å€&gt;&gt;&gt;&gt;&gt;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="na">getMetaData</span><span class="p">().</span><span class="na">getURL</span><span class="p">());</span>
</span><span id="__span-179-16"><a id="__codelineno-179-16" name="__codelineno-179-16" href="#__codelineno-179-16"></a><span class="w">        </span><span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</span><span id="__span-179-17"><a id="__codelineno-179-17" name="__codelineno-179-17" href="#__codelineno-179-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-179-18"><a id="__codelineno-179-18" name="__codelineno-179-18" href="#__codelineno-179-18"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p><strong>æ–°å»º POJO</strong></p> <p>åˆ›å»º Person Java Bean å®ä½“æ¥å°è£…æ•°æ®ï¼Œåˆ°æ­¤ç¯å¢ƒå‡†å¤‡å®Œæ¯•ï¼Œä¹‹åå°±ä½¿ç”¨ MyBatis æ“ä½œæ•°æ®åº“å³å¯ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-180-1"><a id="__codelineno-180-1" name="__codelineno-180-1" href="#__codelineno-180-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
</span><span id="__span-180-2"><a id="__codelineno-180-2" name="__codelineno-180-2" href="#__codelineno-180-2"></a><span class="cm">/**</span>
</span><span id="__span-180-3"><a id="__codelineno-180-3" name="__codelineno-180-3" href="#__codelineno-180-3"></a><span class="cm"> * @author wangmaoxiong</span>
</span><span id="__span-180-4"><a id="__codelineno-180-4" name="__codelineno-180-4" href="#__codelineno-180-4"></a><span class="cm"> * @version 1.0</span>
</span><span id="__span-180-5"><a id="__codelineno-180-5" name="__codelineno-180-5" href="#__codelineno-180-5"></a><span class="cm"> * @date 2020/5/9 15:56</span>
</span><span id="__span-180-6"><a id="__codelineno-180-6" name="__codelineno-180-6" href="#__codelineno-180-6"></a><span class="cm"> */</span>
</span><span id="__span-180-7"><a id="__codelineno-180-7" name="__codelineno-180-7" href="#__codelineno-180-7"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Pserson</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-180-8"><a id="__codelineno-180-8" name="__codelineno-180-8" href="#__codelineno-180-8"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">pId</span><span class="p">;</span>
</span><span id="__span-180-9"><a id="__codelineno-180-9" name="__codelineno-180-9" href="#__codelineno-180-9"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">pName</span><span class="p">;</span>
</span><span id="__span-180-10"><a id="__codelineno-180-10" name="__codelineno-180-10" href="#__codelineno-180-10"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">birthday</span><span class="p">;</span>
</span><span id="__span-180-11"><a id="__codelineno-180-11" name="__codelineno-180-11" href="#__codelineno-180-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Float</span><span class="w"> </span><span class="n">salary</span><span class="p">;</span>
</span><span id="__span-180-12"><a id="__codelineno-180-12" name="__codelineno-180-12" href="#__codelineno-180-12"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">summary</span><span class="p">;</span>
</span><span id="__span-180-13"><a id="__codelineno-180-13" name="__codelineno-180-13" href="#__codelineno-180-13"></a>
</span><span id="__span-180-14"><a id="__codelineno-180-14" name="__codelineno-180-14" href="#__codelineno-180-14"></a><span class="w">    </span><span class="c1">//çœç•¥ getterã€settter æ–¹æ³•æœªç²˜è´´</span>
</span><span id="__span-180-15"><a id="__codelineno-180-15" name="__codelineno-180-15" href="#__codelineno-180-15"></a>
</span><span id="__span-180-16"><a id="__codelineno-180-16" name="__codelineno-180-16" href="#__codelineno-180-16"></a><span class="p">}</span>
</span></code></pre></div> </li> </ol> <h3 id="81æ³¨è§£ç‰ˆ">8.1ã€æ³¨è§£ç‰ˆ<a class="headerlink" href="#81æ³¨è§£ç‰ˆ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <ol> <li> <p>æ–°å»º <code>@Mapper</code> æ³¨è§£æ ‡è¯†çš„æ¥å£ï¼Œæ¥å£ä¸­æ–¹æ³•ä¸Šé¢ä½¿ç”¨ <code>@Insert</code>ã€<code>@Delete</code>ã€<code>@Update</code>ã€<code>@Select</code> æ³¨è§£ç¼–å†™æ“ä½œæ•°æ®åº“å¢åˆ æ”¹æŸ¥çš„ SQLï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-181-1"><a id="__codelineno-181-1" name="__codelineno-181-1" href="#__codelineno-181-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.wmx.thymeleafapp.pojo.Person</span><span class="p">;</span>
</span><span id="__span-181-2"><a id="__codelineno-181-2" name="__codelineno-181-2" href="#__codelineno-181-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.*</span><span class="p">;</span>
</span><span id="__span-181-3"><a id="__codelineno-181-3" name="__codelineno-181-3" href="#__codelineno-181-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-181-4"><a id="__codelineno-181-4" name="__codelineno-181-4" href="#__codelineno-181-4"></a>
</span><span id="__span-181-5"><a id="__codelineno-181-5" name="__codelineno-181-5" href="#__codelineno-181-5"></a><span class="cm">/**</span>
</span><span id="__span-181-6"><a id="__codelineno-181-6" name="__codelineno-181-6" href="#__codelineno-181-6"></a><span class="cm"> * @author wangmaoxiong</span>
</span><span id="__span-181-7"><a id="__codelineno-181-7" name="__codelineno-181-7" href="#__codelineno-181-7"></a><span class="cm"> * @version 1.0</span>
</span><span id="__span-181-8"><a id="__codelineno-181-8" name="__codelineno-181-8" href="#__codelineno-181-8"></a><span class="cm"> * @date 2020/5/9 16:02</span>
</span><span id="__span-181-9"><a id="__codelineno-181-9" name="__codelineno-181-9" href="#__codelineno-181-9"></a><span class="cm"> * &lt;/p&gt;</span>
</span><span id="__span-181-10"><a id="__codelineno-181-10" name="__codelineno-181-10" href="#__codelineno-181-10"></a><span class="cm"> * @Mapper æ³¨è§£è¡¨ç¤ºæœ¬ç±»æ˜¯ä¸€ä¸ª MyBatis çš„ Mapperï¼ˆæ˜ å°„ï¼‰.</span>
</span><span id="__span-181-11"><a id="__codelineno-181-11" name="__codelineno-181-11" href="#__codelineno-181-11"></a><span class="cm"> * 1ã€ä»¥å‰ Spring æ•´åˆ mybatis æ—¶ï¼Œä¸€ä¸ª POJO å¯¹åº” MyBatisä¸€ä¸ªæ“ä½œæ•°æ®åº“çš„ xml æ–‡ä»¶ï¼Œ xml æ–‡ä»¶åˆæŒ‡å‘ä¸€ä¸ª mapper æ¥å£.</span>
</span><span id="__span-181-12"><a id="__codelineno-181-12" name="__codelineno-181-12" href="#__codelineno-181-12"></a><span class="cm"> * 2ã€ç°åœ¨ Spring Boot åˆ™çœç•¥äº† xml æ–‡ä»¶è¿™ä¸€ç¯èŠ‚ï¼Œç›´æ¥å°† sql å†™åœ¨äº†æ¥å£ä¸Š.</span>
</span><span id="__span-181-13"><a id="__codelineno-181-13" name="__codelineno-181-13" href="#__codelineno-181-13"></a><span class="cm"> */</span>
</span><span id="__span-181-14"><a id="__codelineno-181-14" name="__codelineno-181-14" href="#__codelineno-181-14"></a><span class="nd">@Mapper</span>
</span><span id="__span-181-15"><a id="__codelineno-181-15" name="__codelineno-181-15" href="#__codelineno-181-15"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">PersonMapper</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-181-16"><a id="__codelineno-181-16" name="__codelineno-181-16" href="#__codelineno-181-16"></a>
</span><span id="__span-181-17"><a id="__codelineno-181-17" name="__codelineno-181-17" href="#__codelineno-181-17"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-181-18"><a id="__codelineno-181-18" name="__codelineno-181-18" href="#__codelineno-181-18"></a><span class="cm">     * æ ¹æ®ç”¨æˆ· id æŸ¥è¯¢</span>
</span><span id="__span-181-19"><a id="__codelineno-181-19" name="__codelineno-181-19" href="#__codelineno-181-19"></a><span class="cm">     *</span>
</span><span id="__span-181-20"><a id="__codelineno-181-20" name="__codelineno-181-20" href="#__codelineno-181-20"></a><span class="cm">     * @param pId</span>
</span><span id="__span-181-21"><a id="__codelineno-181-21" name="__codelineno-181-21" href="#__codelineno-181-21"></a><span class="cm">     * @return :è¿”å›æŸ¥è¯¢ç»“æœ,ä¸å­˜åœ¨æ—¶è¿”å› null</span>
</span><span id="__span-181-22"><a id="__codelineno-181-22" name="__codelineno-181-22" href="#__codelineno-181-22"></a><span class="cm">     * @Select ï¼šç­‰ä»·äºä»¥å‰ xml å½¢å¼æ—¶çš„ &lt;select æ ‡ç­¾,sqlå†™æ³•ä»ç„¶å’Œä»¥å‰ä¸€æ ·</span>
</span><span id="__span-181-23"><a id="__codelineno-181-23" name="__codelineno-181-23" href="#__codelineno-181-23"></a><span class="cm">     */</span>
</span><span id="__span-181-24"><a id="__codelineno-181-24" name="__codelineno-181-24" href="#__codelineno-181-24"></a><span class="w">    </span><span class="nd">@Select</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">"select * from Person where pId=#{pId}"</span><span class="p">})</span>
</span><span id="__span-181-25"><a id="__codelineno-181-25" name="__codelineno-181-25" href="#__codelineno-181-25"></a><span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="nf">findPersonById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">pId</span><span class="p">);</span>
</span><span id="__span-181-26"><a id="__codelineno-181-26" name="__codelineno-181-26" href="#__codelineno-181-26"></a>
</span><span id="__span-181-27"><a id="__codelineno-181-27" name="__codelineno-181-27" href="#__codelineno-181-27"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-181-28"><a id="__codelineno-181-28" name="__codelineno-181-28" href="#__codelineno-181-28"></a><span class="cm">     * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·</span>
</span><span id="__span-181-29"><a id="__codelineno-181-29" name="__codelineno-181-29" href="#__codelineno-181-29"></a><span class="cm">     *</span>
</span><span id="__span-181-30"><a id="__codelineno-181-30" name="__codelineno-181-30" href="#__codelineno-181-30"></a><span class="cm">     * @return :è¿”å›æŸ¥è¯¢ç»“æœ</span>
</span><span id="__span-181-31"><a id="__codelineno-181-31" name="__codelineno-181-31" href="#__codelineno-181-31"></a><span class="cm">     * @Select ï¼šç­‰ä»·äºä»¥å‰ xml å½¢å¼æ—¶çš„ &lt;select æ ‡ç­¾,sqlå†™æ³•ä»ç„¶å’Œä»¥å‰ä¸€æ ·</span>
</span><span id="__span-181-32"><a id="__codelineno-181-32" name="__codelineno-181-32" href="#__codelineno-181-32"></a><span class="cm">     */</span>
</span><span id="__span-181-33"><a id="__codelineno-181-33" name="__codelineno-181-33" href="#__codelineno-181-33"></a><span class="w">    </span><span class="nd">@Select</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">"select * from Person"</span><span class="p">})</span>
</span><span id="__span-181-34"><a id="__codelineno-181-34" name="__codelineno-181-34" href="#__codelineno-181-34"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAllPersons</span><span class="p">();</span>
</span><span id="__span-181-35"><a id="__codelineno-181-35" name="__codelineno-181-35" href="#__codelineno-181-35"></a>
</span><span id="__span-181-36"><a id="__codelineno-181-36" name="__codelineno-181-36" href="#__codelineno-181-36"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-181-37"><a id="__codelineno-181-37" name="__codelineno-181-37" href="#__codelineno-181-37"></a><span class="cm">     * æ·»åŠ ç”¨æˆ·</span>
</span><span id="__span-181-38"><a id="__codelineno-181-38" name="__codelineno-181-38" href="#__codelineno-181-38"></a><span class="cm">     *</span>
</span><span id="__span-181-39"><a id="__codelineno-181-39" name="__codelineno-181-39" href="#__codelineno-181-39"></a><span class="cm">     * @param Person ï¼šå› ä¸ºä¸»é”® pId è‡ªå¢ï¼Œæ‰€ä»¥æ²¡è®¾å€¼</span>
</span><span id="__span-181-40"><a id="__codelineno-181-40" name="__codelineno-181-40" href="#__codelineno-181-40"></a><span class="cm">     * @return</span>
</span><span id="__span-181-41"><a id="__codelineno-181-41" name="__codelineno-181-41" href="#__codelineno-181-41"></a><span class="cm">     */</span>
</span><span id="__span-181-42"><a id="__codelineno-181-42" name="__codelineno-181-42" href="#__codelineno-181-42"></a><span class="w">    </span><span class="nd">@Insert</span><span class="p">(</span><span class="s">"insert into Person(pName,birthday,salary,summary) values(#{pName},#{birthday},#{salary},#{summary})"</span><span class="p">)</span>
</span><span id="__span-181-43"><a id="__codelineno-181-43" name="__codelineno-181-43" href="#__codelineno-181-43"></a><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="nf">addPerson</span><span class="p">(</span><span class="n">Person</span><span class="w"> </span><span class="n">Person</span><span class="p">);</span>
</span><span id="__span-181-44"><a id="__codelineno-181-44" name="__codelineno-181-44" href="#__codelineno-181-44"></a>
</span><span id="__span-181-45"><a id="__codelineno-181-45" name="__codelineno-181-45" href="#__codelineno-181-45"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-181-46"><a id="__codelineno-181-46" name="__codelineno-181-46" href="#__codelineno-181-46"></a><span class="cm">     * æ ¹æ®ç”¨æˆ· pId ä¿®æ”¹ç”¨æˆ·</span>
</span><span id="__span-181-47"><a id="__codelineno-181-47" name="__codelineno-181-47" href="#__codelineno-181-47"></a><span class="cm">     *</span>
</span><span id="__span-181-48"><a id="__codelineno-181-48" name="__codelineno-181-48" href="#__codelineno-181-48"></a><span class="cm">     * @param Person</span>
</span><span id="__span-181-49"><a id="__codelineno-181-49" name="__codelineno-181-49" href="#__codelineno-181-49"></a><span class="cm">     * @return</span>
</span><span id="__span-181-50"><a id="__codelineno-181-50" name="__codelineno-181-50" href="#__codelineno-181-50"></a><span class="cm">     */</span>
</span><span id="__span-181-51"><a id="__codelineno-181-51" name="__codelineno-181-51" href="#__codelineno-181-51"></a><span class="w">    </span><span class="nd">@Update</span><span class="p">(</span><span class="s">"update Person set pName=#{pName},birthday=#{birthday},salary=#{salary},summary=#{summary} where pId=#{pId}"</span><span class="p">)</span>
</span><span id="__span-181-52"><a id="__codelineno-181-52" name="__codelineno-181-52" href="#__codelineno-181-52"></a><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="nf">updatePerson</span><span class="p">(</span><span class="n">Person</span><span class="w"> </span><span class="n">Person</span><span class="p">);</span>
</span><span id="__span-181-53"><a id="__codelineno-181-53" name="__codelineno-181-53" href="#__codelineno-181-53"></a>
</span><span id="__span-181-54"><a id="__codelineno-181-54" name="__codelineno-181-54" href="#__codelineno-181-54"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-181-55"><a id="__codelineno-181-55" name="__codelineno-181-55" href="#__codelineno-181-55"></a><span class="cm">     * æ ¹æ®ç”¨æˆ· id åˆ é™¤ç”¨æˆ·</span>
</span><span id="__span-181-56"><a id="__codelineno-181-56" name="__codelineno-181-56" href="#__codelineno-181-56"></a><span class="cm">     *</span>
</span><span id="__span-181-57"><a id="__codelineno-181-57" name="__codelineno-181-57" href="#__codelineno-181-57"></a><span class="cm">     * @return ï¼šè¿”å›æ“ä½œçš„è¡Œæ•°ï¼Œä¹Ÿå¯ä»¥ä¸è¿”å›</span>
</span><span id="__span-181-58"><a id="__codelineno-181-58" name="__codelineno-181-58" href="#__codelineno-181-58"></a><span class="cm">     */</span>
</span><span id="__span-181-59"><a id="__codelineno-181-59" name="__codelineno-181-59" href="#__codelineno-181-59"></a><span class="w">    </span><span class="nd">@Delete</span><span class="p">(</span><span class="s">"delete from Person where pId = #{pId}"</span><span class="p">)</span>
</span><span id="__span-181-60"><a id="__codelineno-181-60" name="__codelineno-181-60" href="#__codelineno-181-60"></a><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="nf">deletePersonById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">pId</span><span class="p">);</span>
</span><span id="__span-181-61"><a id="__codelineno-181-61" name="__codelineno-181-61" href="#__codelineno-181-61"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p>çœç•¥ä¸šåŠ¡å±‚ï¼Œç›´æ¥ç¼–å†™æ§åˆ¶å±‚è°ƒç”¨ Mapper å±‚æ“ä½œæ•°æ®åº“ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-182-1"><a id="__codelineno-182-1" name="__codelineno-182-1" href="#__codelineno-182-1"></a><span class="nd">@RestController</span>
</span><span id="__span-182-2"><a id="__codelineno-182-2" name="__codelineno-182-2" href="#__codelineno-182-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PersonController</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-182-3"><a id="__codelineno-182-3" name="__codelineno-182-3" href="#__codelineno-182-3"></a>
</span><span id="__span-182-4"><a id="__codelineno-182-4" name="__codelineno-182-4" href="#__codelineno-182-4"></a><span class="w">    </span><span class="nd">@Resource</span>
</span><span id="__span-182-5"><a id="__codelineno-182-5" name="__codelineno-182-5" href="#__codelineno-182-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PersonMapper</span><span class="w"> </span><span class="n">personMapper</span><span class="p">;</span>
</span><span id="__span-182-6"><a id="__codelineno-182-6" name="__codelineno-182-6" href="#__codelineno-182-6"></a>
</span><span id="__span-182-7"><a id="__codelineno-182-7" name="__codelineno-182-7" href="#__codelineno-182-7"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-182-8"><a id="__codelineno-182-8" name="__codelineno-182-8" href="#__codelineno-182-8"></a><span class="cm">     * æ ¹æ®ç”¨æˆ· id æŸ¥è¯¢----ç›´æ¥å°†ç»“æœè¿”å›ç»™ç”¨æˆ·é¡µé¢</span>
</span><span id="__span-182-9"><a id="__codelineno-182-9" name="__codelineno-182-9" href="#__codelineno-182-9"></a><span class="cm">     * http://localhost:8080/person/1</span>
</span><span id="__span-182-10"><a id="__codelineno-182-10" name="__codelineno-182-10" href="#__codelineno-182-10"></a><span class="cm">     *</span>
</span><span id="__span-182-11"><a id="__codelineno-182-11" name="__codelineno-182-11" href="#__codelineno-182-11"></a><span class="cm">     * @param pId</span>
</span><span id="__span-182-12"><a id="__codelineno-182-12" name="__codelineno-182-12" href="#__codelineno-182-12"></a><span class="cm">     * @return</span>
</span><span id="__span-182-13"><a id="__codelineno-182-13" name="__codelineno-182-13" href="#__codelineno-182-13"></a><span class="cm">     */</span>
</span><span id="__span-182-14"><a id="__codelineno-182-14" name="__codelineno-182-14" href="#__codelineno-182-14"></a><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">"/person/{pId}"</span><span class="p">)</span>
</span><span id="__span-182-15"><a id="__codelineno-182-15" name="__codelineno-182-15" href="#__codelineno-182-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="nf">findPersonById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">"pId"</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">pId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-182-16"><a id="__codelineno-182-16" name="__codelineno-182-16" href="#__codelineno-182-16"></a><span class="w">        </span><span class="n">Person</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">personMapper</span><span class="p">.</span><span class="na">findPersonById</span><span class="p">(</span><span class="n">pId</span><span class="p">);</span>
</span><span id="__span-182-17"><a id="__codelineno-182-17" name="__codelineno-182-17" href="#__codelineno-182-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">person</span><span class="p">;</span>
</span><span id="__span-182-18"><a id="__codelineno-182-18" name="__codelineno-182-18" href="#__codelineno-182-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-182-19"><a id="__codelineno-182-19" name="__codelineno-182-19" href="#__codelineno-182-19"></a>
</span><span id="__span-182-20"><a id="__codelineno-182-20" name="__codelineno-182-20" href="#__codelineno-182-20"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-182-21"><a id="__codelineno-182-21" name="__codelineno-182-21" href="#__codelineno-182-21"></a><span class="cm">     * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·----ç›´æ¥å°†ç»“æœè¿”å›ç»™ç”¨æˆ·é¡µé¢</span>
</span><span id="__span-182-22"><a id="__codelineno-182-22" name="__codelineno-182-22" href="#__codelineno-182-22"></a><span class="cm">     * http://localhost:8080/person</span>
</span><span id="__span-182-23"><a id="__codelineno-182-23" name="__codelineno-182-23" href="#__codelineno-182-23"></a><span class="cm">     *</span>
</span><span id="__span-182-24"><a id="__codelineno-182-24" name="__codelineno-182-24" href="#__codelineno-182-24"></a><span class="cm">     * @return</span>
</span><span id="__span-182-25"><a id="__codelineno-182-25" name="__codelineno-182-25" href="#__codelineno-182-25"></a><span class="cm">     */</span>
</span><span id="__span-182-26"><a id="__codelineno-182-26" name="__codelineno-182-26" href="#__codelineno-182-26"></a><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">"/person"</span><span class="p">)</span>
</span><span id="__span-182-27"><a id="__codelineno-182-27" name="__codelineno-182-27" href="#__codelineno-182-27"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAllPersons</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-182-28"><a id="__codelineno-182-28" name="__codelineno-182-28" href="#__codelineno-182-28"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="n">personList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">personMapper</span><span class="p">.</span><span class="na">findAllPersons</span><span class="p">();</span>
</span><span id="__span-182-29"><a id="__codelineno-182-29" name="__codelineno-182-29" href="#__codelineno-182-29"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">personList</span><span class="p">;</span>
</span><span id="__span-182-30"><a id="__codelineno-182-30" name="__codelineno-182-30" href="#__codelineno-182-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-182-31"><a id="__codelineno-182-31" name="__codelineno-182-31" href="#__codelineno-182-31"></a>
</span><span id="__span-182-32"><a id="__codelineno-182-32" name="__codelineno-182-32" href="#__codelineno-182-32"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-182-33"><a id="__codelineno-182-33" name="__codelineno-182-33" href="#__codelineno-182-33"></a><span class="cm">     * æ·»åŠ ç”¨æˆ·ï¼š http://localhost:8080/person/add</span>
</span><span id="__span-182-34"><a id="__codelineno-182-34" name="__codelineno-182-34" href="#__codelineno-182-34"></a><span class="cm">     * {"pName":"å¼ æ— å¿Œ","salary":9999.99,"birthday":"1897-09-09T12:00:11","summary":"æ­¦å­¦å¥‡æ‰"}</span>
</span><span id="__span-182-35"><a id="__codelineno-182-35" name="__codelineno-182-35" href="#__codelineno-182-35"></a><span class="cm">     *</span>
</span><span id="__span-182-36"><a id="__codelineno-182-36" name="__codelineno-182-36" href="#__codelineno-182-36"></a><span class="cm">     * @param person</span>
</span><span id="__span-182-37"><a id="__codelineno-182-37" name="__codelineno-182-37" href="#__codelineno-182-37"></a><span class="cm">     * @return</span>
</span><span id="__span-182-38"><a id="__codelineno-182-38" name="__codelineno-182-38" href="#__codelineno-182-38"></a><span class="cm">     */</span>
</span><span id="__span-182-39"><a id="__codelineno-182-39" name="__codelineno-182-39" href="#__codelineno-182-39"></a><span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">"/person/add"</span><span class="p">)</span>
</span><span id="__span-182-40"><a id="__codelineno-182-40" name="__codelineno-182-40" href="#__codelineno-182-40"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">addPerson</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="n">person</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-182-41"><a id="__codelineno-182-41" name="__codelineno-182-41" href="#__codelineno-182-41"></a><span class="w">        </span><span class="n">Integer</span><span class="w"> </span><span class="n">integer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">personMapper</span><span class="p">.</span><span class="na">addPerson</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
</span><span id="__span-182-42"><a id="__codelineno-182-42" name="__codelineno-182-42" href="#__codelineno-182-42"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">integer</span><span class="p">);</span>
</span><span id="__span-182-43"><a id="__codelineno-182-43" name="__codelineno-182-43" href="#__codelineno-182-43"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-182-44"><a id="__codelineno-182-44" name="__codelineno-182-44" href="#__codelineno-182-44"></a>
</span><span id="__span-182-45"><a id="__codelineno-182-45" name="__codelineno-182-45" href="#__codelineno-182-45"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-182-46"><a id="__codelineno-182-46" name="__codelineno-182-46" href="#__codelineno-182-46"></a><span class="cm">     * ä¿®æ”¹ç”¨æˆ·ï¼šhttp://localhost:8080/person/update</span>
</span><span id="__span-182-47"><a id="__codelineno-182-47" name="__codelineno-182-47" href="#__codelineno-182-47"></a><span class="cm">     * {"pId":1,"pName":"å¼ æ— å¿Œ","salary":9999.99,"birthday":"1897-09-09T12:00:11","summary":"æ­¦å­¦å¥‡æ‰"}</span>
</span><span id="__span-182-48"><a id="__codelineno-182-48" name="__codelineno-182-48" href="#__codelineno-182-48"></a><span class="cm">     *</span>
</span><span id="__span-182-49"><a id="__codelineno-182-49" name="__codelineno-182-49" href="#__codelineno-182-49"></a><span class="cm">     * @param person</span>
</span><span id="__span-182-50"><a id="__codelineno-182-50" name="__codelineno-182-50" href="#__codelineno-182-50"></a><span class="cm">     * @return</span>
</span><span id="__span-182-51"><a id="__codelineno-182-51" name="__codelineno-182-51" href="#__codelineno-182-51"></a><span class="cm">     */</span>
</span><span id="__span-182-52"><a id="__codelineno-182-52" name="__codelineno-182-52" href="#__codelineno-182-52"></a><span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">"/person/update"</span><span class="p">)</span>
</span><span id="__span-182-53"><a id="__codelineno-182-53" name="__codelineno-182-53" href="#__codelineno-182-53"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">updatePerson</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="n">person</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-182-54"><a id="__codelineno-182-54" name="__codelineno-182-54" href="#__codelineno-182-54"></a><span class="w">        </span><span class="n">Integer</span><span class="w"> </span><span class="n">integer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">personMapper</span><span class="p">.</span><span class="na">updatePerson</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
</span><span id="__span-182-55"><a id="__codelineno-182-55" name="__codelineno-182-55" href="#__codelineno-182-55"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">integer</span><span class="p">);</span>
</span><span id="__span-182-56"><a id="__codelineno-182-56" name="__codelineno-182-56" href="#__codelineno-182-56"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-182-57"><a id="__codelineno-182-57" name="__codelineno-182-57" href="#__codelineno-182-57"></a>
</span><span id="__span-182-58"><a id="__codelineno-182-58" name="__codelineno-182-58" href="#__codelineno-182-58"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-182-59"><a id="__codelineno-182-59" name="__codelineno-182-59" href="#__codelineno-182-59"></a><span class="cm">     * åˆ é™¤ç”¨æˆ·:    http://localhost:8080/person/del/2</span>
</span><span id="__span-182-60"><a id="__codelineno-182-60" name="__codelineno-182-60" href="#__codelineno-182-60"></a><span class="cm">     *</span>
</span><span id="__span-182-61"><a id="__codelineno-182-61" name="__codelineno-182-61" href="#__codelineno-182-61"></a><span class="cm">     * @param pId</span>
</span><span id="__span-182-62"><a id="__codelineno-182-62" name="__codelineno-182-62" href="#__codelineno-182-62"></a><span class="cm">     * @return</span>
</span><span id="__span-182-63"><a id="__codelineno-182-63" name="__codelineno-182-63" href="#__codelineno-182-63"></a><span class="cm">     */</span>
</span><span id="__span-182-64"><a id="__codelineno-182-64" name="__codelineno-182-64" href="#__codelineno-182-64"></a><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">"/person/del/{pId}"</span><span class="p">)</span>
</span><span id="__span-182-65"><a id="__codelineno-182-65" name="__codelineno-182-65" href="#__codelineno-182-65"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">deletePerson</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">"pId"</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">pId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-182-66"><a id="__codelineno-182-66" name="__codelineno-182-66" href="#__codelineno-182-66"></a><span class="w">        </span><span class="n">Integer</span><span class="w"> </span><span class="n">integer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">personMapper</span><span class="p">.</span><span class="na">deletePersonById</span><span class="p">(</span><span class="n">pId</span><span class="p">);</span>
</span><span id="__span-182-67"><a id="__codelineno-182-67" name="__codelineno-182-67" href="#__codelineno-182-67"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">integer</span><span class="p">);</span>
</span><span id="__span-182-68"><a id="__codelineno-182-68" name="__codelineno-182-68" href="#__codelineno-182-68"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-182-69"><a id="__codelineno-182-69" name="__codelineno-182-69" href="#__codelineno-182-69"></a><span class="p">}</span>
</span></code></pre></div> </li> </ol> <p><strong>@MapperScan æ‰¹é‡æ‰«æ Mapper</strong></p> <p><code>@Mapper</code> æ³¨è§£ç›´æ¥å†™åœ¨ç›®æ ‡ Mapper æ¥å£ä¸Šï¼Œè¡¨åæœ¬æ¥å£æ˜¯ MyBatis çš„ Mapperã€‚</p> <p><code>@MapperScan</code> æ³¨è§£å¯ä»¥æŒ‡å®šè‡ªåŠ¨æ‰«æå“ªäº›è·¯å¾„ä¸‹çš„æ¥å£ä½œä¸º MyBatis çš„ Mapperï¼Œæ­¤æ—¶æ¥å£ä¸Šå¯ä»¥ä¸éœ€è¦å†å†™ <code>@Mapper</code>ï¼Œå› ä¸ºä¼šè‡ªåŠ¨å¸®å®ƒä»¬åŠ ä¸Šã€‚<code>@MapperScan</code> é€šå¸¸æ”¾åœ¨åº”ç”¨å¯åŠ¨ç±»ä¸Šå³å¯ï¼Œ<em>value</em> æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥æ‰«æå¤šä¸ªè·¯å¾„ã€‚</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-183-1"><a id="__codelineno-183-1" name="__codelineno-183-1" href="#__codelineno-183-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.annotation.MapperScan</span><span class="p">;</span>
</span><span id="__span-183-2"><a id="__codelineno-183-2" name="__codelineno-183-2" href="#__codelineno-183-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
</span><span id="__span-183-3"><a id="__codelineno-183-3" name="__codelineno-183-3" href="#__codelineno-183-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span>
</span><span id="__span-183-4"><a id="__codelineno-183-4" name="__codelineno-183-4" href="#__codelineno-183-4"></a>
</span><span id="__span-183-5"><a id="__codelineno-183-5" name="__codelineno-183-5" href="#__codelineno-183-5"></a><span class="cm">/**</span>
</span><span id="__span-183-6"><a id="__codelineno-183-6" name="__codelineno-183-6" href="#__codelineno-183-6"></a><span class="cm"> * @MapperScan : ä½œç”¨æ˜¯æ‰«ææŸäº›åŒ…ä¸‹é¢æ‰€æœ‰çš„ç±»ä½œä¸º Mapper ç±»</span>
</span><span id="__span-183-7"><a id="__codelineno-183-7" name="__codelineno-183-7" href="#__codelineno-183-7"></a><span class="cm"> * 1)valueæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥æ‰«æå¤šä¸ªè·¯å¾„</span>
</span><span id="__span-183-8"><a id="__codelineno-183-8" name="__codelineno-183-8" href="#__codelineno-183-8"></a><span class="cm"> * 2)è¢«æ‰«æçš„åŒ…(com.lct.wmx.mapper)ä¸­çš„ç±»ï¼ˆæ¥å£ï¼‰ä¸Šå¯ä»¥ä¸ç”¨å†å†™ @Mapperï¼Œå› ä¸ºå…¨éƒ¨ä¼šè‡ªåŠ¨ä¸ºå®ƒä»¬æ·»ä¸Š</span>
</span><span id="__span-183-9"><a id="__codelineno-183-9" name="__codelineno-183-9" href="#__codelineno-183-9"></a><span class="cm"> * 3) @MapperScan çš„ä½ç½®é€šå¸¸æ”¾åœ¨åº”ç”¨å¯åŠ¨ç±»ä¸Š</span>
</span><span id="__span-183-10"><a id="__codelineno-183-10" name="__codelineno-183-10" href="#__codelineno-183-10"></a><span class="cm"> */</span>
</span><span id="__span-183-11"><a id="__codelineno-183-11" name="__codelineno-183-11" href="#__codelineno-183-11"></a><span class="nd">@MapperScan</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">"com.lct.wmx.mapper"</span><span class="p">})</span>
</span><span id="__span-183-12"><a id="__codelineno-183-12" name="__codelineno-183-12" href="#__codelineno-183-12"></a><span class="nd">@SpringBootApplication</span>
</span><span id="__span-183-13"><a id="__codelineno-183-13" name="__codelineno-183-13" href="#__codelineno-183-13"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HippoApplication</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-183-14"><a id="__codelineno-183-14" name="__codelineno-183-14" href="#__codelineno-183-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-183-15"><a id="__codelineno-183-15" name="__codelineno-183-15" href="#__codelineno-183-15"></a><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">HippoApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
</span><span id="__span-183-16"><a id="__codelineno-183-16" name="__codelineno-183-16" href="#__codelineno-183-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-183-17"><a id="__codelineno-183-17" name="__codelineno-183-17" href="#__codelineno-183-17"></a><span class="p">}</span>
</span></code></pre></div> <h3 id="82xml-é…ç½®ç‰ˆ">8.2ã€XML é…ç½®ç‰ˆ<a class="headerlink" href="#82xml-é…ç½®ç‰ˆ" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>é™¤äº†ä½¿ç”¨ <code>@Mapper</code> æ³¨è§£çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ MyBatis xml æ–‡ä»¶é…ç½®çš„æ–¹å¼ã€‚å®é™…å¼€å‘ä¸­å¯ä»¥åŒæ—¶å­˜åœ¨ MyBatis çš„æ³¨è§£æ–¹å¼ä¸é…ç½®æ–¹å¼ï¼Œå¦‚ User å®ä½“å¯ä»¥ä½¿ç”¨æ³¨è§£æ–¹å¼è¿›è¡Œ CRUDï¼ŒParty å®ä½“å¯ä»¥ä½¿ç”¨é…ç½®æ–¹å¼è¿›è¡Œ CRUDã€‚</p> <p>è™½ç„¶ç›´æ¥åœ¨æ¥å£ä¸Šä½¿ç”¨æ³¨è§£æ–¹å¼å†™ SQL çœ‹èµ·æ¥å¾ˆé«˜çº§ï¼Œä½†å®é™…ç”Ÿäº§ä¸­å´æ¨èä½¿ç”¨ xml æ–‡ä»¶é…ç½®çš„æ–¹å¼ï¼Œå› ä¸ºå¯¹äºç»´æŠ¤èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼Œåªéœ€è¦ç›´æ¥ä¿®æ”¹ä¸€ä¸‹ xml æ–‡ä»¶å³å¯ï¼Œè€Œå¦‚æœæ˜¯å†™æ­»åœ¨æºç ä¸­ï¼Œåˆ™è¿˜éœ€è¦é‡æ–°æ‰“åŒ…æˆ–è€…æ›¿æ¢ <code>.class</code> æ–‡ä»¶æ‰è¡Œã€‚</p> <ol> <li> <p>æ–°å»º <code>@Mapper</code> æ³¨è§£æ ‡è¯†çš„æ¥å£ï¼š</p> <div class="language-java highlight"><span class="filename">Java</span><pre><span></span><code><span id="__span-184-1"><a id="__codelineno-184-1" name="__codelineno-184-1" href="#__codelineno-184-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.wmx.thymeleafapp.pojo.Person</span><span class="p">;</span>
</span><span id="__span-184-2"><a id="__codelineno-184-2" name="__codelineno-184-2" href="#__codelineno-184-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.*</span><span class="p">;</span>
</span><span id="__span-184-3"><a id="__codelineno-184-3" name="__codelineno-184-3" href="#__codelineno-184-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-184-4"><a id="__codelineno-184-4" name="__codelineno-184-4" href="#__codelineno-184-4"></a>
</span><span id="__span-184-5"><a id="__codelineno-184-5" name="__codelineno-184-5" href="#__codelineno-184-5"></a><span class="cm">/**</span>
</span><span id="__span-184-6"><a id="__codelineno-184-6" name="__codelineno-184-6" href="#__codelineno-184-6"></a><span class="cm"> * @author wangmaoxiong</span>
</span><span id="__span-184-7"><a id="__codelineno-184-7" name="__codelineno-184-7" href="#__codelineno-184-7"></a><span class="cm"> * @version 1.0</span>
</span><span id="__span-184-8"><a id="__codelineno-184-8" name="__codelineno-184-8" href="#__codelineno-184-8"></a><span class="cm"> * @date 2020/5/9 16:02</span>
</span><span id="__span-184-9"><a id="__codelineno-184-9" name="__codelineno-184-9" href="#__codelineno-184-9"></a><span class="cm"> * &lt;/p&gt;</span>
</span><span id="__span-184-10"><a id="__codelineno-184-10" name="__codelineno-184-10" href="#__codelineno-184-10"></a><span class="cm"> */</span>
</span><span id="__span-184-11"><a id="__codelineno-184-11" name="__codelineno-184-11" href="#__codelineno-184-11"></a><span class="nd">@Mapper</span>
</span><span id="__span-184-12"><a id="__codelineno-184-12" name="__codelineno-184-12" href="#__codelineno-184-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">PersonMapper</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-184-13"><a id="__codelineno-184-13" name="__codelineno-184-13" href="#__codelineno-184-13"></a>
</span><span id="__span-184-14"><a id="__codelineno-184-14" name="__codelineno-184-14" href="#__codelineno-184-14"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-184-15"><a id="__codelineno-184-15" name="__codelineno-184-15" href="#__codelineno-184-15"></a><span class="cm">     * æ ¹æ®ç”¨æˆ· id æŸ¥è¯¢</span>
</span><span id="__span-184-16"><a id="__codelineno-184-16" name="__codelineno-184-16" href="#__codelineno-184-16"></a><span class="cm">     *</span>
</span><span id="__span-184-17"><a id="__codelineno-184-17" name="__codelineno-184-17" href="#__codelineno-184-17"></a><span class="cm">     * @param pId</span>
</span><span id="__span-184-18"><a id="__codelineno-184-18" name="__codelineno-184-18" href="#__codelineno-184-18"></a><span class="cm">     * @return :è¿”å›æŸ¥è¯¢ç»“æœ,ä¸å­˜åœ¨æ—¶è¿”å› null</span>
</span><span id="__span-184-19"><a id="__codelineno-184-19" name="__codelineno-184-19" href="#__codelineno-184-19"></a><span class="cm">     */</span>
</span><span id="__span-184-20"><a id="__codelineno-184-20" name="__codelineno-184-20" href="#__codelineno-184-20"></a><span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="nf">findPersonById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">pId</span><span class="p">);</span>
</span><span id="__span-184-21"><a id="__codelineno-184-21" name="__codelineno-184-21" href="#__codelineno-184-21"></a>
</span><span id="__span-184-22"><a id="__codelineno-184-22" name="__codelineno-184-22" href="#__codelineno-184-22"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-184-23"><a id="__codelineno-184-23" name="__codelineno-184-23" href="#__codelineno-184-23"></a><span class="cm">     * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·</span>
</span><span id="__span-184-24"><a id="__codelineno-184-24" name="__codelineno-184-24" href="#__codelineno-184-24"></a><span class="cm">     *</span>
</span><span id="__span-184-25"><a id="__codelineno-184-25" name="__codelineno-184-25" href="#__codelineno-184-25"></a><span class="cm">     * @return :è¿”å›æŸ¥è¯¢ç»“æœ</span>
</span><span id="__span-184-26"><a id="__codelineno-184-26" name="__codelineno-184-26" href="#__codelineno-184-26"></a><span class="cm">     */</span>
</span><span id="__span-184-27"><a id="__codelineno-184-27" name="__codelineno-184-27" href="#__codelineno-184-27"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAllPersons</span><span class="p">();</span>
</span><span id="__span-184-28"><a id="__codelineno-184-28" name="__codelineno-184-28" href="#__codelineno-184-28"></a>
</span><span id="__span-184-29"><a id="__codelineno-184-29" name="__codelineno-184-29" href="#__codelineno-184-29"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-184-30"><a id="__codelineno-184-30" name="__codelineno-184-30" href="#__codelineno-184-30"></a><span class="cm">     * æ·»åŠ ç”¨æˆ·</span>
</span><span id="__span-184-31"><a id="__codelineno-184-31" name="__codelineno-184-31" href="#__codelineno-184-31"></a><span class="cm">     *</span>
</span><span id="__span-184-32"><a id="__codelineno-184-32" name="__codelineno-184-32" href="#__codelineno-184-32"></a><span class="cm">     * @param Person ï¼šå› ä¸ºä¸»é”® pId è‡ªå¢ï¼Œæ‰€ä»¥æ²¡è®¾å€¼</span>
</span><span id="__span-184-33"><a id="__codelineno-184-33" name="__codelineno-184-33" href="#__codelineno-184-33"></a><span class="cm">     * @return</span>
</span><span id="__span-184-34"><a id="__codelineno-184-34" name="__codelineno-184-34" href="#__codelineno-184-34"></a><span class="cm">     */</span>
</span><span id="__span-184-35"><a id="__codelineno-184-35" name="__codelineno-184-35" href="#__codelineno-184-35"></a><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="nf">addPerson</span><span class="p">(</span><span class="n">Person</span><span class="w"> </span><span class="n">Person</span><span class="p">);</span>
</span><span id="__span-184-36"><a id="__codelineno-184-36" name="__codelineno-184-36" href="#__codelineno-184-36"></a>
</span><span id="__span-184-37"><a id="__codelineno-184-37" name="__codelineno-184-37" href="#__codelineno-184-37"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-184-38"><a id="__codelineno-184-38" name="__codelineno-184-38" href="#__codelineno-184-38"></a><span class="cm">     * æ ¹æ®ç”¨æˆ· pId ä¿®æ”¹ç”¨æˆ·</span>
</span><span id="__span-184-39"><a id="__codelineno-184-39" name="__codelineno-184-39" href="#__codelineno-184-39"></a><span class="cm">     *</span>
</span><span id="__span-184-40"><a id="__codelineno-184-40" name="__codelineno-184-40" href="#__codelineno-184-40"></a><span class="cm">     * @param Person</span>
</span><span id="__span-184-41"><a id="__codelineno-184-41" name="__codelineno-184-41" href="#__codelineno-184-41"></a><span class="cm">     * @return</span>
</span><span id="__span-184-42"><a id="__codelineno-184-42" name="__codelineno-184-42" href="#__codelineno-184-42"></a><span class="cm">     */</span>
</span><span id="__span-184-43"><a id="__codelineno-184-43" name="__codelineno-184-43" href="#__codelineno-184-43"></a><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="nf">updatePerson</span><span class="p">(</span><span class="n">Person</span><span class="w"> </span><span class="n">Person</span><span class="p">);</span>
</span><span id="__span-184-44"><a id="__codelineno-184-44" name="__codelineno-184-44" href="#__codelineno-184-44"></a>
</span><span id="__span-184-45"><a id="__codelineno-184-45" name="__codelineno-184-45" href="#__codelineno-184-45"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-184-46"><a id="__codelineno-184-46" name="__codelineno-184-46" href="#__codelineno-184-46"></a><span class="cm">     * æ ¹æ®ç”¨æˆ· id åˆ é™¤ç”¨æˆ·</span>
</span><span id="__span-184-47"><a id="__codelineno-184-47" name="__codelineno-184-47" href="#__codelineno-184-47"></a><span class="cm">     *</span>
</span><span id="__span-184-48"><a id="__codelineno-184-48" name="__codelineno-184-48" href="#__codelineno-184-48"></a><span class="cm">     * @return ï¼šè¿”å›æ“ä½œçš„è¡Œæ•°ï¼Œä¹Ÿå¯ä»¥ä¸è¿”å›</span>
</span><span id="__span-184-49"><a id="__codelineno-184-49" name="__codelineno-184-49" href="#__codelineno-184-49"></a><span class="cm">     */</span>
</span><span id="__span-184-50"><a id="__codelineno-184-50" name="__codelineno-184-50" href="#__codelineno-184-50"></a><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="nf">deletePersonById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">pId</span><span class="p">);</span>
</span><span id="__span-184-51"><a id="__codelineno-184-51" name="__codelineno-184-51" href="#__codelineno-184-51"></a><span class="p">}</span>
</span></code></pre></div> </li> <li> <p>æä¾› MyBatis æ“ä½œæ•°æ®åº“çš„ Mapper æ¥å£å¯¹åº”çš„ xml æ–‡ä»¶ï¼š</p> <div class="language-xml highlight"><span class="filename">XML</span><pre><span></span><code><span id="__span-185-1"><a id="__codelineno-185-1" name="__codelineno-185-1" href="#__codelineno-185-1"></a><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
</span><span id="__span-185-2"><a id="__codelineno-185-2" name="__codelineno-185-2" href="#__codelineno-185-2"></a><span class="cp">&lt;!DOCTYPE mapper</span>
</span><span id="__span-185-3"><a id="__codelineno-185-3" name="__codelineno-185-3" href="#__codelineno-185-3"></a><span class="cp">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span>
</span><span id="__span-185-4"><a id="__codelineno-185-4" name="__codelineno-185-4" href="#__codelineno-185-4"></a><span class="cp">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>
</span><span id="__span-185-5"><a id="__codelineno-185-5" name="__codelineno-185-5" href="#__codelineno-185-5"></a>
</span><span id="__span-185-6"><a id="__codelineno-185-6" name="__codelineno-185-6" href="#__codelineno-185-6"></a><span class="cm">&lt;!--namespace æŒ‡å‘å¯¹åº”çš„ Mapper æ¥å£ --&gt;</span>
</span><span id="__span-185-7"><a id="__codelineno-185-7" name="__codelineno-185-7" href="#__codelineno-185-7"></a><span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">"com.wmx.thymeleafapp.mapper.PersonMapper"</span><span class="nt">&gt;</span>
</span><span id="__span-185-8"><a id="__codelineno-185-8" name="__codelineno-185-8" href="#__codelineno-185-8"></a><span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"findPersonById"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"com.wmx.thymeleafapp.pojo.Person"</span><span class="nt">&gt;</span>
</span><span id="__span-185-9"><a id="__codelineno-185-9" name="__codelineno-185-9" href="#__codelineno-185-9"></a><span class="w">        </span>select<span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>Person<span class="w"> </span>where<span class="w"> </span>pId<span class="w"> </span>=<span class="w"> </span>#{pId}
</span><span id="__span-185-10"><a id="__codelineno-185-10" name="__codelineno-185-10" href="#__codelineno-185-10"></a><span class="w">    </span><span class="nt">&lt;/select&gt;</span>
</span><span id="__span-185-11"><a id="__codelineno-185-11" name="__codelineno-185-11" href="#__codelineno-185-11"></a>
</span><span id="__span-185-12"><a id="__codelineno-185-12" name="__codelineno-185-12" href="#__codelineno-185-12"></a><span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"findAllPersons"</span><span class="w"> </span><span class="na">resultType=</span><span class="s">"person"</span><span class="nt">&gt;</span>
</span><span id="__span-185-13"><a id="__codelineno-185-13" name="__codelineno-185-13" href="#__codelineno-185-13"></a><span class="w">        </span>select<span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>Person
</span><span id="__span-185-14"><a id="__codelineno-185-14" name="__codelineno-185-14" href="#__codelineno-185-14"></a><span class="w">    </span><span class="nt">&lt;/select&gt;</span>
</span><span id="__span-185-15"><a id="__codelineno-185-15" name="__codelineno-185-15" href="#__codelineno-185-15"></a>
</span><span id="__span-185-16"><a id="__codelineno-185-16" name="__codelineno-185-16" href="#__codelineno-185-16"></a><span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">"addPerson"</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">"person"</span><span class="nt">&gt;</span>
</span><span id="__span-185-17"><a id="__codelineno-185-17" name="__codelineno-185-17" href="#__codelineno-185-17"></a><span class="w">        </span>insert<span class="w"> </span>into<span class="w"> </span>
</span><span id="__span-185-18"><a id="__codelineno-185-18" name="__codelineno-185-18" href="#__codelineno-185-18"></a><span class="w">        </span>Person(pName,birthday,salary,summary)<span class="w"> </span>
</span><span id="__span-185-19"><a id="__codelineno-185-19" name="__codelineno-185-19" href="#__codelineno-185-19"></a><span class="w">        </span>values(#{pName},#{birthday},#{salary},#{summary}
</span><span id="__span-185-20"><a id="__codelineno-185-20" name="__codelineno-185-20" href="#__codelineno-185-20"></a><span class="w">    </span><span class="nt">&lt;/insert&gt;</span>
</span><span id="__span-185-21"><a id="__codelineno-185-21" name="__codelineno-185-21" href="#__codelineno-185-21"></a>
</span><span id="__span-185-22"><a id="__codelineno-185-22" name="__codelineno-185-22" href="#__codelineno-185-22"></a><span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">"updatePerson"</span><span class="nt">&gt;</span>
</span><span id="__span-185-23"><a id="__codelineno-185-23" name="__codelineno-185-23" href="#__codelineno-185-23"></a><span class="w">        </span>update<span class="w"> </span>Person<span class="w"> </span>set<span class="w"> </span>
</span><span id="__span-185-24"><a id="__codelineno-185-24" name="__codelineno-185-24" href="#__codelineno-185-24"></a><span class="w">        </span>pName=#{pName},birthday=#{birthday},salary=#{salary},summary=#{summary}<span class="w"> </span>
</span><span id="__span-185-25"><a id="__codelineno-185-25" name="__codelineno-185-25" href="#__codelineno-185-25"></a><span class="w">        </span>where<span class="w"> </span>pId=#{pId}
</span><span id="__span-185-26"><a id="__codelineno-185-26" name="__codelineno-185-26" href="#__codelineno-185-26"></a><span class="w">    </span><span class="nt">&lt;/update&gt;</span>
</span><span id="__span-185-27"><a id="__codelineno-185-27" name="__codelineno-185-27" href="#__codelineno-185-27"></a>
</span><span id="__span-185-28"><a id="__codelineno-185-28" name="__codelineno-185-28" href="#__codelineno-185-28"></a><span class="w">    </span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">"deletePersonById"</span><span class="nt">&gt;</span>
</span><span id="__span-185-29"><a id="__codelineno-185-29" name="__codelineno-185-29" href="#__codelineno-185-29"></a><span class="w">        </span>delete<span class="w"> </span>from<span class="w"> </span>Person<span class="w"> </span>where<span class="w"> </span>pId<span class="w"> </span>=<span class="w"> </span>#{pId}
</span><span id="__span-185-30"><a id="__codelineno-185-30" name="__codelineno-185-30" href="#__codelineno-185-30"></a><span class="w">    </span><span class="nt">&lt;/delete&gt;</span>
</span><span id="__span-185-31"><a id="__codelineno-185-31" name="__codelineno-185-31" href="#__codelineno-185-31"></a>
</span><span id="__span-185-32"><a id="__codelineno-185-32" name="__codelineno-185-32" href="#__codelineno-185-32"></a><span class="nt">&lt;/mapper&gt;</span>
</span></code></pre></div> </li> <li> <p>Spring Boot å…¨å±€é…ç½®æ–‡ä»¶æŒ‡å®š mybatis é…ç½®æ–‡ä»¶è·¯å¾„ï¼š</p> <div class="language-yaml highlight"><span class="filename">YAML</span><pre><span></span><code><span id="__span-186-1"><a id="__codelineno-186-1" name="__codelineno-186-1" href="#__codelineno-186-1"></a><span class="c1">#æŒ‡å®š myBatis æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸ Mapper æ˜ å°„ xml æ–‡ä»¶</span>
</span><span id="__span-186-2"><a id="__codelineno-186-2" name="__codelineno-186-2" href="#__codelineno-186-2"></a><span class="nt">mybatis</span><span class="p">:</span>
</span><span id="__span-186-3"><a id="__codelineno-186-3" name="__codelineno-186-3" href="#__codelineno-186-3"></a><span class="w">  </span><span class="nt">config-location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">classpath:mybatis/mybatis-config.xml</span>
</span><span id="__span-186-4"><a id="__codelineno-186-4" name="__codelineno-186-4" href="#__codelineno-186-4"></a><span class="w">  </span><span class="nt">mapper-locations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">classpath:mybatis/mapper/*.xml</span>
</span></code></pre></div> </li> <li> <p>ä½¿ç”¨æ³¨è§£ç‰ˆå†™çš„æ§åˆ¶å±‚æµ‹è¯•ã€‚</p> </li> </ol> <h2 id="9å¼‚å¸¸">9ã€å¼‚å¸¸<a class="headerlink" href="#9å¼‚å¸¸" title="é”šç‚¹é“¾æ¥">Â¶</a></h2> <p>è¿™é‡Œåˆ—å‡ºä¸€äº›å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„å¼‚å¸¸ä»¥åŠè§£å†³åŠæ³•ã€‚</p> <h3 id="91netsfjsqlparserparserparseexception">9.1ã€net.sf.jsqlparser.parser.ParseException<a class="headerlink" href="#91netsfjsqlparserparserparseexception" title="é”šç‚¹é“¾æ¥">Â¶</a></h3> <p>è¿è¡Œ Mybatis æŸ¥è¯¢ SQL æ—¶æŠ¥é”™å¼‚å¸¸ï¼š</p> <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-187-1"><a id="__codelineno-187-1" name="__codelineno-187-1" href="#__codelineno-187-1"></a>Caused by: net.sf.jsqlparser.parser.ParseException: Encountered " "(" "( "" at line 10, column 42.
</span><span id="__span-187-2"><a id="__codelineno-187-2" name="__codelineno-187-2" href="#__codelineno-187-2"></a>Was expecting one of:
</span><span id="__span-187-3"><a id="__codelineno-187-3" name="__codelineno-187-3" href="#__codelineno-187-3"></a>    "AS" ...
</span><span id="__span-187-4"><a id="__codelineno-187-4" name="__codelineno-187-4" href="#__codelineno-187-4"></a>    "DO" ...
</span><span id="__span-187-5"><a id="__codelineno-187-5" name="__codelineno-187-5" href="#__codelineno-187-5"></a>    "ANY" ...
</span><span id="__span-187-6"><a id="__codelineno-187-6" name="__codelineno-187-6" href="#__codelineno-187-6"></a>    "KEY" ...
</span><span id="__span-187-7"><a id="__codelineno-187-7" name="__codelineno-187-7" href="#__codelineno-187-7"></a>    "PERCENT" ...
</span><span id="__span-187-8"><a id="__codelineno-187-8" name="__codelineno-187-8" href="#__codelineno-187-8"></a>    "END" ...
</span><span id="__span-187-9"><a id="__codelineno-187-9" name="__codelineno-187-9" href="#__codelineno-187-9"></a>    "INTO" ...
</span><span id="__span-187-10"><a id="__codelineno-187-10" name="__codelineno-187-10" href="#__codelineno-187-10"></a>    "FROM" ...
</span><span id="__span-187-11"><a id="__codelineno-187-11" name="__codelineno-187-11" href="#__codelineno-187-11"></a>    "OPEN" ...
</span><span id="__span-187-12"><a id="__codelineno-187-12" name="__codelineno-187-12" href="#__codelineno-187-12"></a>    "TABLE" ...
</span><span id="__span-187-13"><a id="__codelineno-187-13" name="__codelineno-187-13" href="#__codelineno-187-13"></a>    "WHERE" ...
</span><span id="__span-187-14"><a id="__codelineno-187-14" name="__codelineno-187-14" href="#__codelineno-187-14"></a>    "FOR" ...
</span><span id="__span-187-15"><a id="__codelineno-187-15" name="__codelineno-187-15" href="#__codelineno-187-15"></a>    "XML" ...
</span><span id="__span-187-16"><a id="__codelineno-187-16" name="__codelineno-187-16" href="#__codelineno-187-16"></a>    "UNION" ...
</span><span id="__span-187-17"><a id="__codelineno-187-17" name="__codelineno-187-17" href="#__codelineno-187-17"></a>    "GROUP" ...
</span><span id="__span-187-18"><a id="__codelineno-187-18" name="__codelineno-187-18" href="#__codelineno-187-18"></a>    "ORDER" ...
</span><span id="__span-187-19"><a id="__codelineno-187-19" name="__codelineno-187-19" href="#__codelineno-187-19"></a>    "VALUE" ...
</span><span id="__span-187-20"><a id="__codelineno-187-20" name="__codelineno-187-20" href="#__codelineno-187-20"></a>    "HAVING" ...
</span><span id="__span-187-21"><a id="__codelineno-187-21" name="__codelineno-187-21" href="#__codelineno-187-21"></a>    "INSERT" ...
</span><span id="__span-187-22"><a id="__codelineno-187-22" name="__codelineno-187-22" href="#__codelineno-187-22"></a>    "VALUES" ...
</span><span id="__span-187-23"><a id="__codelineno-187-23" name="__codelineno-187-23" href="#__codelineno-187-23"></a>    "REPLACE" ...
</span><span id="__span-187-24"><a id="__codelineno-187-24" name="__codelineno-187-24" href="#__codelineno-187-24"></a>    "TRUNCATE" ...
</span><span id="__span-187-25"><a id="__codelineno-187-25" name="__codelineno-187-25" href="#__codelineno-187-25"></a>    "INTERSECT" ...
</span><span id="__span-187-26"><a id="__codelineno-187-26" name="__codelineno-187-26" href="#__codelineno-187-26"></a>    "CAST" ...
</span><span id="__span-187-27"><a id="__codelineno-187-27" name="__codelineno-187-27" href="#__codelineno-187-27"></a>    "EXCEPT" ...
</span><span id="__span-187-28"><a id="__codelineno-187-28" name="__codelineno-187-28" href="#__codelineno-187-28"></a>    "MINUS" ...
</span><span id="__span-187-29"><a id="__codelineno-187-29" name="__codelineno-187-29" href="#__codelineno-187-29"></a>    "OVER" ...
</span><span id="__span-187-30"><a id="__codelineno-187-30" name="__codelineno-187-30" href="#__codelineno-187-30"></a>    "PARTITION" ...
</span><span id="__span-187-31"><a id="__codelineno-187-31" name="__codelineno-187-31" href="#__codelineno-187-31"></a>    "EXTRACT" ...
</span><span id="__span-187-32"><a id="__codelineno-187-32" name="__codelineno-187-32" href="#__codelineno-187-32"></a>    "MATERIALIZED" ...
</span><span id="__span-187-33"><a id="__codelineno-187-33" name="__codelineno-187-33" href="#__codelineno-187-33"></a>    "START" ...
</span><span id="__span-187-34"><a id="__codelineno-187-34" name="__codelineno-187-34" href="#__codelineno-187-34"></a>    "CONNECT" ...
</span><span id="__span-187-35"><a id="__codelineno-187-35" name="__codelineno-187-35" href="#__codelineno-187-35"></a>    "PRIOR" ...
</span><span id="__span-187-36"><a id="__codelineno-187-36" name="__codelineno-187-36" href="#__codelineno-187-36"></a>    "SIBLINGS" ...
</span><span id="__span-187-37"><a id="__codelineno-187-37" name="__codelineno-187-37" href="#__codelineno-187-37"></a>    "COLUMN" ...
</span><span id="__span-187-38"><a id="__codelineno-187-38" name="__codelineno-187-38" href="#__codelineno-187-38"></a>    "NULLS" ...
</span><span id="__span-187-39"><a id="__codelineno-187-39" name="__codelineno-187-39" href="#__codelineno-187-39"></a>    "FIRST" ...
</span><span id="__span-187-40"><a id="__codelineno-187-40" name="__codelineno-187-40" href="#__codelineno-187-40"></a>    "LAST" ...
</span><span id="__span-187-41"><a id="__codelineno-187-41" name="__codelineno-187-41" href="#__codelineno-187-41"></a>    "ROWS" ...
</span><span id="__span-187-42"><a id="__codelineno-187-42" name="__codelineno-187-42" href="#__codelineno-187-42"></a>    "RANGE" ...
</span><span id="__span-187-43"><a id="__codelineno-187-43" name="__codelineno-187-43" href="#__codelineno-187-43"></a>    "FOLLOWING" ...
</span><span id="__span-187-44"><a id="__codelineno-187-44" name="__codelineno-187-44" href="#__codelineno-187-44"></a>    "ROW" ...
</span><span id="__span-187-45"><a id="__codelineno-187-45" name="__codelineno-187-45" href="#__codelineno-187-45"></a>    "COMMIT" ...
</span><span id="__span-187-46"><a id="__codelineno-187-46" name="__codelineno-187-46" href="#__codelineno-187-46"></a>    "SEPARATOR" ...
</span><span id="__span-187-47"><a id="__codelineno-187-47" name="__codelineno-187-47" href="#__codelineno-187-47"></a>    "CASCADE" ...
</span><span id="__span-187-48"><a id="__codelineno-187-48" name="__codelineno-187-48" href="#__codelineno-187-48"></a>    "NO" ...
</span><span id="__span-187-49"><a id="__codelineno-187-49" name="__codelineno-187-49" href="#__codelineno-187-49"></a>    "ACTION" ...
</span><span id="__span-187-50"><a id="__codelineno-187-50" name="__codelineno-187-50" href="#__codelineno-187-50"></a>    &lt;K_DATETIMELITERAL&gt; ...
</span><span id="__span-187-51"><a id="__codelineno-187-51" name="__codelineno-187-51" href="#__codelineno-187-51"></a>    "PRECISION" ...
</span><span id="__span-187-52"><a id="__codelineno-187-52" name="__codelineno-187-52" href="#__codelineno-187-52"></a>    &lt;S_IDENTIFIER&gt; ...
</span><span id="__span-187-53"><a id="__codelineno-187-53" name="__codelineno-187-53" href="#__codelineno-187-53"></a>    &lt;S_QUOTED_IDENTIFIER&gt; ...
</span><span id="__span-187-54"><a id="__codelineno-187-54" name="__codelineno-187-54" href="#__codelineno-187-54"></a>    "," ...
</span><span id="__span-187-55"><a id="__codelineno-187-55" name="__codelineno-187-55" href="#__codelineno-187-55"></a>    ")" ...
</span><span id="__span-187-56"><a id="__codelineno-187-56" name="__codelineno-187-56" href="#__codelineno-187-56"></a>    "|" ...
</span><span id="__span-187-57"><a id="__codelineno-187-57" name="__codelineno-187-57" href="#__codelineno-187-57"></a>    "&amp;" ...
</span><span id="__span-187-58"><a id="__codelineno-187-58" name="__codelineno-187-58" href="#__codelineno-187-58"></a>    "^" ...
</span><span id="__span-187-59"><a id="__codelineno-187-59" name="__codelineno-187-59" href="#__codelineno-187-59"></a>    "::" ...
</span><span id="__span-187-60"><a id="__codelineno-187-60" name="__codelineno-187-60" href="#__codelineno-187-60"></a>    "ORDER" ...
</span><span id="__span-187-61"><a id="__codelineno-187-61" name="__codelineno-187-61" href="#__codelineno-187-61"></a>    "ORDER" ...
</span><span id="__span-187-62"><a id="__codelineno-187-62" name="__codelineno-187-62" href="#__codelineno-187-62"></a>
</span><span id="__span-187-63"><a id="__codelineno-187-63" name="__codelineno-187-63" href="#__codelineno-187-63"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.generateParseException(CCJSqlParser.java:16395)
</span><span id="__span-187-64"><a id="__codelineno-187-64" name="__codelineno-187-64" href="#__codelineno-187-64"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.jj_consume_token(CCJSqlParser.java:16248)
</span><span id="__span-187-65"><a id="__codelineno-187-65" name="__codelineno-187-65" href="#__codelineno-187-65"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.PrimaryExpression(CCJSqlParser.java:6333)
</span><span id="__span-187-66"><a id="__codelineno-187-66" name="__codelineno-187-66" href="#__codelineno-187-66"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.BitwiseXor(CCJSqlParser.java:5926)
</span><span id="__span-187-67"><a id="__codelineno-187-67" name="__codelineno-187-67" href="#__codelineno-187-67"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.MultiplicativeExpression(CCJSqlParser.java:5883)
</span><span id="__span-187-68"><a id="__codelineno-187-68" name="__codelineno-187-68" href="#__codelineno-187-68"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.AdditiveExpression(CCJSqlParser.java:5845)
</span><span id="__span-187-69"><a id="__codelineno-187-69" name="__codelineno-187-69" href="#__codelineno-187-69"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.ConcatExpression(CCJSqlParser.java:5778)
</span><span id="__span-187-70"><a id="__codelineno-187-70" name="__codelineno-187-70" href="#__codelineno-187-70"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.BitwiseAndOr(CCJSqlParser.java:5802)
</span><span id="__span-187-71"><a id="__codelineno-187-71" name="__codelineno-187-71" href="#__codelineno-187-71"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.SimpleExpression(CCJSqlParser.java:5770)
</span><span id="__span-187-72"><a id="__codelineno-187-72" name="__codelineno-187-72" href="#__codelineno-187-72"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.CaseWhenExpression(CCJSqlParser.java:7275)
</span><span id="__span-187-73"><a id="__codelineno-187-73" name="__codelineno-187-73" href="#__codelineno-187-73"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.PrimaryExpression(CCJSqlParser.java:5964)
</span><span id="__span-187-74"><a id="__codelineno-187-74" name="__codelineno-187-74" href="#__codelineno-187-74"></a>    at net.sf.jsqlparser.parser.CCJSqlParser.BitwiseXor(CCJSqlParser.java:5926)
</span></code></pre></div> <p>æŸ¥è¯¢ SQLï¼š</p> <div class="language-sql highlight"><span class="filename">SQL</span><pre><span></span><code><span id="__span-188-1"><a id="__codelineno-188-1" name="__codelineno-188-1" href="#__codelineno-188-1"></a><span class="k">SELECT</span>
</span><span id="__span-188-2"><a id="__codelineno-188-2" name="__codelineno-188-2" href="#__codelineno-188-2"></a><span class="w">    </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">CONCAT</span><span class="p">(</span>
</span><span id="__span-188-3"><a id="__codelineno-188-3" name="__codelineno-188-3" href="#__codelineno-188-3"></a><span class="w">        </span><span class="n">IFNULL</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">ZH_NAME</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">),</span>
</span><span id="__span-188-4"><a id="__codelineno-188-4" name="__codelineno-188-4" href="#__codelineno-188-4"></a><span class="w">        </span><span class="k">IF</span><span class="p">(</span>
</span><span id="__span-188-5"><a id="__codelineno-188-5" name="__codelineno-188-5" href="#__codelineno-188-5"></a><span class="w">            </span><span class="k">LENGTH</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">US_NAME</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-188-6"><a id="__codelineno-188-6" name="__codelineno-188-6" href="#__codelineno-188-6"></a><span class="w">            </span><span class="k">AND</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">ZH_NAME</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-188-7"><a id="__codelineno-188-7" name="__codelineno-188-7" href="#__codelineno-188-7"></a><span class="w">            </span><span class="s1">'/'</span><span class="p">,</span>
</span><span id="__span-188-8"><a id="__codelineno-188-8" name="__codelineno-188-8" href="#__codelineno-188-8"></a><span class="w">            </span><span class="s1">''</span>
</span><span id="__span-188-9"><a id="__codelineno-188-9" name="__codelineno-188-9" href="#__codelineno-188-9"></a><span class="w">        </span><span class="p">),</span>
</span><span id="__span-188-10"><a id="__codelineno-188-10" name="__codelineno-188-10" href="#__codelineno-188-10"></a><span class="w">        </span><span class="n">IFNULL</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">US_NAME</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span>
</span><span id="__span-188-11"><a id="__codelineno-188-11" name="__codelineno-188-11" href="#__codelineno-188-11"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-188-12"><a id="__codelineno-188-12" name="__codelineno-188-12" href="#__codelineno-188-12"></a><span class="k">FROM</span>
</span><span id="__span-188-13"><a id="__codelineno-188-13" name="__codelineno-188-13" href="#__codelineno-188-13"></a><span class="w">    </span><span class="k">TABLE</span><span class="w"> </span><span class="k">c</span>
</span></code></pre></div> <p>æŠ¥é”™åŸå› ï¼šæ˜¯å› ä¸º Mybatis çš„åˆ†é¡µæ’ä»¶ SQL è¯­å¥ä¸­å¯¹ <code>IF</code> å‡½æ•°ä¸æ”¯æŒã€‚</p> <p><strong>è§£å†³æ–¹æ³•</strong></p> <p>å°† <code>IF</code> æ›¿æ¢æˆ <code>CASE WHEN</code> ä½¿ç”¨ã€‚</p> <aside class="md-source-file"> <span class="md-source-file__fact"> <span class="md-icon" title="æœ€åæ›´æ–°"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2026å¹´1æœˆ22æ—¥ 20:21:58 UTC">2026å¹´1æœˆ22æ—¥ 20:21:58</span> </span> <span class="md-source-file__fact"> <span class="md-icon" title="åˆ›å»ºæ—¥æœŸ"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2021å¹´4æœˆ26æ—¥ 11:39:30 UTC">2021å¹´4æœˆ26æ—¥ 11:39:30</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type="button" class="md-top md-icon" data-md-component="top" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> å›åˆ°é¡µé¢é¡¶éƒ¨ </button> </main> <footer class="md-footer"> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> Made with <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.top", "navigation.tracking", "navigation.instant", "navigation.path", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src="../assets/javascripts/bundle.79ae519e.min.js"></script> <script src="../_javascripts/auto_title.js"></script>  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>