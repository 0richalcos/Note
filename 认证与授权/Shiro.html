
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://0richalcos.github.io/Note/%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/Shiro.html">
      
      
        <link rel="prev" href="Sa-Token.html">
      
      
        <link rel="next" href="../%E5%89%8D%E7%AB%AF/CSS.html">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Shiro - Èöè‰æøËÆ∞ËÆ∞</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../_stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1" class="md-skip">
          Ë∑≥ËΩ¨Ëá≥
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="È°µÁúâ">
    <a href="../index.html" title="Èöè‰æøËÆ∞ËÆ∞" class="md-header__button md-logo" aria-label="Èöè‰æøËÆ∞ËÆ∞" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Èöè‰æøËÆ∞ËÆ∞
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Shiro
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="ÂàáÊç¢Ê∑±Ëâ≤Ê®°Âºè"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="ÂàáÊç¢Ê∑±Ëâ≤Ê®°Âºè" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="ÂàáÊç¢‰∫ÆËâ≤Ê®°Âºè"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="ÂàáÊç¢‰∫ÆËâ≤Ê®°Âºè" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="ÊêúÁ¥¢" placeholder="ÊêúÁ¥¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Êü•Êâæ">
        
        <button type="reset" class="md-search__icon md-icon" title="Ê∏ÖÁ©∫ÂΩìÂâçÂÜÖÂÆπ" aria-label="Ê∏ÖÁ©∫ÂΩìÂâçÂÜÖÂÆπ" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Ê≠£Âú®ÂàùÂßãÂåñÊêúÁ¥¢ÂºïÊìé
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/0richalcos/Note" title="ÂâçÂæÄ‰ªìÂ∫ì" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="ÂØºËà™Ê†è" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Èöè‰æøËÆ∞ËÆ∞" class="md-nav__button md-logo" aria-label="Èöè‰æøËÆ∞ËÆ∞" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Èöè‰æøËÆ∞ËÆ∞
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/0richalcos/Note" title="ÂâçÂæÄ‰ªìÂ∫ì" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üè† È¶ñÈ°µ
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ‚ô®Ô∏è Java
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    ‚ô®Ô∏è Java
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/Java.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/Java8.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java 8
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/JavaBasics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java Âü∫Á°Ä
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/JavaCollection.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java ÈõÜÂêà
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/JavaObject.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java Á±ªÂíåÂØπË±°
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/JavaWeb.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JavaWeb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/%E6%B5%8B%E8%AF%95%E5%BA%8F%E5%8F%B7.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ÊµãËØïÂ∫èÂè∑
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üßÆ Êï∞ÊçÆÁªìÊûÑÂèäÁÆóÊ≥ï
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    üßÆ Êï∞ÊçÆÁªìÊûÑÂèäÁÆóÊ≥ï
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E7%AE%97%E6%B3%95/Algorithm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Algorithm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E7%AE%97%E6%B3%95/DesignPattern.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DesignPattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üçÉ Spring
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    üçÉ Spring
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring/Spring.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring/SpringBoot.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SpringBoot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring/SpringCloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SpringCloud
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring/SpringMVC.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SpringMVC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üíæ ÊåÅ‰πÖÂ±ÇÊ°ÜÊû∂
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    üíæ ÊåÅ‰πÖÂ±ÇÊ°ÜÊû∂
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/MyBatis-Plus.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MyBatis-Plus
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/Mybatis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mybatis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üîê ËÆ§ËØÅ‰∏éÊéàÊùÉ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    üîê ËÆ§ËØÅ‰∏éÊéàÊùÉ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="SSO.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Sa-Token.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sa-Token
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Shiro
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="Shiro.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Shiro
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="ÁõÆÂΩï">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ÁõÆÂΩï
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1„ÄÅÊùÉÈôêÁöÑÁÆ°ÁêÜ
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-shiro" class="md-nav__link">
    <span class="md-ellipsis">
      
        2„ÄÅ‰ªÄ‰πàÊòØ Shiro
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3shiro" class="md-nav__link">
    <span class="md-ellipsis">
      
        3„ÄÅShiro ÁöÑÊ†∏ÂøÉÊû∂ÊûÑ
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4shiro" class="md-nav__link">
    <span class="md-ellipsis">
      
        4„ÄÅShiro ‰∏≠ÁöÑËÆ§ËØÅ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4„ÄÅShiro ‰∏≠ÁöÑËÆ§ËØÅ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1„ÄÅËÆ§ËØÅÁöÑÂºÄÂèë
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-realm" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2„ÄÅËá™ÂÆö‰πâ Realm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-md5-salt" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3„ÄÅ‰ΩøÁî® MD5 + salt
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5shiro" class="md-nav__link">
    <span class="md-ellipsis">
      
        5„ÄÅShiro ‰∏≠ÁöÑÊéàÊùÉ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5„ÄÅShiro ‰∏≠ÁöÑÊéàÊùÉ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1„ÄÅÊùÉÈôêÂ≠óÁ¨¶‰∏≤
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2„ÄÅÂºÄÂèëÊéàÊùÉ
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      
        6„ÄÅÈ°πÁõÆÂÆûÊàò
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6„ÄÅÈ°πÁõÆÂÆûÊàò">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-shiro" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1„ÄÅÈÖçÁΩÆ Shiro ÁéØÂ¢É
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2„ÄÅÂ∏∏ËßÅËøáÊª§Âô®
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3„ÄÅÂÆûÁé∞ÁÆÄÂçïËÆ§ËØÅ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64md5salt" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4„ÄÅÊï∞ÊçÆÂ∫ì+MD5+Salt
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.5„ÄÅÊï∞ÊçÆÂ∫ì‰ø°ÊÅØËÆ§ËØÅ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.6„ÄÅÊï∞ÊçÆÂ∫ì‰ø°ÊÅØÊéàÊùÉ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#67-ehcache" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.7„ÄÅ‰ΩøÁî® EhCache ÁºìÂ≠ò
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#68-redis" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.8„ÄÅ‰ΩøÁî® Redis ÁºìÂ≠ò
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-thymeleaf" class="md-nav__link">
    <span class="md-ellipsis">
      
        7„ÄÅ‰ΩøÁî® Thymeleaf
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üåê ÂâçÁ´Ø
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    üåê ÂâçÁ´Ø
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/CSS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CSS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/JavaScript.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JavaScript
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/Vue.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/jQuery.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    jQuery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/Thymeleaf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thymeleaf
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ÁªÑ‰ª∂Â∫ì
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    ÁªÑ‰ª∂Â∫ì
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/AntV-X6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AntV-X6
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/ApacheECharts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ApacheECharts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/Axios.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Axios
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/BootstrapTable.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BootstrapTable
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/DHTMLXGantt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DHTMLXGantt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/Element.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Element
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/FullCalendar.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FullCalendar
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%89%8D%E7%AB%AF/%E7%BB%84%E4%BB%B6%E5%BA%93/X-editable.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    X-editable
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üìä Êï∞ÊçÆÂ∫ì
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    üìä Êï∞ÊçÆÂ∫ì
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Dameng.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dameng
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MySQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/MySQLQuery.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MySQLQuery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/OceanBase.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OceanBase
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Oracle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/Vastbase.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vastbase
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/Elasticsearch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elasticsearch
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üìá ÂàÜÂ∏ÉÂºèÂ≠òÂÇ®
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    üìá ÂàÜÂ∏ÉÂºèÂ≠òÂÇ®
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/FastDFS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FastDFS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/MinIO.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MinIO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üõ∞Ô∏è ÁΩëÁªúÈÄö‰ø°
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    üõ∞Ô∏è ÁΩëÁªúÈÄö‰ø°
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/Encryption.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Encryption
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/HTTP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HTTP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/OpenVPN.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OpenVPN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/VNC.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VNC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/WebSocket.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WebSocket
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/frp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    frp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üóÉÔ∏è Êñá‰ª∂Â§ÑÁêÜ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    üóÉÔ∏è Êñá‰ª∂Â§ÑÁêÜ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_1" >
        
          
          <label class="md-nav__link" for="__nav_12_1" id="__nav_12_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Office
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Office
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/ApachePOI.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ApachePOI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/EasyExcel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EasyExcel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/OnlyOffice.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OnlyOffice
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/Poi-tl.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Poi-tl
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/Office/Spire.OfficeForJava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spire.OfficeForJava
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/PDF/ApachePDFBox.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ApachePDFBox
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/XML/XMLParse.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    XMLParse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/ZIP/Zip4j.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Zip4j
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/XXL-JOB.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    XXL-JOB
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üßë‚Äçüîß ËøêÁª¥
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    üßë‚Äçüîß ËøêÁª¥
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/Docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/Linux.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/NSSM.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NSSM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/Nginx.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nginx
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/Tomcat.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tomcat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/TongWeb.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TongWeb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/WSL.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WSL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%BF%90%E7%BB%B4/WebLogic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WebLogic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üõ†Ô∏è ÂºÄÂèëÂ∑•ÂÖ∑
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    üõ†Ô∏è ÂºÄÂèëÂ∑•ÂÖ∑
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Git.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Git
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Maven.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Maven
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Node.js.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Node.js
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Swagger.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Swagger
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üëª ÂÖ∂‰ªñ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    üëª ÂÖ∂‰ªñ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%85%B6%E4%BB%96/Settings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Settings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%85%B6%E4%BB%96/Solutions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Solutions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%85%B6%E4%BB%96/Weasel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weasel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="ÁõÆÂΩï">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ÁõÆÂΩï
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1„ÄÅÊùÉÈôêÁöÑÁÆ°ÁêÜ
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-shiro" class="md-nav__link">
    <span class="md-ellipsis">
      
        2„ÄÅ‰ªÄ‰πàÊòØ Shiro
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3shiro" class="md-nav__link">
    <span class="md-ellipsis">
      
        3„ÄÅShiro ÁöÑÊ†∏ÂøÉÊû∂ÊûÑ
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4shiro" class="md-nav__link">
    <span class="md-ellipsis">
      
        4„ÄÅShiro ‰∏≠ÁöÑËÆ§ËØÅ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4„ÄÅShiro ‰∏≠ÁöÑËÆ§ËØÅ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1„ÄÅËÆ§ËØÅÁöÑÂºÄÂèë
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-realm" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2„ÄÅËá™ÂÆö‰πâ Realm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-md5-salt" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3„ÄÅ‰ΩøÁî® MD5 + salt
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5shiro" class="md-nav__link">
    <span class="md-ellipsis">
      
        5„ÄÅShiro ‰∏≠ÁöÑÊéàÊùÉ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5„ÄÅShiro ‰∏≠ÁöÑÊéàÊùÉ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1„ÄÅÊùÉÈôêÂ≠óÁ¨¶‰∏≤
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2„ÄÅÂºÄÂèëÊéàÊùÉ
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      
        6„ÄÅÈ°πÁõÆÂÆûÊàò
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6„ÄÅÈ°πÁõÆÂÆûÊàò">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-shiro" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1„ÄÅÈÖçÁΩÆ Shiro ÁéØÂ¢É
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2„ÄÅÂ∏∏ËßÅËøáÊª§Âô®
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3„ÄÅÂÆûÁé∞ÁÆÄÂçïËÆ§ËØÅ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64md5salt" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4„ÄÅÊï∞ÊçÆÂ∫ì+MD5+Salt
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.5„ÄÅÊï∞ÊçÆÂ∫ì‰ø°ÊÅØËÆ§ËØÅ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.6„ÄÅÊï∞ÊçÆÂ∫ì‰ø°ÊÅØÊéàÊùÉ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#67-ehcache" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.7„ÄÅ‰ΩøÁî® EhCache ÁºìÂ≠ò
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#68-redis" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.8„ÄÅ‰ΩøÁî® Redis ÁºìÂ≠ò
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-thymeleaf" class="md-nav__link">
    <span class="md-ellipsis">
      
        7„ÄÅ‰ΩøÁî® Thymeleaf
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="shiro">Shiro<a class="headerlink" href="#shiro" title="Permanent link">&para;</a></h1>
<h2 id="1">1„ÄÅÊùÉÈôêÁöÑÁÆ°ÁêÜ<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<p><strong>‰ªÄ‰πàÊòØÊùÉÈôêÁÆ°ÁêÜÔºü</strong></p>
<p>Âü∫Êú¨Ê∂âÂèäÂà∞Áî®Êà∑ÂèÇ‰∏éÁöÑÁ≥ªÁªüÈÉΩË¶ÅËøõË°åÊùÉÈôêÁÆ°ÁêÜÔºåÊùÉÈôêÁÆ°ÁêÜÂ±û‰∫éÁ≥ªÁªüÂÆâÂÖ®ÁöÑËåÉÁï¥ÔºåÊùÉÈôêÁÆ°ÁêÜÂÆûÁé∞ÂØπÁî®Êà∑ËÆøÈóÆÁ≥ªÁªüÁöÑÊéßÂà∂ÔºåÊåâÁÖßÂÆâÂÖ®ËßÑÂàôÊàñËÄÖÂÆâÂÖ®Á≠ñÁï•ÊéßÂà∂Áî®Êà∑ÂèØ‰ª•ËÆøÈóÆËÄå‰∏îÂè™ËÉΩËÆøÈóÆËá™Â∑±Ë¢´ÊéàÊùÉÁöÑËµÑÊ∫ê„ÄÇ</p>
<p>ÊùÉÈôêÁÆ°ÁêÜÂåÖÊã¨Áî®Êà∑Ë∫´‰ªΩËÆ§ËØÅÂíåÊéàÊùÉ‰∏§‰∏™ÈÉ®ÂàÜÔºåÁÆÄÁß∞ËÆ§ËØÅÊéàÊùÉ„ÄÇÂØπ‰∫éÈúÄË¶ÅËÆøÈóÆÊéßÂà∂ËµÑÊ∫êÁöÑÁî®Êà∑È¶ñÂÖàÁªèËøáË∫´‰ªΩËÆ§ËØÅÔºåËÆ§ËØÅÈÄöËøáÂêéÁî®Êà∑ÂÖ∑ÊúâËØ•ËµÑÊ∫êÁöÑËÆøÈóÆÊùÉÈôêÊñπÂèØËÆøÈóÆ„ÄÇ</p>
<p><strong>‰ªÄ‰πàÊòØË∫´‰ªΩËÆ§ËØÅÔºü</strong></p>
<p>Ë∫´‰ªΩËÆ§ËØÅÔºåÂ∞±ÊòØÂà§Êñ≠‰∏Ä‰∏™Áî®Êà∑ÊòØÂê¶‰∏∫ÂêàÊ≥ïÁî®Êà∑ÁöÑÂ§ÑÁêÜËøáÁ®ã„ÄÇÊúÄÂ∏∏Áî®ÁöÑÁÆÄÂçïË∫´‰ªΩËÆ§ËØÅÊñπÂºèÊòØÁ≥ªÁªüÈÄöËøáÊ†∏ÂØπÁî®Êà∑ËæìÂÖ•ÁöÑÁî®Êà∑ÂêçÂíåÂè£‰ª§ÔºåÁúãÂÖ∂ÊòØÂê¶‰∏éÁ≥ªÁªü‰∏≠Â≠òÂÇ®ÁöÑËØ•Áî®Êà∑ÁöÑÁî®Êà∑ÂêçÂíåÂè£‰ª§‰∏ÄËá¥ÔºåÊù•Âà§Êñ≠Áî®Êà∑Ë∫´‰ªΩÊòØÂê¶Ê≠£Á°Æ„ÄÇÂØπ‰∫éÈááÁî®ÊåáÁ∫πÁ≠âÁ≥ªÁªüÔºåÂàôÂá∫Á§∫ÊåáÁ∫πÔºõÂØπ‰∫éÁ°¨‰ª∂KeyÁ≠âÂà∑Âç°Á≥ªÁªüÔºåÂàôÈúÄË¶ÅÂà∑Âç°„ÄÇ</p>
<p><strong>‰ªÄ‰πàÊòØÊéàÊùÉÔºü</strong></p>
<p>ÊéàÊùÉÔºåÂç≥ËÆøÈóÆÊéßÂà∂ÔºåÊéßÂà∂Ë∞ÅËÉΩËÆøÈóÆÂì™‰∫õËµÑÊ∫ê„ÄÇ‰∏ª‰ΩìËøõË°åË∫´‰ªΩËÆ§ËØÅÂêéÈúÄË¶ÅÂàÜÈÖçÊùÉÈôêÊñπÂèØËÆøÈóÆÁ≥ªÁªüÁöÑËµÑÊ∫êÔºåÂØπ‰∫éÊüê‰∫õËµÑÊ∫êÊ≤°ÊúâÊùÉÈôêÊòØÊó†Ê≥ïËÆøÈóÆÁöÑ„ÄÇ</p>
<h2 id="2-shiro">2„ÄÅ‰ªÄ‰πàÊòØ Shiro<a class="headerlink" href="#2-shiro" title="Permanent link">&para;</a></h2>
<p>Shiro ÊòØ apache Êóó‰∏ã‰∏Ä‰∏™ÂäüËÉΩÂº∫Â§ß‰∏îÊòì‰∫é‰ΩøÁî®ÁöÑ Java ÂÆâÂÖ®Ê°ÜÊû∂ÔºåÂÆÉÊâßË°åË∫´‰ªΩÈ™åËØÅ„ÄÅÊéàÊùÉ„ÄÅÂä†ÂØÜÂíå‰ºöËØùÁÆ°ÁêÜ„ÄÇ‰ΩøÁî® Shiro Êòì‰∫éÁêÜËß£ÁöÑ APIÔºåÊÇ®ÂèØ‰ª•Âø´ÈÄüËΩªÊùæÂú∞‰øùÊä§‰ªª‰ΩïÂ∫îÁî®Á®ãÂ∫èÔºå‰ªéÊúÄÂ∞èÁöÑÁßªÂä®Â∫îÁî®Á®ãÂ∫èÂà∞ÊúÄÂ§ßÁöÑ web Âíå‰ºÅ‰∏öÂ∫îÁî®Á®ãÂ∫è„ÄÇ</p>
<h2 id="3shiro">3„ÄÅShiro ÁöÑÊ†∏ÂøÉÊû∂ÊûÑ<a class="headerlink" href="#3shiro" title="Permanent link">&para;</a></h2>
<p><img src="!assets/Shiro/ShiroArchitecture.png" alt="img" style="" /></p>
<p><strong>Subject</strong></p>
<p>Subject Âç≥‰∏ª‰ΩìÔºåÂ§ñÈÉ®Â∫îÁî®‰∏é Subject ËøõË°å‰∫§‰∫íÔºåSubject ËÆ∞ÂΩï‰∫ÜÂΩìÂâçÊìç‰ΩúÁî®Êà∑ÔºåÂ∞ÜÁî®Êà∑ÁöÑÊ¶ÇÂøµÁêÜËß£‰∏∫ÂΩìÂâçÊìç‰ΩúÁöÑ‰∏ª‰ΩìÔºåÂèØËÉΩÊòØ‰∏Ä‰∏™ÈÄöËøáÊµèËßàÂô®ËØ∑Ê±ÇÁöÑÁî®Êà∑Ôºå‰πüÂèØËÉΩÊòØ-‰∏™ËøêË°åÁöÑÁ®ãÂ∫è„ÄÇSubject Âú® Shiro ‰∏≠ÊòØ‰∏Ä ‰∏™Êé•Âè£ÔºåÊé•Âè£‰∏≠ÂÆö‰πâ‰∫ÜÂæàÂ§öËÆ§ËØÅÊéàÁõ∏ÂÖ≥ÁöÑÊñπÊ≥ïÔºåÂ§ñÈÉ®Á®ãÂ∫èÈÄöËøá Subject ËøõË°åËÆ§ËØÅÊéàÊùÉÔºåËÄåSubject ÊòØÈÄöËøá SecurityManager ÂÆâÂÖ®ÁÆ°ÁêÜÂô®ËøõË°åËÆ§ËØÅÊéàÊùÉ„ÄÇ</p>
<p><strong>SecurityManager</strong></p>
<p>SecurityManager Âç≥ÂÆâÂÖ®ÁÆ°ÁêÜÂô®ÔºåÂØπÂÖ®ÈÉ®ÁöÑ Subject ËøõË°åÂÆâÂÖ®ÁÆ°ÁêÜÔºåÂÆÉÊòØ Shiro ÁöÑÊ†∏ÂøÉÔºå Ë¥üË¥£ÂØπÊâÄÊúâÁöÑ Subject ËøõË°åÂÆâÂÖ®ÁÆ°ÁêÜ„ÄÇÈÄöËøá SecurityManager ÂèØ‰ª•ÂÆåÊàê Subject ÁöÑËÆ§ËØÅ„ÄÅÊéàÊùÉÁ≠âÔºåÂÆûË¥®‰∏ä SecurityManager ÊòØÈÄöËøá Authenticator ËøõË°åËÆ§ËØÅÔºåÈÄöËøá Authorizer ËøõË°åÊéàÊùÉÔºåÈÄöËøáSessionManager ËøõË°å‰ºöËØùÁÆ°ÁêÜÁ≠â „ÄÇSecurityManager ÊòØ‰∏Ä‰∏™Êé•Âè£Ôºå ÁªßÊâø‰∫Ü Authenticator. Authorizer. SessionManagerËøô‰∏â‰∏™Êé•Âè£„ÄÇ</p>
<p><strong>Authenticator</strong></p>
<p>Authenticator Âç≥ËÆ§ËØÅÂô®ÔºåÂØπÁî®Êà∑Ë∫´‰ªΩËøõË°åËÆ§ËØÅÔºåAuthenticatorÊòØ‰∏Ä ‰∏™Êé•Âè£ÔºåShiro Êèê‰æõ ModularRealmAuthenticatorÂÆûÁé∞Á±ªÔºåÈÄöËøáModularRealmAuthenticator Âü∫Êú¨‰∏äÂèØ‰ª•Êª°Ë∂≥Â§ßÂ§öÊï∞ÈúÄÊ±ÇÔºå‰πüÂèØ‰ª•Ëá™ÂÆö‰πâËÆ§ËØÅÂô®„ÄÇ</p>
<p><strong>Authorizer</strong></p>
<p>Authorizer Âç≥ÊéàÊùÉÂô®ÔºåÁî®Êà∑ÈÄöËøáËÆ§ËØÅÂô®ËÆ§ËØÅÈÄöËøáÔºåÂú®ËÆøÈóÆÂäüËÉΩÊó∂ÈúÄË¶ÅÈÄöËøáÊéàÊùÉÂô®Âà§Êñ≠Áî®Êà∑ÊòØÂê¶ÊúâÊ≠§ÂäüËÉΩÁöÑÊìç‰ΩúÊùÉÈôê„ÄÇ</p>
<p><strong>Realm</strong></p>
<p>Realm Âç≥È¢ÜÂüüÔºåÁõ∏ÂΩì‰∫é datasource Êï∞ÊçÆÊ∫êÔºåSecurtyManager ËøõË°åÂÆâÂÖ®ËÆ§ËØÅÈúÄË¶ÅÈÄöËøá Realm Ëé∑ÂèñÁî®Êà∑ÊùÉÈôêÊï∞ÊçÆÔºåÊØîÂ¶ÇÔºöÂ¶ÇÊûúÁî®Êà∑Ë∫´‰ªΩÊï∞ÊçÆÂú®Êï∞ÊçÆÂ∫ìÈÇ£‰πà Realm Â∞±ÈúÄË¶Å‰ªéÊï∞ÊçÆÂ∫ìËé∑ÂèñÁî®Êà∑Ë∫´‰ªΩ‰ø°ÊÅØ„ÄÇ</p>
<p>Ê≥®ÊÑè:‰∏çË¶ÅÊää Realm ÁêÜËß£ÊàêÂè™ÊòØ‰ªéÊï∞ÊçÆÊ∫êÂèñÊï∞ÊçÆÔºåÂú® Realm ‰∏≠ËøòÊúâËÆ§ËØÅÊéàÊùÉÊ†°È™åÁöÑÁõ∏ÂÖ≥ÁöÑ‰ª£Á†Å„ÄÇ</p>
<p><strong>SessionManager</strong></p>
<p>SessionManager Âç≥‰ºöËØùÁÆ°ÁêÜÔºåShiro Ê°ÜÊû∂ÂÆö‰πâ‰∫Ü‰∏ÄÂ•ó‰ºöËØùÁÆ°ÁêÜÔºåÂÆÉ‰∏ç‰æùËµñ web ÂÆπÂô®ÁöÑ SessionÔºåÊâÄ‰ª• Shiro ÂèØ‰ª•‰ΩøÁî®Âú®Èùû web Â∫îÁî®‰∏äÔºå‰πüÂèØ‰ª•Â∞ÜÂàÜÂ∏ÉÂºèÂ∫îÁî®ÁöÑ‰ºöËØùÈõÜ‰∏≠Âú®‰∏ÄÁÇπÁÆ°ÁêÜÔºåÊ≠§ÁâπÊÄßÂèØ‰ΩøÂÆÉÂÆûÁé∞ÂçïÁÇπÁôªÂΩï„ÄÇ</p>
<p><strong>SessionDAO</strong></p>
<p>SessionDAO Âç≥‰ºöËØù daoÔºåÊòØÂØπ Session ‰ºöËØùÊìç‰ΩúÁöÑ‰∏ÄÂ•óÊé•Âè£ÔºåÊØîÂ¶ÇË¶ÅÂ∞Ü Session Â≠òÂÇ®Âà∞Êï∞ÊçÆÂ∫ìÔºåÂèØ‰ª•ÈÄöËøá JDBC Â∞Ü‰ºöËØùÂ≠òÂÇ®Âà∞Êï∞ÊçÆÂ∫ì„ÄÇ</p>
<p><strong>CacheManager</strong></p>
<p>CacheManager Âç≥ÁºìÂ≠òÁÆ°ÁêÜÔºåÂ∞ÜÁî®Êà∑ÊùÉÈôêÊï∞ÊçÆÂ≠òÂÇ®Âú®ÁºìÂ≠òÔºåËøôÊ†∑ÂèØ‰ª•ÊèêÈ´òÊÄßËÉΩ„ÄÇ</p>
<p><strong>Cryptography</strong></p>
<p>Cryptography Âç≥ÂØÜÁ†ÅÁÆ°ÁêÜÔºåShiro Êèê‰æõ‰∫Ü‰∏ÄÂ•óÂä†ÂØÜ/Ëß£ÂØÜÁöÑÁªÑ‰ª∂ÔºåÊñπ‰æøÂºÄÂèë„ÄÇÊØîÂ¶ÇÊèê‰æõÂ∏∏Áî®ÁöÑÊï£Âàó„ÄÅÂä†/Ëß£ÂØÜÁ≠âÂäüËÉΩ„ÄÇ</p>
<h2 id="4shiro">4„ÄÅShiro ‰∏≠ÁöÑËÆ§ËØÅ<a class="headerlink" href="#4shiro" title="Permanent link">&para;</a></h2>
<p>Ë∫´‰ªΩËÆ§ËØÅÔºåÂ∞±ÊòØÂà§Êñ≠‰∏Ä‰∏™Áî®Êà∑ÊòØÂê¶‰∏∫ÂêàÊ≥ïÁî®Êà∑ÁöÑÂ§ÑÁêÜËøáÁ®ã„ÄÇÊúÄÂ∏∏Áî®ÁöÑÁÆÄÂçïË∫´‰ªΩËÆ§ËØÅÊñπÂºèÊòØÁ≥ªÁªüÈÄöËøáÊ†∏ÂØπÁî®Êà∑ËæìÂÖ•ÁöÑÁî®Êà∑ÂêçÂíåÂè£‰ª§ÔºåÁúãÂÖ∂ÊòØÂê¶‰∏éÁ≥ªÁªü‰∏≠Â≠òÂÇ®ÁöÑËØ•Áî®Êà∑ÁöÑÁî®Êà∑ÂêçÂíåÂè£‰ª§‰∏ÄËá¥Ôºå Êù•Âà§Êñ≠Áî®Êà∑Ë∫´‰ªΩÊòØÂê¶Ê≠£Á°Æ„ÄÇ</p>
<p><strong>Shiro ‰∏≠ËÆ§ËØÅÁöÑÂÖ≥ÈîÆÂØπË±°</strong></p>
<p>SubjectÔºö‰∏ª‰ΩìÔºåËÆøÈóÆÁ≥ªÁªüÁöÑÁî®Êà∑Ôºå‰∏ª‰ΩìÂèØ‰ª•ÊòØÁî®Êà∑„ÄÅÁ®ãÂ∫èÁ≠âÔºåËøõË°åËÆ§ËØÅÁöÑÈÉΩÁß∞‰∏∫‰∏ª‰ΩìÔºõ</p>
<ul>
<li>
<p>PrincipalÔºöË∫´‰ªΩ‰ø°ÊÅØ</p>
<p>ÊòØ‰∏ª‰Ωì (subject) ËøõË°åË∫´‰ªΩËÆ§ËØÅÁöÑÊ†áËØÜÔºåÊ†áËØÜÂøÖÈ°ªÂÖ∑ÊúâÂîØ‰∏ÄÊÄßÔºåÂ¶ÇÁî®Êà∑Âêç„ÄÅÊâãÊú∫Âè∑„ÄÅÈÇÆÁÆ±Âú∞ÂùÄÁ≠âÔºå‰∏Ä‰∏™‰∏ª‰ΩìÂèØ‰ª•ÊúâÂ§ö‰∏™Ë∫´‰ªΩÔºå‰ΩÜÊòØÂøÖÈ°ªÊúâ‰∏Ä‰∏™‰∏ªË∫´‰ªΩ (Primary Principal)„ÄÇ</p>
</li>
<li>
<p>CredentialÔºöÂá≠ËØÅ</p>
<p>ÊòØÂè™Êúâ‰∏ª‰ΩìËá™Â∑±Áü•ÈÅìÁöÑÂÆâÂÖ®‰ø°ÊÅØÔºåÂ¶ÇÂØÜÁ†Å„ÄÅËØÅ‰π¶Á≠â„ÄÇ</p>
</li>
</ul>
<p><strong>ËÆ§ËØÅÊµÅÁ®ã</strong></p>
<p><img src="!assets/Shiro/1416193-20190417125006747-856353249.png" alt="1416193-20190417125006747-856353249.png (308√ó488)" style="" /></p>
<ol>
<li>ÈÄöËøá ini ÈÖçÁΩÆÊñá‰ª∂ÂàõÂª∫ SecurityManager„ÄÇ</li>
<li>Ë∞ÉÁî® subject.login ÊñπÊ≥ï‰∏ª‰ΩìÊèê‰∫§ËÆ§ËØÅÔºåÊèê‰∫§ÁöÑ token„ÄÇ</li>
<li>SecurityManager ËøõË°åËÆ§ËØÅÔºåSecurityManager ÊúÄÁªàÁî± ModularRealmAuthenticator ËøõË°åËÆ§ËØÅ„ÄÇ</li>
<li>ModularRealmAuthenticator Ë∞ÉÁî® IniRealmÔºàÁªô realm ‰º†ÂÖ• tokenÔºâÂéª ini ÈÖçÁΩÆÊñá‰ª∂‰∏≠Êü•ËØ¢Áî®Êà∑‰ø°ÊÅØ„ÄÇ</li>
<li>IniRealm Ê†πÊçÆËæìÂÖ•ÁöÑ tokenÔºàUsernamePasswordTokenÔºâ‰ªé shiro.ini Êü•ËØ¢Áî®Êà∑‰ø°ÊÅØÔºåÊ†πÊçÆË¥¶Âè∑Êü•ËØ¢Áî®Êà∑‰ø°ÊÅØÔºàË¥¶Âè∑ÂíåÂØÜÁ†ÅÔºâÔºö<ul>
<li>Â¶ÇÊûúÊü•ËØ¢Âà∞Áî®Êà∑‰ø°ÊÅØÔºåÂ∞±Áªô ModularRealmAuthenticator ËøîÂõûÁî®Êà∑‰ø°ÊÅØÔºàË¥¶Âè∑ÂíåÂØÜÁ†ÅÔºâ„ÄÇ</li>
<li>Â¶ÇÊûúÊü•ËØ¢‰∏çÂà∞ÔºåÂ∞±Áªô ModularRealmAuthenticator ËøîÂõû null„ÄÇ</li>
</ul>
</li>
<li>ModularRealmAuthenticator Êé•Êî∂ IniRealm ËøîÂõû Authentication ËÆ§ËØÅ‰ø°ÊÅØÔºö<ul>
<li>Â¶ÇÊûúËøîÂõûÁöÑËÆ§ËØÅ‰ø°ÊÅØÊòØ nullÔºåModularRealmAuthenticator ÊäõÂá∫ÂºÇÂ∏∏Ôºàorg.apache.shiro.authc.UnknownAccountExceptionÔºâ„ÄÇ</li>
<li>Â¶ÇÊûúËøîÂõûÁöÑËÆ§ËØÅ‰ø°ÊÅØ‰∏çÊòØ nullÔºàËØ¥Êòé inirealm ÊâæÂà∞‰∫ÜÁî®Êà∑ÔºâÔºåÂØπ IniRealm ËøîÂõûÁî®Êà∑ÂØÜÁ†Å ÔºàÂú® ini Êñá‰ª∂‰∏≠Â≠òÂú®Ôºâ„ÄÇ</li>
<li>Âíå token ‰∏≠ÁöÑÂØÜÁ†ÅËøõË°åÂØπÊØîÔºåÂ¶ÇÊûú‰∏ç‰∏ÄËá¥ÊäõÂá∫ÂºÇÂ∏∏Ôºàorg.apache.shiro.authc.IncorrectCredentialsExceptionÔºâ„ÄÇ</li>
</ul>
</li>
</ol>
<h3 id="41">4.1„ÄÅËÆ§ËØÅÁöÑÂºÄÂèë<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>ÂàõÂª∫È°πÁõÆÂπ∂ÂºïÂÖ•‰æùËµñ</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!--ÂºïÂÖ•shiroÁöÑ‰æùËµñ--&gt;</span>
<span class="cm">&lt;!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-core --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.shiro<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>shiro-core<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>1.5.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
</li>
<li>
<p>ÂºïÂÖ• Shiro ÈÖçÁΩÆÊñá‰ª∂Âπ∂Âä†ÂÖ•‰ª•‰∏ãÂÜÖÂÆπÔºö</p>
<p><img src="!assets/Shiro/image-20201102174130104.png" alt="image-20201102174130104" style="float:left" /></p>
<div class="highlight"><pre><span></span><code><span class="k">[users]</span>
<span class="na">xiaochen</span><span class="o">=</span><span class="s">123</span>
<span class="na">zhangsan</span><span class="o">=</span><span class="s">123321</span>
<span class="na">lisi</span><span class="o">=</span><span class="s">3214</span>
</code></pre></div>
</li>
<li>
<p>ÂºÄÂèëËÆ§ËØÅ‰ª£Á†ÅÔºö</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//1.ÂàõÂª∫ÂÆâÂÖ®ÁÆ°ÁêÜÂô®</span>
<span class="w">        </span><span class="n">DefaultSecurityManager</span><span class="w"> </span><span class="n">defaultSecurityManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultSecurityManager</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//2.ÁªôÂÆâÂÖ®ÁÆ°ÁêÜÂô®ËÆæÁΩÆRealm</span>
<span class="w">        </span><span class="n">defaultSecurityManager</span><span class="p">.</span><span class="na">setRealm</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">IniRealm</span><span class="p">(</span><span class="s">&quot;classpath:shiro.ini&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="c1">//3. SecurityUtils ÁªôÂÖ®Â±ÄÂÆâÂÖ®Â∑•ÂÖ∑Á±ªËÆæÁΩÆÂÆâÂÖ®ÁÆ°ÁêÜÂô®</span>
<span class="w">        </span><span class="n">SecurityUtils</span><span class="p">.</span><span class="na">setSecurityManager</span><span class="p">(</span><span class="n">defaultSecurityManager</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//4.ÂÖ≥ÈîÆÂØπË±° Subject‰∏ª‰Ωì</span>
<span class="w">        </span><span class="n">Subject</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecurityUtils</span><span class="p">.</span><span class="na">getSubject</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//5.ÂàõÂª∫‰ª§Áâå</span>
<span class="w">        </span><span class="n">UsernamePasswordToken</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UsernamePasswordToken</span><span class="p">(</span><span class="s">&quot;zhangsan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;123321&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ËÆ§ËØÅÁä∂ÊÄÅÔºö&quot;</span><span class="o">+</span><span class="n">subject</span><span class="p">.</span><span class="na">isAuthenticated</span><span class="p">());</span>
<span class="w">            </span><span class="n">subject</span><span class="p">.</span><span class="na">login</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ËÆ§ËØÅÁä∂ÊÄÅÔºö&quot;</span><span class="o">+</span><span class="n">subject</span><span class="p">.</span><span class="na">isAuthenticated</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnknownAccountException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Êú™Áü•ÁöÑÁî®Êà∑‰ø°ÊÅØ&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IncorrectCredentialsException</span><span class="w"> </span><span class="n">e</span><span class="p">){</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Ë¥¶Êà∑ÂØÜÁ†ÅÈîôËØØ&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>DisabledAccountExceptionÔºàË¥¶Âè∑Ë¢´Á¶ÅÁî®Ôºâ</li>
<li>LockedAccountExceptionÔºàË¥¶Âè∑Ë¢´ÈîÅÂÆöÔºâ</li>
<li>ExcessiveAttemptsExceptionÔºàÁôªÂΩïÂ§±Ë¥•Ê¨°Êï∞ËøáÂ§öÔºâ</li>
<li>ExpiredCredentialsExceptionÔºàÂá≠ËØÅËøáÊúüÔºâÁ≠â</li>
</ul>
</li>
</ol>
<h3 id="42-realm">4.2„ÄÅËá™ÂÆö‰πâ Realm<a class="headerlink" href="#42-realm" title="Permanent link">&para;</a></h3>
<p>‰∏äËæπÁöÑÁ®ãÂ∫è‰ΩøÁî®ÁöÑÊòØ Shiro Ëá™Â∏¶ÁöÑ IniRealmÔºåIniRealm ‰ªé ini ÈÖçÁΩÆÊñá‰ª∂‰∏≠ËØªÂèñÁî®Êà∑ÁöÑ‰ø°ÊÅØÔºåÂ§ßÈÉ®ÂàÜÊÉÖÂÜµ‰∏ãÈúÄË¶Å‰ªéÁ≥ªÁªüÁöÑÊï∞ÊçÆÂ∫ì‰∏≠ËØªÂèñÁî®Êà∑‰ø°ÊÅØÔºåÊâÄ‰ª•ÈúÄË¶ÅËá™ÂÆö‰πâ realm„ÄÇ</p>
<p>Shiro ‰∏≠Êèê‰æõ‰∫ÜËÆ∏Â§öRealmÔºö</p>
<p><img src="!assets/Shiro/image-20200521212728541.png" alt="image-20200521212728541" style="" /></p>
<p>Âú®Ê∫êÁ†Å‰∏≠ËÆ§ËØÅ‰ΩøÁî®ÁöÑÊòØ<code>SimpleAccountRealm</code>Ôºö</p>
<p><img src="!assets/Shiro/image-20200521213451998.png" alt="image-20200521213451998" style="" /></p>
<p><code>SimpleAccountRealm</code>ÁöÑÈÉ®ÂàÜÊ∫êÁ†Å‰∏≠Êúâ‰∏§‰∏™ÊñπÊ≥ïÔºå‰∏Ä‰∏™ÊòØËÆ§ËØÅÔºå‰∏Ä‰∏™ÊòØÊéàÊùÉÔºö</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SimpleAccountRealm</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AuthorizingRealm</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//.......ÁúÅÁï•</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">AuthenticationInfo</span><span class="w"> </span><span class="nf">doGetAuthenticationInfo</span><span class="p">(</span><span class="n">AuthenticationToken</span><span class="w"> </span><span class="n">token</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">AuthenticationException</span><span class="p">{</span>
<span class="w">        </span><span class="n">UsernamePasswordToken</span><span class="w"> </span><span class="n">upToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UsernamePasswordToken</span><span class="p">)</span><span class="w"> </span><span class="n">token</span><span class="p">;</span>
<span class="w">        </span><span class="n">SimpleAccount</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getUser</span><span class="p">(</span><span class="n">upToken</span><span class="p">.</span><span class="na">getUsername</span><span class="p">());</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">account</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">isLocked</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LockedAccountException</span><span class="p">(</span><span class="s">&quot;Account [&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;] is locked.&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">isCredentialsExpired</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The credentials for account [&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;] are expired&quot;</span><span class="p">;</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ExpiredCredentialsException</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">account</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">AuthorizationInfo</span><span class="w"> </span><span class="nf">doGetAuthorizationInfo</span><span class="p">(</span><span class="n">PrincipalCollection</span><span class="w"> </span><span class="n">principals</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getUsername</span><span class="p">(</span><span class="n">principals</span><span class="p">);</span>
<span class="w">        </span><span class="n">USERS_LOCK</span><span class="p">.</span><span class="na">readLock</span><span class="p">().</span><span class="na">lock</span><span class="p">();</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">users</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">USERS_LOCK</span><span class="p">.</span><span class="na">readLock</span><span class="p">().</span><span class="na">unlock</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>ÊúÄÁªàÊâßË°åÁî®Êà∑ÂêçÊØîËæÉÊòØÂú®<code>SimpleAccountRealm</code>ÁöÑ<code>doGetAuthenticationInfo</code>Ëøô‰∏™ÊñπÊ≥ï‰∏≠ÂÆåÊàêÁî®Êà∑ÂêçÊ†°È™åÔºåÊúÄÁªàÂØÜÁ†ÅÊ†°È™åÊòØÂú®<code>AuthenticatingRealm</code>ÁöÑ<code>assertCredentialsMatch</code>‰∏≠ÂÆåÊàê„ÄÇËßÇÂÖ∂Ê∫êÁ†ÅÔºå<code>doGetAuthenticationInfo</code>Âú®<code>AuthenticatingRealm</code>ÔºàËÆ§ËØÅRealmÔºâ‰∏≠Ôºå<code>doGetAuthorizationInfo</code>Âú®<code>AuthorizingRealm</code>ÔºàÊéàÊùÉRealmÔºâ‰∏≠„ÄÇ</p>
<p><strong>Ëá™ÂÆö‰πâRealmÔºö</strong></p>
<ol>
<li>
<p>Ëá™ÂÆö‰πâ Realm ÈúÄË¶ÅÁªßÊâø AuthorizingRealmÔºåÈúÄË¶ÅÈáçÂÜôËØ•Á±ªÁöÑ‰∏§‰∏™ÊñπÊ≥ïÔºöÊéàÊùÉÂíåËÆ§ËØÅ</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Ëá™ÂÆö‰πâÂÆûÁé∞RealmÂÆûÁé∞ Â∞ÜËÆ§ËØÅ/ÊéàÊùÉÊï∞ÊçÆÊù•Ê∫êËΩ¨‰∏∫Êï∞ÊçÆÂ∫ìÂÆûÁé∞</span>
<span class="cm"> *</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CustomRealm</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AuthorizingRealm</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * ÊéàÊùÉ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">AuthorizationInfo</span><span class="w"> </span><span class="nf">doGetAuthorizationInfo</span><span class="p">(</span><span class="n">PrincipalCollection</span><span class="w"> </span><span class="n">principalCollection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * ËÆ§ËØÅ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">AuthenticationInfo</span><span class="w"> </span><span class="nf">doGetAuthenticationInfo</span><span class="p">(</span><span class="n">AuthenticationToken</span><span class="w"> </span><span class="n">authenticationToken</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">AuthenticationException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//‰ªétoken‰∏≠Ëé∑ÂèñÁî®Êà∑Âêç</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">authenticationToken</span><span class="p">.</span><span class="na">getPrincipal</span><span class="p">();</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">principal</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//Ê†πÊçÆË∫´‰ªΩ‰ø°ÊÅØ‰ΩøÁî® jdbc mybatis Êü•ËØ¢Êï∞ÊçÆ</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;zhangsan&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">principal</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//ÂèÇÊï∞1ÔºöËøîÂõûÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÁî®Êà∑ÂêçÔºåÂèÇÊï∞2ÔºöËøîÂõûÊï∞ÊçÆÂ∫ì‰∏≠Ê≠£Á°ÆÁöÑÂØÜÁ†ÅÔºåÂèÇÊï∞3ÔºöÊèê‰æõÂΩìÂâçRealmÁöÑÂêçÂ≠óÔºåthis.getName()</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleAuthenticationInfo</span><span class="p">(</span><span class="n">principal</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;123321&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>‰ΩøÁî®Ëá™ÂÆö‰πâ Realm ËÆ§ËØÅ</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * ‰ΩøÁî®Ëá™ÂÆö‰πârealm</span>
<span class="cm"> *</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestCustomRealmAuthenticator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//ÂàõÂª∫Security Manager</span>
<span class="w">        </span><span class="n">DefaultSecurityManager</span><span class="w"> </span><span class="n">defaultSecurityManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultSecurityManager</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//ËÆæÁΩÆËá™ÂÆö‰πârealm</span>
<span class="w">        </span><span class="n">defaultSecurityManager</span><span class="p">.</span><span class="na">setRealm</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CustomRealm</span><span class="p">());</span>
<span class="w">        </span><span class="c1">//ÁªôÂÖ®Â±ÄÂÆâÂÖ®Â∑•ÂÖ∑Á±ªËÆæÁΩÆÂÆâÂÖ®ÁÆ°ÁêÜÂô®</span>
<span class="w">        </span><span class="n">SecurityUtils</span><span class="p">.</span><span class="na">setSecurityManager</span><span class="p">(</span><span class="n">defaultSecurityManager</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//ÈÄöËøáÂÆâÂÖ®Â∑•ÂÖ∑Á±ªËé∑Âèñ‰∏ª‰Ωì</span>
<span class="w">        </span><span class="n">Subject</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecurityUtils</span><span class="p">.</span><span class="na">getSubject</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//ÂàõÂª∫token</span>
<span class="w">        </span><span class="n">UsernamePasswordToken</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UsernamePasswordToken</span><span class="p">(</span><span class="s">&quot;zhangsan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;123321&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">subject</span><span class="p">.</span><span class="na">login</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ÁôªÂΩïÊàêÂäü&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnknownAccountException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Êú™Áü•Áî®Êà∑&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IncorrectCredentialsException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ÂØÜÁ†ÅÈîôËØØ&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
<h3 id="43-md5-salt">4.3„ÄÅ‰ΩøÁî® MD5 + salt<a class="headerlink" href="#43-md5-salt" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>MD5 Âíå salt ÁöÑ‰ΩøÁî®</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestShiroMD5</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//‰ΩøÁî®MD5</span>
<span class="w">        </span><span class="n">Md5Hash</span><span class="w"> </span><span class="n">md5Hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Md5Hash</span><span class="p">(</span><span class="s">&quot;123&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">md5Hash</span><span class="p">.</span><span class="na">toHex</span><span class="p">());</span>

<span class="w">        </span><span class="c1">//‰ΩøÁî®MD5+saltÂ§ÑÁêÜ</span>
<span class="w">        </span><span class="n">Md5Hash</span><span class="w"> </span><span class="n">md5Hash1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Md5Hash</span><span class="p">(</span><span class="s">&quot;123&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;#@DJF&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">md5Hash1</span><span class="p">.</span><span class="na">toHex</span><span class="p">());</span>

<span class="w">        </span><span class="c1">//‰ΩøÁî®MD5+salt+hashÊï£Âàó</span>
<span class="w">        </span><span class="n">Md5Hash</span><span class="w"> </span><span class="n">md5Hash2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Md5Hash</span><span class="p">(</span><span class="s">&quot;123&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;#$JFs&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">md5Hash2</span><span class="p">.</span><span class="na">toHex</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Âú®Ëá™ÂÆö‰πâÁöÑ Realm ‰∏≠Âä†ÂÖ• MD5 Âíå salt</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * ‰ΩøÁî®Ëá™ÂÆö‰πârealmÂä†ÂÖ•md5+salt+hash</span>
<span class="cm"> *</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CustomMd5Realm</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AuthorizingRealm</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * ÊéàÊùÉ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">AuthorizationInfo</span><span class="w"> </span><span class="nf">doGetAuthorizationInfo</span><span class="p">(</span><span class="n">PrincipalCollection</span><span class="w"> </span><span class="n">principalCollection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * ËÆ§ËØÅ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">AuthenticationInfo</span><span class="w"> </span><span class="nf">doGetAuthenticationInfo</span><span class="p">(</span><span class="n">AuthenticationToken</span><span class="w"> </span><span class="n">authenticationToken</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">AuthenticationException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//Ëé∑ÂèñË∫´‰ªΩ‰ø°ÊÅØ</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">authenticationToken</span><span class="p">.</span><span class="na">getPrincipal</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//Ê†πÊçÆÁî®Êà∑ÂêçÊü•ËØ¢Êï∞ÊçÆÂ∫ì</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;zhangsan&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">principal</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//ÂèÇÊï∞1ÔºöÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÁî®Êà∑Âêç  ÂèÇÊï∞2ÔºöÊï∞ÊçÆÂ∫ìmd5+salt‰πãÂêéÁöÑÂØÜÁ†Å  ÂèÇÊï∞3ÔºöÊ≥®ÂÜåÊó∂ÁöÑÈöèÊú∫Áõê   ÂèÇÊï∞4ÔºörealmÁöÑÂêçÂ≠ó</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleAuthenticationInfo</span><span class="p">(</span><span class="n">principal</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;8380cb81ded9e644bf37638a09fabb19&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ByteSource</span><span class="p">.</span><span class="na">Util</span><span class="p">.</span><span class="na">bytes</span><span class="p">(</span><span class="s">&quot;#$JFs&quot;</span><span class="p">),</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>‰ΩøÁî®Ëá™ÂÆö‰πâÁöÑ Realm + Md5 +salt ËÆ§ËØÅÔºö</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * ‰ΩøÁî®Ëá™ÂÆö‰πâÁöÑrealm + md5 + salt</span>
<span class="cm"> *</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestCustomMd5RealmAuthenticator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//ÂàõÂª∫ÂÆâÂÖ®ÁÆ°ÁêÜÂô®</span>
<span class="w">        </span><span class="n">DefaultSecurityManager</span><span class="w"> </span><span class="n">defaultSecurityManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultSecurityManager</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//ÂàõÂª∫Ëá™ÂÆö‰πâRealm</span>
<span class="w">        </span><span class="n">CustomMd5Realm</span><span class="w"> </span><span class="n">customMd5Realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CustomMd5Realm</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//ËÆæÁΩÆrealm‰ΩøÁî®hashÂá≠ËØÅÂåπÈÖçÂô®</span>
<span class="w">        </span><span class="n">HashedCredentialsMatcher</span><span class="w"> </span><span class="n">hashedCredentialsMatcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashedCredentialsMatcher</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//‰ΩøÁî®ÁÆóÊ≥ï</span>
<span class="w">        </span><span class="n">hashedCredentialsMatcher</span><span class="p">.</span><span class="na">setHashAlgorithmName</span><span class="p">(</span><span class="s">&quot;md5&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//‰ΩøÁî®Êï£Âàó</span>
<span class="w">        </span><span class="n">hashedCredentialsMatcher</span><span class="p">.</span><span class="na">setHashIterations</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>
<span class="w">        </span><span class="n">customMd5Realm</span><span class="p">.</span><span class="na">setCredentialsMatcher</span><span class="p">(</span><span class="n">hashedCredentialsMatcher</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//Ê≥®ÂÖ•realm</span>
<span class="w">        </span><span class="n">defaultSecurityManager</span><span class="p">.</span><span class="na">setRealm</span><span class="p">(</span><span class="n">customMd5Realm</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//Â∞ÜÂÆâÂÖ®ÁÆ°ÁêÜÂ∑•ÂÖ∑Ê≥®ÂÖ•ÂÖ®Â±ÄÂ∑•ÂÖ∑Á±ª</span>
<span class="w">        </span><span class="n">SecurityUtils</span><span class="p">.</span><span class="na">setSecurityManager</span><span class="p">(</span><span class="n">defaultSecurityManager</span><span class="p">);</span>

<span class="w">        </span><span class="c1">//ÈÄöËøáÂÆâÂÖ®Â∑•ÂÖ∑Ëé∑Âèñ‰∏ª‰Ωìsubject</span>
<span class="w">        </span><span class="n">Subject</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecurityUtils</span><span class="p">.</span><span class="na">getSubject</span><span class="p">();</span>

<span class="w">        </span><span class="c1">//ÂàõÂª∫‰ª§Áâå</span>
<span class="w">        </span><span class="n">UsernamePasswordToken</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UsernamePasswordToken</span><span class="p">(</span><span class="s">&quot;zhangsan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;123&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">subject</span><span class="p">.</span><span class="na">login</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ÁôªÂΩïÊàêÂäü&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnknownAccountException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Ë¥¶Âè∑ÈîôËØØ&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IncorrectCredentialsException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ÂØÜÁ†ÅÈîôËØØ&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
<h2 id="5shiro">5„ÄÅShiro ‰∏≠ÁöÑÊéàÊùÉ<a class="headerlink" href="#5shiro" title="Permanent link">&para;</a></h2>
<p>ÊéàÊùÉÔºåÂç≥ËÆøÈóÆÊéßÂà∂ÔºåÊéßÂà∂Ë∞ÅËÉΩËÆøÈóÆÂì™‰∫õËµÑÊ∫ê„ÄÇ‰∏ª‰ΩìËøõË°åË∫´‰ªΩËÆ§ËØÅÂêéÈúÄË¶ÅÂàÜÈÖçÊùÉÈôêÊñπÂèØËÆøÈóÆÁ≥ªÁªüÁöÑËµÑÊ∫êÔºåÂØπ‰∫éÊüê‰∫õËµÑÊ∫êÊ≤°ÊúâÊùÉÈôêÊòØÊó†Ê≥ïËÆøÈóÆÁöÑ„ÄÇ</p>
<p><strong>ÂÖ≥ÈîÆÂØπË±°</strong>Ôºö</p>
<ul>
<li>SubjectÔºö‰∏ª‰ΩìÔºå‰∏ª‰ΩìÈúÄË¶ÅËÆøÈóÆÁ≥ªÁªü‰∏≠ÁöÑËµÑÊ∫ê„ÄÇ</li>
<li>ResourceÔºöËµÑÊ∫êÔºåÂ¶ÇÁ≥ªÁªüËèúÂçï„ÄÅÈ°µÈù¢„ÄÅÊåâÈíÆ„ÄÅÁ±ªÊñπÊ≥ï„ÄÅÁ≥ªÁªüÂïÜÂìÅ‰ø°ÊÅØÁ≠â„ÄÇËµÑÊ∫êÂåÖÊã¨ËµÑÊ∫êÁ±ªÂûãÂíåËµÑÊ∫êÂÆû‰æãÔºåÊØîÂ¶ÇÂïÜÂìÅ‰ø°ÊÅØ‰∏∫ËµÑÊ∫êÁ±ªÂûãÔºåÁ±ªÂûã‰∏∫to1ÁöÑÂïÜÂìÅ‰∏∫ËµÑÊ∫êÂÆû‰æãÔºåÁºñÂè∑‰∏∫001ÁöÑÂïÜÂìÅ‰ø°ÊÅØ‰πüÂ±û‰∫éËµÑÊ∫êÂÆû‰æã„ÄÇ</li>
<li>PermissionÔºöÊùÉÈôê/ËÆ∏ÂèØÔºåËßÑÂÆö‰∫Ü‰∏ª‰ΩìÂØπËµÑÊ∫êÁöÑÊìç‰ΩúËÆ∏ÂèØÔºåÊùÉÈôêÁ¶ªÂºÄËµÑÊ∫êÊ≤°ÊúâÊÑè‰πâÔºåÂ¶ÇÁî®Êà∑Êü•ËØ¢ÊùÉÈôê„ÄÅÁî®Êà∑Ê∑ªÂä†ÊùÉÈôê„ÄÅÊüê‰∏™Á±ªÊñπÊ≥ïÁöÑË∞ÉÁî®ÊùÉÈôê„ÄÅÁºñÂè∑‰∏∫o01Áî®Êà∑ÁöÑ‰øÆÊîπÊùÉÈôêÁ≠âÔºåÈÄöËøáÊùÉÈôêÂèØÁü•‰∏ª‰ΩìÂØπÂì™‰∫õËµÑÊ∫êÈÉΩÊúâÂì™‰∫õÊìç‰ΩúËÆ∏ÂèØ„ÄÇ</li>
</ul>
<p><strong>ÊéàÊùÉÊµÅÁ®ã</strong></p>
<p><img src="!assets/Shiro/1416193-20190417125018168-618409170.png" alt="img" style="" /></p>
<ol>
<li>ÂØπ subject ËøõË°åÊéàÊùÉÔºåË∞ÉÁî®ÊñπÊ≥ï isPermittedÔºà"permission‰∏≤"Ôºâ„ÄÇ</li>
<li>SecurityManager ÊâßË°åÊéàÊùÉÔºåÈÄöËøá ModularRealmAuthorizer ÊâßË°åÊéàÊùÉ„ÄÇ</li>
<li>ModularRealmAuthorizer ÊâßË°å realmÔºàËá™ÂÆö‰πâÁöÑ RealmÔºâ‰ªéÊï∞ÊçÆÂ∫ìÊü•ËØ¢ÊùÉÈôêÊï∞ÊçÆ„ÄÇ<ul>
<li>Ë∞ÉÁî® realm ÁöÑÊéàÊùÉÊñπÊ≥ïÔºödoGetAuthorizationInfo„ÄÇ</li>
</ul>
</li>
<li>realm ‰ªéÊï∞ÊçÆÂ∫ìÊü•ËØ¢ÊùÉÈôêÊï∞ÊçÆÔºåËøîÂõû ModularRealmAuthorizer„ÄÇ</li>
<li>ModularRealmAuthorizer Ë∞ÉÁî® PermissionResolver ËøõË°åÊùÉÈôê‰∏≤ÊØîÂØπ„ÄÇ</li>
<li>Â¶ÇÊûúÊØîÂØπÂêéÔºåisPermitted ‰∏≠ "permission‰∏≤" Âú® realm Êü•ËØ¢Âà∞ÊùÉÈôêÊï∞ÊçÆ‰∏≠ÔºåËØ¥ÊòéÁî®Êà∑ËÆøÈóÆ permission ‰∏≤ÊúâÊùÉÈôêÔºåÂê¶Âàô Ê≤°ÊúâÊùÉÈôêÔºåÊäõÂá∫ÂºÇÂ∏∏„ÄÇ</li>
</ol>
<p><strong>ÊéàÊùÉÊñπÂºè</strong></p>
<ul>
<li>
<p>Âü∫‰∫éËßíËâ≤ÁöÑËÆøÈóÆÊéßÂà∂</p>
<blockquote>
<p>RBAC Âü∫‰∫éËßíËâ≤ÁöÑËÆøÈóÆÊéßÂà∂ÔºàRole-Based Access ControlÔºâÊòØ‰ª•ËßíËâ≤‰∏∫‰∏≠ÂøÉËøõË°åËÆøÈóÆÊéßÂà∂</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="p">(</span><span class="n">subject</span><span class="p">.</span><span class="na">hasRole</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">)){</span>
<span class="w">    </span><span class="c1">//Êìç‰Ωú‰ªÄ‰πàËµÑÊ∫ê</span>
<span class="p">}</span>
</code></pre></div>
</blockquote>
</li>
<li>
<p>Âü∫‰∫éËµÑÊ∫êÁöÑËÆøÈóÆÊéßÂà∂</p>
<blockquote>
<p>RBAC Âü∫‰∫éËµÑÊ∫êÁöÑËÆøÈóÆÊéßÂà∂ÔºàResource-Based Access ControlÔºâÊòØ‰ª•ËµÑÊ∫ê‰∏∫‰∏≠ÂøÉËøõË°åËÆøÈóÆÊéßÂà∂</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="p">(</span><span class="n">subject</span><span class="p">.</span><span class="na">isPermission</span><span class="p">(</span><span class="s">&quot;user:update:01&quot;</span><span class="p">)){</span><span class="c1">//ËµÑÊ∫êÂÆû‰æã</span>
<span class="w">    </span><span class="c1">//ÂØπ01Áî®Êà∑ËøõË°å‰øÆÊîπ</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="n">subject</span><span class="p">.</span><span class="na">isPermission</span><span class="p">(</span><span class="s">&quot;user:update:*&quot;</span><span class="p">)){</span><span class="c1">//ËµÑÊ∫êÁ±ªÂûã</span>
<span class="w">  </span><span class="c1">//ÂØπuserÊ®°Âùó‰∏ãÁöÑÊâÄÊúâËµÑÊ∫êËøõË°å‰øÆÊîπ   </span>
<span class="p">}</span>
</code></pre></div>
</blockquote>
</li>
</ul>
<h3 id="51">5.1„ÄÅÊùÉÈôêÂ≠óÁ¨¶‰∏≤<a class="headerlink" href="#51" title="Permanent link">&para;</a></h3>
<p>ÊùÉÈôêÂ≠óÁ¨¶‰∏≤ÁöÑËßÑÂàôÊòØÔºö<code>ËµÑÊ∫êÊ†áËØÜÁ¨¶ÔºöÊìç‰ΩúÔºöËµÑÊ∫êÂÆû‰æãÊ†áËØÜÁ¨¶</code>ÔºåÊÑèÊÄùÊòØÂØπÂì™‰∏™ËµÑÊ∫êÁöÑÂì™‰∏™ÂÆû‰æãÂÖ∑Êúâ‰ªÄ‰πàÊìç‰ΩúÔºå‚Äú:‚Äù ÊòØËµÑÊ∫ê/Êìç‰Ωú/ÂÆû‰æãÁöÑÂàÜÂâ≤Á¨¶ÔºåÊùÉÈôêÂ≠óÁ¨¶‰∏≤‰πüÂèØ‰ª•‰ΩøÁî®*ÈÄöÈÖçÁ¨¶„ÄÇ</p>
<p>‰æãÂ≠êÔºö</p>
<ul>
<li>Áî®Êà∑ÂàõÂª∫ÊùÉÈôêÔºö<code>user:create</code>ÔºåÊàñ <code>user:create:*</code></li>
<li>Áî®Êà∑‰øÆÊîπÂÆû‰æã001ÁöÑÊùÉÈôêÔºö<code>user:update:001</code></li>
<li>Áî®Êà∑ÂÆû‰æã001ÁöÑÊâÄÊúâÊùÉÈôêÔºö<code>user:*:001</code></li>
</ul>
<p><strong>Shiro ‰∏≠ÊéàÊùÉÁºñÁ®ãÂÆûÁé∞ÊñπÂºè</strong></p>
<ul>
<li>
<p><strong>ÁºñÁ®ãÂºè</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">Subject</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecurityUtils</span><span class="p">.</span><span class="na">getSubject</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="n">subject</span><span class="p">.</span><span class="na">hasRole</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//ÊúâÊùÉÈôê</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//Êó†ÊùÉÈôê</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Ê≥®Ëß£Âºè</strong></p>
<div class="highlight"><pre><span></span><code><span class="nd">@RequiresRoles</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//ÊúâÊùÉÈôê</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Ê†áÁ≠æÂºè</strong></p>
<div class="highlight"><pre><span></span><code>JSP/GSP<span class="w"> </span>Ê†áÁ≠æÔºöÂú®JSP/GSP<span class="w"> </span>È°µÈù¢ÈÄöËøáÁõ∏Â∫îÁöÑÊ†áÁ≠æÂÆåÊàêÔºö
<span class="nt">&lt;shiro:hasRole</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;admin&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cp">&lt;!‚Äî ÊúâÊùÉÈôê‚Äî&gt;</span>
<span class="nt">&lt;/shiro:hasRole&gt;</span>
Ê≥®ÊÑè:<span class="w"> </span>Thymeleaf<span class="w"> </span>‰∏≠‰ΩøÁî®shiroÈúÄË¶ÅÈ¢ùÂ§ñÈõÜÊàê!
</code></pre></div>
</li>
</ul>
<h3 id="52">5.2„ÄÅÂºÄÂèëÊéàÊùÉ<a class="headerlink" href="#52" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>realm ÁöÑÂÆûÁé∞Ôºö</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * ‰ΩøÁî®Ëá™ÂÆö‰πârealmÂä†ÂÖ•md5+salt+hash</span>
<span class="cm"> *</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CustomMd5Realm</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AuthorizingRealm</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * ÊéàÊùÉ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">AuthorizationInfo</span><span class="w"> </span><span class="nf">doGetAuthorizationInfo</span><span class="p">(</span><span class="n">PrincipalCollection</span><span class="w"> </span><span class="n">principalCollection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">primaryPrincipal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">principalCollection</span><span class="p">.</span><span class="na">getPrimaryPrincipal</span><span class="p">();</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">principalCollection</span><span class="p">);</span>
<span class="w">        </span><span class="n">SimpleAuthorizationInfo</span><span class="w"> </span><span class="n">simpleAuthorizationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleAuthorizationInfo</span><span class="p">();</span>
<span class="w">        </span><span class="n">simpleAuthorizationInfo</span><span class="p">.</span><span class="na">addRole</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">simpleAuthorizationInfo</span><span class="p">.</span><span class="na">addStringPermission</span><span class="p">(</span><span class="s">&quot;user:update:*&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">simpleAuthorizationInfo</span><span class="p">.</span><span class="na">addStringPermission</span><span class="p">(</span><span class="s">&quot;product:*&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">simpleAuthorizationInfo</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * ËÆ§ËØÅ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">AuthenticationInfo</span><span class="w"> </span><span class="nf">doGetAuthenticationInfo</span><span class="p">(</span><span class="n">AuthenticationToken</span><span class="w"> </span><span class="n">authenticationToken</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">AuthenticationException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//Ëé∑ÂèñË∫´‰ªΩ‰ø°ÊÅØ</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">authenticationToken</span><span class="p">.</span><span class="na">getPrincipal</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//Ê†πÊçÆÁî®Êà∑ÂêçÊü•ËØ¢Êï∞ÊçÆÂ∫ì</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;zhangsan&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">principal</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//ÂèÇÊï∞1ÔºöÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÁî®Êà∑Âêç  ÂèÇÊï∞2ÔºöÊï∞ÊçÆÂ∫ìmd5+salt‰πãÂêéÁöÑÂØÜÁ†Å  ÂèÇÊï∞3ÔºöÊ≥®ÂÜåÊó∂ÁöÑÈöèÊú∫Áõê   ÂèÇÊï∞4ÔºörealmÁöÑÂêçÂ≠ó</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleAuthenticationInfo</span><span class="p">(</span><span class="n">principal</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;8380cb81ded9e644bf37638a09fabb19&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ByteSource</span><span class="p">.</span><span class="na">Util</span><span class="p">.</span><span class="na">bytes</span><span class="p">(</span><span class="s">&quot;#$JFs&quot;</span><span class="p">),</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ÊéàÊùÉÔºö</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestCustomMd5RealmAuthenticator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//ÂàõÂª∫ÂÆâÂÖ®ÁÆ°ÁêÜÂô®</span>
<span class="w">        </span><span class="n">DefaultSecurityManager</span><span class="w"> </span><span class="n">defaultSecurityManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultSecurityManager</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//ÂàõÂª∫Ëá™ÂÆö‰πâRealm</span>
<span class="w">        </span><span class="n">CustomMd5Realm</span><span class="w"> </span><span class="n">customMd5Realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CustomMd5Realm</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//ËÆæÁΩÆrealm‰ΩøÁî®hashÂá≠ËØÅÂåπÈÖçÂô®</span>
<span class="w">        </span><span class="n">HashedCredentialsMatcher</span><span class="w"> </span><span class="n">hashedCredentialsMatcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashedCredentialsMatcher</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//‰ΩøÁî®ÁÆóÊ≥ï</span>
<span class="w">        </span><span class="n">hashedCredentialsMatcher</span><span class="p">.</span><span class="na">setHashAlgorithmName</span><span class="p">(</span><span class="s">&quot;md5&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//‰ΩøÁî®Êï£Âàó</span>
<span class="w">        </span><span class="n">hashedCredentialsMatcher</span><span class="p">.</span><span class="na">setHashIterations</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>
<span class="w">        </span><span class="n">customMd5Realm</span><span class="p">.</span><span class="na">setCredentialsMatcher</span><span class="p">(</span><span class="n">hashedCredentialsMatcher</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//Ê≥®ÂÖ•realm</span>
<span class="w">        </span><span class="n">defaultSecurityManager</span><span class="p">.</span><span class="na">setRealm</span><span class="p">(</span><span class="n">customMd5Realm</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//Â∞ÜÂÆâÂÖ®ÁÆ°ÁêÜÂ∑•ÂÖ∑Ê≥®ÂÖ•ÂÖ®Â±ÄÂ∑•ÂÖ∑Á±ª</span>
<span class="w">        </span><span class="n">SecurityUtils</span><span class="p">.</span><span class="na">setSecurityManager</span><span class="p">(</span><span class="n">defaultSecurityManager</span><span class="p">);</span>

<span class="w">        </span><span class="c1">//ÈÄöËøáÂÆâÂÖ®Â∑•ÂÖ∑Ëé∑Âèñ‰∏ª‰Ωìsubject</span>
<span class="w">        </span><span class="n">Subject</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecurityUtils</span><span class="p">.</span><span class="na">getSubject</span><span class="p">();</span>

<span class="w">        </span><span class="c1">//ÂàõÂª∫‰ª§Áâå</span>
<span class="w">        </span><span class="n">UsernamePasswordToken</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UsernamePasswordToken</span><span class="p">(</span><span class="s">&quot;zhangsan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;123&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">subject</span><span class="p">.</span><span class="na">login</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ÁôªÂΩïÊàêÂäü&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnknownAccountException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Ë¥¶Âè∑ÈîôËØØ&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IncorrectCredentialsException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ÂØÜÁ†ÅÈîôËØØ&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">//ËÆ§ËØÅÈÄöËøá</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">subject</span><span class="p">.</span><span class="na">isAuthenticated</span><span class="p">()){</span>
<span class="w">            </span><span class="c1">//Âü∫‰∫éËßíËâ≤ÊùÉÈôêÁÆ°ÁêÜ</span>
<span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subject</span><span class="p">.</span><span class="na">hasRole</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">admin</span><span class="p">);</span>
<span class="w">            </span><span class="c1">//Âü∫‰∫éÂ§öËßíËâ≤ÊùÉÈôêÊéßÂà∂</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">subject</span><span class="p">.</span><span class="na">hasAllRoles</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;super&quot;</span><span class="p">)));</span>
<span class="w">            </span><span class="c1">//ÊòØÂê¶ÂÖ∑ÊúâÂÖ∂‰∏≠‰∏Ä‰∏™ËßíËâ≤</span>
<span class="w">            </span><span class="kt">boolean</span><span class="o">[]</span><span class="w"> </span><span class="n">booleans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subject</span><span class="p">.</span><span class="na">hasRoles</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">hasRoles</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;super&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p">)));</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">aBoolean</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">booleans</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">aBoolean</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">//Âü∫‰∫éËµÑÊ∫êÊùÉÈôêÁÆ°ÁêÜ ËµÑÊ∫êÊ†áËØÜÁ¨¶ÔºöÊìç‰ΩúÔºöËµÑÊ∫êÁ±ªÂûã</span>
<span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">permitted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subject</span><span class="p">.</span><span class="na">isPermitted</span><span class="p">(</span><span class="s">&quot;product:create:001&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">permitted</span><span class="p">);</span>
<span class="w">            </span><span class="c1">//ÂàÜÂà´ÂÖ∑ÊúâÂì™‰∫õÊùÉÈôê</span>
<span class="w">            </span><span class="kt">boolean</span><span class="o">[]</span><span class="w"> </span><span class="n">permitted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subject</span><span class="p">.</span><span class="na">isPermitted</span><span class="p">(</span><span class="s">&quot;user:*:01&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;order:*:10&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">permitted</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">//ÂêåÊó∂ÂÖ∑ÊúâÂì™‰∫õÊùÉÈôê</span>
<span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">permittedAll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subject</span><span class="p">.</span><span class="na">isPermittedAll</span><span class="p">(</span><span class="s">&quot;user:*01&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;product:*&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">permittedAll</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
<h2 id="6">6„ÄÅÈ°πÁõÆÂÆûÊàò<a class="headerlink" href="#6" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>ÂàõÂª∫ÁÆÄÂçïÁöÑ maven È°πÁõÆ</p>
<p><img src="!assets/Shiro/image-20201104101331470.png" alt="image-20201104101331470" style="float:left" /></p>
</li>
<li>
<p>ÂºïÂÖ• JSP Âíå Shiro ‰æùËµñ</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!--ÂºïÂÖ•JSP‰æùËµñ--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.tomcat.embed<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>tomcat-embed-jasper<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>jstl<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>jstl<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="cm">&lt;!--ÂºïÂÖ•shiroÊï¥Âêàspringboot‰æùËµñ--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.shiro<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>shiro-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>1.5.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
</li>
<li>
<p>Âõ†‰∏∫Áî®ÁöÑ JSPÔºåÊâÄ‰ª•Ë¶ÅÂú® properties Êñá‰ª∂ÈáåËøõË°åËÆæÁΩÆÔºö</p>
<div class="highlight"><pre><span></span><code><span class="na">server.port</span><span class="o">=</span><span class="s">8080</span>
<span class="na">server.servlet.context-path</span><span class="o">=</span><span class="s">/shiro</span>
<span class="na">spring.application.name</span><span class="o">=</span><span class="s">shiro</span>
<span class="na">spring.mvc.view.prefix</span><span class="o">=</span><span class="s">/</span>
<span class="na">spring.mvc.view.suffix</span><span class="o">=</span><span class="s">.jsp</span>
</code></pre></div>
<p>ÂêåÊó∂‰øÆÊîπ Run Configuration ÈáåÈù¢ÁöÑ EnvironmentÔºåÂ∞Ü Working directory ËµãÂÄº‰∏∫  <code>$MODULE_WORKING_DIR$</code></p>
<p>ËøêË°åÈ°πÁõÆÔºåÂâçÂæÄ http://localhost:8080/shiro/index.jspÔºåÂ∞±ÂèØ‰ª•ÁúãÂà∞‰∏ªÈ°µ‰∫Ü</p>
</li>
</ol>
<h3 id="61-shiro">6.1„ÄÅÈÖçÁΩÆ Shiro ÁéØÂ¢É<a class="headerlink" href="#61-shiro" title="Permanent link">&para;</a></h3>
<p>Êï¥ÂêàÊÄùË∑ØÔºö</p>
<p><img src="!assets/Shiro/image-20200525185630463.png" alt="image-20200525185630463" style="zoom:80%;" /></p>
<ol>
<li>
<p>ÂàõÂª∫ Shiro ÈÖçÁΩÆÁ±ª</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ShiroConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 1.ÂàõÂª∫shiroFilter</span>
<span class="cm">     * Ë¥üË¥£Êã¶Êà™ÊâÄÊúâËØ∑Ê±Ç</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ShiroFilterFactoryBean</span><span class="w"> </span><span class="nf">getShiroFilterFactoryBean</span><span class="p">(</span><span class="n">DefaultSecurityManager</span><span class="w"> </span><span class="n">securityManager</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ShiroFilterFactoryBean</span><span class="w"> </span><span class="n">shiroFilterFactoryBean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ShiroFilterFactoryBean</span><span class="p">();</span>
<span class="w">        </span><span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//Ê≥®ÊÑèËøáÊª§Âô®ÈÖçÁΩÆÈ°∫Â∫èÔºå‰∏çËÉΩÈ¢†ÂÄí</span>
<span class="w">        </span><span class="c1">//ÈÖçÁΩÆÈÄÄÂá∫ ËøáÊª§Âô®,ÂÖ∂‰∏≠ÁöÑÂÖ∑‰ΩìÁöÑÈÄÄÂá∫‰ª£Á†ÅShiroÂ∑≤ÁªèÊõøÊàë‰ª¨ÂÆûÁé∞‰∫ÜÔºåÁôªÂá∫ÂêéË∑≥ËΩ¨ÈÖçÁΩÆÁöÑloginUrl</span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;/logout&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;logout&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//ÈÖçÁΩÆ‰∏ç‰ºöË¢´Êã¶Êà™ÁöÑÈìæÊé•ÔºåÈ°∫Â∫èÂà§Êñ≠</span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;/login**&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;anon&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;/register**&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;anon&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;/**&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;authc&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//ÈÖçÁΩÆshiroÈªòËÆ§ÁôªÂΩïÁïåÈù¢Âú∞ÂùÄÔºåÂâçÂêéÁ´ØÂàÜÁ¶ª‰∏≠ÁôªÂΩïÈ°µÈù¢Ë∑≥ËΩ¨Â∫îÁî±ÂâçÁ´ØË∑ØÁî±ÊéßÂà∂ÔºåÂêéÂè∞‰ªÖËøîÂõûjsonÊï∞ÊçÆ</span>
<span class="w">        </span><span class="n">shiroFilterFactoryBean</span><span class="p">.</span><span class="na">setLoginUrl</span><span class="p">(</span><span class="s">&quot;/login.jsp&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//ÁôªÂΩïÊàêÂäüÂêéË¶ÅË∑≥ËΩ¨ÁöÑÈ°µÈù¢</span>
<span class="w">        </span><span class="n">shiroFilterFactoryBean</span><span class="p">.</span><span class="na">setSuccessUrl</span><span class="p">(</span><span class="s">&quot;/index.jsp&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//Êú™ÊéàÊùÉÈ°µÈù¢</span>
<span class="w">        </span><span class="n">shiroFilterFactoryBean</span><span class="p">.</span><span class="na">setUnauthorizedUrl</span><span class="p">(</span><span class="s">&quot;/403.jsp&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">shiroFilterFactoryBean</span><span class="p">.</span><span class="na">setFilterChainDefinitionMap</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>
<span class="w">        </span><span class="n">shiroFilterFactoryBean</span><span class="p">.</span><span class="na">setSecurityManager</span><span class="p">(</span><span class="n">securityManager</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">shiroFilterFactoryBean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 2.ÂàõÂª∫ÂÆâÂÖ®ÁÆ°ÁêÜÂô®</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">DefaultWebSecurityManager</span><span class="w"> </span><span class="nf">getDefaultWebSecurityManager</span><span class="p">(</span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;CustomRealm&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Realm</span><span class="w"> </span><span class="n">realm</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">DefaultWebSecurityManager</span><span class="w"> </span><span class="n">defaultWebSecurityManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultWebSecurityManager</span><span class="p">();</span>
<span class="w">        </span><span class="n">defaultWebSecurityManager</span><span class="p">.</span><span class="na">setRealm</span><span class="p">(</span><span class="n">realm</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">defaultWebSecurityManager</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 3.ÂàõÂª∫Ëá™ÂÆö‰πârealm</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;CustomRealm&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Realm</span><span class="w"> </span><span class="nf">getRealm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CustomRealm</span><span class="w"> </span><span class="n">customRealm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CustomRealm</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">customRealm</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ÂàõÂª∫Ëá™ÂÆö‰πâ Realm</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CustomRealm</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AuthorizingRealm</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">AuthorizationInfo</span><span class="w"> </span><span class="nf">doGetAuthorizationInfo</span><span class="p">(</span><span class="n">PrincipalCollection</span><span class="w"> </span><span class="n">principalCollection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">AuthenticationInfo</span><span class="w"> </span><span class="nf">doGetAuthenticationInfo</span><span class="p">(</span><span class="n">AuthenticationToken</span><span class="w"> </span><span class="n">authenticationToken</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">AuthenticationException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ËøôÊó∂ËÆøÈóÆ http://localhost:8080/index.jsp ‰ºöË∑≥ËΩ¨Âà∞ http://localhost:8080/login.jsp È°µÈù¢‰∏≠„ÄÇ</p>
</li>
</ol>
<p>Ê≥®ÊÑèÔºö<code>getDefaultWebSecurityManager</code>ÁöÑÂèÇÊï∞<code>(Realm realm)</code> Êä•Á∫¢ÔºåÊèêÁ§∫ÔºöCould not autowire. There is more than one bean of 'Realm' typeÔºåÊòØÂõ†‰∏∫Âú®‰æùËµñ‰∏≠ÊúâÂêåÂêçÁöÑbeanÔºåÂèØ‰ª•‰∏ç‰ΩøÁî®ÂèÇÊï∞ËµãÂÄºÔºåÁõ¥Êé•Áî®ÊñπÊ≥ïËé∑ÂèñÂ∞±Ë°åÔºö<code>defaultWebSecurityManager.setRealm(getRealm());</code>Ôºå‰πüÂèØ‰ª•ÁªôËá™ÂÆö‰πâÁöÑ <code>getRealm</code>ÁöÑÊ≥®Ëß£Ëµ∑‰∏™ÂêçÂ≠ó<code>@Bean("customRealm")</code>ÔºåÁÑ∂ÂêéÂú®<code>getDefaultWebSecurityManager</code>‰∏≠‰ΩøÁî® Qualifier ËøõË°åÊåáÂÆöÔºö<code>@Qualifier("customRealm") Realm realm</code>„ÄÇ</p>
<h3 id="62">6.2„ÄÅÂ∏∏ËßÅËøáÊª§Âô®<a class="headerlink" href="#62" title="Permanent link">&para;</a></h3>
<p>Ê≥®ÊÑè: <strong>shiroÊèê‰æõÂíåÂ§ö‰∏™ÈªòËÆ§ÁöÑËøáÊª§Âô®ÔºåÊàë‰ª¨ÂèØ‰ª•Áî®Ëøô‰∫õËøáÊª§Âô®Êù•ÈÖçÁΩÆÊéßÂà∂ÊåáÂÆöurlÁöÑÊùÉÈôêÔºö</strong></p>
<table>
<thead>
<tr>
<th>ÈÖçÁΩÆÁº©ÂÜô</th>
<th>ÂØπÂ∫îÁöÑËøáÊª§Âô®</th>
<th>ÂäüËÉΩ</th>
</tr>
</thead>
<tbody>
<tr>
<td>anon</td>
<td>AnonymousFilter</td>
<td>ÊåáÂÆöurlÂèØ‰ª•ÂåøÂêçËÆøÈóÆ</td>
</tr>
<tr>
<td>authc</td>
<td>FormAuthenticationFilter</td>
<td>ÊåáÂÆöurlÈúÄË¶ÅformË°®ÂçïÁôªÂΩïÔºåÈªòËÆ§‰ºö‰ªéËØ∑Ê±Ç‰∏≠Ëé∑Âèñ<code>username</code>„ÄÅ<code>password</code>,<code>rememberMe</code>Á≠âÂèÇÊï∞Âπ∂Â∞ùËØïÁôªÂΩïÔºåÂ¶ÇÊûúÁôªÂΩï‰∏ç‰∫ÜÂ∞±‰ºöË∑≥ËΩ¨Âà∞loginUrlÈÖçÁΩÆÁöÑË∑ØÂæÑ„ÄÇÊàë‰ª¨‰πüÂèØ‰ª•Áî®Ëøô‰∏™ËøáÊª§Âô®ÂÅöÈªòËÆ§ÁöÑÁôªÂΩïÈÄªËæëÔºå‰ΩÜÊòØ‰∏ÄËà¨ÈÉΩÊòØÊàë‰ª¨Ëá™Â∑±Âú®ÊéßÂà∂Âô®ÂÜôÁôªÂΩïÈÄªËæëÁöÑÔºåËá™Â∑±ÂÜôÁöÑËØùÂá∫ÈîôËøîÂõûÁöÑ‰ø°ÊÅØÈÉΩÂèØ‰ª•ÂÆöÂà∂Âòõ„ÄÇ</td>
</tr>
<tr>
<td>authcBasic</td>
<td>BasicHttpAuthenticationFilter</td>
<td>ÊåáÂÆöurlÈúÄË¶ÅbasicÁôªÂΩï</td>
</tr>
<tr>
<td>logout</td>
<td>LogoutFilter</td>
<td>ÁôªÂá∫ËøáÊª§Âô®ÔºåÈÖçÁΩÆÊåáÂÆöurlÂ∞±ÂèØ‰ª•ÂÆûÁé∞ÈÄÄÂá∫ÂäüËÉΩÔºåÈùûÂ∏∏Êñπ‰æø</td>
</tr>
<tr>
<td>noSessionCreation</td>
<td>NoSessionCreationFilter</td>
<td>Á¶ÅÊ≠¢ÂàõÂª∫‰ºöËØù</td>
</tr>
<tr>
<td>perms</td>
<td>PermissionsAuthorizationFilter</td>
<td>ÈúÄË¶ÅÊåáÂÆöÊùÉÈôêÊâçËÉΩËÆøÈóÆ</td>
</tr>
<tr>
<td>port</td>
<td>PortFilter</td>
<td>ÈúÄË¶ÅÊåáÂÆöÁ´ØÂè£ÊâçËÉΩËÆøÈóÆ</td>
</tr>
<tr>
<td>rest</td>
<td>HttpMethodPermissionFilter</td>
<td>Â∞ÜhttpËØ∑Ê±ÇÊñπÊ≥ïËΩ¨ÂåñÊàêÁõ∏Â∫îÁöÑÂä®ËØçÊù•ÊûÑÈÄ†‰∏Ä‰∏™ÊùÉÈôêÂ≠óÁ¨¶‰∏≤ÔºåËøô‰∏™ÊÑüËßâÊÑè‰πâ‰∏çÂ§ßÔºåÊúâÂÖ¥Ë∂£Ëá™Â∑±ÁúãÊ∫êÁ†ÅÁöÑÊ≥®Èáä</td>
</tr>
<tr>
<td>roles</td>
<td>RolesAuthorizationFilter</td>
<td>ÈúÄË¶ÅÊåáÂÆöËßíËâ≤ÊâçËÉΩËÆøÈóÆ</td>
</tr>
<tr>
<td>ssl</td>
<td>SslFilter</td>
<td>ÈúÄË¶ÅhttpsËØ∑Ê±ÇÊâçËÉΩËÆøÈóÆ</td>
</tr>
<tr>
<td>user</td>
<td>UserFilter</td>
<td>ÈúÄË¶ÅÂ∑≤ÁôªÂΩïÊàñ‚ÄúËÆ∞‰ΩèÊàë‚ÄùÁöÑÁî®Êà∑ÊâçËÉΩËÆøÈóÆ</td>
</tr>
</tbody>
</table>
<h3 id="63">6.3„ÄÅÂÆûÁé∞ÁÆÄÂçïËÆ§ËØÅ<a class="headerlink" href="#63" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>ÁºñÂÜô login.jsp </p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>Áî®Êà∑ÁôªÂΩï<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/login&quot;</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>Áî®Êà∑ÂêçÔºö<span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="w">    </span>ÂØÜÁ†ÅÔºö<span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;ÁôªÂΩï&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div>
</li>
<li>
<p>ÁºñÂÜô index.jsp</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>Á≥ªÁªü‰∏ªÈ°µ<span class="w"> </span>v1.0<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;h2&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/logout&quot;</span><span class="nt">&gt;</span>ÈÄÄÂá∫ÁôªÂΩï<span class="nt">&lt;/a&gt;&lt;/h2&gt;</span>
<span class="nt">&lt;ul&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>Áî®Êà∑ÁÆ°ÁêÜ<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>ÂïÜÂìÅÁÆ°ÁêÜ<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>ËÆ¢ÂçïÁÆ°ÁêÜ<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>Áâ©ÊµÅÁÆ°ÁêÜ<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div>
</li>
<li>
<p>ÁºñÂÜôÊéßÂà∂Âô® ShiroController.java</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * @author Orichalcos</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nd">@Controller</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ShiroController</span><span class="w"> </span><span class="p">{</span>

<span class="w">      </span><span class="cm">/**</span>
<span class="cm">       * Ë∫´‰ªΩËÆ§ËØÅ</span>
<span class="cm">       */</span>
<span class="w">      </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/login&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="c1">//Ëé∑Âèñ‰∏ª‰ΩìÂØπË±°</span>
<span class="w">          </span><span class="n">Subject</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecurityUtils</span><span class="p">.</span><span class="na">getSubject</span><span class="p">();</span>
<span class="w">          </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">subject</span><span class="p">.</span><span class="na">login</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">UsernamePasswordToken</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">));</span>
<span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/index.jsp&quot;</span><span class="p">;</span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnknownAccountException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Áî®Êà∑ÂêçÈîôËØØÔºÅ&quot;</span><span class="p">);</span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IncorrectCredentialsException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">              </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ÂØÜÁ†ÅÈîôËØØÔºÅ&quot;</span><span class="p">);</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/login.jsp&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Âú®Ëá™ÂÆö‰πâÁöÑ Realm ‰∏≠ËøîÂõûÈùôÊÄÅÊï∞ÊçÆ</p>
<div class="highlight"><pre><span></span><code><span class="kd">protected</span><span class="w"> </span><span class="n">AuthenticationInfo</span><span class="w"> </span><span class="nf">doGetAuthenticationInfo</span><span class="p">(</span><span class="n">AuthenticationToken</span><span class="w"> </span><span class="n">authenticationToken</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">AuthenticationException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">authenticationToken</span><span class="p">.</span><span class="na">getPrincipal</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Orichalcos&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">principal</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleAuthenticationInfo</span><span class="p">(</span><span class="n">principal</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;123&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>‰øÆÊîπ‰∫Ü ShiroFilter ‰∏≠ÁöÑËøáÊª§ËßÑÂàô</p>
<div class="highlight"><pre><span></span><code><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;/login**&quot;</span><span class="p">,</span><span class="s">&quot;anon&quot;</span><span class="p">);</span>
<span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;/**&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;authc&quot;</span><span class="p">);</span>
</code></pre></div>
<p>ShiroFilter ‰∏≠ÁöÑËøáÊª§ÁªìÊûúÂíåÈ°∫Â∫èÊúâÂÖ≥ÔºåÂ¶Ç‰∏äËÆæÁΩÆÂêéÔºå<code>/login</code>„ÄÅ<code>/login.jsp</code>ËØ∑Ê±ÇÂèØ‰ª•Ë¢´ÂåøÂêçËÆøÈóÆÔºåÂÖ∂‰ΩôÁöÑËØ∑Ê±ÇÈÉΩË¶ÅÁªèËøáËÆ§ËØÅ„ÄÇ</p>
</li>
<li>
<p>ÊµãËØï</p>
</li>
</ol>
<h3 id="64md5salt">6.4„ÄÅÊï∞ÊçÆÂ∫ì+MD5+Salt<a class="headerlink" href="#64md5salt" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Ê∑ªÂä†‰æùËµñÔºö</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!--lombok--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="cm">&lt;!--mybatis--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>2.1.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="cm">&lt;!--mysql--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>5.1.49<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="cm">&lt;!--druid--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>druid-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>1.1.22<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
</li>
<li>
<p>ÈÖçÁΩÆ application.properties</p>
<div class="highlight"><pre><span></span><code><span class="na">spring.datasource.type</span><span class="o">=</span><span class="s">com.alibaba.druid.pool.DruidDataSource</span>
<span class="na">spring.datasource.driver-class-name</span><span class="o">=</span><span class="s">com.mysql.jdbc.Driver</span>
<span class="na">spring.datasource.url</span><span class="o">=</span><span class="s">jdbc:mysql://localhost:3306/shiro?characterEncoding=utf-8</span>
<span class="na">spring.datasource.username</span><span class="o">=</span><span class="s">root</span>
<span class="na">spring.datasource.password</span><span class="o">=</span><span class="s">root</span>
<span class="na">mybatis.type-aliases-package</span><span class="o">=</span><span class="s">com.orichalcos.entity</span>
<span class="na">mybatis.mapper-locations</span><span class="o">=</span><span class="s">classpath:mapping/*.xml</span>
</code></pre></div>
</li>
<li>
<p>ÂàõÂª∫Êï∞ÊçÆÂ∫ìÊï∞ÊçÆÂ∫ì shiro</p>
<div class="highlight"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="k">NAMES</span><span class="w"> </span><span class="n">utf8mb4</span><span class="p">;</span>
<span class="k">SET</span><span class="w"> </span><span class="n">FOREIGN_KEY_CHECKS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="c1">-- ----------------------------</span>
<span class="c1">-- Table structure for t_user</span>
<span class="c1">-- ----------------------------</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n n-Quoted">`t_user`</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n n-Quoted">`t_user`</span><span class="w">  </span><span class="p">(</span>
<span class="w">  </span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`username`</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span><span class="w"> </span><span class="k">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="n">utf8_general_ci</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`password`</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span><span class="w"> </span><span class="k">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="n">utf8_general_ci</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`salt`</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="n">utf8_general_ci</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="k">BTREE</span>
<span class="p">)</span><span class="w"> </span><span class="k">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="k">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8_general_ci</span><span class="w"> </span><span class="k">ROW_FORMAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Compact</span><span class="p">;</span>

<span class="k">SET</span><span class="w"> </span><span class="n">FOREIGN_KEY_CHECKS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<p><img src="!assets/Shiro/image-20201111000526097.png" alt="image-20201111000526097" style="" /></p>
</li>
<li>
<p>ÂÆû‰ΩìÁ±ª User.java</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">User</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">salt</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ShiroMapper.java</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="nd">@Mapper</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ShiroMapper</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * ‰øùÂ≠òÁî®Êà∑</span>
<span class="cm">     *</span>
<span class="cm">     * @param user Áî®Êà∑</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ShiroMapper.xml</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper</span>
<span class="cp">          PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">          &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.orichalcos.mapper.ShiroMapper&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;save&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;User&quot;</span><span class="w"> </span><span class="na">useGeneratedKeys=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">keyProperty=</span><span class="s">&quot;id&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>t_user
<span class="w">        </span>VALUES
<span class="w">        </span>(#{id},#{username},#{password},#{salt});
<span class="w">    </span><span class="nt">&lt;/insert&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div>
</li>
<li>
<p>ShiroService.java</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ShiroService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Ê≥®ÂÜåÁî®Êà∑</span>
<span class="cm">     *</span>
<span class="cm">     * @param user Áî®Êà∑</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ÈöèÊú∫ÁõêÁîüÊàêÂ∑•ÂÖ∑Á±ª SaltUtils.java</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SaltUtils</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getSalt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="o">[]</span><span class="w"> </span><span class="n">chars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890!@#$%^&amp;*()&quot;</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">();</span>
<span class="w">        </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">stringBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chars</span><span class="o">[</span><span class="k">new</span><span class="w"> </span><span class="nf">Random</span><span class="p">().</span><span class="na">nextInt</span><span class="p">(</span><span class="n">chars</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="o">]</span><span class="p">;</span>
<span class="w">            </span><span class="n">stringBuilder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">stringBuilder</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ShiroServiceImpl.java</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">  * @author Orichalcos</span>
<span class="cm">  */</span>
<span class="nd">@Service</span>
<span class="nd">@Transactional</span><span class="p">(</span><span class="n">rollbackFor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Exception</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ShiroServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ShiroService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ShiroMapper</span><span class="w"> </span><span class="n">shiroMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//ÁîüÊàêÈöèÊú∫Áõê</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">salt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SlatUtils</span><span class="p">.</span><span class="na">getSalt</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//Â∞ÜÈöèÊú∫Áõê‰øùÂ≠òÂà∞user‰∏≠</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">setSalt</span><span class="p">(</span><span class="n">salt</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//ÂØπÊòéÊñáÂØÜÁ†ÅËøõË°åMD5+salt+HashÊï£Âàó</span>
<span class="w">        </span><span class="n">Md5Hash</span><span class="w"> </span><span class="n">md5Hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Md5Hash</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getPassword</span><span class="p">(),</span><span class="w"> </span><span class="n">ByteSource</span><span class="p">.</span><span class="na">Util</span><span class="p">.</span><span class="na">bytes</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getSalt</span><span class="p">()),</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="n">md5Hash</span><span class="p">.</span><span class="na">toHex</span><span class="p">());</span>
<span class="w">        </span><span class="n">shiroMapper</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ShiroController.java Ê≥®ÂÜåÊé•Âè£</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">  * Áî®Êà∑Ê≥®ÂÜå</span>
<span class="cm">  */</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/register&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">shiroService</span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/login.jsp&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/register.jsp&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Âú® Shiro ÁöÑÈÖçÁΩÆÊñá‰ª∂ÔºàShiroConfig.javaÔºâ‰∏≠ÈúÄË¶ÅÂ∞ÜÊ≥®ÂÜåÊé•Âè£ÂíåËµÑÊ∫êËøõË°åÊîæË°åÔºö</p>
<div class="highlight"><pre><span></span><code><span class="c1">//ÈÖçÁΩÆÁ≥ªÁªüÂÖ¨ÂÖ±ËµÑÊ∫ê</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
<span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;/login&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;anon&quot;</span><span class="p">);</span>
<span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;/register**&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;anon&quot;</span><span class="p">);</span>
<span class="c1">//authc ËØ∑Ê±ÇËøô‰∏™ËµÑÊ∫êÈúÄË¶ÅËÆ§ËØÅÂíåÊéàÊùÉ</span>
<span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;/**&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;authc&quot;</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>register.jsp</p>
<div class="highlight"><pre><span></span><code><span class="k">&lt;%@</span><span class="n">page</span><span class="w"> </span><span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; UTF-8&quot;</span><span class="w"> </span><span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="w"> </span><span class="n">isELIgnored</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="k">%&gt;</span>
<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span><span class="w"> </span><span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="w">    </span><span class="nt">&lt;meta</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;meta</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;viewport&quot;</span>
<span class="w">          </span><span class="na">content=</span><span class="s">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;meta</span><span class="w"> </span><span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span><span class="w"> </span><span class="na">content=</span><span class="s">&quot;ie=edge&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;title&gt;</span>Document<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>Áî®Êà∑Ê≥®ÂÜå<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/register&quot;</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>Áî®Êà∑ÂêçÔºö<span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="w">    </span>ÂØÜÁ†ÅÔºö<span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Á´ãÂç≥Ê≥®ÂÜå&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
</li>
<li>
<p>ËøôÊ†∑Â∞±ÂÆûÁé∞‰∫Ü Êï∞ÊçÆÂ∫ì + MD5 + Salt ÁöÑÂØÜÁ†ÅÂä†ÂØÜÊåÅ‰πÖÂåñ</p>
</li>
</ol>
<h3 id="65">6.5„ÄÅÊï∞ÊçÆÂ∫ì‰ø°ÊÅØËÆ§ËØÅ<a class="headerlink" href="#65" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Âú® ShiroMapper.xml ‰∏≠Ê∑ªÂä† findUserByUsername</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findUserByUsername&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;String&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;User&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>SELECT
<span class="w">        </span>id,
<span class="w">        </span>username,
<span class="w">        </span>password,
<span class="w">        </span>salt
<span class="w">    </span>FROM
<span class="w">        </span>t_user
<span class="w">    </span>WHERE
<span class="w">        </span>username<span class="w"> </span>=<span class="w"> </span>#{username};
<span class="nt">&lt;/select&gt;</span>
</code></pre></div>
</li>
<li>
<p>Âú® ShiroMapper.java ‰∏≠Ê∑ªÂä† findUserByUsername</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">  * ÈÄöËøáÁî®Êà∑ÂêçÊü•ÊâæÁî®Êà∑</span>
<span class="cm">  *</span>
<span class="cm">  * @param username Áî®Êà∑Âêç</span>
<span class="cm">  * @return Áî®Êà∑</span>
<span class="cm">  */</span>
<span class="n">User</span><span class="w"> </span><span class="nf">findUserByUsername</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>Âú® ShiroService.java ‰∏≠Ê∑ªÂä† findUserByUsername</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">  * ÈÄöËøáÁî®Êà∑ÂêçÊü•ÊâæÁî®Êà∑</span>
<span class="cm">  *</span>
<span class="cm">  * @param username Áî®Êà∑Âêç</span>
<span class="cm">  * @return Áî®Êà∑</span>
<span class="cm">  */</span>
<span class="n">User</span><span class="w"> </span><span class="nf">findUserByUsername</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>Âú® ShiroServiceImpl.java ‰∏≠Â¢ûÂä†ÂÆûÁé∞</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">findUserByUsername</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">shiroMapper</span><span class="p">.</span><span class="na">findUserByUsername</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Áî±‰∫é‰ΩøÁî®‰∫Ü MD5 + salt Âä†ÂØÜÔºåÊâÄ‰ª•ÈúÄË¶ÅÊõ¥Êîπ CustomRealm.java ‰∏≠ÁöÑËÆ§ËØÅÊñπÊ≥ï</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Autowired</span>
<span class="kd">private</span><span class="w"> </span><span class="n">ShiroService</span><span class="w"> </span><span class="n">shiroService</span><span class="p">;</span>

<span class="nd">@Override</span>
<span class="kd">protected</span><span class="w"> </span><span class="n">AuthenticationInfo</span><span class="w"> </span><span class="nf">doGetAuthenticationInfo</span><span class="p">(</span><span class="n">AuthenticationToken</span><span class="w"> </span><span class="n">authenticationToken</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">AuthenticationException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//Ëé∑ÂèñË∫´‰ªΩ‰ø°ÊÅØ</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">authenticationToken</span><span class="p">.</span><span class="na">getPrincipal</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//Ê†πÊçÆË∫´‰ªΩÊü•ËØ¢Áî®Êà∑‰ø°ÊÅØ</span>
<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shiroService</span><span class="p">.</span><span class="na">findUserByUsername</span><span class="p">(</span><span class="n">principal</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ObjectUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">user</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleAuthenticationInfo</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getUsername</span><span class="p">(),</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getPassword</span><span class="p">(),</span><span class="w"> </span><span class="n">ByteSource</span><span class="p">.</span><span class="na">Util</span><span class="p">.</span><span class="na">bytes</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getSalt</span><span class="p">()),</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ÂêåÊó∂ÔºåÈúÄË¶ÅÊõ¥Êîπ realm ÁöÑÈÖçÁΩÆÔºå‰ΩøÁî®Âá≠ËØÅÂåπÈÖçÂô®‰ª•ÂèähashÊï£Âàó</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">  * 3.ÂàõÂª∫Ëá™ÂÆö‰πârealm</span>
<span class="cm">  */</span>
<span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;CustomRealm&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">Realm</span><span class="w"> </span><span class="nf">getRealm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">CustomRealm</span><span class="w"> </span><span class="n">customRealm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CustomRealm</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//‰øÆÊîπÂá≠ËØÅÊ†°È™åÂåπÈÖçÂô®</span>
<span class="w">    </span><span class="n">HashedCredentialsMatcher</span><span class="w"> </span><span class="n">credentialsMatcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashedCredentialsMatcher</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//ËÆæÁΩÆÂä†ÂØÜÁÆóÊ≥ï‰∏∫MD5</span>
<span class="w">    </span><span class="n">credentialsMatcher</span><span class="p">.</span><span class="na">setHashAlgorithmName</span><span class="p">(</span><span class="s">&quot;MD5&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//ËÆæÁΩÆÊï£ÂàóÊ¨°Êï∞</span>
<span class="w">    </span><span class="n">credentialsMatcher</span><span class="p">.</span><span class="na">setHashIterations</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>
<span class="w">    </span><span class="n">customRealm</span><span class="p">.</span><span class="na">setCredentialsMatcher</span><span class="p">(</span><span class="n">credentialsMatcher</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">customRealm</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
<p>Âú®Á¨¨ 5 Ê≠•Â¶ÇÊûúÂá∫Áé∞ @Autowired Êó†Ê≥ïÂØºÂÖ•ÁöÑÊÉÖÂÜµÔºåÂèØ‰ª•‰ΩøÁî®‰∏ãÈù¢ËøôÁßçÊñπÊ≥ïÔºö</p>
<ol>
<li>
<p>ÂºÄÂèëÂú®Â∑•ÂéÇ‰∏≠Ëé∑Âèñ bean ÂØπË±°ÁöÑÂ∑•ÂÖ∑Á±ª</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">  * @author Orichalcos</span>
<span class="cm">  */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApplicationContextUtils</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ApplicationContextAware</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setApplicationContext</span><span class="p">(</span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">BeansException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ApplicationContextUtils</span><span class="p">.</span><span class="na">applicationContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">      * Ê†πÊçÆBeanÂêçÂ≠óËé∑ÂèñÂ∑•ÂéÇ‰∏≠ÊåáÂÆöÁöÑBeanÂØπË±°</span>
<span class="cm">      */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getBean</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">beanName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">beanName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">getBean</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">tClass</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">getBean</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="n">tClass</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Áªô ShiroService.java Âä†‰∏ä‰∏Ä‰∏™ÂêçÂ≠ó<code>@Service("shiroService")</code>ÔºåÊúÄÂêéÈÄöËøáÂ∑•ÂÖ∑Á±ªËé∑ÂèñÔºö</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="n">ShiroService</span><span class="w"> </span><span class="n">shiroService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ShiroService</span><span class="p">)</span><span class="w"> </span><span class="n">ApplicationContextUtils</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;shiroService&quot;</span><span class="p">);</span>
</code></pre></div>
</li>
</ol>
<h3 id="66">6.6„ÄÅÊï∞ÊçÆÂ∫ì‰ø°ÊÅØÊéàÊùÉ<a class="headerlink" href="#66" title="Permanent link">&para;</a></h3>
<p>ÊéàÊùÉÊï∞ÊçÆÂ∫ìÁªìÊûÑ</p>
<p><img src="!assets/Shiro/image-20200527204839080.png" alt="image-20200527204839080" style="" /></p>
<p>SQL</p>
<div class="highlight"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="k">NAMES</span><span class="w"> </span><span class="n">utf8mb4</span><span class="p">;</span>
<span class="k">SET</span><span class="w"> </span><span class="n">FOREIGN_KEY_CHECKS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="c1">-- ----------------------------</span>
<span class="c1">-- Table structure for t_perms</span>
<span class="c1">-- ----------------------------</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">t_perms</span><span class="o">`</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">t_perms</span><span class="o">`</span><span class="w">  </span><span class="p">(</span>
<span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="w">  </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="n">utf8_general_ci</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="o">`</span><span class="n">url</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="n">utf8_general_ci</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">BTREE</span>
<span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8_general_ci</span><span class="w"> </span><span class="n">ROW_FORMAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Compact</span><span class="p">;</span>

<span class="c1">-- ----------------------------</span>
<span class="c1">-- Table structure for t_role</span>
<span class="c1">-- ----------------------------</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">t_role</span><span class="o">`</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">t_role</span><span class="o">`</span><span class="w">  </span><span class="p">(</span>
<span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="w">  </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="n">utf8_general_ci</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">BTREE</span>
<span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8_general_ci</span><span class="w"> </span><span class="n">ROW_FORMAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Compact</span><span class="p">;</span>

<span class="c1">-- ----------------------------</span>
<span class="c1">-- Table structure for t_role_perms</span>
<span class="c1">-- ----------------------------</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">t_role_perms</span><span class="o">`</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">t_role_perms</span><span class="o">`</span><span class="w">  </span><span class="p">(</span>
<span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="w">  </span><span class="o">`</span><span class="n">roleid</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="o">`</span><span class="n">permsid</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">BTREE</span>
<span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8_general_ci</span><span class="w"> </span><span class="n">ROW_FORMAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Compact</span><span class="p">;</span>

<span class="c1">-- ----------------------------</span>
<span class="c1">-- Table structure for t_user_role</span>
<span class="c1">-- ----------------------------</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">t_user_role</span><span class="o">`</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">t_user_role</span><span class="o">`</span><span class="w">  </span><span class="p">(</span>
<span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="w">  </span><span class="o">`</span><span class="n">userid</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="o">`</span><span class="n">roleid</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">BTREE</span>
<span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf8_general_ci</span><span class="w"> </span><span class="n">ROW_FORMAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Compact</span><span class="p">;</span>

<span class="k">SET</span><span class="w"> </span><span class="n">FOREIGN_KEY_CHECKS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<p>Role ÂÆû‰ΩìÁ±ª</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Role</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Perms ÂÆû‰ΩìÁ±ª</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Perms</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ol>
<li>
<p>È°µÈù¢ËµÑÊ∫êÈÄöËøá Shiro Ê†áÁ≠æËøõË°åÊéßÂà∂Ôºö</p>
<div class="highlight"><pre><span></span><code><span class="k">&lt;%@</span><span class="n">page</span><span class="w"> </span><span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; UTF-8&quot;</span><span class="w"> </span><span class="n">isELIgnored</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="w"> </span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span><span class="n">taglib</span><span class="w"> </span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;shiro&quot;</span><span class="w"> </span><span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://shiro.apache.org/tags&quot;</span><span class="w"> </span><span class="k">%&gt;</span>
<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span><span class="w"> </span><span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;head&gt;</span>
<span class="w">        </span><span class="nt">&lt;meta</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;meta</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;viewport&quot;</span>
<span class="w">              </span><span class="na">content=</span><span class="s">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;meta</span><span class="w"> </span><span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span><span class="w"> </span><span class="na">content=</span><span class="s">&quot;ie=edge&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;title&gt;</span>index<span class="nt">&lt;/title&gt;</span>
<span class="w">    </span><span class="nt">&lt;/head&gt;</span>
<span class="w">    </span><span class="nt">&lt;body&gt;</span>
<span class="w">        </span><span class="nt">&lt;h1&gt;</span>Á≥ªÁªü‰∏ªÈ°µ<span class="w"> </span>v1.0<span class="nt">&lt;/h1&gt;</span>
<span class="w">        </span><span class="nt">&lt;h2&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/logout&quot;</span><span class="nt">&gt;</span>ÈÄÄÂá∫ÁôªÂΩï<span class="nt">&lt;/a&gt;&lt;/h2&gt;</span>
<span class="w">        </span><span class="nt">&lt;ul&gt;</span>
<span class="w">            </span><span class="nt">&lt;shiro:hasAnyRoles</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;user,admin&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;li&gt;</span>
<span class="w">                    </span><span class="nt">&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>Áî®Êà∑ÁÆ°ÁêÜ<span class="nt">&lt;/a&gt;</span>
<span class="w">                    </span><span class="nt">&lt;ul&gt;</span>
<span class="w">                        </span><span class="nt">&lt;shiro:hasPermission</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;user:add:*&quot;</span><span class="nt">&gt;</span>
<span class="w">                            </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/save&quot;</span><span class="nt">&gt;</span>Ê∑ªÂä†<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/shiro:hasPermission&gt;</span>
<span class="w">                        </span><span class="nt">&lt;shiro:hasPermission</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;user:delete:*&quot;</span><span class="nt">&gt;</span>
<span class="w">                            </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>Âà†Èô§<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/shiro:hasPermission&gt;</span>
<span class="w">                        </span><span class="nt">&lt;shiro:hasPermission</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;user:update:*&quot;</span><span class="nt">&gt;</span>
<span class="w">                            </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>‰øÆÊîπ<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/shiro:hasPermission&gt;</span>
<span class="w">                        </span><span class="nt">&lt;shiro:hasPermission</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;user:find:*&quot;</span><span class="nt">&gt;</span>
<span class="w">                            </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>Êü•ËØ¢<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/shiro:hasPermission&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/ul&gt;</span>
<span class="w">                </span><span class="nt">&lt;/li&gt;</span>
<span class="w">            </span><span class="nt">&lt;/shiro:hasAnyRoles&gt;</span>
<span class="w">            </span><span class="nt">&lt;shiro:hasRole</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;admin,product&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>ÂïÜÂìÅÁÆ°ÁêÜ<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">            </span><span class="nt">&lt;/shiro:hasRole&gt;</span>
<span class="w">            </span><span class="nt">&lt;shiro:hasRole</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;admin&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>ËÆ¢ÂçïÁÆ°ÁêÜ<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">            </span><span class="nt">&lt;/shiro:hasRole&gt;</span>
<span class="w">            </span><span class="nt">&lt;shiro:hasRole</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;admin&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>Áâ©ÊµÅÁÆ°ÁêÜ<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">            </span><span class="nt">&lt;/shiro:hasRole&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ul&gt;</span>
<span class="w">    </span><span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
</li>
<li>
<p>‰πüÂèØ‰ª•ÈÄöËøá Shiro ÁöÑÊ≥®Ëß£ËøõË°åÊéßÂà∂</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">  * save</span>
<span class="cm">  */</span>
<span class="nd">@RequiresRoles</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">)</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/save&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/save.jsp&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ÂàõÂª∫ ShiroMapper ‰∏≠ÁöÑÊñπÊ≥ï</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">  * Ê†πÊçÆÁî®Êà∑ÂêçÊü•ËØ¢ÊâÄÊúâËßíËâ≤</span>
<span class="cm">  *</span>
<span class="cm">  * @param username Áî®Êà∑Âêç</span>
<span class="cm">  * @return ËßíËâ≤ÈõÜÂêà</span>
<span class="cm">  */</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findRolesByUsername</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm">  * Ê†πÊçÆËßíËâ≤IdÊü•ËØ¢ÊâÄÊúâÊùÉÈôê</span>
<span class="cm">  *</span>
<span class="cm">  * @param id ËßíËâ≤Id</span>
<span class="cm">  * @return ÊùÉÈôêÈõÜÂêà</span>
<span class="cm">  */</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Perms</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findPermsByRoleId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>ShiroMapper.xml ÂÆûÁé∞</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findRolesByUsername&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;String&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;Role&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>SELECT
<span class="w">        </span>t_role.*
<span class="w">    </span>FROM
<span class="w">        </span>t_user
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>t_user_role<span class="w"> </span>ON<span class="w"> </span>t_user.id<span class="w"> </span>=<span class="w"> </span>t_user_role.userid
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>t_role<span class="w"> </span>ON<span class="w"> </span>t_user_role.roleid<span class="w"> </span>=<span class="w"> </span>t_role.id
<span class="w">    </span>WHERE
<span class="w">        </span>t_user.username<span class="w"> </span>=<span class="w"> </span>#{username}
<span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findPermsByRoleId&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;String&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;Perms&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>SELECT
<span class="w">        </span>t_perms.*
<span class="w">    </span>FROM
<span class="w">        </span>t_role
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>t_role_perms<span class="w"> </span>ON<span class="w"> </span>t_role.id<span class="w"> </span>=<span class="w"> </span>t_role.id<span class="w"> </span>=<span class="w"> </span>t_role_perms.roleid
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>t_perms<span class="w"> </span>ON<span class="w"> </span>t_role_perms.permsid<span class="w"> </span>=<span class="w"> </span>t_perms.id
<span class="w">    </span>WHERE
<span class="w">        </span>t_role.id<span class="w"> </span>=<span class="w"> </span>#{id}
<span class="nt">&lt;/select&gt;</span>
</code></pre></div>
</li>
<li>
<p>Service Êé•Âè£</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">  * Ê†πÊçÆÁî®Êà∑ÂêçÊü•ËØ¢ÊâÄÊúâËßíËâ≤</span>
<span class="cm">  *</span>
<span class="cm">  * @param username Áî®Êà∑Âêç</span>
<span class="cm">  * @return ËßíËâ≤ÈõÜÂêà</span>
<span class="cm">  */</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findRolesByUsername</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm">  * Ê†πÊçÆËßíËâ≤IdÊü•ËØ¢ÊâÄÊúâÊùÉÈôê</span>
<span class="cm">  *</span>
<span class="cm">  * @param id ËßíËâ≤Id</span>
<span class="cm">  * @return ÊùÉÈôêÈõÜÂêà</span>
<span class="cm">  */</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Perms</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findPermsByRoleId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>Service ÂÆûÁé∞</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findRolesByUsername</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">shiroMapper</span><span class="p">.</span><span class="na">findRolesByUsername</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Perms</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findPermsByRoleId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">shiroMapper</span><span class="p">.</span><span class="na">findPermsByRoleId</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>‰øÆÊîπËá™ÂÆö‰πâÁöÑ RealmÔºåÊï∞ÊçÆÊù•Ê∫êÊîπ‰∏∫Êü•ËØ¢Êï∞ÊçÆÂ∫ì</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">  * ÊéàÊùÉ</span>
<span class="cm">  */</span>
<span class="nd">@Override</span>
<span class="kd">protected</span><span class="w"> </span><span class="n">AuthorizationInfo</span><span class="w"> </span><span class="nf">doGetAuthorizationInfo</span><span class="p">(</span><span class="n">PrincipalCollection</span><span class="w"> </span><span class="n">principalCollection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//Ëé∑ÂèñË∫´‰ªΩ‰ø°ÊÅØ</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">principalCollection</span><span class="p">.</span><span class="na">getPrimaryPrincipal</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//Ê†πÊçÆ‰∏ªË∫´‰ªΩ‰ø°ÊÅØËé∑ÂèñËßíËâ≤‰ø°ÊÅØÂíåÊùÉÈôê‰ø°ÊÅØ</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span><span class="w"> </span><span class="n">roles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shiroService</span><span class="p">.</span><span class="na">findRolesByUsername</span><span class="p">(</span><span class="n">principal</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">CollectionUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">roles</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SimpleAuthorizationInfo</span><span class="w"> </span><span class="n">simpleAuthorizationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleAuthorizationInfo</span><span class="p">();</span>
<span class="w">        </span><span class="n">roles</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">role</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">simpleAuthorizationInfo</span><span class="p">.</span><span class="na">addRole</span><span class="p">(</span><span class="n">role</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Perms</span><span class="o">&gt;</span><span class="w"> </span><span class="n">perms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shiroService</span><span class="p">.</span><span class="na">findPermsByRoleId</span><span class="p">(</span><span class="n">role</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">CollectionUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">perms</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">perms</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">perm</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">simpleAuthorizationInfo</span><span class="p">.</span><span class="na">addStringPermission</span><span class="p">(</span><span class="n">perm</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">simpleAuthorizationInfo</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ÊµãËØï</p>
</li>
</ol>
<p>ÈóÆÈ¢òÔºö‰ΩøÁî®<code>@RequiresRoles</code>Âíå<code>@RequiresPermissions</code>ËøõË°åÊùÉÈôêÊéßÂà∂ÔºåÂΩìÊùÉÈôê‰∏çÂ§üÁöÑÊó∂ÂÄôÔºåÈ°µÈù¢Áõ¥Êé•ÊâìÂç∞ÂºÇÂ∏∏‰ø°ÊÅØÔºåËÄå‰∏çÊòØË∑≥ÂæÄ<code>shiroFilterFactoryBean.setUnauthorizedUrl("/403.jsp");</code>ËÆæÁΩÆÁöÑÊú™ÊéàÊùÉÈ°µÈù¢„ÄÇ</p>
<p>ÂéüÂõ†Ôºö</p>
<p>È¶ñÂÖàÊü•Áúã<code>setUnauthorizedUrl</code>ÊñπÊ≥ï</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUnauthorizedUrl</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">unauthorizedUrl</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">unauthorizedUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unauthorizedUrl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>ÁªßÁª≠Êü•Áúã <code>unauthorizedUrl</code>Ëøô‰∏™ÂèÇÊï∞Âú®Êï¥‰∏™ÂÆû‰ΩìÁ±ª‰∏≠Âú®Âì™‰∏™Âú∞Êñπ‰ΩøÁî®ËøáÔºåÂæÄ‰∏ãÂèØ‰ª•ÊâæÂà∞<code>applyUnauthorizedUrlIfNecessary</code>Ôºö</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">applyUnauthorizedUrlIfNecessary</span><span class="p">(</span><span class="n">Filter</span><span class="w"> </span><span class="n">filter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">unauthorizedUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getUnauthorizedUrl</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">hasText</span><span class="p">(</span><span class="n">unauthorizedUrl</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">AuthorizationFilter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">AuthorizationFilter</span><span class="w"> </span><span class="n">authzFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">AuthorizationFilter</span><span class="p">)</span><span class="n">filter</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">existingUnauthorizedUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">authzFilter</span><span class="p">.</span><span class="na">getUnauthorizedUrl</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">existingUnauthorizedUrl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">authzFilter</span><span class="p">.</span><span class="na">setUnauthorizedUrl</span><span class="p">(</span><span class="n">unauthorizedUrl</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>applyUnauthorizedUrlIfNecessary</code>Â∞±ÊòØËÆæÁΩÆÊó†ÊùÉÈôêËÆøÈóÆÁöÑurlÁöÑÊñπÊ≥ï„ÄÇÂÖ∂‰∏≠Êúâ‰∏ÄË°åÂæàÈáçË¶Å<code>filter instanceof AuthorizationFilter</code> Ëøô‰∏™ËøáÊª§Âô®ÂøÖÈ°ªË¶ÅÊòØ<code>AuthorizationFilter</code>ËøáÊª§Âô®ÊâçË°åÔºåÁÇπËøõ<code>AuthorizationFilter</code>Ôºö</p>
<p><img src="!assets/Shiro/image-20210409113723108.png" alt="image-20210409113723108" style="" /></p>
<p>ÊòØ‰∏™ÊäΩË±°Á±ªÔºåÈÇ£‰πàÊâæÂÖ∂ÂÆûÁé∞Á±ªÔºö</p>
<p><img src="!assets/Shiro/image-20210409113807269.png" alt="image-20210409113807269" style="" /></p>
<p>Ëøô‰∫õÊâçÊòØÂÖ∑‰ΩìÁöÑÁ±ª„ÄÇÊç¢Âè•ËØùËØ¥Âè™ÊúâËøô‰∫õËøáÊª§Âô®ÊâçÂèØ‰ª•‰ΩøËÆæÁΩÆÁîüÊïà„ÄÇËøô‰∫õËøáÊª§Âô®ÊòØÂï•ÔºüÂèØ‰ª•Âéª<code>org.apache.shiro.web.filter.mgt.DefaultFilter</code>Êü•ÁúãÔºåËøô‰∏™ÊòØ Shiro ÈªòËÆ§Êèê‰æõÁªôÊàë‰ª¨ÁöÑËøáÊª§Âô®Ôºö</p>
<p><img src="!assets/Shiro/image-20210409114342514.png" alt="image-20210409114342514" style="" /></p>
<p>Âè™ÊúâpermsÔºårolesÔºåsslÔºårestÔºåport ÊâçÊòØÂ±û‰∫é AuthorizationFilterÔºåËÄå anonÔºåauthcBasicÔºåauchcÔºåuser ÊòØ AuthenticationFilterÔºåÊâÄ‰ª• unauthorizedUrl ËÆæÁΩÆÂêéÈ°µÈù¢‰∏çË∑≥ËΩ¨„ÄÇ</p>
<p>Ëß£ÂÜ≥ÊñπÊ≥ïÔºöÂØπÊäõÂá∫ÁöÑÂºÇÂ∏∏ËøõË°åÁªü‰∏ÄÂ§ÑÁêÜ</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> * Áî®‰∫éËß£ÂÜ≥ shiroFilterFactoryBean.setUnauthorizedUrl(&quot;/403.jsp&quot;);‰∏çÁîüÊïàÁöÑÈóÆÈ¢ò</span>
<span class="cm"> * ¬∑@ControllerAdviceÔºöÊòØ‰∏Ä‰∏™ControllerÂ¢ûÂº∫Âô®ÔºåÂèØÂØπController‰∏≠Ë¢´@RequestMappingÊ≥®Ëß£ÁöÑÊñπÊ≥ïÂä†‰∏Ä‰∫õÈÄªËæëÂ§ÑÁêÜÔºå</span>
<span class="cm"> *  ÊúÄÂ∏∏Áî®ÁöÑÂ∞±ÊòØÂºÇÂ∏∏Â§ÑÁêÜ„ÄÅÂÖ®Â±ÄÊï∞ÊçÆÁªëÂÆö„ÄÅÂÖ®Â±ÄÊï∞ÊçÆÈ¢ÑÂ§ÑÁêÜ</span>
<span class="cm"> * ¬∑@OrderÊàñËÄÖOrderedÊé•Âè£ÔºöÂÆö‰πâSpringIoCÂÆπÂô®‰∏≠BeanÁöÑÊâßË°åÈ°∫Â∫èÁöÑ‰ºòÂÖàÁ∫ßÔºåËÄå‰∏çÊòØÂÆö‰πâBeanÁöÑÂä†ËΩΩÈ°∫Â∫èÔºå</span>
<span class="cm"> *  BeanÁöÑÂä†ËΩΩÈ°∫Â∫è‰∏çÂèó@OrderÊàñOrderedÊé•Âè£ÁöÑÂΩ±Âìç</span>
<span class="cm"> * ¬∑@ExceptionHandlerÔºöÁªü‰∏ÄÂºÇÂ∏∏Â§ÑÁêÜÂô®</span>
<span class="cm"> */</span>
<span class="nd">@ControllerAdvice</span>
<span class="nd">@Order</span><span class="p">(</span><span class="n">Ordered</span><span class="p">.</span><span class="na">HIGHEST_PRECEDENCE</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AdviceController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">AuthorizationException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">authorizationException</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;403&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="67-ehcache">6.7„ÄÅ‰ΩøÁî® EhCache ÁºìÂ≠ò<a class="headerlink" href="#67-ehcache" title="Permanent link">&para;</a></h3>
<p>Cache ÂèØ‰ª•ÂáèËΩªDBÁöÑËÆøÈóÆÂéãÂäõ,‰ªéËÄåÊèêÈ´òÁ≥ªÁªüÁöÑÊü•ËØ¢ÊïàÁéá</p>
<p><img src="!assets/Shiro/image-20200530090656417.png" alt="image-20200530090656417" style="" /></p>
<ol>
<li>
<p>ÂºïÂÖ• shrio-ehcache ‰æùËµñ</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!--ÂºïÂÖ•shiro-ehcache--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">  </span><span class="nt">&lt;groupId&gt;</span>org.apache.shiro<span class="nt">&lt;/groupId&gt;</span>
<span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>shiro-ehcache<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>1.5.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
</li>
<li>
<p>ÂºÄÂêØÁºìÂ≠ò</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">  * ÂàõÂª∫Ëá™ÂÆö‰πâRealm</span>
<span class="cm">  */</span>
<span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;CustomRealm&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">Realm</span><span class="w"> </span><span class="nf">getRealm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">CustomRealm</span><span class="w"> </span><span class="n">customRealm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CustomRealm</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//‰øÆÊîπÂá≠ËØÅÊ†°È™åÂåπÈÖçÂô®</span>
<span class="w">    </span><span class="n">HashedCredentialsMatcher</span><span class="w"> </span><span class="n">credentialsMatcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashedCredentialsMatcher</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//ËÆæÁΩÆÂä†ÂØÜÁÆóÊ≥ï‰∏∫MD5</span>
<span class="w">    </span><span class="n">credentialsMatcher</span><span class="p">.</span><span class="na">setHashAlgorithmName</span><span class="p">(</span><span class="s">&quot;MD5&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//ËÆæÁΩÆÊï£ÂàóÊ¨°Êï∞</span>
<span class="w">    </span><span class="n">credentialsMatcher</span><span class="p">.</span><span class="na">setHashIterations</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>
<span class="w">    </span><span class="n">customRealm</span><span class="p">.</span><span class="na">setCredentialsMatcher</span><span class="p">(</span><span class="n">credentialsMatcher</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//ÂºÄÂêØÁºìÂ≠ò</span>
<span class="w">    </span><span class="n">customRealm</span><span class="p">.</span><span class="na">setCachingEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">customRealm</span><span class="p">.</span><span class="na">setAuthenticationCachingEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">customRealm</span><span class="p">.</span><span class="na">setAuthenticationCacheName</span><span class="p">(</span><span class="s">&quot;authenticationCache&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">customRealm</span><span class="p">.</span><span class="na">setAuthorizationCachingEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">customRealm</span><span class="p">.</span><span class="na">setAuthorizationCacheName</span><span class="p">(</span><span class="s">&quot;authorizationCache&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//ËÆæÁΩÆÁºìÂ≠òÁÆ°ÁêÜÂô®</span>
<span class="w">    </span><span class="n">customRealm</span><span class="p">.</span><span class="na">setCacheManager</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">EhCacheManager</span><span class="p">());</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">customRealm</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ÊµãËØïÔºöÊú™ËÆæÁΩÆÁºìÂ≠òÁöÑÊó∂ÂÄôÔºåÊØèÊ¨°Âà∑Êñ∞È°µÈù¢ÔºåÈÉΩ‰ºö‰ªéÊï∞ÊçÆÂ∫ìÊü•ËØ¢ÊùÉÈôê‰ø°ÊÅØÔºåËÆæÁΩÆÁºìÂ≠òÁÆ°ÁêÜÂô®ÂêéÔºåÂà∑Êñ∞È°µÈù¢ÔºåÊéßÂà∂Âè∞Ê≤°ÊúâÊâìÂç∞ SQL Êü•ËØ¢ËØ¥ÊòéÊàêÂäü„ÄÇ</p>
</li>
</ol>
<h3 id="68-redis">6.8„ÄÅ‰ΩøÁî® Redis ÁºìÂ≠ò<a class="headerlink" href="#68-redis" title="Permanent link">&para;</a></h3>
<p>Êü•Áúã EhCacheManagerÔºö</p>
<p><img src="!assets/Shiro/image-20210409190842242.png" alt="image-20210409190842242" style="" /></p>
<p>ÁÖßÁå´ÁîªËôéÔºöÂ¶ÇÊûúÊàë‰ª¨‰ΩøÁî® Redis ‰Ωú‰∏∫ÁºìÂ≠òÔºåÈúÄË¶ÅËá™ÂÆö‰πâ‰∏Ä‰∏™ RedisCacheManager Âπ∂ÂÆûÁé∞ CacheManager„ÄÇ</p>
<p>CacheManager Âè™Êúâ‰∏Ä‰∏™ÊñπÊ≥ï getCacheÔºö</p>
<p><img src="!assets/Shiro/image-20210409191116577.png" alt="image-20210409191116577" style="" /></p>
<p>ËøîÂõûÂØπË±°‰∏∫ CacheÔºåÈÇ£‰πàËøòÈúÄË¶ÅËá™ÂÆö‰πâ‰∏Ä‰∏™ RedisCache Âπ∂ÂÆûÁé∞ Cache„ÄÇ</p>
<p><img src="!assets/Shiro/image-20210409191254065.png" alt="image-20210409191254065" style="" /></p>
<p>Cache ‰∏≠ÁöÑÊñπÊ≥ïÔºöget„ÄÅput„ÄÅremove„ÄÅclear„ÄÅsize„ÄÅkeys„ÄÅvalues Êîπ‰∏∫ÂØπ Redis ‰∏≠ÁöÑÊï∞ÊçÆÊìç‰ΩúÂç≥ÂèØ„ÄÇ</p>
<ol>
<li>
<p>ÂºïÂÖ• Redis ‰æùËµñ</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!--redisÊï¥Âêàspringboot--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">  </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
</li>
<li>
<p>ÈÖçÁΩÆ Redis ËøûÊé•</p>
<div class="highlight"><pre><span></span><code><span class="na">spring.redis.port</span><span class="o">=</span><span class="s">6379</span>
<span class="na">spring.redis.host</span><span class="o">=</span><span class="s">47.106.190.209</span>
<span class="na">spring.redis.database</span><span class="o">=</span><span class="s">0</span>
</code></pre></div>
</li>
<li>
<p>ÂêØÂä® Reids ÊúçÂä°</p>
</li>
<li>
<p>ÂºÄÂèë RedisCacheManager</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RedisCacheManager</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">CacheManager</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Cache</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getCache</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cacheName</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">CacheException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RedisCache</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">cacheName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ÁºñÂÜô RedisCache ÂÆûÁé∞</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RedisCache</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Cache</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cacheName</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">RedisCache</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">RedisCache</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cacheName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">cacheName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cacheName</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="w"> </span><span class="nf">getRedisTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RedisTemplate</span><span class="w"> </span><span class="n">redisTemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">RedisTemplate</span><span class="p">)</span><span class="w"> </span><span class="n">ApplicationContextUtils</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;redisTemplate&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">StringRedisSerializer</span><span class="w"> </span><span class="n">serializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringRedisSerializer</span><span class="p">();</span>
<span class="w">        </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">setKeySerializer</span><span class="p">(</span><span class="n">serializer</span><span class="p">);</span>
<span class="w">        </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">setHashKeySerializer</span><span class="p">(</span><span class="n">serializer</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">CacheException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Ëé∑ÂèñÁºìÂ≠ò key:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="w"> </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">cacheName</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">CacheException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ËÆæÁΩÆÁºìÂ≠ò key:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; value:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="w">        </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">cacheName</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">CacheException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="w"> </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">delete</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">cacheName</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">clear</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">CacheException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">delete</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">cacheName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">size</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">size</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">cacheName</span><span class="p">).</span><span class="na">intValue</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">keys</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">cacheName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">values</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getRedisTemplate</span><span class="p">().</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">values</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">cacheName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Âõ†‰∏∫ RedisTempate Êó†Ê≥ïËá™Âä®Ê≥®ÂÖ•ÔºåÊâÄ‰ª•ÁºñÂÜô‰∏Ä‰∏™Â∑•ÂÖ∑Á±ªÁõ¥Êé•ÂéªÂ∑•ÂéÇÊãø BeanÔºö</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApplicationContextUtils</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ApplicationContextAware</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setApplicationContext</span><span class="p">(</span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">BeansException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ApplicationContextUtils</span><span class="p">.</span><span class="na">applicationContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Ê†πÊçÆBeanÂêçÂ≠óËé∑ÂèñÂ∑•ÂéÇ‰∏≠ÊåáÂÆöÁöÑBeanÂØπË±°</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getBean</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">beanName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">beanName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">getBean</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">tClass</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">getBean</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">applicationContext</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="n">tClass</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Â∞Ü ShiroConfig ‰∏≠ÁöÑÁºìÂ≠òÁÆ°ÁêÜÂô®ËÆæÁΩÆ‰∏∫Ëá™ÂÆö‰πâÁöÑ RedisCacheManager</p>
<div class="highlight"><pre><span></span><code><span class="c1">//ËÆæÁΩÆÁºìÂ≠òÁÆ°ÁêÜÂô®</span>
<span class="n">customRealm</span><span class="p">.</span><span class="na">setCacheManager</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RedisCacheManager</span><span class="p">());</span>
</code></pre></div>
</li>
<li>
<p>ÊµãËØï</p>
</li>
</ol>
<p>ÁôªÂΩïÊä•Èîô</p>
<p><img src="!assets/Shiro/image-20210409182458318.png" alt="image-20210409182458318" style="" /></p>
<p><code>SimpleAuthenticationInfo</code>Á±ª‰∏≠Êúâ‰∏™Â±ûÊÄß<code>ByteSource</code>ÔºåÈªòËÆ§‰ΩøÁî®ÁöÑÊòØ<code>SimpleByteSource</code> Â∞±ÊòØÂõ†‰∏∫ËØ•Â±ûÊÄßÊó†Ê≥ïÂ∫èÂàóÂåñÂØºËá¥ÁöÑÔºö</p>
<p><img src="!assets/Shiro/image-20210409183049970.png" alt="image-20210409183049970" style="" /></p>
<p>Ëß£ÂÜ≥ÊñπÊ≥ïÔºö</p>
<p>Á¨¨‰∏ÄÁßçÔºö<strong>ÂèñÊ∂àauthenticationCache</strong></p>
<p>Âú®‰∏äÈù¢ÁöÑ shiroRealm ÈÖçÁΩÆ‰∏≠ÂºÄÂêØ‰∫Ü‰∏§‰∏™ÁºìÂ≠òÔºöauthenticationCache Âíå authorizationCacheÔºåÂ∫èÂàóÂåñÂ§±Ë¥•ÁöÑÂéüÂõ†Â∞±ÊòØ Âõ†‰∏∫ÂºÄÂêØ‰∫Ü authenticationCacheÔºåÂèØ‰ª•Â∞Ü authenticationCacheÂØπÂ∫îÁöÑÈÇ£‰∏§Ë°åÈÖçÁΩÆÂà†Èô§ÔºåÂè™ÁºìÂ≠ò authorizationCache„ÄÇ</p>
<p>Á¨¨‰∫åÁßçÔºö<strong>Ëá™ÂÆö‰πâByteSourceÁöÑÂÆûÁé∞Á±ª</strong></p>
<p>‰∏çÂèØ‰ª•ÂÜô‰∏Ä‰∏™Á±ªÁªßÊâø<code>SimpleByteSource</code> ÁÑ∂ÂêéÂÆûÁé∞Â∫èÂàóÂåñÊé•Âè£ÔºåÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author: Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MySimpleByteSource</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SimpleByteSource</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MySimpleByteSource</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">salt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">salt</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>ÁÑ∂ÂêéÂú®Ëá™ÂÆö‰πâÁöÑ<code>Realm</code>‰∏≠ÁöÑ<code>doGetAuthenticationInfo</code>ÊñπÊ≥ï‰∏≠ÔºåËøîÂõû<code>SimpleAuthenticationInfo</code>Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre><span></span><code><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleAuthenticationInfo</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getUsername</span><span class="p">(),</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getPassword</span><span class="p">(),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MySimpleByteSource</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getSalt</span><span class="p">()),</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
</code></pre></div>
<p>Ê≥®ÊÑèÔºöÁªèËøáÊµãËØï,Âú®Â∫èÂàóÂåñÁöÑÊó∂ÂÄô‰∏çÊä•Èîô,‰ΩÜÊòØÂú®ÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÂ∞±Êä•Èîô‰∫ÜÔºö</p>
<div class="highlight"><pre><span></span><code>2018/11/27 11:50:21.090 c.s.t.s.global.utils.SerializeUtils [] ERROR Failed to deserialize
java.io.InvalidClassException: com.springboot.test.shiro.config.shiro.MySimpleByteSource; no valid constructor
</code></pre></div>
<p>Âõ†‰∏∫Âú® <code>SimpleByteSource</code> ‰∏çÂ≠òÂú®ÈªòËÆ§ÁöÑ<code>Êó†ÂèÇÊûÑÈÄ†Âô®</code>, ÂΩì ‰∏çÂ≠òÂú®Êó†ÂèÇÊûÑÈÄ†Âô® ÊàñËÄÖ ËÆøÈóÆÊùÉÈôêËÆæÁΩÆ‰∏∫ private„ÄÅÈªòËÆ§Êàñ protected Á∫ßÂà´Ôºå‰ºöÊäõÂá∫java.io.InvalidException: no valid constructor ÂºÇÂ∏∏„ÄÇ</p>
<p><strong>Ê≠£Á°ÆÁöÑËß£ÂÜ≥ÂäûÊ≥ï</strong></p>
<p>Â∞Ü<code>SimpleByteSource</code>Êï¥‰∏™Á±ª Â§çÂà∂Á≤òË¥¥ Áªô‰∏™ÂêçÂ≠ó Âè´<code>MyByteSource</code>ÔºåÈ¢ùÂ§ñÂÆûÁé∞<code>Serializable</code>Êé•Âè£ÔºåÂπ∂Ê∑ªÂä†<code>Êó†ÂèÇÊûÑÈÄ†Âô®</code>Ôºö</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @author Orichalcos</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyByteSource</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ByteSource</span><span class="p">,</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cachedHex</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cachedBase64</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyByteSource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyByteSource</span><span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyByteSource</span><span class="p">(</span><span class="kt">char</span><span class="o">[]</span><span class="w"> </span><span class="n">chars</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CodecSupport</span><span class="p">.</span><span class="na">toBytes</span><span class="p">(</span><span class="n">chars</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyByteSource</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CodecSupport</span><span class="p">.</span><span class="na">toBytes</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyByteSource</span><span class="p">(</span><span class="n">ByteSource</span><span class="w"> </span><span class="n">source</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="na">getBytes</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyByteSource</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MyByteSource</span><span class="p">.</span><span class="na">BytesHelper</span><span class="p">()).</span><span class="na">getBytes</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyByteSource</span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">stream</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MyByteSource</span><span class="p">.</span><span class="na">BytesHelper</span><span class="p">()).</span><span class="na">getBytes</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isCompatible</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="kt">char</span><span class="o">[]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">ByteSource</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">InputStream</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="nf">getBytes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toHex</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">cachedHex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">cachedHex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hex</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cachedHex</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toBase64</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">cachedBase64</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">cachedBase64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cachedBase64</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">toBase64</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">hashCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">hashCode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">bytes</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">equals</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">ByteSource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ByteSource</span><span class="w"> </span><span class="n">bs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ByteSource</span><span class="p">)</span><span class="w"> </span><span class="n">o</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(),</span><span class="w"> </span><span class="n">bs</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BytesHelper</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">CodecSupport</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="nf">BytesHelper</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="nf">getBytes</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">toBytes</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="nf">getBytes</span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">stream</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">toBytes</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>ÁÑ∂ÂêéÂú®Ëá™ÂÆö‰πâÁöÑ<code>Realm</code>‰∏≠ÁöÑ<code>doGetAuthenticationInfo</code>ÊñπÊ≥ï‰∏≠ÔºåËøîÂõû<code>SimpleAuthenticationInfo</code>Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre><span></span><code><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleAuthenticationInfo</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getUsername</span><span class="p">(),</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getPassword</span><span class="p">(),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyByteSource</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getSalt</span><span class="p">()),</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
</code></pre></div>
<h2 id="7-thymeleaf">7„ÄÅ‰ΩøÁî® Thymeleaf<a class="headerlink" href="#7-thymeleaf" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>ÂºïÂÖ•‰æùËµñ</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!--thymeleaf--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">     </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<span class="w">     </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="cm">&lt;!--thymeleafÁöÑshiroÊâ©Â±ï‰æùËµñ--&gt;</span>
<span class="nt">&lt;dependency&gt;</span><span class="w">  </span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>com.github.theborakompanioni<span class="nt">&lt;/groupId&gt;</span><span class="w">  </span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>thymeleaf-extras-shiro<span class="nt">&lt;/artifactId&gt;</span><span class="w">  </span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>2.0.0<span class="nt">&lt;/version&gt;</span><span class="w">  </span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
</li>
<li>
<p>ÈÖçÁΩÆ thymeleaf</p>
<div class="highlight"><pre><span></span><code><span class="na">spring.thymeleaf.cache</span><span class="o">=</span><span class="s">false</span>
<span class="na">spring.thymeleaf.prefix</span><span class="o">=</span><span class="s">classpath:/templates/</span>
<span class="na">spring.thymeleaf.suffix</span><span class="o">=</span><span class="s">.html</span>
<span class="na">spring.thymeleaf.encoding</span><span class="o">=</span><span class="s">UTF-8</span>
<span class="na">spring.thymeleaf.content-type</span><span class="o">=</span><span class="s">text/html</span>
<span class="na">spring.thymeleaf.mode</span><span class="o">=</span><span class="s">HTML5</span>
</code></pre></div>
</li>
<li>
<p>È°µÈù¢‰∏≠ÂºïÂÖ•ÂëΩÂêçÁ©∫Èó¥</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span>
      <span class="na">xmlns:shiro</span><span class="o">=</span><span class="s">&quot;http://www.pollix.at/thymeleaf/shiro&quot;</span><span class="p">&gt;</span>
</code></pre></div>
</li>
<li>
<p>‰∏Ä‰∫õÂ∏∏Áî®ÁöÑÊ†áÁ≠æ</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- È™åËØÅÂΩìÂâçÁî®Êà∑ÊòØÂê¶‰∏∫‚ÄúËÆøÂÆ¢‚ÄùÔºåÂç≥Êú™ËÆ§ËØÅÔºàÂåÖÂê´Êú™ËÆ∞‰ΩèÔºâÁöÑÁî®Êà∑„ÄÇ --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">shiro:guest</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>Please <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;login.html&quot;</span><span class="p">&gt;</span>login<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- ËÆ§ËØÅÈÄöËøáÊàñÂ∑≤ËÆ∞‰ΩèÁöÑÁî®Êà∑„ÄÇ --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">shiro:user</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
    Welcome back John! Not John? Click <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;login.html&quot;</span><span class="p">&gt;</span>here<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> to login.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- Â∑≤ËÆ§ËØÅÈÄöËøáÁöÑÁî®Êà∑„ÄÇ‰∏çÂåÖÂê´Â∑≤ËÆ∞‰ΩèÁöÑÁî®Êà∑ÔºåËøôÊòØ‰∏éuserÊ†áÁ≠æÁöÑÂå∫Âà´ÊâÄÂú®„ÄÇ --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">shiro:authenticated</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
    Hello, <span class="p">&lt;</span><span class="nt">span</span> <span class="na">shiro:principal</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>, how are you today?
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">shiro:authenticated</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;updateAccount.html&quot;</span><span class="p">&gt;</span>Update your contact information<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- ËæìÂá∫ÂΩìÂâçÁî®Êà∑‰ø°ÊÅØÔºåÈÄöÂ∏∏‰∏∫ÁôªÂΩïÂ∏êÂè∑‰ø°ÊÅØ„ÄÇ --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello, <span class="p">&lt;</span><span class="nt">shiro:principal</span><span class="p">/&gt;</span>, how are you today?<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- Êú™ËÆ§ËØÅÈÄöËøáÁî®Êà∑Ôºå‰∏éauthenticatedÊ†áÁ≠æÁõ∏ÂØπÂ∫î„ÄÇ‰∏éguestÊ†áÁ≠æÁöÑÂå∫Âà´ÊòØÔºåËØ•Ê†áÁ≠æÂåÖÂê´Â∑≤ËÆ∞‰ΩèÁî®Êà∑„ÄÇ --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">shiro:notAuthenticated</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
    Please <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;login.html&quot;</span><span class="p">&gt;</span>login<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> in order to update your credit card information.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- È™åËØÅÂΩìÂâçÁî®Êà∑ÊòØÂê¶Â±û‰∫éËØ•ËßíËâ≤„ÄÇ --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">shiro:hasRole</span><span class="o">=</span><span class="s">&quot;admin&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;admin.html&quot;</span><span class="p">&gt;</span>Administer the system<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span><span class="cm">&lt;!-- Êã•ÊúâËØ•ËßíËâ≤ --&gt;</span>

<span class="cm">&lt;!-- ‰∏éhasRoleÊ†áÁ≠æÈÄªËæëÁõ∏ÂèçÔºåÂΩìÁî®Êà∑‰∏çÂ±û‰∫éËØ•ËßíËâ≤Êó∂È™åËØÅÈÄöËøá„ÄÇ --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">shiro:lacksRole</span><span class="o">=</span><span class="s">&quot;developer&quot;</span><span class="p">&gt;</span><span class="cm">&lt;!-- Ê≤°ÊúâËØ•ËßíËâ≤ --&gt;</span>
    Sorry, you are not allowed to developer the system.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- È™åËØÅÂΩìÂâçÁî®Êà∑ÊòØÂê¶Â±û‰∫é‰ª•‰∏ãÊâÄÊúâËßíËâ≤„ÄÇ --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">shiro:hasAllRoles</span><span class="o">=</span><span class="s">&quot;developer, 2&quot;</span><span class="p">&gt;</span><span class="cm">&lt;!-- ËßíËâ≤‰∏éÂà§Êñ≠ --&gt;</span>
    You are a developer and a admin.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- È™åËØÅÂΩìÂâçÁî®Êà∑ÊòØÂê¶Â±û‰∫é‰ª•‰∏ã‰ªªÊÑè‰∏Ä‰∏™ËßíËâ≤„ÄÇ  --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">shiro:hasAnyRoles</span><span class="o">=</span><span class="s">&quot;admin, vip, developer,1&quot;</span><span class="p">&gt;</span><span class="cm">&lt;!-- ËßíËâ≤ÊàñÂà§Êñ≠ --&gt;</span>
    You are a admin, vip, or developer.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cm">&lt;!--È™åËØÅÂΩìÂâçÁî®Êà∑ÊòØÂê¶Êã•ÊúâÊåáÂÆöÊùÉÈôê„ÄÇ  --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">shiro:hasPermission</span><span class="o">=</span><span class="s">&quot;userInfo:add&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;createUser.html&quot;</span><span class="p">&gt;</span>Ê∑ªÂä†Áî®Êà∑<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span><span class="cm">&lt;!-- Êã•ÊúâÊùÉÈôê --&gt;</span>

<span class="cm">&lt;!-- ‰∏éhasPermissionÊ†áÁ≠æÈÄªËæëÁõ∏ÂèçÔºåÂΩìÂâçÁî®Êà∑Ê≤°ÊúâÂà∂ÂÆöÊùÉÈôêÊó∂ÔºåÈ™åËØÅÈÄöËøá„ÄÇ --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">shiro:lacksPermission</span><span class="o">=</span><span class="s">&quot;userInfo:del&quot;</span><span class="p">&gt;</span><span class="cm">&lt;!-- Ê≤°ÊúâÊùÉÈôê --&gt;</span>
    Sorry, you are not allowed to delete user accounts.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- È™åËØÅÂΩìÂâçÁî®Êà∑ÊòØÂê¶Êã•Êúâ‰ª•‰∏ãÊâÄÊúâËßíËâ≤„ÄÇ --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">shiro:hasAllPermissions</span><span class="o">=</span><span class="s">&quot;userInfo:view, userInfo:add&quot;</span><span class="p">&gt;</span><span class="cm">&lt;!-- ÊùÉÈôê‰∏éÂà§Êñ≠ --&gt;</span>
    You can see or add users.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- È™åËØÅÂΩìÂâçÁî®Êà∑ÊòØÂê¶Êã•Êúâ‰ª•‰∏ã‰ªªÊÑè‰∏Ä‰∏™ÊùÉÈôê„ÄÇ  --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">shiro:hasAnyPermissions</span><span class="o">=</span><span class="s">&quot;userInfo:view, userInfo:del&quot;</span><span class="p">&gt;</span><span class="cm">&lt;!-- ÊùÉÈôêÊàñÂà§Êñ≠ --&gt;</span>
    You can see or delete users.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">shiro:hasPermission</span><span class="o">=</span><span class="s">&quot;pp&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;createUser.html&quot;</span><span class="p">&gt;</span>Create a new User<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  ÂõûÂà∞È°µÈù¢È°∂ÈÉ®
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.top", "navigation.indexes", "navigation.tracking"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../_javascripts/auto_title.js"></script>
      
    
  </body>
</html>